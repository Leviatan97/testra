(function(p,t){typeof exports=="object"&&typeof module=="object"?module.exports=t():typeof define=="function"&&define.amd?define([],t):typeof exports=="object"?exports.AFRAME=t():p.AFRAME=t()})(self,()=>(()=>{var p={8167:l=>{var h=Object.prototype.toString;l.exports=function(d){return d.BYTES_PER_ELEMENT&&h.call(d.buffer)==="[object ArrayBuffer]"||Array.isArray(d)}},5734:l=>{l.exports=function(h,d){return typeof h=="number"?h:typeof d=="number"?d:0}},7961:(l,h)=>{"use strict";h.byteLength=function(w){var T=b(w),P=T[0],U=T[1];return 3*(P+U)/4-U},h.toByteArray=function(w){var T,P,U=b(w),D=U[0],z=U[1],G=new g(function(q,K,ne){return 3*(K+ne)/4-ne}(0,D,z)),Q=0,Y=z>0?D-4:D;for(P=0;P<Y;P+=4)T=f[w.charCodeAt(P)]<<18|f[w.charCodeAt(P+1)]<<12|f[w.charCodeAt(P+2)]<<6|f[w.charCodeAt(P+3)],G[Q++]=T>>16&255,G[Q++]=T>>8&255,G[Q++]=255&T;return z===2&&(T=f[w.charCodeAt(P)]<<2|f[w.charCodeAt(P+1)]>>4,G[Q++]=255&T),z===1&&(T=f[w.charCodeAt(P)]<<10|f[w.charCodeAt(P+1)]<<4|f[w.charCodeAt(P+2)]>>2,G[Q++]=T>>8&255,G[Q++]=255&T),G},h.fromByteArray=function(w){for(var T,P=w.length,U=P%3,D=[],z=16383,G=0,Q=P-U;G<Q;G+=z)D.push(_(w,G,G+z>Q?Q:G+z));return U===1?(T=w[P-1],D.push(d[T>>2]+d[T<<4&63]+"==")):U===2&&(T=(w[P-2]<<8)+w[P-1],D.push(d[T>>10]+d[T>>4&63]+d[T<<2&63]+"=")),D.join("")};for(var d=[],f=[],g=typeof Uint8Array<"u"?Uint8Array:Array,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",x=0;x<64;++x)d[x]=y[x],f[y.charCodeAt(x)]=x;function b(w){var T=w.length;if(T%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var P=w.indexOf("=");return P===-1&&(P=T),[P,P===T?0:4-P%4]}function _(w,T,P){for(var U,D,z=[],G=T;G<P;G+=3)U=(w[G]<<16&16711680)+(w[G+1]<<8&65280)+(255&w[G+2]),z.push(d[(D=U)>>18&63]+d[D>>12&63]+d[D>>6&63]+d[63&D]);return z.join("")}f[45]=62,f[95]=63},911:(l,h,d)=>{var f=d(9922).hp;l.exports=function(g,y){if(f.isBuffer(g)&&f.isBuffer(y)){if(typeof g.equals=="function")return g.equals(y);if(g.length!==y.length)return!1;for(var x=0;x<g.length;x++)if(g[x]!==y[x])return!1;return!0}}},9922:(l,h,d)=>{"use strict";const f=d(7961),g=d(1024),y=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;h.hp=_,h.IS=50;const x=2147483647;function b(k){if(k>x)throw new RangeError('The value "'+k+'" is invalid for option "size"');const j=new Uint8Array(k);return Object.setPrototypeOf(j,_.prototype),j}function _(k,j,J){if(typeof k=="number"){if(typeof j=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return P(k)}return w(k,j,J)}function w(k,j,J){if(typeof k=="string")return function(Re,rt){if(typeof rt=="string"&&rt!==""||(rt="utf8"),!_.isEncoding(rt))throw new TypeError("Unknown encoding: "+rt);const _t=0|G(Re,rt);let kt=b(_t);const un=kt.write(Re,rt);return un!==_t&&(kt=kt.slice(0,un)),kt}(k,j);if(ArrayBuffer.isView(k))return function(Re){if(bt(Re,Uint8Array)){const rt=new Uint8Array(Re);return D(rt.buffer,rt.byteOffset,rt.byteLength)}return U(Re)}(k);if(k==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof k);if(bt(k,ArrayBuffer)||k&&bt(k.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(bt(k,SharedArrayBuffer)||k&&bt(k.buffer,SharedArrayBuffer)))return D(k,j,J);if(typeof k=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Ae=k.valueOf&&k.valueOf();if(Ae!=null&&Ae!==k)return _.from(Ae,j,J);const ye=function(Re){if(_.isBuffer(Re)){const rt=0|z(Re.length),_t=b(rt);return _t.length===0||Re.copy(_t,0,0,rt),_t}return Re.length!==void 0?typeof Re.length!="number"||ht(Re.length)?b(0):U(Re):Re.type==="Buffer"&&Array.isArray(Re.data)?U(Re.data):void 0}(k);if(ye)return ye;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof k[Symbol.toPrimitive]=="function")return _.from(k[Symbol.toPrimitive]("string"),j,J);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof k)}function T(k){if(typeof k!="number")throw new TypeError('"size" argument must be of type number');if(k<0)throw new RangeError('The value "'+k+'" is invalid for option "size"')}function P(k){return T(k),b(k<0?0:0|z(k))}function U(k){const j=k.length<0?0:0|z(k.length),J=b(j);for(let Ae=0;Ae<j;Ae+=1)J[Ae]=255&k[Ae];return J}function D(k,j,J){if(j<0||k.byteLength<j)throw new RangeError('"offset" is outside of buffer bounds');if(k.byteLength<j+(J||0))throw new RangeError('"length" is outside of buffer bounds');let Ae;return Ae=j===void 0&&J===void 0?new Uint8Array(k):J===void 0?new Uint8Array(k,j):new Uint8Array(k,j,J),Object.setPrototypeOf(Ae,_.prototype),Ae}function z(k){if(k>=x)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+x.toString(16)+" bytes");return 0|k}function G(k,j){if(_.isBuffer(k))return k.length;if(ArrayBuffer.isView(k)||bt(k,ArrayBuffer))return k.byteLength;if(typeof k!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof k);const J=k.length,Ae=arguments.length>2&&arguments[2]===!0;if(!Ae&&J===0)return 0;let ye=!1;for(;;)switch(j){case"ascii":case"latin1":case"binary":return J;case"utf8":case"utf-8":return Ct(k).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*J;case"hex":return J>>>1;case"base64":return Ke(k).length;default:if(ye)return Ae?-1:Ct(k).length;j=(""+j).toLowerCase(),ye=!0}}function Q(k,j,J){let Ae=!1;if((j===void 0||j<0)&&(j=0),j>this.length||((J===void 0||J>this.length)&&(J=this.length),J<=0)||(J>>>=0)<=(j>>>=0))return"";for(k||(k="utf8");;)switch(k){case"hex":return me(this,j,J);case"utf8":case"utf-8":return we(this,j,J);case"ascii":return _e(this,j,J);case"latin1":case"binary":return tt(this,j,J);case"base64":return Fe(this,j,J);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wt(this,j,J);default:if(Ae)throw new TypeError("Unknown encoding: "+k);k=(k+"").toLowerCase(),Ae=!0}}function Y(k,j,J){const Ae=k[j];k[j]=k[J],k[J]=Ae}function q(k,j,J,Ae,ye){if(k.length===0)return-1;if(typeof J=="string"?(Ae=J,J=0):J>2147483647?J=2147483647:J<-2147483648&&(J=-2147483648),ht(J=+J)&&(J=ye?0:k.length-1),J<0&&(J=k.length+J),J>=k.length){if(ye)return-1;J=k.length-1}else if(J<0){if(!ye)return-1;J=0}if(typeof j=="string"&&(j=_.from(j,Ae)),_.isBuffer(j))return j.length===0?-1:K(k,j,J,Ae,ye);if(typeof j=="number")return j&=255,typeof Uint8Array.prototype.indexOf=="function"?ye?Uint8Array.prototype.indexOf.call(k,j,J):Uint8Array.prototype.lastIndexOf.call(k,j,J):K(k,[j],J,Ae,ye);throw new TypeError("val must be string, number or Buffer")}function K(k,j,J,Ae,ye){let Re,rt=1,_t=k.length,kt=j.length;if(Ae!==void 0&&((Ae=String(Ae).toLowerCase())==="ucs2"||Ae==="ucs-2"||Ae==="utf16le"||Ae==="utf-16le")){if(k.length<2||j.length<2)return-1;rt=2,_t/=2,kt/=2,J/=2}function un(Jn,Ri){return rt===1?Jn[Ri]:Jn.readUInt16BE(Ri*rt)}if(ye){let Jn=-1;for(Re=J;Re<_t;Re++)if(un(k,Re)===un(j,Jn===-1?0:Re-Jn)){if(Jn===-1&&(Jn=Re),Re-Jn+1===kt)return Jn*rt}else Jn!==-1&&(Re-=Re-Jn),Jn=-1}else for(J+kt>_t&&(J=_t-kt),Re=J;Re>=0;Re--){let Jn=!0;for(let Ri=0;Ri<kt;Ri++)if(un(k,Re+Ri)!==un(j,Ri)){Jn=!1;break}if(Jn)return Re}return-1}function ne(k,j,J,Ae){J=Number(J)||0;const ye=k.length-J;Ae?(Ae=Number(Ae))>ye&&(Ae=ye):Ae=ye;const Re=j.length;let rt;for(Ae>Re/2&&(Ae=Re/2),rt=0;rt<Ae;++rt){const _t=parseInt(j.substr(2*rt,2),16);if(ht(_t))return rt;k[J+rt]=_t}return rt}function le(k,j,J,Ae){return yt(Ct(j,k.length-J),k,J,Ae)}function fe(k,j,J,Ae){return yt(function(ye){const Re=[];for(let rt=0;rt<ye.length;++rt)Re.push(255&ye.charCodeAt(rt));return Re}(j),k,J,Ae)}function be(k,j,J,Ae){return yt(Ke(j),k,J,Ae)}function de(k,j,J,Ae){return yt(function(ye,Re){let rt,_t,kt;const un=[];for(let Jn=0;Jn<ye.length&&!((Re-=2)<0);++Jn)rt=ye.charCodeAt(Jn),_t=rt>>8,kt=rt%256,un.push(kt),un.push(_t);return un}(j,k.length-J),k,J,Ae)}function Fe(k,j,J){return j===0&&J===k.length?f.fromByteArray(k):f.fromByteArray(k.slice(j,J))}function we(k,j,J){J=Math.min(k.length,J);const Ae=[];let ye=j;for(;ye<J;){const Re=k[ye];let rt=null,_t=Re>239?4:Re>223?3:Re>191?2:1;if(ye+_t<=J){let kt,un,Jn,Ri;switch(_t){case 1:Re<128&&(rt=Re);break;case 2:kt=k[ye+1],(192&kt)==128&&(Ri=(31&Re)<<6|63&kt,Ri>127&&(rt=Ri));break;case 3:kt=k[ye+1],un=k[ye+2],(192&kt)==128&&(192&un)==128&&(Ri=(15&Re)<<12|(63&kt)<<6|63&un,Ri>2047&&(Ri<55296||Ri>57343)&&(rt=Ri));break;case 4:kt=k[ye+1],un=k[ye+2],Jn=k[ye+3],(192&kt)==128&&(192&un)==128&&(192&Jn)==128&&(Ri=(15&Re)<<18|(63&kt)<<12|(63&un)<<6|63&Jn,Ri>65535&&Ri<1114112&&(rt=Ri))}}rt===null?(rt=65533,_t=1):rt>65535&&(rt-=65536,Ae.push(rt>>>10&1023|55296),rt=56320|1023&rt),Ae.push(rt),ye+=_t}return function(Re){const rt=Re.length;if(rt<=Me)return String.fromCharCode.apply(String,Re);let _t="",kt=0;for(;kt<rt;)_t+=String.fromCharCode.apply(String,Re.slice(kt,kt+=Me));return _t}(Ae)}_.TYPED_ARRAY_SUPPORT=function(){try{const k=new Uint8Array(1),j={foo:function(){return 42}};return Object.setPrototypeOf(j,Uint8Array.prototype),Object.setPrototypeOf(k,j),k.foo()===42}catch{return!1}}(),_.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(_.prototype,"parent",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.buffer}}),Object.defineProperty(_.prototype,"offset",{enumerable:!0,get:function(){if(_.isBuffer(this))return this.byteOffset}}),_.poolSize=8192,_.from=function(k,j,J){return w(k,j,J)},Object.setPrototypeOf(_.prototype,Uint8Array.prototype),Object.setPrototypeOf(_,Uint8Array),_.alloc=function(k,j,J){return function(Ae,ye,Re){return T(Ae),Ae<=0?b(Ae):ye!==void 0?typeof Re=="string"?b(Ae).fill(ye,Re):b(Ae).fill(ye):b(Ae)}(k,j,J)},_.allocUnsafe=function(k){return P(k)},_.allocUnsafeSlow=function(k){return P(k)},_.isBuffer=function(k){return k!=null&&k._isBuffer===!0&&k!==_.prototype},_.compare=function(k,j){if(bt(k,Uint8Array)&&(k=_.from(k,k.offset,k.byteLength)),bt(j,Uint8Array)&&(j=_.from(j,j.offset,j.byteLength)),!_.isBuffer(k)||!_.isBuffer(j))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(k===j)return 0;let J=k.length,Ae=j.length;for(let ye=0,Re=Math.min(J,Ae);ye<Re;++ye)if(k[ye]!==j[ye]){J=k[ye],Ae=j[ye];break}return J<Ae?-1:Ae<J?1:0},_.isEncoding=function(k){switch(String(k).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.concat=function(k,j){if(!Array.isArray(k))throw new TypeError('"list" argument must be an Array of Buffers');if(k.length===0)return _.alloc(0);let J;if(j===void 0)for(j=0,J=0;J<k.length;++J)j+=k[J].length;const Ae=_.allocUnsafe(j);let ye=0;for(J=0;J<k.length;++J){let Re=k[J];if(bt(Re,Uint8Array))ye+Re.length>Ae.length?(_.isBuffer(Re)||(Re=_.from(Re)),Re.copy(Ae,ye)):Uint8Array.prototype.set.call(Ae,Re,ye);else{if(!_.isBuffer(Re))throw new TypeError('"list" argument must be an Array of Buffers');Re.copy(Ae,ye)}ye+=Re.length}return Ae},_.byteLength=G,_.prototype._isBuffer=!0,_.prototype.swap16=function(){const k=this.length;if(k%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let j=0;j<k;j+=2)Y(this,j,j+1);return this},_.prototype.swap32=function(){const k=this.length;if(k%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let j=0;j<k;j+=4)Y(this,j,j+3),Y(this,j+1,j+2);return this},_.prototype.swap64=function(){const k=this.length;if(k%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let j=0;j<k;j+=8)Y(this,j,j+7),Y(this,j+1,j+6),Y(this,j+2,j+5),Y(this,j+3,j+4);return this},_.prototype.toString=function(){const k=this.length;return k===0?"":arguments.length===0?we(this,0,k):Q.apply(this,arguments)},_.prototype.toLocaleString=_.prototype.toString,_.prototype.equals=function(k){if(!_.isBuffer(k))throw new TypeError("Argument must be a Buffer");return this===k||_.compare(this,k)===0},_.prototype.inspect=function(){let k="";const j=h.IS;return k=this.toString("hex",0,j).replace(/(.{2})/g,"$1 ").trim(),this.length>j&&(k+=" ... "),"<Buffer "+k+">"},y&&(_.prototype[y]=_.prototype.inspect),_.prototype.compare=function(k,j,J,Ae,ye){if(bt(k,Uint8Array)&&(k=_.from(k,k.offset,k.byteLength)),!_.isBuffer(k))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof k);if(j===void 0&&(j=0),J===void 0&&(J=k?k.length:0),Ae===void 0&&(Ae=0),ye===void 0&&(ye=this.length),j<0||J>k.length||Ae<0||ye>this.length)throw new RangeError("out of range index");if(Ae>=ye&&j>=J)return 0;if(Ae>=ye)return-1;if(j>=J)return 1;if(this===k)return 0;let Re=(ye>>>=0)-(Ae>>>=0),rt=(J>>>=0)-(j>>>=0);const _t=Math.min(Re,rt),kt=this.slice(Ae,ye),un=k.slice(j,J);for(let Jn=0;Jn<_t;++Jn)if(kt[Jn]!==un[Jn]){Re=kt[Jn],rt=un[Jn];break}return Re<rt?-1:rt<Re?1:0},_.prototype.includes=function(k,j,J){return this.indexOf(k,j,J)!==-1},_.prototype.indexOf=function(k,j,J){return q(this,k,j,J,!0)},_.prototype.lastIndexOf=function(k,j,J){return q(this,k,j,J,!1)},_.prototype.write=function(k,j,J,Ae){if(j===void 0)Ae="utf8",J=this.length,j=0;else if(J===void 0&&typeof j=="string")Ae=j,J=this.length,j=0;else{if(!isFinite(j))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");j>>>=0,isFinite(J)?(J>>>=0,Ae===void 0&&(Ae="utf8")):(Ae=J,J=void 0)}const ye=this.length-j;if((J===void 0||J>ye)&&(J=ye),k.length>0&&(J<0||j<0)||j>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ae||(Ae="utf8");let Re=!1;for(;;)switch(Ae){case"hex":return ne(this,k,j,J);case"utf8":case"utf-8":return le(this,k,j,J);case"ascii":case"latin1":case"binary":return fe(this,k,j,J);case"base64":return be(this,k,j,J);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,k,j,J);default:if(Re)throw new TypeError("Unknown encoding: "+Ae);Ae=(""+Ae).toLowerCase(),Re=!0}},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const Me=4096;function _e(k,j,J){let Ae="";J=Math.min(k.length,J);for(let ye=j;ye<J;++ye)Ae+=String.fromCharCode(127&k[ye]);return Ae}function tt(k,j,J){let Ae="";J=Math.min(k.length,J);for(let ye=j;ye<J;++ye)Ae+=String.fromCharCode(k[ye]);return Ae}function me(k,j,J){const Ae=k.length;(!j||j<0)&&(j=0),(!J||J<0||J>Ae)&&(J=Ae);let ye="";for(let Re=j;Re<J;++Re)ye+=Vt[k[Re]];return ye}function wt(k,j,J){const Ae=k.slice(j,J);let ye="";for(let Re=0;Re<Ae.length-1;Re+=2)ye+=String.fromCharCode(Ae[Re]+256*Ae[Re+1]);return ye}function ft(k,j,J){if(k%1!=0||k<0)throw new RangeError("offset is not uint");if(k+j>J)throw new RangeError("Trying to access beyond buffer length")}function ze(k,j,J,Ae,ye,Re){if(!_.isBuffer(k))throw new TypeError('"buffer" argument must be a Buffer instance');if(j>ye||j<Re)throw new RangeError('"value" argument is out of bounds');if(J+Ae>k.length)throw new RangeError("Index out of range")}function $e(k,j,J,Ae,ye){je(j,Ae,ye,k,J,7);let Re=Number(j&BigInt(4294967295));k[J++]=Re,Re>>=8,k[J++]=Re,Re>>=8,k[J++]=Re,Re>>=8,k[J++]=Re;let rt=Number(j>>BigInt(32)&BigInt(4294967295));return k[J++]=rt,rt>>=8,k[J++]=rt,rt>>=8,k[J++]=rt,rt>>=8,k[J++]=rt,J}function pt(k,j,J,Ae,ye){je(j,Ae,ye,k,J,7);let Re=Number(j&BigInt(4294967295));k[J+7]=Re,Re>>=8,k[J+6]=Re,Re>>=8,k[J+5]=Re,Re>>=8,k[J+4]=Re;let rt=Number(j>>BigInt(32)&BigInt(4294967295));return k[J+3]=rt,rt>>=8,k[J+2]=rt,rt>>=8,k[J+1]=rt,rt>>=8,k[J]=rt,J+8}function lt(k,j,J,Ae,ye,Re){if(J+Ae>k.length)throw new RangeError("Index out of range");if(J<0)throw new RangeError("Index out of range")}function he(k,j,J,Ae,ye){return j=+j,J>>>=0,ye||lt(k,0,J,4),g.write(k,j,J,Ae,23,4),J+4}function Z(k,j,J,Ae,ye){return j=+j,J>>>=0,ye||lt(k,0,J,8),g.write(k,j,J,Ae,52,8),J+8}_.prototype.slice=function(k,j){const J=this.length;(k=~~k)<0?(k+=J)<0&&(k=0):k>J&&(k=J),(j=j===void 0?J:~~j)<0?(j+=J)<0&&(j=0):j>J&&(j=J),j<k&&(j=k);const Ae=this.subarray(k,j);return Object.setPrototypeOf(Ae,_.prototype),Ae},_.prototype.readUintLE=_.prototype.readUIntLE=function(k,j,J){k>>>=0,j>>>=0,J||ft(k,j,this.length);let Ae=this[k],ye=1,Re=0;for(;++Re<j&&(ye*=256);)Ae+=this[k+Re]*ye;return Ae},_.prototype.readUintBE=_.prototype.readUIntBE=function(k,j,J){k>>>=0,j>>>=0,J||ft(k,j,this.length);let Ae=this[k+--j],ye=1;for(;j>0&&(ye*=256);)Ae+=this[k+--j]*ye;return Ae},_.prototype.readUint8=_.prototype.readUInt8=function(k,j){return k>>>=0,j||ft(k,1,this.length),this[k]},_.prototype.readUint16LE=_.prototype.readUInt16LE=function(k,j){return k>>>=0,j||ft(k,2,this.length),this[k]|this[k+1]<<8},_.prototype.readUint16BE=_.prototype.readUInt16BE=function(k,j){return k>>>=0,j||ft(k,2,this.length),this[k]<<8|this[k+1]},_.prototype.readUint32LE=_.prototype.readUInt32LE=function(k,j){return k>>>=0,j||ft(k,4,this.length),(this[k]|this[k+1]<<8|this[k+2]<<16)+16777216*this[k+3]},_.prototype.readUint32BE=_.prototype.readUInt32BE=function(k,j){return k>>>=0,j||ft(k,4,this.length),16777216*this[k]+(this[k+1]<<16|this[k+2]<<8|this[k+3])},_.prototype.readBigUInt64LE=Nt(function(k){pe(k>>>=0,"offset");const j=this[k],J=this[k+7];j!==void 0&&J!==void 0||Ve(k,this.length-8);const Ae=j+256*this[++k]+65536*this[++k]+this[++k]*2**24,ye=this[++k]+256*this[++k]+65536*this[++k]+J*2**24;return BigInt(Ae)+(BigInt(ye)<<BigInt(32))}),_.prototype.readBigUInt64BE=Nt(function(k){pe(k>>>=0,"offset");const j=this[k],J=this[k+7];j!==void 0&&J!==void 0||Ve(k,this.length-8);const Ae=j*2**24+65536*this[++k]+256*this[++k]+this[++k],ye=this[++k]*2**24+65536*this[++k]+256*this[++k]+J;return(BigInt(Ae)<<BigInt(32))+BigInt(ye)}),_.prototype.readIntLE=function(k,j,J){k>>>=0,j>>>=0,J||ft(k,j,this.length);let Ae=this[k],ye=1,Re=0;for(;++Re<j&&(ye*=256);)Ae+=this[k+Re]*ye;return ye*=128,Ae>=ye&&(Ae-=Math.pow(2,8*j)),Ae},_.prototype.readIntBE=function(k,j,J){k>>>=0,j>>>=0,J||ft(k,j,this.length);let Ae=j,ye=1,Re=this[k+--Ae];for(;Ae>0&&(ye*=256);)Re+=this[k+--Ae]*ye;return ye*=128,Re>=ye&&(Re-=Math.pow(2,8*j)),Re},_.prototype.readInt8=function(k,j){return k>>>=0,j||ft(k,1,this.length),128&this[k]?-1*(255-this[k]+1):this[k]},_.prototype.readInt16LE=function(k,j){k>>>=0,j||ft(k,2,this.length);const J=this[k]|this[k+1]<<8;return 32768&J?4294901760|J:J},_.prototype.readInt16BE=function(k,j){k>>>=0,j||ft(k,2,this.length);const J=this[k+1]|this[k]<<8;return 32768&J?4294901760|J:J},_.prototype.readInt32LE=function(k,j){return k>>>=0,j||ft(k,4,this.length),this[k]|this[k+1]<<8|this[k+2]<<16|this[k+3]<<24},_.prototype.readInt32BE=function(k,j){return k>>>=0,j||ft(k,4,this.length),this[k]<<24|this[k+1]<<16|this[k+2]<<8|this[k+3]},_.prototype.readBigInt64LE=Nt(function(k){pe(k>>>=0,"offset");const j=this[k],J=this[k+7];j!==void 0&&J!==void 0||Ve(k,this.length-8);const Ae=this[k+4]+256*this[k+5]+65536*this[k+6]+(J<<24);return(BigInt(Ae)<<BigInt(32))+BigInt(j+256*this[++k]+65536*this[++k]+this[++k]*16777216)}),_.prototype.readBigInt64BE=Nt(function(k){pe(k>>>=0,"offset");const j=this[k],J=this[k+7];j!==void 0&&J!==void 0||Ve(k,this.length-8);const Ae=(j<<24)+65536*this[++k]+256*this[++k]+this[++k];return(BigInt(Ae)<<BigInt(32))+BigInt(this[++k]*16777216+65536*this[++k]+256*this[++k]+J)}),_.prototype.readFloatLE=function(k,j){return k>>>=0,j||ft(k,4,this.length),g.read(this,k,!0,23,4)},_.prototype.readFloatBE=function(k,j){return k>>>=0,j||ft(k,4,this.length),g.read(this,k,!1,23,4)},_.prototype.readDoubleLE=function(k,j){return k>>>=0,j||ft(k,8,this.length),g.read(this,k,!0,52,8)},_.prototype.readDoubleBE=function(k,j){return k>>>=0,j||ft(k,8,this.length),g.read(this,k,!1,52,8)},_.prototype.writeUintLE=_.prototype.writeUIntLE=function(k,j,J,Ae){k=+k,j>>>=0,J>>>=0,Ae||ze(this,k,j,J,Math.pow(2,8*J)-1,0);let ye=1,Re=0;for(this[j]=255&k;++Re<J&&(ye*=256);)this[j+Re]=k/ye&255;return j+J},_.prototype.writeUintBE=_.prototype.writeUIntBE=function(k,j,J,Ae){k=+k,j>>>=0,J>>>=0,Ae||ze(this,k,j,J,Math.pow(2,8*J)-1,0);let ye=J-1,Re=1;for(this[j+ye]=255&k;--ye>=0&&(Re*=256);)this[j+ye]=k/Re&255;return j+J},_.prototype.writeUint8=_.prototype.writeUInt8=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,1,255,0),this[j]=255&k,j+1},_.prototype.writeUint16LE=_.prototype.writeUInt16LE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,2,65535,0),this[j]=255&k,this[j+1]=k>>>8,j+2},_.prototype.writeUint16BE=_.prototype.writeUInt16BE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,2,65535,0),this[j]=k>>>8,this[j+1]=255&k,j+2},_.prototype.writeUint32LE=_.prototype.writeUInt32LE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,4,4294967295,0),this[j+3]=k>>>24,this[j+2]=k>>>16,this[j+1]=k>>>8,this[j]=255&k,j+4},_.prototype.writeUint32BE=_.prototype.writeUInt32BE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,4,4294967295,0),this[j]=k>>>24,this[j+1]=k>>>16,this[j+2]=k>>>8,this[j+3]=255&k,j+4},_.prototype.writeBigUInt64LE=Nt(function(k,j=0){return $e(this,k,j,BigInt(0),BigInt("0xffffffffffffffff"))}),_.prototype.writeBigUInt64BE=Nt(function(k,j=0){return pt(this,k,j,BigInt(0),BigInt("0xffffffffffffffff"))}),_.prototype.writeIntLE=function(k,j,J,Ae){if(k=+k,j>>>=0,!Ae){const _t=Math.pow(2,8*J-1);ze(this,k,j,J,_t-1,-_t)}let ye=0,Re=1,rt=0;for(this[j]=255&k;++ye<J&&(Re*=256);)k<0&&rt===0&&this[j+ye-1]!==0&&(rt=1),this[j+ye]=(k/Re|0)-rt&255;return j+J},_.prototype.writeIntBE=function(k,j,J,Ae){if(k=+k,j>>>=0,!Ae){const _t=Math.pow(2,8*J-1);ze(this,k,j,J,_t-1,-_t)}let ye=J-1,Re=1,rt=0;for(this[j+ye]=255&k;--ye>=0&&(Re*=256);)k<0&&rt===0&&this[j+ye+1]!==0&&(rt=1),this[j+ye]=(k/Re|0)-rt&255;return j+J},_.prototype.writeInt8=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,1,127,-128),k<0&&(k=255+k+1),this[j]=255&k,j+1},_.prototype.writeInt16LE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,2,32767,-32768),this[j]=255&k,this[j+1]=k>>>8,j+2},_.prototype.writeInt16BE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,2,32767,-32768),this[j]=k>>>8,this[j+1]=255&k,j+2},_.prototype.writeInt32LE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,4,2147483647,-2147483648),this[j]=255&k,this[j+1]=k>>>8,this[j+2]=k>>>16,this[j+3]=k>>>24,j+4},_.prototype.writeInt32BE=function(k,j,J){return k=+k,j>>>=0,J||ze(this,k,j,4,2147483647,-2147483648),k<0&&(k=4294967295+k+1),this[j]=k>>>24,this[j+1]=k>>>16,this[j+2]=k>>>8,this[j+3]=255&k,j+4},_.prototype.writeBigInt64LE=Nt(function(k,j=0){return $e(this,k,j,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),_.prototype.writeBigInt64BE=Nt(function(k,j=0){return pt(this,k,j,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),_.prototype.writeFloatLE=function(k,j,J){return he(this,k,j,!0,J)},_.prototype.writeFloatBE=function(k,j,J){return he(this,k,j,!1,J)},_.prototype.writeDoubleLE=function(k,j,J){return Z(this,k,j,!0,J)},_.prototype.writeDoubleBE=function(k,j,J){return Z(this,k,j,!1,J)},_.prototype.copy=function(k,j,J,Ae){if(!_.isBuffer(k))throw new TypeError("argument should be a Buffer");if(J||(J=0),Ae||Ae===0||(Ae=this.length),j>=k.length&&(j=k.length),j||(j=0),Ae>0&&Ae<J&&(Ae=J),Ae===J||k.length===0||this.length===0)return 0;if(j<0)throw new RangeError("targetStart out of bounds");if(J<0||J>=this.length)throw new RangeError("Index out of range");if(Ae<0)throw new RangeError("sourceEnd out of bounds");Ae>this.length&&(Ae=this.length),k.length-j<Ae-J&&(Ae=k.length-j+J);const ye=Ae-J;return this===k&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(j,J,Ae):Uint8Array.prototype.set.call(k,this.subarray(J,Ae),j),ye},_.prototype.fill=function(k,j,J,Ae){if(typeof k=="string"){if(typeof j=="string"?(Ae=j,j=0,J=this.length):typeof J=="string"&&(Ae=J,J=this.length),Ae!==void 0&&typeof Ae!="string")throw new TypeError("encoding must be a string");if(typeof Ae=="string"&&!_.isEncoding(Ae))throw new TypeError("Unknown encoding: "+Ae);if(k.length===1){const Re=k.charCodeAt(0);(Ae==="utf8"&&Re<128||Ae==="latin1")&&(k=Re)}}else typeof k=="number"?k&=255:typeof k=="boolean"&&(k=Number(k));if(j<0||this.length<j||this.length<J)throw new RangeError("Out of range index");if(J<=j)return this;let ye;if(j>>>=0,J=J===void 0?this.length:J>>>0,k||(k=0),typeof k=="number")for(ye=j;ye<J;++ye)this[ye]=k;else{const Re=_.isBuffer(k)?k:_.from(k,Ae),rt=Re.length;if(rt===0)throw new TypeError('The value "'+k+'" is invalid for argument "value"');for(ye=0;ye<J-j;++ye)this[ye+j]=Re[ye%rt]}return this};const Ce={};function Qe(k,j,J){Ce[k]=class extends J{constructor(){super(),Object.defineProperty(this,"message",{value:j.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${k}]`,this.stack,delete this.name}get code(){return k}set code(Ae){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Ae,writable:!0})}toString(){return`${this.name} [${k}]: ${this.message}`}}}function Pe(k){let j="",J=k.length;const Ae=k[0]==="-"?1:0;for(;J>=Ae+4;J-=3)j=`_${k.slice(J-3,J)}${j}`;return`${k.slice(0,J)}${j}`}function je(k,j,J,Ae,ye,Re){if(k>J||k<j){const rt=typeof j=="bigint"?"n":"";let _t;throw _t=Re>3?j===0||j===BigInt(0)?`>= 0${rt} and < 2${rt} ** ${8*(Re+1)}${rt}`:`>= -(2${rt} ** ${8*(Re+1)-1}${rt}) and < 2 ** ${8*(Re+1)-1}${rt}`:`>= ${j}${rt} and <= ${J}${rt}`,new Ce.ERR_OUT_OF_RANGE("value",_t,k)}(function(rt,_t,kt){pe(_t,"offset"),rt[_t]!==void 0&&rt[_t+kt]!==void 0||Ve(_t,rt.length-(kt+1))})(Ae,ye,Re)}function pe(k,j){if(typeof k!="number")throw new Ce.ERR_INVALID_ARG_TYPE(j,"number",k)}function Ve(k,j,J){throw Math.floor(k)!==k?(pe(k,J),new Ce.ERR_OUT_OF_RANGE(J||"offset","an integer",k)):j<0?new Ce.ERR_BUFFER_OUT_OF_BOUNDS:new Ce.ERR_OUT_OF_RANGE(J||"offset",`>= ${J?1:0} and <= ${j}`,k)}Qe("ERR_BUFFER_OUT_OF_BOUNDS",function(k){return k?`${k} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Qe("ERR_INVALID_ARG_TYPE",function(k,j){return`The "${k}" argument must be of type number. Received type ${typeof j}`},TypeError),Qe("ERR_OUT_OF_RANGE",function(k,j,J){let Ae=`The value of "${k}" is out of range.`,ye=J;return Number.isInteger(J)&&Math.abs(J)>4294967296?ye=Pe(String(J)):typeof J=="bigint"&&(ye=String(J),(J>BigInt(2)**BigInt(32)||J<-(BigInt(2)**BigInt(32)))&&(ye=Pe(ye)),ye+="n"),Ae+=` It must be ${j}. Received ${ye}`,Ae},RangeError);const Ye=/[^+/0-9A-Za-z-_]/g;function Ct(k,j){let J;j=j||1/0;const Ae=k.length;let ye=null;const Re=[];for(let rt=0;rt<Ae;++rt){if(J=k.charCodeAt(rt),J>55295&&J<57344){if(!ye){if(J>56319){(j-=3)>-1&&Re.push(239,191,189);continue}if(rt+1===Ae){(j-=3)>-1&&Re.push(239,191,189);continue}ye=J;continue}if(J<56320){(j-=3)>-1&&Re.push(239,191,189),ye=J;continue}J=65536+(ye-55296<<10|J-56320)}else ye&&(j-=3)>-1&&Re.push(239,191,189);if(ye=null,J<128){if((j-=1)<0)break;Re.push(J)}else if(J<2048){if((j-=2)<0)break;Re.push(J>>6|192,63&J|128)}else if(J<65536){if((j-=3)<0)break;Re.push(J>>12|224,J>>6&63|128,63&J|128)}else{if(!(J<1114112))throw new Error("Invalid code point");if((j-=4)<0)break;Re.push(J>>18|240,J>>12&63|128,J>>6&63|128,63&J|128)}}return Re}function Ke(k){return f.toByteArray(function(j){if((j=(j=j.split("=")[0]).trim().replace(Ye,"")).length<2)return"";for(;j.length%4!=0;)j+="=";return j}(k))}function yt(k,j,J,Ae){let ye;for(ye=0;ye<Ae&&!(ye+J>=j.length||ye>=k.length);++ye)j[ye+J]=k[ye];return ye}function bt(k,j){return k instanceof j||k!=null&&k.constructor!=null&&k.constructor.name!=null&&k.constructor.name===j.name}function ht(k){return k!=k}const Vt=function(){const k="0123456789abcdef",j=new Array(256);for(let J=0;J<16;++J){const Ae=16*J;for(let ye=0;ye<16;++ye)j[Ae+ye]=k[J]+k[ye]}return j}();function Nt(k){return typeof BigInt>"u"?nn:k}function nn(){throw new Error("BigInt not supported")}},9089:l=>{"use strict";l.exports=function(h){var d=[];return d.toString=function(){return this.map(function(f){var g="",y=f[5]!==void 0;return f[4]&&(g+="@supports (".concat(f[4],") {")),f[2]&&(g+="@media ".concat(f[2]," {")),y&&(g+="@layer".concat(f[5].length>0?" ".concat(f[5]):""," {")),g+=h(f),y&&(g+="}"),f[2]&&(g+="}"),f[4]&&(g+="}"),g}).join("")},d.i=function(f,g,y,x,b){typeof f=="string"&&(f=[[null,f,void 0]]);var _={};if(y)for(var w=0;w<this.length;w++){var T=this[w][0];T!=null&&(_[T]=!0)}for(var P=0;P<f.length;P++){var U=[].concat(f[P]);y&&_[U[0]]||(b!==void 0&&(U[5]===void 0||(U[1]="@layer".concat(U[5].length>0?" ".concat(U[5]):""," {").concat(U[1],"}")),U[5]=b),g&&(U[2]&&(U[1]="@media ".concat(U[2]," {").concat(U[1],"}")),U[2]=g),x&&(U[4]?(U[1]="@supports (".concat(U[4],") {").concat(U[1],"}"),U[4]=x):U[4]="".concat(x)),d.push(U))}},d}},6492:l=>{"use strict";l.exports=function(h,d){return d||(d={}),h&&(h=String(h.__esModule?h.default:h),/^['"].*['"]$/.test(h)&&(h=h.slice(1,-1)),d.hash&&(h+=d.hash),/["'() \t\n]|(%20)/.test(h)||d.needQuotes?'"'.concat(h.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):h)}},963:l=>{"use strict";l.exports=function(h){var d=h[1],f=h[3];if(!f)return d;if(typeof btoa=="function"){var g=btoa(unescape(encodeURIComponent(JSON.stringify(f)))),y="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(g),x="/*# ".concat(y," */");return[d].concat([x]).join(`
`)}return[d].join(`
`)}},8878:(l,h,d)=>{h.formatArgs=function(g){if(g[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+g[0]+(this.useColors?"%c ":" ")+"+"+l.exports.humanize(this.diff),!this.useColors)return;const y="color: "+this.color;g.splice(1,0,y,"color: inherit");let x=0,b=0;g[0].replace(/%[a-zA-Z%]/g,_=>{_!=="%%"&&(x++,_==="%c"&&(b=x))}),g.splice(b,0,y)},h.save=function(g){try{g?h.storage.setItem("debug",g):h.storage.removeItem("debug")}catch{}},h.load=function(){let g;try{g=h.storage.getItem("debug")}catch{}return!g&&typeof process<"u"&&"env"in process&&(g=process.env.DEBUG),g},h.useColors=function(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let g;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(g=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(g[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},h.storage=function(){try{return localStorage}catch{}}(),h.destroy=(()=>{let g=!1;return()=>{g||(g=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),h.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],h.log=console.debug||console.log||(()=>{}),l.exports=d(8945)(h);const{formatters:f}=l.exports;f.j=function(g){try{return JSON.stringify(g)}catch(y){return"[UnexpectedJSONParseError]: "+y.message}}},8945:(l,h,d)=>{l.exports=function(f){function g(b){let _,w,T,P=null;function U(...D){if(!U.enabled)return;const z=U,G=Number(new Date),Q=G-(_||G);z.diff=Q,z.prev=_,z.curr=G,_=G,D[0]=g.coerce(D[0]),typeof D[0]!="string"&&D.unshift("%O");let Y=0;D[0]=D[0].replace(/%([a-zA-Z%])/g,(q,K)=>{if(q==="%%")return"%";Y++;const ne=g.formatters[K];if(typeof ne=="function"){const le=D[Y];q=ne.call(z,le),D.splice(Y,1),Y--}return q}),g.formatArgs.call(z,D),(z.log||g.log).apply(z,D)}return U.namespace=b,U.useColors=g.useColors(),U.color=g.selectColor(b),U.extend=y,U.destroy=g.destroy,Object.defineProperty(U,"enabled",{enumerable:!0,configurable:!1,get:()=>P!==null?P:(w!==g.namespaces&&(w=g.namespaces,T=g.enabled(b)),T),set:D=>{P=D}}),typeof g.init=="function"&&g.init(U),U}function y(b,_){const w=g(this.namespace+(_===void 0?":":_)+b);return w.log=this.log,w}function x(b){return b.toString().substring(2,b.toString().length-2).replace(/\.\*\?$/,"*")}return g.debug=g,g.default=g,g.coerce=function(b){return b instanceof Error?b.stack||b.message:b},g.disable=function(){const b=[...g.names.map(x),...g.skips.map(x).map(_=>"-"+_)].join(",");return g.enable(""),b},g.enable=function(b){let _;g.save(b),g.namespaces=b,g.names=[],g.skips=[];const w=(typeof b=="string"?b:"").split(/[\s,]+/),T=w.length;for(_=0;_<T;_++)w[_]&&((b=w[_].replace(/\*/g,".*?"))[0]==="-"?g.skips.push(new RegExp("^"+b.slice(1)+"$")):g.names.push(new RegExp("^"+b+"$")))},g.enabled=function(b){if(b[b.length-1]==="*")return!0;let _,w;for(_=0,w=g.skips.length;_<w;_++)if(g.skips[_].test(b))return!1;for(_=0,w=g.names.length;_<w;_++)if(g.names[_].test(b))return!0;return!1},g.humanize=d(9192),g.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(f).forEach(b=>{g[b]=f[b]}),g.names=[],g.skips=[],g.formatters={},g.selectColor=function(b){let _=0;for(let w=0;w<b.length;w++)_=(_<<5)-_+b.charCodeAt(w),_|=0;return g.colors[Math.abs(_)%g.colors.length]},g.enable(g.load()),g}},1124:(l,h,d)=>{"use strict";var f=d(6240),g=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;function x(_,w,T){var P=w[T];if(P!=null){if(g.call(_,T)&&(_[T]===void 0||_[T]===null))throw new TypeError("Cannot convert undefined or null to object ("+T+")");g.call(_,T)&&f(P)?_[T]=b(Object(_[T]),w[T]):_[T]=P}}function b(_,w){if(_===w)return _;for(var T in w=Object(w))g.call(w,T)&&x(_,w,T);if(Object.getOwnPropertySymbols)for(var P=Object.getOwnPropertySymbols(w),U=0;U<P.length;U++)y.call(w,P[U])&&x(_,w,P[U]);return _}l.exports=function(_){_=function(T){if(T==null)throw new TypeError("Sources cannot be null or undefined");return Object(T)}(_);for(var w=1;w<arguments.length;w++)b(_,arguments[w]);return _}},8480:l=>{l.exports=function(h){switch(h){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},919:(l,h,d)=>{var f;f=typeof window<"u"?window:d.g!==void 0?d.g:typeof self<"u"?self:{},l.exports=f},1024:(l,h)=>{h.read=function(d,f,g,y,x){var b,_,w=8*x-y-1,T=(1<<w)-1,P=T>>1,U=-7,D=g?x-1:0,z=g?-1:1,G=d[f+D];for(D+=z,b=G&(1<<-U)-1,G>>=-U,U+=w;U>0;b=256*b+d[f+D],D+=z,U-=8);for(_=b&(1<<-U)-1,b>>=-U,U+=y;U>0;_=256*_+d[f+D],D+=z,U-=8);if(b===0)b=1-P;else{if(b===T)return _?NaN:1/0*(G?-1:1);_+=Math.pow(2,y),b-=P}return(G?-1:1)*_*Math.pow(2,b-y)},h.write=function(d,f,g,y,x,b){var _,w,T,P=8*b-x-1,U=(1<<P)-1,D=U>>1,z=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=y?0:b-1,Q=y?1:-1,Y=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(w=isNaN(f)?1:0,_=U):(_=Math.floor(Math.log(f)/Math.LN2),f*(T=Math.pow(2,-_))<1&&(_--,T*=2),(f+=_+D>=1?z/T:z*Math.pow(2,1-D))*T>=2&&(_++,T/=2),_+D>=U?(w=0,_=U):_+D>=1?(w=(f*T-1)*Math.pow(2,x),_+=D):(w=f*Math.pow(2,D-1)*Math.pow(2,x),_=0));x>=8;d[g+G]=255&w,G+=Q,w/=256,x-=8);for(_=_<<x|w,P+=x;P>0;d[g+G]=255&_,G+=Q,_/=256,P-=8);d[g+G-Q]|=128*Y}},2225:l=>{function h(d){return!!d.constructor&&typeof d.constructor.isBuffer=="function"&&d.constructor.isBuffer(d)}l.exports=function(d){return d!=null&&(h(d)||function(f){return typeof f.readFloatLE=="function"&&typeof f.slice=="function"&&h(f.slice(0,0))}(d)||!!d._isBuffer)}},8847:l=>{l.exports=function(d){if(!d)return!1;var f=h.call(d);return f==="[object Function]"||typeof d=="function"&&f!=="[object RegExp]"||typeof window<"u"&&(d===window.setTimeout||d===window.alert||d===window.confirm||d===window.prompt)};var h=Object.prototype.toString},6240:l=>{"use strict";l.exports=function(h){var d=typeof h;return h!==null&&(d==="object"||d==="function")}},5651:(l,h,d)=>{var f=d(5406),g=d(4597),y=d(5734),x=["x","e","a","o","n","s","r","c","u","m","v","w","z"],b=["m","w"],_=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],w=9,T=32;function P(Q){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(Q)}function U(Q){return new Function(["return function "+Q+"() {","  return this._"+Q,"}"].join(`
`))()}function D(Q,Y){if(!Q.chars||Q.chars.length===0)return null;var q=G(Q.chars,Y);return q>=0?Q.chars[q]:null}function z(Q,Y,q){if(!Q.kernings||Q.kernings.length===0)return 0;for(var K=Q.kernings,ne=0;ne<K.length;ne++){var le=K[ne];if(le.first===Y&&le.second===q)return le.amount}return 0}function G(Q,Y,q){for(var K=q=q||0;K<Q.length;K++)if(Q[K].id===Y)return K;return-1}l.exports=function(Q){return new P(Q)},P.prototype.update=function(Q){if(Q=g({measure:this._measure},Q),this._opt=Q,this._opt.tabSize=y(this._opt.tabSize,4),!Q.font)throw new Error("must provide a valid bitmap font");var Y=this.glyphs,q=Q.text||"",K=Q.font;this._setupSpaceGlyphs(K);var ne=f.lines(q,Q),le=Q.width||0;Y.length=0;var fe=ne.reduce(function(ft,ze){return Math.max(ft,ze.width,le)},0),be=0,de=0,Fe=y(Q.lineHeight,K.common.lineHeight),we=K.common.base,Me=Fe-we,_e=Q.letterSpacing||0,tt=Fe*ne.length-Me,me=function(ft){return ft==="center"?1:ft==="right"?2:0}(this._opt.align);de-=tt,this._width=fe,this._height=tt,this._descender=Fe-we,this._baseline=we,this._xHeight=function(ft){for(var ze=0;ze<x.length;ze++){var $e=x[ze].charCodeAt(0),pt=G(ft.chars,$e);if(pt>=0)return ft.chars[pt].height}return 0}(K),this._capHeight=function(ft){for(var ze=0;ze<_.length;ze++){var $e=_[ze].charCodeAt(0),pt=G(ft.chars,$e);if(pt>=0)return ft.chars[pt].height}return 0}(K),this._lineHeight=Fe,this._ascender=Fe-Me-this._xHeight;var wt=this;ne.forEach(function(ft,ze){for(var $e,pt=ft.start,lt=ft.end,he=ft.width,Z=pt;Z<lt;Z++){var Ce=q.charCodeAt(Z),Qe=wt.getGlyph(K,Ce);if(Qe){$e&&(be+=z(K,$e.id,Qe.id));var Pe=be;me===1?Pe+=(fe-he)/2:me===2&&(Pe+=fe-he),Y.push({position:[Pe,de],data:Qe,index:Z,line:ze}),be+=Qe.xadvance+_e,$e=Qe}}de+=Fe,be=0}),this._linesTotal=ne.length},P.prototype._setupSpaceGlyphs=function(Q){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,Q.chars&&Q.chars.length!==0){var Y=D(Q,T)||function(K){for(var ne=0;ne<b.length;ne++){var le=b[ne].charCodeAt(0),fe=G(K.chars,le);if(fe>=0)return K.chars[fe]}return 0}(Q)||Q.chars[0],q=this._opt.tabSize*Y.xadvance;this._fallbackSpaceGlyph=Y,this._fallbackTabGlyph=g(Y,{x:0,y:0,xadvance:q,id:w,xoffset:0,yoffset:0,width:0,height:0})}},P.prototype.getGlyph=function(Q,Y){return D(Q,Y)||(Y===w?this._fallbackTabGlyph:Y===T?this._fallbackSpaceGlyph:null)},P.prototype.computeMetrics=function(Q,Y,q,K){var ne,le=this._opt.letterSpacing||0,fe=this._opt.font,be=0,de=0,Fe=0;if(!fe.chars||fe.chars.length===0)return{start:Y,end:Y,width:0};q=Math.min(Q.length,q);for(var we=Y;we<q;we++){var Me,_e=Q.charCodeAt(we);if(Me=this.getGlyph(fe,_e)){Me.xoffset;var tt=(be+=ne?z(fe,ne.id,Me.id):0)+Me.xadvance+le,me=be+Me.width;if(me>=K||tt>=K)break;be=tt,de=me,ne=Me}Fe++}return ne&&(de+=ne.xoffset),{start:Y,end:Y+Fe,width:de}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(Q){Object.defineProperty(P.prototype,Q,{get:U(Q),configurable:!0})})},5751:(l,h,d)=>{var f=d(9922).hp,g=d(3558),y=function(){},x=d(1476),b=d(7034),_=d(7480),w=d(573),T=d(4597),P=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;l.exports=function(U,D){D=typeof D=="function"?D:y,typeof U=="string"?U={uri:U}:U||(U={}),U.binary&&(U=function(z){if(P)return T(z,{responseType:"arraybuffer"});if(self.XMLHttpRequest===void 0)throw new Error("your browser does not support XHR loading");var G=new self.XMLHttpRequest;return G.overrideMimeType("text/plain; charset=x-user-defined"),T({xhr:G},z)}(U)),g(U,function(z,G,Q){if(z)return D(z);if(!/^2/.test(G.statusCode))return D(new Error("http status code: "+G.statusCode));if(!Q)return D(new Error("no body result"));var Y,q,K=!1;if(Y=Q,Object.prototype.toString.call(Y)==="[object ArrayBuffer]"){var ne=new Uint8Array(Q);Q=f.from(ne,"binary")}w(Q)&&(K=!0,typeof Q=="string"&&(Q=f.from(Q,"binary"))),K||(f.isBuffer(Q)&&(Q=Q.toString(U.encoding)),Q=Q.trim());try{var le=G.headers["content-type"];q=K?_(Q):/json/.test(le)||Q.charAt(0)==="{"?JSON.parse(Q):/xml/.test(le)||Q.charAt(0)==="<"?b(Q):x(Q)}catch(fe){D(new Error("error parsing font "+fe.message)),D=y}D(null,q)})}},573:(l,h,d)=>{var f=d(9922).hp,g=d(911),y=f.from([66,77,70,3]);l.exports=function(x){return typeof x=="string"?x.substring(0,3)==="BMF":x.length>4&&g(x.slice(0,4),y)}},9192:l=>{var h=1e3,d=60*h,f=60*d,g=24*f,y=7*g;function x(b,_,w,T){var P=_>=1.5*w;return Math.round(b/w)+" "+T+(P?"s":"")}l.exports=function(b,_){_=_||{};var w,T,P=typeof b;if(P==="string"&&b.length>0)return function(U){if(!((U=String(U)).length>100)){var D=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(U);if(D){var z=parseFloat(D[1]);switch((D[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*z;case"weeks":case"week":case"w":return z*y;case"days":case"day":case"d":return z*g;case"hours":case"hour":case"hrs":case"hr":case"h":return z*f;case"minutes":case"minute":case"mins":case"min":case"m":return z*d;case"seconds":case"second":case"secs":case"sec":case"s":return z*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return z;default:return}}}}(b);if(P==="number"&&isFinite(b))return _.long?(w=b,(T=Math.abs(w))>=g?x(w,T,g,"day"):T>=f?x(w,T,f,"hour"):T>=d?x(w,T,d,"minute"):T>=h?x(w,T,h,"second"):w+" ms"):function(U){var D=Math.abs(U);return D>=g?Math.round(U/g)+"d":D>=f?Math.round(U/f)+"h":D>=d?Math.round(U/d)+"m":D>=h?Math.round(U/h)+"s":U+"ms"}(b);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(b))}},1476:l=>{function h(f,g){if(!(f=f.replace(/\t+/g," ").trim()))return null;var y=f.indexOf(" ");if(y===-1)throw new Error("no named row at line "+g);var x=f.substring(0,y);f=(f=(f=(f=f.substring(y+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(P){return P.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var b=[],_=0;_<f.length;_++){var w=f[_];_===0?b.push({key:w[0],data:""}):_===f.length-1?b[b.length-1].data=d(w[0]):(b[b.length-1].data=d(w[0]),b.push({key:w[1],data:""}))}var T={key:x,data:{}};return b.forEach(function(P){T.data[P.key]=P.data}),T}function d(f){return f&&f.length!==0?f.indexOf('"')===0||f.indexOf("'")===0?f.substring(1,f.length-1):f.indexOf(",")!==-1?function(g){return g.split(",").map(function(y){return parseInt(y,10)})}(f):parseInt(f,10):""}l.exports=function(f){if(!f)throw new Error("no data provided");var g={pages:[],chars:[],kernings:[]},y=(f=f.toString().trim()).split(/\r\n?|\n/g);if(y.length===0)throw new Error("no data in BMFont file");for(var x=0;x<y.length;x++){var b=h(y[x],x);if(b)if(b.key==="page"){if(typeof b.data.id!="number")throw new Error("malformed file at line "+x+" -- needs page id=N");if(typeof b.data.file!="string")throw new Error("malformed file at line "+x+' -- needs page file="path"');g.pages[b.data.id]=b.data.file}else b.key==="chars"||b.key==="kernings"||(b.key==="char"?g.chars.push(b.data):b.key==="kerning"?g.kernings.push(b.data):g[b.key]=b.data)}return g}},7480:l=>{var h=[66,77,70];function d(g,y,x){if(x>y.length-1)return 0;var b=y.readUInt8(x++),_=y.readInt32LE(x);switch(x+=4,b){case 1:g.info=function(w,T){var P={};P.size=w.readInt16LE(T);var U=w.readUInt8(T+2);return P.smooth=U>>7&1,P.unicode=U>>6&1,P.italic=U>>5&1,P.bold=U>>4&1,U>>3&1&&(P.fixedHeight=1),P.charset=w.readUInt8(T+3)||"",P.stretchH=w.readUInt16LE(T+4),P.aa=w.readUInt8(T+6),P.padding=[w.readInt8(T+7),w.readInt8(T+8),w.readInt8(T+9),w.readInt8(T+10)],P.spacing=[w.readInt8(T+11),w.readInt8(T+12)],P.outline=w.readUInt8(T+13),P.face=function(D,z){return f(D,z).toString("utf8")}(w,T+14),P}(y,x);break;case 2:g.common=function(w,T){var P={};return P.lineHeight=w.readUInt16LE(T),P.base=w.readUInt16LE(T+2),P.scaleW=w.readUInt16LE(T+4),P.scaleH=w.readUInt16LE(T+6),P.pages=w.readUInt16LE(T+8),w.readUInt8(T+10),P.packed=0,P.alphaChnl=w.readUInt8(T+11),P.redChnl=w.readUInt8(T+12),P.greenChnl=w.readUInt8(T+13),P.blueChnl=w.readUInt8(T+14),P}(y,x);break;case 3:g.pages=function(w,T,P){for(var U=[],D=f(w,T),z=D.length+1,G=P/z,Q=0;Q<G;Q++)U[Q]=w.slice(T,T+D.length).toString("utf8"),T+=z;return U}(y,x,_);break;case 4:g.chars=function(w,T,P){for(var U=[],D=P/20,z=0;z<D;z++){var G={},Q=20*z;G.id=w.readUInt32LE(T+0+Q),G.x=w.readUInt16LE(T+4+Q),G.y=w.readUInt16LE(T+6+Q),G.width=w.readUInt16LE(T+8+Q),G.height=w.readUInt16LE(T+10+Q),G.xoffset=w.readInt16LE(T+12+Q),G.yoffset=w.readInt16LE(T+14+Q),G.xadvance=w.readInt16LE(T+16+Q),G.page=w.readUInt8(T+18+Q),G.chnl=w.readUInt8(T+19+Q),U[z]=G}return U}(y,x,_);break;case 5:g.kernings=function(w,T,P){for(var U=[],D=P/10,z=0;z<D;z++){var G={},Q=10*z;G.first=w.readUInt32LE(T+0+Q),G.second=w.readUInt32LE(T+4+Q),G.amount=w.readInt16LE(T+8+Q),U[z]=G}return U}(y,x,_)}return 5+_}function f(g,y){for(var x=y;x<g.length&&g[x]!==0;x++);return g.slice(y,x)}l.exports=function(g){if(g.length<6)throw new Error("invalid buffer length for BMFont");var y=h.every(function(w,T){return g.readUInt8(T)===w});if(!y)throw new Error("BMFont missing BMF byte header");var x=3;if(g.readUInt8(x++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var b={kernings:[],chars:[]},_=0;_<5;_++)x+=d(b,g,x);return b}},7034:(l,h,d)=>{var f=d(7829),g=d(1896),y={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function x(b){var _=function(w){for(var T=[],P=0;P<w.attributes.length;P++)T.push(w.attributes[P]);return T}(b);return _.reduce(function(w,T){var P;return w[P=T.nodeName,y[P.toLowerCase()]||P]=T.nodeValue,w},{})}l.exports=function(b){b=b.toString();var _=g(b),w={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(Q){var Y=_.getElementsByTagName(Q)[0];Y&&(w[Q]=f(x(Y)))});var T=_.getElementsByTagName("pages")[0];if(!T)throw new Error("malformed file -- no <pages> element");for(var P=T.getElementsByTagName("page"),U=0;U<P.length;U++){var D=P[U],z=parseInt(D.getAttribute("id"),10),G=D.getAttribute("file");if(isNaN(z))throw new Error('malformed file -- page "id" attribute is NaN');if(!G)throw new Error('malformed file -- needs page "file" attribute');w.pages[parseInt(z,10)]=G}return["chars","kernings"].forEach(function(Q){var Y=_.getElementsByTagName(Q)[0];if(Y)for(var q=Q.substring(0,Q.length-1),K=Y.getElementsByTagName(q),ne=0;ne<K.length;ne++){var le=K[ne];w[Q].push(f(x(le)))}}),w}},7829:l=>{var h="chasrset";l.exports=function(d){for(var f in d=Object.assign({},d),h in d&&(d.charset=d[h],delete d[h]),d)f!=="face"&&f!=="charset"&&(d[f]=f==="padding"||f==="spacing"?d[f].split(",").map(function(g){return parseInt(g,10)}):parseInt(d[f],10));return d}},3216:l=>{var h=function(d){return d.replace(/^\s+|\s+$/g,"")};l.exports=function(d){if(!d)return{};for(var f,g={},y=h(d).split(`
`),x=0;x<y.length;x++){var b=y[x],_=b.indexOf(":"),w=h(b.slice(0,_)).toLowerCase(),T=h(b.slice(_+1));g[w]===void 0?g[w]=T:(f=g[w],Object.prototype.toString.call(f)==="[object Array]"?g[w].push(T):g[w]=[g[w],T])}return g}},9035:(l,h,d)=>{var f=d(8480),g=d(8167),y=d(2225),x=[0,2,3],b=[2,1,3];l.exports=function(_,w){_&&(g(_)||y(_))||(w=_||{},_=null);for(var T=typeof(w=typeof w=="number"?{count:w}:w||{}).type=="string"?w.type:"uint16",P=typeof w.count=="number"?w.count:1,U=w.start||0,D=w.clockwise!==!1?x:b,z=D[0],G=D[1],Q=D[2],Y=6*P,q=_||new(f(T))(Y),K=0,ne=0;K<Y;K+=6,ne+=4){var le=K+U;q[le+0]=ne+0,q[le+1]=ne+1,q[le+2]=ne+2,q[le+3]=ne+z,q[le+4]=ne+G,q[le+5]=ne+Q}return q}},4433:(l,h,d)=>{var f=d(5651),g=d(9035),y=d(7106),x=d(1684);l.exports=function(_){return new b(_)};class b extends THREE.BufferGeometry{constructor(w){super(),typeof w=="string"&&(w={text:w}),this._opt=Object.assign({},w),w&&this.update(w)}update(w){if(typeof w=="string"&&(w={text:w}),!(w=Object.assign({},this._opt,w)).font)throw new TypeError("must specify a { font } in options");this.layout=f(w);var T=w.flipY!==!1,P=w.font,U=P.common.scaleW,D=P.common.scaleH,z=this.layout.glyphs.filter(function(K){var ne=K.data;return ne.width*ne.height>0});this.visibleGlyphs=z;var G=y.positions(z),Q=y.uvs(z,U,D,T),Y=g([],{clockwise:!0,type:"uint16",count:z.length});if(this.setIndex(Y),this.setAttribute("position",new THREE.BufferAttribute(G,2)),this.setAttribute("uv",new THREE.BufferAttribute(Q,2)),!w.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(w.multipage){var q=y.pages(z);this.setAttribute("page",new THREE.BufferAttribute(q,1))}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere()}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var w=this.attributes.position.array,T=this.attributes.position.itemSize;if(!w||!T||w.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);x.computeSphere(w,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var w=this.boundingBox,T=this.attributes.position.array,P=this.attributes.position.itemSize;!T||!P||T.length<2?w.makeEmpty():x.computeBox(T,w)}}},1684:l=>{var h={min:[0,0],max:[0,0]};function d(f){var g=f.length/2;h.min[0]=f[0],h.min[1]=f[1],h.max[0]=f[0],h.max[1]=f[1];for(var y=0;y<g;y++){var x=f[2*y+0],b=f[2*y+1];h.min[0]=Math.min(x,h.min[0]),h.min[1]=Math.min(b,h.min[1]),h.max[0]=Math.max(x,h.max[0]),h.max[1]=Math.max(b,h.max[1])}}l.exports.computeBox=function(f,g){d(f),g.min.set(h.min[0],h.min[1],0),g.max.set(h.max[0],h.max[1],0)},l.exports.computeSphere=function(f,g){d(f);var y=h.min[0],x=h.min[1],b=h.max[0]-y,_=h.max[1]-x,w=Math.sqrt(b*b+_*_);g.center.set(y+b/2,x+_/2,0),g.radius=w/2}},7106:l=>{l.exports.pages=function(h){var d=new Float32Array(4*h.length*1),f=0;return h.forEach(function(g){var y=g.data.page||0;d[f++]=y,d[f++]=y,d[f++]=y,d[f++]=y}),d},l.exports.uvs=function(h,d,f,g){var y=new Float32Array(4*h.length*2),x=0;return h.forEach(function(b){var _=b.data,w=_.x+_.width,T=_.y+_.height,P=_.x/d,U=_.y/f,D=w/d,z=T/f;g&&(U=(f-_.y)/f,z=(f-T)/f),y[x++]=P,y[x++]=U,y[x++]=P,y[x++]=z,y[x++]=D,y[x++]=z,y[x++]=D,y[x++]=U}),y},l.exports.positions=function(h){var d=new Float32Array(4*h.length*2),f=0;return h.forEach(function(g){var y=g.data,x=g.position[0]+y.xoffset,b=g.position[1]+y.yoffset,_=y.width,w=y.height;d[f++]=x,d[f++]=b,d[f++]=x,d[f++]=b+w,d[f++]=x+_,d[f++]=b+w,d[f++]=x+_,d[f++]=b}),d}},5406:l=>{var h=/\n/,d=/\s/;function f(x,b,_,w){var T=x.indexOf(b,_);return T===-1||T>w?w:T}function g(x){return d.test(x)}function y(x,b,_,w){return{start:b,end:b+Math.min(w,_-b)}}l.exports=function(x,b){return l.exports.lines(x,b).map(function(_){return x.substring(_.start,_.end)}).join(`
`)},l.exports.lines=function(x,b){if((b=b||{}).width===0&&b.mode!=="nowrap")return[];x=x||"";var _=typeof b.width=="number"?b.width:Number.MAX_VALUE,w=Math.max(0,b.start||0),T=typeof b.end=="number"?b.end:x.length,P=b.mode,U=b.measure||y;return P==="pre"?function(D,z,G,Q,Y){for(var q=[],K=G,ne=G;ne<Q&&ne<z.length;ne++){var le=z.charAt(ne),fe=h.test(le);if(fe||ne===Q-1){var be=D(z,K,fe?ne:ne+1,Y);q.push(be),K=ne+1}}return q}(U,x,w,T,_):function(D,z,G,Q,Y,q){var K=[],ne=Y;for(q==="nowrap"&&(ne=Number.MAX_VALUE);G<Q&&G<z.length;){for(var le=f(z,`
`,G,Q);G<le&&g(z.charAt(G));)G++;var fe=D(z,G,le,ne),be=G+(fe.end-fe.start),de=be+1;if(be<le){for(;be>G&&!g(z.charAt(be));)be--;if(be===G)de>G+1&&de--,be=de;else for(de=be;be>G&&g(z.charAt(be-1));)be--}if(be>=G){var Fe=D(z,G,be,ne);K.push(Fe)}G=de}return K}(U,x,w,T,_,P)}},3558:(l,h,d)=>{"use strict";var f=d(919),g=d(8847),y=d(3216),x=d(4597);function b(T,P,U){var D=T;return g(P)?(U=P,typeof T=="string"&&(D={uri:T})):D=x(P,{uri:T}),D.callback=U,D}function _(T,P,U){return w(P=b(T,P,U))}function w(T){if(T.callback===void 0)throw new Error("callback argument missing");var P=!1,U=function(Me,_e,tt){P||(P=!0,T.callback(Me,_e,tt))};function D(){var Me=void 0;if(Me=q.response?q.response:q.responseText||function(_e){try{if(_e.responseType==="document")return _e.responseXML;var tt=_e.responseXML&&_e.responseXML.documentElement.nodeName==="parsererror";if(_e.responseType===""&&!tt)return _e.responseXML}catch{}return null}(q),Fe)try{Me=JSON.parse(Me)}catch{}return Me}function z(Me){return clearTimeout(K),Me instanceof Error||(Me=new Error(""+(Me||"Unknown XMLHttpRequest Error"))),Me.statusCode=0,U(Me,we)}function G(){if(!Y){var Me;clearTimeout(K),Me=T.useXDR&&q.status===void 0?200:q.status===1223?204:q.status;var _e=we,tt=null;return Me!==0?(_e={body:D(),statusCode:Me,method:le,headers:{},url:ne,rawRequest:q},q.getAllResponseHeaders&&(_e.headers=y(q.getAllResponseHeaders()))):tt=new Error("Internal XMLHttpRequest Error"),U(tt,_e,_e.body)}}var Q,Y,q=T.xhr||null;q||(q=T.cors||T.useXDR?new _.XDomainRequest:new _.XMLHttpRequest);var K,ne=q.url=T.uri||T.url,le=q.method=T.method||"GET",fe=T.body||T.data,be=q.headers=T.headers||{},de=!!T.sync,Fe=!1,we={body:void 0,headers:{},statusCode:0,method:le,url:ne,rawRequest:q};if("json"in T&&T.json!==!1&&(Fe=!0,be.accept||be.Accept||(be.Accept="application/json"),le!=="GET"&&le!=="HEAD"&&(be["content-type"]||be["Content-Type"]||(be["Content-Type"]="application/json"),fe=JSON.stringify(T.json===!0?fe:T.json))),q.onreadystatechange=function(){q.readyState===4&&setTimeout(G,0)},q.onload=G,q.onerror=z,q.onprogress=function(){},q.onabort=function(){Y=!0},q.ontimeout=z,q.open(le,ne,!de,T.username,T.password),de||(q.withCredentials=!!T.withCredentials),!de&&T.timeout>0&&(K=setTimeout(function(){if(!Y){Y=!0,q.abort("timeout");var Me=new Error("XMLHttpRequest timeout");Me.code="ETIMEDOUT",z(Me)}},T.timeout)),q.setRequestHeader)for(Q in be)be.hasOwnProperty(Q)&&q.setRequestHeader(Q,be[Q]);else if(T.headers&&!function(Me){for(var _e in Me)if(Me.hasOwnProperty(_e))return!1;return!0}(T.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in T&&(q.responseType=T.responseType),"beforeSend"in T&&typeof T.beforeSend=="function"&&T.beforeSend(q),q.send(fe||null),q}l.exports=_,l.exports.default=_,_.XMLHttpRequest=f.XMLHttpRequest||function(){},_.XDomainRequest="withCredentials"in new _.XMLHttpRequest?_.XMLHttpRequest:f.XDomainRequest,function(T,P){for(var U=0;U<T.length;U++)P(T[U])}(["get","put","post","patch","head","delete"],function(T){_[T==="delete"?"del":T]=function(P,U,D){return(U=b(P,U,D)).method=T.toUpperCase(),w(U)}})},1896:l=>{l.exports=self.DOMParser!==void 0?function(h){return new self.DOMParser().parseFromString(h,"application/xml")}:self.ActiveXObject!==void 0&&new self.ActiveXObject("Microsoft.XMLDOM")?function(h){var d=new self.ActiveXObject("Microsoft.XMLDOM");return d.async="false",d.loadXML(h),d}:function(h){var d=document.createElement("div");return d.innerHTML=h,d}},4597:l=>{l.exports=function(){for(var d={},f=0;f<arguments.length;f++){var g=arguments[f];for(var y in g)h.call(g,y)&&(d[y]=g[y])}return d};var h=Object.prototype.hasOwnProperty},8132:()=>{window.aframeStats=function(l){var h=null,d=l;return{update:function(){var f;h("te").set((f=d.querySelectorAll("*"),Array.prototype.slice.call(f).filter(function(g){return g.isEntity}),f.length)),window.performance.getEntriesByName&&h("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function(){},end:function(){},attach:function(f){h=f},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}}},3729:l=>{window.glStats=function(){var h=null,d=0,f=0,g=0,y=0,x=0,b=0,_=0;function w(T,P){return function(){P.apply(this,arguments),T.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=w(WebGLRenderingContext.prototype.drawArrays,function(){d++,arguments[0]==this.POINTS?b+=arguments[2]:x+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=w(WebGLRenderingContext.prototype.drawElements,function(){f++,y+=arguments[1]/3,x+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=w(WebGLRenderingContext.prototype.useProgram,function(){g++}),WebGLRenderingContext.prototype.bindTexture=w(WebGLRenderingContext.prototype.bindTexture,function(){_++}),{update:function(){h("allcalls").set(d+f),h("drawElements").set(f),h("drawArrays").set(d),h("bindTexture").set(_),h("useProgram").set(g),h("glfaces").set(y),h("glvertices").set(x),h("glpoints").set(b)},start:function(){d=0,f=0,g=0,y=0,x=0,b=0,_=0},end:function(){},attach:function(T){h=T},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(h){var d=null;return{update:function(){d("renderer.info.memory.geometries").set(h.info.memory.geometries),d("renderer.info.programs").set(h.info.programs?.length??NaN),d("renderer.info.memory.textures").set(h.info.memory.textures),d("renderer.info.render.calls").set(h.info.render.calls),d("renderer.info.render.triangles").set(h.info.render.triangles),d("renderer.info.render.points").set(h.info.render.points)},start:function(){},end:function(){},attach:function(f){d=f},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var h=null,d=0,f=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var g=Math.log(1024);function y(x){var b=Math.floor(Math.log(x)/g);return Math.round(100*x/Math.pow(1024,b))/100}return{update:function(){d=y(performance.memory.usedJSHeapSize),f=y(performance.memory.totalJSHeapSize),h("memory").set(d),h("total").set(f)},start:function(){d=0},end:function(){},attach:function(x){h=x},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},l.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},282:l=>{"use strict";(function(){"performance"in window==0&&(window.performance={});var h=window.performance;if("now"in h==0){var d=Date.now();h.timing&&h.timing.navigationStart&&(d=h.timing.navigationStart),h.now=function(){return Date.now()-d}}h.mark||(h.mark=function(){}),h.measure||(h.measure=function(){})})(),window.rStats=function(h){function d(Q,Y){for(var q=Object.keys(Q),K=0,ne=q.length;K<ne;K++)Y(q[K])}var f=h||{},g=f.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],y=(f.CSSPath?f.CSSPath:"")+"rStats.css";(f.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",y]).forEach(function(Q){var Y,q;Y=Q,(q=document.createElement("link")).href=Y,q.rel="stylesheet",q.type="text/css",document.getElementsByTagName("head")[0].appendChild(q)}),f.values||(f.values={});var x,b,_=10,w=200,T={};function P(Q,Y,q){var K=q||{},ne=document.createElement("canvas"),le=ne.getContext("2d"),fe=0,be=0,de=K.color?K.color:"#666666",Fe=document.createElement("canvas"),we=Fe.getContext("2d");Fe.width=1,Fe.height=2*_,we.fillStyle="#444444",we.fillRect(0,0,1,2*_),we.fillStyle=de,we.fillRect(0,_,1,_),we.fillStyle="#ffffff",we.globalAlpha=.5,we.fillRect(0,_,1,1),we.globalAlpha=1;var Me=document.createElement("canvas"),_e=Me.getContext("2d");return Me.width=1,Me.height=2*_,_e.fillStyle="#444444",_e.fillRect(0,0,1,2*_),_e.fillStyle="#b70000",_e.fillRect(0,_,1,_),_e.globalAlpha=.5,_e.fillStyle="#ffffff",_e.fillRect(0,_,1,1),_e.globalAlpha=1,ne.width=w,ne.height=_,ne.style.width=ne.width+"px",ne.style.height=ne.height+"px",ne.className="rs-canvas",Q.appendChild(ne),le.fillStyle="#444444",le.fillRect(0,0,ne.width,ne.height),{draw:function(tt,me){(be+=.1*(tt-be))>(fe*=.99)&&(fe=be),le.drawImage(ne,1,0,ne.width-1,ne.height,0,0,ne.width-1,ne.height),me?le.drawImage(Me,ne.width-1,ne.height-be*ne.height/fe-_):le.drawImage(Fe,ne.width-1,ne.height-be*ne.height/fe-_)}}}function U(Q,Y){var q=document.createElement("canvas"),K=q.getContext("2d");return q.width=w,q.height=_*Y,q.style.width=q.width+"px",q.style.height=q.height+"px",q.className="rs-canvas",Q.appendChild(q),K.fillStyle="#444444",K.fillRect(0,0,q.width,q.height),{draw:function(ne){K.drawImage(q,1,0,q.width-1,q.height,0,0,q.width-1,q.height);var le=0;d(ne,function(fe){var be=ne[fe]*q.height;K.fillStyle=g[fe],K.fillRect(q.width-1,le,1,be),le+=be})}}}function D(Q,Y){var q,K=Q,ne=0,le=0,fe=0,be=0,de=performance.now(),Fe=0,we=document.createElement("div"),Me=document.createElement("span"),_e=document.createElement("div"),tt=document.createTextNode(""),me=f?f.values[K.toLowerCase()]:null,wt=new P(we,K,me),ft=!1;function ze(lt){if(me&&me.average){be+=lt,Fe++;var he=performance.now();he-de>=(me.avgMs||1e3)&&(fe=be/Fe,be=0,de=he,Fe=0)}}function $e(){q=performance.now(),f.userTimingAPI&&performance.mark(K+"-start"),ft=!0}function pt(){ne=performance.now()-q,f.userTimingAPI&&(performance.mark(K+"-end"),ft&&performance.measure(K,K+"-start",K+"-end")),ze(ne)}return Me.className="rs-counter-id",Me.textContent=me&&me.caption?me.caption:K,_e.className="rs-counter-value",_e.appendChild(tt),we.appendChild(Me),we.appendChild(_e),Y?Y.div.appendChild(we):b.appendChild(we),q=performance.now(),{set:function(lt){ze(ne=lt)},start:$e,tick:function(){pt(),$e()},end:pt,frame:function(){var lt=performance.now(),he=lt-q;le++,he>1e3&&(ne=me&&me.interpolate===!1?le:1e3*le/he,le=0,q=lt,ze(ne))},value:function(){return ne},draw:function(){var lt=me&&me.average?fe:ne;tt.nodeValue=Math.round(100*lt)/100;var he=me&&(me.below&&ne<me.below||me.over&&ne>me.over);wt.draw(ne,he),we.className=he?"rs-counter-base alarm":"rs-counter-base"}}}function z(Q){var Y=Q.toLowerCase();if(Y===void 0&&(Y="default"),T[Y])return T[Y];var q=null;f&&f.groups&&d(f.groups,function(ne){var le=f.groups[parseInt(ne,10)];q||le.values.indexOf(Y.toLowerCase())===-1||(q=le)});var K=new D(Y,q);return T[Y]=K,K}function G(){d(f.plugins,function(Q){f.plugins[Q].update()}),d(T,function(Q){T[Q].draw()}),f&&f.fractions&&d(f.fractions,function(Q){var Y=f.fractions[parseInt(Q,10)],q=[],K=T[Y.base.toLowerCase()];K&&(K=K.value(),d(f.fractions[Q].steps,function(ne){var le=f.fractions[Q].steps[parseInt(ne,10)].toLowerCase(),fe=T[le];fe&&q.push(fe.value()/K)})),Y.graph.draw(q)})}return function(){if(f.plugins){f.values||(f.values={}),f.groups||(f.groups=[]),f.fractions||(f.fractions=[]);for(var Q=0;Q<f.plugins.length;Q++)f.plugins[Q].attach(z),d(f.plugins[Q].values,function(Y){f.values[Y]=f.plugins[Q].values[Y]}),f.groups=f.groups.concat(f.plugins[Q].groups),f.fractions=f.fractions.concat(f.plugins[Q].fractions)}else f.plugins={};(x=document.createElement("div")).className="rs-base",(b=document.createElement("div")).className="rs-container",b.style.height="auto",x.appendChild(b),document.body.appendChild(x),f&&(f.groups&&d(f.groups,function(Y){var q=f.groups[parseInt(Y,10)],K=document.createElement("div");K.className="rs-group",q.div=K;var ne=document.createElement("h1");ne.textContent=q.caption,ne.addEventListener("click",function(le){this.classList.toggle("hidden"),le.preventDefault()}.bind(K)),b.appendChild(ne),b.appendChild(K)}),f.fractions&&d(f.fractions,function(Y){var q=f.fractions[parseInt(Y,10)],K=document.createElement("div");K.className="rs-fraction";var ne=document.createElement("div");ne.className="rs-legend";var le=0;d(f.fractions[Y].steps,function(be){var de=document.createElement("p");de.textContent=f.fractions[Y].steps[be],de.style.color=g[le],ne.appendChild(de),le++}),K.appendChild(ne),K.style.height=le*_+"px",q.div=K;var fe=new U(K,le);q.graph=fe,b.appendChild(K)}))}(),function(Q){return Q?z(Q):{element:x,update:G}}},l.exports=window.rStats},2535:l=>{var h={base64:function(d,f){return"data:"+d+";base64,"+f},isMobile:function(){var d,f=!1;return d=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4)))&&(f=!0),f},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch{return!0}},appendQueryParameter:function(d,f,g){var y=d.indexOf("?")<0?"?":"&";return d+(y+f+"=")+g},getQueryParameter:function(d){d=d.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var f=new RegExp("[\\?&]"+d+"=([^&#]*)").exec(location.search);return f===null?"":decodeURIComponent(f[1].replace(/\+/g," "))},isLandscapeMode:function(){return window.orientation==90||window.orientation==-90}};l.exports=h},5928:(l,h,d)=>{var f,g=d(2535);l.exports=(f=navigator.userAgent||navigator.vendor||window.opera).match(/iPhone/i)||f.match(/iPod/i)?function(){var y=null;this.request=function(){y||(y=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){y&&(clearInterval(y),y=null)}}:function(){var y=document.createElement("video");y.addEventListener("ended",function(){y.play()}),this.request=function(){y.paused&&(y.src=g.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),y.play())},this.release=function(){y.pause(),y.src=""}}},8217:(l,h,d)=>{"use strict";d.d(h,{A:()=>ne});var f=d(963),g=d.n(f),y=d(9089),x=d.n(y),b=d(6492),_=d.n(b),w=new URL(d(9169),d.b),T=new URL(d(6085),d.b),P=new URL(d(3931),d.b),U=new URL(d(7889),d.b),D=new URL(d(6517),d.b),z=x()(g()),G=_()(w),Q=_()(T),Y=_()(P),q=_()(U),K=_()(D);z.push([l.id,`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url(${G}) 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url(${Q}) 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url(${Y});
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(${q}) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(${K}) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:[`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E");
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`],sourceRoot:""}]);const ne=z},2470:(l,h,d)=>{"use strict";d.d(h,{A:()=>b});var f=d(963),g=d.n(f),y=d(9089),x=d.n(y)()(g());x.push([l.id,`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`,"",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`],sourceRoot:""}]);const b=x},7180:(l,h,d)=>{"use strict";d.r(h),d.d(h,{default:()=>Y});var f=d(5072),g=d.n(f),y=d(7825),x=d.n(y),b=d(7659),_=d.n(b),w=d(5056),T=d.n(w),P=d(540),U=d.n(P),D=d(1113),z=d.n(D),G=d(8217),Q={};Q.styleTagTransform=z(),Q.setAttributes=T(),Q.insert=_().bind(null,"head"),Q.domAPI=x(),Q.insertStyleElement=U(),g()(G.A,Q);const Y=G.A&&G.A.locals?G.A.locals:void 0},9379:(l,h,d)=>{"use strict";d.r(h),d.d(h,{default:()=>Y});var f=d(5072),g=d.n(f),y=d(7825),x=d.n(y),b=d(7659),_=d.n(b),w=d(5056),T=d.n(w),P=d(540),U=d.n(P),D=d(1113),z=d.n(D),G=d(2470),Q={};Q.styleTagTransform=z(),Q.setAttributes=T(),Q.insert=_().bind(null,"head"),Q.domAPI=x(),Q.insertStyleElement=U(),g()(G.A,Q);const Y=G.A&&G.A.locals?G.A.locals:void 0},5072:l=>{"use strict";var h=[];function d(y){for(var x=-1,b=0;b<h.length;b++)if(h[b].identifier===y){x=b;break}return x}function f(y,x){for(var b={},_=[],w=0;w<y.length;w++){var T=y[w],P=x.base?T[0]+x.base:T[0],U=b[P]||0,D="".concat(P," ").concat(U);b[P]=U+1;var z=d(D),G={css:T[1],media:T[2],sourceMap:T[3],supports:T[4],layer:T[5]};if(z!==-1)h[z].references++,h[z].updater(G);else{var Q=g(G,x);x.byIndex=w,h.splice(w,0,{identifier:D,updater:Q,references:1})}_.push(D)}return _}function g(y,x){var b=x.domAPI(x);return b.update(y),function(_){if(_){if(_.css===y.css&&_.media===y.media&&_.sourceMap===y.sourceMap&&_.supports===y.supports&&_.layer===y.layer)return;b.update(y=_)}else b.remove()}}l.exports=function(y,x){var b=f(y=y||[],x=x||{});return function(_){_=_||[];for(var w=0;w<b.length;w++){var T=d(b[w]);h[T].references--}for(var P=f(_,x),U=0;U<b.length;U++){var D=d(b[U]);h[D].references===0&&(h[D].updater(),h.splice(D,1))}b=P}}},7659:l=>{"use strict";var h={};l.exports=function(d,f){var g=function(y){if(h[y]===void 0){var x=document.querySelector(y);if(window.HTMLIFrameElement&&x instanceof window.HTMLIFrameElement)try{x=x.contentDocument.head}catch{x=null}h[y]=x}return h[y]}(d);if(!g)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");g.appendChild(f)}},540:l=>{"use strict";l.exports=function(h){var d=document.createElement("style");return h.setAttributes(d,h.attributes),h.insert(d,h.options),d}},5056:(l,h,d)=>{"use strict";l.exports=function(f){var g=d.nc;g&&f.setAttribute("nonce",g)}},7825:l=>{"use strict";l.exports=function(h){if(typeof document>"u")return{update:function(){},remove:function(){}};var d=h.insertStyleElement(h);return{update:function(f){(function(g,y,x){var b="";x.supports&&(b+="@supports (".concat(x.supports,") {")),x.media&&(b+="@media ".concat(x.media," {"));var _=x.layer!==void 0;_&&(b+="@layer".concat(x.layer.length>0?" ".concat(x.layer):""," {")),b+=x.css,_&&(b+="}"),x.media&&(b+="}"),x.supports&&(b+="}");var w=x.sourceMap;w&&typeof btoa<"u"&&(b+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(w))))," */")),y.styleTagTransform(b,g,y.options)})(d,h,f)},remove:function(){(function(f){if(f.parentNode===null)return!1;f.parentNode.removeChild(f)})(d)}}}},1113:l=>{"use strict";l.exports=function(h,d){if(d.styleSheet)d.styleSheet.cssText=h;else{for(;d.firstChild;)d.removeChild(d.firstChild);d.appendChild(document.createTextNode(h))}}},3931:l=>{"use strict";l.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},6085:l=>{"use strict";l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},9169:l=>{"use strict";l.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},6517:l=>{"use strict";l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},7889:l=>{"use strict";l.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"}},t={};function i(l){var h=t[l];if(h!==void 0)return h.exports;var d=t[l]={id:l,exports:{}};return p[l](d,d.exports,i),d.exports}i.m=p,i.n=l=>{var h=l&&l.__esModule?()=>l.default:()=>l;return i.d(h,{a:h}),h},i.d=(l,h)=>{for(var d in h)i.o(h,d)&&!i.o(l,d)&&Object.defineProperty(l,d,{enumerable:!0,get:h[d]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(l,h)=>Object.prototype.hasOwnProperty.call(l,h),i.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},i.b=document.baseURI||self.location.href,i.nc=void 0;var o={};return(()=>{"use strict";i.d(o,{default:()=>V5});var l={};i.r(l),i.d(l,{ACESFilmicToneMapping:()=>Kc,AddEquation:()=>ui,AddOperation:()=>Yr,AdditiveAnimationBlendMode:()=>tf,AdditiveBlending:()=>An,AgXToneMapping:()=>KA,AlphaFormat:()=>nu,AlwaysCompare:()=>oh,AlwaysDepth:()=>Da,AlwaysStencilFunc:()=>rf,AmbientLight:()=>x_,AnimationAction:()=>SI,AnimationClip:()=>_p,AnimationLoader:()=>AF,AnimationMixer:()=>II,AnimationObjectGroup:()=>BF,AnimationUtils:()=>uF,ArcCurve:()=>NS,ArrayCamera:()=>EI,ArrowHelper:()=>ZF,AttachedBindMode:()=>JA,Audio:()=>b_,AudioAnalyser:()=>wF,AudioContext:()=>__,AudioListener:()=>bI,AudioLoader:()=>gI,AxesHelper:()=>eO,BackSide:()=>Lt,BasicDepthPacking:()=>Dg,BasicShadowMap:()=>Ge,BatchedMesh:()=>SS,Bone:()=>g0,BooleanKeyframeTrack:()=>Lu,Box2:()=>QF,Box3:()=>te,Box3Helper:()=>JF,BoxGeometry:()=>vl,BoxHelper:()=>KF,BufferAttribute:()=>qn,BufferGeometry:()=>vn,BufferGeometryLoader:()=>pI,ByteType:()=>Od,Cache:()=>co,Camera:()=>l0,CameraHelper:()=>QI,CanvasTexture:()=>qx,CapsuleGeometry:()=>R0,CatmullRomCurve3:()=>FS,CineonToneMapping:()=>_i,CircleGeometry:()=>Uf,ClampToEdgeWrapping:()=>Dr,Clock:()=>X0,Color:()=>Mt,ColorKeyframeTrack:()=>A_,ColorManagement:()=>Dn,CompressedArrayTexture:()=>PS,CompressedCubeTexture:()=>US,CompressedTexture:()=>vp,CompressedTextureLoader:()=>fF,ConeGeometry:()=>L0,ConstantAlphaFactor:()=>Rs,ConstantColorFactor:()=>Yc,Controls:()=>nO,CubeCamera:()=>c0,CubeReflectionMapping:()=>js,CubeRefractionMapping:()=>Pa,CubeTexture:()=>hp,CubeTextureLoader:()=>oI,CubeUVReflectionMapping:()=>Zc,CubicBezierCurve:()=>Zx,CubicBezierCurve3:()=>kS,CubicInterpolant:()=>rI,CullFaceBack:()=>al,CullFaceFront:()=>Jh,CullFaceFrontBack:()=>ue,CullFaceNone:()=>zl,Curve:()=>Oo,CurvePath:()=>GS,CustomBlending:()=>Ki,CustomToneMapping:()=>YA,CylinderGeometry:()=>Ah,Cylindrical:()=>kF,Data3DTexture:()=>bu,DataArrayTexture:()=>gl,DataTexture:()=>Fo,DataTextureLoader:()=>mF,DataUtils:()=>Zg,DecrementStencilOp:()=>sx,DecrementWrapStencilOp:()=>ox,DefaultLoadingManager:()=>m_,DepthFormat:()=>ul,DepthStencilFormat:()=>To,DepthTexture:()=>Xx,DetachedBindMode:()=>$A,DirectionalLight:()=>W0,DirectionalLightHelper:()=>YF,DiscreteInterpolant:()=>sI,DodecahedronGeometry:()=>Nf,DoubleSide:()=>Dt,DstAlphaFactor:()=>ol,DstColorFactor:()=>ls,DynamicCopyUsage:()=>$d,DynamicDrawUsage:()=>Ax,DynamicReadUsage:()=>sc,EdgesGeometry:()=>HS,EllipseCurve:()=>I0,EqualCompare:()=>Gg,EqualDepth:()=>Aa,EqualStencilFunc:()=>Og,EquirectangularReflectionMapping:()=>$c,EquirectangularRefractionMapping:()=>wo,Euler:()=>ii,EventDispatcher:()=>Oa,ExtrudeGeometry:()=>k0,FileLoader:()=>Zr,Float16BufferAttribute:()=>kN,Float32BufferAttribute:()=>Wt,FloatType:()=>Ir,Fog:()=>xf,FogExp2:()=>Ef,FramebufferTexture:()=>eF,FrontSide:()=>ut,Frustum:()=>If,GLBufferAttribute:()=>FF,GLSL1:()=>yx,GLSL3:()=>xu,GreaterCompare:()=>Eu,GreaterDepth:()=>Co,GreaterEqualCompare:()=>af,GreaterEqualDepth:()=>fa,GreaterEqualStencilFunc:()=>px,GreaterStencilFunc:()=>ux,GridHelper:()=>qF,Group:()=>wa,HalfFloatType:()=>Cs,HemisphereLight:()=>g_,HemisphereLightHelper:()=>jF,IcosahedronGeometry:()=>Qf,ImageBitmapLoader:()=>mI,ImageLoader:()=>Fu,ImageUtils:()=>jg,IncrementStencilOp:()=>Fg,IncrementWrapStencilOp:()=>ax,InstancedBufferAttribute:()=>pc,InstancedBufferGeometry:()=>dI,InstancedInterleavedBuffer:()=>NF,InstancedMesh:()=>Ox,Int16BufferAttribute:()=>FN,Int32BufferAttribute:()=>ON,Int8BufferAttribute:()=>PN,IntType:()=>eu,InterleavedBuffer:()=>up,InterleavedBufferAttribute:()=>dc,Interpolant:()=>xp,InterpolateDiscrete:()=>$l,InterpolateLinear:()=>Zl,InterpolateSmooth:()=>Kd,InvertStencilOp:()=>lx,KeepStencilOp:()=>ic,KeyframeTrack:()=>ko,LOD:()=>gS,LatheGeometry:()=>Pf,Layers:()=>oc,LessCompare:()=>Qg,LessDepth:()=>Qr,LessEqualCompare:()=>yu,LessEqualDepth:()=>cs,LessEqualStencilFunc:()=>hx,LessStencilFunc:()=>Do,Light:()=>vh,LightProbe:()=>Ou,Line:()=>yl,Line3:()=>GF,LineBasicMaterial:()=>zr,LineCurve:()=>e_,LineCurve3:()=>QS,LineDashedMaterial:()=>tI,LineLoop:()=>Vx,LineSegments:()=>Ha,LinearFilter:()=>bi,LinearInterpolant:()=>p_,LinearMipMapLinearFilter:()=>Tg,LinearMipMapNearestFilter:()=>ix,LinearMipmapLinearFilter:()=>hs,LinearMipmapNearestFilter:()=>Ua,LinearSRGBColorSpace:()=>xr,LinearToneMapping:()=>Lr,LinearTransfer:()=>ah,Loader:()=>$r,LoaderUtils:()=>xl,LoadingManager:()=>f_,LoopOnce:()=>Ps,LoopPingPong:()=>Lg,LoopRepeat:()=>Rg,LuminanceAlphaFormat:()=>ru,LuminanceFormat:()=>Io,MOUSE:()=>La,Material:()=>Ur,MaterialLoader:()=>j0,MathUtils:()=>Tr,Matrix2:()=>I_,Matrix3:()=>wn,Matrix4:()=>Qt,MaxEquation:()=>Gi,Mesh:()=>Ti,MeshBasicMaterial:()=>Jr,MeshDepthMaterial:()=>c_,MeshDistanceMaterial:()=>h_,MeshLambertMaterial:()=>l_,MeshMatcapMaterial:()=>eI,MeshNormalMaterial:()=>ZS,MeshPhongMaterial:()=>jf,MeshPhysicalMaterial:()=>lo,MeshStandardMaterial:()=>gh,MeshToonMaterial:()=>$S,MinEquation:()=>$n,MirroredRepeatWrapping:()=>ll,MixOperation:()=>Ls,MultiplyBlending:()=>Tn,MultiplyOperation:()=>bs,NearestFilter:()=>yr,NearestMipMapLinearFilter:()=>Ig,NearestMipMapNearestFilter:()=>Zh,NearestMipmapLinearFilter:()=>Mo,NearestMipmapNearestFilter:()=>$h,NeutralToneMapping:()=>ql,NeverCompare:()=>kg,NeverDepth:()=>Bn,NeverStencilFunc:()=>cx,NoBlending:()=>Yt,NoColorSpace:()=>va,NoToneMapping:()=>ur,NormalAnimationBlendMode:()=>ef,NormalBlending:()=>rn,NotEqualCompare:()=>sf,NotEqualDepth:()=>di,NotEqualStencilFunc:()=>dx,NumberKeyframeTrack:()=>Du,Object3D:()=>kn,ObjectLoader:()=>EF,ObjectSpaceNormalMap:()=>Ug,OctahedronGeometry:()=>Ep,OneFactor:()=>Ln,OneMinusConstantAlphaFactor:()=>to,OneMinusConstantColorFactor:()=>jl,OneMinusDstAlphaFactor:()=>Ws,OneMinusDstColorFactor:()=>eo,OneMinusSrcAlphaFactor:()=>Wl,OneMinusSrcColorFactor:()=>xs,OrthographicCamera:()=>mc,PCFShadowMap:()=>qe,PCFSoftShadowMap:()=>ot,PMREMGenerator:()=>F_,Path:()=>Df,PerspectiveCamera:()=>Hr,Plane:()=>dh,PlaneGeometry:()=>Ac,PlaneHelper:()=>$F,PointLight:()=>V0,PointLightHelper:()=>VF,Points:()=>gp,PointsMaterial:()=>ph,PolarGridHelper:()=>XF,PolyhedronGeometry:()=>fh,PositionalAudio:()=>wI,PropertyBinding:()=>vi,PropertyMixer:()=>MI,QuadraticBezierCurve:()=>t_,QuadraticBezierCurve3:()=>n_,Quaternion:()=>ai,QuaternionKeyframeTrack:()=>Pu,QuaternionLinearInterpolant:()=>aI,RED_GREEN_RGTC2_Format:()=>gu,RED_RGTC1_Format:()=>Yd,REVISION:()=>bo,RGBADepthPacking:()=>Pg,RGBAFormat:()=>nr,RGBAIntegerFormat:()=>au,RGBA_ASTC_10x10_Format:()=>qd,RGBA_ASTC_10x5_Format:()=>Au,RGBA_ASTC_10x6_Format:()=>Kl,RGBA_ASTC_10x8_Format:()=>jd,RGBA_ASTC_12x10_Format:()=>fu,RGBA_ASTC_12x12_Format:()=>Xd,RGBA_ASTC_4x4_Format:()=>th,RGBA_ASTC_5x4_Format:()=>zd,RGBA_ASTC_5x5_Format:()=>Ds,RGBA_ASTC_6x5_Format:()=>du,RGBA_ASTC_6x6_Format:()=>Yl,RGBA_ASTC_8x5_Format:()=>pu,RGBA_ASTC_8x6_Format:()=>Vd,RGBA_ASTC_8x8_Format:()=>Wd,RGBA_BPTC_Format:()=>nh,RGBA_ETC2_EAC_Format:()=>uu,RGBA_PVRTC_2BPPV1_Format:()=>Hd,RGBA_PVRTC_4BPPV1_Format:()=>lu,RGBA_S3TC_DXT1_Format:()=>Na,RGBA_S3TC_DXT3_Format:()=>Fa,RGBA_S3TC_DXT5_Format:()=>eh,RGBDepthPacking:()=>nc,RGBFormat:()=>iu,RGBIntegerFormat:()=>Bg,RGB_BPTC_SIGNED_Format:()=>mu,RGB_BPTC_UNSIGNED_Format:()=>ih,RGB_ETC1_Format:()=>cu,RGB_ETC2_Format:()=>hu,RGB_PVRTC_2BPPV1_Format:()=>Gd,RGB_PVRTC_4BPPV1_Format:()=>pl,RGB_S3TC_DXT1_Format:()=>ou,RGDepthPacking:()=>Ro,RGFormat:()=>dl,RGIntegerFormat:()=>Qd,RawShaderMaterial:()=>G0,Ray:()=>_r,Raycaster:()=>BI,RectAreaLight:()=>uI,RedFormat:()=>Bo,RedIntegerFormat:()=>su,ReinhardToneMapping:()=>ma,RenderTarget:()=>tp,RenderTarget3D:()=>LF,RenderTargetArray:()=>DF,RepeatWrapping:()=>ga,ReplaceStencilOp:()=>Ng,ReverseSubtractEquation:()=>Li,RingGeometry:()=>Gf,SIGNED_RED_GREEN_RGTC2_Format:()=>rh,SIGNED_RED_RGTC1_Format:()=>Jl,SRGBColorSpace:()=>si,SRGBTransfer:()=>Di,Scene:()=>u0,ShaderChunk:()=>Xn,ShaderLib:()=>Qo,ShaderMaterial:()=>Ca,ShadowMaterial:()=>o_,Shape:()=>mh,ShapeGeometry:()=>Hf,ShapePath:()=>tO,ShapeUtils:()=>El,ShortType:()=>kd,Skeleton:()=>wf,SkeletonHelper:()=>zF,SkinnedMesh:()=>Fx,Source:()=>ka,Sphere:()=>on,SphereGeometry:()=>Bu,Spherical:()=>OF,SphericalHarmonics3:()=>bp,SplineCurve:()=>i_,SpotLight:()=>z0,SpotLightHelper:()=>HF,Sprite:()=>fS,SpriteMaterial:()=>Dx,SrcAlphaFactor:()=>Vl,SrcAlphaSaturateFactor:()=>_s,SrcColorFactor:()=>xn,StaticCopyUsage:()=>vx,StaticDrawUsage:()=>rc,StaticReadUsage:()=>mx,StereoCamera:()=>_F,StreamCopyUsage:()=>of,StreamDrawUsage:()=>fx,StreamReadUsage:()=>gx,StringKeyframeTrack:()=>Uu,SubtractEquation:()=>tr,SubtractiveBlending:()=>dn,TOUCH:()=>Hl,TangentSpaceNormalMap:()=>Lo,TetrahedronGeometry:()=>zf,Texture:()=>Pi,TextureLoader:()=>H0,TextureUtils:()=>iO,TimestampQuery:()=>lf,TorusGeometry:()=>Vf,TorusKnotGeometry:()=>Wf,Triangle:()=>Js,TriangleFanDrawMode:()=>sh,TriangleStripDrawMode:()=>Jd,TrianglesDrawMode:()=>nf,TubeGeometry:()=>Q0,UVMapping:()=>Jc,Uint16BufferAttribute:()=>Tx,Uint32BufferAttribute:()=>Bx,Uint8BufferAttribute:()=>UN,Uint8ClampedBufferAttribute:()=>NN,Uniform:()=>M_,UniformsGroup:()=>UF,UniformsLib:()=>Ft,UniformsUtils:()=>lp,UnsignedByteType:()=>Er,UnsignedInt248Type:()=>hl,UnsignedInt5999Type:()=>ZA,UnsignedIntType:()=>So,UnsignedShort4444Type:()=>tu,UnsignedShort5551Type:()=>Xl,UnsignedShortType:()=>cl,VSMShadowMap:()=>He,Vector2:()=>ct,Vector3:()=>R,Vector4:()=>pi,VectorKeyframeTrack:()=>Nu,VideoFrameTexture:()=>ZN,VideoTexture:()=>jx,WebGL3DRenderTarget:()=>_x,WebGLArrayRenderTarget:()=>np,WebGLCoordinateSystem:()=>ya,WebGLCubeRenderTarget:()=>yf,WebGLRenderTarget:()=>Us,WebGLRenderer:()=>kk,WebGLUtils:()=>mT,WebGPUCoordinateSystem:()=>no,WebXRController:()=>h0,WireframeGeometry:()=>YS,WrapAroundEnding:()=>vu,ZeroCurvatureEnding:()=>ec,ZeroFactor:()=>vr,ZeroSlopeEnding:()=>tc,ZeroStencilOp:()=>rx,createCanvasElement:()=>fl});var h={};i.r(h),i.d(h,{computeMikkTSpaceTangents:()=>Gk,computeMorphedAttributes:()=>Xk,deepCloneAttribute:()=>zk,deinterleaveAttribute:()=>av,deinterleaveGeometry:()=>Wk,estimateBytesUsed:()=>jk,interleaveAttributes:()=>Vk,mergeAttributes:()=>G_,mergeGeometries:()=>Hk,mergeGroups:()=>Yk,mergeVertices:()=>qk,toCreasedNormals:()=>Kk,toTrianglesDrawMode:()=>H_});var d={};i.r(d),i.d(d,{checkARSupport:()=>ab,checkHeadsetConnected:()=>sb,checkVRSupport:()=>ob,isAppleVisionPro:()=>oB,isBrowserEnvironment:()=>pb,isFirefoxReality:()=>lB,isIOS:()=>$f,isIpad:()=>aB,isLandscape:()=>cB,isMobile:()=>xh,isMobileDeviceRequestingDesktopSite:()=>cb,isMobileVR:()=>ub,isNodeEnvironment:()=>zQ,isOculusBrowser:()=>hb,isR7:()=>db,isTablet:()=>sB,isWebXRAvailable:()=>dv});var f={};i.r(f),i.d(f,{clearObject:()=>fb,createPool:()=>Ab,removeUnusedKeys:()=>Zf});var g={};i.r(g),i.d(g,{equals:()=>fv,isCoordinate:()=>XQ,isCoordinates:()=>dB,parse:()=>pv,regex:()=>uB,stringify:()=>Av,toVector3:()=>YQ});var y={};i.r(y),i.d(y,{getComponentProperty:()=>pB,getComponentPropertyPath:()=>mv,setComponentProperty:()=>mb});var x={};i.r(x),i.d(x,{parseUrl:()=>vb,validateCubemapSrc:()=>fB,validateEnvMapSrc:()=>gb,validateSrc:()=>vv});var b={};i.r(b),i.d(b,{createCompatibleTexture:()=>_b,handleTextureEvents:()=>xb,isCompatibleTexture:()=>gB,setTextureProperties:()=>yv,updateDistortionMap:()=>_l,updateEnvMap:()=>Eb,updateMap:()=>xv,updateMapMaterialFromData:()=>Ev});var _={};i.r(_),i.d(_,{parse:()=>tm,stringify:()=>ZQ,toCamelCase:()=>vB});var w={};i.r(w),i.d(w,{checkControllerPresentAndSetup:()=>Va,emitIfAxesChanged:()=>po,findMatchingControllerWebXR:()=>bb,isControllerPresentWebXR:()=>EB,onButtonEvent:()=>Un});var T={};i.r(T),i.d(T,{bind:()=>i4,checkHeadsetConnected:()=>r4,clone:()=>wb,coordinates:()=>g,debounce:()=>_B,debug:()=>Bi,deepEqual:()=>Mb,device:()=>d,diff:()=>bB,entity:()=>y,extend:()=>Sa,extendDeep:()=>Wa,findAllScenes:()=>wB,forceCanvasResizeSafariMobile:()=>AB,getElData:()=>h4,getUrlParameter:()=>nm,isIOS:()=>s4,isIframed:()=>CB,isMobile:()=>a4,material:()=>b,objectPool:()=>f,shouldCaptureKeyEvent:()=>Sb,split:()=>yc,splitString:()=>c4,srcLoader:()=>x,styleParser:()=>_,throttle:()=>o4,throttleLeadingAndTrailing:()=>xB,throttleTick:()=>l4,trackedControls:()=>w});var P={};i.r(P),i.d(P,{isSingleProperty:()=>wv,parseProperties:()=>LB,parseProperty:()=>Mv,process:()=>am,processPropertyDefinition:()=>Db,stringifyProperties:()=>DB,stringifyProperty:()=>Pb});var U={};i.r(U),i.d(U,{Component:()=>hm,components:()=>Or,registerComponent:()=>sn,registrationOrderWarnings:()=>NB});var D={};i.r(D),i.d(D,{System:()=>Iv,registerSystem:()=>Ao,systems:()=>Ec});var z={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},G={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},Q=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],Y={CSS:{},springs:{}};function q(r,e,n){return Math.min(Math.max(r,e),n)}function K(r,e){return r.indexOf(e)>-1}function ne(r,e){return r.apply(null,e)}var le=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,fe=/^rgb/,be=/^hsl/,de={arr:function(r){return Array.isArray(r)},obj:function(r){return K(Object.prototype.toString.call(r),"Object")},pth:function(r){return de.obj(r)&&r.hasOwnProperty("totalLength")},svg:function(r){return r instanceof SVGElement},inp:function(r){return r instanceof HTMLInputElement},dom:function(r){return r.nodeType||de.svg(r)},str:function(r){return typeof r=="string"},fnc:function(r){return typeof r=="function"},und:function(r){return r===void 0},hex:function(r){return le.test(r)},rgb:function(r){return fe.test(r)},hsl:function(r){return be.test(r)},col:function(r){return de.hex(r)||de.rgb(r)||de.hsl(r)},key:function(r){return!z.hasOwnProperty(r)&&!G.hasOwnProperty(r)&&r!=="targets"&&r!=="keyframes"}},Fe=/\(([^)]+)\)/;function we(r){var e=Fe.exec(r);return e?e[1].split(",").map(function(n){return parseFloat(n)}):[]}function Me(r,e){var n=we(r),s=q(de.und(n[0])?1:n[0],.1,100),a=q(de.und(n[1])?100:n[1],.1,100),c=q(de.und(n[2])?10:n[2],.1,100),u=q(de.und(n[3])?0:n[3],.1,100),A=Math.sqrt(a/s),m=c/(2*Math.sqrt(a*s)),v=m<1?A*Math.sqrt(1-m*m):0,E=m<1?(m*A-u)/v:-u+A;function C(M){var S=e?e*M/1e3:M;return S=m<1?Math.exp(-S*m*A)*(1*Math.cos(v*S)+E*Math.sin(v*S)):(1+E*S)*Math.exp(-S*A),M===0||M===1?M:1-S}return e?C:function(){var M=Y.springs[r];if(M)return M;for(var S=1/6,B=0,N=0;;)if(C(B+=S)===1){if(++N>=16)break}else N=0;var L=B*S*1e3;return Y.springs[r]=L,L}}function _e(r,e){r===void 0&&(r=1),e===void 0&&(e=.5);var n=q(r,1,10),s=q(e,.1,2);return function(a){return a===0||a===1?a:-n*Math.pow(2,10*(a-1))*Math.sin((a-1-s/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/s)}}function tt(r){return r===void 0&&(r=10),function(e){return Math.round(e*r)*(1/r)}}var me=function(){var r=.1;function e(u,A){return 1-3*A+3*u}function n(u,A){return 3*A-6*u}function s(u){return 3*u}function a(u,A,m){return((e(A,m)*u+n(A,m))*u+s(A))*u}function c(u,A,m){return 3*e(A,m)*u*u+2*n(A,m)*u+s(A)}return function(u,A,m,v){if(0<=u&&u<=1&&0<=m&&m<=1){var E=new Float32Array(11);if(u!==A||m!==v)for(var C=0;C<11;++C)E[C]=a(C*r,u,m);return function(M){return u===A&&m===v||M===0||M===1?M:a(function(S){for(var B=0,N=1;N!==10&&E[N]<=S;++N)B+=r;--N;var L=B+(S-E[N])/(E[N+1]-E[N])*r,F=c(L,u,m);return F>=.001?function(O,H,X,$){for(var ee=0;ee<4;++ee){var ie=c(H,X,$);if(ie===0)return H;H-=(a(H,X,$)-O)/ie}return H}(S,L,u,m):F===0?L:function(O,H,X,$,ee){var ie,ce,oe=0;do(ie=a(ce=H+(X-H)/2,$,ee)-O)>0?X=ce:H=ce;while(Math.abs(ie)>1e-7&&++oe<10);return ce}(S,B,B+r,u,m)}(M),A,v)}}}}(),wt=function(){var r=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],e={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],_e],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(u,A){return function(m){return 1-_e(u,A)(1-m)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(u,A){return function(m){return m<.5?_e(u,A)(2*m)/2:1-_e(u,A)(-2*m+2)/2}}]},n={linear:[.25,.25,.75,.75]};for(var s in e)for(var a=0,c=e[s].length;a<c;a++)n["ease"+s+r[a]]=e[s][a];return n}();function ft(r,e){if(de.fnc(r))return r;var n=r.split("(")[0],s=wt[n],a=we(r);switch(n){case"spring":return Me(r,e);case"cubicBezier":return ne(me,a);case"steps":return ne(tt,a);default:return de.fnc(s)?ne(s,a):ne(me,s)}}function ze(r){try{return document.querySelectorAll(r)}catch{return}}var $e=[];function pt(r,e){for(var n=$e,s=r.length,a=arguments.length>=2?arguments[1]:void 0,c=0;c<s;c++)if(c in r){var u=r[c];e.call(a,u,c,r)&&n.push(u)}return($e=r).length=0,n}function lt(r,e){e||(e=[]);for(var n=0,s=r.length;n<s;n++){var a=r[n];Array.isArray(a)?lt(a,e):e.push(a)}return e}function he(r){return de.arr(r)?r:(de.str(r)&&(r=ze(r)||r),r instanceof NodeList||r instanceof HTMLCollection?[].slice.call(r):[r])}function Z(r,e){return r.some(function(n){return n===e})}function Ce(r){var e={};for(var n in r)e[n]=r[n];return e}function Qe(r,e){var n=Ce(r);for(var s in r)n[s]=e.hasOwnProperty(s)?e[s]:r[s];return n}function Pe(r,e){var n=Ce(r);for(var s in e)n[s]=de.und(r[s])?e[s]:r[s];return n}var je=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g,pe=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,Ve=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Ye=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,Ct=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g,Ke=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function yt(r){var e=Ke.exec(r);if(e)return e[2]}function bt(r,e){return de.fnc(r)?r(e.target,e.id,e.total):r}function ht(r,e){return r.getAttribute(e)}function Vt(r,e,n){if(Z([n,"deg","rad","turn"],yt(e)))return e;var s=Y.CSS[e+n];if(!de.und(s))return s;var a=document.createElement(r.tagName),c=r.parentNode&&r.parentNode!==document?r.parentNode:document.body;c.appendChild(a),a.style.position="absolute",a.style.width=100+n;var u=100/a.offsetWidth;c.removeChild(a);var A=u*parseFloat(e);return Y.CSS[e+n]=A,A}function Nt(r,e,n){if(e in r.style){var s=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=r.style[e]||getComputedStyle(r).getPropertyValue(s)||"0";return n?Vt(r,a,n):a}}function nn(r,e){return de.dom(r)&&!de.inp(r)&&(ht(r,e)||de.svg(r)&&r[e])?"attribute":de.dom(r)&&Z(Q,e)?"transform":de.dom(r)&&e!=="transform"&&Nt(r,e)?"css":r[e]!=null?"object":void 0}var k=/(\w+)\(([^)]*)\)/g;function j(r){if(de.dom(r)){for(var e,n=r.style.transform||"",s=new Map;e=k.exec(n);)s.set(e[1],e[2]);return s}}function J(r,e,n,s){switch(nn(r,e)){case"transform":return function(a,c,u,A){var m=K(c,"scale")?1:0+function(E){return K(E,"translate")||E==="perspective"?"px":K(E,"rotate")||K(E,"skew")?"deg":void 0}(c),v=j(a).get(c)||m;return u&&(u.transforms.list.set(c,v),u.transforms.last=c),A?Vt(a,v,A):v}(r,e,s,n);case"css":return Nt(r,e,n);case"attribute":return ht(r,e);default:return r[e]||0}}var Ae=/^(\*=|\+=|-=)/;function ye(r,e){var n=Ae.exec(r);if(!n)return r;var s=yt(r)||0,a=parseFloat(e),c=parseFloat(r.replace(n[0],""));switch(n[0][0]){case"+":return a+c+s;case"-":return a-c+s;case"*":return a*c+s}}var Re=/\s/g;function rt(r,e){if(de.col(r))return function(a){return de.rgb(a)?(c=a,(u=je.exec(c))?"rgba("+u[1]+",1)":c):de.hex(a)?function(A){var m=A.replace(pe,function(E,C,M,S){return C+C+M+M+S+S}),v=Ve.exec(m);return"rgba("+parseInt(v[1],16)+","+parseInt(v[2],16)+","+parseInt(v[3],16)+",1)"}(a):de.hsl(a)?function(A){var m,v,E,C=Ye.exec(A)||Ct.exec(A),M=parseInt(C[1],10)/360,S=parseInt(C[2],10)/100,B=parseInt(C[3],10)/100,N=C[4]||1;function L(H,X,$){return $<0&&($+=1),$>1&&($-=1),$<1/6?H+6*(X-H)*$:$<.5?X:$<2/3?H+(X-H)*(2/3-$)*6:H}if(S==0)m=v=E=B;else{var F=B<.5?B*(1+S):B+S-B*S,O=2*B-F;m=L(O,F,M+1/3),v=L(O,F,M),E=L(O,F,M-1/3)}return"rgba("+255*m+","+255*v+","+255*E+","+N+")"}(a):void 0;var c,u}(r);var n=yt(r),s=n?r.substr(0,r.length-n.length):r;return e&&!Re.test(r)?s+e:s}function _t(r,e){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function kt(r){for(var e,n=r.points,s=0,a=0;a<n.numberOfItems;a++){var c=n.getItem(a);a>0&&(s+=_t(e,c)),e=c}return s}function un(r){if(r.getTotalLength)return r.getTotalLength();switch(r.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*ht(e,"r")}(r);case"rect":return function(e){return 2*ht(e,"width")+2*ht(e,"height")}(r);case"line":return function(e){return _t({x:ht(e,"x1"),y:ht(e,"y1")},{x:ht(e,"x2"),y:ht(e,"y2")})}(r);case"polyline":return kt(r);case"polygon":return function(e){var n=e.points;return kt(e)+_t(n.getItem(n.numberOfItems-1),n.getItem(0))}(r)}}function Jn(r,e){var n=e||{},s=n.el||function(v){for(var E=v.parentNode;de.svg(E)&&(E=E.parentNode,de.svg(E.parentNode)););return E}(r),a=s.getBoundingClientRect(),c=ht(s,"viewBox"),u=a.width,A=a.height,m=n.viewBox||(c?c.split(" "):[0,0,u,A]);return{el:s,viewBox:m,x:m[0]/1,y:m[1]/1,w:u/m[2],h:A/m[3]}}function Ri(r,e){function n(A){A===void 0&&(A=0);var m=e+A>=1?e+A:0;return r.el.getPointAtLength(m)}var s=Jn(r.el,r.svg),a=n(),c=n(-1),u=n(1);switch(r.property){case"x":return(a.x-s.x)*s.w;case"y":return(a.y-s.y)*s.h;case"angle":return 180*Math.atan2(u.y-c.y,u.x-c.x)/Math.PI}}var Xr=/-?\d*\.?\d+/g;function da(r,e){var n=rt(de.pth(r)?r.totalLength:r,e)+"";return{original:n,numbers:n.match(Xr)?n.match(Xr).map(Number):[0],strings:de.str(r)||e?n.split(Xr):[]}}function $a(r){return pt(r?lt(de.arr(r)?r.map(he):he(r)):[],function(e,n,s){return s.indexOf(e)===n})}function De(r){var e=$a(r);return e.map(function(n,s){return{target:n,id:s,total:e.length,transforms:{list:j(n)}}})}var pa=/^spring/;function sl(r,e){var n=Ce(e);if(pa.test(n.easing)&&(n.duration=Me(n.easing)),de.arr(r)){var s=r.length;s!==2||de.obj(r[0])?de.fnc(e.duration)||(n.duration=e.duration/s):r={value:r}}var a=de.arr(r)?r:[r];return a.map(function(c,u){var A=de.obj(c)&&!de.pth(c)?c:{value:c};return de.und(A.delay)&&(A.delay=u?0:e.delay),de.und(A.endDelay)&&(A.endDelay=u===a.length-1?e.endDelay:0),A}).map(function(c){return Pe(c,n)})}var cr={css:function(r,e,n){return r.style[e]=n},attribute:function(r,e,n){return r.setAttribute(e,n)},object:function(r,e,n){return r[e]=n},transform:function(r,e,n,s,a){if(s.list.set(e,n),e===s.last||a){var c="";s.list.forEach(function(u,A){c+=A+"("+u+") "}),r.style.transform=c}}};function Yh(r,e){for(var n=De(r),s=0,a=n.length;s<a;s++){var c=n[s];for(var u in e){var A=bt(e[u],c),m=c.target,v=yt(A),E=J(m,u,v,c),C=ye(rt(A,v||yt(E)),E),M=nn(m,u);cr[M](m,u,C,c.transforms,!0)}}}function Nd(r,e){return pt(lt(r.map(function(n){return e.map(function(s){return function(a,c){var u=nn(a.target,c.name);if(u){var A=function(v,E){var C;return v.tweens.map(function(M){var S=function(ee,ie){var ce={};for(var oe in ee){var Se=bt(ee[oe],ie);de.arr(Se)&&(Se=Se.map(function(Ne){return bt(Ne,ie)})).length===1&&(Se=Se[0]),ce[oe]=Se}return ce.duration=parseFloat(ce.duration),ce.delay=parseFloat(ce.delay),ce}(M,E),B=S.value,N=de.arr(B)?B[1]:B,L=yt(N),F=J(E.target,v.name,L,E),O=C?C.to.original:F,H=de.arr(B)?B[0]:O,X=yt(H)||yt(F),$=L||X;return de.und(N)&&(N=O),S.from=da(H,$),S.to=da(ye(N,H),$),S.start=C?C.end:0,S.end=S.start+S.delay+S.duration+S.endDelay,S.easing=ft(S.easing,S.duration),S.isPath=de.pth(B),S.isColor=de.col(S.from.original),S.isColor&&(S.round=1),C=S,S})}(c,a),m=A[A.length-1];return{type:u,property:c.name,animatable:a,tweens:A,duration:m.end,delay:A[0].delay,endDelay:m.endDelay}}}(n,s)})})),function(n){return!de.und(n)})}function Kh(r,e){var n=r.length,s=function(c){return c.timelineOffset?c.timelineOffset:0},a={};return a.duration=n?Math.max.apply(Math,r.map(function(c){return s(c)+c.duration})):e.duration,a.delay=n?Math.min.apply(Math,r.map(function(c){return s(c)+c.delay})):e.delay,a.endDelay=n?a.duration-Math.max.apply(Math,r.map(function(c){return s(c)+c.duration-c.endDelay})):e.endDelay,a}var Ql,Za=0,hr=[],qc=[],Fd=function(){function r(){Ql=requestAnimationFrame(e)}function e(n){var s=hr.length;if(s){for(var a=0;a<s;){var c=hr[a];if(c.paused){var u=hr.indexOf(c);u>-1&&(hr.splice(u,1),s=hr.length)}else c.tick(n);a++}r()}else Ql=cancelAnimationFrame(Ql)}return r}();function Qi(r){r===void 0&&(r={});var e,n=0,s=0,a=0,c=0,u=null;function A(){return window.Promise&&new Promise(function(F){return u=F})}var m=A(),v=function(F){var O=Qe(z,F),H=Qe(G,F),X=function(oe,Se){var Ne=[],ke=Se.keyframes;for(var Oe in ke&&(Se=Pe(function(Te){for(var Je=pt(lt(Te.map(function(Bt){return Object.keys(Bt)})),function(Bt){return de.key(Bt)}).reduce(function(Bt,qt){return Bt.indexOf(qt)<0&&Bt.push(qt),Bt},[]),st={},Et=function(Bt){var qt=Je[Bt];st[qt]=Te.map(function(Kt){var Jt={};for(var ln in Kt)de.key(ln)?ln==qt&&(Jt.value=Kt[ln]):Jt[ln]=Kt[ln];return Jt})},dt=0;dt<Je.length;dt++)Et(dt);return st}(ke),Se)),Se)de.key(Oe)&&Ne.push({name:Oe,tweens:sl(Se[Oe],oe)});return Ne}(H,F),$=De(F.targets),ee=Nd($,X),ie=Kh(ee,H),ce=Za;return Za++,Pe(O,{id:ce,children:[],animatables:$,animations:ee,duration:ie.duration,delay:ie.delay,endDelay:ie.endDelay})}(r);function E(){v.reversed=!v.reversed;for(var F=0,O=e.length;F<O;F++)e[F].reversed=v.reversed}function C(F){return v.reversed?v.duration-F:F}function M(){n=0,s=C(v.currentTime)*(1/Qi.speed)}function S(F,O){O&&O.seek(F-O.timelineOffset)}function B(F){for(var O=0,H=v.animations,X=H.length;O<X;){var $=H[O],ee=$.animatable,ie=$.tweens,ce=ie.length-1,oe=ie[ce];ce&&(oe=pt(ie,function(nt){return F<nt.end})[0]||oe);for(var Se=q(F-oe.start-oe.delay,0,oe.duration)/oe.duration,Ne=isNaN(Se)?1:oe.easing(Se),ke=oe.to.strings,Oe=oe.round,Te=[],Je=oe.to.numbers.length,st=void 0,Et=0;Et<Je;Et++){var dt=void 0,Bt=oe.to.numbers[Et],qt=oe.from.numbers[Et]||0;dt=oe.isPath?Ri(oe.value,Ne*Bt):qt+Ne*(Bt-qt),Oe&&(oe.isColor&&Et>2||(dt=Math.round(dt*Oe)/Oe)),Te.push(dt)}var Kt=ke.length;if(Kt){st=ke[0];for(var Jt=0;Jt<Kt;Jt++){ke[Jt];var ln=ke[Jt+1],Ot=Te[Jt];isNaN(Ot)||(st+=ln?Ot+ln:Ot+" ")}}else st=Te[0];cr[$.type](ee.target,$.property,st,ee.transforms),$.currentValue=st,O++}}function N(F){v[F]&&!v.passThrough&&v[F](v)}function L(F){var O=v.duration,H=v.delay,X=O-v.endDelay,$=C(F);v.progress=q($/O*100,0,100),v.reversePlayback=$<v.currentTime,e&&function(ee){if(v.reversePlayback)for(var ie=c;ie--;)S(ee,e[ie]);else for(var ce=0;ce<c;ce++)S(ee,e[ce])}($),!v.began&&v.currentTime>0&&(v.began=!0,N("begin"),N("loopBegin")),$<=H&&v.currentTime!==0&&B(0),($>=X&&v.currentTime!==O||!O)&&B(O),$>H&&$<X?(v.changeBegan||(v.changeBegan=!0,v.changeCompleted=!1,N("changeBegin")),N("change"),B($)):v.changeBegan&&(v.changeCompleted=!0,v.changeBegan=!1,N("changeComplete")),v.currentTime=q($,0,O),v.began&&N("update"),F>=O&&(s=0,v.remaining&&v.remaining!==!0&&v.remaining--,v.remaining?(n=a,N("loopComplete"),N("loopBegin"),v.direction==="alternate"&&E()):(v.paused=!0,v.completed||(v.completed=!0,N("loopComplete"),N("complete"),"Promise"in window&&(u(),m=A()))))}return v.reset=function(){var F=v.direction;v.passThrough=!1,v.currentTime=0,v.progress=0,v.paused=!0,v.began=!1,v.changeBegan=!1,v.completed=!1,v.changeCompleted=!1,v.reversePlayback=!1,v.reversed=F==="reverse",v.remaining=v.loop,e=v.children;for(var O=c=e.length;O--;)v.children[O].reset();(v.reversed&&v.loop!==!0||F==="alternate"&&v.loop===1)&&v.remaining++,B(0)},v.set=function(F,O){return Yh(F,O),v},v.tick=function(F){a=F,n||(n=a),L((a+(s-n))*Qi.speed)},v.seek=function(F){L(C(F))},v.pause=function(){v.paused=!0,M()},v.play=function(){v.paused&&(v.paused=!1,hr.push(v),M(),Ql||Fd())},v.reverse=function(){E(),M()},v.restart=function(){v.reset(),v.play()},v.finished=m,v.reset(),v.autoplay&&v.play(),v}function Xc(r,e){for(var n=e.length;n--;)Z(r,e[n].animatable.target)&&e.splice(n,1)}document.addEventListener("visibilitychange",function(){if(document.hidden){for(var r=0,e=hr.length;r<e;r++)activeInstance[r].pause();qc=hr.slice(0),hr=[]}else for(var n=0,s=qc.length;n<s;n++)qc[n].play()}),Qi.version="3.0.0",Qi.speed=1,Qi.running=hr,Qi.remove=function(r){for(var e=$a(r),n=hr.length;n--;){var s=hr[n],a=s.animations,c=s.children;Xc(e,a);for(var u=c.length;u--;){var A=c[u],m=A.animations;Xc(e,m),m.length||A.children.length||c.splice(u,1)}a.length||c.length||s.pause()}},Qi.get=J,Qi.set=Yh,Qi.convertPx=Vt,Qi.path=function(r,e){var n=de.str(r)?ze(r)[0]:r,s=e||100;return function(a){return{property:a,el:n,svg:Jn(n),totalLength:un(n)*(s/100)}}},Qi.setDashoffset=function(r){var e=un(r);return r.setAttribute("stroke-dasharray",e),e},Qi.stagger=function(r,e){e===void 0&&(e={});var n=e.direction||"normal",s=e.easing?ft(e.easing):null,a=e.grid,c=e.axis,u=e.from||0,A=u==="first",m=u==="center",v=u==="last",E=de.arr(r),C=parseFloat(E?r[0]:r),M=E?parseFloat(r[1]):0,S=yt(E?r[1]:r)||0,B=e.start||0+(E?C:0),N=[],L=0;return function(F,O,H){if(A&&(u=0),m&&(u=(H-1)/2),v&&(u=H-1),!N.length){for(var X=0;X<H;X++){if(a){var $=m?(a[0]-1)/2:u%a[0],ee=m?(a[1]-1)/2:Math.floor(u/a[0]),ie=$-X%a[0],ce=ee-Math.floor(X/a[0]),oe=Math.sqrt(ie*ie+ce*ce);c==="x"&&(oe=-ie),c==="y"&&(oe=-ce),N.push(oe)}else N.push(Math.abs(u-X));L=Math.max.apply(Math,N)}s&&(N=N.map(function(Se){return s(Se/L)*L})),n==="reverse"&&(N=N.map(function(Se){return c?Se<0?-1*Se:-Se:Math.abs(L-Se)}))}return B+(E?(M-C)/L:C)*(Math.round(100*N[O])/100)+S}},Qi.timeline=function(r){r===void 0&&(r={});var e=Qi(r);return e.duration=0,e.add=function(n,s){var a=hr.indexOf(e),c=e.children;function u(M){M.passThrough=!0}a>-1&&hr.splice(a,1);for(var A=0;A<c.length;A++)u(c[A]);var m=Pe(n,Qe(G,r));m.targets=m.targets||r.targets;var v=e.duration;m.autoplay=!1,m.direction=e.direction,m.timelineOffset=de.und(s)?v:ye(s,v),u(e),e.seek(m.timelineOffset);var E=Qi(m);u(E),c.push(E);var C=Kh(c,r);return e.delay=C.delay,e.endDelay=C.endDelay,e.duration=C.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e},Qi.easing=ft,Qi.penner=wt,Qi.random=function(r,e){return Math.floor(Math.random()*(e-r+1))+r};const Gl=Qi,bo="173",La={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Hl={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},zl=0,al=1,Jh=2,ue=3,Ge=0,qe=1,ot=2,He=3,ut=0,Lt=1,Dt=2,Yt=0,rn=1,An=2,dn=3,Tn=4,Ki=5,ui=100,tr=101,Li=102,$n=103,Gi=104,vr=200,Ln=201,xn=202,xs=203,Vl=204,Wl=205,ol=206,Ws=207,ls=208,eo=209,_s=210,Yc=211,jl=212,Rs=213,to=214,Bn=0,Da=1,Qr=2,cs=3,Aa=4,fa=5,Co=6,di=7,bs=0,Ls=1,Yr=2,ur=0,Lr=1,ma=2,_i=3,Kc=4,YA=5,KA=6,ql=7,JA="attached",$A="detached",Jc=300,js=301,Pa=302,$c=303,wo=304,Zc=306,ga=1e3,Dr=1001,ll=1002,yr=1003,$h=1004,Zh=1004,Mo=1005,Ig=1005,bi=1006,Ua=1007,ix=1007,hs=1008,Tg=1008,Er=1009,Od=1010,kd=1011,cl=1012,eu=1013,So=1014,Ir=1015,Cs=1016,tu=1017,Xl=1018,hl=1020,ZA=35902,nu=1021,iu=1022,nr=1023,Io=1024,ru=1025,ul=1026,To=1027,Bo=1028,su=1029,dl=1030,Qd=1031,Bg=1032,au=1033,ou=33776,Na=33777,Fa=33778,eh=33779,pl=35840,Gd=35841,lu=35842,Hd=35843,cu=36196,hu=37492,uu=37496,th=37808,zd=37809,Ds=37810,du=37811,Yl=37812,pu=37813,Vd=37814,Wd=37815,Au=37816,Kl=37817,jd=37818,qd=37819,fu=37820,Xd=37821,nh=36492,mu=36494,ih=36495,Yd=36283,Jl=36284,gu=36285,rh=36286,Ps=2200,Rg=2201,Lg=2202,$l=2300,Zl=2301,Kd=2302,ec=2400,tc=2401,vu=2402,ef=2500,tf=2501,nf=0,Jd=1,sh=2,Dg=3200,Pg=3201,nc=3202,Ro=3203,Lo=0,Ug=1,va="",si="srgb",xr="srgb-linear",ah="linear",Di="srgb",rx=0,ic=7680,Ng=7681,Fg=7682,sx=7683,ax=34055,ox=34056,lx=5386,cx=512,Do=513,Og=514,hx=515,ux=516,dx=517,px=518,rf=519,kg=512,Qg=513,Gg=514,yu=515,Eu=516,sf=517,af=518,oh=519,rc=35044,Ax=35048,fx=35040,mx=35045,sc=35049,gx=35041,vx=35046,$d=35050,of=35042,yx="100",xu="300 es",ya=2e3,no=2001,lf={COMPUTE:"compute",RENDER:"render"};class Oa{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(n)===-1&&s[e].push(n)}hasEventListener(e,n){const s=this._listeners;return s!==void 0&&s[e]!==void 0&&s[e].indexOf(n)!==-1}removeEventListener(e,n){const s=this._listeners;if(s===void 0)return;const a=s[e];if(a!==void 0){const c=a.indexOf(n);c!==-1&&a.splice(c,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const s=n[e.type];if(s!==void 0){e.target=this;const a=s.slice(0);for(let c=0,u=a.length;c<u;c++)a[c].call(this,e);e.target=null}}}const us=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Hg=1234567;const ac=Math.PI/180,io=180/Math.PI;function Pr(){const r=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(us[255&r]+us[r>>8&255]+us[r>>16&255]+us[r>>24&255]+"-"+us[255&e]+us[e>>8&255]+"-"+us[e>>16&15|64]+us[e>>24&255]+"-"+us[63&n|128]+us[n>>8&255]+"-"+us[n>>16&255]+us[n>>24&255]+us[255&s]+us[s>>8&255]+us[s>>16&255]+us[s>>24&255]).toLowerCase()}function Rn(r,e,n){return Math.max(e,Math.min(n,r))}function cf(r,e){return(r%e+e)%e}function _u(r,e,n){return(1-n)*r+n*e}function ws(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Nn(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(4294967295*r);case Uint16Array:return Math.round(65535*r);case Uint8Array:return Math.round(255*r);case Int32Array:return Math.round(2147483647*r);case Int16Array:return Math.round(32767*r);case Int8Array:return Math.round(127*r);default:throw new Error("Invalid component type.")}}const Tr={DEG2RAD:ac,RAD2DEG:io,generateUUID:Pr,clamp:Rn,euclideanModulo:cf,mapLinear:function(r,e,n,s,a){return s+(r-e)*(a-s)/(n-e)},inverseLerp:function(r,e,n){return r!==e?(n-r)/(e-r):0},lerp:_u,damp:function(r,e,n,s){return _u(r,e,1-Math.exp(-n*s))},pingpong:function(r,e=1){return e-Math.abs(cf(r,2*e)-e)},smoothstep:function(r,e,n){return r<=e?0:r>=n?1:(r=(r-e)/(n-e))*r*(3-2*r)},smootherstep:function(r,e,n){return r<=e?0:r>=n?1:(r=(r-e)/(n-e))*r*r*(r*(6*r-15)+10)},randInt:function(r,e){return r+Math.floor(Math.random()*(e-r+1))},randFloat:function(r,e){return r+Math.random()*(e-r)},randFloatSpread:function(r){return r*(.5-Math.random())},seededRandom:function(r){r!==void 0&&(Hg=r);let e=Hg+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(r){return r*ac},radToDeg:function(r){return r*io},isPowerOfTwo:function(r){return!(r&r-1)&&r!==0},ceilPowerOfTwo:function(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},floorPowerOfTwo:function(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},setQuaternionFromProperEuler:function(r,e,n,s,a){const c=Math.cos,u=Math.sin,A=c(n/2),m=u(n/2),v=c((e+s)/2),E=u((e+s)/2),C=c((e-s)/2),M=u((e-s)/2),S=c((s-e)/2),B=u((s-e)/2);switch(a){case"XYX":r.set(A*E,m*C,m*M,A*v);break;case"YZY":r.set(m*M,A*E,m*C,A*v);break;case"ZXZ":r.set(m*C,m*M,A*E,A*v);break;case"XZX":r.set(A*E,m*B,m*S,A*v);break;case"YXY":r.set(m*S,A*E,m*B,A*v);break;case"ZYZ":r.set(m*B,m*S,A*E,A*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}},normalize:Nn,denormalize:ws};class ct{constructor(e=0,n=0){ct.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,s=this.y,a=e.elements;return this.x=a[0]*n+a[3]*s+a[6],this.y=a[1]*n+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Rn(this.x,e.x,n.x),this.y=Rn(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=Rn(this.x,e,n),this.y=Rn(this.y,e,n),this}clampLength(e,n){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Rn(s,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const s=this.dot(e)/n;return Math.acos(Rn(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,s=this.y-e.y;return n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,s){return this.x=e.x+(n.x-e.x)*s,this.y=e.y+(n.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const s=Math.cos(n),a=Math.sin(n),c=this.x-e.x,u=this.y-e.y;return this.x=c*s-u*a+e.x,this.y=c*a+u*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wn{constructor(e,n,s,a,c,u,A,m,v){wn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,s,a,c,u,A,m,v)}set(e,n,s,a,c,u,A,m,v){const E=this.elements;return E[0]=e,E[1]=a,E[2]=A,E[3]=n,E[4]=c,E[5]=m,E[6]=s,E[7]=u,E[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,s=e.elements;return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],this}extractBasis(e,n,s){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const s=e.elements,a=n.elements,c=this.elements,u=s[0],A=s[3],m=s[6],v=s[1],E=s[4],C=s[7],M=s[2],S=s[5],B=s[8],N=a[0],L=a[3],F=a[6],O=a[1],H=a[4],X=a[7],$=a[2],ee=a[5],ie=a[8];return c[0]=u*N+A*O+m*$,c[3]=u*L+A*H+m*ee,c[6]=u*F+A*X+m*ie,c[1]=v*N+E*O+C*$,c[4]=v*L+E*H+C*ee,c[7]=v*F+E*X+C*ie,c[2]=M*N+S*O+B*$,c[5]=M*L+S*H+B*ee,c[8]=M*F+S*X+B*ie,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],A=e[5],m=e[6],v=e[7],E=e[8];return n*u*E-n*A*v-s*c*E+s*A*m+a*c*v-a*u*m}invert(){const e=this.elements,n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],A=e[5],m=e[6],v=e[7],E=e[8],C=E*u-A*v,M=A*m-E*c,S=v*c-u*m,B=n*C+s*M+a*S;if(B===0)return this.set(0,0,0,0,0,0,0,0,0);const N=1/B;return e[0]=C*N,e[1]=(a*v-E*s)*N,e[2]=(A*s-a*u)*N,e[3]=M*N,e[4]=(E*n-a*m)*N,e[5]=(a*c-A*n)*N,e[6]=S*N,e[7]=(s*m-v*n)*N,e[8]=(u*n-s*c)*N,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,s,a,c,u,A){const m=Math.cos(c),v=Math.sin(c);return this.set(s*m,s*v,-s*(m*u+v*A)+u+e,-a*v,a*m,-a*(-v*u+m*A)+A+n,0,0,1),this}scale(e,n){return this.premultiply(Zd.makeScale(e,n)),this}rotate(e){return this.premultiply(Zd.makeRotation(-e)),this}translate(e,n){return this.premultiply(Zd.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),s=Math.sin(e);return this.set(n,-s,0,s,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,s=e.elements;for(let a=0;a<9;a++)if(n[a]!==s[a])return!1;return!0}fromArray(e,n=0){for(let s=0;s<9;s++)this.elements[s]=e[s+n];return this}toArray(e=[],n=0){const s=this.elements;return e[n]=s[0],e[n+1]=s[1],e[n+2]=s[2],e[n+3]=s[3],e[n+4]=s[4],e[n+5]=s[5],e[n+6]=s[6],e[n+7]=s[7],e[n+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Zd=new wn;function zg(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}const Vg={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Al(r,e){return new Vg[r](e)}function lh(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function fl(){const r=lh("canvas");return r.style.display="block",r}const hf={};function ml(r){r in hf||(hf[r]=!0,console.warn(r))}const uf=new wn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),ep=new wn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Wg(){const r={enabled:!0,workingColorSpace:xr,spaces:{},convert:function(a,c,u){return this.enabled!==!1&&c!==u&&c&&u&&(this.spaces[c].transfer===Di&&(a.r=Po(a.r),a.g=Po(a.g),a.b=Po(a.b)),this.spaces[c].primaries!==this.spaces[u].primaries&&(a.applyMatrix3(this.spaces[c].toXYZ),a.applyMatrix3(this.spaces[u].fromXYZ)),this.spaces[u].transfer===Di&&(a.r=Ea(a.r),a.g=Ea(a.g),a.b=Ea(a.b))),a},fromWorkingColorSpace:function(a,c){return this.convert(a,this.workingColorSpace,c)},toWorkingColorSpace:function(a,c){return this.convert(a,c,this.workingColorSpace)},getPrimaries:function(a){return this.spaces[a].primaries},getTransfer:function(a){return a===va?ah:this.spaces[a].transfer},getLuminanceCoefficients:function(a,c=this.workingColorSpace){return a.fromArray(this.spaces[c].luminanceCoefficients)},define:function(a){Object.assign(this.spaces,a)},_getMatrix:function(a,c,u){return a.copy(this.spaces[c].toXYZ).multiply(this.spaces[u].fromXYZ)},_getDrawingBufferColorSpace:function(a){return this.spaces[a].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(a=this.workingColorSpace){return this.spaces[a].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],s=[.3127,.329];return r.define({[xr]:{primaries:e,whitePoint:s,transfer:ah,toXYZ:uf,fromXYZ:ep,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:si},outputColorSpaceConfig:{drawingBufferColorSpace:si}},[si]:{primaries:e,whitePoint:s,transfer:Di,toXYZ:uf,fromXYZ:ep,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:si}}}),r}const Dn=Wg();function Po(r){return r<.04045?.0773993808*r:Math.pow(.9478672986*r+.0521327014,2.4)}function Ea(r){return r<.0031308?12.92*r:1.055*Math.pow(r,.41666)-.055}let qs;class jg{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{qs===void 0&&(qs=lh("canvas")),qs.width=e.width,qs.height=e.height;const s=qs.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),n=qs}return n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=lh("canvas");n.width=e.width,n.height=e.height;const s=n.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const a=s.getImageData(0,0,e.width,e.height),c=a.data;for(let u=0;u<c.length;u++)c[u]=255*Po(c[u]/255);return s.putImageData(a,0,0),n}if(e.data){const n=e.data.slice(0);for(let s=0;s<n.length;s++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[s]=Math.floor(255*Po(n[s]/255)):n[s]=Po(n[s]);return{data:n,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Ex=0;class ka{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ex++}),this.uuid=Pr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let c;if(Array.isArray(a)){c=[];for(let u=0,A=a.length;u<A;u++)a[u].isDataTexture?c.push(df(a[u].image)):c.push(df(a[u]))}else c=df(a);s.url=c}return n||(e.images[this.uuid]=s),s}}function df(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?jg.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let xx=0;class Pi extends Oa{constructor(e=Pi.DEFAULT_IMAGE,n=Pi.DEFAULT_MAPPING,s=Dr,a=Dr,c=bi,u=hs,A=nr,m=Er,v=Pi.DEFAULT_ANISOTROPY,E=va){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xx++}),this.uuid=Pr(),this.name="",this.source=new ka(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=s,this.wrapT=a,this.magFilter=c,this.minFilter=u,this.anisotropy=v,this.format=A,this.internalFormat=null,this.type=m,this.offset=new ct(0,0),this.repeat=new ct(1,1),this.center=new ct(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=E,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),n||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Jc)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ga:e.x=e.x-Math.floor(e.x);break;case Dr:e.x=e.x<0?0:1;break;case ll:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ga:e.y=e.y-Math.floor(e.y);break;case Dr:e.y=e.y<0?0:1;break;case ll:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Pi.DEFAULT_IMAGE=null,Pi.DEFAULT_MAPPING=Jc,Pi.DEFAULT_ANISOTROPY=1;class pi{constructor(e=0,n=0,s=0,a=1){pi.prototype.isVector4=!0,this.x=e,this.y=n,this.z=s,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,s,a){return this.x=e,this.y=n,this.z=s,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,s=this.y,a=this.z,c=this.w,u=e.elements;return this.x=u[0]*n+u[4]*s+u[8]*a+u[12]*c,this.y=u[1]*n+u[5]*s+u[9]*a+u[13]*c,this.z=u[2]*n+u[6]*s+u[10]*a+u[14]*c,this.w=u[3]*n+u[7]*s+u[11]*a+u[15]*c,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,s,a,c;const m=e.elements,v=m[0],E=m[4],C=m[8],M=m[1],S=m[5],B=m[9],N=m[2],L=m[6],F=m[10];if(Math.abs(E-M)<.01&&Math.abs(C-N)<.01&&Math.abs(B-L)<.01){if(Math.abs(E+M)<.1&&Math.abs(C+N)<.1&&Math.abs(B+L)<.1&&Math.abs(v+S+F-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const H=(v+1)/2,X=(S+1)/2,$=(F+1)/2,ee=(E+M)/4,ie=(C+N)/4,ce=(B+L)/4;return H>X&&H>$?H<.01?(s=0,a=.707106781,c=.707106781):(s=Math.sqrt(H),a=ee/s,c=ie/s):X>$?X<.01?(s=.707106781,a=0,c=.707106781):(a=Math.sqrt(X),s=ee/a,c=ce/a):$<.01?(s=.707106781,a=.707106781,c=0):(c=Math.sqrt($),s=ie/c,a=ce/c),this.set(s,a,c,n),this}let O=Math.sqrt((L-B)*(L-B)+(C-N)*(C-N)+(M-E)*(M-E));return Math.abs(O)<.001&&(O=1),this.x=(L-B)/O,this.y=(C-N)/O,this.z=(M-E)/O,this.w=Math.acos((v+S+F-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Rn(this.x,e.x,n.x),this.y=Rn(this.y,e.y,n.y),this.z=Rn(this.z,e.z,n.z),this.w=Rn(this.w,e.w,n.w),this}clampScalar(e,n){return this.x=Rn(this.x,e,n),this.y=Rn(this.y,e,n),this.z=Rn(this.z,e,n),this.w=Rn(this.w,e,n),this}clampLength(e,n){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Rn(s,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,s){return this.x=e.x+(n.x-e.x)*s,this.y=e.y+(n.y-e.y)*s,this.z=e.z+(n.z-e.z)*s,this.w=e.w+(n.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class tp extends Oa{constructor(e=1,n=1,s={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new pi(0,0,e,n),this.scissorTest=!1,this.viewport=new pi(0,0,e,n);const a={width:e,height:n,depth:1};s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:bi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},s);const c=new Pi(a,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace);c.flipY=!1,c.generateMipmaps=s.generateMipmaps,c.internalFormat=s.internalFormat,this.textures=[];const u=s.count;for(let A=0;A<u;A++)this.textures[A]=c.clone(),this.textures[A].isRenderTargetTexture=!0,this.textures[A].renderTarget=this;this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=s.depthTexture,this.samples=s.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,n,s=1){if(this.width!==e||this.height!==n||this.depth!==s){this.width=e,this.height=n,this.depth=s;for(let a=0,c=this.textures.length;a<c;a++)this.textures[a].image.width=e,this.textures[a].image.height=n,this.textures[a].image.depth=s;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let s=0,a=e.textures.length;s<a;s++)this.textures[s]=e.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;const n=Object.assign({},e.texture.image);return this.texture.source=new ka(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Us extends tp{constructor(e=1,n=1,s={}){super(e,n,s),this.isWebGLRenderTarget=!0}}class gl extends Pi{constructor(e=null,n=1,s=1,a=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:s,depth:a},this.magFilter=yr,this.minFilter=yr,this.wrapR=Dr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class np extends Us{constructor(e=1,n=1,s=1,a={}){super(e,n,a),this.isWebGLArrayRenderTarget=!0,this.depth=s,this.texture=new gl(null,e,n,s),this.texture.isRenderTargetTexture=!0}}class bu extends Pi{constructor(e=null,n=1,s=1,a=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:s,depth:a},this.magFilter=yr,this.minFilter=yr,this.wrapR=Dr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class _x extends Us{constructor(e=1,n=1,s=1,a={}){super(e,n,a),this.isWebGL3DRenderTarget=!0,this.depth=s,this.texture=new bu(null,e,n,s),this.texture.isRenderTargetTexture=!0}}class ai{constructor(e=0,n=0,s=0,a=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=s,this._w=a}static slerpFlat(e,n,s,a,c,u,A){let m=s[a+0],v=s[a+1],E=s[a+2],C=s[a+3];const M=c[u+0],S=c[u+1],B=c[u+2],N=c[u+3];if(A===0)return e[n+0]=m,e[n+1]=v,e[n+2]=E,void(e[n+3]=C);if(A===1)return e[n+0]=M,e[n+1]=S,e[n+2]=B,void(e[n+3]=N);if(C!==N||m!==M||v!==S||E!==B){let L=1-A;const F=m*M+v*S+E*B+C*N,O=F>=0?1:-1,H=1-F*F;if(H>Number.EPSILON){const $=Math.sqrt(H),ee=Math.atan2($,F*O);L=Math.sin(L*ee)/$,A=Math.sin(A*ee)/$}const X=A*O;if(m=m*L+M*X,v=v*L+S*X,E=E*L+B*X,C=C*L+N*X,L===1-A){const $=1/Math.sqrt(m*m+v*v+E*E+C*C);m*=$,v*=$,E*=$,C*=$}}e[n]=m,e[n+1]=v,e[n+2]=E,e[n+3]=C}static multiplyQuaternionsFlat(e,n,s,a,c,u){const A=s[a],m=s[a+1],v=s[a+2],E=s[a+3],C=c[u],M=c[u+1],S=c[u+2],B=c[u+3];return e[n]=A*B+E*C+m*S-v*M,e[n+1]=m*B+E*M+v*C-A*S,e[n+2]=v*B+E*S+A*M-m*C,e[n+3]=E*B-A*C-m*M-v*S,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,s,a){return this._x=e,this._y=n,this._z=s,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const s=e._x,a=e._y,c=e._z,u=e._order,A=Math.cos,m=Math.sin,v=A(s/2),E=A(a/2),C=A(c/2),M=m(s/2),S=m(a/2),B=m(c/2);switch(u){case"XYZ":this._x=M*E*C+v*S*B,this._y=v*S*C-M*E*B,this._z=v*E*B+M*S*C,this._w=v*E*C-M*S*B;break;case"YXZ":this._x=M*E*C+v*S*B,this._y=v*S*C-M*E*B,this._z=v*E*B-M*S*C,this._w=v*E*C+M*S*B;break;case"ZXY":this._x=M*E*C-v*S*B,this._y=v*S*C+M*E*B,this._z=v*E*B+M*S*C,this._w=v*E*C-M*S*B;break;case"ZYX":this._x=M*E*C-v*S*B,this._y=v*S*C+M*E*B,this._z=v*E*B-M*S*C,this._w=v*E*C+M*S*B;break;case"YZX":this._x=M*E*C+v*S*B,this._y=v*S*C+M*E*B,this._z=v*E*B-M*S*C,this._w=v*E*C-M*S*B;break;case"XZY":this._x=M*E*C-v*S*B,this._y=v*S*C-M*E*B,this._z=v*E*B+M*S*C,this._w=v*E*C+M*S*B;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const s=n/2,a=Math.sin(s);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,s=n[0],a=n[4],c=n[8],u=n[1],A=n[5],m=n[9],v=n[2],E=n[6],C=n[10],M=s+A+C;if(M>0){const S=.5/Math.sqrt(M+1);this._w=.25/S,this._x=(E-m)*S,this._y=(c-v)*S,this._z=(u-a)*S}else if(s>A&&s>C){const S=2*Math.sqrt(1+s-A-C);this._w=(E-m)/S,this._x=.25*S,this._y=(a+u)/S,this._z=(c+v)/S}else if(A>C){const S=2*Math.sqrt(1+A-s-C);this._w=(c-v)/S,this._x=(a+u)/S,this._y=.25*S,this._z=(m+E)/S}else{const S=2*Math.sqrt(1+C-s-A);this._w=(u-a)/S,this._x=(c+v)/S,this._y=(m+E)/S,this._z=.25*S}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let s=e.dot(n)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rn(this.dot(e),-1,1)))}rotateTowards(e,n){const s=this.angleTo(e);if(s===0)return this;const a=Math.min(1,n/s);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const s=e._x,a=e._y,c=e._z,u=e._w,A=n._x,m=n._y,v=n._z,E=n._w;return this._x=s*E+u*A+a*v-c*m,this._y=a*E+u*m+c*A-s*v,this._z=c*E+u*v+s*m-a*A,this._w=u*E-s*A-a*m-c*v,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const s=this._x,a=this._y,c=this._z,u=this._w;let A=u*e._w+s*e._x+a*e._y+c*e._z;if(A<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,A=-A):this.copy(e),A>=1)return this._w=u,this._x=s,this._y=a,this._z=c,this;const m=1-A*A;if(m<=Number.EPSILON){const S=1-n;return this._w=S*u+n*this._w,this._x=S*s+n*this._x,this._y=S*a+n*this._y,this._z=S*c+n*this._z,this.normalize(),this}const v=Math.sqrt(m),E=Math.atan2(v,A),C=Math.sin((1-n)*E)/v,M=Math.sin(n*E)/v;return this._w=u*C+this._w*M,this._x=s*C+this._x*M,this._y=a*C+this._y*M,this._z=c*C+this._z*M,this._onChangeCallback(),this}slerpQuaternions(e,n,s){return this.copy(e).slerp(n,s)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),s=Math.random(),a=Math.sqrt(1-s),c=Math.sqrt(s);return this.set(a*Math.sin(e),a*Math.cos(e),c*Math.sin(n),c*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class R{constructor(e=0,n=0,s=0){R.prototype.isVector3=!0,this.x=e,this.y=n,this.z=s}set(e,n,s){return s===void 0&&(s=this.z),this.x=e,this.y=n,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(V.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(V.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,s=this.y,a=this.z,c=e.elements;return this.x=c[0]*n+c[3]*s+c[6]*a,this.y=c[1]*n+c[4]*s+c[7]*a,this.z=c[2]*n+c[5]*s+c[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,s=this.y,a=this.z,c=e.elements,u=1/(c[3]*n+c[7]*s+c[11]*a+c[15]);return this.x=(c[0]*n+c[4]*s+c[8]*a+c[12])*u,this.y=(c[1]*n+c[5]*s+c[9]*a+c[13])*u,this.z=(c[2]*n+c[6]*s+c[10]*a+c[14])*u,this}applyQuaternion(e){const n=this.x,s=this.y,a=this.z,c=e.x,u=e.y,A=e.z,m=e.w,v=2*(u*a-A*s),E=2*(A*n-c*a),C=2*(c*s-u*n);return this.x=n+m*v+u*C-A*E,this.y=s+m*E+A*v-c*C,this.z=a+m*C+c*E-u*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,s=this.y,a=this.z,c=e.elements;return this.x=c[0]*n+c[4]*s+c[8]*a,this.y=c[1]*n+c[5]*s+c[9]*a,this.z=c[2]*n+c[6]*s+c[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Rn(this.x,e.x,n.x),this.y=Rn(this.y,e.y,n.y),this.z=Rn(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=Rn(this.x,e,n),this.y=Rn(this.y,e,n),this.z=Rn(this.z,e,n),this}clampLength(e,n){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Rn(s,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,s){return this.x=e.x+(n.x-e.x)*s,this.y=e.y+(n.y-e.y)*s,this.z=e.z+(n.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const s=e.x,a=e.y,c=e.z,u=n.x,A=n.y,m=n.z;return this.x=a*m-c*A,this.y=c*u-s*m,this.z=s*A-a*u,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const s=e.dot(this)/n;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return I.copy(this).projectOnVector(e),this.sub(I)}reflect(e){return this.sub(I.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const s=this.dot(e)/n;return Math.acos(Rn(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,s=this.y-e.y,a=this.z-e.z;return n*n+s*s+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,s){const a=Math.sin(n)*e;return this.x=a*Math.sin(s),this.y=Math.cos(n)*e,this.z=a*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,s){return this.x=e*Math.sin(n),this.y=s,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=s,this.z=a,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,4*n)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,3*n)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=2*Math.random()-1,s=Math.sqrt(1-n*n);return this.x=s*Math.cos(e),this.y=n,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const I=new R,V=new ai;class te{constructor(e=new R(1/0,1/0,1/0),n=new R(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,s=e.length;n<s;n+=3)this.expandByPoint(Be.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,s=e.count;n<s;n++)this.expandByPoint(Be.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,s=e.length;n<s;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const s=Be.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0){const c=s.getAttribute("position");if(n===!0&&c!==void 0&&e.isInstancedMesh!==!0)for(let u=0,A=c.count;u<A;u++)e.isMesh===!0?e.getVertexPosition(u,Be):Be.fromBufferAttribute(c,u),Be.applyMatrix4(e.matrixWorld),this.expandByPoint(Be);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),et.copy(e.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),et.copy(s.boundingBox)),et.applyMatrix4(e.matrixWorld),this.union(et)}const a=e.children;for(let c=0,u=a.length;c<u;c++)this.expandByObject(a[c],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Be),Be.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,s;return e.normal.x>0?(n=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),n<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(pn),bn.subVectors(this.max,pn),At.subVectors(e.a,pn),Tt.subVectors(e.b,pn),zt.subVectors(e.c,pn),Ht.subVectors(Tt,At),Pt.subVectors(zt,Tt),_n.subVectors(At,zt);let n=[0,-Ht.z,Ht.y,0,-Pt.z,Pt.y,0,-_n.z,_n.y,Ht.z,0,-Ht.x,Pt.z,0,-Pt.x,_n.z,0,-_n.x,-Ht.y,Ht.x,0,-Pt.y,Pt.x,0,-_n.y,_n.x,0];return!!Ii(n,At,Tt,zt,bn)&&(n=[1,0,0,0,1,0,0,0,1],!!Ii(n,At,Tt,zt,bn)&&(gn.crossVectors(Ht,Pt),n=[gn.x,gn.y,gn.z],Ii(n,At,Tt,zt,bn)))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Be).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Be).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ie[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ie[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ie[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ie[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ie[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ie[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ie[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ie[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ie)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ie=[new R,new R,new R,new R,new R,new R,new R,new R],Be=new R,et=new te,At=new R,Tt=new R,zt=new R,Ht=new R,Pt=new R,_n=new R,pn=new R,bn=new R,gn=new R,mn=new R;function Ii(r,e,n,s,a){for(let c=0,u=r.length-3;c<=u;c+=3){mn.fromArray(r,c);const A=a.x*Math.abs(mn.x)+a.y*Math.abs(mn.y)+a.z*Math.abs(mn.z),m=e.dot(mn),v=n.dot(mn),E=s.dot(mn);if(Math.max(-Math.max(m,v,E),Math.min(m,v,E))>A)return!1}return!0}const Xi=new te,Fn=new R,Ai=new R;class on{constructor(e=new R,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const s=this.center;n!==void 0?s.copy(n):Xi.setFromPoints(e).getCenter(s);let a=0;for(let c=0,u=e.length;c<u;c++)a=Math.max(a,s.distanceToSquared(e[c]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const s=this.center.distanceToSquared(e);return n.copy(e),s>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Fn.subVectors(e,this.center);const n=Fn.lengthSq();if(n>this.radius*this.radius){const s=Math.sqrt(n),a=.5*(s-this.radius);this.center.addScaledVector(Fn,a/s),this.radius+=a}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Ai.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Fn.copy(e.center).add(Ai)),this.expandByPoint(Fn.copy(e.center).sub(Ai))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Pn=new R,Ci=new R,wi=new R,ni=new R,ir=new R,ds=new R,Xs=new R;class _r{constructor(e=new R,n=new R(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Pn)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const s=n.dot(this.direction);return s<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=Pn.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(Pn.copy(this.origin).addScaledVector(this.direction,n),Pn.distanceToSquared(e))}distanceSqToSegment(e,n,s,a){Ci.copy(e).add(n).multiplyScalar(.5),wi.copy(n).sub(e).normalize(),ni.copy(this.origin).sub(Ci);const c=.5*e.distanceTo(n),u=-this.direction.dot(wi),A=ni.dot(this.direction),m=-ni.dot(wi),v=ni.lengthSq(),E=Math.abs(1-u*u);let C,M,S,B;if(E>0)if(C=u*m-A,M=u*A-m,B=c*E,C>=0)if(M>=-B)if(M<=B){const N=1/E;C*=N,M*=N,S=C*(C+u*M+2*A)+M*(u*C+M+2*m)+v}else M=c,C=Math.max(0,-(u*M+A)),S=-C*C+M*(M+2*m)+v;else M=-c,C=Math.max(0,-(u*M+A)),S=-C*C+M*(M+2*m)+v;else M<=-B?(C=Math.max(0,-(-u*c+A)),M=C>0?-c:Math.min(Math.max(-c,-m),c),S=-C*C+M*(M+2*m)+v):M<=B?(C=0,M=Math.min(Math.max(-c,-m),c),S=M*(M+2*m)+v):(C=Math.max(0,-(u*c+A)),M=C>0?c:Math.min(Math.max(-c,-m),c),S=-C*C+M*(M+2*m)+v);else M=u>0?-c:c,C=Math.max(0,-(u*M+A)),S=-C*C+M*(M+2*m)+v;return s&&s.copy(this.origin).addScaledVector(this.direction,C),a&&a.copy(Ci).addScaledVector(wi,M),S}intersectSphere(e,n){Pn.subVectors(e.center,this.origin);const s=Pn.dot(this.direction),a=Pn.dot(Pn)-s*s,c=e.radius*e.radius;if(a>c)return null;const u=Math.sqrt(c-a),A=s-u,m=s+u;return m<0?null:A<0?this.at(m,n):this.at(A,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(e.normal)+e.constant)/n;return s>=0?s:null}intersectPlane(e,n){const s=this.distanceToPlane(e);return s===null?null:this.at(s,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let s,a,c,u,A,m;const v=1/this.direction.x,E=1/this.direction.y,C=1/this.direction.z,M=this.origin;return v>=0?(s=(e.min.x-M.x)*v,a=(e.max.x-M.x)*v):(s=(e.max.x-M.x)*v,a=(e.min.x-M.x)*v),E>=0?(c=(e.min.y-M.y)*E,u=(e.max.y-M.y)*E):(c=(e.max.y-M.y)*E,u=(e.min.y-M.y)*E),s>u||c>a?null:((c>s||isNaN(s))&&(s=c),(u<a||isNaN(a))&&(a=u),C>=0?(A=(e.min.z-M.z)*C,m=(e.max.z-M.z)*C):(A=(e.max.z-M.z)*C,m=(e.min.z-M.z)*C),s>m||A>a?null:((A>s||s!=s)&&(s=A),(m<a||a!=a)&&(a=m),a<0?null:this.at(s>=0?s:a,n)))}intersectsBox(e){return this.intersectBox(e,Pn)!==null}intersectTriangle(e,n,s,a,c){ir.subVectors(n,e),ds.subVectors(s,e),Xs.crossVectors(ir,ds);let u,A=this.direction.dot(Xs);if(A>0){if(a)return null;u=1}else{if(!(A<0))return null;u=-1,A=-A}ni.subVectors(this.origin,e);const m=u*this.direction.dot(ds.crossVectors(ni,ds));if(m<0)return null;const v=u*this.direction.dot(ir.cross(ni));if(v<0||m+v>A)return null;const E=-u*ni.dot(Xs);return E<0?null:this.at(E/A,c)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Qt{constructor(e,n,s,a,c,u,A,m,v,E,C,M,S,B,N,L){Qt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,s,a,c,u,A,m,v,E,C,M,S,B,N,L)}set(e,n,s,a,c,u,A,m,v,E,C,M,S,B,N,L){const F=this.elements;return F[0]=e,F[4]=n,F[8]=s,F[12]=a,F[1]=c,F[5]=u,F[9]=A,F[13]=m,F[2]=v,F[6]=E,F[10]=C,F[14]=M,F[3]=S,F[7]=B,F[11]=N,F[15]=L,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Qt().fromArray(this.elements)}copy(e){const n=this.elements,s=e.elements;return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],this}copyPosition(e){const n=this.elements,s=e.elements;return n[12]=s[12],n[13]=s[13],n[14]=s[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,s){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,n,s){return this.set(e.x,n.x,s.x,0,e.y,n.y,s.y,0,e.z,n.z,s.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,s=e.elements,a=1/Kr.setFromMatrixColumn(e,0).length(),c=1/Kr.setFromMatrixColumn(e,1).length(),u=1/Kr.setFromMatrixColumn(e,2).length();return n[0]=s[0]*a,n[1]=s[1]*a,n[2]=s[2]*a,n[3]=0,n[4]=s[4]*c,n[5]=s[5]*c,n[6]=s[6]*c,n[7]=0,n[8]=s[8]*u,n[9]=s[9]*u,n[10]=s[10]*u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,s=e.x,a=e.y,c=e.z,u=Math.cos(s),A=Math.sin(s),m=Math.cos(a),v=Math.sin(a),E=Math.cos(c),C=Math.sin(c);if(e.order==="XYZ"){const M=u*E,S=u*C,B=A*E,N=A*C;n[0]=m*E,n[4]=-m*C,n[8]=v,n[1]=S+B*v,n[5]=M-N*v,n[9]=-A*m,n[2]=N-M*v,n[6]=B+S*v,n[10]=u*m}else if(e.order==="YXZ"){const M=m*E,S=m*C,B=v*E,N=v*C;n[0]=M+N*A,n[4]=B*A-S,n[8]=u*v,n[1]=u*C,n[5]=u*E,n[9]=-A,n[2]=S*A-B,n[6]=N+M*A,n[10]=u*m}else if(e.order==="ZXY"){const M=m*E,S=m*C,B=v*E,N=v*C;n[0]=M-N*A,n[4]=-u*C,n[8]=B+S*A,n[1]=S+B*A,n[5]=u*E,n[9]=N-M*A,n[2]=-u*v,n[6]=A,n[10]=u*m}else if(e.order==="ZYX"){const M=u*E,S=u*C,B=A*E,N=A*C;n[0]=m*E,n[4]=B*v-S,n[8]=M*v+N,n[1]=m*C,n[5]=N*v+M,n[9]=S*v-B,n[2]=-v,n[6]=A*m,n[10]=u*m}else if(e.order==="YZX"){const M=u*m,S=u*v,B=A*m,N=A*v;n[0]=m*E,n[4]=N-M*C,n[8]=B*C+S,n[1]=C,n[5]=u*E,n[9]=-A*E,n[2]=-v*E,n[6]=S*C+B,n[10]=M-N*C}else if(e.order==="XZY"){const M=u*m,S=u*v,B=A*m,N=A*v;n[0]=m*E,n[4]=-C,n[8]=v*E,n[1]=M*C+N,n[5]=u*E,n[9]=S*C-B,n[2]=B*C-S,n[6]=A*E,n[10]=N*C+M}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ro,e,so)}lookAt(e,n,s){const a=this.elements;return jn.subVectors(e,n),jn.lengthSq()===0&&(jn.z=1),jn.normalize(),Ys.crossVectors(s,jn),Ys.lengthSq()===0&&(Math.abs(s.z)===1?jn.x+=1e-4:jn.z+=1e-4,jn.normalize(),Ys.crossVectors(s,jn)),Ys.normalize(),br.crossVectors(jn,Ys),a[0]=Ys.x,a[4]=br.x,a[8]=jn.x,a[1]=Ys.y,a[5]=br.y,a[9]=jn.y,a[2]=Ys.z,a[6]=br.z,a[10]=jn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const s=e.elements,a=n.elements,c=this.elements,u=s[0],A=s[4],m=s[8],v=s[12],E=s[1],C=s[5],M=s[9],S=s[13],B=s[2],N=s[6],L=s[10],F=s[14],O=s[3],H=s[7],X=s[11],$=s[15],ee=a[0],ie=a[4],ce=a[8],oe=a[12],Se=a[1],Ne=a[5],ke=a[9],Oe=a[13],Te=a[2],Je=a[6],st=a[10],Et=a[14],dt=a[3],Bt=a[7],qt=a[11],Kt=a[15];return c[0]=u*ee+A*Se+m*Te+v*dt,c[4]=u*ie+A*Ne+m*Je+v*Bt,c[8]=u*ce+A*ke+m*st+v*qt,c[12]=u*oe+A*Oe+m*Et+v*Kt,c[1]=E*ee+C*Se+M*Te+S*dt,c[5]=E*ie+C*Ne+M*Je+S*Bt,c[9]=E*ce+C*ke+M*st+S*qt,c[13]=E*oe+C*Oe+M*Et+S*Kt,c[2]=B*ee+N*Se+L*Te+F*dt,c[6]=B*ie+N*Ne+L*Je+F*Bt,c[10]=B*ce+N*ke+L*st+F*qt,c[14]=B*oe+N*Oe+L*Et+F*Kt,c[3]=O*ee+H*Se+X*Te+$*dt,c[7]=O*ie+H*Ne+X*Je+$*Bt,c[11]=O*ce+H*ke+X*st+$*qt,c[15]=O*oe+H*Oe+X*Et+$*Kt,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],s=e[4],a=e[8],c=e[12],u=e[1],A=e[5],m=e[9],v=e[13],E=e[2],C=e[6],M=e[10],S=e[14];return e[3]*(+c*m*C-a*v*C-c*A*M+s*v*M+a*A*S-s*m*S)+e[7]*(+n*m*S-n*v*M+c*u*M-a*u*S+a*v*E-c*m*E)+e[11]*(+n*v*C-n*A*S-c*u*C+s*u*S+c*A*E-s*v*E)+e[15]*(-a*A*E-n*m*C+n*A*M+a*u*C-s*u*M+s*m*E)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,s){const a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=n,a[14]=s),this}invert(){const e=this.elements,n=e[0],s=e[1],a=e[2],c=e[3],u=e[4],A=e[5],m=e[6],v=e[7],E=e[8],C=e[9],M=e[10],S=e[11],B=e[12],N=e[13],L=e[14],F=e[15],O=C*L*v-N*M*v+N*m*S-A*L*S-C*m*F+A*M*F,H=B*M*v-E*L*v-B*m*S+u*L*S+E*m*F-u*M*F,X=E*N*v-B*C*v+B*A*S-u*N*S-E*A*F+u*C*F,$=B*C*m-E*N*m-B*A*M+u*N*M+E*A*L-u*C*L,ee=n*O+s*H+a*X+c*$;if(ee===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ie=1/ee;return e[0]=O*ie,e[1]=(N*M*c-C*L*c-N*a*S+s*L*S+C*a*F-s*M*F)*ie,e[2]=(A*L*c-N*m*c+N*a*v-s*L*v-A*a*F+s*m*F)*ie,e[3]=(C*m*c-A*M*c-C*a*v+s*M*v+A*a*S-s*m*S)*ie,e[4]=H*ie,e[5]=(E*L*c-B*M*c+B*a*S-n*L*S-E*a*F+n*M*F)*ie,e[6]=(B*m*c-u*L*c-B*a*v+n*L*v+u*a*F-n*m*F)*ie,e[7]=(u*M*c-E*m*c+E*a*v-n*M*v-u*a*S+n*m*S)*ie,e[8]=X*ie,e[9]=(B*C*c-E*N*c-B*s*S+n*N*S+E*s*F-n*C*F)*ie,e[10]=(u*N*c-B*A*c+B*s*v-n*N*v-u*s*F+n*A*F)*ie,e[11]=(E*A*c-u*C*c-E*s*v+n*C*v+u*s*S-n*A*S)*ie,e[12]=$*ie,e[13]=(E*N*a-B*C*a+B*s*M-n*N*M-E*s*L+n*C*L)*ie,e[14]=(B*A*a-u*N*a-B*s*m+n*N*m+u*s*L-n*A*L)*ie,e[15]=(u*C*a-E*A*a+E*s*m-n*C*m-u*s*M+n*A*M)*ie,this}scale(e){const n=this.elements,s=e.x,a=e.y,c=e.z;return n[0]*=s,n[4]*=a,n[8]*=c,n[1]*=s,n[5]*=a,n[9]*=c,n[2]*=s,n[6]*=a,n[10]*=c,n[3]*=s,n[7]*=a,n[11]*=c,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,s,a))}makeTranslation(e,n,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,s,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,n,-s,0,0,s,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),s=Math.sin(e);return this.set(n,0,s,0,0,1,0,0,-s,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),s=Math.sin(e);return this.set(n,-s,0,0,s,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const s=Math.cos(n),a=Math.sin(n),c=1-s,u=e.x,A=e.y,m=e.z,v=c*u,E=c*A;return this.set(v*u+s,v*A-a*m,v*m+a*A,0,v*A+a*m,E*A+s,E*m-a*u,0,v*m-a*A,E*m+a*u,c*m*m+s,0,0,0,0,1),this}makeScale(e,n,s){return this.set(e,0,0,0,0,n,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,n,s,a,c,u){return this.set(1,s,c,0,e,1,u,0,n,a,1,0,0,0,0,1),this}compose(e,n,s){const a=this.elements,c=n._x,u=n._y,A=n._z,m=n._w,v=c+c,E=u+u,C=A+A,M=c*v,S=c*E,B=c*C,N=u*E,L=u*C,F=A*C,O=m*v,H=m*E,X=m*C,$=s.x,ee=s.y,ie=s.z;return a[0]=(1-(N+F))*$,a[1]=(S+X)*$,a[2]=(B-H)*$,a[3]=0,a[4]=(S-X)*ee,a[5]=(1-(M+F))*ee,a[6]=(L+O)*ee,a[7]=0,a[8]=(B+H)*ie,a[9]=(L-O)*ie,a[10]=(1-(M+N))*ie,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,n,s){const a=this.elements;let c=Kr.set(a[0],a[1],a[2]).length();const u=Kr.set(a[4],a[5],a[6]).length(),A=Kr.set(a[8],a[9],a[10]).length();this.determinant()<0&&(c=-c),e.x=a[12],e.y=a[13],e.z=a[14],gi.copy(this);const m=1/c,v=1/u,E=1/A;return gi.elements[0]*=m,gi.elements[1]*=m,gi.elements[2]*=m,gi.elements[4]*=v,gi.elements[5]*=v,gi.elements[6]*=v,gi.elements[8]*=E,gi.elements[9]*=E,gi.elements[10]*=E,n.setFromRotationMatrix(gi),s.x=c,s.y=u,s.z=A,this}makePerspective(e,n,s,a,c,u,A=ya){const m=this.elements,v=2*c/(n-e),E=2*c/(s-a),C=(n+e)/(n-e),M=(s+a)/(s-a);let S,B;if(A===ya)S=-(u+c)/(u-c),B=-2*u*c/(u-c);else{if(A!==no)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+A);S=-u/(u-c),B=-u*c/(u-c)}return m[0]=v,m[4]=0,m[8]=C,m[12]=0,m[1]=0,m[5]=E,m[9]=M,m[13]=0,m[2]=0,m[6]=0,m[10]=S,m[14]=B,m[3]=0,m[7]=0,m[11]=-1,m[15]=0,this}makeOrthographic(e,n,s,a,c,u,A=ya){const m=this.elements,v=1/(n-e),E=1/(s-a),C=1/(u-c),M=(n+e)*v,S=(s+a)*E;let B,N;if(A===ya)B=(u+c)*C,N=-2*C;else{if(A!==no)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+A);B=c*C,N=-1*C}return m[0]=2*v,m[4]=0,m[8]=0,m[12]=-M,m[1]=0,m[5]=2*E,m[9]=0,m[13]=-S,m[2]=0,m[6]=0,m[10]=N,m[14]=-B,m[3]=0,m[7]=0,m[11]=0,m[15]=1,this}equals(e){const n=this.elements,s=e.elements;for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}fromArray(e,n=0){for(let s=0;s<16;s++)this.elements[s]=e[s+n];return this}toArray(e=[],n=0){const s=this.elements;return e[n]=s[0],e[n+1]=s[1],e[n+2]=s[2],e[n+3]=s[3],e[n+4]=s[4],e[n+5]=s[5],e[n+6]=s[6],e[n+7]=s[7],e[n+8]=s[8],e[n+9]=s[9],e[n+10]=s[10],e[n+11]=s[11],e[n+12]=s[12],e[n+13]=s[13],e[n+14]=s[14],e[n+15]=s[15],e}}const Kr=new R,gi=new Qt,ro=new R(0,0,0),so=new R(1,1,1),Ys=new R,br=new R,jn=new R,ps=new Qt,Ks=new ai;class ii{constructor(e=0,n=0,s=0,a=ii.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=s,this._order=a}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,s,a=this._order){return this._x=e,this._y=n,this._z=s,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,s=!0){const a=e.elements,c=a[0],u=a[4],A=a[8],m=a[1],v=a[5],E=a[9],C=a[2],M=a[6],S=a[10];switch(n){case"XYZ":this._y=Math.asin(Rn(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(-E,S),this._z=Math.atan2(-u,c)):(this._x=Math.atan2(M,v),this._z=0);break;case"YXZ":this._x=Math.asin(-Rn(E,-1,1)),Math.abs(E)<.9999999?(this._y=Math.atan2(A,S),this._z=Math.atan2(m,v)):(this._y=Math.atan2(-C,c),this._z=0);break;case"ZXY":this._x=Math.asin(Rn(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-C,S),this._z=Math.atan2(-u,v)):(this._y=0,this._z=Math.atan2(m,c));break;case"ZYX":this._y=Math.asin(-Rn(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(M,S),this._z=Math.atan2(m,c)):(this._x=0,this._z=Math.atan2(-u,v));break;case"YZX":this._z=Math.asin(Rn(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(-E,v),this._y=Math.atan2(-C,c)):(this._x=0,this._y=Math.atan2(A,S));break;case"XZY":this._z=Math.asin(-Rn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(M,v),this._y=Math.atan2(A,c)):(this._x=Math.atan2(-E,S),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,s){return ps.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ps,n,s)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return Ks.setFromEuler(this),this.setFromQuaternion(Ks,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ii.DEFAULT_ORDER="XYZ";class oc{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let qg=0;const pf=new R,Uo=new ai,No=new Qt,ip=new R,lc=new R,bx=new R,Xg=new ai,Yg=new R(1,0,0),Af=new R(0,1,0),ff=new R(0,0,1),Kg={type:"added"},Cx={type:"removed"},xa={type:"childadded",child:null},ch={type:"childremoved",child:null};class kn extends Oa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:qg++}),this.uuid=Pr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=kn.DEFAULT_UP.clone();const e=new R,n=new ii,s=new ai,a=new R(1,1,1);n._onChange(function(){s.setFromEuler(n,!1)}),s._onChange(function(){n.setFromQuaternion(s,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new Qt},normalMatrix:{value:new wn}}),this.matrix=new Qt,this.matrixWorld=new Qt,this.matrixAutoUpdate=kn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new oc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Uo.setFromAxisAngle(e,n),this.quaternion.multiply(Uo),this}rotateOnWorldAxis(e,n){return Uo.setFromAxisAngle(e,n),this.quaternion.premultiply(Uo),this}rotateX(e){return this.rotateOnAxis(Yg,e)}rotateY(e){return this.rotateOnAxis(Af,e)}rotateZ(e){return this.rotateOnAxis(ff,e)}translateOnAxis(e,n){return pf.copy(e).applyQuaternion(this.quaternion),this.position.add(pf.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(Yg,e)}translateY(e){return this.translateOnAxis(Af,e)}translateZ(e){return this.translateOnAxis(ff,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(No.copy(this.matrixWorld).invert())}lookAt(e,n,s){e.isVector3?ip.copy(e):ip.set(e,n,s);const a=this.parent;this.updateWorldMatrix(!0,!1),lc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?No.lookAt(lc,ip,this.up):No.lookAt(ip,lc,this.up),this.quaternion.setFromRotationMatrix(No),a&&(No.extractRotation(a.matrixWorld),Uo.setFromRotationMatrix(No),this.quaternion.premultiply(Uo.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Kg),xa.child=e,this.dispatchEvent(xa),xa.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Cx),ch.child=e,this.dispatchEvent(ch),ch.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),No.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),No.multiply(e.parent.matrixWorld)),e.applyMatrix4(No),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Kg),xa.child=e,this.dispatchEvent(xa),xa.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let s=0,a=this.children.length;s<a;s++){const c=this.children[s].getObjectByProperty(e,n);if(c!==void 0)return c}}getObjectsByProperty(e,n,s=[]){this[e]===n&&s.push(this);const a=this.children;for(let c=0,u=a.length;c<u;c++)a[c].getObjectsByProperty(e,n,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lc,e,bx),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(lc,Xg,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].updateMatrixWorld(e)}updateWorldMatrix(e,n){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const a=this.children;for(let c=0,u=a.length;c<u;c++)a[c].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",s={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const a={};function c(A,m){return A[m.uuid]===void 0&&(A[m.uuid]=m.toJSON(e)),m.uuid}if(a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.castShadow===!0&&(a.castShadow=!0),this.receiveShadow===!0&&(a.receiveShadow=!0),this.visible===!1&&(a.visible=!1),this.frustumCulled===!1&&(a.frustumCulled=!1),this.renderOrder!==0&&(a.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),a.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(a.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(a.type="BatchedMesh",a.perObjectFrustumCulled=this.perObjectFrustumCulled,a.sortObjects=this.sortObjects,a.drawRanges=this._drawRanges,a.reservedRanges=this._reservedRanges,a.visibility=this._visibility,a.active=this._active,a.bounds=this._bounds.map(A=>({boxInitialized:A.boxInitialized,boxMin:A.box.min.toArray(),boxMax:A.box.max.toArray(),sphereInitialized:A.sphereInitialized,sphereRadius:A.sphere.radius,sphereCenter:A.sphere.center.toArray()})),a.maxInstanceCount=this._maxInstanceCount,a.maxVertexCount=this._maxVertexCount,a.maxIndexCount=this._maxIndexCount,a.geometryInitialized=this._geometryInitialized,a.geometryCount=this._geometryCount,a.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(a.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(a.boundingSphere={center:a.boundingSphere.center.toArray(),radius:a.boundingSphere.radius}),this.boundingBox!==null&&(a.boundingBox={min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(a.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=c(e.geometries,this.geometry);const A=this.geometry.parameters;if(A!==void 0&&A.shapes!==void 0){const m=A.shapes;if(Array.isArray(m))for(let v=0,E=m.length;v<E;v++){const C=m[v];c(e.shapes,C)}else c(e.shapes,m)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(e.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const A=[];for(let m=0,v=this.material.length;m<v;m++)A.push(c(e.materials,this.material[m]));a.material=A}else a.material=c(e.materials,this.material);if(this.children.length>0){a.children=[];for(let A=0;A<this.children.length;A++)a.children.push(this.children[A].toJSON(e).object)}if(this.animations.length>0){a.animations=[];for(let A=0;A<this.animations.length;A++){const m=this.animations[A];a.animations.push(c(e.animations,m))}}if(n){const A=u(e.geometries),m=u(e.materials),v=u(e.textures),E=u(e.images),C=u(e.shapes),M=u(e.skeletons),S=u(e.animations),B=u(e.nodes);A.length>0&&(s.geometries=A),m.length>0&&(s.materials=m),v.length>0&&(s.textures=v),E.length>0&&(s.images=E),C.length>0&&(s.shapes=C),M.length>0&&(s.skeletons=M),S.length>0&&(s.animations=S),B.length>0&&(s.nodes=B)}return s.object=a,s;function u(A){const m=[];for(const v in A){const E=A[v];delete E.metadata,m.push(E)}return m}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let s=0;s<e.children.length;s++){const a=e.children[s];this.add(a.clone())}return this}}kn.DEFAULT_UP=new R(0,1,0),kn.DEFAULT_MATRIX_AUTO_UPDATE=!0,kn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _a=new R,Qa=new R,rp=new R,ao=new R,cc=new R,hc=new R,Jg=new R,mf=new R,Cu=new R,sp=new R,wx=new pi,Mx=new pi,Sx=new pi;class Js{constructor(e=new R,n=new R,s=new R){this.a=e,this.b=n,this.c=s}static getNormal(e,n,s,a){a.subVectors(s,n),_a.subVectors(e,n),a.cross(_a);const c=a.lengthSq();return c>0?a.multiplyScalar(1/Math.sqrt(c)):a.set(0,0,0)}static getBarycoord(e,n,s,a,c){_a.subVectors(a,n),Qa.subVectors(s,n),rp.subVectors(e,n);const u=_a.dot(_a),A=_a.dot(Qa),m=_a.dot(rp),v=Qa.dot(Qa),E=Qa.dot(rp),C=u*v-A*A;if(C===0)return c.set(0,0,0),null;const M=1/C,S=(v*m-A*E)*M,B=(u*E-A*m)*M;return c.set(1-S-B,B,S)}static containsPoint(e,n,s,a){return this.getBarycoord(e,n,s,a,ao)!==null&&ao.x>=0&&ao.y>=0&&ao.x+ao.y<=1}static getInterpolation(e,n,s,a,c,u,A,m){return this.getBarycoord(e,n,s,a,ao)===null?(m.x=0,m.y=0,"z"in m&&(m.z=0),"w"in m&&(m.w=0),null):(m.setScalar(0),m.addScaledVector(c,ao.x),m.addScaledVector(u,ao.y),m.addScaledVector(A,ao.z),m)}static getInterpolatedAttribute(e,n,s,a,c,u){return wx.setScalar(0),Mx.setScalar(0),Sx.setScalar(0),wx.fromBufferAttribute(e,n),Mx.fromBufferAttribute(e,s),Sx.fromBufferAttribute(e,a),u.setScalar(0),u.addScaledVector(wx,c.x),u.addScaledVector(Mx,c.y),u.addScaledVector(Sx,c.z),u}static isFrontFacing(e,n,s,a){return _a.subVectors(s,n),Qa.subVectors(e,n),_a.cross(Qa).dot(a)<0}set(e,n,s){return this.a.copy(e),this.b.copy(n),this.c.copy(s),this}setFromPointsAndIndices(e,n,s,a){return this.a.copy(e[n]),this.b.copy(e[s]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,n,s,a){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,a),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _a.subVectors(this.c,this.b),Qa.subVectors(this.a,this.b),.5*_a.cross(Qa).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Js.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Js.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,s,a,c){return Js.getInterpolation(e,this.a,this.b,this.c,n,s,a,c)}containsPoint(e){return Js.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Js.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const s=this.a,a=this.b,c=this.c;let u,A;cc.subVectors(a,s),hc.subVectors(c,s),mf.subVectors(e,s);const m=cc.dot(mf),v=hc.dot(mf);if(m<=0&&v<=0)return n.copy(s);Cu.subVectors(e,a);const E=cc.dot(Cu),C=hc.dot(Cu);if(E>=0&&C<=E)return n.copy(a);const M=m*C-E*v;if(M<=0&&m>=0&&E<=0)return u=m/(m-E),n.copy(s).addScaledVector(cc,u);sp.subVectors(e,c);const S=cc.dot(sp),B=hc.dot(sp);if(B>=0&&S<=B)return n.copy(c);const N=S*v-m*B;if(N<=0&&v>=0&&B<=0)return A=v/(v-B),n.copy(s).addScaledVector(hc,A);const L=E*B-S*C;if(L<=0&&C-E>=0&&S-B>=0)return Jg.subVectors(c,a),A=(C-E)/(C-E+(S-B)),n.copy(a).addScaledVector(Jg,A);const F=1/(L+N+M);return u=N*F,A=M*F,n.copy(s).addScaledVector(cc,u).addScaledVector(hc,A)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const sS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hh={h:0,s:0,l:0},$g={h:0,s:0,l:0};function Ix(r,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?r+6*(e-r)*n:n<.5?e:n<2/3?r+6*(e-r)*(2/3-n):r}class Mt{constructor(e,n,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,s)}set(e,n,s){if(n===void 0&&s===void 0){const a=e;a&&a.isColor?this.copy(a):typeof a=="number"?this.setHex(a):typeof a=="string"&&this.setStyle(a)}else this.setRGB(e,n,s);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=si){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Dn.toWorkingColorSpace(this,n),this}setRGB(e,n,s,a=Dn.workingColorSpace){return this.r=e,this.g=n,this.b=s,Dn.toWorkingColorSpace(this,a),this}setHSL(e,n,s,a=Dn.workingColorSpace){if(e=cf(e,1),n=Rn(n,0,1),s=Rn(s,0,1),n===0)this.r=this.g=this.b=s;else{const c=s<=.5?s*(1+n):s+n-s*n,u=2*s-c;this.r=Ix(u,c,e+1/3),this.g=Ix(u,c,e),this.b=Ix(u,c,e-1/3)}return Dn.toWorkingColorSpace(this,a),this}setStyle(e,n=si){function s(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^(\w+)\(([^\)]*)\)/.exec(e)){let c;const u=a[1],A=a[2];switch(u){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(A))return s(c[4]),this.setRGB(Math.min(255,parseInt(c[1],10))/255,Math.min(255,parseInt(c[2],10))/255,Math.min(255,parseInt(c[3],10))/255,n);if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(A))return s(c[4]),this.setRGB(Math.min(100,parseInt(c[1],10))/100,Math.min(100,parseInt(c[2],10))/100,Math.min(100,parseInt(c[3],10))/100,n);break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(A))return s(c[4]),this.setHSL(parseFloat(c[1])/360,parseFloat(c[2])/100,parseFloat(c[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const c=a[1],u=c.length;if(u===3)return this.setRGB(parseInt(c.charAt(0),16)/15,parseInt(c.charAt(1),16)/15,parseInt(c.charAt(2),16)/15,n);if(u===6)return this.setHex(parseInt(c,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=si){const s=sS[e.toLowerCase()];return s!==void 0?this.setHex(s,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Po(e.r),this.g=Po(e.g),this.b=Po(e.b),this}copyLinearToSRGB(e){return this.r=Ea(e.r),this.g=Ea(e.g),this.b=Ea(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=si){return Dn.fromWorkingColorSpace(Ns.copy(this),e),65536*Math.round(Rn(255*Ns.r,0,255))+256*Math.round(Rn(255*Ns.g,0,255))+Math.round(Rn(255*Ns.b,0,255))}getHexString(e=si){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Dn.workingColorSpace){Dn.fromWorkingColorSpace(Ns.copy(this),n);const s=Ns.r,a=Ns.g,c=Ns.b,u=Math.max(s,a,c),A=Math.min(s,a,c);let m,v;const E=(A+u)/2;if(A===u)m=0,v=0;else{const C=u-A;switch(v=E<=.5?C/(u+A):C/(2-u-A),u){case s:m=(a-c)/C+(a<c?6:0);break;case a:m=(c-s)/C+2;break;case c:m=(s-a)/C+4}m/=6}return e.h=m,e.s=v,e.l=E,e}getRGB(e,n=Dn.workingColorSpace){return Dn.fromWorkingColorSpace(Ns.copy(this),n),e.r=Ns.r,e.g=Ns.g,e.b=Ns.b,e}getStyle(e=si){Dn.fromWorkingColorSpace(Ns.copy(this),e);const n=Ns.r,s=Ns.g,a=Ns.b;return e!==si?`color(${e} ${n.toFixed(3)} ${s.toFixed(3)} ${a.toFixed(3)})`:`rgb(${Math.round(255*n)},${Math.round(255*s)},${Math.round(255*a)})`}offsetHSL(e,n,s){return this.getHSL(hh),this.setHSL(hh.h+e,hh.s+n,hh.l+s)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,s){return this.r=e.r+(n.r-e.r)*s,this.g=e.g+(n.g-e.g)*s,this.b=e.b+(n.b-e.b)*s,this}lerpHSL(e,n){this.getHSL(hh),e.getHSL($g);const s=_u(hh.h,$g.h,n),a=_u(hh.s,$g.s,n),c=_u(hh.l,$g.l,n);return this.setHSL(s,a,c),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,s=this.g,a=this.b,c=e.elements;return this.r=c[0]*n+c[3]*s+c[6]*a,this.g=c[1]*n+c[4]*s+c[7]*a,this.b=c[2]*n+c[5]*s+c[8]*a,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ns=new Mt;Mt.NAMES=sS;let RN=0;class Ur extends Oa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:RN++}),this.uuid=Pr(),this.name="",this.type="Material",this.blending=rn,this.side=ut,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Vl,this.blendDst=Wl,this.blendEquation=ui,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Mt(0,0,0),this.blendAlpha=0,this.depthFunc=cs,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=rf,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ic,this.stencilZFail=ic,this.stencilZPass=ic,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const s=e[n];if(s===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const a=this[n];a!==void 0?a&&a.isColor?a.set(s):a&&a.isVector3&&s&&s.isVector3?a.copy(s):this[n]=s:console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`)}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function a(c){const u=[];for(const A in c){const m=c[A];delete m.metadata,u.push(m)}return u}if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==rn&&(s.blending=this.blending),this.side!==ut&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==Vl&&(s.blendSrc=this.blendSrc),this.blendDst!==Wl&&(s.blendDst=this.blendDst),this.blendEquation!==ui&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==cs&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==rf&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ic&&(s.stencilFail=this.stencilFail),this.stencilZFail!==ic&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==ic&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData),n){const c=a(e.textures),u=a(e.images);c.length>0&&(s.textures=c),u.length>0&&(s.images=u)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let s=null;if(n!==null){const a=n.length;s=new Array(a);for(let c=0;c!==a;++c)s[c]=n[c].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Jr extends Ur{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ii,this.combine=bs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const uc=LN();function LN(){const r=new ArrayBuffer(4),e=new Float32Array(r),n=new Uint32Array(r),s=new Uint32Array(512),a=new Uint32Array(512);for(let m=0;m<256;++m){const v=m-127;v<-27?(s[m]=0,s[256|m]=32768,a[m]=24,a[256|m]=24):v<-14?(s[m]=1024>>-v-14,s[256|m]=1024>>-v-14|32768,a[m]=-v-1,a[256|m]=-v-1):v<=15?(s[m]=v+15<<10,s[256|m]=v+15<<10|32768,a[m]=13,a[256|m]=13):v<128?(s[m]=31744,s[256|m]=64512,a[m]=24,a[256|m]=24):(s[m]=31744,s[256|m]=64512,a[m]=13,a[256|m]=13)}const c=new Uint32Array(2048),u=new Uint32Array(64),A=new Uint32Array(64);for(let m=1;m<1024;++m){let v=m<<13,E=0;for(;!(8388608&v);)v<<=1,E-=8388608;v&=-8388609,E+=947912704,c[m]=v|E}for(let m=1024;m<2048;++m)c[m]=939524096+(m-1024<<13);for(let m=1;m<31;++m)u[m]=m<<23;u[31]=1199570944,u[32]=2147483648;for(let m=33;m<63;++m)u[m]=2147483648+(m-32<<23);u[63]=3347054592;for(let m=1;m<64;++m)m!==32&&(A[m]=1024);return{floatView:e,uint32View:n,baseTable:s,shiftTable:a,mantissaTable:c,exponentTable:u,offsetTable:A}}function ba(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Rn(r,-65504,65504),uc.floatView[0]=r;const e=uc.uint32View[0],n=e>>23&511;return uc.baseTable[n]+((8388607&e)>>uc.shiftTable[n])}function gf(r){const e=r>>10;return uc.uint32View[0]=uc.mantissaTable[uc.offsetTable[e]+(1023&r)]+uc.exponentTable[e],uc.floatView[0]}const Zg={toHalfFloat:ba,fromHalfFloat:gf},Gr=new R,e0=new ct;let DN=0;class qn{constructor(e,n,s=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:DN++}),this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=s,this.usage=rc,this.updateRanges=[],this.gpuType=Ir,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,s){e*=this.itemSize,s*=n.itemSize;for(let a=0,c=this.itemSize;a<c;a++)this.array[e+a]=n.array[s+a];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,s=this.count;n<s;n++)e0.fromBufferAttribute(this,n),e0.applyMatrix3(e),this.setXY(n,e0.x,e0.y);else if(this.itemSize===3)for(let n=0,s=this.count;n<s;n++)Gr.fromBufferAttribute(this,n),Gr.applyMatrix3(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}applyMatrix4(e){for(let n=0,s=this.count;n<s;n++)Gr.fromBufferAttribute(this,n),Gr.applyMatrix4(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}applyNormalMatrix(e){for(let n=0,s=this.count;n<s;n++)Gr.fromBufferAttribute(this,n),Gr.applyNormalMatrix(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}transformDirection(e){for(let n=0,s=this.count;n<s;n++)Gr.fromBufferAttribute(this,n),Gr.transformDirection(e),this.setXYZ(n,Gr.x,Gr.y,Gr.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let s=this.array[e*this.itemSize+n];return this.normalized&&(s=ws(s,this.array)),s}setComponent(e,n,s){return this.normalized&&(s=Nn(s,this.array)),this.array[e*this.itemSize+n]=s,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=ws(n,this.array)),n}setX(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=ws(n,this.array)),n}setY(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=ws(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=ws(n,this.array)),n}setW(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,s){return e*=this.itemSize,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array)),this.array[e+0]=n,this.array[e+1]=s,this}setXYZ(e,n,s,a){return e*=this.itemSize,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array),a=Nn(a,this.array)),this.array[e+0]=n,this.array[e+1]=s,this.array[e+2]=a,this}setXYZW(e,n,s,a,c){return e*=this.itemSize,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array),a=Nn(a,this.array),c=Nn(c,this.array)),this.array[e+0]=n,this.array[e+1]=s,this.array[e+2]=a,this.array[e+3]=c,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==rc&&(e.usage=this.usage),e}}class PN extends qn{constructor(e,n,s){super(new Int8Array(e),n,s)}}class UN extends qn{constructor(e,n,s){super(new Uint8Array(e),n,s)}}class NN extends qn{constructor(e,n,s){super(new Uint8ClampedArray(e),n,s)}}class FN extends qn{constructor(e,n,s){super(new Int16Array(e),n,s)}}class Tx extends qn{constructor(e,n,s){super(new Uint16Array(e),n,s)}}class ON extends qn{constructor(e,n,s){super(new Int32Array(e),n,s)}}class Bx extends qn{constructor(e,n,s){super(new Uint32Array(e),n,s)}}class kN extends qn{constructor(e,n,s){super(new Uint16Array(e),n,s),this.isFloat16BufferAttribute=!0}getX(e){let n=gf(this.array[e*this.itemSize]);return this.normalized&&(n=ws(n,this.array)),n}setX(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize]=ba(n),this}getY(e){let n=gf(this.array[e*this.itemSize+1]);return this.normalized&&(n=ws(n,this.array)),n}setY(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+1]=ba(n),this}getZ(e){let n=gf(this.array[e*this.itemSize+2]);return this.normalized&&(n=ws(n,this.array)),n}setZ(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+2]=ba(n),this}getW(e){let n=gf(this.array[e*this.itemSize+3]);return this.normalized&&(n=ws(n,this.array)),n}setW(e,n){return this.normalized&&(n=Nn(n,this.array)),this.array[e*this.itemSize+3]=ba(n),this}setXY(e,n,s){return e*=this.itemSize,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array)),this.array[e+0]=ba(n),this.array[e+1]=ba(s),this}setXYZ(e,n,s,a){return e*=this.itemSize,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array),a=Nn(a,this.array)),this.array[e+0]=ba(n),this.array[e+1]=ba(s),this.array[e+2]=ba(a),this}setXYZW(e,n,s,a,c){return e*=this.itemSize,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array),a=Nn(a,this.array),c=Nn(c,this.array)),this.array[e+0]=ba(n),this.array[e+1]=ba(s),this.array[e+2]=ba(a),this.array[e+3]=ba(c),this}}class Wt extends qn{constructor(e,n,s){super(new Float32Array(e),n,s)}}let QN=0;const oo=new Qt,Rx=new kn,ap=new R,Ga=new te,vf=new te,As=new R;class vn extends Oa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:QN++}),this.uuid=Pr(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(zg(e)?Bx:Tx)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,s=0){this.groups.push({start:e,count:n,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const c=new wn().getNormalMatrix(e);s.applyNormalMatrix(c),s.needsUpdate=!0}const a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(e),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return oo.makeRotationFromQuaternion(e),this.applyMatrix4(oo),this}rotateX(e){return oo.makeRotationX(e),this.applyMatrix4(oo),this}rotateY(e){return oo.makeRotationY(e),this.applyMatrix4(oo),this}rotateZ(e){return oo.makeRotationZ(e),this.applyMatrix4(oo),this}translate(e,n,s){return oo.makeTranslation(e,n,s),this.applyMatrix4(oo),this}scale(e,n,s){return oo.makeScale(e,n,s),this.applyMatrix4(oo),this}lookAt(e){return Rx.lookAt(e),Rx.updateMatrix(),this.applyMatrix4(Rx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ap).negate(),this.translate(ap.x,ap.y,ap.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const s=[];for(let a=0,c=e.length;a<c;a++){const u=e[a];s.push(u.x,u.y,u.z||0)}this.setAttribute("position",new Wt(s,3))}else{const s=Math.min(e.length,n.count);for(let a=0;a<s;a++){const c=e[a];n.setXYZ(a,c.x,c.y,c.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new te);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new R(-1/0,-1/0,-1/0),new R(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let s=0,a=n.length;s<a;s++){const c=n[s];Ga.setFromBufferAttribute(c),this.morphTargetsRelative?(As.addVectors(this.boundingBox.min,Ga.min),this.boundingBox.expandByPoint(As),As.addVectors(this.boundingBox.max,Ga.max),this.boundingBox.expandByPoint(As)):(this.boundingBox.expandByPoint(Ga.min),this.boundingBox.expandByPoint(Ga.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new on);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new R,1/0);if(e){const s=this.boundingSphere.center;if(Ga.setFromBufferAttribute(e),n)for(let c=0,u=n.length;c<u;c++){const A=n[c];vf.setFromBufferAttribute(A),this.morphTargetsRelative?(As.addVectors(Ga.min,vf.min),Ga.expandByPoint(As),As.addVectors(Ga.max,vf.max),Ga.expandByPoint(As)):(Ga.expandByPoint(vf.min),Ga.expandByPoint(vf.max))}Ga.getCenter(s);let a=0;for(let c=0,u=e.count;c<u;c++)As.fromBufferAttribute(e,c),a=Math.max(a,s.distanceToSquared(As));if(n)for(let c=0,u=n.length;c<u;c++){const A=n[c],m=this.morphTargetsRelative;for(let v=0,E=A.count;v<E;v++)As.fromBufferAttribute(A,v),m&&(ap.fromBufferAttribute(e,v),As.add(ap)),a=Math.max(a,s.distanceToSquared(As))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const s=n.position,a=n.normal,c=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new qn(new Float32Array(4*s.count),4));const u=this.getAttribute("tangent"),A=[],m=[];for(let ce=0;ce<s.count;ce++)A[ce]=new R,m[ce]=new R;const v=new R,E=new R,C=new R,M=new ct,S=new ct,B=new ct,N=new R,L=new R;function F(ce,oe,Se){v.fromBufferAttribute(s,ce),E.fromBufferAttribute(s,oe),C.fromBufferAttribute(s,Se),M.fromBufferAttribute(c,ce),S.fromBufferAttribute(c,oe),B.fromBufferAttribute(c,Se),E.sub(v),C.sub(v),S.sub(M),B.sub(M);const Ne=1/(S.x*B.y-B.x*S.y);isFinite(Ne)&&(N.copy(E).multiplyScalar(B.y).addScaledVector(C,-S.y).multiplyScalar(Ne),L.copy(C).multiplyScalar(S.x).addScaledVector(E,-B.x).multiplyScalar(Ne),A[ce].add(N),A[oe].add(N),A[Se].add(N),m[ce].add(L),m[oe].add(L),m[Se].add(L))}let O=this.groups;O.length===0&&(O=[{start:0,count:e.count}]);for(let ce=0,oe=O.length;ce<oe;++ce){const Se=O[ce],Ne=Se.start;for(let ke=Ne,Oe=Ne+Se.count;ke<Oe;ke+=3)F(e.getX(ke+0),e.getX(ke+1),e.getX(ke+2))}const H=new R,X=new R,$=new R,ee=new R;function ie(ce){$.fromBufferAttribute(a,ce),ee.copy($);const oe=A[ce];H.copy(oe),H.sub($.multiplyScalar($.dot(oe))).normalize(),X.crossVectors(ee,oe);const Se=X.dot(m[ce])<0?-1:1;u.setXYZW(ce,H.x,H.y,H.z,Se)}for(let ce=0,oe=O.length;ce<oe;++ce){const Se=O[ce],Ne=Se.start;for(let ke=Ne,Oe=Ne+Se.count;ke<Oe;ke+=3)ie(e.getX(ke+0)),ie(e.getX(ke+1)),ie(e.getX(ke+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new qn(new Float32Array(3*n.count),3),this.setAttribute("normal",s);else for(let M=0,S=s.count;M<S;M++)s.setXYZ(M,0,0,0);const a=new R,c=new R,u=new R,A=new R,m=new R,v=new R,E=new R,C=new R;if(e)for(let M=0,S=e.count;M<S;M+=3){const B=e.getX(M+0),N=e.getX(M+1),L=e.getX(M+2);a.fromBufferAttribute(n,B),c.fromBufferAttribute(n,N),u.fromBufferAttribute(n,L),E.subVectors(u,c),C.subVectors(a,c),E.cross(C),A.fromBufferAttribute(s,B),m.fromBufferAttribute(s,N),v.fromBufferAttribute(s,L),A.add(E),m.add(E),v.add(E),s.setXYZ(B,A.x,A.y,A.z),s.setXYZ(N,m.x,m.y,m.z),s.setXYZ(L,v.x,v.y,v.z)}else for(let M=0,S=n.count;M<S;M+=3)a.fromBufferAttribute(n,M+0),c.fromBufferAttribute(n,M+1),u.fromBufferAttribute(n,M+2),E.subVectors(u,c),C.subVectors(a,c),E.cross(C),s.setXYZ(M+0,E.x,E.y,E.z),s.setXYZ(M+1,E.x,E.y,E.z),s.setXYZ(M+2,E.x,E.y,E.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,s=e.count;n<s;n++)As.fromBufferAttribute(e,n),As.normalize(),e.setXYZ(n,As.x,As.y,As.z)}toNonIndexed(){function e(A,m){const v=A.array,E=A.itemSize,C=A.normalized,M=new v.constructor(m.length*E);let S=0,B=0;for(let N=0,L=m.length;N<L;N++){S=A.isInterleavedBufferAttribute?m[N]*A.data.stride+A.offset:m[N]*E;for(let F=0;F<E;F++)M[B++]=v[S++]}return new qn(M,E,C)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new vn,s=this.index.array,a=this.attributes;for(const A in a){const m=e(a[A],s);n.setAttribute(A,m)}const c=this.morphAttributes;for(const A in c){const m=[],v=c[A];for(let E=0,C=v.length;E<C;E++){const M=e(v[E],s);m.push(M)}n.morphAttributes[A]=m}n.morphTargetsRelative=this.morphTargetsRelative;const u=this.groups;for(let A=0,m=u.length;A<m;A++){const v=u[A];n.addGroup(v.start,v.count,v.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const m=this.parameters;for(const v in m)m[v]!==void 0&&(e[v]=m[v]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const s=this.attributes;for(const m in s){const v=s[m];e.data.attributes[m]=v.toJSON(e.data)}const a={};let c=!1;for(const m in this.morphAttributes){const v=this.morphAttributes[m],E=[];for(let C=0,M=v.length;C<M;C++){const S=v[C];E.push(S.toJSON(e.data))}E.length>0&&(a[m]=E,c=!0)}c&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);const u=this.groups;u.length>0&&(e.data.groups=JSON.parse(JSON.stringify(u)));const A=this.boundingSphere;return A!==null&&(e.data.boundingSphere={center:A.center.toArray(),radius:A.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone(n));const a=e.attributes;for(const v in a){const E=a[v];this.setAttribute(v,E.clone(n))}const c=e.morphAttributes;for(const v in c){const E=[],C=c[v];for(let M=0,S=C.length;M<S;M++)E.push(C[M].clone(n));this.morphAttributes[v]=E}this.morphTargetsRelative=e.morphTargetsRelative;const u=e.groups;for(let v=0,E=u.length;v<E;v++){const C=u[v];this.addGroup(C.start,C.count,C.materialIndex)}const A=e.boundingBox;A!==null&&(this.boundingBox=A.clone());const m=e.boundingSphere;return m!==null&&(this.boundingSphere=m.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const aS=new Qt,wu=new _r,t0=new on,oS=new R,n0=new R,i0=new R,r0=new R,Lx=new R,s0=new R,lS=new R,a0=new R;class Ti extends kn{constructor(e=new vn,n=new Jr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,c=s.length;a<c;a++){const u=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}getVertexPosition(e,n){const s=this.geometry,a=s.attributes.position,c=s.morphAttributes.position,u=s.morphTargetsRelative;n.fromBufferAttribute(a,e);const A=this.morphTargetInfluences;if(c&&A){s0.set(0,0,0);for(let m=0,v=c.length;m<v;m++){const E=A[m],C=c[m];E!==0&&(Lx.fromBufferAttribute(C,e),u?s0.addScaledVector(Lx,E):s0.addScaledVector(Lx.sub(n),E))}n.add(s0)}return n}raycast(e,n){const s=this.geometry,a=this.material,c=this.matrixWorld;if(a!==void 0){if(s.boundingSphere===null&&s.computeBoundingSphere(),t0.copy(s.boundingSphere),t0.applyMatrix4(c),wu.copy(e.ray).recast(e.near),t0.containsPoint(wu.origin)===!1&&(wu.intersectSphere(t0,oS)===null||wu.origin.distanceToSquared(oS)>(e.far-e.near)**2))return;aS.copy(c).invert(),wu.copy(e.ray).applyMatrix4(aS),s.boundingBox!==null&&wu.intersectsBox(s.boundingBox)===!1||this._computeIntersections(e,n,wu)}}_computeIntersections(e,n,s){let a;const c=this.geometry,u=this.material,A=c.index,m=c.attributes.position,v=c.attributes.uv,E=c.attributes.uv1,C=c.attributes.normal,M=c.groups,S=c.drawRange;if(A!==null)if(Array.isArray(u))for(let B=0,N=M.length;B<N;B++){const L=M[B],F=u[L.materialIndex];for(let O=Math.max(L.start,S.start),H=Math.min(A.count,Math.min(L.start+L.count,S.start+S.count));O<H;O+=3)a=o0(this,F,e,s,v,E,C,A.getX(O),A.getX(O+1),A.getX(O+2)),a&&(a.faceIndex=Math.floor(O/3),a.face.materialIndex=L.materialIndex,n.push(a))}else for(let B=Math.max(0,S.start),N=Math.min(A.count,S.start+S.count);B<N;B+=3)a=o0(this,u,e,s,v,E,C,A.getX(B),A.getX(B+1),A.getX(B+2)),a&&(a.faceIndex=Math.floor(B/3),n.push(a));else if(m!==void 0)if(Array.isArray(u))for(let B=0,N=M.length;B<N;B++){const L=M[B],F=u[L.materialIndex];for(let O=Math.max(L.start,S.start),H=Math.min(m.count,Math.min(L.start+L.count,S.start+S.count));O<H;O+=3)a=o0(this,F,e,s,v,E,C,O,O+1,O+2),a&&(a.faceIndex=Math.floor(O/3),a.face.materialIndex=L.materialIndex,n.push(a))}else for(let B=Math.max(0,S.start),N=Math.min(m.count,S.start+S.count);B<N;B+=3)a=o0(this,u,e,s,v,E,C,B,B+1,B+2),a&&(a.faceIndex=Math.floor(B/3),n.push(a))}}function o0(r,e,n,s,a,c,u,A,m,v){r.getVertexPosition(A,n0),r.getVertexPosition(m,i0),r.getVertexPosition(v,r0);const E=function(C,M,S,B,N,L,F,O){let H;if(H=M.side===Lt?B.intersectTriangle(F,L,N,!0,O):B.intersectTriangle(N,L,F,M.side===ut,O),H===null)return null;a0.copy(O),a0.applyMatrix4(C.matrixWorld);const X=S.ray.origin.distanceTo(a0);return X<S.near||X>S.far?null:{distance:X,point:a0.clone(),object:C}}(r,e,n,s,n0,i0,r0,lS);if(E){const C=new R;Js.getBarycoord(lS,n0,i0,r0,C),a&&(E.uv=Js.getInterpolatedAttribute(a,A,m,v,C,new ct)),c&&(E.uv1=Js.getInterpolatedAttribute(c,A,m,v,C,new ct)),u&&(E.normal=Js.getInterpolatedAttribute(u,A,m,v,C,new R),E.normal.dot(s.direction)>0&&E.normal.multiplyScalar(-1));const M={a:A,b:m,c:v,normal:new R,materialIndex:0};Js.getNormal(n0,i0,r0,M.normal),E.face=M,E.barycoord=C}return E}class vl extends vn{constructor(e=1,n=1,s=1,a=1,c=1,u=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:s,widthSegments:a,heightSegments:c,depthSegments:u};const A=this;a=Math.floor(a),c=Math.floor(c),u=Math.floor(u);const m=[],v=[],E=[],C=[];let M=0,S=0;function B(N,L,F,O,H,X,$,ee,ie,ce,oe){const Se=X/ie,Ne=$/ce,ke=X/2,Oe=$/2,Te=ee/2,Je=ie+1,st=ce+1;let Et=0,dt=0;const Bt=new R;for(let qt=0;qt<st;qt++){const Kt=qt*Ne-Oe;for(let Jt=0;Jt<Je;Jt++){const ln=Jt*Se-ke;Bt[N]=ln*O,Bt[L]=Kt*H,Bt[F]=Te,v.push(Bt.x,Bt.y,Bt.z),Bt[N]=0,Bt[L]=0,Bt[F]=ee>0?1:-1,E.push(Bt.x,Bt.y,Bt.z),C.push(Jt/ie),C.push(1-qt/ce),Et+=1}}for(let qt=0;qt<ce;qt++)for(let Kt=0;Kt<ie;Kt++){const Jt=M+Kt+Je*qt,ln=M+Kt+Je*(qt+1),Ot=M+(Kt+1)+Je*(qt+1),nt=M+(Kt+1)+Je*qt;m.push(Jt,ln,nt),m.push(ln,Ot,nt),dt+=6}A.addGroup(S,dt,oe),S+=dt,M+=Et}B("z","y","x",-1,-1,s,n,e,u,c,0),B("z","y","x",1,-1,s,n,-e,u,c,1),B("x","z","y",1,1,e,s,n,a,u,2),B("x","z","y",1,-1,e,s,-n,a,u,3),B("x","y","z",1,-1,e,n,s,a,c,4),B("x","y","z",-1,-1,e,n,-s,a,c,5),this.setIndex(m),this.setAttribute("position",new Wt(v,3)),this.setAttribute("normal",new Wt(E,3)),this.setAttribute("uv",new Wt(C,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function op(r){const e={};for(const n in r){e[n]={};for(const s in r[n]){const a=r[n][s];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?a.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][s]=null):e[n][s]=a.clone():Array.isArray(a)?e[n][s]=a.slice():e[n][s]=a}}return e}function $s(r){const e={};for(let n=0;n<r.length;n++){const s=op(r[n]);for(const a in s)e[a]=s[a]}return e}function cS(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Dn.workingColorSpace}const lp={clone:op,merge:$s};class Ca extends Ur{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=op(e.uniforms),this.uniformsGroups=function(n){const s=[];for(let a=0;a<n.length;a++)s.push(n[a].clone());return s}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const a in this.uniforms){const c=this.uniforms[a].value;c&&c.isTexture?n.uniforms[a]={type:"t",value:c.toJSON(e).uuid}:c&&c.isColor?n.uniforms[a]={type:"c",value:c.getHex()}:c&&c.isVector2?n.uniforms[a]={type:"v2",value:c.toArray()}:c&&c.isVector3?n.uniforms[a]={type:"v3",value:c.toArray()}:c&&c.isVector4?n.uniforms[a]={type:"v4",value:c.toArray()}:c&&c.isMatrix3?n.uniforms[a]={type:"m3",value:c.toArray()}:c&&c.isMatrix4?n.uniforms[a]={type:"m4",value:c.toArray()}:n.uniforms[a]={value:c}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const s={};for(const a in this.extensions)this.extensions[a]===!0&&(s[a]=!0);return Object.keys(s).length>0&&(n.extensions=s),n}}class l0 extends kn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Qt,this.projectionMatrix=new Qt,this.projectionMatrixInverse=new Qt,this.coordinateSystem=ya}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const uh=new R,hS=new ct,uS=new ct;class Hr extends l0{constructor(e=50,n=1,s=.1,a=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=a,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=2*io*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ac*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*io*Math.atan(Math.tan(.5*ac*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,s){uh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(uh.x,uh.y).multiplyScalar(-e/uh.z),uh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(uh.x,uh.y).multiplyScalar(-e/uh.z)}getViewSize(e,n){return this.getViewBounds(e,hS,uS),n.subVectors(uS,hS)}setViewOffset(e,n,s,a,c,u){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=s,this.view.offsetY=a,this.view.width=c,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(.5*ac*this.fov)/this.zoom,s=2*n,a=this.aspect*s,c=-.5*a;const u=this.view;if(this.view!==null&&this.view.enabled){const m=u.fullWidth,v=u.fullHeight;c+=u.offsetX*a/m,n-=u.offsetY*s/v,a*=u.width/m,s*=u.height/v}const A=this.filmOffset;A!==0&&(c+=e*A/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+a,n,n-s,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const cp=-90;class c0 extends kn{constructor(e,n,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const a=new Hr(cp,1,e,n);a.layers=this.layers,this.add(a);const c=new Hr(cp,1,e,n);c.layers=this.layers,this.add(c);const u=new Hr(cp,1,e,n);u.layers=this.layers,this.add(u);const A=new Hr(cp,1,e,n);A.layers=this.layers,this.add(A);const m=new Hr(cp,1,e,n);m.layers=this.layers,this.add(m);const v=new Hr(cp,1,e,n);v.layers=this.layers,this.add(v)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[s,a,c,u,A,m]=n;for(const v of n)this.remove(v);if(e===ya)s.up.set(0,1,0),s.lookAt(1,0,0),a.up.set(0,1,0),a.lookAt(-1,0,0),c.up.set(0,0,-1),c.lookAt(0,1,0),u.up.set(0,0,1),u.lookAt(0,-1,0),A.up.set(0,1,0),A.lookAt(0,0,1),m.up.set(0,1,0),m.lookAt(0,0,-1);else{if(e!==no)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);s.up.set(0,-1,0),s.lookAt(-1,0,0),a.up.set(0,-1,0),a.lookAt(1,0,0),c.up.set(0,0,1),c.lookAt(0,1,0),u.up.set(0,0,-1),u.lookAt(0,-1,0),A.up.set(0,-1,0),A.lookAt(0,0,1),m.up.set(0,-1,0),m.lookAt(0,0,-1)}for(const v of n)this.add(v),v.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:a}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[c,u,A,m,v,E]=this.children,C=e.getRenderTarget(),M=e.getActiveCubeFace(),S=e.getActiveMipmapLevel(),B=e.xr.enabled;e.xr.enabled=!1;const N=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0,a),e.render(n,c),e.setRenderTarget(s,1,a),e.render(n,u),e.setRenderTarget(s,2,a),e.render(n,A),e.setRenderTarget(s,3,a),e.render(n,m),e.setRenderTarget(s,4,a),e.render(n,v),s.texture.generateMipmaps=N,e.setRenderTarget(s,5,a),e.render(n,E),e.setRenderTarget(C,M,S),e.xr.enabled=B,s.texture.needsPMREMUpdate=!0}}class hp extends Pi{constructor(e,n,s,a,c,u,A,m,v,E){super(e=e!==void 0?e:[],n=n!==void 0?n:js,s,a,c,u,A,m,v,E),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class yf extends Us{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const s={width:e,height:e,depth:1},a=[s,s,s,s,s,s];this.texture=new hp(a,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0&&n.generateMipmaps,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:bi}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const s={tEquirect:{value:null}},a=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,c=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,u=new vl(5,5,5),A=new Ca({name:"CubemapFromEquirect",uniforms:op(s),vertexShader:a,fragmentShader:c,side:Lt,blending:Yt});A.uniforms.tEquirect.value=n;const m=new Ti(u,A),v=n.minFilter;return n.minFilter===hs&&(n.minFilter=bi),new c0(1,10,this).update(e,m),n.minFilter=v,m.geometry.dispose(),m.material.dispose(),this}clear(e,n,s,a){const c=e.getRenderTarget();for(let u=0;u<6;u++)e.setRenderTarget(this,u),e.clear(n,s,a);e.setRenderTarget(c)}}class wa extends kn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const GN={type:"move"};class h0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new wa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new wa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new R,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new R),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new wa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new R,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new R),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const s of e.hand.values())this._getHandJoint(n,s)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,s){let a=null,c=null,u=null;const A=this._targetRay,m=this._grip,v=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(v&&e.hand){u=!0;for(const N of e.hand.values()){const L=n.getJointPose(N,s),F=this._getHandJoint(v,N);L!==null&&(F.matrix.fromArray(L.transform.matrix),F.matrix.decompose(F.position,F.rotation,F.scale),F.matrixWorldNeedsUpdate=!0,F.jointRadius=L.radius),F.visible=L!==null}const E=v.joints["index-finger-tip"],C=v.joints["thumb-tip"],M=E.position.distanceTo(C.position),S=.02,B=.005;v.inputState.pinching&&M>S+B?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!v.inputState.pinching&&M<=S-B&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else m!==null&&e.gripSpace&&(c=n.getPose(e.gripSpace,s),c!==null&&(m.matrix.fromArray(c.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,c.linearVelocity?(m.hasLinearVelocity=!0,m.linearVelocity.copy(c.linearVelocity)):m.hasLinearVelocity=!1,c.angularVelocity?(m.hasAngularVelocity=!0,m.angularVelocity.copy(c.angularVelocity)):m.hasAngularVelocity=!1));A!==null&&(a=n.getPose(e.targetRaySpace,s),a===null&&c!==null&&(a=c),a!==null&&(A.matrix.fromArray(a.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,a.linearVelocity?(A.hasLinearVelocity=!0,A.linearVelocity.copy(a.linearVelocity)):A.hasLinearVelocity=!1,a.angularVelocity?(A.hasAngularVelocity=!0,A.angularVelocity.copy(a.angularVelocity)):A.hasAngularVelocity=!1,this.dispatchEvent(GN)))}return A!==null&&(A.visible=a!==null),m!==null&&(m.visible=c!==null),v!==null&&(v.visible=u!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const s=new wa;s.matrixAutoUpdate=!1,s.visible=!1,e.joints[n.jointName]=s,e.add(s)}return e.joints[n.jointName]}}class Ef{constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new Mt(e),this.density=n}clone(){return new Ef(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class xf{constructor(e,n=1,s=1e3){this.isFog=!0,this.name="",this.color=new Mt(e),this.near=n,this.far=s}clone(){return new xf(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class u0 extends kn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ii,this.environmentIntensity=1,this.environmentRotation=new ii,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class up{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=rc,this.updateRanges=[],this.version=0,this.uuid=Pr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,s){e*=this.stride,s*=n.stride;for(let a=0,c=this.stride;a<c;a++)this.array[e+a]=n.array[s+a];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Pr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(n,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Pr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Zs=new R;class dc{constructor(e,n,s,a=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=s,this.normalized=a}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,s=this.data.count;n<s;n++)Zs.fromBufferAttribute(this,n),Zs.applyMatrix4(e),this.setXYZ(n,Zs.x,Zs.y,Zs.z);return this}applyNormalMatrix(e){for(let n=0,s=this.count;n<s;n++)Zs.fromBufferAttribute(this,n),Zs.applyNormalMatrix(e),this.setXYZ(n,Zs.x,Zs.y,Zs.z);return this}transformDirection(e){for(let n=0,s=this.count;n<s;n++)Zs.fromBufferAttribute(this,n),Zs.transformDirection(e),this.setXYZ(n,Zs.x,Zs.y,Zs.z);return this}getComponent(e,n){let s=this.array[e*this.data.stride+this.offset+n];return this.normalized&&(s=ws(s,this.array)),s}setComponent(e,n,s){return this.normalized&&(s=Nn(s,this.array)),this.data.array[e*this.data.stride+this.offset+n]=s,this}setX(e,n){return this.normalized&&(n=Nn(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=Nn(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=Nn(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=Nn(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=ws(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=ws(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=ws(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=ws(n,this.array)),n}setXY(e,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=s,this}setXYZ(e,n,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array),a=Nn(a,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=s,this.data.array[e+2]=a,this}setXYZW(e,n,s,a,c){return e=e*this.data.stride+this.offset,this.normalized&&(n=Nn(n,this.array),s=Nn(s,this.array),a=Nn(a,this.array),c=Nn(c,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=s,this.data.array[e+2]=a,this.data.array[e+3]=c,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let s=0;s<this.count;s++){const a=s*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)n.push(this.data.array[a+c])}return new qn(new this.array.constructor(n),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new dc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let s=0;s<this.count;s++){const a=s*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)n.push(this.data.array[a+c])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Dx extends Ur{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Mt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let dp;const _f=new R,pp=new R,Ap=new R,fp=new ct,bf=new ct,dS=new Qt,d0=new R,Cf=new R,p0=new R,pS=new ct,Px=new ct,AS=new ct;class fS extends kn{constructor(e=new Dx){if(super(),this.isSprite=!0,this.type="Sprite",dp===void 0){dp=new vn;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),s=new up(n,5);dp.setIndex([0,1,2,0,2,3]),dp.setAttribute("position",new dc(s,3,0,!1)),dp.setAttribute("uv",new dc(s,2,3,!1))}this.geometry=dp,this.material=e,this.center=new ct(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),pp.setFromMatrixScale(this.matrixWorld),dS.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ap.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&pp.multiplyScalar(-Ap.z);const s=this.material.rotation;let a,c;s!==0&&(c=Math.cos(s),a=Math.sin(s));const u=this.center;A0(d0.set(-.5,-.5,0),Ap,u,pp,a,c),A0(Cf.set(.5,-.5,0),Ap,u,pp,a,c),A0(p0.set(.5,.5,0),Ap,u,pp,a,c),pS.set(0,0),Px.set(1,0),AS.set(1,1);let A=e.ray.intersectTriangle(d0,Cf,p0,!1,_f);if(A===null&&(A0(Cf.set(-.5,.5,0),Ap,u,pp,a,c),Px.set(0,1),A=e.ray.intersectTriangle(d0,p0,Cf,!1,_f),A===null))return;const m=e.ray.origin.distanceTo(_f);m<e.near||m>e.far||n.push({distance:m,point:_f.clone(),uv:Js.getInterpolation(_f,d0,Cf,p0,pS,Px,AS,new ct),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function A0(r,e,n,s,a,c){fp.subVectors(r,n).addScalar(.5).multiply(s),a!==void 0?(bf.x=c*fp.x-a*fp.y,bf.y=a*fp.x+c*fp.y):bf.copy(fp),r.copy(e),r.x+=bf.x,r.y+=bf.y,r.applyMatrix4(dS)}const f0=new R,mS=new R;class gS extends kn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let s=0,a=n.length;s<a;s++){const c=n[s];this.addLevel(c.object.clone(),c.distance,c.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,s=0){n=Math.abs(n);const a=this.levels;let c;for(c=0;c<a.length&&!(n<a[c].distance);c++);return a.splice(c,0,{distance:n,hysteresis:s,object:e}),this.add(e),this}removeLevel(e){const n=this.levels;for(let s=0;s<n.length;s++)if(n[s].distance===e){const a=n.splice(s,1);return this.remove(a[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let s,a;for(s=1,a=n.length;s<a;s++){let c=n[s].distance;if(n[s].object.visible&&(c-=c*n[s].hysteresis),e<c)break}return n[s-1].object}return null}raycast(e,n){if(this.levels.length>0){f0.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(f0);this.getObjectForDistance(s).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){f0.setFromMatrixPosition(e.matrixWorld),mS.setFromMatrixPosition(this.matrixWorld);const s=f0.distanceTo(mS)/e.zoom;let a,c;for(n[0].object.visible=!0,a=1,c=n.length;a<c;a++){let u=n[a].distance;if(n[a].object.visible&&(u-=u*n[a].hysteresis),!(s>=u))break;n[a-1].object.visible=!1,n[a].object.visible=!0}for(this._currentLevel=a-1;a<c;a++)n[a].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const s=this.levels;for(let a=0,c=s.length;a<c;a++){const u=s[a];n.object.levels.push({object:u.object.uuid,distance:u.distance,hysteresis:u.hysteresis})}return n}}const vS=new R,yS=new pi,ES=new pi,HN=new R,xS=new Qt,m0=new R,Ux=new on,_S=new Qt,Nx=new _r;class Fx extends Ti{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=JA,this.bindMatrix=new Qt,this.bindMatrixInverse=new Qt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new te),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let s=0;s<n.count;s++)this.getVertexPosition(s,m0),this.boundingBox.expandByPoint(m0)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new on),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let s=0;s<n.count;s++)this.getVertexPosition(s,m0),this.boundingSphere.expandByPoint(m0)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const s=this.material,a=this.matrixWorld;s!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ux.copy(this.boundingSphere),Ux.applyMatrix4(a),e.ray.intersectsSphere(Ux)!==!1&&(_S.copy(a).invert(),Nx.copy(e.ray).applyMatrix4(_S),this.boundingBox!==null&&Nx.intersectsBox(this.boundingBox)===!1||this._computeIntersections(e,n,Nx)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new pi,n=this.geometry.attributes.skinWeight;for(let s=0,a=n.count;s<a;s++){e.fromBufferAttribute(n,s);const c=1/e.manhattanLength();c!==1/0?e.multiplyScalar(c):e.set(1,0,0,0),n.setXYZW(s,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===JA?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===$A?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const s=this.skeleton,a=this.geometry;yS.fromBufferAttribute(a.attributes.skinIndex,e),ES.fromBufferAttribute(a.attributes.skinWeight,e),vS.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let c=0;c<4;c++){const u=ES.getComponent(c);if(u!==0){const A=yS.getComponent(c);xS.multiplyMatrices(s.bones[A].matrixWorld,s.boneInverses[A]),n.addScaledVector(HN.copy(vS).applyMatrix4(xS),u)}}return n.applyMatrix4(this.bindMatrixInverse)}}class g0 extends kn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Fo extends Pi{constructor(e=null,n=1,s=1,a,c,u,A,m,v=yr,E=yr,C,M){super(null,u,A,m,v,E,a,c,C,M),this.isDataTexture=!0,this.image={data:e,width:n,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const bS=new Qt,zN=new Qt;class wf{constructor(e=[],n=[]){this.uuid=Pr(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,a=this.bones.length;s<a;s++)this.boneInverses.push(new Qt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const s=new Qt;this.bones[e]&&s.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const s=this.bones[e];s&&s.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const s=this.bones[e];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const e=this.bones,n=this.boneInverses,s=this.boneMatrices,a=this.boneTexture;for(let c=0,u=e.length;c<u;c++){const A=e[c]?e[c].matrixWorld:zN;bS.multiplyMatrices(A,n[c]),bS.toArray(s,16*c)}a!==null&&(a.needsUpdate=!0)}clone(){return new wf(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const s=new Fo(n,e,e,nr,Ir);return s.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=s,this}getBoneByName(e){for(let n=0,s=this.bones.length;n<s;n++){const a=this.bones[n];if(a.name===e)return a}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let s=0,a=e.bones.length;s<a;s++){const c=e.bones[s];let u=n[c];u===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",c),u=new g0),this.bones.push(u),this.boneInverses.push(new Qt().fromArray(e.boneInverses[s]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,s=this.boneInverses;for(let a=0,c=n.length;a<c;a++){const u=n[a];e.bones.push(u.uuid);const A=s[a];e.boneInverses.push(A.toArray())}return e}}class pc extends qn{constructor(e,n,s,a=1){super(e,n,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=a}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const mp=new Qt,CS=new Qt,v0=[],wS=new te,VN=new Qt,Mf=new Ti,Sf=new on;class Ox extends Ti{constructor(e,n,s){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new pc(new Float32Array(16*s),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let a=0;a<s;a++)this.setMatrixAt(a,VN)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new te),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<n;s++)this.getMatrixAt(s,mp),wS.copy(e.boundingBox).applyMatrix4(mp),this.boundingBox.union(wS)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new on),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<n;s++)this.getMatrixAt(s,mp),Sf.copy(e.boundingSphere).applyMatrix4(mp),this.boundingSphere.union(Sf)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,n){const s=n.morphTargetInfluences,a=this.morphTexture.source.data.data,c=e*(s.length+1)+1;for(let u=0;u<s.length;u++)s[u]=a[c+u]}raycast(e,n){const s=this.matrixWorld,a=this.count;if(Mf.geometry=this.geometry,Mf.material=this.material,Mf.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Sf.copy(this.boundingSphere),Sf.applyMatrix4(s),e.ray.intersectsSphere(Sf)!==!1))for(let c=0;c<a;c++){this.getMatrixAt(c,mp),CS.multiplyMatrices(s,mp),Mf.matrixWorld=CS,Mf.raycast(e,v0);for(let u=0,A=v0.length;u<A;u++){const m=v0[u];m.instanceId=c,m.object=this,n.push(m)}v0.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new pc(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),n.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,n){const s=n.morphTargetInfluences,a=s.length+1;this.morphTexture===null&&(this.morphTexture=new Fo(new Float32Array(a*this.count),a,this.count,Bo,Ir));const c=this.morphTexture.source.data.data;let u=0;for(let v=0;v<s.length;v++)u+=s[v];const A=this.geometry.morphTargetsRelative?1:1-u,m=a*e;c[m]=A,c.set(s,m+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const kx=new R,WN=new R,jN=new wn;class dh{constructor(e=new R(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,s,a){return this.normal.set(e,n,s),this.constant=a,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,s){const a=kx.subVectors(s,n).cross(WN.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const s=e.delta(kx),a=this.normal.dot(s);if(a===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const c=-(e.start.dot(this.normal)+this.constant)/a;return c<0||c>1?null:n.copy(e.start).addScaledVector(s,c)}intersectsLine(e){const n=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return n<0&&s>0||s<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const s=n||jN.getNormalMatrix(e),a=this.coplanarPoint(kx).applyMatrix4(e),c=this.normal.applyMatrix3(s).normalize();return this.constant=-a.dot(c),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Mu=new on,y0=new R;class If{constructor(e=new dh,n=new dh,s=new dh,a=new dh,c=new dh,u=new dh){this.planes=[e,n,s,a,c,u]}set(e,n,s,a,c,u){const A=this.planes;return A[0].copy(e),A[1].copy(n),A[2].copy(s),A[3].copy(a),A[4].copy(c),A[5].copy(u),this}copy(e){const n=this.planes;for(let s=0;s<6;s++)n[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e,n=ya){const s=this.planes,a=e.elements,c=a[0],u=a[1],A=a[2],m=a[3],v=a[4],E=a[5],C=a[6],M=a[7],S=a[8],B=a[9],N=a[10],L=a[11],F=a[12],O=a[13],H=a[14],X=a[15];if(s[0].setComponents(m-c,M-v,L-S,X-F).normalize(),s[1].setComponents(m+c,M+v,L+S,X+F).normalize(),s[2].setComponents(m+u,M+E,L+B,X+O).normalize(),s[3].setComponents(m-u,M-E,L-B,X-O).normalize(),s[4].setComponents(m-A,M-C,L-N,X-H).normalize(),n===ya)s[5].setComponents(m+A,M+C,L+N,X+H).normalize();else{if(n!==no)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);s[5].setComponents(A,C,N,H).normalize()}return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Mu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Mu.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Mu)}intersectsSprite(e){return Mu.center.set(0,0,0),Mu.radius=.7071067811865476,Mu.applyMatrix4(e.matrixWorld),this.intersectsSphere(Mu)}intersectsSphere(e){const n=this.planes,s=e.center,a=-e.radius;for(let c=0;c<6;c++)if(n[c].distanceToPoint(s)<a)return!1;return!0}intersectsBox(e){const n=this.planes;for(let s=0;s<6;s++){const a=n[s];if(y0.x=a.normal.x>0?e.max.x:e.min.x,y0.y=a.normal.y>0?e.max.y:e.min.y,y0.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(y0)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let s=0;s<6;s++)if(n[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Qx(r,e){return r-e}function qN(r,e){return r.z-e.z}function XN(r,e){return e.z-r.z}class YN{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,n,s,a){const c=this.pool,u=this.list;this.index>=c.length&&c.push({start:-1,count:-1,z:-1,index:-1});const A=c[this.index];u.push(A),this.index++,A.start=e,A.count=n,A.z=s,A.index=a}reset(){this.list.length=0,this.index=0}}const Ma=new Qt,KN=new Mt(1,1,1),Gx=new If,E0=new te,Su=new on,Tf=new R,MS=new R,JN=new R,Hx=new YN,Fs=new Ti,x0=[];function $N(r,e,n=0){const s=e.itemSize;if(r.isInterleavedBufferAttribute||r.array.constructor!==e.array.constructor){const a=r.count;for(let c=0;c<a;c++)for(let u=0;u<s;u++)e.setComponent(c+n,u,r.getComponent(c,u))}else e.array.set(r.array,n*s);e.needsUpdate=!0}function Iu(r,e){if(r.constructor!==e.constructor){const n=Math.min(r.length,e.length);for(let s=0;s<n;s++)e[s]=r[s]}else{const n=Math.min(r.length,e.length);e.set(new r.constructor(r.buffer,0,n))}}class SS extends Ti{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,n,s=2*n,a){super(new vn,a),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=n,this._maxIndexCount=s,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const n=new Float32Array(e*e*4),s=new Fo(n,e,e,nr,Ir);this._matricesTexture=s}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Uint32Array(e*e),s=new Fo(n,e,e,su,So);this._indirectTexture=s}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const n=new Float32Array(e*e*4).fill(1),s=new Fo(n,e,e,nr,Ir);s.colorSpace=Dn.workingColorSpace,this._colorsTexture=s}_initializeGeometry(e){const n=this.geometry,s=this._maxVertexCount,a=this._maxIndexCount;if(this._geometryInitialized===!1){for(const c in e.attributes){const u=e.getAttribute(c),{array:A,itemSize:m,normalized:v}=u,E=new A.constructor(s*m),C=new qn(E,m,v);n.setAttribute(c,C)}if(e.getIndex()!==null){const c=s>65535?new Uint32Array(a):new Uint16Array(a);n.setIndex(new qn(c,1))}this._geometryInitialized=!0}}_validateGeometry(e){const n=this.geometry;if(!!e.getIndex()!=!!n.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const s in n.attributes){if(!e.hasAttribute(s))throw new Error(`THREE.BatchedMesh: Added geometry missing "${s}". All geometries must have consistent attributes.`);const a=e.getAttribute(s),c=n.getAttribute(s);if(a.itemSize!==c.itemSize||a.normalized!==c.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const n=this._instanceInfo;if(e<0||e>=n.length||n[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const n=this._geometryInfo;if(e<0||e>=n.length||n[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new te);const e=this.boundingBox,n=this._instanceInfo;e.makeEmpty();for(let s=0,a=n.length;s<a;s++){if(n[s].active===!1)continue;const c=n[s].geometryIndex;this.getMatrixAt(s,Ma),this.getBoundingBoxAt(c,E0).applyMatrix4(Ma),e.union(E0)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new on);const e=this.boundingSphere,n=this._instanceInfo;e.makeEmpty();for(let s=0,a=n.length;s<a;s++){if(n[s].active===!1)continue;const c=n[s].geometryIndex;this.getMatrixAt(s,Ma),this.getBoundingSphereAt(c,Su).applyMatrix4(Ma),e.union(Su)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Qx),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=n):(s=this._instanceInfo.length,this._instanceInfo.push(n));const a=this._matricesTexture;Ma.identity().toArray(a.image.data,16*s),a.needsUpdate=!0;const c=this._colorsTexture;return c&&(KN.toArray(c.image.data,4*s),c.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(e,n=-1,s=-1){this._initializeGeometry(e),this._validateGeometry(e);const a={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},c=this._geometryInfo;a.vertexStart=this._nextVertexStart,a.reservedVertexCount=n===-1?e.getAttribute("position").count:n;const u=e.getIndex();if(u!==null&&(a.indexStart=this._nextIndexStart,a.reservedIndexCount=s===-1?u.count:s),a.indexStart!==-1&&a.indexStart+a.reservedIndexCount>this._maxIndexCount||a.vertexStart+a.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let A;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Qx),A=this._availableGeometryIds.shift(),c[A]=a):(A=this._geometryCount,this._geometryCount++,c.push(a)),this.setGeometryAt(A,e),this._nextIndexStart=a.indexStart+a.reservedIndexCount,this._nextVertexStart=a.vertexStart+a.reservedVertexCount,A}setGeometryAt(e,n){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(n);const s=this.geometry,a=s.getIndex()!==null,c=s.getIndex(),u=n.getIndex(),A=this._geometryInfo[e];if(a&&u.count>A.reservedIndexCount||n.attributes.position.count>A.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const m=A.vertexStart,v=A.reservedVertexCount;A.vertexCount=n.getAttribute("position").count;for(const E in s.attributes){const C=n.getAttribute(E),M=s.getAttribute(E);$N(C,M,m);const S=C.itemSize;for(let B=C.count,N=v;B<N;B++){const L=m+B;for(let F=0;F<S;F++)M.setComponent(L,F,0)}M.needsUpdate=!0,M.addUpdateRange(m*S,v*S)}if(a){const E=A.indexStart,C=A.reservedIndexCount;A.indexCount=n.getIndex().count;for(let M=0;M<u.count;M++)c.setX(E+M,m+u.getX(M));for(let M=u.count,S=C;M<S;M++)c.setX(E+M,m);c.needsUpdate=!0,c.addUpdateRange(E,A.reservedIndexCount)}return A.start=a?A.indexStart:A.vertexStart,A.count=a?A.indexCount:A.vertexCount,A.boundingBox=null,n.boundingBox!==null&&(A.boundingBox=n.boundingBox.clone()),A.boundingSphere=null,n.boundingSphere!==null&&(A.boundingSphere=n.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const n=this._geometryInfo;if(e>=n.length||n[e].active===!1)return this;const s=this._instanceInfo;for(let a=0,c=s.length;a<c;a++)s[a].active&&s[a].geometryIndex===e&&this.deleteInstance(a);return n[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,n=0;const s=this._geometryInfo,a=s.map((u,A)=>A).sort((u,A)=>s[u].vertexStart-s[A].vertexStart),c=this.geometry;for(let u=0,A=s.length;u<A;u++){const m=a[u],v=s[m];if(v.active!==!1){if(c.index!==null){if(v.indexStart!==n){const{indexStart:E,vertexStart:C,reservedIndexCount:M}=v,S=c.index,B=S.array,N=e-C;for(let L=E;L<E+M;L++)B[L]=B[L]+N;S.array.copyWithin(n,E,E+M),S.addUpdateRange(n,M),v.indexStart=n}n+=v.reservedIndexCount}if(v.vertexStart!==e){const{vertexStart:E,reservedVertexCount:C}=v,M=c.attributes;for(const S in M){const B=M[S],{array:N,itemSize:L}=B;N.copyWithin(e*L,E*L,(E+C)*L),B.addUpdateRange(e*L,C*L)}v.vertexStart=e}e+=v.reservedVertexCount,v.start=c.index?v.indexStart:v.vertexStart,this._nextIndexStart=c.index?v.indexStart+v.reservedIndexCount:0,this._nextVertexStart=v.vertexStart+v.reservedVertexCount}}return this}getBoundingBoxAt(e,n){if(e>=this._geometryCount)return null;const s=this.geometry,a=this._geometryInfo[e];if(a.boundingBox===null){const c=new te,u=s.index,A=s.attributes.position;for(let m=a.start,v=a.start+a.count;m<v;m++){let E=m;u&&(E=u.getX(E)),c.expandByPoint(Tf.fromBufferAttribute(A,E))}a.boundingBox=c}return n.copy(a.boundingBox),n}getBoundingSphereAt(e,n){if(e>=this._geometryCount)return null;const s=this.geometry,a=this._geometryInfo[e];if(a.boundingSphere===null){const c=new on;this.getBoundingBoxAt(e,E0),E0.getCenter(c.center);const u=s.index,A=s.attributes.position;let m=0;for(let v=a.start,E=a.start+a.count;v<E;v++){let C=v;u&&(C=u.getX(C)),Tf.fromBufferAttribute(A,C),m=Math.max(m,c.center.distanceToSquared(Tf))}c.radius=Math.sqrt(m),a.boundingSphere=c}return n.copy(a.boundingSphere),n}setMatrixAt(e,n){this.validateInstanceId(e);const s=this._matricesTexture,a=this._matricesTexture.image.data;return n.toArray(a,16*e),s.needsUpdate=!0,this}getMatrixAt(e,n){return this.validateInstanceId(e),n.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,n){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),n.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,n){return this.validateInstanceId(e),n.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,n){return this.validateInstanceId(e),this._instanceInfo[e].visible===n||(this._instanceInfo[e].visible=n,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,n){return this.validateInstanceId(e),this.validateGeometryId(n),this._instanceInfo[e].geometryIndex=n,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,n={}){this.validateGeometryId(e);const s=this._geometryInfo[e];return n.vertexStart=s.vertexStart,n.vertexCount=s.vertexCount,n.reservedVertexCount=s.reservedVertexCount,n.indexStart=s.indexStart,n.indexCount=s.indexCount,n.reservedIndexCount=s.reservedIndexCount,n.start=s.start,n.count=s.count,n}setInstanceCount(e){const n=this._availableInstanceIds,s=this._instanceInfo;for(n.sort(Qx);n[n.length-1]===s.length;)s.pop(),n.pop();if(e<s.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const a=new Int32Array(e),c=new Int32Array(e);Iu(this._multiDrawCounts,a),Iu(this._multiDrawStarts,c),this._multiDrawCounts=a,this._multiDrawStarts=c,this._maxInstanceCount=e;const u=this._indirectTexture,A=this._matricesTexture,m=this._colorsTexture;u.dispose(),this._initIndirectTexture(),Iu(u.image.data,this._indirectTexture.image.data),A.dispose(),this._initMatricesTexture(),Iu(A.image.data,this._matricesTexture.image.data),m&&(m.dispose(),this._initColorsTexture(),Iu(m.image.data,this._colorsTexture.image.data))}setGeometrySize(e,n){const s=[...this._geometryInfo].filter(u=>u.active);if(Math.max(...s.map(u=>u.vertexStart+u.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${n}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...s.map(u=>u.indexStart+u.reservedIndexCount))>n)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${n}. Cannot shrink further.`);const a=this.geometry;a.dispose(),this._maxVertexCount=e,this._maxIndexCount=n,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new vn,this._initializeGeometry(a));const c=this.geometry;a.index&&Iu(a.index.array,c.index.array);for(const u in a.attributes)Iu(a.attributes[u].array,c.attributes[u].array)}raycast(e,n){const s=this._instanceInfo,a=this._geometryInfo,c=this.matrixWorld,u=this.geometry;Fs.material=this.material,Fs.geometry.index=u.index,Fs.geometry.attributes=u.attributes,Fs.geometry.boundingBox===null&&(Fs.geometry.boundingBox=new te),Fs.geometry.boundingSphere===null&&(Fs.geometry.boundingSphere=new on);for(let A=0,m=s.length;A<m;A++){if(!s[A].visible||!s[A].active)continue;const v=s[A].geometryIndex,E=a[v];Fs.geometry.setDrawRange(E.start,E.count),this.getMatrixAt(A,Fs.matrixWorld).premultiply(c),this.getBoundingBoxAt(v,Fs.geometry.boundingBox),this.getBoundingSphereAt(v,Fs.geometry.boundingSphere),Fs.raycast(e,x0);for(let C=0,M=x0.length;C<M;C++){const S=x0[C];S.object=this,S.batchId=A,n.push(S)}x0.length=0}Fs.material=null,Fs.geometry.index=null,Fs.geometry.attributes={},Fs.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(n=>({...n,boundingBox:n.boundingBox!==null?n.boundingBox.clone():null,boundingSphere:n.boundingSphere!==null?n.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(n=>({...n})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,n,s,a,c){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const u=a.getIndex(),A=u===null?1:u.array.BYTES_PER_ELEMENT,m=this._instanceInfo,v=this._multiDrawStarts,E=this._multiDrawCounts,C=this._geometryInfo,M=this.perObjectFrustumCulled,S=this._indirectTexture,B=S.image.data;M&&(Ma.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse).multiply(this.matrixWorld),Gx.setFromProjectionMatrix(Ma,e.coordinateSystem));let N=0;if(this.sortObjects){Ma.copy(this.matrixWorld).invert(),Tf.setFromMatrixPosition(s.matrixWorld).applyMatrix4(Ma),MS.set(0,0,-1).transformDirection(s.matrixWorld).transformDirection(Ma);for(let O=0,H=m.length;O<H;O++)if(m[O].visible&&m[O].active){const X=m[O].geometryIndex;this.getMatrixAt(O,Ma),this.getBoundingSphereAt(X,Su).applyMatrix4(Ma);let $=!1;if(M&&($=!Gx.intersectsSphere(Su)),!$){const ee=C[X],ie=JN.subVectors(Su.center,Tf).dot(MS);Hx.push(ee.start,ee.count,ie,O)}}const L=Hx.list,F=this.customSort;F===null?L.sort(c.transparent?XN:qN):F.call(this,L,s);for(let O=0,H=L.length;O<H;O++){const X=L[O];v[N]=X.start*A,E[N]=X.count,B[N]=X.index,N++}Hx.reset()}else for(let L=0,F=m.length;L<F;L++)if(m[L].visible&&m[L].active){const O=m[L].geometryIndex;let H=!1;if(M&&(this.getMatrixAt(L,Ma),this.getBoundingSphereAt(O,Su).applyMatrix4(Ma),H=!Gx.intersectsSphere(Su)),!H){const X=C[O];v[N]=X.start*A,E[N]=X.count,B[N]=L,N++}}S.needsUpdate=!0,this._multiDrawCount=N,this._visibilityChanged=!1}onBeforeShadow(e,n,s,a,c,u){this.onBeforeRender(e,null,a,c,u)}}class zr extends Ur{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Mt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _0=new R,b0=new R,IS=new Qt,Bf=new _r,C0=new on,zx=new R,TS=new R;class yl extends kn{constructor(e=new vn,n=new zr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,s=[0];for(let a=1,c=n.count;a<c;a++)_0.fromBufferAttribute(n,a-1),b0.fromBufferAttribute(n,a),s[a]=s[a-1],s[a]+=_0.distanceTo(b0);e.setAttribute("lineDistance",new Wt(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const s=this.geometry,a=this.matrixWorld,c=e.params.Line.threshold,u=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),C0.copy(s.boundingSphere),C0.applyMatrix4(a),C0.radius+=c,e.ray.intersectsSphere(C0)===!1)return;IS.copy(a).invert(),Bf.copy(e.ray).applyMatrix4(IS);const A=c/((this.scale.x+this.scale.y+this.scale.z)/3),m=A*A,v=this.isLineSegments?2:1,E=s.index,C=s.attributes.position;if(E!==null){const M=Math.max(0,u.start),S=Math.min(E.count,u.start+u.count);for(let B=M,N=S-1;B<N;B+=v){const L=E.getX(B),F=E.getX(B+1),O=w0(this,e,Bf,m,L,F,B);O&&n.push(O)}if(this.isLineLoop){const B=E.getX(S-1),N=E.getX(M),L=w0(this,e,Bf,m,B,N,S-1);L&&n.push(L)}}else{const M=Math.max(0,u.start),S=Math.min(C.count,u.start+u.count);for(let B=M,N=S-1;B<N;B+=v){const L=w0(this,e,Bf,m,B,B+1,B);L&&n.push(L)}if(this.isLineLoop){const B=w0(this,e,Bf,m,S-1,M,S-1);B&&n.push(B)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,c=s.length;a<c;a++){const u=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}}function w0(r,e,n,s,a,c,u){const A=r.geometry.attributes.position;if(_0.fromBufferAttribute(A,a),b0.fromBufferAttribute(A,c),n.distanceSqToSegment(_0,b0,zx,TS)>s)return;zx.applyMatrix4(r.matrixWorld);const m=e.ray.origin.distanceTo(zx);return m<e.near||m>e.far?void 0:{distance:m,point:TS.clone().applyMatrix4(r.matrixWorld),index:u,face:null,faceIndex:null,barycoord:null,object:r}}const BS=new R,RS=new R;class Ha extends yl{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,s=[];for(let a=0,c=n.count;a<c;a+=2)BS.fromBufferAttribute(n,a),RS.fromBufferAttribute(n,a+1),s[a]=a===0?0:s[a-1],s[a+1]=s[a]+BS.distanceTo(RS);e.setAttribute("lineDistance",new Wt(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Vx extends yl{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class ph extends Ur{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Mt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const LS=new Qt,Wx=new _r,M0=new on,S0=new R;class gp extends kn{constructor(e=new vn,n=new ph){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const s=this.geometry,a=this.matrixWorld,c=e.params.Points.threshold,u=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),M0.copy(s.boundingSphere),M0.applyMatrix4(a),M0.radius+=c,e.ray.intersectsSphere(M0)===!1)return;LS.copy(a).invert(),Wx.copy(e.ray).applyMatrix4(LS);const A=c/((this.scale.x+this.scale.y+this.scale.z)/3),m=A*A,v=s.index,E=s.attributes.position;if(v!==null)for(let C=Math.max(0,u.start),M=Math.min(v.count,u.start+u.count);C<M;C++){const S=v.getX(C);S0.fromBufferAttribute(E,S),DS(S0,S,m,a,e,n,this)}else for(let C=Math.max(0,u.start),M=Math.min(E.count,u.start+u.count);C<M;C++)S0.fromBufferAttribute(E,C),DS(S0,C,m,a,e,n,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,c=s.length;a<c;a++){const u=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}}function DS(r,e,n,s,a,c,u){const A=Wx.distanceSqToPoint(r);if(A<n){const m=new R;Wx.closestPointToPoint(r,m),m.applyMatrix4(s);const v=a.ray.origin.distanceTo(m);if(v<a.near||v>a.far)return;c.push({distance:v,distanceToRay:Math.sqrt(A),point:m,index:e,face:null,faceIndex:null,barycoord:null,object:u})}}class jx extends Pi{constructor(e,n,s,a,c,u,A,m,v){super(e,n,s,a,c,u,A,m,v),this.isVideoTexture=!0,this.minFilter=u!==void 0?u:bi,this.magFilter=c!==void 0?c:bi,this.generateMipmaps=!1;const E=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function C(){E.needsUpdate=!0,e.requestVideoFrameCallback(C)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class ZN extends jx{constructor(e,n,s,a,c,u,A,m){super({},e,n,s,a,c,u,A,m),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class eF extends Pi{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=yr,this.minFilter=yr,this.generateMipmaps=!1,this.needsUpdate=!0}}class vp extends Pi{constructor(e,n,s,a,c,u,A,m,v,E,C,M){super(null,u,A,m,v,E,a,c,C,M),this.isCompressedTexture=!0,this.image={width:n,height:s},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class PS extends vp{constructor(e,n,s,a,c,u){super(e,n,s,c,u),this.isCompressedArrayTexture=!0,this.image.depth=a,this.wrapR=Dr,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class US extends vp{constructor(e,n,s){super(void 0,e[0].width,e[0].height,n,s,js),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class qx extends Pi{constructor(e,n,s,a,c,u,A,m,v){super(e,n,s,a,c,u,A,m,v),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Xx extends Pi{constructor(e,n,s,a,c,u,A,m,v,E=ul){if(E!==ul&&E!==To)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&E===ul&&(s=So),s===void 0&&E===To&&(s=hl),super(null,a,c,u,A,m,E,s,v),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=A!==void 0?A:yr,this.minFilter=m!==void 0?m:yr,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class Oo{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const s=this.getUtoTmapping(e);return this.getPoint(s,n)}getPoints(e=5){const n=[];for(let s=0;s<=e;s++)n.push(this.getPoint(s/e));return n}getSpacedPoints(e=5){const n=[];for(let s=0;s<=e;s++)n.push(this.getPointAt(s/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let s,a=this.getPoint(0),c=0;n.push(0);for(let u=1;u<=e;u++)s=this.getPoint(u/e),c+=s.distanceTo(a),n.push(c),a=s;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const s=this.getLengths();let a=0;const c=s.length;let u;u=n||e*s[c-1];let A,m=0,v=c-1;for(;m<=v;)if(a=Math.floor(m+(v-m)/2),A=s[a]-u,A<0)m=a+1;else{if(!(A>0)){v=a;break}v=a-1}if(a=v,s[a]===u)return a/(c-1);const E=s[a];return(a+(u-E)/(s[a+1]-E))/(c-1)}getTangent(e,n){let a=e-1e-4,c=e+1e-4;a<0&&(a=0),c>1&&(c=1);const u=this.getPoint(a),A=this.getPoint(c),m=n||(u.isVector2?new ct:new R);return m.copy(A).sub(u).normalize(),m}getTangentAt(e,n){const s=this.getUtoTmapping(e);return this.getTangent(s,n)}computeFrenetFrames(e,n){const s=new R,a=[],c=[],u=[],A=new R,m=new Qt;for(let S=0;S<=e;S++){const B=S/e;a[S]=this.getTangentAt(B,new R)}c[0]=new R,u[0]=new R;let v=Number.MAX_VALUE;const E=Math.abs(a[0].x),C=Math.abs(a[0].y),M=Math.abs(a[0].z);E<=v&&(v=E,s.set(1,0,0)),C<=v&&(v=C,s.set(0,1,0)),M<=v&&s.set(0,0,1),A.crossVectors(a[0],s).normalize(),c[0].crossVectors(a[0],A),u[0].crossVectors(a[0],c[0]);for(let S=1;S<=e;S++){if(c[S]=c[S-1].clone(),u[S]=u[S-1].clone(),A.crossVectors(a[S-1],a[S]),A.length()>Number.EPSILON){A.normalize();const B=Math.acos(Rn(a[S-1].dot(a[S]),-1,1));c[S].applyMatrix4(m.makeRotationAxis(A,B))}u[S].crossVectors(a[S],c[S])}if(n===!0){let S=Math.acos(Rn(c[0].dot(c[e]),-1,1));S/=e,a[0].dot(A.crossVectors(c[0],c[e]))>0&&(S=-S);for(let B=1;B<=e;B++)c[B].applyMatrix4(m.makeRotationAxis(a[B],S*B)),u[B].crossVectors(a[B],c[B])}return{tangents:a,normals:c,binormals:u}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class I0 extends Oo{constructor(e=0,n=0,s=1,a=1,c=0,u=2*Math.PI,A=!1,m=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=s,this.yRadius=a,this.aStartAngle=c,this.aEndAngle=u,this.aClockwise=A,this.aRotation=m}getPoint(e,n=new ct){const s=n,a=2*Math.PI;let c=this.aEndAngle-this.aStartAngle;const u=Math.abs(c)<Number.EPSILON;for(;c<0;)c+=a;for(;c>a;)c-=a;c<Number.EPSILON&&(c=u?0:a),this.aClockwise!==!0||u||(c===a?c=-a:c-=a);const A=this.aStartAngle+e*c;let m=this.aX+this.xRadius*Math.cos(A),v=this.aY+this.yRadius*Math.sin(A);if(this.aRotation!==0){const E=Math.cos(this.aRotation),C=Math.sin(this.aRotation),M=m-this.aX,S=v-this.aY;m=M*E-S*C+this.aX,v=M*C+S*E+this.aY}return s.set(m,v)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class NS extends I0{constructor(e,n,s,a,c,u){super(e,n,s,s,a,c,u),this.isArcCurve=!0,this.type="ArcCurve"}}function Yx(){let r=0,e=0,n=0,s=0;function a(c,u,A,m){r=c,e=A,n=-3*c+3*u-2*A-m,s=2*c-2*u+A+m}return{initCatmullRom:function(c,u,A,m,v){a(u,A,v*(A-c),v*(m-u))},initNonuniformCatmullRom:function(c,u,A,m,v,E,C){let M=(u-c)/v-(A-c)/(v+E)+(A-u)/E,S=(A-u)/E-(m-u)/(E+C)+(m-A)/C;M*=E,S*=E,a(u,A,M,S)},calc:function(c){const u=c*c;return r+e*c+n*u+s*(u*c)}}}const T0=new R,Kx=new Yx,Jx=new Yx,$x=new Yx;class FS extends Oo{constructor(e=[],n=!1,s="centripetal",a=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=s,this.tension=a}getPoint(e,n=new R){const s=n,a=this.points,c=a.length,u=(c-(this.closed?0:1))*e;let A,m,v=Math.floor(u),E=u-v;this.closed?v+=v>0?0:(Math.floor(Math.abs(v)/c)+1)*c:E===0&&v===c-1&&(v=c-2,E=1),this.closed||v>0?A=a[(v-1)%c]:(T0.subVectors(a[0],a[1]).add(a[0]),A=T0);const C=a[v%c],M=a[(v+1)%c];if(this.closed||v+2<c?m=a[(v+2)%c]:(T0.subVectors(a[c-1],a[c-2]).add(a[c-1]),m=T0),this.curveType==="centripetal"||this.curveType==="chordal"){const S=this.curveType==="chordal"?.5:.25;let B=Math.pow(A.distanceToSquared(C),S),N=Math.pow(C.distanceToSquared(M),S),L=Math.pow(M.distanceToSquared(m),S);N<1e-4&&(N=1),B<1e-4&&(B=N),L<1e-4&&(L=N),Kx.initNonuniformCatmullRom(A.x,C.x,M.x,m.x,B,N,L),Jx.initNonuniformCatmullRom(A.y,C.y,M.y,m.y,B,N,L),$x.initNonuniformCatmullRom(A.z,C.z,M.z,m.z,B,N,L)}else this.curveType==="catmullrom"&&(Kx.initCatmullRom(A.x,C.x,M.x,m.x,this.tension),Jx.initCatmullRom(A.y,C.y,M.y,m.y,this.tension),$x.initCatmullRom(A.z,C.z,M.z,m.z,this.tension));return s.set(Kx.calc(E),Jx.calc(E),$x.calc(E)),s}copy(e){super.copy(e),this.points=[];for(let n=0,s=e.points.length;n<s;n++){const a=e.points[n];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,s=this.points.length;n<s;n++){const a=this.points[n];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,s=e.points.length;n<s;n++){const a=e.points[n];this.points.push(new R().fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function OS(r,e,n,s,a){const c=.5*(s-e),u=.5*(a-n),A=r*r;return(2*n-2*s+c+u)*(r*A)+(-3*n+3*s-2*c-u)*A+c*r+n}function Rf(r,e,n,s){return function(a,c){const u=1-a;return u*u*c}(r,e)+function(a,c){return 2*(1-a)*a*c}(r,n)+function(a,c){return a*a*c}(r,s)}function Lf(r,e,n,s,a){return function(c,u){const A=1-c;return A*A*A*u}(r,e)+function(c,u){const A=1-c;return 3*A*A*c*u}(r,n)+function(c,u){return 3*(1-c)*c*c*u}(r,s)+function(c,u){return c*c*c*u}(r,a)}class Zx extends Oo{constructor(e=new ct,n=new ct,s=new ct,a=new ct){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=s,this.v3=a}getPoint(e,n=new ct){const s=n,a=this.v0,c=this.v1,u=this.v2,A=this.v3;return s.set(Lf(e,a.x,c.x,u.x,A.x),Lf(e,a.y,c.y,u.y,A.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class kS extends Oo{constructor(e=new R,n=new R,s=new R,a=new R){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=s,this.v3=a}getPoint(e,n=new R){const s=n,a=this.v0,c=this.v1,u=this.v2,A=this.v3;return s.set(Lf(e,a.x,c.x,u.x,A.x),Lf(e,a.y,c.y,u.y,A.y),Lf(e,a.z,c.z,u.z,A.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class e_ extends Oo{constructor(e=new ct,n=new ct){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new ct){const s=n;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new ct){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QS extends Oo{constructor(e=new R,n=new R){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new R){const s=n;return e===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(e).add(this.v1)),s}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new R){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class t_ extends Oo{constructor(e=new ct,n=new ct,s=new ct){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=s}getPoint(e,n=new ct){const s=n,a=this.v0,c=this.v1,u=this.v2;return s.set(Rf(e,a.x,c.x,u.x),Rf(e,a.y,c.y,u.y)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class n_ extends Oo{constructor(e=new R,n=new R,s=new R){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=s}getPoint(e,n=new R){const s=n,a=this.v0,c=this.v1,u=this.v2;return s.set(Rf(e,a.x,c.x,u.x),Rf(e,a.y,c.y,u.y),Rf(e,a.z,c.z,u.z)),s}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class i_ extends Oo{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new ct){const s=n,a=this.points,c=(a.length-1)*e,u=Math.floor(c),A=c-u,m=a[u===0?u:u-1],v=a[u],E=a[u>a.length-2?a.length-1:u+1],C=a[u>a.length-3?a.length-1:u+2];return s.set(OS(A,m.x,v.x,E.x,C.x),OS(A,m.y,v.y,E.y,C.y)),s}copy(e){super.copy(e),this.points=[];for(let n=0,s=e.points.length;n<s;n++){const a=e.points[n];this.points.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,s=this.points.length;n<s;n++){const a=this.points[n];e.points.push(a.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,s=e.points.length;n<s;n++){const a=e.points[n];this.points.push(new ct().fromArray(a))}return this}}var B0=Object.freeze({__proto__:null,ArcCurve:NS,CatmullRomCurve3:FS,CubicBezierCurve:Zx,CubicBezierCurve3:kS,EllipseCurve:I0,LineCurve:e_,LineCurve3:QS,QuadraticBezierCurve:t_,QuadraticBezierCurve3:n_,SplineCurve:i_});class GS extends Oo{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(n)){const s=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new B0[s](n,e))}return this}getPoint(e,n){const s=e*this.getLength(),a=this.getCurveLengths();let c=0;for(;c<a.length;){if(a[c]>=s){const u=a[c]-s,A=this.curves[c],m=A.getLength(),v=m===0?0:1-u/m;return A.getPointAt(v,n)}c++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let s=0,a=this.curves.length;s<a;s++)n+=this.curves[s].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let s=0;s<=e;s++)n.push(this.getPoint(s/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let s;for(let a=0,c=this.curves;a<c.length;a++){const u=c[a],A=u.isEllipseCurve?2*e:u.isLineCurve||u.isLineCurve3?1:u.isSplineCurve?e*u.points.length:e,m=u.getPoints(A);for(let v=0;v<m.length;v++){const E=m[v];s&&s.equals(E)||(n.push(E),s=E)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,s=e.curves.length;n<s;n++){const a=e.curves[n];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,s=this.curves.length;n<s;n++){const a=this.curves[n];e.curves.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,s=e.curves.length;n<s;n++){const a=e.curves[n];this.curves.push(new B0[a.type]().fromJSON(a))}return this}}class Df extends GS{constructor(e){super(),this.type="Path",this.currentPoint=new ct,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,s=e.length;n<s;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const s=new e_(this.currentPoint.clone(),new ct(e,n));return this.curves.push(s),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,s,a){const c=new t_(this.currentPoint.clone(),new ct(e,n),new ct(s,a));return this.curves.push(c),this.currentPoint.set(s,a),this}bezierCurveTo(e,n,s,a,c,u){const A=new Zx(this.currentPoint.clone(),new ct(e,n),new ct(s,a),new ct(c,u));return this.curves.push(A),this.currentPoint.set(c,u),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),s=new i_(n);return this.curves.push(s),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,s,a,c,u){const A=this.currentPoint.x,m=this.currentPoint.y;return this.absarc(e+A,n+m,s,a,c,u),this}absarc(e,n,s,a,c,u){return this.absellipse(e,n,s,s,a,c,u),this}ellipse(e,n,s,a,c,u,A,m){const v=this.currentPoint.x,E=this.currentPoint.y;return this.absellipse(e+v,n+E,s,a,c,u,A,m),this}absellipse(e,n,s,a,c,u,A,m){const v=new I0(e,n,s,a,c,u,A,m);if(this.curves.length>0){const C=v.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(v);const E=v.getPoint(1);return this.currentPoint.copy(E),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Pf extends vn{constructor(e=[new ct(0,-.5),new ct(.5,0),new ct(0,.5)],n=12,s=0,a=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:s,phiLength:a},n=Math.floor(n),a=Rn(a,0,2*Math.PI);const c=[],u=[],A=[],m=[],v=[],E=1/n,C=new R,M=new ct,S=new R,B=new R,N=new R;let L=0,F=0;for(let O=0;O<=e.length-1;O++)switch(O){case 0:L=e[O+1].x-e[O].x,F=e[O+1].y-e[O].y,S.x=1*F,S.y=-L,S.z=0*F,N.copy(S),S.normalize(),m.push(S.x,S.y,S.z);break;case e.length-1:m.push(N.x,N.y,N.z);break;default:L=e[O+1].x-e[O].x,F=e[O+1].y-e[O].y,S.x=1*F,S.y=-L,S.z=0*F,B.copy(S),S.x+=N.x,S.y+=N.y,S.z+=N.z,S.normalize(),m.push(S.x,S.y,S.z),N.copy(B)}for(let O=0;O<=n;O++){const H=s+O*E*a,X=Math.sin(H),$=Math.cos(H);for(let ee=0;ee<=e.length-1;ee++){C.x=e[ee].x*X,C.y=e[ee].y,C.z=e[ee].x*$,u.push(C.x,C.y,C.z),M.x=O/n,M.y=ee/(e.length-1),A.push(M.x,M.y);const ie=m[3*ee+0]*X,ce=m[3*ee+1],oe=m[3*ee+0]*$;v.push(ie,ce,oe)}}for(let O=0;O<n;O++)for(let H=0;H<e.length-1;H++){const X=H+O*e.length,$=X,ee=X+e.length,ie=X+e.length+1,ce=X+1;c.push($,ee,ce),c.push(ie,ce,ee)}this.setIndex(c),this.setAttribute("position",new Wt(u,3)),this.setAttribute("uv",new Wt(A,2)),this.setAttribute("normal",new Wt(v,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pf(e.points,e.segments,e.phiStart,e.phiLength)}}class R0 extends Pf{constructor(e=1,n=1,s=4,a=8){const c=new Df;c.absarc(0,-n/2,e,1.5*Math.PI,0),c.absarc(0,n/2,e,0,.5*Math.PI),super(c.getPoints(s),a),this.type="CapsuleGeometry",this.parameters={radius:e,length:n,capSegments:s,radialSegments:a}}static fromJSON(e){return new R0(e.radius,e.length,e.capSegments,e.radialSegments)}}class Uf extends vn{constructor(e=1,n=32,s=0,a=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:s,thetaLength:a},n=Math.max(3,n);const c=[],u=[],A=[],m=[],v=new R,E=new ct;u.push(0,0,0),A.push(0,0,1),m.push(.5,.5);for(let C=0,M=3;C<=n;C++,M+=3){const S=s+C/n*a;v.x=e*Math.cos(S),v.y=e*Math.sin(S),u.push(v.x,v.y,v.z),A.push(0,0,1),E.x=(u[M]/e+1)/2,E.y=(u[M+1]/e+1)/2,m.push(E.x,E.y)}for(let C=1;C<=n;C++)c.push(C,C+1,0);this.setIndex(c),this.setAttribute("position",new Wt(u,3)),this.setAttribute("normal",new Wt(A,3)),this.setAttribute("uv",new Wt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Uf(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ah extends vn{constructor(e=1,n=1,s=1,a=32,c=1,u=!1,A=0,m=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:s,radialSegments:a,heightSegments:c,openEnded:u,thetaStart:A,thetaLength:m};const v=this;a=Math.floor(a),c=Math.floor(c);const E=[],C=[],M=[],S=[];let B=0;const N=[],L=s/2;let F=0;function O(H){const X=B,$=new ct,ee=new R;let ie=0;const ce=H===!0?e:n,oe=H===!0?1:-1;for(let Ne=1;Ne<=a;Ne++)C.push(0,L*oe,0),M.push(0,oe,0),S.push(.5,.5),B++;const Se=B;for(let Ne=0;Ne<=a;Ne++){const ke=Ne/a*m+A,Oe=Math.cos(ke),Te=Math.sin(ke);ee.x=ce*Te,ee.y=L*oe,ee.z=ce*Oe,C.push(ee.x,ee.y,ee.z),M.push(0,oe,0),$.x=.5*Oe+.5,$.y=.5*Te*oe+.5,S.push($.x,$.y),B++}for(let Ne=0;Ne<a;Ne++){const ke=X+Ne,Oe=Se+Ne;H===!0?E.push(Oe,Oe+1,ke):E.push(Oe+1,Oe,ke),ie+=3}v.addGroup(F,ie,H===!0?1:2),F+=ie}(function(){const H=new R,X=new R;let $=0;const ee=(n-e)/s;for(let ie=0;ie<=c;ie++){const ce=[],oe=ie/c,Se=oe*(n-e)+e;for(let Ne=0;Ne<=a;Ne++){const ke=Ne/a,Oe=ke*m+A,Te=Math.sin(Oe),Je=Math.cos(Oe);X.x=Se*Te,X.y=-oe*s+L,X.z=Se*Je,C.push(X.x,X.y,X.z),H.set(Te,ee,Je).normalize(),M.push(H.x,H.y,H.z),S.push(ke,1-oe),ce.push(B++)}N.push(ce)}for(let ie=0;ie<a;ie++)for(let ce=0;ce<c;ce++){const oe=N[ce][ie],Se=N[ce+1][ie],Ne=N[ce+1][ie+1],ke=N[ce][ie+1];(e>0||ce!==0)&&(E.push(oe,Se,ke),$+=3),(n>0||ce!==c-1)&&(E.push(Se,Ne,ke),$+=3)}v.addGroup(F,$,0),F+=$})(),u===!1&&(e>0&&O(!0),n>0&&O(!1)),this.setIndex(E),this.setAttribute("position",new Wt(C,3)),this.setAttribute("normal",new Wt(M,3)),this.setAttribute("uv",new Wt(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ah(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class L0 extends Ah{constructor(e=1,n=1,s=32,a=1,c=!1,u=0,A=2*Math.PI){super(0,e,n,s,a,c,u,A),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:s,heightSegments:a,openEnded:c,thetaStart:u,thetaLength:A}}static fromJSON(e){return new L0(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class fh extends vn{constructor(e=[],n=[],s=1,a=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:s,detail:a};const c=[],u=[];function A(M,S,B,N){const L=N+1,F=[];for(let O=0;O<=L;O++){F[O]=[];const H=M.clone().lerp(B,O/L),X=S.clone().lerp(B,O/L),$=L-O;for(let ee=0;ee<=$;ee++)F[O][ee]=ee===0&&O===L?H:H.clone().lerp(X,ee/$)}for(let O=0;O<L;O++)for(let H=0;H<2*(L-O)-1;H++){const X=Math.floor(H/2);H%2==0?(m(F[O][X+1]),m(F[O+1][X]),m(F[O][X])):(m(F[O][X+1]),m(F[O+1][X+1]),m(F[O+1][X]))}}function m(M){c.push(M.x,M.y,M.z)}function v(M,S){const B=3*M;S.x=e[B+0],S.y=e[B+1],S.z=e[B+2]}function E(M,S,B,N){N<0&&M.x===1&&(u[S]=M.x-1),B.x===0&&B.z===0&&(u[S]=N/2/Math.PI+.5)}function C(M){return Math.atan2(M.z,-M.x)}(function(M){const S=new R,B=new R,N=new R;for(let L=0;L<n.length;L+=3)v(n[L+0],S),v(n[L+1],B),v(n[L+2],N),A(S,B,N,M)})(a),function(M){const S=new R;for(let B=0;B<c.length;B+=3)S.x=c[B+0],S.y=c[B+1],S.z=c[B+2],S.normalize().multiplyScalar(M),c[B+0]=S.x,c[B+1]=S.y,c[B+2]=S.z}(s),function(){const M=new R;for(let B=0;B<c.length;B+=3){M.x=c[B+0],M.y=c[B+1],M.z=c[B+2];const N=C(M)/2/Math.PI+.5,L=(S=M,Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))/Math.PI+.5);u.push(N,1-L)}var S;(function(){const B=new R,N=new R,L=new R,F=new R,O=new ct,H=new ct,X=new ct;for(let $=0,ee=0;$<c.length;$+=9,ee+=6){B.set(c[$+0],c[$+1],c[$+2]),N.set(c[$+3],c[$+4],c[$+5]),L.set(c[$+6],c[$+7],c[$+8]),O.set(u[ee+0],u[ee+1]),H.set(u[ee+2],u[ee+3]),X.set(u[ee+4],u[ee+5]),F.copy(B).add(N).add(L).divideScalar(3);const ie=C(F);E(O,ee+0,B,ie),E(H,ee+2,N,ie),E(X,ee+4,L,ie)}})(),function(){for(let B=0;B<u.length;B+=6){const N=u[B+0],L=u[B+2],F=u[B+4],O=Math.max(N,L,F),H=Math.min(N,L,F);O>.9&&H<.1&&(N<.2&&(u[B+0]+=1),L<.2&&(u[B+2]+=1),F<.2&&(u[B+4]+=1))}}()}(),this.setAttribute("position",new Wt(c,3)),this.setAttribute("normal",new Wt(c.slice(),3)),this.setAttribute("uv",new Wt(u,2)),a===0?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fh(e.vertices,e.indices,e.radius,e.details)}}class Nf extends fh{constructor(e=1,n=0){const s=(1+Math.sqrt(5))/2,a=1/s;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-s,0,-a,s,0,a,-s,0,a,s,-a,-s,0,-a,s,0,a,-s,0,a,s,0,-s,0,-a,s,0,-a,-s,0,a,s,0,a],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Nf(e.radius,e.detail)}}const D0=new R,P0=new R,r_=new R,U0=new Js;class HS extends vn{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const a=Math.pow(10,4),c=Math.cos(ac*n),u=e.getIndex(),A=e.getAttribute("position"),m=u?u.count:A.count,v=[0,0,0],E=["a","b","c"],C=new Array(3),M={},S=[];for(let B=0;B<m;B+=3){u?(v[0]=u.getX(B),v[1]=u.getX(B+1),v[2]=u.getX(B+2)):(v[0]=B,v[1]=B+1,v[2]=B+2);const{a:N,b:L,c:F}=U0;if(N.fromBufferAttribute(A,v[0]),L.fromBufferAttribute(A,v[1]),F.fromBufferAttribute(A,v[2]),U0.getNormal(r_),C[0]=`${Math.round(N.x*a)},${Math.round(N.y*a)},${Math.round(N.z*a)}`,C[1]=`${Math.round(L.x*a)},${Math.round(L.y*a)},${Math.round(L.z*a)}`,C[2]=`${Math.round(F.x*a)},${Math.round(F.y*a)},${Math.round(F.z*a)}`,C[0]!==C[1]&&C[1]!==C[2]&&C[2]!==C[0])for(let O=0;O<3;O++){const H=(O+1)%3,X=C[O],$=C[H],ee=U0[E[O]],ie=U0[E[H]],ce=`${X}_${$}`,oe=`${$}_${X}`;oe in M&&M[oe]?(r_.dot(M[oe].normal)<=c&&(S.push(ee.x,ee.y,ee.z),S.push(ie.x,ie.y,ie.z)),M[oe]=null):ce in M||(M[ce]={index0:v[O],index1:v[H],normal:r_.clone()})}}for(const B in M)if(M[B]){const{index0:N,index1:L}=M[B];D0.fromBufferAttribute(A,N),P0.fromBufferAttribute(A,L),S.push(D0.x,D0.y,D0.z),S.push(P0.x,P0.y,P0.z)}this.setAttribute("position",new Wt(S,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class mh extends Df{constructor(e){super(e),this.uuid=Pr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let s=0,a=this.holes.length;s<a;s++)n[s]=this.holes[s].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,s=e.holes.length;n<s;n++){const a=e.holes[n];this.holes.push(a.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,s=this.holes.length;n<s;n++){const a=this.holes[n];e.holes.push(a.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,s=e.holes.length;n<s;n++){const a=e.holes[n];this.holes.push(new Df().fromJSON(a))}return this}}function zS(r,e,n,s,a){let c,u;if(a===function(A,m,v,E){let C=0;for(let M=m,S=v-E;M<v;M+=E)C+=(A[S]-A[M])*(A[M+1]+A[S+1]),S=M;return C}(r,e,n,s)>0)for(c=e;c<n;c+=s)u=jS(c,r[c],r[c+1],u);else for(c=n-s;c>=e;c-=s)u=jS(c,r[c],r[c+1],u);return u&&N0(u,u.next)&&(kf(u),u=u.next),u}function Tu(r,e){if(!r)return r;e||(e=r);let n,s=r;do if(n=!1,s.steiner||!N0(s,s.next)&&Cr(s.prev,s,s.next)!==0)s=s.next;else{if(kf(s),s=e=s.prev,s===s.next)break;n=!0}while(n||s!==e);return e}function Ff(r,e,n,s,a,c,u){if(!r)return;!u&&c&&function(E,C,M,S){let B=E;do B.z===0&&(B.z=s_(B.x,B.y,C,M,S)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==E);B.prevZ.nextZ=null,B.prevZ=null,function(N){let L,F,O,H,X,$,ee,ie,ce=1;do{for(F=N,N=null,X=null,$=0;F;){for($++,O=F,ee=0,L=0;L<ce&&(ee++,O=O.nextZ,O);L++);for(ie=ce;ee>0||ie>0&&O;)ee!==0&&(ie===0||!O||F.z<=O.z)?(H=F,F=F.nextZ,ee--):(H=O,O=O.nextZ,ie--),X?X.nextZ=H:N=H,H.prevZ=X,X=H;F=O}X.nextZ=null,ce*=2}while($>1)}(B)}(r,s,a,c);let A,m,v=r;for(;r.prev!==r.next;)if(A=r.prev,m=r.next,c?nF(r,s,a,c):tF(r))e.push(A.i/n|0),e.push(r.i/n|0),e.push(m.i/n|0),kf(r),r=m.next,v=m.next;else if((r=m)===v){u?u===1?Ff(r=iF(Tu(r),e,n),e,n,s,a,c,2):u===2&&rF(r,e,n,s,a,c):Ff(Tu(r),e,n,s,a,c,1);break}}function tF(r){const e=r.prev,n=r,s=r.next;if(Cr(e,n,s)>=0)return!1;const a=e.x,c=n.x,u=s.x,A=e.y,m=n.y,v=s.y,E=a<c?a<u?a:u:c<u?c:u,C=A<m?A<v?A:v:m<v?m:v,M=a>c?a>u?a:u:c>u?c:u,S=A>m?A>v?A:v:m>v?m:v;let B=s.next;for(;B!==e;){if(B.x>=E&&B.x<=M&&B.y>=C&&B.y<=S&&yp(a,A,c,m,u,v,B.x,B.y)&&Cr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function nF(r,e,n,s){const a=r.prev,c=r,u=r.next;if(Cr(a,c,u)>=0)return!1;const A=a.x,m=c.x,v=u.x,E=a.y,C=c.y,M=u.y,S=A<m?A<v?A:v:m<v?m:v,B=E<C?E<M?E:M:C<M?C:M,N=A>m?A>v?A:v:m>v?m:v,L=E>C?E>M?E:M:C>M?C:M,F=s_(S,B,e,n,s),O=s_(N,L,e,n,s);let H=r.prevZ,X=r.nextZ;for(;H&&H.z>=F&&X&&X.z<=O;){if(H.x>=S&&H.x<=N&&H.y>=B&&H.y<=L&&H!==a&&H!==u&&yp(A,E,m,C,v,M,H.x,H.y)&&Cr(H.prev,H,H.next)>=0||(H=H.prevZ,X.x>=S&&X.x<=N&&X.y>=B&&X.y<=L&&X!==a&&X!==u&&yp(A,E,m,C,v,M,X.x,X.y)&&Cr(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;H&&H.z>=F;){if(H.x>=S&&H.x<=N&&H.y>=B&&H.y<=L&&H!==a&&H!==u&&yp(A,E,m,C,v,M,H.x,H.y)&&Cr(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;X&&X.z<=O;){if(X.x>=S&&X.x<=N&&X.y>=B&&X.y<=L&&X!==a&&X!==u&&yp(A,E,m,C,v,M,X.x,X.y)&&Cr(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function iF(r,e,n){let s=r;do{const a=s.prev,c=s.next.next;!N0(a,c)&&VS(a,s,s.next,c)&&Of(a,c)&&Of(c,a)&&(e.push(a.i/n|0),e.push(s.i/n|0),e.push(c.i/n|0),kf(s),kf(s.next),s=r=c),s=s.next}while(s!==r);return Tu(s)}function rF(r,e,n,s,a,c){let u=r;do{let A=u.next.next;for(;A!==u.prev;){if(u.i!==A.i&&cF(u,A)){let m=WS(u,A);return u=Tu(u,u.next),m=Tu(m,m.next),Ff(u,e,n,s,a,c,0),void Ff(m,e,n,s,a,c,0)}A=A.next}u=u.next}while(u!==r)}function sF(r,e){return r.x-e.x}function aF(r,e){const n=function(a,c){let u,A=c,m=-1/0;const v=a.x,E=a.y;do{if(E<=A.y&&E>=A.next.y&&A.next.y!==A.y){const L=A.x+(E-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(L<=v&&L>m&&(m=L,u=A.x<A.next.x?A:A.next,L===v))return u}A=A.next}while(A!==c);if(!u)return null;const C=u,M=u.x,S=u.y;let B,N=1/0;A=u;do v>=A.x&&A.x>=M&&v!==A.x&&yp(E<S?v:m,E,M,S,E<S?m:v,E,A.x,A.y)&&(B=Math.abs(E-A.y)/(v-A.x),Of(A,a)&&(B<N||B===N&&(A.x>u.x||A.x===u.x&&oF(u,A)))&&(u=A,N=B)),A=A.next;while(A!==C);return u}(r,e);if(!n)return e;const s=WS(n,r);return Tu(s,s.next),Tu(n,n.next)}function oF(r,e){return Cr(r.prev,r,e.prev)<0&&Cr(e.next,r,r.next)<0}function s_(r,e,n,s,a){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*a|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lF(r){let e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function yp(r,e,n,s,a,c,u,A){return(a-u)*(e-A)>=(r-u)*(c-A)&&(r-u)*(s-A)>=(n-u)*(e-A)&&(n-u)*(c-A)>=(a-u)*(s-A)}function cF(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,s){let a=n;do{if(a.i!==n.i&&a.next.i!==n.i&&a.i!==s.i&&a.next.i!==s.i&&VS(a,a.next,n,s))return!0;a=a.next}while(a!==n);return!1}(r,e)&&(Of(r,e)&&Of(e,r)&&function(n,s){let a=n,c=!1;const u=(n.x+s.x)/2,A=(n.y+s.y)/2;do a.y>A!=a.next.y>A&&a.next.y!==a.y&&u<(a.next.x-a.x)*(A-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==n);return c}(r,e)&&(Cr(r.prev,r,e.prev)||Cr(r,e.prev,e))||N0(r,e)&&Cr(r.prev,r,r.next)>0&&Cr(e.prev,e,e.next)>0)}function Cr(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function N0(r,e){return r.x===e.x&&r.y===e.y}function VS(r,e,n,s){const a=O0(Cr(r,e,n)),c=O0(Cr(r,e,s)),u=O0(Cr(n,s,r)),A=O0(Cr(n,s,e));return a!==c&&u!==A||!(a!==0||!F0(r,n,e))||!(c!==0||!F0(r,s,e))||!(u!==0||!F0(n,r,s))||!(A!==0||!F0(n,e,s))}function F0(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function O0(r){return r>0?1:r<0?-1:0}function Of(r,e){return Cr(r.prev,r,r.next)<0?Cr(r,e,r.next)>=0&&Cr(r,r.prev,e)>=0:Cr(r,e,r.prev)<0||Cr(r,r.next,e)<0}function WS(r,e){const n=new a_(r.i,r.x,r.y),s=new a_(e.i,e.x,e.y),a=r.next,c=e.prev;return r.next=e,e.prev=r,n.next=a,a.prev=n,s.next=n,n.prev=s,c.next=s,s.prev=c,s}function jS(r,e,n,s){const a=new a_(r,e,n);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function kf(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function a_(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class El{static area(e){const n=e.length;let s=0;for(let a=n-1,c=0;c<n;a=c++)s+=e[a].x*e[c].y-e[c].x*e[a].y;return .5*s}static isClockWise(e){return El.area(e)<0}static triangulateShape(e,n){const s=[],a=[],c=[];qS(e),XS(s,e);let u=e.length;n.forEach(qS);for(let m=0;m<n.length;m++)a.push(u),u+=n[m].length,XS(s,n[m]);const A=function(m,v,E=2){const C=v&&v.length,M=C?v[0]*E:m.length;let S=zS(m,0,M,E,!0);const B=[];if(!S||S.next===S.prev)return B;let N,L,F,O,H,X,$;if(C&&(S=function(ee,ie,ce,oe){const Se=[];let Ne,ke,Oe,Te,Je;for(Ne=0,ke=ie.length;Ne<ke;Ne++)Oe=ie[Ne]*oe,Te=Ne<ke-1?ie[Ne+1]*oe:ee.length,Je=zS(ee,Oe,Te,oe,!1),Je===Je.next&&(Je.steiner=!0),Se.push(lF(Je));for(Se.sort(sF),Ne=0;Ne<Se.length;Ne++)ce=aF(Se[Ne],ce);return ce}(m,v,S,E)),m.length>80*E){N=F=m[0],L=O=m[1];for(let ee=E;ee<M;ee+=E)H=m[ee],X=m[ee+1],H<N&&(N=H),X<L&&(L=X),H>F&&(F=H),X>O&&(O=X);$=Math.max(F-N,O-L),$=$!==0?32767/$:0}return Ff(S,B,E,N,L,$,0),B}(s,a);for(let m=0;m<A.length;m+=3)c.push(A.slice(m,m+3));return c}}function qS(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function XS(r,e){for(let n=0;n<e.length;n++)r.push(e[n].x),r.push(e[n].y)}class k0 extends vn{constructor(e=new mh([new ct(.5,.5),new ct(-.5,.5),new ct(-.5,-.5),new ct(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const s=this,a=[],c=[];for(let A=0,m=e.length;A<m;A++)u(e[A]);function u(A){const m=[],v=n.curveSegments!==void 0?n.curveSegments:12,E=n.steps!==void 0?n.steps:1,C=n.depth!==void 0?n.depth:1;let M=n.bevelEnabled===void 0||n.bevelEnabled,S=n.bevelThickness!==void 0?n.bevelThickness:.2,B=n.bevelSize!==void 0?n.bevelSize:S-.1,N=n.bevelOffset!==void 0?n.bevelOffset:0,L=n.bevelSegments!==void 0?n.bevelSegments:3;const F=n.extrudePath,O=n.UVGenerator!==void 0?n.UVGenerator:hF;let H,X,$,ee,ie,ce=!1;F&&(H=F.getSpacedPoints(E),ce=!0,M=!1,X=F.computeFrenetFrames(E,!1),$=new R,ee=new R,ie=new R),M||(L=0,S=0,B=0,N=0);const oe=A.extractPoints(v);let Se=oe.shape;const Ne=oe.holes;if(!El.isClockWise(Se)){Se=Se.reverse();for(let mt=0,vt=Ne.length;mt<vt;mt++){const re=Ne[mt];El.isClockWise(re)&&(Ne[mt]=re.reverse())}}const ke=El.triangulateShape(Se,Ne),Oe=Se;for(let mt=0,vt=Ne.length;mt<vt;mt++){const re=Ne[mt];Se=Se.concat(re)}function Te(mt,vt,re){return vt||console.error("THREE.ExtrudeGeometry: vec does not exist"),mt.clone().addScaledVector(vt,re)}const Je=Se.length,st=ke.length;function Et(mt,vt,re){let W,ae,xe;const ge=mt.x-vt.x,Ee=mt.y-vt.y,Ue=re.x-mt.x,Xe=re.y-mt.y,at=ge*ge+Ee*Ee,Xt=ge*Xe-Ee*Ue;if(Math.abs(Xt)>Number.EPSILON){const gt=Math.sqrt(at),cn=Math.sqrt(Ue*Ue+Xe*Xe),yn=vt.x-Ee/gt,tn=vt.y+ge/gt,hn=((re.x-Xe/cn-yn)*Xe-(re.y+Ue/cn-tn)*Ue)/(ge*Xe-Ee*Ue);W=yn+ge*hn-mt.x,ae=tn+Ee*hn-mt.y;const Yn=W*W+ae*ae;if(Yn<=2)return new ct(W,ae);xe=Math.sqrt(Yn/2)}else{let gt=!1;ge>Number.EPSILON?Ue>Number.EPSILON&&(gt=!0):ge<-Number.EPSILON?Ue<-Number.EPSILON&&(gt=!0):Math.sign(Ee)===Math.sign(Xe)&&(gt=!0),gt?(W=-Ee,ae=ge,xe=Math.sqrt(at)):(W=ge,ae=Ee,xe=Math.sqrt(at/2))}return new ct(W/xe,ae/xe)}const dt=[];for(let mt=0,vt=Oe.length,re=vt-1,W=mt+1;mt<vt;mt++,re++,W++)re===vt&&(re=0),W===vt&&(W=0),dt[mt]=Et(Oe[mt],Oe[re],Oe[W]);const Bt=[];let qt,Kt=dt.concat();for(let mt=0,vt=Ne.length;mt<vt;mt++){const re=Ne[mt];qt=[];for(let W=0,ae=re.length,xe=ae-1,ge=W+1;W<ae;W++,xe++,ge++)xe===ae&&(xe=0),ge===ae&&(ge=0),qt[W]=Et(re[W],re[xe],re[ge]);Bt.push(qt),Kt=Kt.concat(qt)}for(let mt=0;mt<L;mt++){const vt=mt/L,re=S*Math.cos(vt*Math.PI/2),W=B*Math.sin(vt*Math.PI/2)+N;for(let ae=0,xe=Oe.length;ae<xe;ae++){const ge=Te(Oe[ae],dt[ae],W);Ot(ge.x,ge.y,-re)}for(let ae=0,xe=Ne.length;ae<xe;ae++){const ge=Ne[ae];qt=Bt[ae];for(let Ee=0,Ue=ge.length;Ee<Ue;Ee++){const Xe=Te(ge[Ee],qt[Ee],W);Ot(Xe.x,Xe.y,-re)}}}const Jt=B+N;for(let mt=0;mt<Je;mt++){const vt=M?Te(Se[mt],Kt[mt],Jt):Se[mt];ce?(ee.copy(X.normals[0]).multiplyScalar(vt.x),$.copy(X.binormals[0]).multiplyScalar(vt.y),ie.copy(H[0]).add(ee).add($),Ot(ie.x,ie.y,ie.z)):Ot(vt.x,vt.y,0)}for(let mt=1;mt<=E;mt++)for(let vt=0;vt<Je;vt++){const re=M?Te(Se[vt],Kt[vt],Jt):Se[vt];ce?(ee.copy(X.normals[mt]).multiplyScalar(re.x),$.copy(X.binormals[mt]).multiplyScalar(re.y),ie.copy(H[mt]).add(ee).add($),Ot(ie.x,ie.y,ie.z)):Ot(re.x,re.y,C/E*mt)}for(let mt=L-1;mt>=0;mt--){const vt=mt/L,re=S*Math.cos(vt*Math.PI/2),W=B*Math.sin(vt*Math.PI/2)+N;for(let ae=0,xe=Oe.length;ae<xe;ae++){const ge=Te(Oe[ae],dt[ae],W);Ot(ge.x,ge.y,C+re)}for(let ae=0,xe=Ne.length;ae<xe;ae++){const ge=Ne[ae];qt=Bt[ae];for(let Ee=0,Ue=ge.length;Ee<Ue;Ee++){const Xe=Te(ge[Ee],qt[Ee],W);ce?Ot(Xe.x,Xe.y+H[E-1].y,H[E-1].x+re):Ot(Xe.x,Xe.y,C+re)}}}function ln(mt,vt){let re=mt.length;for(;--re>=0;){const W=re;let ae=re-1;ae<0&&(ae=mt.length-1);for(let xe=0,ge=E+2*L;xe<ge;xe++){const Ee=Je*xe,Ue=Je*(xe+1);Rt(vt+W+Ee,vt+ae+Ee,vt+ae+Ue,vt+W+Ue)}}}function Ot(mt,vt,re){m.push(mt),m.push(vt),m.push(re)}function nt(mt,vt,re){jt(mt),jt(vt),jt(re);const W=a.length/3,ae=O.generateTopUV(s,a,W-3,W-2,W-1);It(ae[0]),It(ae[1]),It(ae[2])}function Rt(mt,vt,re,W){jt(mt),jt(vt),jt(W),jt(vt),jt(re),jt(W);const ae=a.length/3,xe=O.generateSideWallUV(s,a,ae-6,ae-3,ae-2,ae-1);It(xe[0]),It(xe[1]),It(xe[3]),It(xe[1]),It(xe[2]),It(xe[3])}function jt(mt){a.push(m[3*mt+0]),a.push(m[3*mt+1]),a.push(m[3*mt+2])}function It(mt){c.push(mt.x),c.push(mt.y)}(function(){const mt=a.length/3;if(M){let vt=0,re=Je*vt;for(let W=0;W<st;W++){const ae=ke[W];nt(ae[2]+re,ae[1]+re,ae[0]+re)}vt=E+2*L,re=Je*vt;for(let W=0;W<st;W++){const ae=ke[W];nt(ae[0]+re,ae[1]+re,ae[2]+re)}}else{for(let vt=0;vt<st;vt++){const re=ke[vt];nt(re[2],re[1],re[0])}for(let vt=0;vt<st;vt++){const re=ke[vt];nt(re[0]+Je*E,re[1]+Je*E,re[2]+Je*E)}}s.addGroup(mt,a.length/3-mt,0)})(),function(){const mt=a.length/3;let vt=0;ln(Oe,vt),vt+=Oe.length;for(let re=0,W=Ne.length;re<W;re++){const ae=Ne[re];ln(ae,vt),vt+=ae.length}s.addGroup(mt,a.length/3-mt,1)}()}this.setAttribute("position",new Wt(a,3)),this.setAttribute("uv",new Wt(c,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(n,s,a){if(a.shapes=[],Array.isArray(n))for(let c=0,u=n.length;c<u;c++){const A=n[c];a.shapes.push(A.uuid)}else a.shapes.push(n.uuid);return a.options=Object.assign({},s),s.extrudePath!==void 0&&(a.options.extrudePath=s.extrudePath.toJSON()),a}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,n){const s=[];for(let c=0,u=e.shapes.length;c<u;c++){const A=n[e.shapes[c]];s.push(A)}const a=e.options.extrudePath;return a!==void 0&&(e.options.extrudePath=new B0[a.type]().fromJSON(a)),new k0(s,e.options)}}const hF={generateTopUV:function(r,e,n,s,a){const c=e[3*n],u=e[3*n+1],A=e[3*s],m=e[3*s+1],v=e[3*a],E=e[3*a+1];return[new ct(c,u),new ct(A,m),new ct(v,E)]},generateSideWallUV:function(r,e,n,s,a,c){const u=e[3*n],A=e[3*n+1],m=e[3*n+2],v=e[3*s],E=e[3*s+1],C=e[3*s+2],M=e[3*a],S=e[3*a+1],B=e[3*a+2],N=e[3*c],L=e[3*c+1],F=e[3*c+2];return Math.abs(A-E)<Math.abs(u-v)?[new ct(u,1-m),new ct(v,1-C),new ct(M,1-B),new ct(N,1-F)]:[new ct(A,1-m),new ct(E,1-C),new ct(S,1-B),new ct(L,1-F)]}};class Qf extends fh{constructor(e=1,n=0){const s=(1+Math.sqrt(5))/2;super([-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Qf(e.radius,e.detail)}}class Ep extends fh{constructor(e=1,n=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new Ep(e.radius,e.detail)}}class Ac extends vn{constructor(e=1,n=1,s=1,a=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:s,heightSegments:a};const c=e/2,u=n/2,A=Math.floor(s),m=Math.floor(a),v=A+1,E=m+1,C=e/A,M=n/m,S=[],B=[],N=[],L=[];for(let F=0;F<E;F++){const O=F*M-u;for(let H=0;H<v;H++){const X=H*C-c;B.push(X,-O,0),N.push(0,0,1),L.push(H/A),L.push(1-F/m)}}for(let F=0;F<m;F++)for(let O=0;O<A;O++){const H=O+v*F,X=O+v*(F+1),$=O+1+v*(F+1),ee=O+1+v*F;S.push(H,X,ee),S.push(X,$,ee)}this.setIndex(S),this.setAttribute("position",new Wt(B,3)),this.setAttribute("normal",new Wt(N,3)),this.setAttribute("uv",new Wt(L,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ac(e.width,e.height,e.widthSegments,e.heightSegments)}}class Gf extends vn{constructor(e=.5,n=1,s=32,a=1,c=0,u=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:s,phiSegments:a,thetaStart:c,thetaLength:u},s=Math.max(3,s);const A=[],m=[],v=[],E=[];let C=e;const M=(n-e)/(a=Math.max(1,a)),S=new R,B=new ct;for(let N=0;N<=a;N++){for(let L=0;L<=s;L++){const F=c+L/s*u;S.x=C*Math.cos(F),S.y=C*Math.sin(F),m.push(S.x,S.y,S.z),v.push(0,0,1),B.x=(S.x/n+1)/2,B.y=(S.y/n+1)/2,E.push(B.x,B.y)}C+=M}for(let N=0;N<a;N++){const L=N*(s+1);for(let F=0;F<s;F++){const O=F+L,H=O,X=O+s+1,$=O+s+2,ee=O+1;A.push(H,X,ee),A.push(X,$,ee)}}this.setIndex(A),this.setAttribute("position",new Wt(m,3)),this.setAttribute("normal",new Wt(v,3)),this.setAttribute("uv",new Wt(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gf(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Hf extends vn{constructor(e=new mh([new ct(0,.5),new ct(-.5,-.5),new ct(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const s=[],a=[],c=[],u=[];let A=0,m=0;if(Array.isArray(e)===!1)v(e);else for(let E=0;E<e.length;E++)v(e[E]),this.addGroup(A,m,E),A+=m,m=0;function v(E){const C=a.length/3,M=E.extractPoints(n);let S=M.shape;const B=M.holes;El.isClockWise(S)===!1&&(S=S.reverse());for(let L=0,F=B.length;L<F;L++){const O=B[L];El.isClockWise(O)===!0&&(B[L]=O.reverse())}const N=El.triangulateShape(S,B);for(let L=0,F=B.length;L<F;L++){const O=B[L];S=S.concat(O)}for(let L=0,F=S.length;L<F;L++){const O=S[L];a.push(O.x,O.y,0),c.push(0,0,1),u.push(O.x,O.y)}for(let L=0,F=N.length;L<F;L++){const O=N[L],H=O[0]+C,X=O[1]+C,$=O[2]+C;s.push(H,X,$),m+=3}}this.setIndex(s),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(n,s){if(s.shapes=[],Array.isArray(n))for(let a=0,c=n.length;a<c;a++){const u=n[a];s.shapes.push(u.uuid)}else s.shapes.push(n.uuid);return s}(this.parameters.shapes,e)}static fromJSON(e,n){const s=[];for(let a=0,c=e.shapes.length;a<c;a++){const u=n[e.shapes[a]];s.push(u)}return new Hf(s,e.curveSegments)}}class Bu extends vn{constructor(e=1,n=32,s=16,a=0,c=2*Math.PI,u=0,A=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:s,phiStart:a,phiLength:c,thetaStart:u,thetaLength:A},n=Math.max(3,Math.floor(n)),s=Math.max(2,Math.floor(s));const m=Math.min(u+A,Math.PI);let v=0;const E=[],C=new R,M=new R,S=[],B=[],N=[],L=[];for(let F=0;F<=s;F++){const O=[],H=F/s;let X=0;F===0&&u===0?X=.5/n:F===s&&m===Math.PI&&(X=-.5/n);for(let $=0;$<=n;$++){const ee=$/n;C.x=-e*Math.cos(a+ee*c)*Math.sin(u+H*A),C.y=e*Math.cos(u+H*A),C.z=e*Math.sin(a+ee*c)*Math.sin(u+H*A),B.push(C.x,C.y,C.z),M.copy(C).normalize(),N.push(M.x,M.y,M.z),L.push(ee+X,1-H),O.push(v++)}E.push(O)}for(let F=0;F<s;F++)for(let O=0;O<n;O++){const H=E[F][O+1],X=E[F][O],$=E[F+1][O],ee=E[F+1][O+1];(F!==0||u>0)&&S.push(H,X,ee),(F!==s-1||m<Math.PI)&&S.push(X,$,ee)}this.setIndex(S),this.setAttribute("position",new Wt(B,3)),this.setAttribute("normal",new Wt(N,3)),this.setAttribute("uv",new Wt(L,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class zf extends fh{constructor(e=1,n=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new zf(e.radius,e.detail)}}class Vf extends vn{constructor(e=1,n=.4,s=12,a=48,c=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:s,tubularSegments:a,arc:c},s=Math.floor(s),a=Math.floor(a);const u=[],A=[],m=[],v=[],E=new R,C=new R,M=new R;for(let S=0;S<=s;S++)for(let B=0;B<=a;B++){const N=B/a*c,L=S/s*Math.PI*2;C.x=(e+n*Math.cos(L))*Math.cos(N),C.y=(e+n*Math.cos(L))*Math.sin(N),C.z=n*Math.sin(L),A.push(C.x,C.y,C.z),E.x=e*Math.cos(N),E.y=e*Math.sin(N),M.subVectors(C,E).normalize(),m.push(M.x,M.y,M.z),v.push(B/a),v.push(S/s)}for(let S=1;S<=s;S++)for(let B=1;B<=a;B++){const N=(a+1)*S+B-1,L=(a+1)*(S-1)+B-1,F=(a+1)*(S-1)+B,O=(a+1)*S+B;u.push(N,L,O),u.push(L,F,O)}this.setIndex(u),this.setAttribute("position",new Wt(A,3)),this.setAttribute("normal",new Wt(m,3)),this.setAttribute("uv",new Wt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vf(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Wf extends vn{constructor(e=1,n=.4,s=64,a=8,c=2,u=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:s,radialSegments:a,p:c,q:u},s=Math.floor(s),a=Math.floor(a);const A=[],m=[],v=[],E=[],C=new R,M=new R,S=new R,B=new R,N=new R,L=new R,F=new R;for(let H=0;H<=s;++H){const X=H/s*c*Math.PI*2;O(X,c,u,e,S),O(X+.01,c,u,e,B),L.subVectors(B,S),F.addVectors(B,S),N.crossVectors(L,F),F.crossVectors(N,L),N.normalize(),F.normalize();for(let $=0;$<=a;++$){const ee=$/a*Math.PI*2,ie=-n*Math.cos(ee),ce=n*Math.sin(ee);C.x=S.x+(ie*F.x+ce*N.x),C.y=S.y+(ie*F.y+ce*N.y),C.z=S.z+(ie*F.z+ce*N.z),m.push(C.x,C.y,C.z),M.subVectors(C,S).normalize(),v.push(M.x,M.y,M.z),E.push(H/s),E.push($/a)}}for(let H=1;H<=s;H++)for(let X=1;X<=a;X++){const $=(a+1)*(H-1)+(X-1),ee=(a+1)*H+(X-1),ie=(a+1)*H+X,ce=(a+1)*(H-1)+X;A.push($,ee,ce),A.push(ee,ie,ce)}function O(H,X,$,ee,ie){const ce=Math.cos(H),oe=Math.sin(H),Se=$/X*H,Ne=Math.cos(Se);ie.x=ee*(2+Ne)*.5*ce,ie.y=ee*(2+Ne)*oe*.5,ie.z=ee*Math.sin(Se)*.5}this.setIndex(A),this.setAttribute("position",new Wt(m,3)),this.setAttribute("normal",new Wt(v,3)),this.setAttribute("uv",new Wt(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wf(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Q0 extends vn{constructor(e=new n_(new R(-1,-1,0),new R(-1,1,0),new R(1,1,0)),n=64,s=1,a=8,c=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:s,radialSegments:a,closed:c};const u=e.computeFrenetFrames(n,c);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;const A=new R,m=new R,v=new ct;let E=new R;const C=[],M=[],S=[],B=[];function N(L){E=e.getPointAt(L/n,E);const F=u.normals[L],O=u.binormals[L];for(let H=0;H<=a;H++){const X=H/a*Math.PI*2,$=Math.sin(X),ee=-Math.cos(X);m.x=ee*F.x+$*O.x,m.y=ee*F.y+$*O.y,m.z=ee*F.z+$*O.z,m.normalize(),M.push(m.x,m.y,m.z),A.x=E.x+s*m.x,A.y=E.y+s*m.y,A.z=E.z+s*m.z,C.push(A.x,A.y,A.z)}}(function(){for(let L=0;L<n;L++)N(L);N(c===!1?n:0),function(){for(let L=0;L<=n;L++)for(let F=0;F<=a;F++)v.x=L/n,v.y=F/a,S.push(v.x,v.y)}(),function(){for(let L=1;L<=n;L++)for(let F=1;F<=a;F++){const O=(a+1)*(L-1)+(F-1),H=(a+1)*L+(F-1),X=(a+1)*L+F,$=(a+1)*(L-1)+F;B.push(O,H,$),B.push(H,X,$)}}()})(),this.setIndex(B),this.setAttribute("position",new Wt(C,3)),this.setAttribute("normal",new Wt(M,3)),this.setAttribute("uv",new Wt(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Q0(new B0[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class YS extends vn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],s=new Set,a=new R,c=new R;if(e.index!==null){const u=e.attributes.position,A=e.index;let m=e.groups;m.length===0&&(m=[{start:0,count:A.count,materialIndex:0}]);for(let v=0,E=m.length;v<E;++v){const C=m[v],M=C.start;for(let S=M,B=M+C.count;S<B;S+=3)for(let N=0;N<3;N++){const L=A.getX(S+N),F=A.getX(S+(N+1)%3);a.fromBufferAttribute(u,L),c.fromBufferAttribute(u,F),KS(a,c,s)===!0&&(n.push(a.x,a.y,a.z),n.push(c.x,c.y,c.z))}}}else{const u=e.attributes.position;for(let A=0,m=u.count/3;A<m;A++)for(let v=0;v<3;v++){const E=3*A+v,C=3*A+(v+1)%3;a.fromBufferAttribute(u,E),c.fromBufferAttribute(u,C),KS(a,c,s)===!0&&(n.push(a.x,a.y,a.z),n.push(c.x,c.y,c.z))}}this.setAttribute("position",new Wt(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function KS(r,e,n){const s=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,a=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return n.has(s)!==!0&&n.has(a)!==!0&&(n.add(s),n.add(a),!0)}var JS=Object.freeze({__proto__:null,BoxGeometry:vl,CapsuleGeometry:R0,CircleGeometry:Uf,ConeGeometry:L0,CylinderGeometry:Ah,DodecahedronGeometry:Nf,EdgesGeometry:HS,ExtrudeGeometry:k0,IcosahedronGeometry:Qf,LatheGeometry:Pf,OctahedronGeometry:Ep,PlaneGeometry:Ac,PolyhedronGeometry:fh,RingGeometry:Gf,ShapeGeometry:Hf,SphereGeometry:Bu,TetrahedronGeometry:zf,TorusGeometry:Vf,TorusKnotGeometry:Wf,TubeGeometry:Q0,WireframeGeometry:YS});class o_ extends Ur{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Mt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class G0 extends Ca{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class gh extends Ur{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Mt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lo,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ii,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class lo extends gh{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ct(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Rn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Mt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Mt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Mt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class jf extends Ur{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Mt(16777215),this.specular=new Mt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lo,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ii,this.combine=bs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $S extends Ur{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Mt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lo,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class ZS extends Ur{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lo,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class l_ extends Ur{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Mt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Mt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lo,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ii,this.combine=bs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class c_ extends Ur{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Dg,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class h_ extends Ur{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class eI extends Ur{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Mt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lo,this.normalScale=new ct(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tI extends zr{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Ru(r,e,n){return!r||!n&&r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function nI(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function iI(r){const e=r.length,n=new Array(e);for(let s=0;s!==e;++s)n[s]=s;return n.sort(function(s,a){return r[s]-r[a]}),n}function u_(r,e,n){const s=r.length,a=new r.constructor(s);for(let c=0,u=0;u!==s;++c){const A=n[c]*e;for(let m=0;m!==e;++m)a[u++]=r[A+m]}return a}function d_(r,e,n,s){let a=1,c=r[0];for(;c!==void 0&&c[s]===void 0;)c=r[a++];if(c===void 0)return;let u=c[s];if(u!==void 0)if(Array.isArray(u))do u=c[s],u!==void 0&&(e.push(c.time),n.push.apply(n,u)),c=r[a++];while(c!==void 0);else if(u.toArray!==void 0)do u=c[s],u!==void 0&&(e.push(c.time),u.toArray(n,n.length)),c=r[a++];while(c!==void 0);else do u=c[s],u!==void 0&&(e.push(c.time),n.push(u)),c=r[a++];while(c!==void 0)}const uF={convertArray:Ru,isTypedArray:nI,getKeyframeOrder:iI,sortedArray:u_,flattenJSON:d_,subclip:function(r,e,n,s,a=30){const c=r.clone();c.name=e;const u=[];for(let m=0;m<c.tracks.length;++m){const v=c.tracks[m],E=v.getValueSize(),C=[],M=[];for(let S=0;S<v.times.length;++S){const B=v.times[S]*a;if(!(B<n||B>=s)){C.push(v.times[S]);for(let N=0;N<E;++N)M.push(v.values[S*E+N])}}C.length!==0&&(v.times=Ru(C,v.times.constructor),v.values=Ru(M,v.values.constructor),u.push(v))}c.tracks=u;let A=1/0;for(let m=0;m<c.tracks.length;++m)A>c.tracks[m].times[0]&&(A=c.tracks[m].times[0]);for(let m=0;m<c.tracks.length;++m)c.tracks[m].shift(-1*A);return c.resetDuration(),c},makeClipAdditive:function(r,e=0,n=r,s=30){s<=0&&(s=30);const a=n.tracks.length,c=e/s;for(let u=0;u<a;++u){const A=n.tracks[u],m=A.ValueTypeName;if(m==="bool"||m==="string")continue;const v=r.tracks.find(function(F){return F.name===A.name&&F.ValueTypeName===m});if(v===void 0)continue;let E=0;const C=A.getValueSize();A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(E=C/3);let M=0;const S=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(M=S/3);const B=A.times.length-1;let N;if(c<=A.times[0]){const F=E,O=C-E;N=A.values.slice(F,O)}else if(c>=A.times[B]){const F=B*C+E,O=F+C-E;N=A.values.slice(F,O)}else{const F=A.createInterpolant(),O=E,H=C-E;F.evaluate(c),N=F.resultBuffer.slice(O,H)}m==="quaternion"&&new ai().fromArray(N).normalize().conjugate().toArray(N);const L=v.times.length;for(let F=0;F<L;++F){const O=F*S+M;if(m==="quaternion")ai.multiplyQuaternionsFlat(v.values,O,N,0,v.values,O);else{const H=S-2*M;for(let X=0;X<H;++X)v.values[O+X]-=N[X]}}}return r.blendMode=tf,r}};class xp{constructor(e,n,s,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=a!==void 0?a:new n.constructor(s),this.sampleValues=n,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let s=this._cachedIndex,a=n[s],c=n[s-1];e:{t:{let u;n:{i:if(!(e<a)){for(let A=s+2;;){if(a===void 0){if(e<c)break i;return s=n.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===A)break;if(c=a,a=n[++s],e<a)break t}u=n.length;break n}if(e>=c)break e;{const A=n[1];e<A&&(s=2,c=A);for(let m=s-2;;){if(c===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===m)break;if(a=c,c=n[--s-1],e>=c)break t}u=s,s=0}}for(;s<u;){const A=s+u>>>1;e<n[A]?u=A:s=A+1}if(a=n[s],c=n[s-1],c===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(a===void 0)return s=n.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,c,a)}return this.interpolate_(s,c,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,c=e*a;for(let u=0;u!==a;++u)n[u]=s[c+u];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class rI extends xp{constructor(e,n,s,a){super(e,n,s,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ec,endingEnd:ec}}intervalChanged_(e,n,s){const a=this.parameterPositions;let c=e-2,u=e+1,A=a[c],m=a[u];if(A===void 0)switch(this.getSettings_().endingStart){case tc:c=e,A=2*n-s;break;case vu:c=a.length-2,A=n+a[c]-a[c+1];break;default:c=e,A=s}if(m===void 0)switch(this.getSettings_().endingEnd){case tc:u=e,m=2*s-n;break;case vu:u=1,m=s+a[1]-a[0];break;default:u=e-1,m=n}const v=.5*(s-n),E=this.valueSize;this._weightPrev=v/(n-A),this._weightNext=v/(m-s),this._offsetPrev=c*E,this._offsetNext=u*E}interpolate_(e,n,s,a){const c=this.resultBuffer,u=this.sampleValues,A=this.valueSize,m=e*A,v=m-A,E=this._offsetPrev,C=this._offsetNext,M=this._weightPrev,S=this._weightNext,B=(s-n)/(a-n),N=B*B,L=N*B,F=-M*L+2*M*N-M*B,O=(1+M)*L+(-1.5-2*M)*N+(-.5+M)*B+1,H=(-1-S)*L+(1.5+S)*N+.5*B,X=S*L-S*N;for(let $=0;$!==A;++$)c[$]=F*u[E+$]+O*u[v+$]+H*u[m+$]+X*u[C+$];return c}}class p_ extends xp{constructor(e,n,s,a){super(e,n,s,a)}interpolate_(e,n,s,a){const c=this.resultBuffer,u=this.sampleValues,A=this.valueSize,m=e*A,v=m-A,E=(s-n)/(a-n),C=1-E;for(let M=0;M!==A;++M)c[M]=u[v+M]*C+u[m+M]*E;return c}}class sI extends xp{constructor(e,n,s,a){super(e,n,s,a)}interpolate_(e){return this.copySampleValue_(e-1)}}class ko{constructor(e,n,s,a){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ru(n,this.TimeBufferType),this.values=Ru(s,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let s;if(n.toJSON!==this.toJSON)s=n.toJSON(e);else{s={name:e.name,times:Ru(e.times,Array),values:Ru(e.values,Array)};const a=e.getInterpolation();a!==e.DefaultInterpolation&&(s.interpolation=a)}return s.type=e.ValueTypeName,s}InterpolantFactoryMethodDiscrete(e){return new sI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new p_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new rI(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case $l:n=this.InterpolantFactoryMethodDiscrete;break;case Zl:n=this.InterpolantFactoryMethodLinear;break;case Kd:n=this.InterpolantFactoryMethodSmooth}if(n===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(s);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return $l;case this.InterpolantFactoryMethodLinear:return Zl;case this.InterpolantFactoryMethodSmooth:return Kd}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let s=0,a=n.length;s!==a;++s)n[s]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let s=0,a=n.length;s!==a;++s)n[s]*=e}return this}trim(e,n){const s=this.times,a=s.length;let c=0,u=a-1;for(;c!==a&&s[c]<e;)++c;for(;u!==-1&&s[u]>n;)--u;if(++u,c!==0||u!==a){c>=u&&(u=Math.max(u,1),c=u-1);const A=this.getValueSize();this.times=s.slice(c,u),this.values=this.values.slice(c*A,u*A)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const s=this.times,a=this.values,c=s.length;c===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let u=null;for(let A=0;A!==c;A++){const m=s[A];if(typeof m=="number"&&isNaN(m)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,A,m),e=!1;break}if(u!==null&&u>m){console.error("THREE.KeyframeTrack: Out of order keys.",this,A,m,u),e=!1;break}u=m}if(a!==void 0&&nI(a))for(let A=0,m=a.length;A!==m;++A){const v=a[A];if(isNaN(v)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,A,v),e=!1;break}}return e}optimize(){const e=this.times.slice(),n=this.values.slice(),s=this.getValueSize(),a=this.getInterpolation()===Kd,c=e.length-1;let u=1;for(let A=1;A<c;++A){let m=!1;const v=e[A];if(v!==e[A+1]&&(A!==1||v!==e[0]))if(a)m=!0;else{const E=A*s,C=E-s,M=E+s;for(let S=0;S!==s;++S){const B=n[E+S];if(B!==n[C+S]||B!==n[M+S]){m=!0;break}}}if(m){if(A!==u){e[u]=e[A];const E=A*s,C=u*s;for(let M=0;M!==s;++M)n[C+M]=n[E+M]}++u}}if(c>0){e[u]=e[c];for(let A=c*s,m=u*s,v=0;v!==s;++v)n[m+v]=n[A+v];++u}return u!==e.length?(this.times=e.slice(0,u),this.values=n.slice(0,u*s)):(this.times=e,this.values=n),this}clone(){const e=this.times.slice(),n=this.values.slice(),s=new this.constructor(this.name,e,n);return s.createInterpolant=this.createInterpolant,s}}ko.prototype.TimeBufferType=Float32Array,ko.prototype.ValueBufferType=Float32Array,ko.prototype.DefaultInterpolation=Zl;class Lu extends ko{constructor(e,n,s){super(e,n,s)}}Lu.prototype.ValueTypeName="bool",Lu.prototype.ValueBufferType=Array,Lu.prototype.DefaultInterpolation=$l,Lu.prototype.InterpolantFactoryMethodLinear=void 0,Lu.prototype.InterpolantFactoryMethodSmooth=void 0;class A_ extends ko{}A_.prototype.ValueTypeName="color";class Du extends ko{}Du.prototype.ValueTypeName="number";class aI extends xp{constructor(e,n,s,a){super(e,n,s,a)}interpolate_(e,n,s,a){const c=this.resultBuffer,u=this.sampleValues,A=this.valueSize,m=(s-n)/(a-n);let v=e*A;for(let E=v+A;v!==E;v+=4)ai.slerpFlat(c,0,u,v-A,u,v,m);return c}}class Pu extends ko{InterpolantFactoryMethodLinear(e){return new aI(this.times,this.values,this.getValueSize(),e)}}Pu.prototype.ValueTypeName="quaternion",Pu.prototype.InterpolantFactoryMethodSmooth=void 0;class Uu extends ko{constructor(e,n,s){super(e,n,s)}}Uu.prototype.ValueTypeName="string",Uu.prototype.ValueBufferType=Array,Uu.prototype.DefaultInterpolation=$l,Uu.prototype.InterpolantFactoryMethodLinear=void 0,Uu.prototype.InterpolantFactoryMethodSmooth=void 0;class Nu extends ko{}Nu.prototype.ValueTypeName="vector";class _p{constructor(e="",n=-1,s=[],a=ef){this.name=e,this.tracks=s,this.duration=n,this.blendMode=a,this.uuid=Pr(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],s=e.tracks,a=1/(e.fps||1);for(let u=0,A=s.length;u!==A;++u)n.push(dF(s[u]).scale(a));const c=new this(e.name,e.duration,n,e.blendMode);return c.uuid=e.uuid,c}static toJSON(e){const n=[],s=e.tracks,a={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let c=0,u=s.length;c!==u;++c)n.push(ko.toJSON(s[c]));return a}static CreateFromMorphTargetSequence(e,n,s,a){const c=n.length,u=[];for(let A=0;A<c;A++){let m=[],v=[];m.push((A+c-1)%c,A,(A+1)%c),v.push(0,1,0);const E=iI(m);m=u_(m,1,E),v=u_(v,1,E),a||m[0]!==0||(m.push(c),v.push(v[0])),u.push(new Du(".morphTargetInfluences["+n[A].name+"]",m,v).scale(1/s))}return new this(e,-1,u)}static findByName(e,n){let s=e;if(!Array.isArray(e)){const a=e;s=a.geometry&&a.geometry.animations||a.animations}for(let a=0;a<s.length;a++)if(s[a].name===n)return s[a];return null}static CreateClipsFromMorphTargetSequences(e,n,s){const a={},c=/^([\w-]*?)([\d]+)$/;for(let A=0,m=e.length;A<m;A++){const v=e[A],E=v.name.match(c);if(E&&E.length>1){const C=E[1];let M=a[C];M||(a[C]=M=[]),M.push(v)}}const u=[];for(const A in a)u.push(this.CreateFromMorphTargetSequence(A,a[A],n,s));return u}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=function(E,C,M,S,B){if(M.length!==0){const N=[],L=[];d_(M,N,L,S),N.length!==0&&B.push(new E(C,N,L))}},a=[],c=e.name||"default",u=e.fps||30,A=e.blendMode;let m=e.length||-1;const v=e.hierarchy||[];for(let E=0;E<v.length;E++){const C=v[E].keys;if(C&&C.length!==0)if(C[0].morphTargets){const M={};let S;for(S=0;S<C.length;S++)if(C[S].morphTargets)for(let B=0;B<C[S].morphTargets.length;B++)M[C[S].morphTargets[B]]=-1;for(const B in M){const N=[],L=[];for(let F=0;F!==C[S].morphTargets.length;++F){const O=C[S];N.push(O.time),L.push(O.morphTarget===B?1:0)}a.push(new Du(".morphTargetInfluence["+B+"]",N,L))}m=M.length*u}else{const M=".bones["+n[E].name+"]";s(Nu,M+".position",C,"pos",a),s(Pu,M+".quaternion",C,"rot",a),s(Nu,M+".scale",C,"scl",a)}}return a.length===0?null:new this(c,m,a,A)}resetDuration(){let e=0;for(let n=0,s=this.tracks.length;n!==s;++n){const a=this.tracks[n];e=Math.max(e,a.times[a.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function dF(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Du;case"vector":case"vector2":case"vector3":case"vector4":return Nu;case"color":return A_;case"quaternion":return Pu;case"bool":case"boolean":return Lu;case"string":return Uu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(r.type);if(r.times===void 0){const n=[],s=[];d_(r.keys,n,s,"value"),r.times=n,r.values=s}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const co={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class f_{constructor(e,n,s){const a=this;let c,u=!1,A=0,m=0;const v=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=s,this.itemStart=function(E){m++,u===!1&&a.onStart!==void 0&&a.onStart(E,A,m),u=!0},this.itemEnd=function(E){A++,a.onProgress!==void 0&&a.onProgress(E,A,m),A===m&&(u=!1,a.onLoad!==void 0&&a.onLoad())},this.itemError=function(E){a.onError!==void 0&&a.onError(E)},this.resolveURL=function(E){return c?c(E):E},this.setURLModifier=function(E){return c=E,this},this.addHandler=function(E,C){return v.push(E,C),this},this.removeHandler=function(E){const C=v.indexOf(E);return C!==-1&&v.splice(C,2),this},this.getHandler=function(E){for(let C=0,M=v.length;C<M;C+=2){const S=v[C],B=v[C+1];if(S.global&&(S.lastIndex=0),S.test(E))return B}return null}}}const m_=new f_;class $r{constructor(e){this.manager=e!==void 0?e:m_,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const s=this;return new Promise(function(a,c){s.load(e,a,n,c)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}$r.DEFAULT_MATERIAL_NAME="__DEFAULT";const fc={};class pF extends Error{constructor(e,n){super(e),this.response=n}}class Zr extends $r{constructor(e){super(e)}load(e,n,s,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=co.get(e);if(c!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(c),this.manager.itemEnd(e)},0),c;if(fc[e]!==void 0)return void fc[e].push({onLoad:n,onProgress:s,onError:a});fc[e]=[],fc[e].push({onLoad:n,onProgress:s,onError:a});const u=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),A=this.mimeType,m=this.responseType;fetch(u).then(v=>{if(v.status===200||v.status===0){if(v.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||v.body===void 0||v.body.getReader===void 0)return v;const E=fc[e],C=v.body.getReader(),M=v.headers.get("X-File-Size")||v.headers.get("Content-Length"),S=M?parseInt(M):0,B=S!==0;let N=0;const L=new ReadableStream({start(F){(function O(){C.read().then(({done:H,value:X})=>{if(H)F.close();else{N+=X.byteLength;const $=new ProgressEvent("progress",{lengthComputable:B,loaded:N,total:S});for(let ee=0,ie=E.length;ee<ie;ee++){const ce=E[ee];ce.onProgress&&ce.onProgress($)}F.enqueue(X),O()}},H=>{F.error(H)})})()}});return new Response(L)}throw new pF(`fetch for "${v.url}" responded with ${v.status}: ${v.statusText}`,v)}).then(v=>{switch(m){case"arraybuffer":return v.arrayBuffer();case"blob":return v.blob();case"document":return v.text().then(E=>new DOMParser().parseFromString(E,A));case"json":return v.json();default:if(A===void 0)return v.text();{const E=/charset="?([^;"\s]*)"?/i.exec(A),C=E&&E[1]?E[1].toLowerCase():void 0,M=new TextDecoder(C);return v.arrayBuffer().then(S=>M.decode(S))}}}).then(v=>{co.add(e,v);const E=fc[e];delete fc[e];for(let C=0,M=E.length;C<M;C++){const S=E[C];S.onLoad&&S.onLoad(v)}}).catch(v=>{const E=fc[e];if(E===void 0)throw this.manager.itemError(e),v;delete fc[e];for(let C=0,M=E.length;C<M;C++){const S=E[C];S.onError&&S.onError(v)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AF extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=new Zr(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(A){try{n(c.parse(JSON.parse(A)))}catch(m){a?a(m):console.error(m),c.manager.itemError(e)}},s,a)}parse(e){const n=[];for(let s=0;s<e.length;s++){const a=_p.parse(e[s]);n.push(a)}return n}}class fF extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=[],A=new vp,m=new Zr(this.manager);m.setPath(this.path),m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setWithCredentials(c.withCredentials);let v=0;function E(C){m.load(e[C],function(M){const S=c.parse(M,!0);u[C]={width:S.width,height:S.height,format:S.format,mipmaps:S.mipmaps},v+=1,v===6&&(S.mipmapCount===1&&(A.minFilter=bi),A.image=u,A.format=S.format,A.needsUpdate=!0,n&&n(A))},s,a)}if(Array.isArray(e))for(let C=0,M=e.length;C<M;++C)E(C);else m.load(e,function(C){const M=c.parse(C,!0);if(M.isCubemap){const S=M.mipmaps.length/M.mipmapCount;for(let B=0;B<S;B++){u[B]={mipmaps:[]};for(let N=0;N<M.mipmapCount;N++)u[B].mipmaps.push(M.mipmaps[B*M.mipmapCount+N]),u[B].format=M.format,u[B].width=M.width,u[B].height=M.height}A.image=u}else A.image.width=M.width,A.image.height=M.height,A.mipmaps=M.mipmaps;M.mipmapCount===1&&(A.minFilter=bi),A.format=M.format,A.needsUpdate=!0,n&&n(A)},s,a);return A}}class Fu extends $r{constructor(e){super(e)}load(e,n,s,a){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=this,u=co.get(e);if(u!==void 0)return c.manager.itemStart(e),setTimeout(function(){n&&n(u),c.manager.itemEnd(e)},0),u;const A=lh("img");function m(){E(),co.add(e,this),n&&n(this),c.manager.itemEnd(e)}function v(C){E(),a&&a(C),c.manager.itemError(e),c.manager.itemEnd(e)}function E(){A.removeEventListener("load",m,!1),A.removeEventListener("error",v,!1)}return A.addEventListener("load",m,!1),A.addEventListener("error",v,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(A.crossOrigin=this.crossOrigin),c.manager.itemStart(e),A.src=e,A}}class oI extends $r{constructor(e){super(e)}load(e,n,s,a){const c=new hp;c.colorSpace=si;const u=new Fu(this.manager);u.setCrossOrigin(this.crossOrigin),u.setPath(this.path);let A=0;function m(v){u.load(e[v],function(E){c.images[v]=E,A++,A===6&&(c.needsUpdate=!0,n&&n(c))},void 0,a)}for(let v=0;v<e.length;++v)m(v);return c}}class mF extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=new Fo,A=new Zr(this.manager);return A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setPath(this.path),A.setWithCredentials(c.withCredentials),A.load(e,function(m){let v;try{v=c.parse(m)}catch(E){if(a===void 0)return void console.error(E);a(E)}v.image!==void 0?u.image=v.image:v.data!==void 0&&(u.image.width=v.width,u.image.height=v.height,u.image.data=v.data),u.wrapS=v.wrapS!==void 0?v.wrapS:Dr,u.wrapT=v.wrapT!==void 0?v.wrapT:Dr,u.magFilter=v.magFilter!==void 0?v.magFilter:bi,u.minFilter=v.minFilter!==void 0?v.minFilter:bi,u.anisotropy=v.anisotropy!==void 0?v.anisotropy:1,v.colorSpace!==void 0&&(u.colorSpace=v.colorSpace),v.flipY!==void 0&&(u.flipY=v.flipY),v.format!==void 0&&(u.format=v.format),v.type!==void 0&&(u.type=v.type),v.mipmaps!==void 0&&(u.mipmaps=v.mipmaps,u.minFilter=hs),v.mipmapCount===1&&(u.minFilter=bi),v.generateMipmaps!==void 0&&(u.generateMipmaps=v.generateMipmaps),u.needsUpdate=!0,n&&n(u,v)},s,a),u}}class H0 extends $r{constructor(e){super(e)}load(e,n,s,a){const c=new Pi,u=new Fu(this.manager);return u.setCrossOrigin(this.crossOrigin),u.setPath(this.path),u.load(e,function(A){c.image=A,c.needsUpdate=!0,n!==void 0&&n(c)},s,a),c}}class vh extends kn{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new Mt(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(n.object.target=this.target.uuid),n}}class g_ extends vh{constructor(e,n,s){super(e,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Mt(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}}const v_=new Qt,lI=new R,cI=new R;class y_{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ct(512,512),this.map=null,this.mapPass=null,this.matrix=new Qt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new If,this._frameExtents=new ct(1,1),this._viewportCount=1,this._viewports=[new pi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,s=this.matrix;lI.setFromMatrixPosition(e.matrixWorld),n.position.copy(lI),cI.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(cI),n.updateMatrixWorld(),v_.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(v_),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(v_)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class gF extends y_{constructor(){super(new Hr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,s=2*io*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,c=e.distance||n.far;s===n.fov&&a===n.aspect&&c===n.far||(n.fov=s,n.aspect=a,n.far=c,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class z0 extends vh{constructor(e,n,s=0,a=Math.PI/3,c=0,u=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.target=new kn,this.distance=s,this.angle=a,this.penumbra=c,this.decay=u,this.map=null,this.shadow=new gF}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const hI=new Qt,qf=new R,E_=new R;class vF extends y_{constructor(){super(new Hr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ct(4,2),this._viewportCount=6,this._viewports=[new pi(2,1,1,1),new pi(0,1,1,1),new pi(3,1,1,1),new pi(1,1,1,1),new pi(3,0,1,1),new pi(1,0,1,1)],this._cubeDirections=[new R(1,0,0),new R(-1,0,0),new R(0,0,1),new R(0,0,-1),new R(0,1,0),new R(0,-1,0)],this._cubeUps=[new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,0,1),new R(0,0,-1)]}updateMatrices(e,n=0){const s=this.camera,a=this.matrix,c=e.distance||s.far;c!==s.far&&(s.far=c,s.updateProjectionMatrix()),qf.setFromMatrixPosition(e.matrixWorld),s.position.copy(qf),E_.copy(s.position),E_.add(this._cubeDirections[n]),s.up.copy(this._cubeUps[n]),s.lookAt(E_),s.updateMatrixWorld(),a.makeTranslation(-qf.x,-qf.y,-qf.z),hI.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hI)}}class V0 extends vh{constructor(e,n,s=0,a=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=a,this.shadow=new vF}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class mc extends l0{constructor(e=-1,n=1,s=1,a=-1,c=.1,u=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=s,this.bottom=a,this.near=c,this.far=u,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,s,a,c,u){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=s,this.view.offsetY=a,this.view.width=c,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let c=s-e,u=s+e,A=a+n,m=a-n;if(this.view!==null&&this.view.enabled){const v=(this.right-this.left)/this.view.fullWidth/this.zoom,E=(this.top-this.bottom)/this.view.fullHeight/this.zoom;c+=v*this.view.offsetX,u=c+v*this.view.width,A-=E*this.view.offsetY,m=A-E*this.view.height}this.projectionMatrix.makeOrthographic(c,u,A,m,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}class yF extends y_{constructor(){super(new mc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class W0 extends vh{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(kn.DEFAULT_UP),this.updateMatrix(),this.target=new kn,this.shadow=new yF}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class x_ extends vh{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class uI extends vh{constructor(e,n,s=10,a=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=a}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class bp{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new R)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const s=e.x,a=e.y,c=e.z,u=this.coefficients;return n.copy(u[0]).multiplyScalar(.282095),n.addScaledVector(u[1],.488603*a),n.addScaledVector(u[2],.488603*c),n.addScaledVector(u[3],.488603*s),n.addScaledVector(u[4],s*a*1.092548),n.addScaledVector(u[5],a*c*1.092548),n.addScaledVector(u[6],.315392*(3*c*c-1)),n.addScaledVector(u[7],s*c*1.092548),n.addScaledVector(u[8],.546274*(s*s-a*a)),n}getIrradianceAt(e,n){const s=e.x,a=e.y,c=e.z,u=this.coefficients;return n.copy(u[0]).multiplyScalar(.886227),n.addScaledVector(u[1],1.023328*a),n.addScaledVector(u[2],1.023328*c),n.addScaledVector(u[3],1.023328*s),n.addScaledVector(u[4],.858086*s*a),n.addScaledVector(u[5],.858086*a*c),n.addScaledVector(u[6],.743125*c*c-.247708),n.addScaledVector(u[7],.858086*s*c),n.addScaledVector(u[8],.429043*(s*s-a*a)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(e.coefficients[s],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let s=0;s<9;s++)this.coefficients[s].lerp(e.coefficients[s],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const s=this.coefficients;for(let a=0;a<9;a++)s[a].fromArray(e,n+3*a);return this}toArray(e=[],n=0){const s=this.coefficients;for(let a=0;a<9;a++)s[a].toArray(e,n+3*a);return e}static getBasisAt(e,n){const s=e.x,a=e.y,c=e.z;n[0]=.282095,n[1]=.488603*a,n[2]=.488603*c,n[3]=.488603*s,n[4]=1.092548*s*a,n[5]=1.092548*a*c,n[6]=.315392*(3*c*c-1),n[7]=1.092548*s*c,n[8]=.546274*(s*s-a*a)}}class Ou extends vh{constructor(e=new bp,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class j0 extends $r{constructor(e){super(e),this.textures={}}load(e,n,s,a){const c=this,u=new Zr(c.manager);u.setPath(c.path),u.setRequestHeader(c.requestHeader),u.setWithCredentials(c.withCredentials),u.load(e,function(A){try{n(c.parse(JSON.parse(A)))}catch(m){a?a(m):console.error(m),c.manager.itemError(e)}},s,a)}parse(e){const n=this.textures;function s(c){return n[c]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",c),n[c]}const a=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(a.uuid=e.uuid),e.name!==void 0&&(a.name=e.name),e.color!==void 0&&a.color!==void 0&&a.color.setHex(e.color),e.roughness!==void 0&&(a.roughness=e.roughness),e.metalness!==void 0&&(a.metalness=e.metalness),e.sheen!==void 0&&(a.sheen=e.sheen),e.sheenColor!==void 0&&(a.sheenColor=new Mt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(a.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&a.emissive!==void 0&&a.emissive.setHex(e.emissive),e.specular!==void 0&&a.specular!==void 0&&a.specular.setHex(e.specular),e.specularIntensity!==void 0&&(a.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&a.specularColor!==void 0&&a.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(a.shininess=e.shininess),e.clearcoat!==void 0&&(a.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(a.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(a.dispersion=e.dispersion),e.iridescence!==void 0&&(a.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(a.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(a.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(a.transmission=e.transmission),e.thickness!==void 0&&(a.thickness=e.thickness),e.attenuationDistance!==void 0&&(a.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&a.attenuationColor!==void 0&&a.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(a.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(a.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.combine!==void 0&&(a.combine=e.combine),e.side!==void 0&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.opacity!==void 0&&(a.opacity=e.opacity),e.transparent!==void 0&&(a.transparent=e.transparent),e.alphaTest!==void 0&&(a.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(a.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(a.blendSrc=e.blendSrc),e.blendDst!==void 0&&(a.blendDst=e.blendDst),e.blendEquation!==void 0&&(a.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(a.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(a.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(a.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&a.blendColor!==void 0&&a.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(a.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(a.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(a.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(a.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(a.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(a.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(a.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(a.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(a.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.linewidth!==void 0&&(a.linewidth=e.linewidth),e.dashSize!==void 0&&(a.dashSize=e.dashSize),e.gapSize!==void 0&&(a.gapSize=e.gapSize),e.scale!==void 0&&(a.scale=e.scale),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(a.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(a.visible=e.visible),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped),e.userData!==void 0&&(a.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const c in e.uniforms){const u=e.uniforms[c];switch(a.uniforms[c]={},u.type){case"t":a.uniforms[c].value=s(u.value);break;case"c":a.uniforms[c].value=new Mt().setHex(u.value);break;case"v2":a.uniforms[c].value=new ct().fromArray(u.value);break;case"v3":a.uniforms[c].value=new R().fromArray(u.value);break;case"v4":a.uniforms[c].value=new pi().fromArray(u.value);break;case"m3":a.uniforms[c].value=new wn().fromArray(u.value);break;case"m4":a.uniforms[c].value=new Qt().fromArray(u.value);break;default:a.uniforms[c].value=u.value}}if(e.defines!==void 0&&(a.defines=e.defines),e.vertexShader!==void 0&&(a.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(a.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(a.glslVersion=e.glslVersion),e.extensions!==void 0)for(const c in e.extensions)a.extensions[c]=e.extensions[c];if(e.lights!==void 0&&(a.lights=e.lights),e.clipping!==void 0&&(a.clipping=e.clipping),e.size!==void 0&&(a.size=e.size),e.sizeAttenuation!==void 0&&(a.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(a.map=s(e.map)),e.matcap!==void 0&&(a.matcap=s(e.matcap)),e.alphaMap!==void 0&&(a.alphaMap=s(e.alphaMap)),e.bumpMap!==void 0&&(a.bumpMap=s(e.bumpMap)),e.bumpScale!==void 0&&(a.bumpScale=e.bumpScale),e.normalMap!==void 0&&(a.normalMap=s(e.normalMap)),e.normalMapType!==void 0&&(a.normalMapType=e.normalMapType),e.normalScale!==void 0){let c=e.normalScale;Array.isArray(c)===!1&&(c=[c,c]),a.normalScale=new ct().fromArray(c)}return e.displacementMap!==void 0&&(a.displacementMap=s(e.displacementMap)),e.displacementScale!==void 0&&(a.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(a.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(a.roughnessMap=s(e.roughnessMap)),e.metalnessMap!==void 0&&(a.metalnessMap=s(e.metalnessMap)),e.emissiveMap!==void 0&&(a.emissiveMap=s(e.emissiveMap)),e.emissiveIntensity!==void 0&&(a.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(a.specularMap=s(e.specularMap)),e.specularIntensityMap!==void 0&&(a.specularIntensityMap=s(e.specularIntensityMap)),e.specularColorMap!==void 0&&(a.specularColorMap=s(e.specularColorMap)),e.envMap!==void 0&&(a.envMap=s(e.envMap)),e.envMapRotation!==void 0&&a.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(a.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(a.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(a.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(a.lightMap=s(e.lightMap)),e.lightMapIntensity!==void 0&&(a.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(a.aoMap=s(e.aoMap)),e.aoMapIntensity!==void 0&&(a.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(a.gradientMap=s(e.gradientMap)),e.clearcoatMap!==void 0&&(a.clearcoatMap=s(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(a.clearcoatRoughnessMap=s(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(a.clearcoatNormalMap=s(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(a.clearcoatNormalScale=new ct().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(a.iridescenceMap=s(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(a.iridescenceThicknessMap=s(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(a.transmissionMap=s(e.transmissionMap)),e.thicknessMap!==void 0&&(a.thicknessMap=s(e.thicknessMap)),e.anisotropyMap!==void 0&&(a.anisotropyMap=s(e.anisotropyMap)),e.sheenColorMap!==void 0&&(a.sheenColorMap=s(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(a.sheenRoughnessMap=s(e.sheenRoughnessMap)),a}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return j0.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:o_,SpriteMaterial:Dx,RawShaderMaterial:G0,ShaderMaterial:Ca,PointsMaterial:ph,MeshPhysicalMaterial:lo,MeshStandardMaterial:gh,MeshPhongMaterial:jf,MeshToonMaterial:$S,MeshNormalMaterial:ZS,MeshLambertMaterial:l_,MeshDepthMaterial:c_,MeshDistanceMaterial:h_,MeshBasicMaterial:Jr,MeshMatcapMaterial:eI,LineDashedMaterial:tI,LineBasicMaterial:zr,Material:Ur}[e]}}class xl{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let s=0,a=e.length;s<a;s++)n+=String.fromCharCode(e[s]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class dI extends vn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class pI extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=new Zr(c.manager);u.setPath(c.path),u.setRequestHeader(c.requestHeader),u.setWithCredentials(c.withCredentials),u.load(e,function(A){try{n(c.parse(JSON.parse(A)))}catch(m){a?a(m):console.error(m),c.manager.itemError(e)}},s,a)}parse(e){const n={},s={};function a(C,M){if(n[M]!==void 0)return n[M];const S=C.interleavedBuffers[M],B=function(F,O){if(s[O]!==void 0)return s[O];const H=F.arrayBuffers[O],X=new Uint32Array(H).buffer;return s[O]=X,X}(C,S.buffer),N=Al(S.type,B),L=new up(N,S.stride);return L.uuid=S.uuid,n[M]=L,L}const c=e.isInstancedBufferGeometry?new dI:new vn,u=e.data.index;if(u!==void 0){const C=Al(u.type,u.array);c.setIndex(new qn(C,1))}const A=e.data.attributes;for(const C in A){const M=A[C];let S;if(M.isInterleavedBufferAttribute){const B=a(e.data,M.data);S=new dc(B,M.itemSize,M.offset,M.normalized)}else{const B=Al(M.type,M.array);S=new(M.isInstancedBufferAttribute?pc:qn)(B,M.itemSize,M.normalized)}M.name!==void 0&&(S.name=M.name),M.usage!==void 0&&S.setUsage(M.usage),c.setAttribute(C,S)}const m=e.data.morphAttributes;if(m)for(const C in m){const M=m[C],S=[];for(let B=0,N=M.length;B<N;B++){const L=M[B];let F;if(L.isInterleavedBufferAttribute){const O=a(e.data,L.data);F=new dc(O,L.itemSize,L.offset,L.normalized)}else{const O=Al(L.type,L.array);F=new qn(O,L.itemSize,L.normalized)}L.name!==void 0&&(F.name=L.name),S.push(F)}c.morphAttributes[C]=S}e.data.morphTargetsRelative&&(c.morphTargetsRelative=!0);const v=e.data.groups||e.data.drawcalls||e.data.offsets;if(v!==void 0)for(let C=0,M=v.length;C!==M;++C){const S=v[C];c.addGroup(S.start,S.count,S.materialIndex)}const E=e.data.boundingSphere;if(E!==void 0){const C=new R;E.center!==void 0&&C.fromArray(E.center),c.boundingSphere=new on(C,E.radius)}return e.name&&(c.name=e.name),e.userData&&(c.userData=e.userData),c}}class EF extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=this.path===""?xl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||u;const A=new Zr(this.manager);A.setPath(this.path),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(e,function(m){let v=null;try{v=JSON.parse(m)}catch(C){return a!==void 0&&a(C),void console.error("THREE:ObjectLoader: Can't parse "+e+".",C.message)}const E=v.metadata;if(E===void 0||E.type===void 0||E.type.toLowerCase()==="geometry")return a!==void 0&&a(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);c.parse(v,n)},s,a)}async loadAsync(e,n){const s=this.path===""?xl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new Zr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const c=await a.loadAsync(e,n),u=JSON.parse(c),A=u.metadata;if(A===void 0||A.type===void 0||A.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(u)}parse(e,n){const s=this.parseAnimations(e.animations),a=this.parseShapes(e.shapes),c=this.parseGeometries(e.geometries,a),u=this.parseImages(e.images,function(){n!==void 0&&n(v)}),A=this.parseTextures(e.textures,u),m=this.parseMaterials(e.materials,A),v=this.parseObject(e.object,c,m,A,s),E=this.parseSkeletons(e.skeletons,v);if(this.bindSkeletons(v,E),this.bindLightTargets(v),n!==void 0){let C=!1;for(const M in u)if(u[M].data instanceof HTMLImageElement){C=!0;break}C===!1&&n(v)}return v}async parseAsync(e){const n=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,s),c=await this.parseImagesAsync(e.images),u=this.parseTextures(e.textures,c),A=this.parseMaterials(e.materials,u),m=this.parseObject(e.object,a,A,u,n),v=this.parseSkeletons(e.skeletons,m);return this.bindSkeletons(m,v),this.bindLightTargets(m),m}parseShapes(e){const n={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const c=new mh().fromJSON(e[s]);n[c.uuid]=c}return n}parseSkeletons(e,n){const s={},a={};if(n.traverse(function(c){c.isBone&&(a[c.uuid]=c)}),e!==void 0)for(let c=0,u=e.length;c<u;c++){const A=new wf().fromJSON(e[c],a);s[A.uuid]=A}return s}parseGeometries(e,n){const s={};if(e!==void 0){const a=new pI;for(let c=0,u=e.length;c<u;c++){let A;const m=e[c];switch(m.type){case"BufferGeometry":case"InstancedBufferGeometry":A=a.parse(m);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?A=new THREE.LegacyJSONLoader().parse(m,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:m.type in JS?A=JS[m.type].fromJSON(m,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${m.type}"`)}A.uuid=m.uuid,m.name!==void 0&&(A.name=m.name),m.userData!==void 0&&(A.userData=m.userData),s[m.uuid]=A}}return s}parseMaterials(e,n){const s={},a={};if(e!==void 0){const c=new j0;c.setTextures(n);for(let u=0,A=e.length;u<A;u++){const m=e[u];s[m.uuid]===void 0&&(s[m.uuid]=c.parse(m)),a[m.uuid]=s[m.uuid]}}return a}parseAnimations(e){const n={};if(e!==void 0)for(let s=0;s<e.length;s++){const a=e[s],c=_p.parse(a);n[c.uuid]=c}return n}parseImages(e,n){const s=this,a={};let c;function u(A){if(typeof A=="string"){const m=A;return function(v){return s.manager.itemStart(v),c.load(v,function(){s.manager.itemEnd(v)},void 0,function(){s.manager.itemError(v),s.manager.itemEnd(v)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(m)?m:s.resourcePath+m)}return A.data?{data:Al(A.type,A.data),width:A.width,height:A.height}:null}if(e!==void 0&&e.length>0){const A=new f_(n);c=new Fu(A),c.setCrossOrigin(this.crossOrigin);for(let m=0,v=e.length;m<v;m++){const E=e[m],C=E.url;if(Array.isArray(C)){const M=[];for(let S=0,B=C.length;S<B;S++){const N=u(C[S]);N!==null&&(N instanceof HTMLImageElement?M.push(N):M.push(new Fo(N.data,N.width,N.height)))}a[E.uuid]=new ka(M)}else{const M=u(E.url);a[E.uuid]=new ka(M)}}}return a}async parseImagesAsync(e){const n=this,s={};let a;async function c(u){if(typeof u=="string"){const A=u,m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(A)?A:n.resourcePath+A;return await a.loadAsync(m)}return u.data?{data:Al(u.type,u.data),width:u.width,height:u.height}:null}if(e!==void 0&&e.length>0){a=new Fu(this.manager),a.setCrossOrigin(this.crossOrigin);for(let u=0,A=e.length;u<A;u++){const m=e[u],v=m.url;if(Array.isArray(v)){const E=[];for(let C=0,M=v.length;C<M;C++){const S=v[C],B=await c(S);B!==null&&(B instanceof HTMLImageElement?E.push(B):E.push(new Fo(B.data,B.width,B.height)))}s[m.uuid]=new ka(E)}else{const E=await c(m.url);s[m.uuid]=new ka(E)}}}return s}parseTextures(e,n){function s(c,u){return typeof c=="number"?c:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",c),u[c])}const a={};if(e!==void 0)for(let c=0,u=e.length;c<u;c++){const A=e[c];A.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',A.uuid),n[A.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",A.image);const m=n[A.image],v=m.data;let E;Array.isArray(v)?(E=new hp,v.length===6&&(E.needsUpdate=!0)):(E=v&&v.data?new Fo:new Pi,v&&(E.needsUpdate=!0)),E.source=m,E.uuid=A.uuid,A.name!==void 0&&(E.name=A.name),A.mapping!==void 0&&(E.mapping=s(A.mapping,xF)),A.channel!==void 0&&(E.channel=A.channel),A.offset!==void 0&&E.offset.fromArray(A.offset),A.repeat!==void 0&&E.repeat.fromArray(A.repeat),A.center!==void 0&&E.center.fromArray(A.center),A.rotation!==void 0&&(E.rotation=A.rotation),A.wrap!==void 0&&(E.wrapS=s(A.wrap[0],AI),E.wrapT=s(A.wrap[1],AI)),A.format!==void 0&&(E.format=A.format),A.internalFormat!==void 0&&(E.internalFormat=A.internalFormat),A.type!==void 0&&(E.type=A.type),A.colorSpace!==void 0&&(E.colorSpace=A.colorSpace),A.minFilter!==void 0&&(E.minFilter=s(A.minFilter,fI)),A.magFilter!==void 0&&(E.magFilter=s(A.magFilter,fI)),A.anisotropy!==void 0&&(E.anisotropy=A.anisotropy),A.flipY!==void 0&&(E.flipY=A.flipY),A.generateMipmaps!==void 0&&(E.generateMipmaps=A.generateMipmaps),A.premultiplyAlpha!==void 0&&(E.premultiplyAlpha=A.premultiplyAlpha),A.unpackAlignment!==void 0&&(E.unpackAlignment=A.unpackAlignment),A.compareFunction!==void 0&&(E.compareFunction=A.compareFunction),A.userData!==void 0&&(E.userData=A.userData),a[A.uuid]=E}return a}parseObject(e,n,s,a,c){let u,A,m;function v(M){return n[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",M),n[M]}function E(M){if(M!==void 0){if(Array.isArray(M)){const S=[];for(let B=0,N=M.length;B<N;B++){const L=M[B];s[L]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",L),S.push(s[L])}return S}return s[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",M),s[M]}}function C(M){return a[M]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",M),a[M]}switch(e.type){case"Scene":u=new u0,e.background!==void 0&&(Number.isInteger(e.background)?u.background=new Mt(e.background):u.background=C(e.background)),e.environment!==void 0&&(u.environment=C(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?u.fog=new xf(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(u.fog=new Ef(e.fog.color,e.fog.density)),e.fog.name!==""&&(u.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(u.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(u.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&u.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(u.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&u.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":u=new Hr(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(u.focus=e.focus),e.zoom!==void 0&&(u.zoom=e.zoom),e.filmGauge!==void 0&&(u.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(u.filmOffset=e.filmOffset),e.view!==void 0&&(u.view=Object.assign({},e.view));break;case"OrthographicCamera":u=new mc(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(u.zoom=e.zoom),e.view!==void 0&&(u.view=Object.assign({},e.view));break;case"AmbientLight":u=new x_(e.color,e.intensity);break;case"DirectionalLight":u=new W0(e.color,e.intensity),u.target=e.target||"";break;case"PointLight":u=new V0(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":u=new uI(e.color,e.intensity,e.width,e.height);break;case"SpotLight":u=new z0(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),u.target=e.target||"";break;case"HemisphereLight":u=new g_(e.color,e.groundColor,e.intensity);break;case"LightProbe":u=new Ou().fromJSON(e);break;case"SkinnedMesh":A=v(e.geometry),m=E(e.material),u=new Fx(A,m),e.bindMode!==void 0&&(u.bindMode=e.bindMode),e.bindMatrix!==void 0&&u.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(u.skeleton=e.skeleton);break;case"Mesh":A=v(e.geometry),m=E(e.material),u=new Ti(A,m);break;case"InstancedMesh":A=v(e.geometry),m=E(e.material);const M=e.count,S=e.instanceMatrix,B=e.instanceColor;u=new Ox(A,m,M),u.instanceMatrix=new pc(new Float32Array(S.array),16),B!==void 0&&(u.instanceColor=new pc(new Float32Array(B.array),B.itemSize));break;case"BatchedMesh":A=v(e.geometry),m=E(e.material),u=new SS(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,m),u.geometry=A,u.perObjectFrustumCulled=e.perObjectFrustumCulled,u.sortObjects=e.sortObjects,u._drawRanges=e.drawRanges,u._reservedRanges=e.reservedRanges,u._visibility=e.visibility,u._active=e.active,u._bounds=e.bounds.map(N=>{const L=new te;L.min.fromArray(N.boxMin),L.max.fromArray(N.boxMax);const F=new on;return F.radius=N.sphereRadius,F.center.fromArray(N.sphereCenter),{boxInitialized:N.boxInitialized,box:L,sphereInitialized:N.sphereInitialized,sphere:F}}),u._maxInstanceCount=e.maxInstanceCount,u._maxVertexCount=e.maxVertexCount,u._maxIndexCount=e.maxIndexCount,u._geometryInitialized=e.geometryInitialized,u._geometryCount=e.geometryCount,u._matricesTexture=C(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(u._colorsTexture=C(e.colorsTexture.uuid));break;case"LOD":u=new gS;break;case"Line":u=new yl(v(e.geometry),E(e.material));break;case"LineLoop":u=new Vx(v(e.geometry),E(e.material));break;case"LineSegments":u=new Ha(v(e.geometry),E(e.material));break;case"PointCloud":case"Points":u=new gp(v(e.geometry),E(e.material));break;case"Sprite":u=new fS(E(e.material));break;case"Group":u=new wa;break;case"Bone":u=new g0;break;default:u=new kn}if(u.uuid=e.uuid,e.name!==void 0&&(u.name=e.name),e.matrix!==void 0?(u.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(u.matrixAutoUpdate=e.matrixAutoUpdate),u.matrixAutoUpdate&&u.matrix.decompose(u.position,u.quaternion,u.scale)):(e.position!==void 0&&u.position.fromArray(e.position),e.rotation!==void 0&&u.rotation.fromArray(e.rotation),e.quaternion!==void 0&&u.quaternion.fromArray(e.quaternion),e.scale!==void 0&&u.scale.fromArray(e.scale)),e.up!==void 0&&u.up.fromArray(e.up),e.castShadow!==void 0&&(u.castShadow=e.castShadow),e.receiveShadow!==void 0&&(u.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(u.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(u.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(u.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(u.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&u.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(u.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(u.visible=e.visible),e.frustumCulled!==void 0&&(u.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(u.renderOrder=e.renderOrder),e.userData!==void 0&&(u.userData=e.userData),e.layers!==void 0&&(u.layers.mask=e.layers),e.children!==void 0){const M=e.children;for(let S=0;S<M.length;S++)u.add(this.parseObject(M[S],n,s,a,c))}if(e.animations!==void 0){const M=e.animations;for(let S=0;S<M.length;S++){const B=M[S];u.animations.push(c[B])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(u.autoUpdate=e.autoUpdate);const M=e.levels;for(let S=0;S<M.length;S++){const B=M[S],N=u.getObjectByProperty("uuid",B.object);N!==void 0&&u.addLevel(N,B.distance,B.hysteresis)}}return u}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(s){if(s.isSkinnedMesh===!0&&s.skeleton!==void 0){const a=n[s.skeleton];a===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",s.skeleton):s.bind(a,s.bindMatrix)}})}bindLightTargets(e){e.traverse(function(n){if(n.isDirectionalLight||n.isSpotLight){const s=n.target,a=e.getObjectByProperty("uuid",s);n.target=a!==void 0?a:new kn}})}}const xF={UVMapping:Jc,CubeReflectionMapping:js,CubeRefractionMapping:Pa,EquirectangularReflectionMapping:$c,EquirectangularRefractionMapping:wo,CubeUVReflectionMapping:Zc},AI={RepeatWrapping:ga,ClampToEdgeWrapping:Dr,MirroredRepeatWrapping:ll},fI={NearestFilter:yr,NearestMipmapNearestFilter:$h,NearestMipmapLinearFilter:Mo,LinearFilter:bi,LinearMipmapNearestFilter:Ua,LinearMipmapLinearFilter:hs};class mI extends $r{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,s,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=this,u=co.get(e);if(u!==void 0)return c.manager.itemStart(e),u.then?void u.then(v=>{n&&n(v),c.manager.itemEnd(e)}).catch(v=>{a&&a(v)}):(setTimeout(function(){n&&n(u),c.manager.itemEnd(e)},0),u);const A={};A.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",A.headers=this.requestHeader;const m=fetch(e,A).then(function(v){return v.blob()}).then(function(v){return createImageBitmap(v,Object.assign(c.options,{colorSpaceConversion:"none"}))}).then(function(v){return co.add(e,v),n&&n(v),c.manager.itemEnd(e),v}).catch(function(v){a&&a(v),co.remove(e),c.manager.itemError(e),c.manager.itemEnd(e)});co.add(e,m),c.manager.itemStart(e)}}let q0;class __{static getContext(){return q0===void 0&&(q0=new(window.AudioContext||window.webkitAudioContext)),q0}static setContext(e){q0=e}}class gI extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=new Zr(this.manager);function A(m){a?a(m):console.error(m),c.manager.itemError(e)}u.setResponseType("arraybuffer"),u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(m){try{const v=m.slice(0);__.getContext().decodeAudioData(v,function(E){n(E)}).catch(A)}catch(v){A(v)}},s,a)}}const vI=new Qt,yI=new Qt,ku=new Qt;class _F{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Hr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Hr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,ku.copy(e.projectionMatrix);const s=n.eyeSep/2,a=s*n.near/n.focus,c=n.near*Math.tan(ac*n.fov*.5)/n.zoom;let u,A;yI.elements[12]=-s,vI.elements[12]=s,u=-c*n.aspect+a,A=c*n.aspect+a,ku.elements[0]=2*n.near/(A-u),ku.elements[8]=(A+u)/(A-u),this.cameraL.projectionMatrix.copy(ku),u=-c*n.aspect-a,A=c*n.aspect-a,ku.elements[0]=2*n.near/(A-u),ku.elements[8]=(A+u)/(A-u),this.cameraR.projectionMatrix.copy(ku)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(yI),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(vI)}}class EI extends Hr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class X0{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=xI(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=xI();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function xI(){return performance.now()}const Qu=new R,_I=new ai,bF=new R,Gu=new R;class bI extends kn{constructor(){super(),this.type="AudioListener",this.context=__.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new X0}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener,s=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Qu,_I,bF),Gu.set(0,0,-1).applyQuaternion(_I),n.positionX){const a=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Qu.x,a),n.positionY.linearRampToValueAtTime(Qu.y,a),n.positionZ.linearRampToValueAtTime(Qu.z,a),n.forwardX.linearRampToValueAtTime(Gu.x,a),n.forwardY.linearRampToValueAtTime(Gu.y,a),n.forwardZ.linearRampToValueAtTime(Gu.z,a),n.upX.linearRampToValueAtTime(s.x,a),n.upY.linearRampToValueAtTime(s.y,a),n.upZ.linearRampToValueAtTime(s.z,a)}else n.setPosition(Qu.x,Qu.y,Qu.z),n.setOrientation(Gu.x,Gu.y,Gu.z,s.x,s.y,s.z)}}class b_ extends kn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(e=0){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,n){return super.copy(e,n),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Hu=new R,CI=new ai,CF=new R,zu=new R;class wI extends b_{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,s){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=s,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Hu,CI,CF),zu.set(0,0,1).applyQuaternion(CI);const n=this.panner;if(n.positionX){const s=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Hu.x,s),n.positionY.linearRampToValueAtTime(Hu.y,s),n.positionZ.linearRampToValueAtTime(Hu.z,s),n.orientationX.linearRampToValueAtTime(zu.x,s),n.orientationY.linearRampToValueAtTime(zu.y,s),n.orientationZ.linearRampToValueAtTime(zu.z,s)}else n.setPosition(Hu.x,Hu.y,Hu.z),n.setOrientation(zu.x,zu.y,zu.z)}}class wF{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let s=0;s<n.length;s++)e+=n[s];return e/n.length}}class MI{constructor(e,n,s){let a,c,u;switch(this.binding=e,this.valueSize=s,n){case"quaternion":a=this._slerp,c=this._slerpAdditive,u=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*s),this._workIndex=5;break;case"string":case"bool":a=this._select,c=this._select,u=this._setAdditiveIdentityOther,this.buffer=new Array(5*s);break;default:a=this._lerp,c=this._lerpAdditive,u=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*s)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=c,this._setIdentity=u,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const s=this.buffer,a=this.valueSize,c=e*a+a;let u=this.cumulativeWeight;if(u===0){for(let A=0;A!==a;++A)s[c+A]=s[A];u=n}else{u+=n;const A=n/u;this._mixBufferRegion(s,c,0,A,a)}this.cumulativeWeight=u}accumulateAdditive(e){const n=this.buffer,s=this.valueSize,a=s*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,a,0,e,s),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,s=this.buffer,a=e*n+n,c=this.cumulativeWeight,u=this.cumulativeWeightAdditive,A=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,c<1){const m=n*this._origIndex;this._mixBufferRegion(s,a,m,1-c,n)}u>0&&this._mixBufferRegionAdditive(s,a,this._addIndex*n,1,n);for(let m=n,v=n+n;m!==v;++m)if(s[m]!==s[m+n]){A.setValue(s,a);break}}saveOriginalState(){const e=this.binding,n=this.buffer,s=this.valueSize,a=s*this._origIndex;e.getValue(n,a);for(let c=s,u=a;c!==u;++c)n[c]=n[a+c%s];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let s=e;s<n;s++)this.buffer[s]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let s=0;s<this.valueSize;s++)this.buffer[n+s]=this.buffer[e+s]}_select(e,n,s,a,c){if(a>=.5)for(let u=0;u!==c;++u)e[n+u]=e[s+u]}_slerp(e,n,s,a){ai.slerpFlat(e,n,e,n,e,s,a)}_slerpAdditive(e,n,s,a,c){const u=this._workIndex*c;ai.multiplyQuaternionsFlat(e,u,e,n,e,s),ai.slerpFlat(e,n,e,n,e,u,a)}_lerp(e,n,s,a,c){const u=1-a;for(let A=0;A!==c;++A){const m=n+A;e[m]=e[m]*u+e[s+A]*a}}_lerpAdditive(e,n,s,a,c){for(let u=0;u!==c;++u){const A=n+u;e[A]=e[A]+e[s+u]*a}}}const C_="\\[\\]\\.:\\/",MF=new RegExp("["+C_+"]","g"),w_="[^"+C_+"]",SF="[^"+C_.replace("\\.","")+"]",IF=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",w_)+/(WCOD+)?/.source.replace("WCOD",SF)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",w_)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",w_)+"$"),TF=["material","materials","bones","map"];class vi{constructor(e,n,s){this.path=n,this.parsedPath=s||vi.parseTrackName(n),this.node=vi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,s){return e&&e.isAnimationObjectGroup?new vi.Composite(e,n,s):new vi(e,n,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(MF,"")}static parseTrackName(e){const n=IF.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},a=s.nodeName&&s.nodeName.lastIndexOf(".");if(a!==void 0&&a!==-1){const c=s.nodeName.substring(a+1);TF.indexOf(c)!==-1&&(s.nodeName=s.nodeName.substring(0,a),s.objectName=c)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(n);if(s!==void 0)return s}if(e.children){const s=function(c){for(let u=0;u<c.length;u++){const A=c[u];if(A.name===n||A.uuid===n)return A;const m=s(A.children);if(m)return m}return null},a=s(e.children);if(a)return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const s=this.resolvedProperty;for(let a=0,c=s.length;a!==c;++a)e[n++]=s[a]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const s=this.resolvedProperty;for(let a=0,c=s.length;a!==c;++a)s[a]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const s=this.resolvedProperty;for(let a=0,c=s.length;a!==c;++a)s[a]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const s=this.resolvedProperty;for(let a=0,c=s.length;a!==c;++a)s[a]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,s=n.objectName,a=n.propertyName;let c=n.propertyIndex;if(e||(e=vi.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(s){let v=n.objectIndex;switch(s){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let E=0;E<e.length;E++)if(e[E].name===v){v=E;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(e[s]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[s]}if(v!==void 0){if(e[v]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[v]}}const u=e[a];if(u===void 0){const v=n.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+v+"."+a+" but it wasn't found.",e)}let A=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?A=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(A=this.Versioning.MatrixWorldNeedsUpdate);let m=this.BindingType.Direct;if(c!==void 0){if(a==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[c]!==void 0&&(c=e.morphTargetDictionary[c])}m=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=c}else u.fromArray!==void 0&&u.toArray!==void 0?(m=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(m=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=a;this.getValue=this.GetterByBindingType[m],this.setValue=this.SetterByBindingTypeAndVersioning[m][A]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}vi.Composite=class{constructor(r,e,n){const s=n||vi.parseTrackName(e);this._targetGroup=r,this._bindings=r.subscribe_(e,s)}getValue(r,e){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(r,e)}setValue(r,e){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,a=n.length;s!==a;++s)n[s].setValue(r,e)}bind(){const r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=r.length;e!==n;++e)r[e].bind()}unbind(){const r=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=r.length;e!==n;++e)r[e].unbind()}},vi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},vi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},vi.prototype.GetterByBindingType=[vi.prototype._getValue_direct,vi.prototype._getValue_array,vi.prototype._getValue_arrayElement,vi.prototype._getValue_toArray],vi.prototype.SetterByBindingTypeAndVersioning=[[vi.prototype._setValue_direct,vi.prototype._setValue_direct_setNeedsUpdate,vi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[vi.prototype._setValue_array,vi.prototype._setValue_array_setNeedsUpdate,vi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[vi.prototype._setValue_arrayElement,vi.prototype._setValue_arrayElement_setNeedsUpdate,vi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[vi.prototype._setValue_fromArray,vi.prototype._setValue_fromArray_setNeedsUpdate,vi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class BF{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Pr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let s=0,a=arguments.length;s!==a;++s)e[arguments[s].uuid]=s;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,s=this._paths,a=this._parsedPaths,c=this._bindings,u=c.length;let A,m=e.length,v=this.nCachedObjects_;for(let E=0,C=arguments.length;E!==C;++E){const M=arguments[E],S=M.uuid;let B=n[S];if(B===void 0){B=m++,n[S]=B,e.push(M);for(let N=0,L=u;N!==L;++N)c[N].push(new vi(M,s[N],a[N]))}else if(B<v){A=e[B];const N=--v,L=e[N];n[L.uuid]=B,e[B]=L,n[S]=N,e[N]=M;for(let F=0,O=u;F!==O;++F){const H=c[F],X=H[N];let $=H[B];H[B]=X,$===void 0&&($=new vi(M,s[F],a[F])),H[N]=$}}else e[B]!==A&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=v}remove(){const e=this._objects,n=this._indicesByUUID,s=this._bindings,a=s.length;let c=this.nCachedObjects_;for(let u=0,A=arguments.length;u!==A;++u){const m=arguments[u],v=m.uuid,E=n[v];if(E!==void 0&&E>=c){const C=c++,M=e[C];n[M.uuid]=E,e[E]=M,n[v]=C,e[C]=m;for(let S=0,B=a;S!==B;++S){const N=s[S],L=N[C],F=N[E];N[E]=L,N[C]=F}}}this.nCachedObjects_=c}uncache(){const e=this._objects,n=this._indicesByUUID,s=this._bindings,a=s.length;let c=this.nCachedObjects_,u=e.length;for(let A=0,m=arguments.length;A!==m;++A){const v=arguments[A].uuid,E=n[v];if(E!==void 0)if(delete n[v],E<c){const C=--c,M=e[C],S=--u,B=e[S];n[M.uuid]=E,e[E]=M,n[B.uuid]=C,e[C]=B,e.pop();for(let N=0,L=a;N!==L;++N){const F=s[N],O=F[C],H=F[S];F[E]=O,F[C]=H,F.pop()}}else{const C=--u,M=e[C];C>0&&(n[M.uuid]=E),e[E]=M,e.pop();for(let S=0,B=a;S!==B;++S){const N=s[S];N[E]=N[C],N.pop()}}}this.nCachedObjects_=c}subscribe_(e,n){const s=this._bindingsIndicesByPath;let a=s[e];const c=this._bindings;if(a!==void 0)return c[a];const u=this._paths,A=this._parsedPaths,m=this._objects,v=m.length,E=this.nCachedObjects_,C=new Array(v);a=c.length,s[e]=a,u.push(e),A.push(n),c.push(C);for(let M=E,S=m.length;M!==S;++M){const B=m[M];C[M]=new vi(B,e,n)}return C}unsubscribe_(e){const n=this._bindingsIndicesByPath,s=n[e];if(s!==void 0){const a=this._paths,c=this._parsedPaths,u=this._bindings,A=u.length-1,m=u[A];n[e[A]]=s,u[s]=m,u.pop(),c[s]=c[A],c.pop(),a[s]=a[A],a.pop()}}}class SI{constructor(e,n,s=null,a=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=s,this.blendMode=a;const c=n.tracks,u=c.length,A=new Array(u),m={endingStart:ec,endingEnd:ec};for(let v=0;v!==u;++v){const E=c[v].createInterpolant(null);A[v]=E,E.settings=m}this._interpolantSettings=m,this._interpolants=A,this._propertyBindings=new Array(u),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Rg,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,s){if(e.fadeOut(n),this.fadeIn(n),s){const a=this._clip.duration,c=e._clip.duration,u=c/a,A=a/c;e.warp(1,u,n),this.warp(A,1,n)}return this}crossFadeTo(e,n,s){return e.crossFadeFrom(this,n,s)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,s){const a=this._mixer,c=a.time,u=this.timeScale;let A=this._timeScaleInterpolant;A===null&&(A=a._lendControlInterpolant(),this._timeScaleInterpolant=A);const m=A.parameterPositions,v=A.sampleValues;return m[0]=c,m[1]=c+s,v[0]=e/u,v[1]=n/u,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,s,a){if(!this.enabled)return void this._updateWeight(e);const c=this._startTime;if(c!==null){const m=(e-c)*s;m<0||s===0?n=0:(this._startTime=null,n=s*m)}n*=this._updateTimeScale(e);const u=this._updateTime(n),A=this._updateWeight(e);if(A>0){const m=this._interpolants,v=this._propertyBindings;if(this.blendMode===tf)for(let E=0,C=m.length;E!==C;++E)m[E].evaluate(u),v[E].accumulateAdditive(A);else for(let E=0,C=m.length;E!==C;++E)m[E].evaluate(u),v[E].accumulate(a,A)}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const s=this._weightInterpolant;if(s!==null){const a=s.evaluate(e)[0];n*=a,e>s.parameterPositions[1]&&(this.stopFading(),a===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const s=this._timeScaleInterpolant;s!==null&&(n*=s.evaluate(e)[0],e>s.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n))}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,s=this.loop;let a=this.time+e,c=this._loopCount;const u=s===Lg;if(e===0)return c===-1||!u||1&~c?a:n-a;if(s===Ps){c===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=n)a=n;else{if(!(a<0)){this.time=a;break e}a=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(c===-1&&(e>=0?(c=0,this._setEndings(!0,this.repetitions===0,u)):this._setEndings(this.repetitions===0,!0,u)),a>=n||a<0){const A=Math.floor(a/n);a-=n*A,c+=Math.abs(A);const m=this.repetitions-c;if(m<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a=e>0?n:0,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(m===1){const v=e<0;this._setEndings(v,!v,u)}else this._setEndings(!1,!1,u);this._loopCount=c,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:A})}}else this.time=a;if(u&&!(1&~c))return n-a}return a}_setEndings(e,n,s){const a=this._interpolantSettings;s?(a.endingStart=tc,a.endingEnd=tc):(a.endingStart=e?this.zeroSlopeAtStart?tc:ec:vu,a.endingEnd=n?this.zeroSlopeAtEnd?tc:ec:vu)}_scheduleFading(e,n,s){const a=this._mixer,c=a.time;let u=this._weightInterpolant;u===null&&(u=a._lendControlInterpolant(),this._weightInterpolant=u);const A=u.parameterPositions,m=u.sampleValues;return A[0]=c,m[0]=n,A[1]=c+e,m[1]=s,this}}const RF=new Float32Array(1);class II extends Oa{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const s=e._localRoot||this._root,a=e._clip.tracks,c=a.length,u=e._propertyBindings,A=e._interpolants,m=s.uuid,v=this._bindingsByRootAndName;let E=v[m];E===void 0&&(E={},v[m]=E);for(let C=0;C!==c;++C){const M=a[C],S=M.name;let B=E[S];if(B!==void 0)++B.referenceCount,u[C]=B;else{if(B=u[C],B!==void 0){B._cacheIndex===null&&(++B.referenceCount,this._addInactiveBinding(B,m,S));continue}const N=n&&n._propertyBindings[C].binding.parsedPath;B=new MI(vi.create(s,S,N),M.ValueTypeName,M.getValueSize()),++B.referenceCount,this._addInactiveBinding(B,m,S),u[C]=B}A[C].resultBuffer=B.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const s=(e._localRoot||this._root).uuid,a=e._clip.uuid,c=this._actionsByClip[a];this._bindAction(e,c&&c.knownActions[0]),this._addInactiveAction(e,a,s)}const n=e._propertyBindings;for(let s=0,a=n.length;s!==a;++s){const c=n[s];c.useCount++==0&&(this._lendBinding(c),c.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let s=0,a=n.length;s!==a;++s){const c=n[s];--c.useCount==0&&(c.restoreOriginalState(),this._takeBackBinding(c))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,s){const a=this._actions,c=this._actionsByClip;let u=c[n];if(u===void 0)u={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,c[n]=u;else{const A=u.knownActions;e._byClipCacheIndex=A.length,A.push(e)}e._cacheIndex=a.length,a.push(e),u.actionByRoot[s]=e}_removeInactiveAction(e){const n=this._actions,s=n[n.length-1],a=e._cacheIndex;s._cacheIndex=a,n[a]=s,n.pop(),e._cacheIndex=null;const c=e._clip.uuid,u=this._actionsByClip,A=u[c],m=A.knownActions,v=m[m.length-1],E=e._byClipCacheIndex;v._byClipCacheIndex=E,m[E]=v,m.pop(),e._byClipCacheIndex=null,delete A.actionByRoot[(e._localRoot||this._root).uuid],m.length===0&&delete u[c],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let s=0,a=n.length;s!==a;++s){const c=n[s];--c.referenceCount==0&&this._removeInactiveBinding(c)}}_lendAction(e){const n=this._actions,s=e._cacheIndex,a=this._nActiveActions++,c=n[a];e._cacheIndex=a,n[a]=e,c._cacheIndex=s,n[s]=c}_takeBackAction(e){const n=this._actions,s=e._cacheIndex,a=--this._nActiveActions,c=n[a];e._cacheIndex=a,n[a]=e,c._cacheIndex=s,n[s]=c}_addInactiveBinding(e,n,s){const a=this._bindingsByRootAndName,c=this._bindings;let u=a[n];u===void 0&&(u={},a[n]=u),u[s]=e,e._cacheIndex=c.length,c.push(e)}_removeInactiveBinding(e){const n=this._bindings,s=e.binding,a=s.rootNode.uuid,c=s.path,u=this._bindingsByRootAndName,A=u[a],m=n[n.length-1],v=e._cacheIndex;m._cacheIndex=v,n[v]=m,n.pop(),delete A[c],Object.keys(A).length===0&&delete u[a]}_lendBinding(e){const n=this._bindings,s=e._cacheIndex,a=this._nActiveBindings++,c=n[a];e._cacheIndex=a,n[a]=e,c._cacheIndex=s,n[s]=c}_takeBackBinding(e){const n=this._bindings,s=e._cacheIndex,a=--this._nActiveBindings,c=n[a];e._cacheIndex=a,n[a]=e,c._cacheIndex=s,n[s]=c}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let s=e[n];return s===void 0&&(s=new p_(new Float32Array(2),new Float32Array(2),1,RF),s.__cacheIndex=n,e[n]=s),s}_takeBackControlInterpolant(e){const n=this._controlInterpolants,s=e.__cacheIndex,a=--this._nActiveControlInterpolants,c=n[a];e.__cacheIndex=a,n[a]=e,c.__cacheIndex=s,n[s]=c}clipAction(e,n,s){const a=n||this._root,c=a.uuid;let u=typeof e=="string"?_p.findByName(a,e):e;const A=u!==null?u.uuid:e,m=this._actionsByClip[A];let v=null;if(s===void 0&&(s=u!==null?u.blendMode:ef),m!==void 0){const C=m.actionByRoot[c];if(C!==void 0&&C.blendMode===s)return C;v=m.knownActions[0],u===null&&(u=v._clip)}if(u===null)return null;const E=new SI(this,u,n,s);return this._bindAction(E,v),this._addInactiveAction(E,A,c),E}existingAction(e,n){const s=n||this._root,a=s.uuid,c=typeof e=="string"?_p.findByName(s,e):e,u=c?c.uuid:e,A=this._actionsByClip[u];return A!==void 0&&A.actionByRoot[a]||null}stopAllAction(){const e=this._actions;for(let n=this._nActiveActions-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const n=this._actions,s=this._nActiveActions,a=this.time+=e,c=Math.sign(e),u=this._accuIndex^=1;for(let v=0;v!==s;++v)n[v]._update(a,e,c,u);const A=this._bindings,m=this._nActiveBindings;for(let v=0;v!==m;++v)A[v].apply(u);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,s=e.uuid,a=this._actionsByClip,c=a[s];if(c!==void 0){const u=c.knownActions;for(let A=0,m=u.length;A!==m;++A){const v=u[A];this._deactivateAction(v);const E=v._cacheIndex,C=n[n.length-1];v._cacheIndex=null,v._byClipCacheIndex=null,C._cacheIndex=E,n[E]=C,n.pop(),this._removeInactiveBindingsForAction(v)}delete a[s]}}uncacheRoot(e){const n=e.uuid,s=this._actionsByClip;for(const c in s){const u=s[c].actionByRoot[n];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}const a=this._bindingsByRootAndName[n];if(a!==void 0)for(const c in a){const u=a[c];u.restoreOriginalState(),this._removeInactiveBinding(u)}}uncacheAction(e,n){const s=this.existingAction(e,n);s!==null&&(this._deactivateAction(s),this._removeInactiveAction(s))}}class LF extends tp{constructor(e=1,n=1,s=1,a={}){super(e,n,a),this.isRenderTarget3D=!0,this.depth=s,this.texture=new bu(null,e,n,s),this.texture.isRenderTargetTexture=!0}}class DF extends tp{constructor(e=1,n=1,s=1,a={}){super(e,n,a),this.isRenderTargetArray=!0,this.depth=s,this.texture=new gl(null,e,n,s),this.texture.isRenderTargetTexture=!0}}class M_{constructor(e){this.value=e}clone(){return new M_(this.value.clone===void 0?this.value:this.value.clone())}}let PF=0;class UF extends Oa{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:PF++}),this.name="",this.usage=rc,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let s=0,a=n.length;s<a;s++){const c=Array.isArray(n[s])?n[s]:[n[s]];for(let u=0;u<c.length;u++)this.uniforms.push(c[u].clone())}return this}clone(){return new this.constructor().copy(this)}}class NF extends up{constructor(e,n,s=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class FF{constructor(e,n,s,a,c){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=s,this.elementSize=a,this.count=c,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const TI=new Qt;class BI{constructor(e,n,s=0,a=1/0){this.ray=new _r(e,n),this.near=s,this.far=a,this.camera=null,this.layers=new oc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return TI.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(TI),this}intersectObject(e,n=!0,s=[]){return S_(e,this,s,n),s.sort(RI),s}intersectObjects(e,n=!0,s=[]){for(let a=0,c=e.length;a<c;a++)S_(e[a],this,s,n);return s.sort(RI),s}}function RI(r,e){return r.distance-e.distance}function S_(r,e,n,s){let a=!0;if(r.layers.test(e.layers)&&r.raycast(e,n)===!1&&(a=!1),a===!0&&s===!0){const c=r.children;for(let u=0,A=c.length;u<A;u++)S_(c[u],e,n,!0)}}class OF{constructor(e=1,n=0,s=0){return this.radius=e,this.phi=n,this.theta=s,this}set(e,n,s){return this.radius=e,this.phi=n,this.theta=s,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Rn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,s){return this.radius=Math.sqrt(e*e+n*n+s*s),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,s),this.phi=Math.acos(Rn(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class kF{constructor(e=1,n=0,s=0){return this.radius=e,this.theta=n,this.y=s,this}set(e,n,s){return this.radius=e,this.theta=n,this.y=s,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,s){return this.radius=Math.sqrt(e*e+s*s),this.theta=Math.atan2(e,s),this.y=n,this}clone(){return new this.constructor().copy(this)}}class I_{constructor(e,n,s,a){I_.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,n,s,a)}identity(){return this.set(1,0,0,1),this}fromArray(e,n=0){for(let s=0;s<4;s++)this.elements[s]=e[s+n];return this}set(e,n,s,a){const c=this.elements;return c[0]=e,c[2]=n,c[1]=s,c[3]=a,this}}const LI=new ct;class QF{constructor(e=new ct(1/0,1/0),n=new ct(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,s=e.length;n<s;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const s=LI.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,LI).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const DI=new R,Y0=new R;class GF{constructor(e=new R,n=new R){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){DI.subVectors(e,this.start),Y0.subVectors(this.end,this.start);const s=Y0.dot(Y0);let a=Y0.dot(DI)/s;return n&&(a=Rn(a,0,1)),a}closestPointToPoint(e,n,s){const a=this.closestPointToPointParameter(e,n);return this.delta(s).multiplyScalar(a).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const PI=new R;class HF extends kn{constructor(e,n){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const s=new vn,a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let u=0,A=1,m=32;u<m;u++,A++){const v=u/m*Math.PI*2,E=A/m*Math.PI*2;a.push(Math.cos(v),Math.sin(v),1,Math.cos(E),Math.sin(E),1)}s.setAttribute("position",new Wt(a,3));const c=new zr({fog:!1,toneMapped:!1});this.cone=new Ha(s,c),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),PI.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(PI),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const yh=new R,K0=new Qt,T_=new Qt;class zF extends Ha{constructor(e){const n=UI(e),s=new vn,a=[],c=[],u=new Mt(0,0,1),A=new Mt(0,1,0);for(let m=0;m<n.length;m++){const v=n[m];v.parent&&v.parent.isBone&&(a.push(0,0,0),a.push(0,0,0),c.push(u.r,u.g,u.b),c.push(A.r,A.g,A.b))}s.setAttribute("position",new Wt(a,3)),s.setAttribute("color",new Wt(c,3)),super(s,new zr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,s=this.geometry,a=s.getAttribute("position");T_.copy(this.root.matrixWorld).invert();for(let c=0,u=0;c<n.length;c++){const A=n[c];A.parent&&A.parent.isBone&&(K0.multiplyMatrices(T_,A.matrixWorld),yh.setFromMatrixPosition(K0),a.setXYZ(u,yh.x,yh.y,yh.z),K0.multiplyMatrices(T_,A.parent.matrixWorld),yh.setFromMatrixPosition(K0),a.setXYZ(u+1,yh.x,yh.y,yh.z),u+=2)}s.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function UI(r){const e=[];r.isBone===!0&&e.push(r);for(let n=0;n<r.children.length;n++)e.push.apply(e,UI(r.children[n]));return e}class VF extends Ti{constructor(e,n,s){super(new Bu(n,4,2),new Jr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=s,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const WF=new R,NI=new Mt,FI=new Mt;class jF extends kn{constructor(e,n,s){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="HemisphereLightHelper";const a=new Ep(n);a.rotateY(.5*Math.PI),this.material=new Jr({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const c=a.getAttribute("position"),u=new Float32Array(3*c.count);a.setAttribute("color",new qn(u,3)),this.add(new Ti(a,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");NI.copy(this.light.color),FI.copy(this.light.groundColor);for(let s=0,a=n.count;s<a;s++){const c=s<a/2?NI:FI;n.setXYZ(s,c.r,c.g,c.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(WF.setFromMatrixPosition(this.light.matrixWorld).negate())}}class qF extends Ha{constructor(e=10,n=10,s=4473924,a=8947848){s=new Mt(s),a=new Mt(a);const c=n/2,u=e/n,A=e/2,m=[],v=[];for(let C=0,M=0,S=-A;C<=n;C++,S+=u){m.push(-A,0,S,A,0,S),m.push(S,0,-A,S,0,A);const B=C===c?s:a;B.toArray(v,M),M+=3,B.toArray(v,M),M+=3,B.toArray(v,M),M+=3,B.toArray(v,M),M+=3}const E=new vn;E.setAttribute("position",new Wt(m,3)),E.setAttribute("color",new Wt(v,3)),super(E,new zr({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class XF extends Ha{constructor(e=10,n=16,s=8,a=64,c=4473924,u=8947848){c=new Mt(c),u=new Mt(u);const A=[],m=[];if(n>1)for(let E=0;E<n;E++){const C=E/n*(2*Math.PI),M=Math.sin(C)*e,S=Math.cos(C)*e;A.push(0,0,0),A.push(M,0,S);const B=1&E?c:u;m.push(B.r,B.g,B.b),m.push(B.r,B.g,B.b)}for(let E=0;E<s;E++){const C=1&E?c:u,M=e-e/s*E;for(let S=0;S<a;S++){let B=S/a*(2*Math.PI),N=Math.sin(B)*M,L=Math.cos(B)*M;A.push(N,0,L),m.push(C.r,C.g,C.b),B=(S+1)/a*(2*Math.PI),N=Math.sin(B)*M,L=Math.cos(B)*M,A.push(N,0,L),m.push(C.r,C.g,C.b)}}const v=new vn;v.setAttribute("position",new Wt(A,3)),v.setAttribute("color",new Wt(m,3)),super(v,new zr({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const OI=new R,J0=new R,kI=new R;class YF extends kn{constructor(e,n,s){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,this.type="DirectionalLightHelper",n===void 0&&(n=1);let a=new vn;a.setAttribute("position",new Wt([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const c=new zr({fog:!1,toneMapped:!1});this.lightPlane=new yl(a,c),this.add(this.lightPlane),a=new vn,a.setAttribute("position",new Wt([0,0,0,0,0,1],3)),this.targetLine=new yl(a,c),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),OI.setFromMatrixPosition(this.light.matrixWorld),J0.setFromMatrixPosition(this.light.target.matrixWorld),kI.subVectors(J0,OI),this.lightPlane.lookAt(J0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(J0),this.targetLine.scale.z=kI.length()}}const $0=new R,Br=new l0;class QI extends Ha{constructor(e){const n=new vn,s=new zr({color:16777215,vertexColors:!0,toneMapped:!1}),a=[],c=[],u={};function A(B,N){m(B),m(N)}function m(B){a.push(0,0,0),c.push(0,0,0),u[B]===void 0&&(u[B]=[]),u[B].push(a.length/3-1)}A("n1","n2"),A("n2","n4"),A("n4","n3"),A("n3","n1"),A("f1","f2"),A("f2","f4"),A("f4","f3"),A("f3","f1"),A("n1","f1"),A("n2","f2"),A("n3","f3"),A("n4","f4"),A("p","n1"),A("p","n2"),A("p","n3"),A("p","n4"),A("u1","u2"),A("u2","u3"),A("u3","u1"),A("c","t"),A("p","c"),A("cn1","cn2"),A("cn3","cn4"),A("cf1","cf2"),A("cf3","cf4"),n.setAttribute("position",new Wt(a,3)),n.setAttribute("color",new Wt(c,3)),super(n,s),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=u,this.update();const v=new Mt(16755200),E=new Mt(16711680),C=new Mt(43775),M=new Mt(16777215),S=new Mt(3355443);this.setColors(v,E,C,M,S)}setColors(e,n,s,a,c){const u=this.geometry.getAttribute("color");u.setXYZ(0,e.r,e.g,e.b),u.setXYZ(1,e.r,e.g,e.b),u.setXYZ(2,e.r,e.g,e.b),u.setXYZ(3,e.r,e.g,e.b),u.setXYZ(4,e.r,e.g,e.b),u.setXYZ(5,e.r,e.g,e.b),u.setXYZ(6,e.r,e.g,e.b),u.setXYZ(7,e.r,e.g,e.b),u.setXYZ(8,e.r,e.g,e.b),u.setXYZ(9,e.r,e.g,e.b),u.setXYZ(10,e.r,e.g,e.b),u.setXYZ(11,e.r,e.g,e.b),u.setXYZ(12,e.r,e.g,e.b),u.setXYZ(13,e.r,e.g,e.b),u.setXYZ(14,e.r,e.g,e.b),u.setXYZ(15,e.r,e.g,e.b),u.setXYZ(16,e.r,e.g,e.b),u.setXYZ(17,e.r,e.g,e.b),u.setXYZ(18,e.r,e.g,e.b),u.setXYZ(19,e.r,e.g,e.b),u.setXYZ(20,e.r,e.g,e.b),u.setXYZ(21,e.r,e.g,e.b),u.setXYZ(22,e.r,e.g,e.b),u.setXYZ(23,e.r,e.g,e.b),u.setXYZ(24,n.r,n.g,n.b),u.setXYZ(25,n.r,n.g,n.b),u.setXYZ(26,n.r,n.g,n.b),u.setXYZ(27,n.r,n.g,n.b),u.setXYZ(28,n.r,n.g,n.b),u.setXYZ(29,n.r,n.g,n.b),u.setXYZ(30,n.r,n.g,n.b),u.setXYZ(31,n.r,n.g,n.b),u.setXYZ(32,s.r,s.g,s.b),u.setXYZ(33,s.r,s.g,s.b),u.setXYZ(34,s.r,s.g,s.b),u.setXYZ(35,s.r,s.g,s.b),u.setXYZ(36,s.r,s.g,s.b),u.setXYZ(37,s.r,s.g,s.b),u.setXYZ(38,a.r,a.g,a.b),u.setXYZ(39,a.r,a.g,a.b),u.setXYZ(40,c.r,c.g,c.b),u.setXYZ(41,c.r,c.g,c.b),u.setXYZ(42,c.r,c.g,c.b),u.setXYZ(43,c.r,c.g,c.b),u.setXYZ(44,c.r,c.g,c.b),u.setXYZ(45,c.r,c.g,c.b),u.setXYZ(46,c.r,c.g,c.b),u.setXYZ(47,c.r,c.g,c.b),u.setXYZ(48,c.r,c.g,c.b),u.setXYZ(49,c.r,c.g,c.b),u.needsUpdate=!0}update(){const e=this.geometry,n=this.pointMap;Br.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===ya?-1:0;Nr("c",n,e,Br,0,0,s),Nr("t",n,e,Br,0,0,1),Nr("n1",n,e,Br,-1,-1,s),Nr("n2",n,e,Br,1,-1,s),Nr("n3",n,e,Br,-1,1,s),Nr("n4",n,e,Br,1,1,s),Nr("f1",n,e,Br,-1,-1,1),Nr("f2",n,e,Br,1,-1,1),Nr("f3",n,e,Br,-1,1,1),Nr("f4",n,e,Br,1,1,1),Nr("u1",n,e,Br,.7,1.1,s),Nr("u2",n,e,Br,-.7,1.1,s),Nr("u3",n,e,Br,0,2,s),Nr("cf1",n,e,Br,-1,0,1),Nr("cf2",n,e,Br,1,0,1),Nr("cf3",n,e,Br,0,-1,1),Nr("cf4",n,e,Br,0,1,1),Nr("cn1",n,e,Br,-1,0,s),Nr("cn2",n,e,Br,1,0,s),Nr("cn3",n,e,Br,0,-1,s),Nr("cn4",n,e,Br,0,1,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Nr(r,e,n,s,a,c,u){$0.set(a,c,u).unproject(s);const A=e[r];if(A!==void 0){const m=n.getAttribute("position");for(let v=0,E=A.length;v<E;v++)m.setXYZ(A[v],$0.x,$0.y,$0.z)}}const Z0=new te;class KF extends Ha{constructor(e,n=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new Float32Array(24),c=new vn;c.setIndex(new qn(s,1)),c.setAttribute("position",new qn(a,3)),super(c,new zr({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Z0.setFromObject(this.object),Z0.isEmpty())return;const n=Z0.min,s=Z0.max,a=this.geometry.attributes.position,c=a.array;c[0]=s.x,c[1]=s.y,c[2]=s.z,c[3]=n.x,c[4]=s.y,c[5]=s.z,c[6]=n.x,c[7]=n.y,c[8]=s.z,c[9]=s.x,c[10]=n.y,c[11]=s.z,c[12]=s.x,c[13]=s.y,c[14]=n.z,c[15]=n.x,c[16]=s.y,c[17]=n.z,c[18]=n.x,c[19]=n.y,c[20]=n.z,c[21]=s.x,c[22]=n.y,c[23]=n.z,a.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class JF extends Ha{constructor(e,n=16776960){const s=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new vn;a.setIndex(new qn(s,1)),a.setAttribute("position",new Wt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(a,new zr({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class $F extends yl{constructor(e,n=1,s=16776960){const a=s,c=new vn;c.setAttribute("position",new Wt([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),c.computeBoundingSphere(),super(c,new zr({color:a,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const u=new vn;u.setAttribute("position",new Wt([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),u.computeBoundingSphere(),this.add(new Ti(u,new Jr({color:a,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const GI=new R;let ev,B_;class ZF extends kn{constructor(e=new R(0,0,1),n=new R(0,0,0),s=1,a=16776960,c=.2*s,u=.2*c){super(),this.type="ArrowHelper",ev===void 0&&(ev=new vn,ev.setAttribute("position",new Wt([0,0,0,0,1,0],3)),B_=new Ah(0,.5,1,5,1),B_.translate(0,-.5,0)),this.position.copy(n),this.line=new yl(ev,new zr({color:a,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ti(B_,new Jr({color:a,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(s,c,u)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{GI.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(GI,n)}}setLength(e,n=.2*e,s=.2*n){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(s,n,s),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class eO extends Ha{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],s=new vn;s.setAttribute("position",new Wt(n,3)),s.setAttribute("color",new Wt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(s,new zr({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,n,s){const a=new Mt,c=this.geometry.attributes.color.array;return a.set(e),a.toArray(c,0),a.toArray(c,3),a.set(n),a.toArray(c,6),a.toArray(c,9),a.set(s),a.toArray(c,12),a.toArray(c,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class tO{constructor(){this.type="ShapePath",this.color=new Mt,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new Df,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,s,a){return this.currentPath.quadraticCurveTo(e,n,s,a),this}bezierCurveTo(e,n,s,a,c,u){return this.currentPath.bezierCurveTo(e,n,s,a,c,u),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(L,F){const O=F.length;let H=!1;for(let X=O-1,$=0;$<O;X=$++){let ee=F[X],ie=F[$],ce=ie.x-ee.x,oe=ie.y-ee.y;if(Math.abs(oe)>Number.EPSILON){if(oe<0&&(ee=F[$],ce=-ce,ie=F[X],oe=-oe),L.y<ee.y||L.y>ie.y)continue;if(L.y===ee.y){if(L.x===ee.x)return!0}else{const Se=oe*(L.x-ee.x)-ce*(L.y-ee.y);if(Se===0)return!0;if(Se<0)continue;H=!H}}else{if(L.y!==ee.y)continue;if(ie.x<=L.x&&L.x<=ee.x||ee.x<=L.x&&L.x<=ie.x)return!0}}return H}const s=El.isClockWise,a=this.subPaths;if(a.length===0)return[];let c,u,A;const m=[];if(a.length===1)return u=a[0],A=new mh,A.curves=u.curves,m.push(A),m;let v=!s(a[0].getPoints());v=e?!v:v;const E=[],C=[];let M,S,B=[],N=0;C[N]=void 0,B[N]=[];for(let L=0,F=a.length;L<F;L++)u=a[L],M=u.getPoints(),c=s(M),c=e?!c:c,c?(!v&&C[N]&&N++,C[N]={s:new mh,p:M},C[N].s.curves=u.curves,v&&N++,B[N]=[]):B[N].push({h:u,p:M[0]});if(!C[0])return function(L){const F=[];for(let O=0,H=L.length;O<H;O++){const X=L[O],$=new mh;$.curves=X.curves,F.push($)}return F}(a);if(C.length>1){let L=!1,F=0;for(let O=0,H=C.length;O<H;O++)E[O]=[];for(let O=0,H=C.length;O<H;O++){const X=B[O];for(let $=0;$<X.length;$++){const ee=X[$];let ie=!0;for(let ce=0;ce<C.length;ce++)n(ee.p,C[ce].p)&&(O!==ce&&F++,ie?(ie=!1,E[ce].push(ee)):L=!0);ie&&E[O].push(ee)}}F>0&&L===!1&&(B=E)}for(let L=0,F=C.length;L<F;L++){A=C[L].s,m.push(A),S=B[L];for(let O=0,H=S.length;O<H;O++)A.holes.push(S[O].h)}return m}}class nO extends Oa{constructor(e,n=null){super(),this.object=e,this.domElement=n,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function R_(r,e,n,s){const a=function(c){switch(c){case Er:case Od:return{byteLength:1,components:1};case cl:case kd:case Cs:return{byteLength:2,components:1};case tu:case Xl:return{byteLength:2,components:4};case So:case eu:case Ir:return{byteLength:4,components:1};case ZA:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${c}.`)}(s);switch(n){case nu:case Io:return r*e;case ru:return r*e*2;case Bo:case su:return r*e/a.components*a.byteLength;case dl:case Qd:return r*e*2/a.components*a.byteLength;case iu:return r*e*3/a.components*a.byteLength;case nr:case au:return r*e*4/a.components*a.byteLength;case ou:case Na:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Fa:case eh:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case Gd:case Hd:return Math.max(r,16)*Math.max(e,8)/4;case pl:case lu:return Math.max(r,8)*Math.max(e,8)/2;case cu:case hu:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case uu:case th:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case zd:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case Ds:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case du:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case Yl:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case pu:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case Vd:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case Wd:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case Au:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case Kl:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case jd:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case qd:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case fu:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case Xd:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case nh:case mu:case ih:return Math.ceil(r/4)*Math.ceil(e/4)*16;case Yd:case Jl:return Math.ceil(r/4)*Math.ceil(e/4)*8;case gu:case rh:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}const iO={contain:function(r,e){const n=r.image&&r.image.width?r.image.width/r.image.height:1;return n>e?(r.repeat.x=1,r.repeat.y=n/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2):(r.repeat.x=e/n,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0),r},cover:function(r,e){const n=r.image&&r.image.width?r.image.width/r.image.height:1;return n>e?(r.repeat.x=e/n,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0):(r.repeat.x=1,r.repeat.y=n/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2),r},fill:function(r){return r.repeat.x=1,r.repeat.y=1,r.offset.x=0,r.offset.y=0,r},getByteLength:R_};function HI(){let r=null,e=!1,n=null,s=null;function a(c,u){n(c,u),s=r.requestAnimationFrame(a)}return{start:function(){e!==!0&&n!==null&&(s=r.requestAnimationFrame(a),e=!0)},stop:function(){r.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(c){n=c},setContext:function(c){r=c}}}function rO(r){const e=new WeakMap;return{get:function(n){return n.isInterleavedBufferAttribute&&(n=n.data),e.get(n)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const s=e.get(n);s&&(r.deleteBuffer(s.buffer),e.delete(n))},update:function(n,s){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const c=e.get(n);return void((!c||c.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const a=e.get(n);if(a===void 0)e.set(n,function(c,u){const A=c.array,m=c.usage,v=A.byteLength,E=r.createBuffer();let C;if(r.bindBuffer(u,E),r.bufferData(u,A,m),c.onUploadCallback(),A instanceof Float32Array)C=r.FLOAT;else if(A instanceof Uint16Array)C=c.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(A instanceof Int16Array)C=r.SHORT;else if(A instanceof Uint32Array)C=r.UNSIGNED_INT;else if(A instanceof Int32Array)C=r.INT;else if(A instanceof Int8Array)C=r.BYTE;else if(A instanceof Uint8Array)C=r.UNSIGNED_BYTE;else{if(!(A instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+A);C=r.UNSIGNED_BYTE}return{buffer:E,type:C,bytesPerElement:A.BYTES_PER_ELEMENT,version:c.version,size:v}}(n,s));else if(a.version<n.version){if(a.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(c,u,A){const m=u.array,v=u.updateRanges;if(r.bindBuffer(A,c),v.length===0)r.bufferSubData(A,0,m);else{v.sort((C,M)=>C.start-M.start);let E=0;for(let C=1;C<v.length;C++){const M=v[E],S=v[C];S.start<=M.start+M.count+1?M.count=Math.max(M.count,S.start+S.count-M.start):(++E,v[E]=S)}v.length=E+1;for(let C=0,M=v.length;C<M;C++){const S=v[C];r.bufferSubData(A,S.start*m.BYTES_PER_ELEMENT,m,S.start,S.count)}u.clearUpdateRanges()}u.onUploadCallback()})(a.buffer,n,s),a.version=n.version}}}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:bo}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=bo);const Xn={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex:`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex:`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex:`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Ft={common:{diffuse:{value:new Mt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new wn},alphaMap:{value:null},alphaMapTransform:{value:new wn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new wn}},envmap:{envMap:{value:null},envMapRotation:{value:new wn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new wn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new wn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new wn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new wn},normalScale:{value:new ct(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new wn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new wn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new wn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new wn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Mt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Mt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new wn},alphaTest:{value:0},uvTransform:{value:new wn}},sprite:{diffuse:{value:new Mt(16777215)},opacity:{value:1},center:{value:new ct(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new wn},alphaMap:{value:null},alphaMapTransform:{value:new wn},alphaTest:{value:0}}},Qo={basic:{uniforms:$s([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.fog]),vertexShader:Xn.meshbasic_vert,fragmentShader:Xn.meshbasic_frag},lambert:{uniforms:$s([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,Ft.lights,{emissive:{value:new Mt(0)}}]),vertexShader:Xn.meshlambert_vert,fragmentShader:Xn.meshlambert_frag},phong:{uniforms:$s([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,Ft.lights,{emissive:{value:new Mt(0)},specular:{value:new Mt(1118481)},shininess:{value:30}}]),vertexShader:Xn.meshphong_vert,fragmentShader:Xn.meshphong_frag},standard:{uniforms:$s([Ft.common,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.roughnessmap,Ft.metalnessmap,Ft.fog,Ft.lights,{emissive:{value:new Mt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Xn.meshphysical_vert,fragmentShader:Xn.meshphysical_frag},toon:{uniforms:$s([Ft.common,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.gradientmap,Ft.fog,Ft.lights,{emissive:{value:new Mt(0)}}]),vertexShader:Xn.meshtoon_vert,fragmentShader:Xn.meshtoon_frag},matcap:{uniforms:$s([Ft.common,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,{matcap:{value:null}}]),vertexShader:Xn.meshmatcap_vert,fragmentShader:Xn.meshmatcap_frag},points:{uniforms:$s([Ft.points,Ft.fog]),vertexShader:Xn.points_vert,fragmentShader:Xn.points_frag},dashed:{uniforms:$s([Ft.common,Ft.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xn.linedashed_vert,fragmentShader:Xn.linedashed_frag},depth:{uniforms:$s([Ft.common,Ft.displacementmap]),vertexShader:Xn.depth_vert,fragmentShader:Xn.depth_frag},normal:{uniforms:$s([Ft.common,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,{opacity:{value:1}}]),vertexShader:Xn.meshnormal_vert,fragmentShader:Xn.meshnormal_frag},sprite:{uniforms:$s([Ft.sprite,Ft.fog]),vertexShader:Xn.sprite_vert,fragmentShader:Xn.sprite_frag},background:{uniforms:{uvTransform:{value:new wn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Xn.background_vert,fragmentShader:Xn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new wn}},vertexShader:Xn.backgroundCube_vert,fragmentShader:Xn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Xn.cube_vert,fragmentShader:Xn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xn.equirect_vert,fragmentShader:Xn.equirect_frag},distanceRGBA:{uniforms:$s([Ft.common,Ft.displacementmap,{referencePosition:{value:new R},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xn.distanceRGBA_vert,fragmentShader:Xn.distanceRGBA_frag},shadow:{uniforms:$s([Ft.lights,Ft.fog,{color:{value:new Mt(0)},opacity:{value:1}}]),vertexShader:Xn.shadow_vert,fragmentShader:Xn.shadow_frag}};Qo.physical={uniforms:$s([Qo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new wn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new wn},clearcoatNormalScale:{value:new ct(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new wn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new wn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new wn},sheen:{value:0},sheenColor:{value:new Mt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new wn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new wn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new wn},transmissionSamplerSize:{value:new ct},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new wn},attenuationDistance:{value:0},attenuationColor:{value:new Mt(0)},specularColor:{value:new Mt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new wn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new wn},anisotropyVector:{value:new ct},anisotropyMap:{value:null},anisotropyMapTransform:{value:new wn}}]),vertexShader:Xn.meshphysical_vert,fragmentShader:Xn.meshphysical_frag};const tv={r:0,b:0,g:0},Vu=new ii,sO=new Qt;function aO(r,e,n,s,a,c,u){const A=new Mt(0);let m,v,E=c===!0?0:1,C=null,M=0,S=null;function B(L){let F=L.isScene===!0?L.background:null;return F&&F.isTexture&&(F=(L.backgroundBlurriness>0?n:e).get(F)),F}function N(L,F){L.getRGB(tv,cS(r)),s.buffers.color.setClear(tv.r,tv.g,tv.b,F,u)}return{getClearColor:function(){return A},setClearColor:function(L,F=1){A.set(L),E=F,N(A,E)},getClearAlpha:function(){return E},setClearAlpha:function(L){E=L,N(A,E)},render:function(L){let F=!1;const O=B(L);O===null?N(A,E):O&&O.isColor&&(N(O,1),F=!0);const H=r.xr.getEnvironmentBlendMode();H==="additive"?s.buffers.color.setClear(0,0,0,1,u):H==="alpha-blend"&&s.buffers.color.setClear(0,0,0,0,u),(r.autoClear||F)&&(s.buffers.depth.setTest(!0),s.buffers.depth.setMask(!0),s.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))},addToRenderList:function(L,F){const O=B(F);O&&(O.isCubeTexture||O.mapping===Zc)?(v===void 0&&(v=new Ti(new vl(1e4,1e4,1e4),new Ca({name:"BackgroundCubeMaterial",uniforms:op(Qo.backgroundCube.uniforms),vertexShader:Qo.backgroundCube.vertexShader,fragmentShader:Qo.backgroundCube.fragmentShader,side:Lt,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),v.geometry.deleteAttribute("uv"),v.onBeforeRender=function(H,X,$){this.matrixWorld.copyPosition($.matrixWorld)},Object.defineProperty(v.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(v)),Vu.copy(F.backgroundRotation),Vu.x*=-1,Vu.y*=-1,Vu.z*=-1,O.isCubeTexture&&O.isRenderTargetTexture===!1&&(Vu.y*=-1,Vu.z*=-1),v.material.uniforms.envMap.value=O,v.material.uniforms.flipEnvMap.value=O.isCubeTexture&&O.isRenderTargetTexture===!1?-1:1,v.material.uniforms.backgroundBlurriness.value=F.backgroundBlurriness,v.material.uniforms.backgroundIntensity.value=F.backgroundIntensity,v.material.uniforms.backgroundRotation.value.setFromMatrix4(sO.makeRotationFromEuler(Vu)),v.material.toneMapped=Dn.getTransfer(O.colorSpace)!==Di,C===O&&M===O.version&&S===r.toneMapping||(v.material.needsUpdate=!0,C=O,M=O.version,S=r.toneMapping),v.layers.enableAll(),L.unshift(v,v.geometry,v.material,0,0,null)):O&&O.isTexture&&(m===void 0&&(m=new Ti(new Ac(2,2),new Ca({name:"BackgroundMaterial",uniforms:op(Qo.background.uniforms),vertexShader:Qo.background.vertexShader,fragmentShader:Qo.background.fragmentShader,side:ut,depthTest:!1,depthWrite:!1,fog:!1})),m.geometry.deleteAttribute("normal"),Object.defineProperty(m.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(m)),m.material.uniforms.t2D.value=O,m.material.uniforms.backgroundIntensity.value=F.backgroundIntensity,m.material.toneMapped=Dn.getTransfer(O.colorSpace)!==Di,O.matrixAutoUpdate===!0&&O.updateMatrix(),m.material.uniforms.uvTransform.value.copy(O.matrix),C===O&&M===O.version&&S===r.toneMapping||(m.material.needsUpdate=!0,C=O,M=O.version,S=r.toneMapping),m.layers.enableAll(),L.unshift(m,m.geometry,m.material,0,0,null))},dispose:function(){v!==void 0&&(v.geometry.dispose(),v.material.dispose(),v=void 0),m!==void 0&&(m.geometry.dispose(),m.material.dispose(),m=void 0)}}}function oO(r,e){const n=r.getParameter(r.MAX_VERTEX_ATTRIBS),s={},a=v(null);let c=a,u=!1;function A(F){return r.bindVertexArray(F)}function m(F){return r.deleteVertexArray(F)}function v(F){const O=[],H=[],X=[];for(let $=0;$<n;$++)O[$]=0,H[$]=0,X[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:H,attributeDivisors:X,object:F,attributes:{},index:null}}function E(){const F=c.newAttributes;for(let O=0,H=F.length;O<H;O++)F[O]=0}function C(F){M(F,0)}function M(F,O){const H=c.newAttributes,X=c.enabledAttributes,$=c.attributeDivisors;H[F]=1,X[F]===0&&(r.enableVertexAttribArray(F),X[F]=1),$[F]!==O&&(r.vertexAttribDivisor(F,O),$[F]=O)}function S(){const F=c.newAttributes,O=c.enabledAttributes;for(let H=0,X=O.length;H<X;H++)O[H]!==F[H]&&(r.disableVertexAttribArray(H),O[H]=0)}function B(F,O,H,X,$,ee,ie){ie===!0?r.vertexAttribIPointer(F,O,H,$,ee):r.vertexAttribPointer(F,O,H,X,$,ee)}function N(){L(),u=!0,c!==a&&(c=a,A(c.object))}function L(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:function(F,O,H,X,$){let ee=!1;const ie=function(ce,oe,Se){const Ne=Se.wireframe===!0;let ke=s[ce.id];ke===void 0&&(ke={},s[ce.id]=ke);let Oe=ke[oe.id];Oe===void 0&&(Oe={},ke[oe.id]=Oe);let Te=Oe[Ne];return Te===void 0&&(Te=v(r.createVertexArray()),Oe[Ne]=Te),Te}(X,H,O);c!==ie&&(c=ie,A(c.object)),ee=function(ce,oe,Se,Ne){const ke=c.attributes,Oe=oe.attributes;let Te=0;const Je=Se.getAttributes();for(const st in Je)if(Je[st].location>=0){const Et=ke[st];let dt=Oe[st];if(dt===void 0&&(st==="instanceMatrix"&&ce.instanceMatrix&&(dt=ce.instanceMatrix),st==="instanceColor"&&ce.instanceColor&&(dt=ce.instanceColor)),Et===void 0||Et.attribute!==dt||dt&&Et.data!==dt.data)return!0;Te++}return c.attributesNum!==Te||c.index!==Ne}(F,X,H,$),ee&&function(ce,oe,Se,Ne){const ke={},Oe=oe.attributes;let Te=0;const Je=Se.getAttributes();for(const st in Je)if(Je[st].location>=0){let Et=Oe[st];Et===void 0&&(st==="instanceMatrix"&&ce.instanceMatrix&&(Et=ce.instanceMatrix),st==="instanceColor"&&ce.instanceColor&&(Et=ce.instanceColor));const dt={};dt.attribute=Et,Et&&Et.data&&(dt.data=Et.data),ke[st]=dt,Te++}c.attributes=ke,c.attributesNum=Te,c.index=Ne}(F,X,H,$),$!==null&&e.update($,r.ELEMENT_ARRAY_BUFFER),(ee||u)&&(u=!1,function(ce,oe,Se,Ne){E();const ke=Ne.attributes,Oe=Se.getAttributes(),Te=oe.defaultAttributeValues;for(const Je in Oe){const st=Oe[Je];if(st.location>=0){let Et=ke[Je];if(Et===void 0&&(Je==="instanceMatrix"&&ce.instanceMatrix&&(Et=ce.instanceMatrix),Je==="instanceColor"&&ce.instanceColor&&(Et=ce.instanceColor)),Et!==void 0){const dt=Et.normalized,Bt=Et.itemSize,qt=e.get(Et);if(qt===void 0)continue;const Kt=qt.buffer,Jt=qt.type,ln=qt.bytesPerElement,Ot=Jt===r.INT||Jt===r.UNSIGNED_INT||Et.gpuType===eu;if(Et.isInterleavedBufferAttribute){const nt=Et.data,Rt=nt.stride,jt=Et.offset;if(nt.isInstancedInterleavedBuffer){for(let It=0;It<st.locationSize;It++)M(st.location+It,nt.meshPerAttribute);ce.isInstancedMesh!==!0&&Ne._maxInstanceCount===void 0&&(Ne._maxInstanceCount=nt.meshPerAttribute*nt.count)}else for(let It=0;It<st.locationSize;It++)C(st.location+It);r.bindBuffer(r.ARRAY_BUFFER,Kt);for(let It=0;It<st.locationSize;It++)B(st.location+It,Bt/st.locationSize,Jt,dt,Rt*ln,(jt+Bt/st.locationSize*It)*ln,Ot)}else{if(Et.isInstancedBufferAttribute){for(let nt=0;nt<st.locationSize;nt++)M(st.location+nt,Et.meshPerAttribute);ce.isInstancedMesh!==!0&&Ne._maxInstanceCount===void 0&&(Ne._maxInstanceCount=Et.meshPerAttribute*Et.count)}else for(let nt=0;nt<st.locationSize;nt++)C(st.location+nt);r.bindBuffer(r.ARRAY_BUFFER,Kt);for(let nt=0;nt<st.locationSize;nt++)B(st.location+nt,Bt/st.locationSize,Jt,dt,Bt*ln,Bt/st.locationSize*nt*ln,Ot)}}else if(Te!==void 0){const dt=Te[Je];if(dt!==void 0)switch(dt.length){case 2:r.vertexAttrib2fv(st.location,dt);break;case 3:r.vertexAttrib3fv(st.location,dt);break;case 4:r.vertexAttrib4fv(st.location,dt);break;default:r.vertexAttrib1fv(st.location,dt)}}}}S()}(F,O,H,X),$!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get($).buffer))},reset:N,resetDefaultState:L,dispose:function(){N();for(const F in s){const O=s[F];for(const H in O){const X=O[H];for(const $ in X)m(X[$].object),delete X[$];delete O[H]}delete s[F]}},releaseStatesOfGeometry:function(F){if(s[F.id]===void 0)return;const O=s[F.id];for(const H in O){const X=O[H];for(const $ in X)m(X[$].object),delete X[$];delete O[H]}delete s[F.id]},releaseStatesOfProgram:function(F){for(const O in s){const H=s[O];if(H[F.id]===void 0)continue;const X=H[F.id];for(const $ in X)m(X[$].object),delete X[$];delete H[F.id]}},initAttributes:E,enableAttribute:C,disableUnusedAttributes:S}}function lO(r,e,n){let s;function a(c,u,A){A!==0&&(r.drawArraysInstanced(s,c,u,A),n.update(u,s,A))}this.setMode=function(c){s=c},this.render=function(c,u){r.drawArrays(s,c,u),n.update(u,s,1)},this.renderInstances=a,this.renderMultiDraw=function(c,u,A){if(A===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(s,c,0,u,0,A);let m=0;for(let v=0;v<A;v++)m+=u[v];n.update(m,s,1)},this.renderMultiDrawInstances=function(c,u,A,m){if(A===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let E=0;E<c.length;E++)a(c[E],u[E],m[E]);else{v.multiDrawArraysInstancedWEBGL(s,c,0,u,0,m,0,A);let E=0;for(let C=0;C<A;C++)E+=u[C]*m[C];n.update(E,s,1)}}}function cO(r,e,n,s){let a;function c(M){if(M==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=n.precision!==void 0?n.precision:"highp";const A=c(u);A!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",A,"instead."),u=A);const m=n.logarithmicDepthBuffer===!0,v=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),E=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),C=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(a!==void 0)return a;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");a=r.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else a=0;return a},getMaxPrecision:c,textureFormatReadable:function(M){return M===nr||s.convert(M)===r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(M){const S=M===Cs&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(M!==Er&&s.convert(M)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&M!==Ir&&!S)},precision:u,logarithmicDepthBuffer:m,reverseDepthBuffer:v,maxTextures:E,maxVertexTextures:C,maxTextureSize:r.getParameter(r.MAX_TEXTURE_SIZE),maxCubemapSize:r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:r.getParameter(r.MAX_VERTEX_ATTRIBS),maxVertexUniforms:r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:r.getParameter(r.MAX_VARYING_VECTORS),maxFragmentUniforms:r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:C>0,maxSamples:r.getParameter(r.MAX_SAMPLES)}}function hO(r){const e=this;let n=null,s=0,a=!1,c=!1;const u=new dh,A=new wn,m={value:null,needsUpdate:!1};function v(E,C,M,S){const B=E!==null?E.length:0;let N=null;if(B!==0){if(N=m.value,S!==!0||N===null){const L=M+4*B,F=C.matrixWorldInverse;A.getNormalMatrix(F),(N===null||N.length<L)&&(N=new Float32Array(L));for(let O=0,H=M;O!==B;++O,H+=4)u.copy(E[O]).applyMatrix4(F,A),u.normal.toArray(N,H),N[H+3]=u.constant}m.value=N,m.needsUpdate=!0}return e.numPlanes=B,e.numIntersection=0,N}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(E,C){const M=E.length!==0||C||s!==0||a;return a=C,s=E.length,M},this.beginShadows=function(){c=!0,v(null)},this.endShadows=function(){c=!1},this.setGlobalState=function(E,C){n=v(E,C,0)},this.setState=function(E,C,M){const S=E.clippingPlanes,B=E.clipIntersection,N=E.clipShadows,L=r.get(E);if(!a||S===null||S.length===0||c&&!N)c?v(null):(m.value!==n&&(m.value=n,m.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0);else{const F=c?0:s,O=4*F;let H=L.clippingState||null;m.value=H,H=v(S,C,O,M);for(let X=0;X!==O;++X)H[X]=n[X];L.clippingState=H,this.numIntersection=B?this.numPlanes:0,this.numPlanes+=F}}}function uO(r){let e=new WeakMap;function n(a,c){return c===$c?a.mapping=js:c===wo&&(a.mapping=Pa),a}function s(a){const c=a.target;c.removeEventListener("dispose",s);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}return{get:function(a){if(a&&a.isTexture){const c=a.mapping;if(c===$c||c===wo){if(e.has(a))return n(e.get(a).texture,a.mapping);{const u=a.image;if(u&&u.height>0){const A=new yf(u.height);return A.fromEquirectangularTexture(r,a),e.set(a,A),a.addEventListener("dispose",s),n(A.texture,a.mapping)}return null}}}return a},dispose:function(){e=new WeakMap}}}const zI=[.125,.215,.35,.446,.526,.582],L_=new mc,VI=new Mt;let D_=null,P_=0,U_=0,N_=!1;const Wu=(1+Math.sqrt(5))/2,Cp=1/Wu,WI=[new R(-Wu,Cp,0),new R(Wu,Cp,0),new R(-Cp,0,Wu),new R(Cp,0,Wu),new R(0,Wu,-Cp),new R(0,Wu,Cp),new R(-1,1,-1),new R(1,1,-1),new R(-1,1,1),new R(1,1,1)];class F_{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,s=.1,a=100){D_=this._renderer.getRenderTarget(),P_=this._renderer.getActiveCubeFace(),U_=this._renderer.getActiveMipmapLevel(),N_=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,s,a,c),n>0&&this._blur(c,0,0,n),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=XI(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=qI(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(D_,P_,U_),this._renderer.xr.enabled=N_,e.scissorTest=!1,nv(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===js||e.mapping===Pa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),D_=this._renderer.getRenderTarget(),P_=this._renderer.getActiveCubeFace(),U_=this._renderer.getActiveMipmapLevel(),N_=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const s=n||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,s={magFilter:bi,minFilter:bi,generateMipmaps:!1,type:Cs,format:nr,colorSpace:xr,depthBuffer:!1},a=jI(e,n,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=jI(e,n,s);const{_lodMax:c}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(u){const A=[],m=[],v=[];let E=u;const C=u-4+1+zI.length;for(let M=0;M<C;M++){const S=Math.pow(2,E);m.push(S);let B=1/S;M>u-4?B=zI[M-u+4-1]:M===0&&(B=0),v.push(B);const N=1/(S-2),L=-N,F=1+N,O=[L,L,F,L,F,F,L,L,F,F,L,F],H=6,X=6,$=3,ee=2,ie=1,ce=new Float32Array($*X*H),oe=new Float32Array(ee*X*H),Se=new Float32Array(ie*X*H);for(let ke=0;ke<H;ke++){const Oe=ke%3*2/3-1,Te=ke>2?0:-1,Je=[Oe,Te,0,Oe+2/3,Te,0,Oe+2/3,Te+1,0,Oe,Te,0,Oe+2/3,Te+1,0,Oe,Te+1,0];ce.set(Je,$*X*ke),oe.set(O,ee*X*ke);const st=[ke,ke,ke,ke,ke,ke];Se.set(st,ie*X*ke)}const Ne=new vn;Ne.setAttribute("position",new qn(ce,$)),Ne.setAttribute("uv",new qn(oe,ee)),Ne.setAttribute("faceIndex",new qn(Se,ie)),A.push(Ne),E>4&&E--}return{lodPlanes:A,sizeLods:m,sigmas:v}}(c)),this._blurMaterial=function(u,A,m){const v=new Float32Array(20),E=new R(0,1,0);return new Ca({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/A,CUBEUV_TEXEL_HEIGHT:1/m,CUBEUV_MAX_MIP:`${u}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:v},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:E}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Yt,depthTest:!1,depthWrite:!1})}(c,e,n)}return a}_compileMaterial(e){const n=new Ti(this._lodPlanes[0],e);this._renderer.compile(n,L_)}_sceneToCubeUV(e,n,s,a){const c=new Hr(90,1,n,s),u=[1,-1,1,1,1,1],A=[1,1,1,-1,-1,-1],m=this._renderer,v=m.autoClear,E=m.toneMapping;m.getClearColor(VI),m.toneMapping=ur,m.autoClear=!1;const C=new Jr({name:"PMREM.Background",side:Lt,depthWrite:!1,depthTest:!1}),M=new Ti(new vl,C);let S=!1;const B=e.background;B?B.isColor&&(C.color.copy(B),e.background=null,S=!0):(C.color.copy(VI),S=!0);for(let N=0;N<6;N++){const L=N%3;L===0?(c.up.set(0,u[N],0),c.lookAt(A[N],0,0)):L===1?(c.up.set(0,0,u[N]),c.lookAt(0,A[N],0)):(c.up.set(0,u[N],0),c.lookAt(0,0,A[N]));const F=this._cubeSize;nv(a,L*F,N>2?F:0,F,F),m.setRenderTarget(a),S&&m.render(M,c),m.render(e,c)}M.geometry.dispose(),M.material.dispose(),m.toneMapping=E,m.autoClear=v,e.background=B}_textureToCubeUV(e,n){const s=this._renderer,a=e.mapping===js||e.mapping===Pa;a?(this._cubemapMaterial===null&&(this._cubemapMaterial=XI()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=qI());const c=a?this._cubemapMaterial:this._equirectMaterial,u=new Ti(this._lodPlanes[0],c);c.uniforms.envMap.value=e;const A=this._cubeSize;nv(n,0,0,3*A,2*A),s.setRenderTarget(n),s.render(u,L_)}_applyPMREM(e){const n=this._renderer,s=n.autoClear;n.autoClear=!1;const a=this._lodPlanes.length;for(let c=1;c<a;c++){const u=Math.sqrt(this._sigmas[c]*this._sigmas[c]-this._sigmas[c-1]*this._sigmas[c-1]),A=WI[(a-c-1)%WI.length];this._blur(e,c-1,c,u,A)}n.autoClear=s}_blur(e,n,s,a,c){const u=this._pingPongRenderTarget;this._halfBlur(e,u,n,s,a,"latitudinal",c),this._halfBlur(u,e,s,s,a,"longitudinal",c)}_halfBlur(e,n,s,a,c,u,A){const m=this._renderer,v=this._blurMaterial;u!=="latitudinal"&&u!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const E=new Ti(this._lodPlanes[a],v),C=v.uniforms,M=this._sizeLods[s]-1,S=isFinite(c)?Math.PI/(2*M):2*Math.PI/39,B=c/S,N=isFinite(c)?1+Math.floor(3*B):20;N>20&&console.warn(`sigmaRadians, ${c}, is too large and will clip, as it requested ${N} samples when the maximum is set to 20`);const L=[];let F=0;for(let X=0;X<20;++X){const $=X/B,ee=Math.exp(-$*$/2);L.push(ee),X===0?F+=ee:X<N&&(F+=2*ee)}for(let X=0;X<L.length;X++)L[X]=L[X]/F;C.envMap.value=e.texture,C.samples.value=N,C.weights.value=L,C.latitudinal.value=u==="latitudinal",A&&(C.poleAxis.value=A);const{_lodMax:O}=this;C.dTheta.value=S,C.mipInt.value=O-s;const H=this._sizeLods[a];nv(n,3*H*(a>O-4?a-O+4:0),4*(this._cubeSize-H),3*H,2*H),m.setRenderTarget(n),m.render(E,L_)}}function jI(r,e,n){const s=new Us(r,e,n);return s.texture.mapping=Zc,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}function nv(r,e,n,s,a){r.viewport.set(e,n,s,a),r.scissor.set(e,n,s,a)}function qI(){return new Ca({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Yt,depthTest:!1,depthWrite:!1})}function XI(){return new Ca({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Yt,depthTest:!1,depthWrite:!1})}function dO(r){let e=new WeakMap,n=null;function s(a){const c=a.target;c.removeEventListener("dispose",s);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}return{get:function(a){if(a&&a.isTexture){const c=a.mapping,u=c===$c||c===wo,A=c===js||c===Pa;if(u||A){let m=e.get(a);const v=m!==void 0?m.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==v)return n===null&&(n=new F_(r)),m=u?n.fromEquirectangular(a,m):n.fromCubemap(a,m),m.texture.pmremVersion=a.pmremVersion,e.set(a,m),m.texture;if(m!==void 0)return m.texture;{const E=a.image;return u&&E&&E.height>0||A&&E&&function(C){let M=0;for(let S=0;S<6;S++)C[S]!==void 0&&M++;return M===6}(E)?(n===null&&(n=new F_(r)),m=u?n.fromEquirectangular(a):n.fromCubemap(a),m.texture.pmremVersion=a.pmremVersion,e.set(a,m),a.addEventListener("dispose",s),m.texture):null}}}return a},dispose:function(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}}}function pO(r){const e={};function n(s){if(e[s]!==void 0)return e[s];let a;switch(s){case"WEBGL_depth_texture":a=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=r.getExtension(s)}return e[s]=a,a}return{has:function(s){return n(s)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(s){const a=n(s);return a===null&&ml("THREE.WebGLRenderer: "+s+" extension not supported."),a}}}function AO(r,e,n,s){const a={},c=new WeakMap;function u(m){const v=m.target;v.index!==null&&e.remove(v.index);for(const C in v.attributes)e.remove(v.attributes[C]);v.removeEventListener("dispose",u),delete a[v.id];const E=c.get(v);E&&(e.remove(E),c.delete(v)),s.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,n.memory.geometries--}function A(m){const v=[],E=m.index,C=m.attributes.position;let M=0;if(E!==null){const N=E.array;M=E.version;for(let L=0,F=N.length;L<F;L+=3){const O=N[L+0],H=N[L+1],X=N[L+2];v.push(O,H,H,X,X,O)}}else{if(C===void 0)return;{const N=C.array;M=C.version;for(let L=0,F=N.length/3-1;L<F;L+=3){const O=L+0,H=L+1,X=L+2;v.push(O,H,H,X,X,O)}}}const S=new(zg(v)?Bx:Tx)(v,1);S.version=M;const B=c.get(m);B&&e.remove(B),c.set(m,S)}return{get:function(m,v){return a[v.id]===!0||(v.addEventListener("dispose",u),a[v.id]=!0,n.memory.geometries++),v},update:function(m){const v=m.attributes;for(const E in v)e.update(v[E],r.ARRAY_BUFFER)},getWireframeAttribute:function(m){const v=c.get(m);if(v){const E=m.index;E!==null&&v.version<E.version&&A(m)}else A(m);return c.get(m)}}}function fO(r,e,n){let s,a,c;function u(A,m,v){v!==0&&(r.drawElementsInstanced(s,m,a,A*c,v),n.update(m,s,v))}this.setMode=function(A){s=A},this.setIndex=function(A){a=A.type,c=A.bytesPerElement},this.render=function(A,m){r.drawElements(s,m,a,A*c),n.update(m,s,1)},this.renderInstances=u,this.renderMultiDraw=function(A,m,v){if(v===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(s,m,0,a,A,0,v);let E=0;for(let C=0;C<v;C++)E+=m[C];n.update(E,s,1)},this.renderMultiDrawInstances=function(A,m,v,E){if(v===0)return;const C=e.get("WEBGL_multi_draw");if(C===null)for(let M=0;M<A.length;M++)u(A[M]/c,m[M],E[M]);else{C.multiDrawElementsInstancedWEBGL(s,m,0,a,A,0,E,0,v);let M=0;for(let S=0;S<v;S++)M+=m[S]*E[S];n.update(M,s,1)}}}function mO(r){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,s,a){switch(e.calls++,s){case r.TRIANGLES:e.triangles+=a*(n/3);break;case r.LINES:e.lines+=a*(n/2);break;case r.LINE_STRIP:e.lines+=a*(n-1);break;case r.LINE_LOOP:e.lines+=a*n;break;case r.POINTS:e.points+=a*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s)}}}}function gO(r,e,n){const s=new WeakMap,a=new pi;return{update:function(c,u,A){const m=c.morphTargetInfluences,v=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,E=v!==void 0?v.length:0;let C=s.get(u);if(C===void 0||C.count!==E){let ce=function(){ee.dispose(),s.delete(u),u.removeEventListener("dispose",ce)};C!==void 0&&C.texture.dispose();const M=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,B=u.morphAttributes.color!==void 0,N=u.morphAttributes.position||[],L=u.morphAttributes.normal||[],F=u.morphAttributes.color||[];let O=0;M===!0&&(O=1),S===!0&&(O=2),B===!0&&(O=3);let H=u.attributes.position.count*O,X=1;H>e.maxTextureSize&&(X=Math.ceil(H/e.maxTextureSize),H=e.maxTextureSize);const $=new Float32Array(H*X*4*E),ee=new gl($,H,X,E);ee.type=Ir,ee.needsUpdate=!0;const ie=4*O;for(let oe=0;oe<E;oe++){const Se=N[oe],Ne=L[oe],ke=F[oe],Oe=H*X*4*oe;for(let Te=0;Te<Se.count;Te++){const Je=Te*ie;M===!0&&(a.fromBufferAttribute(Se,Te),$[Oe+Je+0]=a.x,$[Oe+Je+1]=a.y,$[Oe+Je+2]=a.z,$[Oe+Je+3]=0),S===!0&&(a.fromBufferAttribute(Ne,Te),$[Oe+Je+4]=a.x,$[Oe+Je+5]=a.y,$[Oe+Je+6]=a.z,$[Oe+Je+7]=0),B===!0&&(a.fromBufferAttribute(ke,Te),$[Oe+Je+8]=a.x,$[Oe+Je+9]=a.y,$[Oe+Je+10]=a.z,$[Oe+Je+11]=ke.itemSize===4?a.w:1)}}C={count:E,texture:ee,size:new ct(H,X)},s.set(u,C),u.addEventListener("dispose",ce)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)A.getUniforms().setValue(r,"morphTexture",c.morphTexture,n);else{let M=0;for(let B=0;B<m.length;B++)M+=m[B];const S=u.morphTargetsRelative?1:1-M;A.getUniforms().setValue(r,"morphTargetBaseInfluence",S),A.getUniforms().setValue(r,"morphTargetInfluences",m)}A.getUniforms().setValue(r,"morphTargetsTexture",C.texture,n),A.getUniforms().setValue(r,"morphTargetsTextureSize",C.size)}}}class vO{constructor(e,n,s){if(this.renderer=e,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=s,this.extensions=n,this.available=this.extensions.has("OCULUS_multiview"),this.available){const c=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(c.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var a=0;a<this.maxNumViews;a++)this.mat4[a]=new Qt,this.mat3[a]=new wn}}getCameraArray(e){return e.isArrayCamera?e.cameras:(this.cameraArray[0]=e,this.cameraArray)}updateCameraProjectionMatricesUniform(e,n){for(var s=this.getCameraArray(e),a=0;a<s.length;a++)this.mat4[a].copy(s[a].projectionMatrix);n.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(e,n){for(var s=this.getCameraArray(e),a=0;a<s.length;a++)this.mat4[a].copy(s[a].matrixWorldInverse);n.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(e,n,s){for(var a=this.getCameraArray(n),c=0;c<a.length;c++)this.mat4[c].multiplyMatrices(a[c].matrixWorldInverse,e.matrixWorld),this.mat3[c].getNormalMatrix(this.mat4[c]);s.setValue(this.gl,"modelViewMatrices",this.mat4),s.setValue(this.gl,"normalMatrices",this.mat3)}}function yO(r,e,n,s){let a=new WeakMap;function c(u){const A=u.target;A.removeEventListener("dispose",c),n.remove(A.instanceMatrix),A.instanceColor!==null&&n.remove(A.instanceColor)}return{update:function(u){const A=s.render.frame,m=u.geometry,v=e.get(u,m);if(a.get(v)!==A&&(e.update(v),a.set(v,A)),u.isInstancedMesh&&(u.hasEventListener("dispose",c)===!1&&u.addEventListener("dispose",c),a.get(u)!==A&&(n.update(u.instanceMatrix,r.ARRAY_BUFFER),u.instanceColor!==null&&n.update(u.instanceColor,r.ARRAY_BUFFER),a.set(u,A))),u.isSkinnedMesh){const E=u.skeleton;a.get(E)!==A&&(E.update(),a.set(E,A))}return v},dispose:function(){a=new WeakMap}}}const YI=new Pi,KI=new Xx(1,1),JI=new gl,$I=new bu,ZI=new hp,eT=[],tT=[],nT=new Float32Array(16),iT=new Float32Array(9),rT=new Float32Array(4);function wp(r,e,n){const s=r[0];if(s<=0||s>0)return r;const a=e*n;let c=eT[a];if(c===void 0&&(c=new Float32Array(a),eT[a]=c),e!==0){s.toArray(c,0);for(let u=1,A=0;u!==e;++u)A+=n,r[u].toArray(c,A)}return c}function es(r,e){if(r.length!==e.length)return!1;for(let n=0,s=r.length;n<s;n++)if(r[n]!==e[n])return!1;return!0}function ts(r,e){for(let n=0,s=e.length;n<s;n++)r[n]=e[n]}function iv(r,e){let n=tT[e];n===void 0&&(n=new Int32Array(e),tT[e]=n);for(let s=0;s!==e;++s)n[s]=r.allocateTextureUnit();return n}function EO(r,e){const n=this.cache;n[0]!==e&&(r.uniform1f(this.addr,e),n[0]=e)}function xO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y||(r.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(es(n,e))return;r.uniform2fv(this.addr,e),ts(n,e)}}function _O(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(r.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(r.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(es(n,e))return;r.uniform3fv(this.addr,e),ts(n,e)}}function bO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(es(n,e))return;r.uniform4fv(this.addr,e),ts(n,e)}}function CO(r,e){const n=this.cache,s=e.elements;if(s===void 0){if(es(n,e))return;r.uniformMatrix2fv(this.addr,!1,e),ts(n,e)}else{if(es(n,s))return;rT.set(s),r.uniformMatrix2fv(this.addr,!1,rT),ts(n,s)}}function wO(r,e){const n=this.cache,s=e.elements;if(s===void 0){if(es(n,e))return;r.uniformMatrix3fv(this.addr,!1,e),ts(n,e)}else{if(es(n,s))return;iT.set(s),r.uniformMatrix3fv(this.addr,!1,iT),ts(n,s)}}function MO(r,e){const n=this.cache,s=e.elements;if(s===void 0){if(es(n,e))return;r.uniformMatrix4fv(this.addr,!1,e),ts(n,e)}else{if(es(n,s))return;nT.set(s),r.uniformMatrix4fv(this.addr,!1,nT),ts(n,s)}}function SO(r,e){const n=this.cache;n[0]!==e&&(r.uniform1i(this.addr,e),n[0]=e)}function IO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y||(r.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(es(n,e))return;r.uniform2iv(this.addr,e),ts(n,e)}}function TO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(r.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(es(n,e))return;r.uniform3iv(this.addr,e),ts(n,e)}}function BO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(es(n,e))return;r.uniform4iv(this.addr,e),ts(n,e)}}function RO(r,e){const n=this.cache;n[0]!==e&&(r.uniform1ui(this.addr,e),n[0]=e)}function LO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y||(r.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(es(n,e))return;r.uniform2uiv(this.addr,e),ts(n,e)}}function DO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(r.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(es(n,e))return;r.uniform3uiv(this.addr,e),ts(n,e)}}function PO(r,e){const n=this.cache;if(e.x!==void 0)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(es(n,e))return;r.uniform4uiv(this.addr,e),ts(n,e)}}function UO(r,e,n){const s=this.cache,a=n.allocateTextureUnit();let c;s[0]!==a&&(r.uniform1i(this.addr,a),s[0]=a),this.type===r.SAMPLER_2D_SHADOW?(KI.compareFunction=yu,c=KI):c=YI,n.setTexture2D(e||c,a)}function NO(r,e,n){const s=this.cache,a=n.allocateTextureUnit();s[0]!==a&&(r.uniform1i(this.addr,a),s[0]=a),n.setTexture3D(e||$I,a)}function FO(r,e,n){const s=this.cache,a=n.allocateTextureUnit();s[0]!==a&&(r.uniform1i(this.addr,a),s[0]=a),n.setTextureCube(e||ZI,a)}function OO(r,e,n){const s=this.cache,a=n.allocateTextureUnit();s[0]!==a&&(r.uniform1i(this.addr,a),s[0]=a),n.setTexture2DArray(e||JI,a)}function kO(r,e){r.uniform1fv(this.addr,e)}function QO(r,e){const n=wp(e,this.size,2);r.uniform2fv(this.addr,n)}function GO(r,e){const n=wp(e,this.size,3);r.uniform3fv(this.addr,n)}function HO(r,e){const n=wp(e,this.size,4);r.uniform4fv(this.addr,n)}function zO(r,e){const n=wp(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,n)}function VO(r,e){const n=wp(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,n)}function WO(r,e){const n=wp(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,n)}function jO(r,e){r.uniform1iv(this.addr,e)}function qO(r,e){r.uniform2iv(this.addr,e)}function XO(r,e){r.uniform3iv(this.addr,e)}function YO(r,e){r.uniform4iv(this.addr,e)}function KO(r,e){r.uniform1uiv(this.addr,e)}function JO(r,e){r.uniform2uiv(this.addr,e)}function $O(r,e){r.uniform3uiv(this.addr,e)}function ZO(r,e){r.uniform4uiv(this.addr,e)}function ek(r,e,n){const s=this.cache,a=e.length,c=iv(n,a);es(s,c)||(r.uniform1iv(this.addr,c),ts(s,c));for(let u=0;u!==a;++u)n.setTexture2D(e[u]||YI,c[u])}function tk(r,e,n){const s=this.cache,a=e.length,c=iv(n,a);es(s,c)||(r.uniform1iv(this.addr,c),ts(s,c));for(let u=0;u!==a;++u)n.setTexture3D(e[u]||$I,c[u])}function nk(r,e,n){const s=this.cache,a=e.length,c=iv(n,a);es(s,c)||(r.uniform1iv(this.addr,c),ts(s,c));for(let u=0;u!==a;++u)n.setTextureCube(e[u]||ZI,c[u])}function ik(r,e,n){const s=this.cache,a=e.length,c=iv(n,a);es(s,c)||(r.uniform1iv(this.addr,c),ts(s,c));for(let u=0;u!==a;++u)n.setTexture2DArray(e[u]||JI,c[u])}class rk{constructor(e,n,s){this.id=e,this.addr=s,this.cache=[],this.type=n.type,this.setValue=function(a){switch(a){case 5126:return EO;case 35664:return xO;case 35665:return _O;case 35666:return bO;case 35674:return CO;case 35675:return wO;case 35676:return MO;case 5124:case 35670:return SO;case 35667:case 35671:return IO;case 35668:case 35672:return TO;case 35669:case 35673:return BO;case 5125:return RO;case 36294:return LO;case 36295:return DO;case 36296:return PO;case 35678:case 36198:case 36298:case 36306:case 35682:return UO;case 35679:case 36299:case 36307:return NO;case 35680:case 36300:case 36308:case 36293:return FO;case 36289:case 36303:case 36311:case 36292:return OO}}(n.type)}}class sk{constructor(e,n,s){this.id=e,this.addr=s,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=function(a){switch(a){case 5126:return kO;case 35664:return QO;case 35665:return GO;case 35666:return HO;case 35674:return zO;case 35675:return VO;case 35676:return WO;case 5124:case 35670:return jO;case 35667:case 35671:return qO;case 35668:case 35672:return XO;case 35669:case 35673:return YO;case 5125:return KO;case 36294:return JO;case 36295:return $O;case 36296:return ZO;case 35678:case 36198:case 36298:case 36306:case 35682:return ek;case 35679:case 36299:case 36307:return tk;case 35680:case 36300:case 36308:case 36293:return nk;case 36289:case 36303:case 36311:case 36292:return ik}}(n.type)}}class ak{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,s){const a=this.seq;for(let c=0,u=a.length;c!==u;++c){const A=a[c];A.setValue(e,n[A.id],s)}}}const O_=/(\w+)(\])?(\[|\.)?/g;function sT(r,e){r.seq.push(e),r.map[e.id]=e}function ok(r,e,n){const s=r.name,a=s.length;for(O_.lastIndex=0;;){const c=O_.exec(s),u=O_.lastIndex;let A=c[1];const m=c[2]==="]",v=c[3];if(m&&(A|=0),v===void 0||v==="["&&u+2===a){sT(n,v===void 0?new rk(A,r,e):new sk(A,r,e));break}{let E=n.map[A];E===void 0&&(E=new ak(A),sT(n,E)),n=E}}}class rv{constructor(e,n){this.seq=[],this.map={};const s=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let a=0;a<s;++a){const c=e.getActiveUniform(n,a);ok(c,e.getUniformLocation(n,c.name),this)}}setValue(e,n,s,a){const c=this.map[n];c!==void 0&&c.setValue(e,s,a)}setOptional(e,n,s){const a=n[s];a!==void 0&&this.setValue(e,s,a)}static upload(e,n,s,a){for(let c=0,u=n.length;c!==u;++c){const A=n[c],m=s[A.id];m.needsUpdate!==!1&&A.setValue(e,m.value,a)}}static seqWithValue(e,n){const s=[];for(let a=0,c=e.length;a!==c;++a){const u=e[a];u.id in n&&s.push(u)}return s}}function aT(r,e,n){const s=r.createShader(e);return r.shaderSource(s,n),r.compileShader(s),s}const lk=37297;let ck=0;const oT=new wn;function lT(r,e,n){const s=r.getShaderParameter(e,r.COMPILE_STATUS),a=r.getShaderInfoLog(e).trim();if(s&&a==="")return"";const c=/ERROR: 0:(\d+)/.exec(a);if(c){const u=parseInt(c[1]);return n.toUpperCase()+`

`+a+`

`+function(A,m){const v=A.split(`
`),E=[],C=Math.max(m-6,0),M=Math.min(m+6,v.length);for(let S=C;S<M;S++){const B=S+1;E.push(`${B===m?">":" "} ${B}: ${v[S]}`)}return E.join(`
`)}(r.getShaderSource(e),u)}return a}function hk(r,e){const n=function(s){Dn._getMatrix(oT,Dn.workingColorSpace,s);const a=`mat3( ${oT.elements.map(c=>c.toFixed(4))} )`;switch(Dn.getTransfer(s)){case ah:return[a,"LinearTransferOETF"];case Di:return[a,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",s),[a,"LinearTransferOETF"]}}(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function uk(r,e){let n;switch(e){case Lr:n="Linear";break;case ma:n="Reinhard";break;case _i:n="Cineon";break;case Kc:n="ACESFilmic";break;case KA:n="AgX";break;case ql:n="Neutral";break;case YA:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+r+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const sv=new R;function Xf(r){return r!==""}function cT(r,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function hT(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const dk=/^[ \t]*#include +<([\w\d./]+)>/gm;function k_(r){return r.replace(dk,Ak)}const pk=new Map;function Ak(r,e){let n=Xn[e];if(n===void 0){const s=pk.get(e);if(s===void 0)throw new Error("Can not resolve #include <"+e+">");n=Xn[s],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,s)}return k_(n)}const fk=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function uT(r){return r.replace(fk,mk)}function mk(r,e,n,s){let a="";for(let c=parseInt(e);c<parseInt(n);c++)a+=s.replace(/\[\s*i\s*\]/g,"[ "+c+" ]").replace(/UNROLLED_LOOP_INDEX/g,c);return a}function dT(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function gk(r,e,n,s){const a=r.getContext(),c=n.defines;let u=n.vertexShader,A=n.fragmentShader;const m=function(ke){let Oe="SHADOWMAP_TYPE_BASIC";return ke.shadowMapType===qe?Oe="SHADOWMAP_TYPE_PCF":ke.shadowMapType===ot?Oe="SHADOWMAP_TYPE_PCF_SOFT":ke.shadowMapType===He&&(Oe="SHADOWMAP_TYPE_VSM"),Oe}(n),v=function(ke){let Oe="ENVMAP_TYPE_CUBE";if(ke.envMap)switch(ke.envMapMode){case js:case Pa:Oe="ENVMAP_TYPE_CUBE";break;case Zc:Oe="ENVMAP_TYPE_CUBE_UV"}return Oe}(n),E=function(ke){let Oe="ENVMAP_MODE_REFLECTION";return ke.envMap&&ke.envMapMode===Pa&&(Oe="ENVMAP_MODE_REFRACTION"),Oe}(n),C=function(ke){let Oe="ENVMAP_BLENDING_NONE";if(ke.envMap)switch(ke.combine){case bs:Oe="ENVMAP_BLENDING_MULTIPLY";break;case Ls:Oe="ENVMAP_BLENDING_MIX";break;case Yr:Oe="ENVMAP_BLENDING_ADD"}return Oe}(n),M=function(ke){const Oe=ke.envMapCubeUVHeight;if(Oe===null)return null;const Te=Math.log2(Oe)-2,Je=1/Oe;return{texelWidth:1/(3*Math.max(Math.pow(2,Te),112)),texelHeight:Je,maxMip:Te}}(n),S=function(ke){return[ke.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",ke.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Xf).join(`
`)}(n),B=function(ke){const Oe=[];for(const Te in ke){const Je=ke[Te];Je!==!1&&Oe.push("#define "+Te+" "+Je)}return Oe.join(`
`)}(c),N=a.createProgram();let L,F,O=n.glslVersion?"#version "+n.glslVersion+`
`:"";const H=n.numMultiviewViews;n.isRawShaderMaterial?(L=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B].filter(Xf).join(`
`),L.length>0&&(L+=`
`),F=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B].filter(Xf).join(`
`),F.length>0&&(F+=`
`)):(L=[dT(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+E:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Xf).join(`
`),F=[dT(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,B,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+v:"",n.envMap?"#define "+E:"",n.envMap?"#define "+C:"",M?"#define CUBEUV_TEXEL_WIDTH "+M.texelWidth:"",M?"#define CUBEUV_TEXEL_HEIGHT "+M.texelHeight:"",M?"#define CUBEUV_MAX_MIP "+M.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ur?"#define TONE_MAPPING":"",n.toneMapping!==ur?Xn.tonemapping_pars_fragment:"",n.toneMapping!==ur?uk("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Xn.colorspace_pars_fragment,hk("linearToOutputTexel",n.outputColorSpace),(Dn.getLuminanceCoefficients(sv),["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${sv.x.toFixed(4)}, ${sv.y.toFixed(4)}, ${sv.z.toFixed(4)} );`,"	return dot( weights, rgb );","}"].join(`
`)),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(Xf).join(`
`)),u=k_(u),u=cT(u,n),u=hT(u,n),A=k_(A),A=cT(A,n),A=hT(A,n),u=uT(u),A=uT(A),n.isRawShaderMaterial!==!0&&(O=`#version 300 es
`,L=[S,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+L,F=["#define varying in",n.glslVersion===xu?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===xu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+F,H>0&&(L=["#extension GL_OVR_multiview : require","layout(num_views = "+H+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+L,L=L.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+H+"];","uniform mat4 projectionMatrices["+H+"];","uniform mat4 viewMatrices["+H+"];","uniform mat3 normalMatrices["+H+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),F=["#extension GL_OVR_multiview : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+F,F=F.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+H+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`))));const X=O+L+u,$=O+F+A,ee=aT(a,a.VERTEX_SHADER,X),ie=aT(a,a.FRAGMENT_SHADER,$);function ce(ke){if(r.debug.checkShaderErrors){const Oe=a.getProgramInfoLog(N).trim(),Te=a.getShaderInfoLog(ee).trim(),Je=a.getShaderInfoLog(ie).trim();let st=!0,Et=!0;if(a.getProgramParameter(N,a.LINK_STATUS)===!1)if(st=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(a,N,ee,ie);else{const dt=lT(a,ee,"vertex"),Bt=lT(a,ie,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(N,a.VALIDATE_STATUS)+`

Material Name: `+ke.name+`
Material Type: `+ke.type+`

Program Info Log: `+Oe+`
`+dt+`
`+Bt)}else Oe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Oe):Te!==""&&Je!==""||(Et=!1);Et&&(ke.diagnostics={runnable:st,programLog:Oe,vertexShader:{log:Te,prefix:L},fragmentShader:{log:Je,prefix:F}})}a.deleteShader(ee),a.deleteShader(ie),oe=new rv(a,N),Se=function(Oe,Te){const Je={},st=Oe.getProgramParameter(Te,Oe.ACTIVE_ATTRIBUTES);for(let Et=0;Et<st;Et++){const dt=Oe.getActiveAttrib(Te,Et),Bt=dt.name;let qt=1;dt.type===Oe.FLOAT_MAT2&&(qt=2),dt.type===Oe.FLOAT_MAT3&&(qt=3),dt.type===Oe.FLOAT_MAT4&&(qt=4),Je[Bt]={type:dt.type,location:Oe.getAttribLocation(Te,Bt),locationSize:qt}}return Je}(a,N)}let oe,Se;a.attachShader(N,ee),a.attachShader(N,ie),n.index0AttributeName!==void 0?a.bindAttribLocation(N,0,n.index0AttributeName):n.morphTargets===!0&&a.bindAttribLocation(N,0,"position"),a.linkProgram(N),this.getUniforms=function(){return oe===void 0&&ce(this),oe},this.getAttributes=function(){return Se===void 0&&ce(this),Se};let Ne=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Ne===!1&&(Ne=a.getProgramParameter(N,lk)),Ne},this.destroy=function(){s.releaseStatesOfProgram(this),a.deleteProgram(N),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=ck++,this.cacheKey=e,this.usedTimes=1,this.program=N,this.vertexShader=ee,this.fragmentShader=ie,this.numMultiviewViews=H,this}let vk=0;class yk{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,s=e.fragmentShader,a=this._getShaderStage(n),c=this._getShaderStage(s),u=this._getShaderCacheForMaterial(e);return u.has(a)===!1&&(u.add(a),a.usedTimes++),u.has(c)===!1&&(u.add(c),c.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const s of n)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let s=n.get(e);return s===void 0&&(s=new Set,n.set(e,s)),s}_getShaderStage(e){const n=this.shaderCache;let s=n.get(e);return s===void 0&&(s=new Ek(e),n.set(e,s)),s}}class Ek{constructor(e){this.id=vk++,this.code=e,this.usedTimes=0}}function xk(r,e,n,s,a,c,u){const A=new oc,m=new yk,v=new Set,E=[],C=a.logarithmicDepthBuffer,M=a.vertexTextures;let S=a.precision;const B={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function N(L){return v.add(L),L===0?"uv":`uv${L}`}return{getParameters:function(L,F,O,H,X){const $=H.fog,ee=X.geometry,ie=L.isMeshStandardMaterial?H.environment:null,ce=(L.isMeshStandardMaterial?n:e).get(L.envMap||ie),oe=ce&&ce.mapping===Zc?ce.image.height:null,Se=B[L.type];L.precision!==null&&(S=a.getMaxPrecision(L.precision),S!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",S,"instead."));const Ne=ee.morphAttributes.position||ee.morphAttributes.normal||ee.morphAttributes.color,ke=Ne!==void 0?Ne.length:0;let Oe,Te,Je,st,Et=0;if(ee.morphAttributes.position!==void 0&&(Et=1),ee.morphAttributes.normal!==void 0&&(Et=2),ee.morphAttributes.color!==void 0&&(Et=3),Se){const Le=Qo[Se];Oe=Le.vertexShader,Te=Le.fragmentShader}else Oe=L.vertexShader,Te=L.fragmentShader,m.update(L),Je=m.getVertexShaderID(L),st=m.getFragmentShaderID(L);const dt=r.getRenderTarget(),Bt=r.state.buffers.depth.getReversed(),qt=dt&&dt.isWebGLMultiviewRenderTarget?dt.numViews:0,Kt=X.isInstancedMesh===!0,Jt=X.isBatchedMesh===!0,ln=!!L.map,Ot=!!L.matcap,nt=!!ce,Rt=!!L.aoMap,jt=!!L.lightMap,It=!!L.bumpMap,mt=!!L.normalMap,vt=!!L.displacementMap,re=!!L.emissiveMap,W=!!L.metalnessMap,ae=!!L.roughnessMap,xe=L.anisotropy>0,ge=L.clearcoat>0,Ee=L.dispersion>0,Ue=L.iridescence>0,Xe=L.sheen>0,at=L.transmission>0,Xt=xe&&!!L.anisotropyMap,gt=ge&&!!L.clearcoatMap,cn=ge&&!!L.clearcoatNormalMap,yn=ge&&!!L.clearcoatRoughnessMap,tn=Ue&&!!L.iridescenceMap,hn=Ue&&!!L.iridescenceThicknessMap,Yn=Xe&&!!L.sheenColorMap,Kn=Xe&&!!L.sheenRoughnessMap,Ei=!!L.specularMap,Hi=!!L.specularColorMap,li=!!L.specularIntensityMap,an=at&&!!L.transmissionMap,Ni=at&&!!L.thicknessMap,fi=!!L.gradientMap,Ia=!!L.alphaMap,Mn=L.alphaTest>0,dr=!!L.alphaHash,mi=!!L.extensions;let Cl=ur;L.toneMapped&&(dt!==null&&dt.isXRRenderTarget!==!0||(Cl=r.toneMapping));const Cc={shaderID:Se,shaderType:L.type,shaderName:L.name,vertexShader:Oe,fragmentShader:Te,defines:L.defines,customVertexShaderID:Je,customFragmentShaderID:st,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:S,batching:Jt,batchingColor:Jt&&X._colorsTexture!==null,instancing:Kt,instancingColor:Kt&&X.instanceColor!==null,instancingMorph:Kt&&X.morphTexture!==null,supportsVertexTextures:M,numMultiviewViews:qt,outputColorSpace:dt===null?r.outputColorSpace:dt.isXRRenderTarget===!0?dt.texture.colorSpace:xr,alphaToCoverage:!!L.alphaToCoverage,map:ln,matcap:Ot,envMap:nt,envMapMode:nt&&ce.mapping,envMapCubeUVHeight:oe,aoMap:Rt,lightMap:jt,bumpMap:It,normalMap:mt,displacementMap:M&&vt,emissiveMap:re,normalMapObjectSpace:mt&&L.normalMapType===Ug,normalMapTangentSpace:mt&&L.normalMapType===Lo,metalnessMap:W,roughnessMap:ae,anisotropy:xe,anisotropyMap:Xt,clearcoat:ge,clearcoatMap:gt,clearcoatNormalMap:cn,clearcoatRoughnessMap:yn,dispersion:Ee,iridescence:Ue,iridescenceMap:tn,iridescenceThicknessMap:hn,sheen:Xe,sheenColorMap:Yn,sheenRoughnessMap:Kn,specularMap:Ei,specularColorMap:Hi,specularIntensityMap:li,transmission:at,transmissionMap:an,thicknessMap:Ni,gradientMap:fi,opaque:L.transparent===!1&&L.blending===rn&&L.alphaToCoverage===!1,alphaMap:Ia,alphaTest:Mn,alphaHash:dr,combine:L.combine,mapUv:ln&&N(L.map.channel),aoMapUv:Rt&&N(L.aoMap.channel),lightMapUv:jt&&N(L.lightMap.channel),bumpMapUv:It&&N(L.bumpMap.channel),normalMapUv:mt&&N(L.normalMap.channel),displacementMapUv:vt&&N(L.displacementMap.channel),emissiveMapUv:re&&N(L.emissiveMap.channel),metalnessMapUv:W&&N(L.metalnessMap.channel),roughnessMapUv:ae&&N(L.roughnessMap.channel),anisotropyMapUv:Xt&&N(L.anisotropyMap.channel),clearcoatMapUv:gt&&N(L.clearcoatMap.channel),clearcoatNormalMapUv:cn&&N(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:yn&&N(L.clearcoatRoughnessMap.channel),iridescenceMapUv:tn&&N(L.iridescenceMap.channel),iridescenceThicknessMapUv:hn&&N(L.iridescenceThicknessMap.channel),sheenColorMapUv:Yn&&N(L.sheenColorMap.channel),sheenRoughnessMapUv:Kn&&N(L.sheenRoughnessMap.channel),specularMapUv:Ei&&N(L.specularMap.channel),specularColorMapUv:Hi&&N(L.specularColorMap.channel),specularIntensityMapUv:li&&N(L.specularIntensityMap.channel),transmissionMapUv:an&&N(L.transmissionMap.channel),thicknessMapUv:Ni&&N(L.thicknessMap.channel),alphaMapUv:Ia&&N(L.alphaMap.channel),vertexTangents:!!ee.attributes.tangent&&(mt||xe),vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!ee.attributes.color&&ee.attributes.color.itemSize===4,pointsUvs:X.isPoints===!0&&!!ee.attributes.uv&&(ln||Ia),fog:!!$,useFog:L.fog===!0,fogExp2:!!$&&$.isFogExp2,flatShading:L.flatShading===!0,sizeAttenuation:L.sizeAttenuation===!0,logarithmicDepthBuffer:C,reverseDepthBuffer:Bt,skinning:X.isSkinnedMesh===!0,morphTargets:ee.morphAttributes.position!==void 0,morphNormals:ee.morphAttributes.normal!==void 0,morphColors:ee.morphAttributes.color!==void 0,morphTargetsCount:ke,morphTextureStride:Et,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numSpotLightMaps:F.spotLightMap.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numDirLightShadows:F.directionalShadowMap.length,numPointLightShadows:F.pointShadowMap.length,numSpotLightShadows:F.spotShadowMap.length,numSpotLightShadowsWithMaps:F.numSpotLightShadowsWithMaps,numLightProbes:F.numLightProbes,numClippingPlanes:u.numPlanes,numClipIntersection:u.numIntersection,dithering:L.dithering,shadowMapEnabled:r.shadowMap.enabled&&O.length>0,shadowMapType:r.shadowMap.type,toneMapping:Cl,decodeVideoTexture:ln&&L.map.isVideoTexture===!0&&Dn.getTransfer(L.map.colorSpace)===Di,decodeVideoTextureEmissive:re&&L.emissiveMap.isVideoTexture===!0&&Dn.getTransfer(L.emissiveMap.colorSpace)===Di,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===Dt,flipSided:L.side===Lt,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionClipCullDistance:mi&&L.extensions.clipCullDistance===!0&&s.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(mi&&L.extensions.multiDraw===!0||Jt)&&s.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:s.has("KHR_parallel_shader_compile"),customProgramCacheKey:L.customProgramCacheKey()};return Cc.vertexUv1s=v.has(1),Cc.vertexUv2s=v.has(2),Cc.vertexUv3s=v.has(3),v.clear(),Cc},getProgramCacheKey:function(L){const F=[];if(L.shaderID?F.push(L.shaderID):(F.push(L.customVertexShaderID),F.push(L.customFragmentShaderID)),L.defines!==void 0)for(const O in L.defines)F.push(O),F.push(L.defines[O]);return L.isRawShaderMaterial===!1&&(function(O,H){O.push(H.precision),O.push(H.outputColorSpace),O.push(H.envMapMode),O.push(H.envMapCubeUVHeight),O.push(H.mapUv),O.push(H.alphaMapUv),O.push(H.lightMapUv),O.push(H.aoMapUv),O.push(H.bumpMapUv),O.push(H.normalMapUv),O.push(H.displacementMapUv),O.push(H.emissiveMapUv),O.push(H.metalnessMapUv),O.push(H.roughnessMapUv),O.push(H.anisotropyMapUv),O.push(H.clearcoatMapUv),O.push(H.clearcoatNormalMapUv),O.push(H.clearcoatRoughnessMapUv),O.push(H.iridescenceMapUv),O.push(H.iridescenceThicknessMapUv),O.push(H.sheenColorMapUv),O.push(H.sheenRoughnessMapUv),O.push(H.specularMapUv),O.push(H.specularColorMapUv),O.push(H.specularIntensityMapUv),O.push(H.transmissionMapUv),O.push(H.thicknessMapUv),O.push(H.combine),O.push(H.fogExp2),O.push(H.sizeAttenuation),O.push(H.morphTargetsCount),O.push(H.morphAttributeCount),O.push(H.numDirLights),O.push(H.numPointLights),O.push(H.numSpotLights),O.push(H.numSpotLightMaps),O.push(H.numHemiLights),O.push(H.numRectAreaLights),O.push(H.numDirLightShadows),O.push(H.numPointLightShadows),O.push(H.numSpotLightShadows),O.push(H.numSpotLightShadowsWithMaps),O.push(H.numLightProbes),O.push(H.shadowMapType),O.push(H.toneMapping),O.push(H.numClippingPlanes),O.push(H.numClipIntersection),O.push(H.depthPacking)}(F,L),function(O,H){A.disableAll(),H.supportsVertexTextures&&A.enable(0),H.instancing&&A.enable(1),H.instancingColor&&A.enable(2),H.instancingMorph&&A.enable(3),H.matcap&&A.enable(4),H.envMap&&A.enable(5),H.normalMapObjectSpace&&A.enable(6),H.normalMapTangentSpace&&A.enable(7),H.clearcoat&&A.enable(8),H.iridescence&&A.enable(9),H.alphaTest&&A.enable(10),H.vertexColors&&A.enable(11),H.vertexAlphas&&A.enable(12),H.vertexUv1s&&A.enable(13),H.vertexUv2s&&A.enable(14),H.vertexUv3s&&A.enable(15),H.vertexTangents&&A.enable(16),H.anisotropy&&A.enable(17),H.alphaHash&&A.enable(18),H.batching&&A.enable(19),H.dispersion&&A.enable(20),H.batchingColor&&A.enable(21),O.push(A.mask),A.disableAll(),H.fog&&A.enable(0),H.useFog&&A.enable(1),H.flatShading&&A.enable(2),H.logarithmicDepthBuffer&&A.enable(3),H.reverseDepthBuffer&&A.enable(4),H.skinning&&A.enable(5),H.morphTargets&&A.enable(6),H.morphNormals&&A.enable(7),H.morphColors&&A.enable(8),H.premultipliedAlpha&&A.enable(9),H.shadowMapEnabled&&A.enable(10),H.doubleSided&&A.enable(11),H.flipSided&&A.enable(12),H.useDepthPacking&&A.enable(13),H.dithering&&A.enable(14),H.transmission&&A.enable(15),H.sheen&&A.enable(16),H.opaque&&A.enable(17),H.pointsUvs&&A.enable(18),H.decodeVideoTexture&&A.enable(19),H.decodeVideoTextureEmissive&&A.enable(20),H.alphaToCoverage&&A.enable(21),H.numMultiviewViews&&A.enable(21),O.push(A.mask)}(F,L),F.push(r.outputColorSpace)),F.push(L.customProgramCacheKey),F.join()},getUniforms:function(L){const F=B[L.type];let O;if(F){const H=Qo[F];O=lp.clone(H.uniforms)}else O=L.uniforms;return O},acquireProgram:function(L,F){let O;for(let H=0,X=E.length;H<X;H++){const $=E[H];if($.cacheKey===F){O=$,++O.usedTimes;break}}return O===void 0&&(O=new gk(r,F,L,c),E.push(O)),O},releaseProgram:function(L){if(--L.usedTimes==0){const F=E.indexOf(L);E[F]=E[E.length-1],E.pop(),L.destroy()}},releaseShaderCache:function(L){m.remove(L)},programs:E,dispose:function(){m.dispose()}}}function _k(){let r=new WeakMap;return{has:function(e){return r.has(e)},get:function(e){let n=r.get(e);return n===void 0&&(n={},r.set(e,n)),n},remove:function(e){r.delete(e)},update:function(e,n,s){r.get(e)[n]=s},dispose:function(){r=new WeakMap}}}function bk(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function pT(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function AT(){const r=[];let e=0;const n=[],s=[],a=[];function c(u,A,m,v,E,C){let M=r[e];return M===void 0?(M={id:u.id,object:u,geometry:A,material:m,groupOrder:v,renderOrder:u.renderOrder,z:E,group:C},r[e]=M):(M.id=u.id,M.object=u,M.geometry=A,M.material=m,M.groupOrder=v,M.renderOrder=u.renderOrder,M.z=E,M.group=C),e++,M}return{opaque:n,transmissive:s,transparent:a,init:function(){e=0,n.length=0,s.length=0,a.length=0},push:function(u,A,m,v,E,C){const M=c(u,A,m,v,E,C);m.transmission>0?s.push(M):m.transparent===!0?a.push(M):n.push(M)},unshift:function(u,A,m,v,E,C){const M=c(u,A,m,v,E,C);m.transmission>0?s.unshift(M):m.transparent===!0?a.unshift(M):n.unshift(M)},finish:function(){for(let u=e,A=r.length;u<A;u++){const m=r[u];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}},sort:function(u,A){n.length>1&&n.sort(u||bk),s.length>1&&s.sort(A||pT),a.length>1&&a.sort(A||pT)}}}function Ck(){let r=new WeakMap;return{get:function(e,n){const s=r.get(e);let a;return s===void 0?(a=new AT,r.set(e,[a])):n>=s.length?(a=new AT,s.push(a)):a=s[n],a},dispose:function(){r=new WeakMap}}}function wk(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new R,color:new Mt};break;case"SpotLight":n={position:new R,direction:new R,color:new Mt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new R,color:new Mt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new R,skyColor:new Mt,groundColor:new Mt};break;case"RectAreaLight":n={color:new Mt,position:new R,halfWidth:new R,halfHeight:new R}}return r[e.id]=n,n}}}let Mk=0;function Sk(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function Ik(r){const e=new wk,n=function(){const A={};return{get:function(m){if(A[m.id]!==void 0)return A[m.id];let v;switch(m.type){case"DirectionalLight":case"SpotLight":v={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct};break;case"PointLight":v={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ct,shadowCameraNear:1,shadowCameraFar:1e3}}return A[m.id]=v,v}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let A=0;A<9;A++)s.probe.push(new R);const a=new R,c=new Qt,u=new Qt;return{setup:function(A){let m=0,v=0,E=0;for(let ie=0;ie<9;ie++)s.probe[ie].set(0,0,0);let C=0,M=0,S=0,B=0,N=0,L=0,F=0,O=0,H=0,X=0,$=0;A.sort(Sk);for(let ie=0,ce=A.length;ie<ce;ie++){const oe=A[ie],Se=oe.color,Ne=oe.intensity,ke=oe.distance,Oe=oe.shadow&&oe.shadow.map?oe.shadow.map.texture:null;if(oe.isAmbientLight)m+=Se.r*Ne,v+=Se.g*Ne,E+=Se.b*Ne;else if(oe.isLightProbe){for(let Te=0;Te<9;Te++)s.probe[Te].addScaledVector(oe.sh.coefficients[Te],Ne);$++}else if(oe.isDirectionalLight){const Te=e.get(oe);if(Te.color.copy(oe.color).multiplyScalar(oe.intensity),oe.castShadow){const Je=oe.shadow,st=n.get(oe);st.shadowIntensity=Je.intensity,st.shadowBias=Je.bias,st.shadowNormalBias=Je.normalBias,st.shadowRadius=Je.radius,st.shadowMapSize=Je.mapSize,s.directionalShadow[C]=st,s.directionalShadowMap[C]=Oe,s.directionalShadowMatrix[C]=oe.shadow.matrix,L++}s.directional[C]=Te,C++}else if(oe.isSpotLight){const Te=e.get(oe);Te.position.setFromMatrixPosition(oe.matrixWorld),Te.color.copy(Se).multiplyScalar(Ne),Te.distance=ke,Te.coneCos=Math.cos(oe.angle),Te.penumbraCos=Math.cos(oe.angle*(1-oe.penumbra)),Te.decay=oe.decay,s.spot[S]=Te;const Je=oe.shadow;if(oe.map&&(s.spotLightMap[H]=oe.map,H++,Je.updateMatrices(oe),oe.castShadow&&X++),s.spotLightMatrix[S]=Je.matrix,oe.castShadow){const st=n.get(oe);st.shadowIntensity=Je.intensity,st.shadowBias=Je.bias,st.shadowNormalBias=Je.normalBias,st.shadowRadius=Je.radius,st.shadowMapSize=Je.mapSize,s.spotShadow[S]=st,s.spotShadowMap[S]=Oe,O++}S++}else if(oe.isRectAreaLight){const Te=e.get(oe);Te.color.copy(Se).multiplyScalar(Ne),Te.halfWidth.set(.5*oe.width,0,0),Te.halfHeight.set(0,.5*oe.height,0),s.rectArea[B]=Te,B++}else if(oe.isPointLight){const Te=e.get(oe);if(Te.color.copy(oe.color).multiplyScalar(oe.intensity),Te.distance=oe.distance,Te.decay=oe.decay,oe.castShadow){const Je=oe.shadow,st=n.get(oe);st.shadowIntensity=Je.intensity,st.shadowBias=Je.bias,st.shadowNormalBias=Je.normalBias,st.shadowRadius=Je.radius,st.shadowMapSize=Je.mapSize,st.shadowCameraNear=Je.camera.near,st.shadowCameraFar=Je.camera.far,s.pointShadow[M]=st,s.pointShadowMap[M]=Oe,s.pointShadowMatrix[M]=oe.shadow.matrix,F++}s.point[M]=Te,M++}else if(oe.isHemisphereLight){const Te=e.get(oe);Te.skyColor.copy(oe.color).multiplyScalar(Ne),Te.groundColor.copy(oe.groundColor).multiplyScalar(Ne),s.hemi[N]=Te,N++}}B>0&&(r.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Ft.LTC_FLOAT_1,s.rectAreaLTC2=Ft.LTC_FLOAT_2):(s.rectAreaLTC1=Ft.LTC_HALF_1,s.rectAreaLTC2=Ft.LTC_HALF_2)),s.ambient[0]=m,s.ambient[1]=v,s.ambient[2]=E;const ee=s.hash;ee.directionalLength===C&&ee.pointLength===M&&ee.spotLength===S&&ee.rectAreaLength===B&&ee.hemiLength===N&&ee.numDirectionalShadows===L&&ee.numPointShadows===F&&ee.numSpotShadows===O&&ee.numSpotMaps===H&&ee.numLightProbes===$||(s.directional.length=C,s.spot.length=S,s.rectArea.length=B,s.point.length=M,s.hemi.length=N,s.directionalShadow.length=L,s.directionalShadowMap.length=L,s.pointShadow.length=F,s.pointShadowMap.length=F,s.spotShadow.length=O,s.spotShadowMap.length=O,s.directionalShadowMatrix.length=L,s.pointShadowMatrix.length=F,s.spotLightMatrix.length=O+H-X,s.spotLightMap.length=H,s.numSpotLightShadowsWithMaps=X,s.numLightProbes=$,ee.directionalLength=C,ee.pointLength=M,ee.spotLength=S,ee.rectAreaLength=B,ee.hemiLength=N,ee.numDirectionalShadows=L,ee.numPointShadows=F,ee.numSpotShadows=O,ee.numSpotMaps=H,ee.numLightProbes=$,s.version=Mk++)},setupView:function(A,m){let v=0,E=0,C=0,M=0,S=0;const B=m.matrixWorldInverse;for(let N=0,L=A.length;N<L;N++){const F=A[N];if(F.isDirectionalLight){const O=s.directional[v];O.direction.setFromMatrixPosition(F.matrixWorld),a.setFromMatrixPosition(F.target.matrixWorld),O.direction.sub(a),O.direction.transformDirection(B),v++}else if(F.isSpotLight){const O=s.spot[C];O.position.setFromMatrixPosition(F.matrixWorld),O.position.applyMatrix4(B),O.direction.setFromMatrixPosition(F.matrixWorld),a.setFromMatrixPosition(F.target.matrixWorld),O.direction.sub(a),O.direction.transformDirection(B),C++}else if(F.isRectAreaLight){const O=s.rectArea[M];O.position.setFromMatrixPosition(F.matrixWorld),O.position.applyMatrix4(B),u.identity(),c.copy(F.matrixWorld),c.premultiply(B),u.extractRotation(c),O.halfWidth.set(.5*F.width,0,0),O.halfHeight.set(0,.5*F.height,0),O.halfWidth.applyMatrix4(u),O.halfHeight.applyMatrix4(u),M++}else if(F.isPointLight){const O=s.point[E];O.position.setFromMatrixPosition(F.matrixWorld),O.position.applyMatrix4(B),E++}else if(F.isHemisphereLight){const O=s.hemi[S];O.direction.setFromMatrixPosition(F.matrixWorld),O.direction.transformDirection(B),S++}}},state:s}}function fT(r){const e=new Ik(r),n=[],s=[],a={lightsArray:n,shadowsArray:s,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(c){a.camera=c,n.length=0,s.length=0},state:a,setupLights:function(){e.setup(n)},setupLightsView:function(c){e.setupView(n,c)},pushLight:function(c){n.push(c)},pushShadow:function(c){s.push(c)}}}function Tk(r){let e=new WeakMap;return{get:function(n,s=0){const a=e.get(n);let c;return a===void 0?(c=new fT(r),e.set(n,[c])):s>=a.length?(c=new fT(r),a.push(c)):c=a[s],c},dispose:function(){e=new WeakMap}}}function Bk(r,e,n){let s=new If;const a=new ct,c=new ct,u=new pi,A=new c_({depthPacking:Pg}),m=new h_,v={},E=n.maxTextureSize,C={[ut]:Lt,[Lt]:ut,[Dt]:Dt},M=new Ca({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ct},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),S=M.clone();S.defines.HORIZONTAL_PASS=1;const B=new vn;B.setAttribute("position",new qn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const N=new Ti(B,M),L=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=qe;let F=this.type;function O(ee,ie){const ce=e.update(N);M.defines.VSM_SAMPLES!==ee.blurSamples&&(M.defines.VSM_SAMPLES=ee.blurSamples,S.defines.VSM_SAMPLES=ee.blurSamples,M.needsUpdate=!0,S.needsUpdate=!0),ee.mapPass===null&&(ee.mapPass=new Us(a.x,a.y)),M.uniforms.shadow_pass.value=ee.map.texture,M.uniforms.resolution.value=ee.mapSize,M.uniforms.radius.value=ee.radius,r.setRenderTarget(ee.mapPass),r.clear(),r.renderBufferDirect(ie,null,ce,M,N,null),S.uniforms.shadow_pass.value=ee.mapPass.texture,S.uniforms.resolution.value=ee.mapSize,S.uniforms.radius.value=ee.radius,r.setRenderTarget(ee.map),r.clear(),r.renderBufferDirect(ie,null,ce,S,N,null)}function H(ee,ie,ce,oe){let Se=null;const Ne=ce.isPointLight===!0?ee.customDistanceMaterial:ee.customDepthMaterial;if(Ne!==void 0)Se=Ne;else if(Se=ce.isPointLight===!0?m:A,r.localClippingEnabled&&ie.clipShadows===!0&&Array.isArray(ie.clippingPlanes)&&ie.clippingPlanes.length!==0||ie.displacementMap&&ie.displacementScale!==0||ie.alphaMap&&ie.alphaTest>0||ie.map&&ie.alphaTest>0){const ke=Se.uuid,Oe=ie.uuid;let Te=v[ke];Te===void 0&&(Te={},v[ke]=Te);let Je=Te[Oe];Je===void 0&&(Je=Se.clone(),Te[Oe]=Je,ie.addEventListener("dispose",$)),Se=Je}return Se.visible=ie.visible,Se.wireframe=ie.wireframe,Se.side=oe===He?ie.shadowSide!==null?ie.shadowSide:ie.side:ie.shadowSide!==null?ie.shadowSide:C[ie.side],Se.alphaMap=ie.alphaMap,Se.alphaTest=ie.alphaTest,Se.map=ie.map,Se.clipShadows=ie.clipShadows,Se.clippingPlanes=ie.clippingPlanes,Se.clipIntersection=ie.clipIntersection,Se.displacementMap=ie.displacementMap,Se.displacementScale=ie.displacementScale,Se.displacementBias=ie.displacementBias,Se.wireframeLinewidth=ie.wireframeLinewidth,Se.linewidth=ie.linewidth,ce.isPointLight===!0&&Se.isMeshDistanceMaterial===!0&&(r.properties.get(Se).light=ce),Se}function X(ee,ie,ce,oe,Se){if(ee.visible===!1)return;if(ee.layers.test(ie.layers)&&(ee.isMesh||ee.isLine||ee.isPoints)&&(ee.castShadow||ee.receiveShadow&&Se===He)&&(!ee.frustumCulled||s.intersectsObject(ee))){ee.modelViewMatrix.multiplyMatrices(ce.matrixWorldInverse,ee.matrixWorld);const ke=e.update(ee),Oe=ee.material;if(Array.isArray(Oe)){const Te=ke.groups;for(let Je=0,st=Te.length;Je<st;Je++){const Et=Te[Je],dt=Oe[Et.materialIndex];if(dt&&dt.visible){const Bt=H(ee,dt,oe,Se);ee.onBeforeShadow(r,ee,ie,ce,ke,Bt,Et),r.renderBufferDirect(ce,null,ke,Bt,ee,Et),ee.onAfterShadow(r,ee,ie,ce,ke,Bt,Et)}}}else if(Oe.visible){const Te=H(ee,Oe,oe,Se);ee.onBeforeShadow(r,ee,ie,ce,ke,Te,null),r.renderBufferDirect(ce,null,ke,Te,ee,null),ee.onAfterShadow(r,ee,ie,ce,ke,Te,null)}}const Ne=ee.children;for(let ke=0,Oe=Ne.length;ke<Oe;ke++)X(Ne[ke],ie,ce,oe,Se)}function $(ee){ee.target.removeEventListener("dispose",$);for(const ie in v){const ce=v[ie],oe=ee.target.uuid;oe in ce&&(ce[oe].dispose(),delete ce[oe])}}this.render=function(ee,ie,ce){if(L.enabled===!1||L.autoUpdate===!1&&L.needsUpdate===!1||ee.length===0)return;const oe=r.getRenderTarget(),Se=r.getActiveCubeFace(),Ne=r.getActiveMipmapLevel(),ke=r.state;ke.setBlending(Yt),ke.buffers.color.setClear(1,1,1,1),ke.buffers.depth.setTest(!0),ke.setScissorTest(!1);const Oe=F!==He&&this.type===He,Te=F===He&&this.type!==He;for(let Je=0,st=ee.length;Je<st;Je++){const Et=ee[Je],dt=Et.shadow;if(dt===void 0){console.warn("THREE.WebGLShadowMap:",Et,"has no shadow.");continue}if(dt.autoUpdate===!1&&dt.needsUpdate===!1)continue;a.copy(dt.mapSize);const Bt=dt.getFrameExtents();if(a.multiply(Bt),c.copy(dt.mapSize),(a.x>E||a.y>E)&&(a.x>E&&(c.x=Math.floor(E/Bt.x),a.x=c.x*Bt.x,dt.mapSize.x=c.x),a.y>E&&(c.y=Math.floor(E/Bt.y),a.y=c.y*Bt.y,dt.mapSize.y=c.y)),dt.map===null||Oe===!0||Te===!0){const Kt=this.type!==He?{minFilter:yr,magFilter:yr}:{};dt.map!==null&&dt.map.dispose(),dt.map=new Us(a.x,a.y,Kt),dt.map.texture.name=Et.name+".shadowMap",dt.camera.updateProjectionMatrix()}r.setRenderTarget(dt.map),r.clear();const qt=dt.getViewportCount();for(let Kt=0;Kt<qt;Kt++){const Jt=dt.getViewport(Kt);u.set(c.x*Jt.x,c.y*Jt.y,c.x*Jt.z,c.y*Jt.w),ke.viewport(u),dt.updateMatrices(Et,Kt),s=dt.getFrustum(),X(ie,ce,dt.camera,Et,this.type)}dt.isPointLightShadow!==!0&&this.type===He&&O(dt,ce),dt.needsUpdate=!1}F=this.type,L.needsUpdate=!1,r.setRenderTarget(oe,Se,Ne)}}const Rk={[Bn]:Da,[Qr]:Co,[Aa]:di,[cs]:fa,[Da]:Bn,[Co]:Qr,[di]:Aa,[fa]:cs};function Lk(r,e){const n=new function(){let W=!1;const ae=new pi;let xe=null;const ge=new pi(0,0,0,0);return{setMask:function(Ee){xe===Ee||W||(r.colorMask(Ee,Ee,Ee,Ee),xe=Ee)},setLocked:function(Ee){W=Ee},setClear:function(Ee,Ue,Xe,at,Xt){Xt===!0&&(Ee*=at,Ue*=at,Xe*=at),ae.set(Ee,Ue,Xe,at),ge.equals(ae)===!1&&(r.clearColor(Ee,Ue,Xe,at),ge.copy(ae))},reset:function(){W=!1,xe=null,ge.set(-1,0,0,0)}}},s=new function(){let W=!1,ae=!1,xe=null,ge=null,Ee=null;return{setReversed:function(Ue){if(ae!==Ue){const Xe=e.get("EXT_clip_control");ae?Xe.clipControlEXT(Xe.LOWER_LEFT_EXT,Xe.ZERO_TO_ONE_EXT):Xe.clipControlEXT(Xe.LOWER_LEFT_EXT,Xe.NEGATIVE_ONE_TO_ONE_EXT);const at=Ee;Ee=null,this.setClear(at)}ae=Ue},getReversed:function(){return ae},setTest:function(Ue){Ue?Ot(r.DEPTH_TEST):nt(r.DEPTH_TEST)},setMask:function(Ue){xe===Ue||W||(r.depthMask(Ue),xe=Ue)},setFunc:function(Ue){if(ae&&(Ue=Rk[Ue]),ge!==Ue){switch(Ue){case Bn:r.depthFunc(r.NEVER);break;case Da:r.depthFunc(r.ALWAYS);break;case Qr:r.depthFunc(r.LESS);break;case cs:r.depthFunc(r.LEQUAL);break;case Aa:r.depthFunc(r.EQUAL);break;case fa:r.depthFunc(r.GEQUAL);break;case Co:r.depthFunc(r.GREATER);break;case di:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}ge=Ue}},setLocked:function(Ue){W=Ue},setClear:function(Ue){Ee!==Ue&&(ae&&(Ue=1-Ue),r.clearDepth(Ue),Ee=Ue)},reset:function(){W=!1,xe=null,ge=null,Ee=null,ae=!1}}},a=new function(){let W=!1,ae=null,xe=null,ge=null,Ee=null,Ue=null,Xe=null,at=null,Xt=null;return{setTest:function(gt){W||(gt?Ot(r.STENCIL_TEST):nt(r.STENCIL_TEST))},setMask:function(gt){ae===gt||W||(r.stencilMask(gt),ae=gt)},setFunc:function(gt,cn,yn){xe===gt&&ge===cn&&Ee===yn||(r.stencilFunc(gt,cn,yn),xe=gt,ge=cn,Ee=yn)},setOp:function(gt,cn,yn){Ue===gt&&Xe===cn&&at===yn||(r.stencilOp(gt,cn,yn),Ue=gt,Xe=cn,at=yn)},setLocked:function(gt){W=gt},setClear:function(gt){Xt!==gt&&(r.clearStencil(gt),Xt=gt)},reset:function(){W=!1,ae=null,xe=null,ge=null,Ee=null,Ue=null,Xe=null,at=null,Xt=null}}},c=new WeakMap,u=new WeakMap;let A={},m={},v=new WeakMap,E=[],C=null,M=!1,S=null,B=null,N=null,L=null,F=null,O=null,H=null,X=new Mt(0,0,0),$=0,ee=!1,ie=null,ce=null,oe=null,Se=null,Ne=null;const ke=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Oe=!1,Te=0;const Je=r.getParameter(r.VERSION);Je.indexOf("WebGL")!==-1?(Te=parseFloat(/^WebGL (\d)/.exec(Je)[1]),Oe=Te>=1):Je.indexOf("OpenGL ES")!==-1&&(Te=parseFloat(/^OpenGL ES (\d)/.exec(Je)[1]),Oe=Te>=2);let st=null,Et={};const dt=r.getParameter(r.SCISSOR_BOX),Bt=r.getParameter(r.VIEWPORT),qt=new pi().fromArray(dt),Kt=new pi().fromArray(Bt);function Jt(W,ae,xe,ge){const Ee=new Uint8Array(4),Ue=r.createTexture();r.bindTexture(W,Ue),r.texParameteri(W,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(W,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Xe=0;Xe<xe;Xe++)W===r.TEXTURE_3D||W===r.TEXTURE_2D_ARRAY?r.texImage3D(ae,0,r.RGBA,1,1,ge,0,r.RGBA,r.UNSIGNED_BYTE,Ee):r.texImage2D(ae+Xe,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,Ee);return Ue}const ln={};function Ot(W){A[W]!==!0&&(r.enable(W),A[W]=!0)}function nt(W){A[W]!==!1&&(r.disable(W),A[W]=!1)}ln[r.TEXTURE_2D]=Jt(r.TEXTURE_2D,r.TEXTURE_2D,1),ln[r.TEXTURE_CUBE_MAP]=Jt(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),ln[r.TEXTURE_2D_ARRAY]=Jt(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),ln[r.TEXTURE_3D]=Jt(r.TEXTURE_3D,r.TEXTURE_3D,1,1),n.setClear(0,0,0,1),s.setClear(1),a.setClear(0),Ot(r.DEPTH_TEST),s.setFunc(cs),mt(!1),vt(al),Ot(r.CULL_FACE),It(Yt);const Rt={[ui]:r.FUNC_ADD,[tr]:r.FUNC_SUBTRACT,[Li]:r.FUNC_REVERSE_SUBTRACT};Rt[$n]=r.MIN,Rt[Gi]=r.MAX;const jt={[vr]:r.ZERO,[Ln]:r.ONE,[xn]:r.SRC_COLOR,[Vl]:r.SRC_ALPHA,[_s]:r.SRC_ALPHA_SATURATE,[ls]:r.DST_COLOR,[ol]:r.DST_ALPHA,[xs]:r.ONE_MINUS_SRC_COLOR,[Wl]:r.ONE_MINUS_SRC_ALPHA,[eo]:r.ONE_MINUS_DST_COLOR,[Ws]:r.ONE_MINUS_DST_ALPHA,[Yc]:r.CONSTANT_COLOR,[jl]:r.ONE_MINUS_CONSTANT_COLOR,[Rs]:r.CONSTANT_ALPHA,[to]:r.ONE_MINUS_CONSTANT_ALPHA};function It(W,ae,xe,ge,Ee,Ue,Xe,at,Xt,gt){if(W!==Yt){if(M===!1&&(Ot(r.BLEND),M=!0),W===Ki)Ee=Ee||ae,Ue=Ue||xe,Xe=Xe||ge,ae===B&&Ee===F||(r.blendEquationSeparate(Rt[ae],Rt[Ee]),B=ae,F=Ee),xe===N&&ge===L&&Ue===O&&Xe===H||(r.blendFuncSeparate(jt[xe],jt[ge],jt[Ue],jt[Xe]),N=xe,L=ge,O=Ue,H=Xe),at.equals(X)!==!1&&Xt===$||(r.blendColor(at.r,at.g,at.b,Xt),X.copy(at),$=Xt),S=W,ee=!1;else if(W!==S||gt!==ee){if(B===ui&&F===ui||(r.blendEquation(r.FUNC_ADD),B=ui,F=ui),gt)switch(W){case rn:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case An:r.blendFunc(r.ONE,r.ONE);break;case dn:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Tn:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",W)}else switch(W){case rn:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case An:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case dn:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Tn:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",W)}N=null,L=null,O=null,H=null,X.set(0,0,0),$=0,S=W,ee=gt}}else M===!0&&(nt(r.BLEND),M=!1)}function mt(W){ie!==W&&(W?r.frontFace(r.CW):r.frontFace(r.CCW),ie=W)}function vt(W){W!==zl?(Ot(r.CULL_FACE),W!==ce&&(W===al?r.cullFace(r.BACK):W===Jh?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):nt(r.CULL_FACE),ce=W}function re(W,ae,xe){W?(Ot(r.POLYGON_OFFSET_FILL),Se===ae&&Ne===xe||(r.polygonOffset(ae,xe),Se=ae,Ne=xe)):nt(r.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:s,stencil:a},enable:Ot,disable:nt,bindFramebuffer:function(W,ae){return m[W]!==ae&&(r.bindFramebuffer(W,ae),m[W]=ae,W===r.DRAW_FRAMEBUFFER&&(m[r.FRAMEBUFFER]=ae),W===r.FRAMEBUFFER&&(m[r.DRAW_FRAMEBUFFER]=ae),!0)},drawBuffers:function(W,ae){let xe=E,ge=!1;if(W){xe=v.get(ae),xe===void 0&&(xe=[],v.set(ae,xe));const Ee=W.textures;if(xe.length!==Ee.length||xe[0]!==r.COLOR_ATTACHMENT0){for(let Ue=0,Xe=Ee.length;Ue<Xe;Ue++)xe[Ue]=r.COLOR_ATTACHMENT0+Ue;xe.length=Ee.length,ge=!0}}else xe[0]!==r.BACK&&(xe[0]=r.BACK,ge=!0);ge&&r.drawBuffers(xe)},useProgram:function(W){return C!==W&&(r.useProgram(W),C=W,!0)},setBlending:It,setMaterial:function(W,ae){W.side===Dt?nt(r.CULL_FACE):Ot(r.CULL_FACE);let xe=W.side===Lt;ae&&(xe=!xe),mt(xe),W.blending===rn&&W.transparent===!1?It(Yt):It(W.blending,W.blendEquation,W.blendSrc,W.blendDst,W.blendEquationAlpha,W.blendSrcAlpha,W.blendDstAlpha,W.blendColor,W.blendAlpha,W.premultipliedAlpha),s.setFunc(W.depthFunc),s.setTest(W.depthTest),s.setMask(W.depthWrite),n.setMask(W.colorWrite);const ge=W.stencilWrite;a.setTest(ge),ge&&(a.setMask(W.stencilWriteMask),a.setFunc(W.stencilFunc,W.stencilRef,W.stencilFuncMask),a.setOp(W.stencilFail,W.stencilZFail,W.stencilZPass)),re(W.polygonOffset,W.polygonOffsetFactor,W.polygonOffsetUnits),W.alphaToCoverage===!0?Ot(r.SAMPLE_ALPHA_TO_COVERAGE):nt(r.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:mt,setCullFace:vt,setLineWidth:function(W){W!==oe&&(Oe&&r.lineWidth(W),oe=W)},setPolygonOffset:re,setScissorTest:function(W){W?Ot(r.SCISSOR_TEST):nt(r.SCISSOR_TEST)},activeTexture:function(W){W===void 0&&(W=r.TEXTURE0+ke-1),st!==W&&(r.activeTexture(W),st=W)},bindTexture:function(W,ae,xe){xe===void 0&&(xe=st===null?r.TEXTURE0+ke-1:st);let ge=Et[xe];ge===void 0&&(ge={type:void 0,texture:void 0},Et[xe]=ge),ge.type===W&&ge.texture===ae||(st!==xe&&(r.activeTexture(xe),st=xe),r.bindTexture(W,ae||ln[W]),ge.type=W,ge.texture=ae)},unbindTexture:function(){const W=Et[st];W!==void 0&&W.type!==void 0&&(r.bindTexture(W.type,null),W.type=void 0,W.texture=void 0)},compressedTexImage2D:function(){try{r.compressedTexImage2D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},compressedTexImage3D:function(){try{r.compressedTexImage3D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},texImage2D:function(){try{r.texImage2D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},texImage3D:function(){try{r.texImage3D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},updateUBOMapping:function(W,ae){let xe=u.get(ae);xe===void 0&&(xe=new WeakMap,u.set(ae,xe));let ge=xe.get(W);ge===void 0&&(ge=r.getUniformBlockIndex(ae,W.name),xe.set(W,ge))},uniformBlockBinding:function(W,ae){const xe=u.get(ae).get(W);c.get(ae)!==xe&&(r.uniformBlockBinding(ae,xe,W.__bindingPointIndex),c.set(ae,xe))},texStorage2D:function(){try{r.texStorage2D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},texStorage3D:function(){try{r.texStorage3D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},texSubImage2D:function(){try{r.texSubImage2D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},texSubImage3D:function(){try{r.texSubImage3D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},compressedTexSubImage2D:function(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},compressedTexSubImage3D:function(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(W){console.error("THREE.WebGLState:",W)}},scissor:function(W){qt.equals(W)===!1&&(r.scissor(W.x,W.y,W.z,W.w),qt.copy(W))},viewport:function(W){Kt.equals(W)===!1&&(r.viewport(W.x,W.y,W.z,W.w),Kt.copy(W))},reset:function(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),s.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),A={},st=null,Et={},m={},v=new WeakMap,E=[],C=null,M=!1,S=null,B=null,N=null,L=null,F=null,O=null,H=null,X=new Mt(0,0,0),$=0,ee=!1,ie=null,ce=null,oe=null,Se=null,Ne=null,qt.set(0,0,r.canvas.width,r.canvas.height),Kt.set(0,0,r.canvas.width,r.canvas.height),n.reset(),s.reset(),a.reset()}}}function Dk(r,e,n,s,a,c,u){const A=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),v=e.has("OCULUS_multiview")?e.get("OCULUS_multiview"):null,E=new ct,C=new WeakMap;let M;const S=new WeakMap;let B=[],N=!1,L=!1;try{L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function F(re,W){return L?new OffscreenCanvas(re,W):lh("canvas")}function O(re,W,ae){let xe=1;const ge=vt(re);if((ge.width>ae||ge.height>ae)&&(xe=ae/Math.max(ge.width,ge.height)),xe<1){if(typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&re instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&re instanceof ImageBitmap||typeof VideoFrame<"u"&&re instanceof VideoFrame){const Ee=Math.floor(xe*ge.width),Ue=Math.floor(xe*ge.height);M===void 0&&(M=F(Ee,Ue));const Xe=W?F(Ee,Ue):M;return Xe.width=Ee,Xe.height=Ue,Xe.getContext("2d").drawImage(re,0,0,Ee,Ue),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ge.width+"x"+ge.height+") to ("+Ee+"x"+Ue+")."),Xe}return"data"in re&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ge.width+"x"+ge.height+")."),re}return re}function H(re){return re.generateMipmaps}function X(re){r.generateMipmap(re)}function $(re){return re.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:re.isWebGL3DRenderTarget?r.TEXTURE_3D:re.isWebGLArrayRenderTarget||re.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function ee(re,W,ae,xe,ge=!1){if(re!==null){if(r[re]!==void 0)return r[re];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+re+"'")}let Ee=W;if(W===r.RED&&(ae===r.FLOAT&&(Ee=r.R32F),ae===r.HALF_FLOAT&&(Ee=r.R16F),ae===r.UNSIGNED_BYTE&&(Ee=r.R8)),W===r.RED_INTEGER&&(ae===r.UNSIGNED_BYTE&&(Ee=r.R8UI),ae===r.UNSIGNED_SHORT&&(Ee=r.R16UI),ae===r.UNSIGNED_INT&&(Ee=r.R32UI),ae===r.BYTE&&(Ee=r.R8I),ae===r.SHORT&&(Ee=r.R16I),ae===r.INT&&(Ee=r.R32I)),W===r.RG&&(ae===r.FLOAT&&(Ee=r.RG32F),ae===r.HALF_FLOAT&&(Ee=r.RG16F),ae===r.UNSIGNED_BYTE&&(Ee=r.RG8)),W===r.RG_INTEGER&&(ae===r.UNSIGNED_BYTE&&(Ee=r.RG8UI),ae===r.UNSIGNED_SHORT&&(Ee=r.RG16UI),ae===r.UNSIGNED_INT&&(Ee=r.RG32UI),ae===r.BYTE&&(Ee=r.RG8I),ae===r.SHORT&&(Ee=r.RG16I),ae===r.INT&&(Ee=r.RG32I)),W===r.RGB_INTEGER&&(ae===r.UNSIGNED_BYTE&&(Ee=r.RGB8UI),ae===r.UNSIGNED_SHORT&&(Ee=r.RGB16UI),ae===r.UNSIGNED_INT&&(Ee=r.RGB32UI),ae===r.BYTE&&(Ee=r.RGB8I),ae===r.SHORT&&(Ee=r.RGB16I),ae===r.INT&&(Ee=r.RGB32I)),W===r.RGBA_INTEGER&&(ae===r.UNSIGNED_BYTE&&(Ee=r.RGBA8UI),ae===r.UNSIGNED_SHORT&&(Ee=r.RGBA16UI),ae===r.UNSIGNED_INT&&(Ee=r.RGBA32UI),ae===r.BYTE&&(Ee=r.RGBA8I),ae===r.SHORT&&(Ee=r.RGBA16I),ae===r.INT&&(Ee=r.RGBA32I)),W===r.RGB&&ae===r.UNSIGNED_INT_5_9_9_9_REV&&(Ee=r.RGB9_E5),W===r.RGBA){const Ue=ge?ah:Dn.getTransfer(xe);ae===r.FLOAT&&(Ee=r.RGBA32F),ae===r.HALF_FLOAT&&(Ee=r.RGBA16F),ae===r.UNSIGNED_BYTE&&(Ee=Ue===Di?r.SRGB8_ALPHA8:r.RGBA8),ae===r.UNSIGNED_SHORT_4_4_4_4&&(Ee=r.RGBA4),ae===r.UNSIGNED_SHORT_5_5_5_1&&(Ee=r.RGB5_A1)}return Ee!==r.R16F&&Ee!==r.R32F&&Ee!==r.RG16F&&Ee!==r.RG32F&&Ee!==r.RGBA16F&&Ee!==r.RGBA32F||e.get("EXT_color_buffer_float"),Ee}function ie(re,W){let ae;return re?W===null||W===So||W===hl?ae=r.DEPTH24_STENCIL8:W===Ir?ae=r.DEPTH32F_STENCIL8:W===cl&&(ae=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):W===null||W===So||W===hl?ae=r.DEPTH_COMPONENT24:W===Ir?ae=r.DEPTH_COMPONENT32F:W===cl&&(ae=r.DEPTH_COMPONENT16),ae}function ce(re,W){return H(re)===!0||re.isFramebufferTexture&&re.minFilter!==yr&&re.minFilter!==bi?Math.log2(Math.max(W.width,W.height))+1:re.mipmaps!==void 0&&re.mipmaps.length>0?re.mipmaps.length:re.isCompressedTexture&&Array.isArray(re.image)?W.mipmaps.length:1}function oe(re){const W=re.target;W.removeEventListener("dispose",oe),function(ae){const xe=s.get(ae);if(xe.__webglInit===void 0)return;const ge=ae.source,Ee=S.get(ge);if(Ee){const Ue=Ee[xe.__cacheKey];Ue.usedTimes--,Ue.usedTimes===0&&Ne(ae),Object.keys(Ee).length===0&&S.delete(ge)}s.remove(ae)}(W),W.isVideoTexture&&C.delete(W)}function Se(re){const W=re.target;W.removeEventListener("dispose",Se),function(ae){const xe=s.get(ae);if(ae.depthTexture&&(ae.depthTexture.dispose(),s.remove(ae.depthTexture)),ae.isWebGLCubeRenderTarget)for(let Ee=0;Ee<6;Ee++){if(Array.isArray(xe.__webglFramebuffer[Ee]))for(let Ue=0;Ue<xe.__webglFramebuffer[Ee].length;Ue++)r.deleteFramebuffer(xe.__webglFramebuffer[Ee][Ue]);else r.deleteFramebuffer(xe.__webglFramebuffer[Ee]);xe.__webglDepthbuffer&&r.deleteRenderbuffer(xe.__webglDepthbuffer[Ee])}else{if(Array.isArray(xe.__webglFramebuffer))for(let Ee=0;Ee<xe.__webglFramebuffer.length;Ee++)r.deleteFramebuffer(xe.__webglFramebuffer[Ee]);else r.deleteFramebuffer(xe.__webglFramebuffer);if(xe.__webglDepthbuffer&&r.deleteRenderbuffer(xe.__webglDepthbuffer),xe.__webglMultisampledFramebuffer&&r.deleteFramebuffer(xe.__webglMultisampledFramebuffer),xe.__webglColorRenderbuffer)for(let Ee=0;Ee<xe.__webglColorRenderbuffer.length;Ee++)xe.__webglColorRenderbuffer[Ee]&&r.deleteRenderbuffer(xe.__webglColorRenderbuffer[Ee]);xe.__webglDepthRenderbuffer&&r.deleteRenderbuffer(xe.__webglDepthRenderbuffer)}const ge=ae.textures;for(let Ee=0,Ue=ge.length;Ee<Ue;Ee++){const Xe=s.get(ge[Ee]);Xe.__webglTexture&&(r.deleteTexture(Xe.__webglTexture),u.memory.textures--),s.remove(ge[Ee])}s.remove(ae)}(W)}function Ne(re){const W=s.get(re);r.deleteTexture(W.__webglTexture);const ae=re.source;delete S.get(ae)[W.__cacheKey],u.memory.textures--}let ke=0;function Oe(re,W){const ae=s.get(re);if(re.isVideoTexture&&function(xe){const ge=u.render.frame;C.get(xe)!==ge&&(C.set(xe,ge),xe.update())}(re),re.isRenderTargetTexture===!1&&re.version>0&&ae.__version!==re.version){const xe=re.image;if(xe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(xe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(qt(ae,re,W))return}n.bindTexture(r.TEXTURE_2D,ae.__webglTexture,r.TEXTURE0+W)}function Te(re,W){const ae=s.get(re);re.version>0&&ae.__version!==re.version?qt(ae,re,W):n.bindTexture(r.TEXTURE_2D_ARRAY,ae.__webglTexture,r.TEXTURE0+W)}const Je={[ga]:r.REPEAT,[Dr]:r.CLAMP_TO_EDGE,[ll]:r.MIRRORED_REPEAT},st={[yr]:r.NEAREST,[$h]:r.NEAREST_MIPMAP_NEAREST,[Mo]:r.NEAREST_MIPMAP_LINEAR,[bi]:r.LINEAR,[Ua]:r.LINEAR_MIPMAP_NEAREST,[hs]:r.LINEAR_MIPMAP_LINEAR},Et={[kg]:r.NEVER,[oh]:r.ALWAYS,[Qg]:r.LESS,[yu]:r.LEQUAL,[Gg]:r.EQUAL,[af]:r.GEQUAL,[Eu]:r.GREATER,[sf]:r.NOTEQUAL};function dt(re,W){if(W.type!==Ir||e.has("OES_texture_float_linear")!==!1||W.magFilter!==bi&&W.magFilter!==Ua&&W.magFilter!==Mo&&W.magFilter!==hs&&W.minFilter!==bi&&W.minFilter!==Ua&&W.minFilter!==Mo&&W.minFilter!==hs||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(re,r.TEXTURE_WRAP_S,Je[W.wrapS]),r.texParameteri(re,r.TEXTURE_WRAP_T,Je[W.wrapT]),re!==r.TEXTURE_3D&&re!==r.TEXTURE_2D_ARRAY||r.texParameteri(re,r.TEXTURE_WRAP_R,Je[W.wrapR]),r.texParameteri(re,r.TEXTURE_MAG_FILTER,st[W.magFilter]),r.texParameteri(re,r.TEXTURE_MIN_FILTER,st[W.minFilter]),W.compareFunction&&(r.texParameteri(re,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(re,r.TEXTURE_COMPARE_FUNC,Et[W.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(W.magFilter===yr||W.minFilter!==Mo&&W.minFilter!==hs||W.type===Ir&&e.has("OES_texture_float_linear")===!1)return;if(W.anisotropy>1||s.get(W).__currentAnisotropy){const ae=e.get("EXT_texture_filter_anisotropic");r.texParameterf(re,ae.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(W.anisotropy,a.getMaxAnisotropy())),s.get(W).__currentAnisotropy=W.anisotropy}}}function Bt(re,W){let ae=!1;re.__webglInit===void 0&&(re.__webglInit=!0,W.addEventListener("dispose",oe));const xe=W.source;let ge=S.get(xe);ge===void 0&&(ge={},S.set(xe,ge));const Ee=function(Ue){const Xe=[];return Xe.push(Ue.wrapS),Xe.push(Ue.wrapT),Xe.push(Ue.wrapR||0),Xe.push(Ue.magFilter),Xe.push(Ue.minFilter),Xe.push(Ue.anisotropy),Xe.push(Ue.internalFormat),Xe.push(Ue.format),Xe.push(Ue.type),Xe.push(Ue.generateMipmaps),Xe.push(Ue.premultiplyAlpha),Xe.push(Ue.flipY),Xe.push(Ue.unpackAlignment),Xe.push(Ue.colorSpace),Xe.join()}(W);if(Ee!==re.__cacheKey){ge[Ee]===void 0&&(ge[Ee]={texture:r.createTexture(),usedTimes:0},u.memory.textures++,ae=!0),ge[Ee].usedTimes++;const Ue=ge[re.__cacheKey];Ue!==void 0&&(ge[re.__cacheKey].usedTimes--,Ue.usedTimes===0&&Ne(W)),re.__cacheKey=Ee,re.__webglTexture=ge[Ee].texture}return ae}function qt(re,W,ae){if(N)return W.isPendingDeferredUpload||(W.isPendingDeferredUpload=!0,B.push({textureProperties:re,texture:W,slot:ae})),!1;let xe=r.TEXTURE_2D;(W.isDataArrayTexture||W.isCompressedArrayTexture)&&(xe=r.TEXTURE_2D_ARRAY),W.isData3DTexture&&(xe=r.TEXTURE_3D);const ge=Bt(re,W),Ee=W.source;n.bindTexture(xe,re.__webglTexture,r.TEXTURE0+ae);const Ue=s.get(Ee);if(Ee.version!==Ue.__version||ge===!0){n.activeTexture(r.TEXTURE0+ae);const Xe=Dn.getPrimaries(Dn.workingColorSpace),at=W.colorSpace===va?null:Dn.getPrimaries(W.colorSpace),Xt=W.colorSpace===va||Xe===at?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,W.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,W.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,W.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Xt);let gt=O(W.image,!1,a.maxTextureSize);gt=mt(W,gt);const cn=c.convert(W.format,W.colorSpace),yn=c.convert(W.type);let tn,hn=ee(W.internalFormat,cn,yn,W.colorSpace,W.isVideoTexture);dt(xe,W);const Yn=W.mipmaps,Kn=W.isVideoTexture!==!0,Ei=Ue.__version===void 0||ge===!0,Hi=Ee.dataReady,li=ce(W,gt);if(W.isDepthTexture)hn=ie(W.format===To,W.type),Ei&&(Kn?n.texStorage2D(r.TEXTURE_2D,1,hn,gt.width,gt.height):n.texImage2D(r.TEXTURE_2D,0,hn,gt.width,gt.height,0,cn,yn,null));else if(W.isDataTexture)if(Yn.length>0){Kn&&Ei&&n.texStorage2D(r.TEXTURE_2D,li,hn,Yn[0].width,Yn[0].height);for(let an=0,Ni=Yn.length;an<Ni;an++)tn=Yn[an],Kn?Hi&&n.texSubImage2D(r.TEXTURE_2D,an,0,0,tn.width,tn.height,cn,yn,tn.data):n.texImage2D(r.TEXTURE_2D,an,hn,tn.width,tn.height,0,cn,yn,tn.data);W.generateMipmaps=!1}else Kn?(Ei&&n.texStorage2D(r.TEXTURE_2D,li,hn,gt.width,gt.height),Hi&&n.texSubImage2D(r.TEXTURE_2D,0,0,0,gt.width,gt.height,cn,yn,gt.data)):n.texImage2D(r.TEXTURE_2D,0,hn,gt.width,gt.height,0,cn,yn,gt.data);else if(W.isCompressedTexture)if(W.isCompressedArrayTexture){Kn&&Ei&&n.texStorage3D(r.TEXTURE_2D_ARRAY,li,hn,Yn[0].width,Yn[0].height,gt.depth);for(let an=0,Ni=Yn.length;an<Ni;an++)if(tn=Yn[an],W.format!==nr)if(cn!==null)if(Kn){if(Hi)if(W.layerUpdates.size>0){const fi=R_(tn.width,tn.height,W.format,W.type);for(const Ia of W.layerUpdates){const Mn=tn.data.subarray(Ia*fi/tn.data.BYTES_PER_ELEMENT,(Ia+1)*fi/tn.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,an,0,0,Ia,tn.width,tn.height,1,cn,Mn)}W.clearLayerUpdates()}else n.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,an,0,0,0,tn.width,tn.height,gt.depth,cn,tn.data)}else n.compressedTexImage3D(r.TEXTURE_2D_ARRAY,an,hn,tn.width,tn.height,gt.depth,0,tn.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Kn?Hi&&n.texSubImage3D(r.TEXTURE_2D_ARRAY,an,0,0,0,tn.width,tn.height,gt.depth,cn,yn,tn.data):n.texImage3D(r.TEXTURE_2D_ARRAY,an,hn,tn.width,tn.height,gt.depth,0,cn,yn,tn.data)}else{Kn&&Ei&&n.texStorage2D(r.TEXTURE_2D,li,hn,Yn[0].width,Yn[0].height);for(let an=0,Ni=Yn.length;an<Ni;an++)tn=Yn[an],W.format!==nr?cn!==null?Kn?Hi&&n.compressedTexSubImage2D(r.TEXTURE_2D,an,0,0,tn.width,tn.height,cn,tn.data):n.compressedTexImage2D(r.TEXTURE_2D,an,hn,tn.width,tn.height,0,tn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Kn?Hi&&n.texSubImage2D(r.TEXTURE_2D,an,0,0,tn.width,tn.height,cn,yn,tn.data):n.texImage2D(r.TEXTURE_2D,an,hn,tn.width,tn.height,0,cn,yn,tn.data)}else if(W.isDataArrayTexture)if(Kn){if(Ei&&n.texStorage3D(r.TEXTURE_2D_ARRAY,li,hn,gt.width,gt.height,gt.depth),Hi)if(W.layerUpdates.size>0){const an=R_(gt.width,gt.height,W.format,W.type);for(const Ni of W.layerUpdates){const fi=gt.data.subarray(Ni*an/gt.data.BYTES_PER_ELEMENT,(Ni+1)*an/gt.data.BYTES_PER_ELEMENT);n.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,Ni,gt.width,gt.height,1,cn,yn,fi)}W.clearLayerUpdates()}else n.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,gt.width,gt.height,gt.depth,cn,yn,gt.data)}else n.texImage3D(r.TEXTURE_2D_ARRAY,0,hn,gt.width,gt.height,gt.depth,0,cn,yn,gt.data);else if(W.isData3DTexture)Kn?(Ei&&n.texStorage3D(r.TEXTURE_3D,li,hn,gt.width,gt.height,gt.depth),Hi&&n.texSubImage3D(r.TEXTURE_3D,0,0,0,0,gt.width,gt.height,gt.depth,cn,yn,gt.data)):n.texImage3D(r.TEXTURE_3D,0,hn,gt.width,gt.height,gt.depth,0,cn,yn,gt.data);else if(W.isFramebufferTexture){if(Ei)if(Kn)n.texStorage2D(r.TEXTURE_2D,li,hn,gt.width,gt.height);else{let an=gt.width,Ni=gt.height;for(let fi=0;fi<li;fi++)n.texImage2D(r.TEXTURE_2D,fi,hn,an,Ni,0,cn,yn,null),an>>=1,Ni>>=1}}else if(Yn.length>0){if(Kn&&Ei){const an=vt(Yn[0]);n.texStorage2D(r.TEXTURE_2D,li,hn,an.width,an.height)}for(let an=0,Ni=Yn.length;an<Ni;an++)tn=Yn[an],Kn?Hi&&n.texSubImage2D(r.TEXTURE_2D,an,0,0,cn,yn,tn):n.texImage2D(r.TEXTURE_2D,an,hn,cn,yn,tn);W.generateMipmaps=!1}else if(Kn){if(Ei){const an=vt(gt);n.texStorage2D(r.TEXTURE_2D,li,hn,an.width,an.height)}Hi&&n.texSubImage2D(r.TEXTURE_2D,0,0,0,cn,yn,gt)}else n.texImage2D(r.TEXTURE_2D,0,hn,cn,yn,gt);H(W)&&X(xe),Ue.__version=Ee.version,W.onUpdate&&W.onUpdate(W)}return re.__version=W.version,!0}function Kt(re,W,ae,xe,ge,Ee){const Ue=c.convert(ae.format,ae.colorSpace),Xe=c.convert(ae.type),at=ee(ae.internalFormat,Ue,Xe,ae.colorSpace),Xt=s.get(W),gt=s.get(ae);if(gt.__renderTarget=W,!Xt.__hasExternalTextures){const yn=Math.max(1,W.width>>Ee),tn=Math.max(1,W.height>>Ee);W.isWebGLMultiviewRenderTarget===!0?n.texStorage3D(r.TEXTURE_2D_ARRAY,0,at,W.width,W.height,W.numViews):ge===r.TEXTURE_3D||ge===r.TEXTURE_2D_ARRAY?n.texImage3D(ge,Ee,at,yn,tn,W.depth,0,Ue,Xe,null):n.texImage2D(ge,Ee,at,yn,tn,0,Ue,Xe,null)}n.bindFramebuffer(r.FRAMEBUFFER,re);const cn=It(W);W.isWebGLMultiviewRenderTarget===!0?cn?v.framebufferTextureMultisampleMultiviewOVR(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,gt.__webglTexture,0,jt(W),0,W.numViews):v.framebufferTextureMultiviewOVR(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,gt.__webglTexture,0,0,W.numViews):(ge===r.TEXTURE_2D||ge>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&ge<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(cn?A.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,xe,ge,gt.__webglTexture,0,jt(W)):r.framebufferTexture2D(r.FRAMEBUFFER,xe,ge,gt.__webglTexture,Ee)),n.bindFramebuffer(r.FRAMEBUFFER,null)}function Jt(re,W,ae){if(r.bindRenderbuffer(r.RENDERBUFFER,re),W.isWebGLMultiviewRenderTarget===!0){const xe=It(W),ge=W.numViews,Ee=W.depthTexture;let Ue=r.DEPTH_COMPONENT24,Xe=r.DEPTH_ATTACHMENT;Ee&&Ee.isDepthTexture&&(Ee.type===Ir?Ue=r.DEPTH_COMPONENT32F:Ee.type===hl&&(Ue=r.DEPTH24_STENCIL8,Xe=r.DEPTH_STENCIL_ATTACHMENT));let at=s.get(W.depthTexture).__webglTexture;at===void 0&&(at=r.createTexture(),r.bindTexture(r.TEXTURE_2D_ARRAY,at),r.texStorage3D(r.TEXTURE_2D_ARRAY,1,Ue,W.width,W.height,ge)),xe?v.framebufferTextureMultisampleMultiviewOVR(r.FRAMEBUFFER,Xe,at,0,jt(W),0,ge):v.framebufferTextureMultiviewOVR(r.FRAMEBUFFER,Xe,at,0,0,ge)}else if(W.depthBuffer){const xe=W.depthTexture,ge=xe&&xe.isDepthTexture?xe.type:null,Ee=ie(W.stencilBuffer,ge),Ue=W.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Xe=jt(W);It(W)?A.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Xe,Ee,W.width,W.height):ae?r.renderbufferStorageMultisample(r.RENDERBUFFER,Xe,Ee,W.width,W.height):r.renderbufferStorage(r.RENDERBUFFER,Ee,W.width,W.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ue,r.RENDERBUFFER,re)}else{const xe=W.textures;for(let ge=0;ge<xe.length;ge++){const Ee=xe[ge],Ue=c.convert(Ee.format,Ee.colorSpace),Xe=c.convert(Ee.type),at=ee(Ee.internalFormat,Ue,Xe,Ee.colorSpace),Xt=jt(W);ae&&It(W)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,Xt,at,W.width,W.height):It(W)?A.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Xt,at,W.width,W.height):r.renderbufferStorage(r.RENDERBUFFER,at,W.width,W.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function ln(re,W){if(W&&W.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(r.FRAMEBUFFER,re),!W.depthTexture||!W.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ae=s.get(W.depthTexture);ae.__renderTarget=W,ae.__webglTexture&&W.depthTexture.image.width===W.width&&W.depthTexture.image.height===W.height||(W.depthTexture.image.width=W.width,W.depthTexture.image.height=W.height,W.depthTexture.needsUpdate=!0),W.depthTexture.image.depth!=1?Te(W.depthTexture,0):Oe(W.depthTexture,0);const xe=ae.__webglTexture,ge=jt(W);if(W.isWebGLMultiviewRenderTarget===!0){const Ee=It(W),Ue=W.numViews;if(W.depthTexture.format===ul)Ee?v.framebufferTextureMultisampleMultiviewOVR(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,xe,0,ge,0,Ue):v.framebufferTextureMultiviewOVR(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,xe,0,0,Ue);else{if(W.depthTexture.format!==To)throw new Error("Unknown depthTexture format");Ee?v.framebufferTextureMultisampleMultiviewOVR(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,xe,0,ge,0,Ue):v.framebufferTextureMultiviewOVR(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,xe,0,0,Ue)}}else if(W.depthTexture.format===ul)It(W)?A.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,xe,0,ge):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,xe,0);else{if(W.depthTexture.format!==To)throw new Error("Unknown depthTexture format");It(W)?A.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,xe,0,ge):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,xe,0)}}function Ot(re){const W=s.get(re),ae=re.isWebGLCubeRenderTarget===!0;if(W.__boundDepthTexture!==re.depthTexture){const xe=re.depthTexture;if(W.__depthDisposeCallback&&W.__depthDisposeCallback(),xe){const ge=()=>{delete W.__boundDepthTexture,delete W.__depthDisposeCallback,xe.removeEventListener("dispose",ge)};xe.addEventListener("dispose",ge),W.__depthDisposeCallback=ge}W.__boundDepthTexture=xe}if(re.depthTexture&&!W.__autoAllocateDepthBuffer){if(ae)throw new Error("target.depthTexture not supported in Cube render targets");ln(W.__webglFramebuffer,re)}else if(ae){W.__webglDepthbuffer=[];for(let xe=0;xe<6;xe++)if(n.bindFramebuffer(r.FRAMEBUFFER,W.__webglFramebuffer[xe]),W.__webglDepthbuffer[xe]===void 0)W.__webglDepthbuffer[xe]=r.createRenderbuffer(),Jt(W.__webglDepthbuffer[xe],re,!1);else{const ge=re.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Ee=W.__webglDepthbuffer[xe];r.bindRenderbuffer(r.RENDERBUFFER,Ee),r.framebufferRenderbuffer(r.FRAMEBUFFER,ge,r.RENDERBUFFER,Ee)}}else if(n.bindFramebuffer(r.FRAMEBUFFER,W.__webglFramebuffer),W.__webglDepthbuffer===void 0)W.__webglDepthbuffer=r.createRenderbuffer(),Jt(W.__webglDepthbuffer,re,!1);else{const xe=re.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ge=W.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,ge),r.framebufferRenderbuffer(r.FRAMEBUFFER,xe,r.RENDERBUFFER,ge)}n.bindFramebuffer(r.FRAMEBUFFER,null)}const nt=[],Rt=[];function jt(re){return Math.min(a.maxSamples,re.samples)}function It(re){const W=s.get(re);return re.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&W.__useRenderToTexture!==!1}function mt(re,W){const ae=re.colorSpace,xe=re.format,ge=re.type;return re.isCompressedTexture===!0||re.isVideoTexture===!0||ae!==xr&&ae!==va&&(Dn.getTransfer(ae)===Di?xe===nr&&ge===Er||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ae)),W}function vt(re){return typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement?(E.width=re.naturalWidth||re.width,E.height=re.naturalHeight||re.height):typeof VideoFrame<"u"&&re instanceof VideoFrame?(E.width=re.displayWidth,E.height=re.displayHeight):(E.width=re.width,E.height=re.height),E}this.allocateTextureUnit=function(){const re=ke;return re>=a.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+re+" texture units while this GPU supports only "+a.maxTextures),ke+=1,re},this.resetTextureUnits=function(){ke=0},this.setTexture2D=Oe,this.setTexture2DArray=Te,this.setTexture3D=function(re,W){const ae=s.get(re);re.version>0&&ae.__version!==re.version?qt(ae,re,W):n.bindTexture(r.TEXTURE_3D,ae.__webglTexture,r.TEXTURE0+W)},this.setTextureCube=function(re,W){const ae=s.get(re);re.version>0&&ae.__version!==re.version?function(xe,ge,Ee){if(ge.image.length!==6)return;const Ue=Bt(xe,ge),Xe=ge.source;n.bindTexture(r.TEXTURE_CUBE_MAP,xe.__webglTexture,r.TEXTURE0+Ee);const at=s.get(Xe);if(Xe.version!==at.__version||Ue===!0){n.activeTexture(r.TEXTURE0+Ee);const Xt=Dn.getPrimaries(Dn.workingColorSpace),gt=ge.colorSpace===va?null:Dn.getPrimaries(ge.colorSpace),cn=ge.colorSpace===va||Xt===gt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,ge.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ge.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,ge.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,cn);const yn=ge.isCompressedTexture||ge.image[0].isCompressedTexture,tn=ge.image[0]&&ge.image[0].isDataTexture,hn=[];for(let Mn=0;Mn<6;Mn++)hn[Mn]=yn||tn?tn?ge.image[Mn].image:ge.image[Mn]:O(ge.image[Mn],!0,a.maxCubemapSize),hn[Mn]=mt(ge,hn[Mn]);const Yn=hn[0],Kn=c.convert(ge.format,ge.colorSpace),Ei=c.convert(ge.type),Hi=ee(ge.internalFormat,Kn,Ei,ge.colorSpace),li=ge.isVideoTexture!==!0,an=at.__version===void 0||Ue===!0,Ni=Xe.dataReady;let fi,Ia=ce(ge,Yn);if(dt(r.TEXTURE_CUBE_MAP,ge),yn){li&&an&&n.texStorage2D(r.TEXTURE_CUBE_MAP,Ia,Hi,Yn.width,Yn.height);for(let Mn=0;Mn<6;Mn++){fi=hn[Mn].mipmaps;for(let dr=0;dr<fi.length;dr++){const mi=fi[dr];ge.format!==nr?Kn!==null?li?Ni&&n.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr,0,0,mi.width,mi.height,Kn,mi.data):n.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr,Hi,mi.width,mi.height,0,mi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):li?Ni&&n.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr,0,0,mi.width,mi.height,Kn,Ei,mi.data):n.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr,Hi,mi.width,mi.height,0,Kn,Ei,mi.data)}}}else{if(fi=ge.mipmaps,li&&an){fi.length>0&&Ia++;const Mn=vt(hn[0]);n.texStorage2D(r.TEXTURE_CUBE_MAP,Ia,Hi,Mn.width,Mn.height)}for(let Mn=0;Mn<6;Mn++)if(tn){li?Ni&&n.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,0,0,0,hn[Mn].width,hn[Mn].height,Kn,Ei,hn[Mn].data):n.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,0,Hi,hn[Mn].width,hn[Mn].height,0,Kn,Ei,hn[Mn].data);for(let dr=0;dr<fi.length;dr++){const mi=fi[dr].image[Mn].image;li?Ni&&n.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr+1,0,0,mi.width,mi.height,Kn,Ei,mi.data):n.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr+1,Hi,mi.width,mi.height,0,Kn,Ei,mi.data)}}else{li?Ni&&n.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,0,0,0,Kn,Ei,hn[Mn]):n.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,0,Hi,Kn,Ei,hn[Mn]);for(let dr=0;dr<fi.length;dr++){const mi=fi[dr];li?Ni&&n.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr+1,0,0,Kn,Ei,mi.image[Mn]):n.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Mn,dr+1,Hi,Kn,Ei,mi.image[Mn])}}}H(ge)&&X(r.TEXTURE_CUBE_MAP),at.__version=Xe.version,ge.onUpdate&&ge.onUpdate(ge)}xe.__version=ge.version}(ae,re,W):n.bindTexture(r.TEXTURE_CUBE_MAP,ae.__webglTexture,r.TEXTURE0+W)},this.rebindTextures=function(re,W,ae){const xe=s.get(re);W!==void 0&&Kt(xe.__webglFramebuffer,re,re.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),ae!==void 0&&Ot(re)},this.uploadTexture=qt,this.setupRenderTarget=function(re){const W=re.texture,ae=s.get(re),xe=s.get(W);re.addEventListener("dispose",Se);const ge=re.textures,Ee=re.isWebGLCubeRenderTarget===!0,Ue=ge.length>1;if(Ue||(xe.__webglTexture===void 0&&(xe.__webglTexture=r.createTexture()),xe.__version=W.version,u.memory.textures++),Ee){ae.__webglFramebuffer=[];for(let Xe=0;Xe<6;Xe++)if(W.mipmaps&&W.mipmaps.length>0){ae.__webglFramebuffer[Xe]=[];for(let at=0;at<W.mipmaps.length;at++)ae.__webglFramebuffer[Xe][at]=r.createFramebuffer()}else ae.__webglFramebuffer[Xe]=r.createFramebuffer()}else{if(W.mipmaps&&W.mipmaps.length>0){ae.__webglFramebuffer=[];for(let Xe=0;Xe<W.mipmaps.length;Xe++)ae.__webglFramebuffer[Xe]=r.createFramebuffer()}else ae.__webglFramebuffer=r.createFramebuffer();if(Ue)for(let Xe=0,at=ge.length;Xe<at;Xe++){const Xt=s.get(ge[Xe]);Xt.__webglTexture===void 0&&(Xt.__webglTexture=r.createTexture(),u.memory.textures++)}if(re.samples>0&&It(re)===!1){ae.__webglMultisampledFramebuffer=r.createFramebuffer(),ae.__webglColorRenderbuffer=[],n.bindFramebuffer(r.FRAMEBUFFER,ae.__webglMultisampledFramebuffer);for(let Xe=0;Xe<ge.length;Xe++){const at=ge[Xe];ae.__webglColorRenderbuffer[Xe]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,ae.__webglColorRenderbuffer[Xe]);const Xt=c.convert(at.format,at.colorSpace),gt=c.convert(at.type),cn=ee(at.internalFormat,Xt,gt,at.colorSpace,re.isXRRenderTarget===!0),yn=jt(re);r.renderbufferStorageMultisample(r.RENDERBUFFER,yn,cn,re.width,re.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Xe,r.RENDERBUFFER,ae.__webglColorRenderbuffer[Xe])}r.bindRenderbuffer(r.RENDERBUFFER,null),re.depthBuffer&&(ae.__webglDepthRenderbuffer=r.createRenderbuffer(),Jt(ae.__webglDepthRenderbuffer,re,!0)),n.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Ee){n.bindTexture(r.TEXTURE_CUBE_MAP,xe.__webglTexture),dt(r.TEXTURE_CUBE_MAP,W);for(let Xe=0;Xe<6;Xe++)if(W.mipmaps&&W.mipmaps.length>0)for(let at=0;at<W.mipmaps.length;at++)Kt(ae.__webglFramebuffer[Xe][at],re,W,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,at);else Kt(ae.__webglFramebuffer[Xe],re,W,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0);H(W)&&X(r.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Ue){for(let Xe=0,at=ge.length;Xe<at;Xe++){const Xt=ge[Xe],gt=s.get(Xt);n.bindTexture(r.TEXTURE_2D,gt.__webglTexture),dt(r.TEXTURE_2D,Xt),Kt(ae.__webglFramebuffer,re,Xt,r.COLOR_ATTACHMENT0+Xe,r.TEXTURE_2D,0),H(Xt)&&X(r.TEXTURE_2D)}n.unbindTexture()}else{let Xe=r.TEXTURE_2D;if((re.isWebGL3DRenderTarget||re.isWebGLArrayRenderTarget)&&(Xe=re.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),re.isWebGLMultiviewRenderTarget===!0&&(Xe=r.TEXTURE_2D_ARRAY),n.bindTexture(Xe,xe.__webglTexture),dt(Xe,W),W.mipmaps&&W.mipmaps.length>0)for(let at=0;at<W.mipmaps.length;at++)Kt(ae.__webglFramebuffer[at],re,W,r.COLOR_ATTACHMENT0,Xe,at);else Kt(ae.__webglFramebuffer,re,W,r.COLOR_ATTACHMENT0,Xe,0);H(W)&&X(Xe),n.unbindTexture()}(re.depthBuffer||re.isWebGLMultiviewRenderTarget===!0)&&this.setupDepthRenderbuffer(re)},this.updateRenderTargetMipmap=function(re){const W=re.textures;for(let ae=0,xe=W.length;ae<xe;ae++){const ge=W[ae];if(H(ge)){const Ee=$(re),Ue=s.get(ge).__webglTexture;n.bindTexture(Ee,Ue),X(Ee),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(re){if(re.samples>0){if(It(re)===!1){const W=re.textures,ae=re.width,xe=re.height;let ge=r.COLOR_BUFFER_BIT;const Ee=re.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Ue=s.get(re),Xe=W.length>1;if(Xe)for(let at=0;at<W.length;at++)n.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+at,r.RENDERBUFFER,null),n.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+at,r.TEXTURE_2D,null,0);n.bindFramebuffer(r.READ_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),n.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ue.__webglFramebuffer);for(let at=0;at<W.length;at++){if(re.resolveDepthBuffer&&(re.depthBuffer&&(ge|=r.DEPTH_BUFFER_BIT),re.stencilBuffer&&re.resolveStencilBuffer&&(ge|=r.STENCIL_BUFFER_BIT)),Xe){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Ue.__webglColorRenderbuffer[at]);const Xt=s.get(W[at]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Xt,0)}r.blitFramebuffer(0,0,ae,xe,0,0,ae,xe,ge,r.NEAREST),m===!0&&(nt.length=0,Rt.length=0,nt.push(r.COLOR_ATTACHMENT0+at),re.depthBuffer&&re.resolveDepthBuffer===!1&&(nt.push(Ee),Rt.push(Ee),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,Rt)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,nt))}if(n.bindFramebuffer(r.READ_FRAMEBUFFER,null),n.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),Xe)for(let at=0;at<W.length;at++){n.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+at,r.RENDERBUFFER,Ue.__webglColorRenderbuffer[at]);const Xt=s.get(W[at]).__webglTexture;n.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+at,r.TEXTURE_2D,Xt,0)}n.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer)}else if(re.depthBuffer&&re.resolveDepthBuffer===!1&&m){const W=re.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[W])}}},this.setupDepthTexture=ln,this.setupDepthRenderbuffer=Ot,this.setupFrameBufferTexture=Kt,this.useMultisampledRTT=It,this.runDeferredUploads=function(){const re=N;N=!1;for(const W of B)qt(W.textureProperties,W.texture,W.slot),W.texture.isPendingDeferredUpload=!1;B=[],N=re},this.setDeferTextureUploads=function(re){N=re}}function mT(r,e){return{convert:function(n,s=va){let a;const c=Dn.getTransfer(s);if(n===Er)return r.UNSIGNED_BYTE;if(n===tu)return r.UNSIGNED_SHORT_4_4_4_4;if(n===Xl)return r.UNSIGNED_SHORT_5_5_5_1;if(n===ZA)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===Od)return r.BYTE;if(n===kd)return r.SHORT;if(n===cl)return r.UNSIGNED_SHORT;if(n===eu)return r.INT;if(n===So)return r.UNSIGNED_INT;if(n===Ir)return r.FLOAT;if(n===Cs)return r.HALF_FLOAT;if(n===nu)return r.ALPHA;if(n===iu)return r.RGB;if(n===nr)return r.RGBA;if(n===Io)return r.LUMINANCE;if(n===ru)return r.LUMINANCE_ALPHA;if(n===ul)return r.DEPTH_COMPONENT;if(n===To)return r.DEPTH_STENCIL;if(n===Bo)return r.RED;if(n===su)return r.RED_INTEGER;if(n===dl)return r.RG;if(n===Qd)return r.RG_INTEGER;if(n===au)return r.RGBA_INTEGER;if(n===ou||n===Na||n===Fa||n===eh)if(c===Di){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a===null)return null;if(n===ou)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Na)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Fa)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===eh)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),a===null)return null;if(n===ou)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Na)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Fa)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===eh)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===pl||n===Gd||n===lu||n===Hd){if(a=e.get("WEBGL_compressed_texture_pvrtc"),a===null)return null;if(n===pl)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Gd)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===lu)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Hd)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===cu||n===hu||n===uu){if(a=e.get("WEBGL_compressed_texture_etc"),a===null)return null;if(n===cu||n===hu)return c===Di?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(n===uu)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(n===th||n===zd||n===Ds||n===du||n===Yl||n===pu||n===Vd||n===Wd||n===Au||n===Kl||n===jd||n===qd||n===fu||n===Xd){if(a=e.get("WEBGL_compressed_texture_astc"),a===null)return null;if(n===th)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===zd)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ds)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===du)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Yl)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===pu)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Vd)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Wd)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Au)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Kl)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===jd)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===qd)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===fu)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Xd)return c===Di?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===nh||n===mu||n===ih){if(a=e.get("EXT_texture_compression_bptc"),a===null)return null;if(n===nh)return c===Di?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===mu)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===ih)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Yd||n===Jl||n===gu||n===rh){if(a=e.get("EXT_texture_compression_rgtc"),a===null)return null;if(n===nh)return a.COMPRESSED_RED_RGTC1_EXT;if(n===Jl)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===gu)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===rh)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===hl?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}}}class gT extends Us{constructor(e,n,s,a={}){super(e,n,a),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=s}copy(e){return super.copy(e),this.numViews=e.numViews,this}}gT.prototype.isWebGLMultiviewRenderTarget=!0;class Pk{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,s){if(this.texture===null){const a=new Pi;e.properties.get(a).__webglTexture=n.texture,n.depthNear===s.depthNear&&n.depthFar===s.depthFar||(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=a}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,s=new Ca({vertexShader:`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Ti(new Ac(20,20),s)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Uk extends Oa{constructor(e,n,s,a){super();const c=this;let u=null,A=1;var m=null;let v=null,E="local-floor",C=1,M=null,S=null;var B=[];let N=null,L=null,F=null,O=null;const H=new Pk,X=n.getContextAttributes();let $=null,ee=null;const ie=[],ce=[],oe=new ct;let Se=null;const Ne=new Hr;Ne.viewport=new pi;const ke=new Hr;ke.viewport=new pi;const Oe=[Ne,ke],Te=new EI;let Je=null,st=null;function Et(nt){const Rt=ce.indexOf(nt.inputSource);if(Rt===-1)return;const jt=ie[Rt];jt!==void 0&&(jt.update(nt.inputSource,nt.frame,M||v),jt.dispatchEvent({type:nt.type,data:nt.inputSource}))}function dt(){u.removeEventListener("select",Et),u.removeEventListener("selectstart",Et),u.removeEventListener("selectend",Et),u.removeEventListener("squeeze",Et),u.removeEventListener("squeezestart",Et),u.removeEventListener("squeezeend",Et),u.removeEventListener("end",dt),u.removeEventListener("inputsourceschange",Bt);for(let nt=0;nt<ie.length;nt++){const Rt=ce[nt];Rt!==null&&(ce[nt]=null,ie[nt].disconnect(Rt))}Je=null,st=null,H.reset(),e.setRenderTarget($),F=null,L=null,N=null,u=null,ee=null,Ot.stop(),c.isPresenting=!1,e.setPixelRatio(Se),e.setSize(oe.width,oe.height,!1),c.dispatchEvent({type:"sessionend"})}function Bt(nt){for(let Rt=0;Rt<nt.removed.length;Rt++){const jt=nt.removed[Rt],It=ce.indexOf(jt);It>=0&&(ce[It]=null,ie[It].disconnect(jt))}for(let Rt=0;Rt<nt.added.length;Rt++){const jt=nt.added[Rt];let It=ce.indexOf(jt);if(It===-1){for(let vt=0;vt<ie.length;vt++){if(vt>=ce.length){ce.push(jt),It=vt;break}if(ce[vt]===null){ce[vt]=jt,It=vt;break}}if(It===-1)break}const mt=ie[It];mt&&mt.connect(jt)}}this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return S},this.getController=function(nt){let Rt=ie[nt];return Rt===void 0&&(Rt=new h0,ie[nt]=Rt),Rt.getTargetRaySpace()},this.getControllerGrip=function(nt){let Rt=ie[nt];return Rt===void 0&&(Rt=new h0,ie[nt]=Rt),Rt.getGripSpace()},this.getHand=function(nt){let Rt=ie[nt];return Rt===void 0&&(Rt=new h0,ie[nt]=Rt),Rt.getHandSpace()},this.setFramebufferScaleFactor=function(nt){A=nt,c.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(nt){E=nt,c.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return M||v},this.setReferenceSpace=function(nt){M=nt},this.getBaseLayer=function(){return L!==null?L:F},this.getBinding=function(){return N},this.getRenderTarget=function(){return ee},this.getFrame=function(){return O},this.getSession=function(){return u},this.setSession=async function(nt){if(u=nt,u!==null){if($=e.getRenderTarget(),u.addEventListener("select",Et),u.addEventListener("selectstart",Et),u.addEventListener("selectend",Et),u.addEventListener("squeeze",Et),u.addEventListener("squeezestart",Et),u.addEventListener("squeezeend",Et),u.addEventListener("end",dt),u.addEventListener("inputsourceschange",Bt),X.xrCompatible!==!0&&await n.makeXRCompatible(),Se=e.getPixelRatio(),e.getSize(oe),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Rt=null,jt=null,It=null;X.depth&&(It=X.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,Rt=X.stencil?To:ul,jt=X.stencil?hl:So),c.isMultiview=a&&s.has("OCULUS_multiview");const mt={colorFormat:n.RGBA8,depthFormat:It,scaleFactor:A};c.isMultiview&&(mt.textureType="texture-array"),N=new XRWebGLBinding(u,n),L=N.createProjectionLayer(mt),u.updateRenderState({layers:[L]}),e.setPixelRatio(1),e.setSize(L.textureWidth,L.textureHeight,!1);const vt={format:nr,type:Er,depthTexture:new Xx(L.textureWidth,L.textureHeight,jt,void 0,void 0,void 0,void 0,void 0,void 0,Rt),stencilBuffer:X.stencil,colorSpace:e.outputColorSpace,samples:X.antialias?4:0,resolveDepthBuffer:L.ignoreDepthValues===!1};if(c.isMultiview){const re=s.get("OCULUS_multiview");this.maxNumViews=n.getParameter(re.MAX_VIEWS_OVR),ee=new gT(L.textureWidth,L.textureHeight,2,vt)}else ee=new Us(L.textureWidth,L.textureHeight,vt)}else{const Rt={antialias:X.antialias,alpha:!0,depth:X.depth,stencil:X.stencil,framebufferScaleFactor:A};F=new XRWebGLLayer(u,n,Rt),u.updateRenderState({baseLayer:F}),e.setPixelRatio(1),e.setSize(F.framebufferWidth,F.framebufferHeight,!1),ee=new Us(F.framebufferWidth,F.framebufferHeight,{format:nr,type:Er,colorSpace:e.outputColorSpace,stencilBuffer:X.stencil})}ee.isXRRenderTarget=!0,this.setFoveation(C),M=null,v=await u.requestReferenceSpace(E),Ot.setContext(u),Ot.start(),c.isPresenting=!0,c.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(u!==null)return u.environmentBlendMode},this.addLayer=function(nt){window.XRWebGLBinding&&this.layersEnabled&&u&&(B.push(nt),this.updateLayers())},this.removeLayer=function(nt){B.splice(B.indexOf(nt),1),window.XRWebGLBinding&&this.layersEnabled&&u&&this.updateLayers()},this.updateLayers=function(){var nt=B.map(function(Rt){return Rt});nt.unshift(u.renderState.layers[0]),u.updateRenderState({layers:nt})},this.getDepthTexture=function(){return H.getDepthTexture()};const qt=new R,Kt=new R;function Jt(nt,Rt){Rt===null?nt.matrixWorld.copy(nt.matrix):nt.matrixWorld.multiplyMatrices(Rt.matrixWorld,nt.matrix),nt.matrixWorldInverse.copy(nt.matrixWorld).invert()}this.setPoseTarget=function(nt){nt!==void 0&&(m=nt)},this.updateCamera=function(nt){if(u===null)return;let Rt=nt.near,jt=nt.far;H.texture!==null&&(H.depthNear>0&&(Rt=H.depthNear),H.depthFar>0&&(jt=H.depthFar)),Te.near=ke.near=Ne.near=Rt,Te.far=ke.far=Ne.far=jt,Je===Te.near&&st===Te.far||(u.updateRenderState({depthNear:Te.near,depthFar:Te.far}),Je=Te.near,st=Te.far),Ne.layers.mask=2|nt.layers.mask,ke.layers.mask=4|nt.layers.mask,Te.layers.mask=Ne.layers.mask|ke.layers.mask;const It=Te.cameras;var mt=m||nt;const vt=mt.parent;Jt(Te,vt);for(let re=0;re<It.length;re++)Jt(It[re],vt);It.length===2?function(re,W,ae){qt.setFromMatrixPosition(W.matrixWorld),Kt.setFromMatrixPosition(ae.matrixWorld);const xe=qt.distanceTo(Kt),ge=W.projectionMatrix.elements,Ee=ae.projectionMatrix.elements,Ue=ge[14]/(ge[10]-1),Xe=ge[14]/(ge[10]+1),at=(ge[9]+1)/ge[5],Xt=(ge[9]-1)/ge[5],gt=(ge[8]-1)/ge[0],cn=(Ee[8]+1)/Ee[0],yn=Ue*gt,tn=Ue*cn,hn=xe/(-gt+cn),Yn=hn*-gt;if(W.matrixWorld.decompose(re.position,re.quaternion,re.scale),re.translateX(Yn),re.translateZ(hn),re.matrixWorld.compose(re.position,re.quaternion,re.scale),re.matrixWorldInverse.copy(re.matrixWorld).invert(),ge[10]===-1)re.projectionMatrix.copy(W.projectionMatrix),re.projectionMatrixInverse.copy(W.projectionMatrixInverse);else{const Kn=Ue+hn,Ei=Xe+hn,Hi=yn-Yn,li=tn+(xe-Yn),an=at*Xe/Ei*Kn,Ni=Xt*Xe/Ei*Kn;re.projectionMatrix.makePerspective(Hi,li,an,Ni,Kn,Ei),re.projectionMatrixInverse.copy(re.projectionMatrix).invert()}}(Te,Ne,ke):Te.projectionMatrix.copy(Ne.projectionMatrix),function(re,W,ae){W.matrixWorld.decompose(W.position,W.quaternion,W.scale),ae.parent===null?ae.matrix.copy(W.matrixWorld):(ae.matrix.copy(ae.parent.matrixWorld),ae.matrix.invert(),ae.matrix.multiply(W.matrixWorld)),ae.matrix.decompose(ae.position,ae.quaternion,ae.scale),ae.updateMatrixWorld(!0),re.projectionMatrix.copy(W.projectionMatrix),re.projectionMatrixInverse.copy(W.projectionMatrixInverse),re.isPerspectiveCamera&&(re.fov=2*io*Math.atan(1/re.projectionMatrix.elements[5]),re.zoom=1)}(nt,Te,mt)},this.getCamera=function(){return Te},this.getFoveation=function(){if(L!==null||F!==null)return C},this.setFoveation=function(nt){C=nt,L!==null&&(L.fixedFoveation=nt),F!==null&&F.fixedFoveation!==void 0&&(F.fixedFoveation=nt)},this.hasDepthSensing=function(){return H.texture!==null},this.getDepthSensingMesh=function(){return H.getMesh(Te)};let ln=null;const Ot=new HI;Ot.setAnimationLoop(function(nt,Rt){if(S=Rt.getViewerPose(M||v),O=Rt,S!==null){const jt=S.views;F!==null&&(e.setRenderTargetFramebuffer(ee,F.framebuffer),e.setRenderTarget(ee));let It=!1;jt.length!==Te.cameras.length&&(Te.cameras.length=0,It=!0);for(let vt=0;vt<jt.length;vt++){const re=jt[vt];let W=null;if(F!==null)W=F.getViewport(re);else{const xe=N.getViewSubImage(L,re);W=xe.viewport,vt===0&&(e.setRenderTargetTextures(ee,xe.colorTexture,L.ignoreDepthValues?void 0:xe.depthStencilTexture),e.setRenderTarget(ee))}let ae=Oe[vt];ae===void 0&&(ae=new Hr,ae.layers.enable(vt),ae.viewport=new pi,Oe[vt]=ae),ae.matrix.fromArray(re.transform.matrix),ae.matrix.decompose(ae.position,ae.quaternion,ae.scale),ae.projectionMatrix.fromArray(re.projectionMatrix),ae.projectionMatrixInverse.copy(ae.projectionMatrix).invert(),ae.viewport.set(W.x,W.y,W.width,W.height),vt===0&&(Te.matrix.copy(ae.matrix),Te.matrix.decompose(Te.position,Te.quaternion,Te.scale)),It===!0&&Te.cameras.push(ae)}const mt=u.enabledFeatures;if(mt&&mt.includes("depth-sensing")&&u.depthUsage=="gpu-optimized"&&N){const vt=N.getDepthInformation(jt[0]);vt&&vt.isValid&&vt.texture&&H.init(e,vt,u.renderState)}}for(let jt=0;jt<ie.length;jt++){const It=ce[jt],mt=ie[jt];It!==null&&mt!==void 0&&mt.update(It,Rt,M||v)}ln&&ln(nt,Rt),Rt.detectedPlanes&&c.dispatchEvent({type:"planesdetected",data:Rt}),O=null}),this.setAnimationLoop=function(nt){ln=nt},this.dispose=function(){}}}const ju=new ii,Nk=new Qt;function Fk(r,e){function n(a,c){a.matrixAutoUpdate===!0&&a.updateMatrix(),c.value.copy(a.matrix)}function s(a,c){a.opacity.value=c.opacity,c.color&&a.diffuse.value.copy(c.color),c.emissive&&a.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity),c.map&&(a.map.value=c.map,n(c.map,a.mapTransform)),c.alphaMap&&(a.alphaMap.value=c.alphaMap,n(c.alphaMap,a.alphaMapTransform)),c.bumpMap&&(a.bumpMap.value=c.bumpMap,n(c.bumpMap,a.bumpMapTransform),a.bumpScale.value=c.bumpScale,c.side===Lt&&(a.bumpScale.value*=-1)),c.normalMap&&(a.normalMap.value=c.normalMap,n(c.normalMap,a.normalMapTransform),a.normalScale.value.copy(c.normalScale),c.side===Lt&&a.normalScale.value.negate()),c.displacementMap&&(a.displacementMap.value=c.displacementMap,n(c.displacementMap,a.displacementMapTransform),a.displacementScale.value=c.displacementScale,a.displacementBias.value=c.displacementBias),c.emissiveMap&&(a.emissiveMap.value=c.emissiveMap,n(c.emissiveMap,a.emissiveMapTransform)),c.specularMap&&(a.specularMap.value=c.specularMap,n(c.specularMap,a.specularMapTransform)),c.alphaTest>0&&(a.alphaTest.value=c.alphaTest);const u=e.get(c),A=u.envMap,m=u.envMapRotation;A&&(a.envMap.value=A,ju.copy(m),ju.x*=-1,ju.y*=-1,ju.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(ju.y*=-1,ju.z*=-1),a.envMapRotation.value.setFromMatrix4(Nk.makeRotationFromEuler(ju)),a.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,a.reflectivity.value=c.reflectivity,a.ior.value=c.ior,a.refractionRatio.value=c.refractionRatio),c.lightMap&&(a.lightMap.value=c.lightMap,a.lightMapIntensity.value=c.lightMapIntensity,n(c.lightMap,a.lightMapTransform)),c.aoMap&&(a.aoMap.value=c.aoMap,a.aoMapIntensity.value=c.aoMapIntensity,n(c.aoMap,a.aoMapTransform))}return{refreshFogUniforms:function(a,c){c.color.getRGB(a.fogColor.value,cS(r)),c.isFog?(a.fogNear.value=c.near,a.fogFar.value=c.far):c.isFogExp2&&(a.fogDensity.value=c.density)},refreshMaterialUniforms:function(a,c,u,A,m){c.isMeshBasicMaterial||c.isMeshLambertMaterial?s(a,c):c.isMeshToonMaterial?(s(a,c),function(v,E){E.gradientMap&&(v.gradientMap.value=E.gradientMap)}(a,c)):c.isMeshPhongMaterial?(s(a,c),function(v,E){v.specular.value.copy(E.specular),v.shininess.value=Math.max(E.shininess,1e-4)}(a,c)):c.isMeshStandardMaterial?(s(a,c),function(v,E){v.metalness.value=E.metalness,E.metalnessMap&&(v.metalnessMap.value=E.metalnessMap,n(E.metalnessMap,v.metalnessMapTransform)),v.roughness.value=E.roughness,E.roughnessMap&&(v.roughnessMap.value=E.roughnessMap,n(E.roughnessMap,v.roughnessMapTransform)),E.envMap&&(v.envMapIntensity.value=E.envMapIntensity)}(a,c),c.isMeshPhysicalMaterial&&function(v,E,C){v.ior.value=E.ior,E.sheen>0&&(v.sheenColor.value.copy(E.sheenColor).multiplyScalar(E.sheen),v.sheenRoughness.value=E.sheenRoughness,E.sheenColorMap&&(v.sheenColorMap.value=E.sheenColorMap,n(E.sheenColorMap,v.sheenColorMapTransform)),E.sheenRoughnessMap&&(v.sheenRoughnessMap.value=E.sheenRoughnessMap,n(E.sheenRoughnessMap,v.sheenRoughnessMapTransform))),E.clearcoat>0&&(v.clearcoat.value=E.clearcoat,v.clearcoatRoughness.value=E.clearcoatRoughness,E.clearcoatMap&&(v.clearcoatMap.value=E.clearcoatMap,n(E.clearcoatMap,v.clearcoatMapTransform)),E.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=E.clearcoatRoughnessMap,n(E.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),E.clearcoatNormalMap&&(v.clearcoatNormalMap.value=E.clearcoatNormalMap,n(E.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(E.clearcoatNormalScale),E.side===Lt&&v.clearcoatNormalScale.value.negate())),E.dispersion>0&&(v.dispersion.value=E.dispersion),E.iridescence>0&&(v.iridescence.value=E.iridescence,v.iridescenceIOR.value=E.iridescenceIOR,v.iridescenceThicknessMinimum.value=E.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=E.iridescenceThicknessRange[1],E.iridescenceMap&&(v.iridescenceMap.value=E.iridescenceMap,n(E.iridescenceMap,v.iridescenceMapTransform)),E.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=E.iridescenceThicknessMap,n(E.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),E.transmission>0&&(v.transmission.value=E.transmission,v.transmissionSamplerMap.value=C.texture,v.transmissionSamplerSize.value.set(C.width,C.height),E.transmissionMap&&(v.transmissionMap.value=E.transmissionMap,n(E.transmissionMap,v.transmissionMapTransform)),v.thickness.value=E.thickness,E.thicknessMap&&(v.thicknessMap.value=E.thicknessMap,n(E.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=E.attenuationDistance,v.attenuationColor.value.copy(E.attenuationColor)),E.anisotropy>0&&(v.anisotropyVector.value.set(E.anisotropy*Math.cos(E.anisotropyRotation),E.anisotropy*Math.sin(E.anisotropyRotation)),E.anisotropyMap&&(v.anisotropyMap.value=E.anisotropyMap,n(E.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=E.specularIntensity,v.specularColor.value.copy(E.specularColor),E.specularColorMap&&(v.specularColorMap.value=E.specularColorMap,n(E.specularColorMap,v.specularColorMapTransform)),E.specularIntensityMap&&(v.specularIntensityMap.value=E.specularIntensityMap,n(E.specularIntensityMap,v.specularIntensityMapTransform))}(a,c,m)):c.isMeshMatcapMaterial?(s(a,c),function(v,E){E.matcap&&(v.matcap.value=E.matcap)}(a,c)):c.isMeshDepthMaterial?s(a,c):c.isMeshDistanceMaterial?(s(a,c),function(v,E){const C=e.get(E).light;v.referencePosition.value.setFromMatrixPosition(C.matrixWorld),v.nearDistance.value=C.shadow.camera.near,v.farDistance.value=C.shadow.camera.far}(a,c)):c.isMeshNormalMaterial?s(a,c):c.isLineBasicMaterial?(function(v,E){v.diffuse.value.copy(E.color),v.opacity.value=E.opacity,E.map&&(v.map.value=E.map,n(E.map,v.mapTransform))}(a,c),c.isLineDashedMaterial&&function(v,E){v.dashSize.value=E.dashSize,v.totalSize.value=E.dashSize+E.gapSize,v.scale.value=E.scale}(a,c)):c.isPointsMaterial?function(v,E,C,M){v.diffuse.value.copy(E.color),v.opacity.value=E.opacity,v.size.value=E.size*C,v.scale.value=.5*M,E.map&&(v.map.value=E.map,n(E.map,v.uvTransform)),E.alphaMap&&(v.alphaMap.value=E.alphaMap,n(E.alphaMap,v.alphaMapTransform)),E.alphaTest>0&&(v.alphaTest.value=E.alphaTest)}(a,c,u,A):c.isSpriteMaterial?function(v,E){v.diffuse.value.copy(E.color),v.opacity.value=E.opacity,v.rotation.value=E.rotation,E.map&&(v.map.value=E.map,n(E.map,v.mapTransform)),E.alphaMap&&(v.alphaMap.value=E.alphaMap,n(E.alphaMap,v.alphaMapTransform)),E.alphaTest>0&&(v.alphaTest.value=E.alphaTest)}(a,c):c.isShadowMaterial?(a.color.value.copy(c.color),a.opacity.value=c.opacity):c.isShaderMaterial&&(c.uniformsNeedUpdate=!1)}}}function Ok(r,e,n,s){let a={},c={},u=[];const A=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function m(C,M,S,B){const N=C.value,L=M+"_"+S;if(B[L]===void 0)return B[L]=typeof N=="number"||typeof N=="boolean"?N:N.clone(),!0;{const F=B[L];if(typeof N=="number"||typeof N=="boolean"){if(F!==N)return B[L]=N,!0}else if(F.equals(N)===!1)return F.copy(N),!0}return!1}function v(C){const M={boundary:0,storage:0};return typeof C=="number"||typeof C=="boolean"?(M.boundary=4,M.storage=4):C.isVector2?(M.boundary=8,M.storage=8):C.isVector3||C.isColor?(M.boundary=16,M.storage=12):C.isVector4?(M.boundary=16,M.storage=16):C.isMatrix3?(M.boundary=48,M.storage=48):C.isMatrix4?(M.boundary=64,M.storage=64):C.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",C),M}function E(C){const M=C.target;M.removeEventListener("dispose",E);const S=u.indexOf(M.__bindingPointIndex);u.splice(S,1),r.deleteBuffer(a[M.id]),delete a[M.id],delete c[M.id]}return{bind:function(C,M){const S=M.program;s.uniformBlockBinding(C,S)},update:function(C,M){let S=a[C.id];S===void 0&&(function(L){const F=L.uniforms;let O=0;for(let X=0,$=F.length;X<$;X++){const ee=Array.isArray(F[X])?F[X]:[F[X]];for(let ie=0,ce=ee.length;ie<ce;ie++){const oe=ee[ie],Se=Array.isArray(oe.value)?oe.value:[oe.value];for(let Ne=0,ke=Se.length;Ne<ke;Ne++){const Oe=v(Se[Ne]),Te=O%16,Je=Te%Oe.boundary,st=Te+Je;O+=Je,st!==0&&16-st<Oe.storage&&(O+=16-st),oe.__data=new Float32Array(Oe.storage/Float32Array.BYTES_PER_ELEMENT),oe.__offset=O,O+=Oe.storage}}}const H=O%16;H>0&&(O+=16-H),L.__size=O,L.__cache={}}(C),S=function(L){const F=function(){for(let $=0;$<A;$++)if(u.indexOf($)===-1)return u.push($),$;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();L.__bindingPointIndex=F;const O=r.createBuffer(),H=L.__size,X=L.usage;return r.bindBuffer(r.UNIFORM_BUFFER,O),r.bufferData(r.UNIFORM_BUFFER,H,X),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,F,O),O}(C),a[C.id]=S,C.addEventListener("dispose",E));const B=M.program;s.updateUBOMapping(C,B);const N=e.render.frame;c[C.id]!==N&&(function(L){const F=a[L.id],O=L.uniforms,H=L.__cache;r.bindBuffer(r.UNIFORM_BUFFER,F);for(let X=0,$=O.length;X<$;X++){const ee=Array.isArray(O[X])?O[X]:[O[X]];for(let ie=0,ce=ee.length;ie<ce;ie++){const oe=ee[ie];if(m(oe,X,ie,H)===!0){const Se=oe.__offset,Ne=Array.isArray(oe.value)?oe.value:[oe.value];let ke=0;for(let Oe=0;Oe<Ne.length;Oe++){const Te=Ne[Oe],Je=v(Te);typeof Te=="number"||typeof Te=="boolean"?(oe.__data[0]=Te,r.bufferSubData(r.UNIFORM_BUFFER,Se+ke,oe.__data)):Te.isMatrix3?(oe.__data[0]=Te.elements[0],oe.__data[1]=Te.elements[1],oe.__data[2]=Te.elements[2],oe.__data[3]=0,oe.__data[4]=Te.elements[3],oe.__data[5]=Te.elements[4],oe.__data[6]=Te.elements[5],oe.__data[7]=0,oe.__data[8]=Te.elements[6],oe.__data[9]=Te.elements[7],oe.__data[10]=Te.elements[8],oe.__data[11]=0):(Te.toArray(oe.__data,ke),ke+=Je.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,Se,oe.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}(C),c[C.id]=N)},dispose:function(){for(const C in a)r.deleteBuffer(a[C]);u=[],a={},c={}}}}class kk{constructor(e={}){const{canvas:n=fl(),context:s=null,depth:a=!0,stencil:c=!1,alpha:u=!1,antialias:A=!1,premultipliedAlpha:m=!0,preserveDrawingBuffer:v=!1,powerPreference:E="default",failIfMajorPerformanceCaveat:C=!1,reverseDepthBuffer:M=!1,multiviewStereo:S=!1}=e;let B;if(this.isWebGLRenderer=!0,s!==null){if(typeof WebGLRenderingContext<"u"&&s instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");B=s.getContextAttributes().alpha}else B=u;const N=new Uint32Array(4),L=new Int32Array(4);let F=null,O=null;const H=[],X=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=si,this.toneMapping=ur,this.toneMappingExposure=1;const $=this;let ee=!1,ie=0,ce=0,oe=null,Se=-1,Ne=null;const ke=new pi,Oe=new pi;let Te=null;const Je=new Mt(0);let st=0,Et=n.width,dt=n.height,Bt=1,qt=null,Kt=null;const Jt=new pi(0,0,Et,dt),ln=new pi(0,0,Et,dt);let Ot=!1;const nt=new If;let Rt=!1,jt=!1;this.transmissionResolutionScale=1;const It=new Qt,mt=new Qt,vt=new R,re=new pi,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ae=!1;function xe(){return oe===null?Bt:1}let ge,Ee,Ue,Xe,at,Xt,gt,cn,yn,tn,hn,Yn,Kn,Ei,Hi,li,an,Ni,fi,Ia,Mn,dr,mi,Cl,Cc,Le=s;function pR(se,We){return n.getContext(se,We)}try{const se={alpha:!0,depth:a,stencil:c,antialias:A,premultipliedAlpha:m,preserveDrawingBuffer:v,powerPreference:E,failIfMajorPerformanceCaveat:C};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${bo}`),n.addEventListener("webglcontextlost",fR,!1),n.addEventListener("webglcontextrestored",mR,!1),n.addEventListener("webglcontextcreationerror",gR,!1),Le===null){const We="webgl2";if(Le=pR(We,se),Le===null)throw pR(We)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(se){throw console.error("THREE.WebGLRenderer: "+se.message),se}function AR(){ge=new pO(Le),ge.init(),mi=new mT(Le,ge),Ee=new cO(Le,ge,e,mi),Ue=new Lk(Le,ge),Ee.reverseDepthBuffer&&M&&Ue.buffers.depth.setReversed(!0),Xe=new mO(Le),at=new _k,Xt=new Dk(Le,ge,Ue,at,Ee,mi,Xe),gt=new uO($),cn=new dO($),yn=new rO(Le),Cl=new oO(Le,yn),tn=new AO(Le,yn,Xe,Cl),hn=new yO(Le,tn,yn,Xe),Ia=new gO(Le,Ee,Xt),li=new hO(at),Yn=new xk($,gt,cn,ge,Ee,Cl,li),Kn=new Fk($,at),Ei=new Ck,Hi=new Tk(ge),fi=new aO($,gt,cn,Ue,hn,B,m),Ni=new vO($,ge,Le),an=new Bk($,hn,Ee),Cc=new Ok(Le,Xe,Ee,Ue),Mn=new lO(Le,ge,Xe),dr=new fO(Le,ge,Xe),Xe.programs=Yn.programs,$.capabilities=Ee,$.extensions=ge,$.properties=at,$.renderLists=Ei,$.shadowMap=an,$.state=Ue,$.info=Xe}AR();const Vr=new Uk($,Le);function fR(se){se.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ee=!0}function mR(){console.log("THREE.WebGLRenderer: Context Restored."),ee=!1;const se=Xe.autoReset,We=an.enabled,it=an.autoUpdate,xt=an.needsUpdate,Ze=an.type;AR(),Xe.autoReset=se,an.enabled=We,an.autoUpdate=it,an.needsUpdate=xt,an.type=Ze}function gR(se){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",se.statusMessage)}function vR(se){const We=se.target;We.removeEventListener("dispose",vR),function(it){(function(xt){const Ze=at.get(xt).programs;Ze!==void 0&&(Ze.forEach(function(St){Yn.releaseProgram(St)}),xt.isShaderMaterial&&Yn.releaseShaderCache(xt))})(it),at.remove(it)}(We)}function yR(se,We,it){se.transparent===!0&&se.side===Dt&&se.forceSinglePass===!1?(se.side=Lt,se.needsUpdate=!0,ey(se,We,it),se.side=ut,se.needsUpdate=!0,ey(se,We,it),se.side=Dt):ey(se,We,it)}this.xr=Vr,this.getContext=function(){return Le},this.getContextAttributes=function(){return Le.getContextAttributes()},this.forceContextLoss=function(){const se=ge.get("WEBGL_lose_context");se&&se.loseContext()},this.forceContextRestore=function(){const se=ge.get("WEBGL_lose_context");se&&se.restoreContext()},this.getPixelRatio=function(){return Bt},this.setPixelRatio=function(se){se!==void 0&&(Bt=se,this.setSize(Et,dt,!1))},this.getSize=function(se){return se.set(Et,dt)},this.setSize=function(se,We,it=!0){Vr.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Et=se,dt=We,n.width=Math.floor(se*Bt),n.height=Math.floor(We*Bt),it===!0&&(n.style.width=se+"px",n.style.height=We+"px"),this.setViewport(0,0,se,We))},this.getDrawingBufferSize=function(se){return se.set(Et*Bt,dt*Bt).floor()},this.setDrawingBufferSize=function(se,We,it){Et=se,dt=We,Bt=it,n.width=Math.floor(se*it),n.height=Math.floor(We*it),this.setViewport(0,0,se,We)},this.getCurrentViewport=function(se){return se.copy(ke)},this.getViewport=function(se){return se.copy(Jt)},this.setViewport=function(se,We,it,xt){se.isVector4?Jt.set(se.x,se.y,se.z,se.w):Jt.set(se,We,it,xt),Ue.viewport(ke.copy(Jt).multiplyScalar(Bt).round())},this.getScissor=function(se){return se.copy(ln)},this.setScissor=function(se,We,it,xt){se.isVector4?ln.set(se.x,se.y,se.z,se.w):ln.set(se,We,it,xt),Ue.scissor(Oe.copy(ln).multiplyScalar(Bt).round())},this.getScissorTest=function(){return Ot},this.setScissorTest=function(se){Ue.setScissorTest(Ot=se)},this.setOpaqueSort=function(se){qt=se},this.setTransparentSort=function(se){Kt=se},this.getClearColor=function(se){return se.copy(fi.getClearColor())},this.setClearColor=function(){fi.setClearColor.apply(fi,arguments)},this.getClearAlpha=function(){return fi.getClearAlpha()},this.setClearAlpha=function(){fi.setClearAlpha.apply(fi,arguments)},this.clear=function(se=!0,We=!0,it=!0){let xt=0;if(se){let Ze=!1;if(oe!==null){const St=oe.texture.format;Ze=St===au||St===Qd||St===su}if(Ze){const St=oe.texture.type,$t=St===Er||St===So||St===cl||St===hl||St===tu||St===Xl,Zt=fi.getClearColor(),En=fi.getClearAlpha(),Vn=Zt.r,Gn=Zt.g,Wn=Zt.b;$t?(N[0]=Vn,N[1]=Gn,N[2]=Wn,N[3]=En,Le.clearBufferuiv(Le.COLOR,0,N)):(L[0]=Vn,L[1]=Gn,L[2]=Wn,L[3]=En,Le.clearBufferiv(Le.COLOR,0,L))}else xt|=Le.COLOR_BUFFER_BIT}We&&(xt|=Le.DEPTH_BUFFER_BIT),it&&(xt|=Le.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Le.clear(xt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",fR,!1),n.removeEventListener("webglcontextrestored",mR,!1),n.removeEventListener("webglcontextcreationerror",gR,!1),fi.dispose(),Ei.dispose(),Hi.dispose(),at.dispose(),gt.dispose(),cn.dispose(),hn.dispose(),Cl.dispose(),Cc.dispose(),Yn.dispose(),Vr.dispose(),Vr.removeEventListener("sessionstart",ER),Vr.removeEventListener("sessionend",xR),id.stop()},this.renderBufferDirect=function(se,We,it,xt,Ze,St){We===null&&(We=W);const $t=Ze.isMesh&&Ze.matrixWorld.determinant()<0,Zt=function(Mi,Mr,ia,ti,On){Mr.isScene!==!0&&(Mr=W),Xt.resetTextureUnits();const Wo=Mr.fog,CC=ti.isMeshStandardMaterial?Mr.environment:null,ty=oe===null?$.outputColorSpace:oe.isXRRenderTarget===!0?oe.texture.colorSpace:xr,Sh=(ti.isMeshStandardMaterial?cn:gt).get(ti.envMap||CC),wl=ti.vertexColors===!0&&!!ia.attributes.color&&ia.attributes.color.itemSize===4,Up=!!ia.attributes.tangent&&(!!ti.normalMap||ti.anisotropy>0),wc=!!ia.morphAttributes.position,wC=!!ia.morphAttributes.normal,Np=!!ia.morphAttributes.color;let MR=ur;ti.toneMapped&&(oe!==null&&oe.isXRRenderTarget!==!0||(MR=$.toneMapping));const X5=oe&&oe.isWebGLMultiviewRenderTarget?oe.numViews:0,SR=ia.morphAttributes.position||ia.morphAttributes.normal||ia.morphAttributes.color,Y5=SR!==void 0?SR.length:0,ci=at.get(ti),K5=O.state.lights;if(Rt===!0&&(jt===!0||Mi!==Ne)){const fo=Mi===Ne&&ti.id===Se;li.setState(ti,Mi,fo)}let jo=!1;ti.version===ci.__version?ci.needsLights&&ci.lightsStateVersion!==K5.state.version||ci.outputColorSpace!==ty||On.isBatchedMesh&&ci.batching===!1?jo=!0:On.isBatchedMesh||ci.batching!==!0?On.isBatchedMesh&&ci.batchingColor===!0&&On.colorTexture===null||On.isBatchedMesh&&ci.batchingColor===!1&&On.colorTexture!==null||On.isInstancedMesh&&ci.instancing===!1?jo=!0:On.isInstancedMesh||ci.instancing!==!0?On.isSkinnedMesh&&ci.skinning===!1?jo=!0:On.isSkinnedMesh||ci.skinning!==!0?On.isInstancedMesh&&ci.instancingColor===!0&&On.instanceColor===null||On.isInstancedMesh&&ci.instancingColor===!1&&On.instanceColor!==null||On.isInstancedMesh&&ci.instancingMorph===!0&&On.morphTexture===null||On.isInstancedMesh&&ci.instancingMorph===!1&&On.morphTexture!==null||ci.envMap!==Sh||ti.fog===!0&&ci.fog!==Wo?jo=!0:ci.numClippingPlanes===void 0||ci.numClippingPlanes===li.numPlanes&&ci.numIntersection===li.numIntersection?(ci.vertexAlphas!==wl||ci.vertexTangents!==Up||ci.morphTargets!==wc||ci.morphNormals!==wC||ci.morphColors!==Np||ci.toneMapping!==MR||ci.morphTargetsCount!==Y5||ci.numMultiviewViews!==X5)&&(jo=!0):jo=!0:jo=!0:jo=!0:jo=!0:(jo=!0,ci.__version=ti.version);let Mc=ci.currentProgram;jo===!0&&(Mc=ey(ti,Mr,On));let IR=!1,gm=!1,MC=!1;const pr=Mc.getUniforms(),Ih=ci.uniforms;if(Ue.useProgram(Mc.program)&&(IR=!0,gm=!0,MC=!0),ti.id!==Se&&(Se=ti.id,gm=!0),IR||Ne!==Mi){Mc.numMultiviewViews>0?(Ni.updateCameraProjectionMatricesUniform(Mi,pr),Ni.updateCameraViewMatricesUniform(Mi,pr)):(Ue.buffers.depth.getReversed()?(It.copy(Mi.projectionMatrix),function(rd){const Ar=rd.elements;Ar[2]=.5*Ar[2]+.5*Ar[3],Ar[6]=.5*Ar[6]+.5*Ar[7],Ar[10]=.5*Ar[10]+.5*Ar[11],Ar[14]=.5*Ar[14]+.5*Ar[15]}(It),function(rd){const Ar=rd.elements;Ar[11]===-1?(Ar[10]=-Ar[10]-1,Ar[14]=-Ar[14]):(Ar[10]=-Ar[10],Ar[14]=1-Ar[14])}(It),pr.setValue(Le,"projectionMatrix",It)):pr.setValue(Le,"projectionMatrix",Mi.projectionMatrix),pr.setValue(Le,"viewMatrix",Mi.matrixWorldInverse));const fo=pr.map.cameraPosition;fo!==void 0&&fo.setValue(Le,vt.setFromMatrixPosition(Mi.matrixWorld)),Ee.logarithmicDepthBuffer&&pr.setValue(Le,"logDepthBufFC",2/(Math.log(Mi.far+1)/Math.LN2)),(ti.isMeshPhongMaterial||ti.isMeshToonMaterial||ti.isMeshLambertMaterial||ti.isMeshBasicMaterial||ti.isMeshStandardMaterial||ti.isShaderMaterial)&&pr.setValue(Le,"isOrthographic",Mi.isOrthographicCamera===!0),Ne!==Mi&&(Ne=Mi,gm=!0,MC=!0)}if(On.isSkinnedMesh){pr.setOptional(Le,On,"bindMatrix"),pr.setOptional(Le,On,"bindMatrixInverse");const fo=On.skeleton;fo&&(fo.boneTexture===null&&fo.computeBoneTexture(),pr.setValue(Le,"boneTexture",fo.boneTexture,Xt))}On.isBatchedMesh&&(pr.setOptional(Le,On,"batchingTexture"),pr.setValue(Le,"batchingTexture",On._matricesTexture,Xt),pr.setOptional(Le,On,"batchingIdTexture"),pr.setValue(Le,"batchingIdTexture",On._indirectTexture,Xt),pr.setOptional(Le,On,"batchingColorTexture"),On._colorsTexture!==null&&pr.setValue(Le,"batchingColorTexture",On._colorsTexture,Xt));const SC=ia.morphAttributes;var Ml,qo;if(SC.position===void 0&&SC.normal===void 0&&SC.color===void 0||Ia.update(On,ia,Mc),(gm||ci.receiveShadow!==On.receiveShadow)&&(ci.receiveShadow=On.receiveShadow,pr.setValue(Le,"receiveShadow",On.receiveShadow)),ti.isMeshGouraudMaterial&&ti.envMap!==null&&(Ih.envMap.value=Sh,Ih.flipEnvMap.value=Sh.isCubeTexture&&Sh.isRenderTargetTexture===!1?-1:1),ti.isMeshStandardMaterial&&ti.envMap===null&&Mr.environment!==null&&(Ih.envMapIntensity.value=Mr.environmentIntensity),gm&&(pr.setValue(Le,"toneMappingExposure",$.toneMappingExposure),ci.needsLights&&(qo=MC,(Ml=Ih).ambientLightColor.needsUpdate=qo,Ml.lightProbe.needsUpdate=qo,Ml.directionalLights.needsUpdate=qo,Ml.directionalLightShadows.needsUpdate=qo,Ml.pointLights.needsUpdate=qo,Ml.pointLightShadows.needsUpdate=qo,Ml.spotLights.needsUpdate=qo,Ml.spotLightShadows.needsUpdate=qo,Ml.rectAreaLights.needsUpdate=qo,Ml.hemisphereLights.needsUpdate=qo),Wo&&ti.fog===!0&&Kn.refreshFogUniforms(Ih,Wo),Kn.refreshMaterialUniforms(Ih,ti,Bt,dt,O.state.transmissionRenderTarget[Mi.id]),rv.upload(Le,CR(ci),Ih,Xt)),ti.isShaderMaterial&&ti.uniformsNeedUpdate===!0&&(rv.upload(Le,CR(ci),Ih,Xt),ti.uniformsNeedUpdate=!1),ti.isSpriteMaterial&&pr.setValue(Le,"center",On.center),Mc.numMultiviewViews>0?Ni.updateObjectMatricesUniforms(On,Mi,pr):(pr.setValue(Le,"modelViewMatrix",On.modelViewMatrix),pr.setValue(Le,"normalMatrix",On.normalMatrix)),pr.setValue(Le,"modelMatrix",On.matrixWorld),ti.isShaderMaterial||ti.isRawShaderMaterial){const fo=ti.uniformsGroups;for(let rd=0,Ar=fo.length;rd<Ar;rd++){const TR=fo[rd];Cc.update(TR,Mc),Cc.bind(TR,Mc)}}return Mc}(se,We,it,xt,Ze);Ue.setMaterial(xt,$t);let En=it.index,Vn=1;if(xt.wireframe===!0){if(En=tn.getWireframeAttribute(it),En===void 0)return;Vn=2}const Gn=it.drawRange,Wn=it.attributes.position;let ri=Gn.start*Vn,Zi=(Gn.start+Gn.count)*Vn;St!==null&&(ri=Math.max(ri,St.start*Vn),Zi=Math.min(Zi,(St.start+St.count)*Vn)),En!==null?(ri=Math.max(ri,0),Zi=Math.min(Zi,En.count)):Wn!=null&&(ri=Math.max(ri,0),Zi=Math.min(Zi,Wn.count));const kr=Zi-ri;if(kr<0||kr===1/0)return;let Ji;Cl.setup(Ze,xt,Zt,it,En);let er=Mn;if(En!==null&&(Ji=yn.get(En),er=dr,er.setIndex(Ji)),Ze.isMesh)xt.wireframe===!0?(Ue.setLineWidth(xt.wireframeLinewidth*xe()),er.setMode(Le.LINES)):er.setMode(Le.TRIANGLES);else if(Ze.isLine){let Mi=xt.linewidth;Mi===void 0&&(Mi=1),Ue.setLineWidth(Mi*xe()),Ze.isLineSegments?er.setMode(Le.LINES):Ze.isLineLoop?er.setMode(Le.LINE_LOOP):er.setMode(Le.LINE_STRIP)}else Ze.isPoints?er.setMode(Le.POINTS):Ze.isSprite&&er.setMode(Le.TRIANGLES);if(Ze.isBatchedMesh)if(Ze._multiDrawInstances!==null)er.renderMultiDrawInstances(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount,Ze._multiDrawInstances);else if(ge.get("WEBGL_multi_draw"))er.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else{const Mi=Ze._multiDrawStarts,Mr=Ze._multiDrawCounts,ia=Ze._multiDrawCount,ti=En?yn.get(En).bytesPerElement:1,On=at.get(xt).currentProgram.getUniforms();for(let Wo=0;Wo<ia;Wo++)On.setValue(Le,"_gl_DrawID",Wo),er.render(Mi[Wo]/ti,Mr[Wo])}else if(Ze.isInstancedMesh)er.renderInstances(ri,kr,Ze.count);else if(it.isInstancedBufferGeometry){const Mi=it._maxInstanceCount!==void 0?it._maxInstanceCount:1/0,Mr=Math.min(it.instanceCount,Mi);er.renderInstances(ri,kr,Mr)}else er.render(ri,kr)},this.compile=function(se,We,it=null){it===null&&(it=se),O=Hi.get(it),O.init(We),X.push(O),it.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(We.layers)&&(O.pushLight(Ze),Ze.castShadow&&O.pushShadow(Ze))}),se!==it&&se.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(We.layers)&&(O.pushLight(Ze),Ze.castShadow&&O.pushShadow(Ze))}),O.setupLights();const xt=new Set;return se.traverse(function(Ze){if(!(Ze.isMesh||Ze.isPoints||Ze.isLine||Ze.isSprite))return;const St=Ze.material;if(St)if(Array.isArray(St))for(let $t=0;$t<St.length;$t++){const Zt=St[$t];yR(Zt,it,Ze),xt.add(Zt)}else yR(St,it,Ze),xt.add(St)}),X.pop(),O=null,xt},this.compileAsync=function(se,We,it=null){const xt=this.compile(se,We,it);return new Promise(Ze=>{function St(){xt.forEach(function($t){at.get($t).currentProgram.isReady()&&xt.delete($t)}),xt.size!==0?setTimeout(St,10):Ze(se)}ge.get("KHR_parallel_shader_compile")!==null?St():setTimeout(St,10)})};let EC=null;function ER(){id.stop()}function xR(){id.start()}const id=new HI;function xC(se,We,it,xt){if(se.visible===!1)return;if(se.layers.test(We.layers)){if(se.isGroup)it=se.renderOrder;else if(se.isLOD)se.autoUpdate===!0&&se.update(We);else if(se.isLight)O.pushLight(se),se.castShadow&&O.pushShadow(se);else if(se.isSprite){if(!se.frustumCulled||nt.intersectsSprite(se)){xt&&re.setFromMatrixPosition(se.matrixWorld).applyMatrix4(mt);const St=hn.update(se),$t=se.material;$t.visible&&F.push(se,St,$t,it,re.z,null)}}else if((se.isMesh||se.isLine||se.isPoints)&&(!se.frustumCulled||nt.intersectsObject(se))){const St=hn.update(se),$t=se.material;if(xt&&(se.boundingSphere!==void 0?(se.boundingSphere===null&&se.computeBoundingSphere(),re.copy(se.boundingSphere.center)):(St.boundingSphere===null&&St.computeBoundingSphere(),re.copy(St.boundingSphere.center)),re.applyMatrix4(se.matrixWorld).applyMatrix4(mt)),Array.isArray($t)){const Zt=St.groups;for(let En=0,Vn=Zt.length;En<Vn;En++){const Gn=Zt[En],Wn=$t[Gn.materialIndex];Wn&&Wn.visible&&F.push(se,St,Wn,it,re.z,Gn)}}else $t.visible&&F.push(se,St,$t,it,re.z,null)}}const Ze=se.children;for(let St=0,$t=Ze.length;St<$t;St++)xC(Ze[St],We,it,xt)}function _C(se,We,it,xt){const Ze=se.opaque,St=se.transmissive,$t=se.transparent;O.setupLightsView(it),Rt===!0&&li.setGlobalState($.clippingPlanes,it),xt&&Ue.viewport(ke.copy(xt)),Ze.length>0&&Zv(Ze,We,it),St.length>0&&Zv(St,We,it),$t.length>0&&Zv($t,We,it),Ue.buffers.depth.setTest(!0),Ue.buffers.depth.setMask(!0),Ue.buffers.color.setMask(!0),Ue.setPolygonOffset(!1)}function _R(se,We,it,xt){if((it.isScene===!0?it.overrideMaterial:null)!==null)return;O.state.transmissionRenderTarget[xt.id]===void 0&&(O.state.transmissionRenderTarget[xt.id]=new Us(1,1,{generateMipmaps:!0,type:ge.has("EXT_color_buffer_half_float")||ge.has("EXT_color_buffer_float")?Cs:Er,minFilter:hs,samples:4,stencilBuffer:c,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Dn.workingColorSpace}));const Ze=O.state.transmissionRenderTarget[xt.id],St=xt.viewport||ke;Ze.setSize(St.z*$.transmissionResolutionScale,St.w*$.transmissionResolutionScale);const $t=$.getRenderTarget();$.setRenderTarget(Ze),$.getClearColor(Je),st=$.getClearAlpha(),st<1&&$.setClearColor(16777215,.5),$.clear(),ae&&fi.render(it);const Zt=$.toneMapping;$.toneMapping=ur;const En=xt.viewport;if(xt.viewport!==void 0&&(xt.viewport=void 0),O.setupLightsView(xt),Rt===!0&&li.setGlobalState($.clippingPlanes,xt),Zv(se,it,xt),Xt.updateMultisampleRenderTarget(Ze),Xt.updateRenderTargetMipmap(Ze),ge.has("WEBGL_multisampled_render_to_texture")===!1){let Vn=!1;for(let Gn=0,Wn=We.length;Gn<Wn;Gn++){const ri=We[Gn],Zi=ri.object,kr=ri.geometry,Ji=ri.material,er=ri.group;if(Ji.side===Dt&&Zi.layers.test(xt.layers)){const Mi=Ji.side;Ji.side=Lt,Ji.needsUpdate=!0,bR(Zi,it,xt,kr,Ji,er),Ji.side=Mi,Ji.needsUpdate=!0,Vn=!0}}Vn===!0&&(Xt.updateMultisampleRenderTarget(Ze),Xt.updateRenderTargetMipmap(Ze))}$.setRenderTarget($t),$.setClearColor(Je,st),En!==void 0&&(xt.viewport=En),$.toneMapping=Zt}function Zv(se,We,it){const xt=We.isScene===!0?We.overrideMaterial:null;for(let Ze=0,St=se.length;Ze<St;Ze++){const $t=se[Ze],Zt=$t.object,En=$t.geometry,Vn=xt===null?$t.material:xt,Gn=$t.group;Zt.layers.test(it.layers)&&bR(Zt,We,it,En,Vn,Gn)}}function bR(se,We,it,xt,Ze,St){se.onBeforeRender($,We,it,xt,Ze,St),se.modelViewMatrix.multiplyMatrices(it.matrixWorldInverse,se.matrixWorld),se.normalMatrix.getNormalMatrix(se.modelViewMatrix),Ze.onBeforeRender($,We,it,xt,se,St),Ze.transparent===!0&&Ze.side===Dt&&Ze.forceSinglePass===!1?(Ze.side=Lt,Ze.needsUpdate=!0,$.renderBufferDirect(it,We,xt,Ze,se,St),Ze.side=ut,Ze.needsUpdate=!0,$.renderBufferDirect(it,We,xt,Ze,se,St),Ze.side=Dt):$.renderBufferDirect(it,We,xt,Ze,se,St),se.onAfterRender($,We,it,xt,Ze,St)}function ey(se,We,it){We.isScene!==!0&&(We=W);const xt=at.get(se),Ze=O.state.lights,St=O.state.shadowsArray,$t=Ze.state.version,Zt=Yn.getParameters(se,Ze.state,St,We,it),En=Yn.getProgramCacheKey(Zt);let Vn=xt.programs;xt.environment=se.isMeshStandardMaterial?We.environment:null,xt.fog=We.fog,xt.envMap=(se.isMeshStandardMaterial?cn:gt).get(se.envMap||xt.environment),xt.envMapRotation=xt.environment!==null&&se.envMap===null?We.environmentRotation:se.envMapRotation,Vn===void 0&&(se.addEventListener("dispose",vR),Vn=new Map,xt.programs=Vn);let Gn=Vn.get(En);if(Gn!==void 0){if(xt.currentProgram===Gn&&xt.lightsStateVersion===$t)return wR(se,Zt),Gn}else Zt.uniforms=Yn.getUniforms(se),se.onBeforeCompile(Zt,$),Gn=Yn.acquireProgram(Zt,En),Vn.set(En,Gn),xt.uniforms=Zt.uniforms;const Wn=xt.uniforms;return(se.isShaderMaterial||se.isRawShaderMaterial)&&se.clipping!==!0||(Wn.clippingPlanes=li.uniform),wR(se,Zt),xt.needsLights=function(ri){return ri.isMeshLambertMaterial||ri.isMeshToonMaterial||ri.isMeshPhongMaterial||ri.isMeshStandardMaterial||ri.isShadowMaterial||ri.isShaderMaterial&&ri.lights===!0}(se),xt.lightsStateVersion=$t,xt.needsLights&&(Wn.ambientLightColor.value=Ze.state.ambient,Wn.lightProbe.value=Ze.state.probe,Wn.directionalLights.value=Ze.state.directional,Wn.directionalLightShadows.value=Ze.state.directionalShadow,Wn.spotLights.value=Ze.state.spot,Wn.spotLightShadows.value=Ze.state.spotShadow,Wn.rectAreaLights.value=Ze.state.rectArea,Wn.ltc_1.value=Ze.state.rectAreaLTC1,Wn.ltc_2.value=Ze.state.rectAreaLTC2,Wn.pointLights.value=Ze.state.point,Wn.pointLightShadows.value=Ze.state.pointShadow,Wn.hemisphereLights.value=Ze.state.hemi,Wn.directionalShadowMap.value=Ze.state.directionalShadowMap,Wn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Wn.spotShadowMap.value=Ze.state.spotShadowMap,Wn.spotLightMatrix.value=Ze.state.spotLightMatrix,Wn.spotLightMap.value=Ze.state.spotLightMap,Wn.pointShadowMap.value=Ze.state.pointShadowMap,Wn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),xt.currentProgram=Gn,xt.uniformsList=null,Gn}function CR(se){if(se.uniformsList===null){const We=se.currentProgram.getUniforms();se.uniformsList=rv.seqWithValue(We.seq,se.uniforms)}return se.uniformsList}function wR(se,We){const it=at.get(se);it.outputColorSpace=We.outputColorSpace,it.batching=We.batching,it.batchingColor=We.batchingColor,it.instancing=We.instancing,it.instancingColor=We.instancingColor,it.instancingMorph=We.instancingMorph,it.skinning=We.skinning,it.morphTargets=We.morphTargets,it.morphNormals=We.morphNormals,it.morphColors=We.morphColors,it.morphTargetsCount=We.morphTargetsCount,it.numClippingPlanes=We.numClippingPlanes,it.numIntersection=We.numClipIntersection,it.vertexAlphas=We.vertexAlphas,it.vertexTangents=We.vertexTangents,it.toneMapping=We.toneMapping,it.numMultiviewViews=We.numMultiviewViews}var bC;id.setAnimationLoop(function(se){EC&&EC(se)}),typeof self<"u"&&id.setContext(self),this.setAnimationLoop=function(se){EC=se,Vr.setAnimationLoop(se),se===null?id.stop():id.start()},Vr.addEventListener("sessionstart",ER),Vr.addEventListener("sessionend",xR),this.render=function(se,We){if(We!==void 0&&We.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(ee===!0)return;if(se.matrixWorldAutoUpdate===!0&&se.updateMatrixWorld(),We.parent===null&&We.matrixWorldAutoUpdate===!0&&We.updateMatrixWorld(),Vr.enabled===!0&&Vr.isPresenting===!0&&(Vr.cameraAutoUpdate===!0&&Vr.updateCamera(We),We=Vr.getCamera()),se.isScene===!0&&se.onBeforeRender($,se,We,oe),O=Hi.get(se,X.length),O.init(We),X.push(O),mt.multiplyMatrices(We.projectionMatrix,We.matrixWorldInverse),nt.setFromProjectionMatrix(mt),jt=this.localClippingEnabled,Rt=li.init(this.clippingPlanes,jt),F=Ei.get(se,H.length),F.init(),H.push(F),Vr.enabled===!0&&Vr.isPresenting===!0){const St=$.xr.getDepthSensingMesh();St!==null&&xC(St,We,-1/0,$.sortObjects)}xC(se,We,0,$.sortObjects),F.finish(),$.sortObjects===!0&&F.sort(qt,Kt),ae=Vr.enabled===!1||Vr.isPresenting===!1||Vr.hasDepthSensing()===!1,ae&&fi.addToRenderList(F,se),this.info.render.frame++,Rt===!0&&li.beginShadows();const it=O.state.shadowsArray;an.render(it,se,We),Rt===!0&&li.endShadows(),this.info.autoReset===!0&&this.info.reset();const xt=F.opaque,Ze=F.transmissive;if(O.setupLights(),We.isArrayCamera){const St=We.cameras;if(Ze.length>0)for(let $t=0,Zt=St.length;$t<Zt;$t++)_R(xt,Ze,se,St[$t]);if(ae&&fi.render(se),Vr.enabled&&Vr.isMultiview)Xt.setDeferTextureUploads(!0),_C(F,se,We,We.cameras[0].viewport);else for(let $t=0,Zt=St.length;$t<Zt;$t++){const En=St[$t];_C(F,se,En,En.viewport)}}else Ze.length>0&&_R(xt,Ze,se,We),ae&&fi.render(se),_C(F,se,We);oe!==null&&ce===0&&(Xt.updateMultisampleRenderTarget(oe),Xt.updateRenderTargetMipmap(oe)),se.isScene===!0&&se.onAfterRender($,se,We),Cl.resetDefaultState(),Se=-1,Ne=null,X.pop(),X.length>0?(O=X[X.length-1],Rt===!0&&li.setGlobalState($.clippingPlanes,O.state.camera)):O=null,H.pop(),F=H.length>0?H[H.length-1]:null},this.setTexture2D=(bC=!1,function(se,We){se&&se.isWebGLRenderTarget&&(bC||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),bC=!0),se=se.texture),Xt.setTexture2D(se,We)}),this.getActiveCubeFace=function(){return ie},this.getActiveMipmapLevel=function(){return ce},this.getRenderTarget=function(){return oe},this.setRenderTargetTextures=function(se,We,it){at.get(se.texture).__webglTexture=We,at.get(se.depthTexture).__webglTexture=it;const xt=at.get(se);xt.__hasExternalTextures=!0,xt.__autoAllocateDepthBuffer=it===void 0,xt.__autoAllocateDepthBuffer||oe&&oe.isWebGLMultiviewRenderTarget||ge.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),xt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(se,We){const it=at.get(se);it.__webglFramebuffer=We,it.__useDefaultFramebuffer=We===void 0};const W5=Le.createFramebuffer();this.setRenderTarget=function(se,We=0,it=0){se===null&&this.xr.isPresenting&&(se=this.xr.getRenderTarget()),oe=se,ie=We,ce=it;let xt=!0,Ze=null,St=!1,$t=!1;if(se){const Zt=at.get(se);if(Zt.__useDefaultFramebuffer!==void 0)Ue.bindFramebuffer(Le.FRAMEBUFFER,null),xt=!1;else if(Zt.__webglFramebuffer===void 0)Xt.setupRenderTarget(se);else if(Zt.__hasExternalTextures)Xt.rebindTextures(se,at.get(se.texture).__webglTexture,at.get(se.depthTexture).__webglTexture);else if(se.depthBuffer){const Gn=se.depthTexture;if(Zt.__boundDepthTexture!==Gn){if(Gn!==null&&at.has(Gn)&&(se.width!==Gn.image.width||se.height!==Gn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Xt.setupDepthRenderbuffer(se)}}const En=se.texture;(En.isData3DTexture||En.isDataArrayTexture||En.isCompressedArrayTexture)&&($t=!0);const Vn=at.get(se).__webglFramebuffer;se.isWebGLCubeRenderTarget?(Ze=Array.isArray(Vn[We])?Vn[We][it]:Vn[We],St=!0):Ze=se.samples>0&&Xt.useMultisampledRTT(se)===!1?at.get(se).__webglMultisampledFramebuffer:Array.isArray(Vn)?Vn[it]:Vn,ke.copy(se.viewport),Oe.copy(se.scissor),Te=se.scissorTest}else ke.copy(Jt).multiplyScalar(Bt).floor(),Oe.copy(ln).multiplyScalar(Bt).floor(),Te=Ot;if(it!==0&&(Ze=W5),Ue.bindFramebuffer(Le.FRAMEBUFFER,Ze)&&xt&&Ue.drawBuffers(se,Ze),Ue.viewport(ke),Ue.scissor(Oe),Ue.setScissorTest(Te),St){const Zt=at.get(se.texture);Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_CUBE_MAP_POSITIVE_X+We,Zt.__webglTexture,it)}else if($t){const Zt=at.get(se.texture),En=We;Le.framebufferTextureLayer(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Zt.__webglTexture,it,En)}else if(se!==null&&it!==0){const Zt=at.get(se.texture);Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,Zt.__webglTexture,it)}Se=-1},this.readRenderTargetPixels=function(se,We,it,xt,Ze,St,$t){if(!se||!se.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Zt=at.get(se).__webglFramebuffer;if(se.isWebGLCubeRenderTarget&&$t!==void 0&&(Zt=Zt[$t]),Zt){Ue.bindFramebuffer(Le.FRAMEBUFFER,Zt);try{const En=se.texture,Vn=En.format,Gn=En.type;if(!Ee.textureFormatReadable(Vn))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Ee.textureTypeReadable(Gn))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");We>=0&&We<=se.width-xt&&it>=0&&it<=se.height-Ze&&Le.readPixels(We,it,xt,Ze,mi.convert(Vn),mi.convert(Gn),St)}finally{const En=oe!==null?at.get(oe).__webglFramebuffer:null;Ue.bindFramebuffer(Le.FRAMEBUFFER,En)}}},this.readRenderTargetPixelsAsync=async function(se,We,it,xt,Ze,St,$t){if(!se||!se.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Zt=at.get(se).__webglFramebuffer;if(se.isWebGLCubeRenderTarget&&$t!==void 0&&(Zt=Zt[$t]),Zt){const En=se.texture,Vn=En.format,Gn=En.type;if(!Ee.textureFormatReadable(Vn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ee.textureTypeReadable(Gn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(We>=0&&We<=se.width-xt&&it>=0&&it<=se.height-Ze){Ue.bindFramebuffer(Le.FRAMEBUFFER,Zt);const Wn=Le.createBuffer();Le.bindBuffer(Le.PIXEL_PACK_BUFFER,Wn),Le.bufferData(Le.PIXEL_PACK_BUFFER,St.byteLength,Le.STREAM_READ),Le.readPixels(We,it,xt,Ze,mi.convert(Vn),mi.convert(Gn),0);const ri=oe!==null?at.get(oe).__webglFramebuffer:null;Ue.bindFramebuffer(Le.FRAMEBUFFER,ri);const Zi=Le.fenceSync(Le.SYNC_GPU_COMMANDS_COMPLETE,0);return Le.flush(),await function(kr,Ji){return new Promise(function(er,Mi){setTimeout(function Mr(){switch(kr.clientWaitSync(Ji,kr.SYNC_FLUSH_COMMANDS_BIT,0)){case kr.WAIT_FAILED:Mi();break;case kr.TIMEOUT_EXPIRED:setTimeout(Mr,4);break;default:er()}},4)})}(Le,Zi),Le.bindBuffer(Le.PIXEL_PACK_BUFFER,Wn),Le.getBufferSubData(Le.PIXEL_PACK_BUFFER,0,St),Le.deleteBuffer(Wn),Le.deleteSync(Zi),St}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(se,We=null,it=0){se.isTexture!==!0&&(ml("WebGLRenderer: copyFramebufferToTexture function signature has changed."),We=arguments[0]||null,se=arguments[1]);const xt=Math.pow(2,-it),Ze=Math.floor(se.image.width*xt),St=Math.floor(se.image.height*xt),$t=We!==null?We.x:0,Zt=We!==null?We.y:0;Xt.setTexture2D(se,0),Le.copyTexSubImage2D(Le.TEXTURE_2D,it,0,0,$t,Zt,Ze,St),Ue.unbindTexture()};const j5=Le.createFramebuffer(),q5=Le.createFramebuffer();this.copyTextureToTexture=function(se,We,it=null,xt=null,Ze=0,St=null){let $t,Zt,En,Vn,Gn,Wn,ri,Zi,kr;se.isTexture!==!0&&(ml("WebGLRenderer: copyTextureToTexture function signature has changed."),xt=arguments[0]||null,se=arguments[1],We=arguments[2],St=arguments[3]||0,it=null),St===null&&(Ze!==0?(ml("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),St=Ze,Ze=0):St=0);const Ji=se.isCompressedTexture?se.mipmaps[St]:se.image;if(it!==null)$t=it.max.x-it.min.x,Zt=it.max.y-it.min.y,En=it.isBox3?it.max.z-it.min.z:1,Vn=it.min.x,Gn=it.min.y,Wn=it.isBox3?it.min.z:0;else{const wl=Math.pow(2,-Ze);$t=Math.floor(Ji.width*wl),Zt=Math.floor(Ji.height*wl),En=se.isDataArrayTexture?Ji.depth:se.isData3DTexture?Math.floor(Ji.depth*wl):1,Vn=0,Gn=0,Wn=0}xt!==null?(ri=xt.x,Zi=xt.y,kr=xt.z):(ri=0,Zi=0,kr=0);const er=mi.convert(We.format),Mi=mi.convert(We.type);let Mr;We.isData3DTexture?(Xt.setTexture3D(We,0),Mr=Le.TEXTURE_3D):We.isDataArrayTexture||We.isCompressedArrayTexture?(Xt.setTexture2DArray(We,0),Mr=Le.TEXTURE_2D_ARRAY):(Xt.setTexture2D(We,0),Mr=Le.TEXTURE_2D),Le.pixelStorei(Le.UNPACK_FLIP_Y_WEBGL,We.flipY),Le.pixelStorei(Le.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We.premultiplyAlpha),Le.pixelStorei(Le.UNPACK_ALIGNMENT,We.unpackAlignment);const ia=Le.getParameter(Le.UNPACK_ROW_LENGTH),ti=Le.getParameter(Le.UNPACK_IMAGE_HEIGHT),On=Le.getParameter(Le.UNPACK_SKIP_PIXELS),Wo=Le.getParameter(Le.UNPACK_SKIP_ROWS),CC=Le.getParameter(Le.UNPACK_SKIP_IMAGES);Le.pixelStorei(Le.UNPACK_ROW_LENGTH,Ji.width),Le.pixelStorei(Le.UNPACK_IMAGE_HEIGHT,Ji.height),Le.pixelStorei(Le.UNPACK_SKIP_PIXELS,Vn),Le.pixelStorei(Le.UNPACK_SKIP_ROWS,Gn),Le.pixelStorei(Le.UNPACK_SKIP_IMAGES,Wn);const ty=se.isDataArrayTexture||se.isData3DTexture,Sh=We.isDataArrayTexture||We.isData3DTexture;if(se.isDepthTexture){const wl=at.get(se),Up=at.get(We),wc=at.get(wl.__renderTarget),wC=at.get(Up.__renderTarget);Ue.bindFramebuffer(Le.READ_FRAMEBUFFER,wc.__webglFramebuffer),Ue.bindFramebuffer(Le.DRAW_FRAMEBUFFER,wC.__webglFramebuffer);for(let Np=0;Np<En;Np++)ty&&(Le.framebufferTextureLayer(Le.READ_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,at.get(se).__webglTexture,Ze,Wn+Np),Le.framebufferTextureLayer(Le.DRAW_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,at.get(We).__webglTexture,St,kr+Np)),Le.blitFramebuffer(Vn,Gn,$t,Zt,ri,Zi,$t,Zt,Le.DEPTH_BUFFER_BIT,Le.NEAREST);Ue.bindFramebuffer(Le.READ_FRAMEBUFFER,null),Ue.bindFramebuffer(Le.DRAW_FRAMEBUFFER,null)}else if(Ze!==0||se.isRenderTargetTexture||at.has(se)){const wl=at.get(se),Up=at.get(We);Ue.bindFramebuffer(Le.READ_FRAMEBUFFER,j5),Ue.bindFramebuffer(Le.DRAW_FRAMEBUFFER,q5);for(let wc=0;wc<En;wc++)ty?Le.framebufferTextureLayer(Le.READ_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,wl.__webglTexture,Ze,Wn+wc):Le.framebufferTexture2D(Le.READ_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,wl.__webglTexture,Ze),Sh?Le.framebufferTextureLayer(Le.DRAW_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Up.__webglTexture,St,kr+wc):Le.framebufferTexture2D(Le.DRAW_FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,Up.__webglTexture,St),Ze!==0?Le.blitFramebuffer(Vn,Gn,$t,Zt,ri,Zi,$t,Zt,Le.COLOR_BUFFER_BIT,Le.NEAREST):Sh?Le.copyTexSubImage3D(Mr,St,ri,Zi,kr+wc,Vn,Gn,$t,Zt):Le.copyTexSubImage2D(Mr,St,ri,Zi,Vn,Gn,$t,Zt);Ue.bindFramebuffer(Le.READ_FRAMEBUFFER,null),Ue.bindFramebuffer(Le.DRAW_FRAMEBUFFER,null)}else Sh?se.isDataTexture||se.isData3DTexture?Le.texSubImage3D(Mr,St,ri,Zi,kr,$t,Zt,En,er,Mi,Ji.data):We.isCompressedArrayTexture?Le.compressedTexSubImage3D(Mr,St,ri,Zi,kr,$t,Zt,En,er,Ji.data):Le.texSubImage3D(Mr,St,ri,Zi,kr,$t,Zt,En,er,Mi,Ji):se.isDataTexture?Le.texSubImage2D(Le.TEXTURE_2D,St,ri,Zi,$t,Zt,er,Mi,Ji.data):se.isCompressedTexture?Le.compressedTexSubImage2D(Le.TEXTURE_2D,St,ri,Zi,Ji.width,Ji.height,er,Ji.data):Le.texSubImage2D(Le.TEXTURE_2D,St,ri,Zi,$t,Zt,er,Mi,Ji);Le.pixelStorei(Le.UNPACK_ROW_LENGTH,ia),Le.pixelStorei(Le.UNPACK_IMAGE_HEIGHT,ti),Le.pixelStorei(Le.UNPACK_SKIP_PIXELS,On),Le.pixelStorei(Le.UNPACK_SKIP_ROWS,Wo),Le.pixelStorei(Le.UNPACK_SKIP_IMAGES,CC),St===0&&We.generateMipmaps&&Le.generateMipmap(Mr),Ue.unbindTexture()},this.copyTextureToTexture3D=function(se,We,it=null,xt=null,Ze=0){return se.isTexture!==!0&&(ml("WebGLRenderer: copyTextureToTexture3D function signature has changed."),it=arguments[0]||null,xt=arguments[1]||null,se=arguments[2],We=arguments[3],Ze=arguments[4]||0),ml('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(se,We,it,xt,Ze)},this.initRenderTarget=function(se){at.get(se).__webglFramebuffer===void 0&&Xt.setupRenderTarget(se)},this.initTexture=function(se){se.isCubeTexture?Xt.setTextureCube(se,0):se.isData3DTexture?Xt.setTexture3D(se,0):se.isDataArrayTexture||se.isCompressedArrayTexture?Xt.setTexture2DArray(se,0):Xt.setTexture2D(se,0),Ue.unbindTexture()},this.resetState=function(){ie=0,ce=0,oe=null,Ue.reset(),Cl.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ya}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorspace=Dn._getDrawingBufferColorSpace(e),n.unpackColorSpace=Dn._getUnpackColorSpace()}}const Q_=new WeakMap;class vT extends $r{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,s,a){const c=new Zr(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,u=>{this.parse(u,n,a)},s,a)}parse(e,n,s=()=>{}){this.decodeDracoFile(e,n,null,null,si,s).catch(s)}decodeDracoFile(e,n,s,a,c=xr,u=()=>{}){const A={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:a||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:c};return this.decodeGeometry(e,A).then(n).catch(u)}decodeGeometry(e,n){const s=JSON.stringify(n);if(Q_.has(e)){const m=Q_.get(e);if(m.key===s)return m.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a;const c=this.workerNextTaskID++,u=e.byteLength,A=this._getWorker(c,u).then(m=>(a=m,new Promise((v,E)=>{a._callbacks[c]={resolve:v,reject:E},a.postMessage({type:"decode",id:c,taskConfig:n,buffer:e},[e])}))).then(m=>this._createGeometry(m.geometry));return A.catch(()=>!0).then(()=>{a&&c&&this._releaseTask(a,c)}),Q_.set(e,{key:s,promise:A}),A}_createGeometry(e){const n=new vn;e.index&&n.setIndex(new qn(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const a=e.attributes[s],c=a.name,u=a.array,A=a.itemSize,m=new qn(u,A);c==="color"&&(this._assignVertexColorSpace(m,a.vertexColorSpace),m.normalized=u instanceof Float32Array==0),n.setAttribute(c,m)}return n}_assignVertexColorSpace(e,n){if(n!==si)return;const s=new Mt;for(let a=0,c=e.count;a<c;a++)s.fromBufferAttribute(e,a),Dn.toWorkingColorSpace(s,si),e.setXYZ(a,s.r,s.g,s.b)}_loadLibrary(e,n){const s=new Zr(this.manager);return s.setPath(this.decoderPath),s.setResponseType(n),s.setWithCredentials(this.withCredentials),new Promise((a,c)=>{s.load(e,a,void 0,c)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(s=>{const a=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const c=Qk.toString(),u=["/* draco decoder */",a,"","/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(c){const u=c.data;switch(u.type){case"decode":a._callbacks[u.id].resolve(u);break;case"error":a._callbacks[u.id].reject(u);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+u.type+'"')}},this.workerPool.push(a)}else this.workerPool.sort(function(a,c){return a._taskLoad>c._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=n,s._taskLoad+=n,s})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Qk(){let r,e;function n(s,a,c,u,A,m){const v=m.num_components(),E=c.num_points()*v,C=E*A.BYTES_PER_ELEMENT,M=function(N,L){switch(L){case Float32Array:return N.DT_FLOAT32;case Int8Array:return N.DT_INT8;case Int16Array:return N.DT_INT16;case Int32Array:return N.DT_INT32;case Uint8Array:return N.DT_UINT8;case Uint16Array:return N.DT_UINT16;case Uint32Array:return N.DT_UINT32}}(s,A),S=s._malloc(C);a.GetAttributeDataArrayForAllPoints(c,m,M,C,S);const B=new A(s.HEAPF32.buffer,S,E).slice();return s._free(S),{name:u,array:B,itemSize:v}}onmessage=function(s){const a=s.data;switch(a.type){case"init":r=a.decoderConfig,e=new Promise(function(A){r.onModuleLoaded=function(m){A({draco:m})},DracoDecoderModule(r)});break;case"decode":const c=a.buffer,u=a.taskConfig;e.then(A=>{const m=A.draco,v=new m.Decoder;try{const E=function(M,S,B,N){const L=N.attributeIDs,F=N.attributeTypes;let O,H;const X=S.GetEncodedGeometryType(B);if(X===M.TRIANGULAR_MESH)O=new M.Mesh,H=S.DecodeArrayToMesh(B,B.byteLength,O);else{if(X!==M.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");O=new M.PointCloud,H=S.DecodeArrayToPointCloud(B,B.byteLength,O)}if(!H.ok()||O.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+H.error_msg());const $={index:null,attributes:[]};for(const ee in L){const ie=self[F[ee]];let ce,oe;if(N.useUniqueIDs)oe=L[ee],ce=S.GetAttributeByUniqueId(O,oe);else{if(oe=S.GetAttributeId(O,M[L[ee]]),oe===-1)continue;ce=S.GetAttribute(O,oe)}const Se=n(M,S,O,ee,ie,ce);ee==="color"&&(Se.vertexColorSpace=N.vertexColorSpace),$.attributes.push(Se)}return X===M.TRIANGULAR_MESH&&($.index=function(ee,ie,ce){const oe=3*ce.num_faces(),Se=4*oe,Ne=ee._malloc(Se);ie.GetTrianglesUInt32Array(ce,Se,Ne);const ke=new Uint32Array(ee.HEAPF32.buffer,Ne,oe).slice();return ee._free(Ne),{array:ke,itemSize:1}}(M,S,O)),M.destroy(O),$}(m,v,new Int8Array(c),u),C=E.attributes.map(M=>M.array.buffer);E.index&&C.push(E.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:E},C)}catch(E){console.error(E),self.postMessage({type:"error",id:a.id,error:E.message})}finally{m.destroy(v)}})}}}function Gk(r,e,n=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!r.hasAttribute("position")||!r.hasAttribute("normal")||!r.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function s(u){if(u.normalized||u.isInterleavedBufferAttribute){const A=new Float32Array(u.count*u.itemSize);for(let m=0,v=0;m<u.count;m++)A[v++]=u.getX(m),A[v++]=u.getY(m),u.itemSize>2&&(A[v++]=u.getZ(m));return A}return u.array instanceof Float32Array?u.array:new Float32Array(u.array)}const a=r.index?r.toNonIndexed():r,c=e.generateTangents(s(a.attributes.position),s(a.attributes.normal),s(a.attributes.uv));if(n)for(let u=3;u<c.length;u+=4)c[u]*=-1;return a.setAttribute("tangent",new qn(c,4)),r!==a&&r.copy(a),r}function Hk(r,e=!1){const n=r[0].index!==null,s=new Set(Object.keys(r[0].attributes)),a=new Set(Object.keys(r[0].morphAttributes)),c={},u={},A=r[0].morphTargetsRelative,m=new vn;let v=0;for(let E=0;E<r.length;++E){const C=r[E];let M=0;if(n!==(C.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+E+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const S in C.attributes){if(!s.has(S))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+E+'. All geometries must have compatible attributes; make sure "'+S+'" attribute exists among all geometries, or in none of them.'),null;c[S]===void 0&&(c[S]=[]),c[S].push(C.attributes[S]),M++}if(M!==s.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+E+". Make sure all geometries have the same number of attributes."),null;if(A!==C.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+E+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const S in C.morphAttributes){if(!a.has(S))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+E+".  .morphAttributes must be consistent throughout all geometries."),null;u[S]===void 0&&(u[S]=[]),u[S].push(C.morphAttributes[S])}if(e){let S;if(n)S=C.index.count;else{if(C.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+E+". The geometry must have either an index or a position attribute"),null;S=C.attributes.position.count}m.addGroup(v,S,E),v+=S}}if(n){let E=0;const C=[];for(let M=0;M<r.length;++M){const S=r[M].index;for(let B=0;B<S.count;++B)C.push(S.getX(B)+E);E+=r[M].attributes.position.count}m.setIndex(C)}for(const E in c){const C=G_(c[E]);if(!C)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+E+" attribute."),null;m.setAttribute(E,C)}for(const E in u){const C=u[E][0].length;if(C===0)break;m.morphAttributes=m.morphAttributes||{},m.morphAttributes[E]=[];for(let M=0;M<C;++M){const S=[];for(let N=0;N<u[E].length;++N)S.push(u[E][N][M]);const B=G_(S);if(!B)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+E+" morphAttribute."),null;m.morphAttributes[E].push(B)}}return m}function G_(r){let e,n,s,a=-1,c=0;for(let v=0;v<r.length;++v){const E=r[v];if(e===void 0&&(e=E.array.constructor),e!==E.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(n===void 0&&(n=E.itemSize),n!==E.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(s===void 0&&(s=E.normalized),s!==E.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(a===-1&&(a=E.gpuType),a!==E.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;c+=E.count*n}const u=new e(c),A=new qn(u,n,s);let m=0;for(let v=0;v<r.length;++v){const E=r[v];if(E.isInterleavedBufferAttribute){const C=m/n;for(let M=0,S=E.count;M<S;M++)for(let B=0;B<n;B++){const N=E.getComponent(M,B);A.setComponent(M+C,B,N)}}else u.set(E.array,m);m+=E.count*n}return a!==void 0&&(A.gpuType=a),A}function zk(r){return r.isInstancedInterleavedBufferAttribute||r.isInterleavedBufferAttribute?av(r):r.isInstancedBufferAttribute?new pc().copy(r):new qn().copy(r)}function Vk(r){let e,n=0,s=0;for(let v=0,E=r.length;v<E;++v){const C=r[v];if(e===void 0&&(e=C.array.constructor),e!==C.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=C.array.length,s+=C.itemSize}const a=new up(new e(n),s);let c=0;const u=[],A=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"];for(let v=0,E=r.length;v<E;v++){const C=r[v],M=C.itemSize,S=C.count,B=new dc(a,M,c,C.normalized);u.push(B),c+=M;for(let N=0;N<S;N++)for(let L=0;L<M;L++)B[m[L]](N,C[A[L]](N))}return u}function av(r){const e=r.data.array.constructor,n=r.count,s=r.itemSize,a=r.normalized,c=new e(n*s);let u;u=r.isInstancedInterleavedBufferAttribute?new pc(c,s,a,r.meshPerAttribute):new qn(c,s,a);for(let A=0;A<n;A++)u.setX(A,r.getX(A)),s>=2&&u.setY(A,r.getY(A)),s>=3&&u.setZ(A,r.getZ(A)),s>=4&&u.setW(A,r.getW(A));return u}function Wk(r){const e=r.attributes,n=r.morphTargets,s=new Map;for(const a in e){const c=e[a];c.isInterleavedBufferAttribute&&(s.has(c)||s.set(c,av(c)),e[a]=s.get(c))}for(const a in n){const c=n[a];c.isInterleavedBufferAttribute&&(s.has(c)||s.set(c,av(c)),n[a]=s.get(c))}}function jk(r){let e=0;for(const s in r.attributes){const a=r.getAttribute(s);e+=a.count*a.itemSize*a.array.BYTES_PER_ELEMENT}const n=r.getIndex();return e+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,e}function qk(r,e=1e-4){e=Math.max(e,Number.EPSILON);const n={},s=r.getIndex(),a=r.getAttribute("position"),c=s?s.count:a.count;let u=0;const A=Object.keys(r.attributes),m={},v={},E=[],C=["getX","getY","getZ","getW"],M=["setX","setY","setZ","setW"];for(let O=0,H=A.length;O<H;O++){const X=A[O],$=r.attributes[X];m[X]=new $.constructor(new $.array.constructor($.count*$.itemSize),$.itemSize,$.normalized);const ee=r.morphAttributes[X];ee&&(v[X]||(v[X]=[]),ee.forEach((ie,ce)=>{const oe=new ie.array.constructor(ie.count*ie.itemSize);v[X][ce]=new ie.constructor(oe,ie.itemSize,ie.normalized)}))}const S=.5*e,B=Math.log10(1/e),N=Math.pow(10,B),L=S*N;for(let O=0;O<c;O++){const H=s?s.getX(O):O;let X="";for(let $=0,ee=A.length;$<ee;$++){const ie=A[$],ce=r.getAttribute(ie),oe=ce.itemSize;for(let Se=0;Se<oe;Se++)X+=~~(ce[C[Se]](H)*N+L)+","}if(X in n)E.push(n[X]);else{for(let $=0,ee=A.length;$<ee;$++){const ie=A[$],ce=r.getAttribute(ie),oe=r.morphAttributes[ie],Se=ce.itemSize,Ne=m[ie],ke=v[ie];for(let Oe=0;Oe<Se;Oe++){const Te=C[Oe],Je=M[Oe];if(Ne[Je](u,ce[Te](H)),oe)for(let st=0,Et=oe.length;st<Et;st++)ke[st][Je](u,oe[st][Te](H))}}n[X]=u,E.push(u),u++}}const F=r.clone();for(const O in r.attributes){const H=m[O];if(F.setAttribute(O,new H.constructor(H.array.slice(0,u*H.itemSize),H.itemSize,H.normalized)),O in v)for(let X=0;X<v[O].length;X++){const $=v[O][X];F.morphAttributes[O][X]=new $.constructor($.array.slice(0,u*$.itemSize),$.itemSize,$.normalized)}}return F.setIndex(E),F}function H_(r,e){if(e===nf)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(e===sh||e===Jd){let n=r.getIndex();if(n===null){const u=[],A=r.getAttribute("position");if(A===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r;for(let m=0;m<A.count;m++)u.push(m);r.setIndex(u),n=r.getIndex()}const s=n.count-2,a=[];if(e===sh)for(let u=1;u<=s;u++)a.push(n.getX(0)),a.push(n.getX(u)),a.push(n.getX(u+1));else for(let u=0;u<s;u++)u%2==0?(a.push(n.getX(u)),a.push(n.getX(u+1)),a.push(n.getX(u+2))):(a.push(n.getX(u+2)),a.push(n.getX(u+1)),a.push(n.getX(u)));a.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=r.clone();return c.setIndex(a),c.clearGroups(),c}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),r}function Xk(r){const e=new R,n=new R,s=new R,a=new R,c=new R,u=new R,A=new R,m=new R,v=new R;function E(Et,dt,Bt,qt,Kt,Jt,ln,Ot){e.fromBufferAttribute(dt,Kt),n.fromBufferAttribute(dt,Jt),s.fromBufferAttribute(dt,ln);const nt=Et.morphTargetInfluences;if(Bt&&nt){A.set(0,0,0),m.set(0,0,0),v.set(0,0,0);for(let Rt=0,jt=Bt.length;Rt<jt;Rt++){const It=nt[Rt],mt=Bt[Rt];It!==0&&(a.fromBufferAttribute(mt,Kt),c.fromBufferAttribute(mt,Jt),u.fromBufferAttribute(mt,ln),qt?(A.addScaledVector(a,It),m.addScaledVector(c,It),v.addScaledVector(u,It)):(A.addScaledVector(a.sub(e),It),m.addScaledVector(c.sub(n),It),v.addScaledVector(u.sub(s),It)))}e.add(A),n.add(m),s.add(v)}Et.isSkinnedMesh&&(Et.applyBoneTransform(Kt,e),Et.applyBoneTransform(Jt,n),Et.applyBoneTransform(ln,s)),Ot[3*Kt+0]=e.x,Ot[3*Kt+1]=e.y,Ot[3*Kt+2]=e.z,Ot[3*Jt+0]=n.x,Ot[3*Jt+1]=n.y,Ot[3*Jt+2]=n.z,Ot[3*ln+0]=s.x,Ot[3*ln+1]=s.y,Ot[3*ln+2]=s.z}const C=r.geometry,M=r.material;let S,B,N;const L=C.index,F=C.attributes.position,O=C.morphAttributes.position,H=C.morphTargetsRelative,X=C.attributes.normal,$=C.morphAttributes.position,ee=C.groups,ie=C.drawRange;let ce,oe,Se,Ne,ke,Oe,Te;const Je=new Float32Array(F.count*F.itemSize),st=new Float32Array(X.count*X.itemSize);if(L!==null)if(Array.isArray(M))for(ce=0,Se=ee.length;ce<Se;ce++)for(ke=ee[ce],Oe=Math.max(ke.start,ie.start),Te=Math.min(ke.start+ke.count,ie.start+ie.count),oe=Oe,Ne=Te;oe<Ne;oe+=3)S=L.getX(oe),B=L.getX(oe+1),N=L.getX(oe+2),E(r,F,O,H,S,B,N,Je),E(r,X,$,H,S,B,N,st);else for(Oe=Math.max(0,ie.start),Te=Math.min(L.count,ie.start+ie.count),ce=Oe,Se=Te;ce<Se;ce+=3)S=L.getX(ce),B=L.getX(ce+1),N=L.getX(ce+2),E(r,F,O,H,S,B,N,Je),E(r,X,$,H,S,B,N,st);else if(Array.isArray(M))for(ce=0,Se=ee.length;ce<Se;ce++)for(ke=ee[ce],Oe=Math.max(ke.start,ie.start),Te=Math.min(ke.start+ke.count,ie.start+ie.count),oe=Oe,Ne=Te;oe<Ne;oe+=3)S=oe,B=oe+1,N=oe+2,E(r,F,O,H,S,B,N,Je),E(r,X,$,H,S,B,N,st);else for(Oe=Math.max(0,ie.start),Te=Math.min(F.count,ie.start+ie.count),ce=Oe,Se=Te;ce<Se;ce+=3)S=ce,B=ce+1,N=ce+2,E(r,F,O,H,S,B,N,Je),E(r,X,$,H,S,B,N,st);return{positionAttribute:F,normalAttribute:X,morphedPositionAttribute:new Wt(Je,3),morphedNormalAttribute:new Wt(st,3)}}function Yk(r){if(r.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),r;let e=r.groups;if(e=e.sort((u,A)=>u.materialIndex!==A.materialIndex?u.materialIndex-A.materialIndex:u.start-A.start),r.getIndex()===null){const u=r.getAttribute("position"),A=[];for(let m=0;m<u.count;m+=3)A.push(m,m+1,m+2);r.setIndex(A)}const n=r.getIndex(),s=[];for(let u=0;u<e.length;u++){const A=e[u],m=A.start,v=m+A.count;for(let E=m;E<v;E++)s.push(n.getX(E))}r.dispose(),r.setIndex(s);let a=0;for(let u=0;u<e.length;u++){const A=e[u];A.start=a,a+=A.count}let c=e[0];r.groups=[c];for(let u=1;u<e.length;u++){const A=e[u];c.materialIndex===A.materialIndex?c.count+=A.count:(c=A,r.groups.push(c))}return r}function Kk(r,e=Math.PI/3){const n=Math.cos(e),s=100*(1+1e-10),a=[new R,new R,new R],c=new R,u=new R,A=new R,m=new R;function v(N){return`${~~(N.x*s)},${~~(N.y*s)},${~~(N.z*s)}`}const E=r.index?r.toNonIndexed():r,C=E.attributes.position,M={};for(let N=0,L=C.count/3;N<L;N++){const F=3*N,O=a[0].fromBufferAttribute(C,F+0),H=a[1].fromBufferAttribute(C,F+1),X=a[2].fromBufferAttribute(C,F+2);c.subVectors(X,H),u.subVectors(O,H);const $=new R().crossVectors(c,u).normalize();for(let ee=0;ee<3;ee++){const ie=v(a[ee]);ie in M||(M[ie]=[]),M[ie].push($)}}const S=new Float32Array(3*C.count),B=new qn(S,3,!1);for(let N=0,L=C.count/3;N<L;N++){const F=3*N,O=a[0].fromBufferAttribute(C,F+0),H=a[1].fromBufferAttribute(C,F+1),X=a[2].fromBufferAttribute(C,F+2);c.subVectors(X,H),u.subVectors(O,H),A.crossVectors(c,u).normalize();for(let $=0;$<3;$++){const ee=M[v(a[$])];m.set(0,0,0);for(let ie=0,ce=ee.length;ie<ce;ie++){const oe=ee[ie];A.dot(oe)>n&&m.add(oe)}m.normalize(),B.setXYZ(F+$,m.x,m.y,m.z)}}return E.setAttribute("normal",B),E}class z_ extends $r{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new tQ(n)}),this.register(function(n){return new nQ(n)}),this.register(function(n){return new uQ(n)}),this.register(function(n){return new dQ(n)}),this.register(function(n){return new pQ(n)}),this.register(function(n){return new rQ(n)}),this.register(function(n){return new sQ(n)}),this.register(function(n){return new aQ(n)}),this.register(function(n){return new oQ(n)}),this.register(function(n){return new eQ(n)}),this.register(function(n){return new lQ(n)}),this.register(function(n){return new iQ(n)}),this.register(function(n){return new hQ(n)}),this.register(function(n){return new cQ(n)}),this.register(function(n){return new $k(n)}),this.register(function(n){return new AQ(n)}),this.register(function(n){return new fQ(n)})}load(e,n,s,a){const c=this;let u;if(this.resourcePath!=="")u=this.resourcePath;else if(this.path!==""){const v=xl.extractUrlBase(e);u=xl.resolveURL(v,this.path)}else u=xl.extractUrlBase(e);this.manager.itemStart(e);const A=function(v){a?a(v):console.error(v),c.manager.itemError(e),c.manager.itemEnd(e)},m=new Zr(this.manager);m.setPath(this.path),m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(e,function(v){try{c.parse(v,u,function(E){n(E),c.manager.itemEnd(e)},A)}catch(E){A(E)}},s,A)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,s,a){let c;const u={},A={},m=new TextDecoder;if(typeof e=="string")c=JSON.parse(e);else if(e instanceof ArrayBuffer)if(m.decode(new Uint8Array(e,0,4))===yT){try{u[oi.KHR_BINARY_GLTF]=new mQ(e)}catch(E){return void(a&&a(E))}c=JSON.parse(u[oi.KHR_BINARY_GLTF].content)}else c=JSON.parse(m.decode(e));else c=e;if(c.asset===void 0||c.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const v=new SQ(c,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});v.fileLoader.setRequestHeader(this.requestHeader);for(let E=0;E<this.pluginCallbacks.length;E++){const C=this.pluginCallbacks[E](v);C.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),A[C.name]=C,u[C.name]=!0}if(c.extensionsUsed)for(let E=0;E<c.extensionsUsed.length;++E){const C=c.extensionsUsed[E],M=c.extensionsRequired||[];switch(C){case oi.KHR_MATERIALS_UNLIT:u[C]=new Zk;break;case oi.KHR_DRACO_MESH_COMPRESSION:u[C]=new gQ(c,this.dracoLoader);break;case oi.KHR_TEXTURE_TRANSFORM:u[C]=new vQ;break;case oi.KHR_MESH_QUANTIZATION:u[C]=new yQ;break;default:M.indexOf(C)>=0&&A[C]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+C+'".')}}v.setExtensions(u),v.setPlugins(A),v.parse(s,a)}parseAsync(e,n){const s=this;return new Promise(function(a,c){s.parse(e,n,a,c)})}}function Jk(){let r={};return{get:function(e){return r[e]},add:function(e,n){r[e]=n},remove:function(e){delete r[e]},removeAll:function(){r={}}}}const oi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class $k{constructor(e){this.parser=e,this.name=oi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let s=0,a=n.length;s<a;s++){const c=n[s];c.extensions&&c.extensions[this.name]&&c.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,c.extensions[this.name].light)}}_loadLight(e){const n=this.parser,s="light:"+e;let a=n.cache.get(s);if(a)return a;const c=n.json,u=((c.extensions&&c.extensions[this.name]||{}).lights||[])[e];let A;const m=new Mt(16777215);u.color!==void 0&&m.setRGB(u.color[0],u.color[1],u.color[2],xr);const v=u.range!==void 0?u.range:0;switch(u.type){case"directional":A=new W0(m),A.target.position.set(0,0,-1),A.add(A.target);break;case"point":A=new V0(m),A.distance=v;break;case"spot":A=new z0(m),A.distance=v,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,A.angle=u.spot.outerConeAngle,A.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,A.target.position.set(0,0,-1),A.add(A.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return A.position.set(0,0,0),gc(A,u),u.intensity!==void 0&&(A.intensity=u.intensity),A.name=n.createUniqueName(u.name||"light_"+e),a=Promise.resolve(A),n.cache.add(s,a),a}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,s=this.parser,a=s.json.nodes[e],c=(a.extensions&&a.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(u){return s._getNodeRef(n.cache,c,u)})}}class Zk{constructor(){this.name=oi.KHR_MATERIALS_UNLIT}getMaterialType(){return Jr}extendParams(e,n,s){const a=[];e.color=new Mt(1,1,1),e.opacity=1;const c=n.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const u=c.baseColorFactor;e.color.setRGB(u[0],u[1],u[2],xr),e.opacity=u[3]}c.baseColorTexture!==void 0&&a.push(s.assignTexture(e,"map",c.baseColorTexture,si))}return Promise.all(a)}}class eQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(n.emissiveIntensity=a),Promise.resolve()}}class tQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];if(u.clearcoatFactor!==void 0&&(n.clearcoat=u.clearcoatFactor),u.clearcoatTexture!==void 0&&c.push(s.assignTexture(n,"clearcoatMap",u.clearcoatTexture)),u.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=u.clearcoatRoughnessFactor),u.clearcoatRoughnessTexture!==void 0&&c.push(s.assignTexture(n,"clearcoatRoughnessMap",u.clearcoatRoughnessTexture)),u.clearcoatNormalTexture!==void 0&&(c.push(s.assignTexture(n,"clearcoatNormalMap",u.clearcoatNormalTexture)),u.clearcoatNormalTexture.scale!==void 0)){const A=u.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new ct(A,A)}return Promise.all(c)}}class nQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return n.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}class iQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];return u.iridescenceFactor!==void 0&&(n.iridescence=u.iridescenceFactor),u.iridescenceTexture!==void 0&&c.push(s.assignTexture(n,"iridescenceMap",u.iridescenceTexture)),u.iridescenceIor!==void 0&&(n.iridescenceIOR=u.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),u.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=u.iridescenceThicknessMaximum),u.iridescenceThicknessTexture!==void 0&&c.push(s.assignTexture(n,"iridescenceThicknessMap",u.iridescenceThicknessTexture)),Promise.all(c)}}class rQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[];n.sheenColor=new Mt(0,0,0),n.sheenRoughness=0,n.sheen=1;const u=a.extensions[this.name];if(u.sheenColorFactor!==void 0){const A=u.sheenColorFactor;n.sheenColor.setRGB(A[0],A[1],A[2],xr)}return u.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=u.sheenRoughnessFactor),u.sheenColorTexture!==void 0&&c.push(s.assignTexture(n,"sheenColorMap",u.sheenColorTexture,si)),u.sheenRoughnessTexture!==void 0&&c.push(s.assignTexture(n,"sheenRoughnessMap",u.sheenRoughnessTexture)),Promise.all(c)}}class sQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];return u.transmissionFactor!==void 0&&(n.transmission=u.transmissionFactor),u.transmissionTexture!==void 0&&c.push(s.assignTexture(n,"transmissionMap",u.transmissionTexture)),Promise.all(c)}}class aQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];n.thickness=u.thicknessFactor!==void 0?u.thicknessFactor:0,u.thicknessTexture!==void 0&&c.push(s.assignTexture(n,"thicknessMap",u.thicknessTexture)),n.attenuationDistance=u.attenuationDistance||1/0;const A=u.attenuationColor||[1,1,1];return n.attenuationColor=new Mt().setRGB(A[0],A[1],A[2],xr),Promise.all(c)}}class oQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return n.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class lQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];n.specularIntensity=u.specularFactor!==void 0?u.specularFactor:1,u.specularTexture!==void 0&&c.push(s.assignTexture(n,"specularIntensityMap",u.specularTexture));const A=u.specularColorFactor||[1,1,1];return n.specularColor=new Mt().setRGB(A[0],A[1],A[2],xr),u.specularColorTexture!==void 0&&c.push(s.assignTexture(n,"specularColorMap",u.specularColorTexture,si)),Promise.all(c)}}class cQ{constructor(e){this.parser=e,this.name=oi.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];return n.bumpScale=u.bumpFactor!==void 0?u.bumpFactor:1,u.bumpTexture!==void 0&&c.push(s.assignTexture(n,"bumpMap",u.bumpTexture)),Promise.all(c)}}class hQ{constructor(e){this.parser=e,this.name=oi.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return n.extensions&&n.extensions[this.name]?lo:null}extendMaterialParams(e,n){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const c=[],u=a.extensions[this.name];return u.anisotropyStrength!==void 0&&(n.anisotropy=u.anisotropyStrength),u.anisotropyRotation!==void 0&&(n.anisotropyRotation=u.anisotropyRotation),u.anisotropyTexture!==void 0&&c.push(s.assignTexture(n,"anisotropyMap",u.anisotropyTexture)),Promise.all(c)}}class uQ{constructor(e){this.parser=e,this.name=oi.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,s=n.json,a=s.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const c=a.extensions[this.name],u=n.options.ktx2Loader;if(!u){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,c.source,u)}}class dQ{constructor(e){this.parser=e,this.name=oi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,s=this.parser,a=s.json,c=a.textures[e];if(!c.extensions||!c.extensions[n])return null;const u=c.extensions[n],A=a.images[u.source];let m=s.textureLoader;if(A.uri){const v=s.options.manager.getHandler(A.uri);v!==null&&(m=v)}return this.detectSupport().then(function(v){if(v)return s.loadTextureImage(e,u.source,m);if(a.extensionsRequired&&a.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class pQ{constructor(e){this.parser=e,this.name=oi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,s=this.parser,a=s.json,c=a.textures[e];if(!c.extensions||!c.extensions[n])return null;const u=c.extensions[n],A=a.images[u.source];let m=s.textureLoader;if(A.uri){const v=s.options.manager.getHandler(A.uri);v!==null&&(m=v)}return this.detectSupport().then(function(v){if(v)return s.loadTextureImage(e,u.source,m);if(a.extensionsRequired&&a.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class AQ{constructor(e){this.name=oi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,s=n.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const a=s.extensions[this.name],c=this.parser.getDependency("buffer",a.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return c.then(function(A){const m=a.byteOffset||0,v=a.byteLength||0,E=a.count,C=a.byteStride,M=new Uint8Array(A,m,v);return u.decodeGltfBufferAsync?u.decodeGltfBufferAsync(E,C,M,a.mode,a.filter).then(function(S){return S.buffer}):u.ready.then(function(){const S=new ArrayBuffer(E*C);return u.decodeGltfBuffer(new Uint8Array(S),E,C,M,a.mode,a.filter),S})})}return null}}class fQ{constructor(e){this.name=oi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,s=n.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const a=n.meshes[s.mesh];for(const m of a.primitives)if(m.mode!==ho.TRIANGLES&&m.mode!==ho.TRIANGLE_STRIP&&m.mode!==ho.TRIANGLE_FAN&&m.mode!==void 0)return null;const c=s.extensions[this.name].attributes,u=[],A={};for(const m in c)u.push(this.parser.getDependency("accessor",c[m]).then(v=>(A[m]=v,A[m])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(m=>{const v=m.pop(),E=v.isGroup?v.children:[v],C=m[0].count,M=[];for(const S of E){const B=new Qt,N=new R,L=new ai,F=new R(1,1,1),O=new Ox(S.geometry,S.material,C);for(let H=0;H<C;H++)A.TRANSLATION&&N.fromBufferAttribute(A.TRANSLATION,H),A.ROTATION&&L.fromBufferAttribute(A.ROTATION,H),A.SCALE&&F.fromBufferAttribute(A.SCALE,H),O.setMatrixAt(H,B.compose(N,L,F));for(const H in A)if(H==="_COLOR_0"){const X=A[H];O.instanceColor=new pc(X.array,X.itemSize,X.normalized)}else H!=="TRANSLATION"&&H!=="ROTATION"&&H!=="SCALE"&&S.geometry.setAttribute(H,A[H]);kn.prototype.copy.call(O,S),this.parser.assignFinalMaterial(O),M.push(O)}return v.isGroup?(v.clear(),v.add(...M),v):M[0]}))}}const yT="glTF";class mQ{constructor(e){this.name=oi.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==yT)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const a=this.header.length-12,c=new DataView(e,12);let u=0;for(;u<a;){const A=c.getUint32(u,!0);u+=4;const m=c.getUint32(u,!0);if(u+=4,m===1313821514){const v=new Uint8Array(e,12+u,A);this.content=s.decode(v)}else if(m===5130562){const v=12+u;this.body=e.slice(v,v+A)}u+=A}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class gQ{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=oi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const s=this.json,a=this.dracoLoader,c=e.extensions[this.name].bufferView,u=e.extensions[this.name].attributes,A={},m={},v={};for(const E in u){const C=W_[E]||E.toLowerCase();A[C]=u[E]}for(const E in e.attributes){const C=W_[E]||E.toLowerCase();if(u[E]!==void 0){const M=s.accessors[e.attributes[E]],S=Mp[M.componentType];v[C]=S.name,m[C]=M.normalized===!0}}return n.getDependency("bufferView",c).then(function(E){return new Promise(function(C,M){a.decodeDracoFile(E,function(S){for(const B in S.attributes){const N=S.attributes[B],L=m[B];L!==void 0&&(N.normalized=L)}C(S)},A,v,xr,M)})})}}class vQ{constructor(){this.name=oi.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord!==void 0&&n.texCoord!==e.channel||n.offset!==void 0||n.rotation!==void 0||n.scale!==void 0)&&(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class yQ{constructor(){this.name=oi.KHR_MESH_QUANTIZATION}}class ET extends xp{constructor(e,n,s,a){super(e,n,s,a)}copySampleValue_(e){const n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,c=e*a*3+a;for(let u=0;u!==a;u++)n[u]=s[c+u];return n}interpolate_(e,n,s,a){const c=this.resultBuffer,u=this.sampleValues,A=this.valueSize,m=2*A,v=3*A,E=a-n,C=(s-n)/E,M=C*C,S=M*C,B=e*v,N=B-v,L=-2*S+3*M,F=S-M,O=1-L,H=F-M+C;for(let X=0;X!==A;X++){const $=u[N+X+A],ee=u[N+X+m]*E,ie=u[B+X+A],ce=u[B+X]*E;c[X]=O*$+H*ee+L*ie+F*ce}return c}}const EQ=new ai;class xQ extends ET{interpolate_(e,n,s,a){const c=super.interpolate_(e,n,s,a);return EQ.fromArray(c).normalize().toArray(c),c}}const ho={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Mp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xT={9728:yr,9729:bi,9984:$h,9985:Ua,9986:Mo,9987:hs},_T={33071:Dr,33648:ll,10497:ga},V_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},W_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Eh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_Q={CUBICSPLINE:void 0,LINEAR:Zl,STEP:$l};function bQ(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new gh({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ut})),r.DefaultMaterial}function qu(r,e,n){for(const s in n.extensions)r[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=n.extensions[s])}function gc(r,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(r.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function CQ(r,e){if(r.updateMorphTargets(),e.weights!==void 0)for(let n=0,s=e.weights.length;n<s;n++)r.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(r.morphTargetInfluences.length===n.length){r.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++)r.morphTargetDictionary[n[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function wQ(r){let e;const n=r.extensions&&r.extensions[oi.KHR_DRACO_MESH_COMPRESSION];if(e=n?"draco:"+n.bufferView+":"+n.indices+":"+j_(n.attributes):r.indices+":"+j_(r.attributes)+":"+r.mode,r.targets!==void 0)for(let s=0,a=r.targets.length;s<a;s++)e+=":"+j_(r.targets[s]);return e}function j_(r){let e="";const n=Object.keys(r).sort();for(let s=0,a=n.length;s<a;s++)e+=n[s]+":"+r[n[s]]+";";return e}function q_(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const MQ=new Qt;class SQ{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new Jk,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,a=-1,c=!1,u=-1;if(typeof navigator<"u"){const A=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(A)===!0;const m=A.match(/Version\/(\d+)/);a=s&&m?parseInt(m[1],10):-1,c=A.indexOf("Firefox")>-1,u=c?A.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&a<17||c&&u<98?this.textureLoader=new H0(this.options.manager):this.textureLoader=new mI(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Zr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const s=this,a=this.json,c=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(u){return u._markDefs&&u._markDefs()}),Promise.all(this._invokeAll(function(u){return u.beforeRoot&&u.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(u){const A={scene:u[0][a.scene||0],scenes:u[0],animations:u[1],cameras:u[2],asset:a.asset,parser:s,userData:{}};return qu(c,A,a),gc(A,a),Promise.all(s._invokeAll(function(m){return m.afterRoot&&m.afterRoot(A)})).then(function(){for(const m of A.scenes)m.updateMatrixWorld();e(A)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],s=this.json.meshes||[];for(let a=0,c=n.length;a<c;a++){const u=n[a].joints;for(let A=0,m=u.length;A<m;A++)e[u[A]].isBone=!0}for(let a=0,c=e.length;a<c;a++){const u=e[a];u.mesh!==void 0&&(this._addNodeRef(this.meshCache,u.mesh),u.skin!==void 0&&(s[u.mesh].isSkinnedMesh=!0)),u.camera!==void 0&&this._addNodeRef(this.cameraCache,u.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,s){if(e.refs[n]<=1)return s;const a=s.clone(),c=(u,A)=>{const m=this.associations.get(u);m!=null&&this.associations.set(A,m);for(const[v,E]of u.children.entries())c(E,A.children[v])};return c(s,a),a.name+="_instance_"+e.uses[n]++,a}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let s=0;s<n.length;s++){const a=e(n[s]);if(a)return a}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const s=[];for(let a=0;a<n.length;a++){const c=e(n[a]);c&&s.push(c)}return s}getDependency(e,n){const s=e+":"+n;let a=this.cache.get(s);if(!a){switch(e){case"scene":a=this.loadScene(n);break;case"node":a=this._invokeOne(function(c){return c.loadNode&&c.loadNode(n)});break;case"mesh":a=this._invokeOne(function(c){return c.loadMesh&&c.loadMesh(n)});break;case"accessor":a=this.loadAccessor(n);break;case"bufferView":a=this._invokeOne(function(c){return c.loadBufferView&&c.loadBufferView(n)});break;case"buffer":a=this.loadBuffer(n);break;case"material":a=this._invokeOne(function(c){return c.loadMaterial&&c.loadMaterial(n)});break;case"texture":a=this._invokeOne(function(c){return c.loadTexture&&c.loadTexture(n)});break;case"skin":a=this.loadSkin(n);break;case"animation":a=this._invokeOne(function(c){return c.loadAnimation&&c.loadAnimation(n)});break;case"camera":a=this.loadCamera(n);break;default:if(a=this._invokeOne(function(c){return c!=this&&c.getDependency&&c.getDependency(e,n)}),!a)throw new Error("Unknown type: "+e)}this.cache.add(s,a)}return a}getDependencies(e){let n=this.cache.get(e);if(!n){const s=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(a.map(function(c,u){return s.getDependency(e,u)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],s=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[oi.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(c,u){s.load(xl.resolveURL(n.uri,a.path),c,void 0,function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(s){const a=n.byteLength||0,c=n.byteOffset||0;return s.slice(c,c+a)})}loadAccessor(e){const n=this,s=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0){const u=V_[a.type],A=Mp[a.componentType],m=a.normalized===!0,v=new A(a.count*u);return Promise.resolve(new qn(v,u,m))}const c=[];return a.bufferView!==void 0?c.push(this.getDependency("bufferView",a.bufferView)):c.push(null),a.sparse!==void 0&&(c.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(c).then(function(u){const A=u[0],m=V_[a.type],v=Mp[a.componentType],E=v.BYTES_PER_ELEMENT,C=E*m,M=a.byteOffset||0,S=a.bufferView!==void 0?s.bufferViews[a.bufferView].byteStride:void 0,B=a.normalized===!0;let N,L;if(S&&S!==C){const F=Math.floor(M/S),O="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+F+":"+a.count;let H=n.cache.get(O);H||(N=new v(A,F*S,a.count*S/E),H=new up(N,S/E),n.cache.add(O,H)),L=new dc(H,m,M%S/E,B)}else N=A===null?new v(a.count*m):new v(A,M,a.count*m),L=new qn(N,m,B);if(a.sparse!==void 0){const F=V_.SCALAR,O=Mp[a.sparse.indices.componentType],H=a.sparse.indices.byteOffset||0,X=a.sparse.values.byteOffset||0,$=new O(u[1],H,a.sparse.count*F),ee=new v(u[2],X,a.sparse.count*m);A!==null&&(L=new qn(L.array.slice(),L.itemSize,L.normalized)),L.normalized=!1;for(let ie=0,ce=$.length;ie<ce;ie++){const oe=$[ie];if(L.setX(oe,ee[ie*m]),m>=2&&L.setY(oe,ee[ie*m+1]),m>=3&&L.setZ(oe,ee[ie*m+2]),m>=4&&L.setW(oe,ee[ie*m+3]),m>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}L.normalized=B}return L})}loadTexture(e){const n=this.json,s=this.options,a=n.textures[e].source,c=n.images[a];let u=this.textureLoader;if(c.uri){const A=s.manager.getHandler(c.uri);A!==null&&(u=A)}return this.loadTextureImage(e,a,u)}loadTextureImage(e,n,s){const a=this,c=this.json,u=c.textures[e],A=c.images[n],m=(A.uri||A.bufferView)+":"+u.sampler;if(this.textureCache[m])return this.textureCache[m];const v=this.loadImageSource(n,s).then(function(E){E.flipY=!1,E.name=u.name||A.name||"",E.name===""&&typeof A.uri=="string"&&A.uri.startsWith("data:image/")===!1&&(E.name=A.uri);const C=(c.samplers||{})[u.sampler]||{};return E.magFilter=xT[C.magFilter]||bi,E.minFilter=xT[C.minFilter]||hs,E.wrapS=_T[C.wrapS]||ga,E.wrapT=_T[C.wrapT]||ga,E.generateMipmaps=!E.isCompressedTexture&&E.minFilter!==yr&&E.minFilter!==bi,a.associations.set(E,{textures:e}),E}).catch(function(){return null});return this.textureCache[m]=v,v}loadImageSource(e,n){const s=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(E=>E.clone());const c=s.images[e],u=self.URL||self.webkitURL;let A=c.uri||"",m=!1;if(c.bufferView!==void 0)A=this.getDependency("bufferView",c.bufferView).then(function(E){m=!0;const C=new Blob([E],{type:c.mimeType});return A=u.createObjectURL(C),A});else if(c.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const v=Promise.resolve(A).then(function(E){return new Promise(function(C,M){let S=C;n.isImageBitmapLoader===!0&&(S=function(B){const N=new Pi(B);N.needsUpdate=!0,C(N)}),n.load(xl.resolveURL(E,a.path),S,void 0,M)})}).then(function(E){var C;return m===!0&&u.revokeObjectURL(A),gc(E,c),E.userData.mimeType=c.mimeType||((C=c.uri).search(/\.jpe?g($|\?)/i)>0||C.search(/^data\:image\/jpeg/)===0?"image/jpeg":C.search(/\.webp($|\?)/i)>0||C.search(/^data\:image\/webp/)===0?"image/webp":C.search(/\.ktx2($|\?)/i)>0||C.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"),E}).catch(function(E){throw console.error("THREE.GLTFLoader: Couldn't load texture",A),E});return this.sourceCache[e]=v,v}assignTexture(e,n,s,a){const c=this;return this.getDependency("texture",s.index).then(function(u){if(!u)return null;if(s.texCoord!==void 0&&s.texCoord>0&&((u=u.clone()).channel=s.texCoord),c.extensions[oi.KHR_TEXTURE_TRANSFORM]){const A=s.extensions!==void 0?s.extensions[oi.KHR_TEXTURE_TRANSFORM]:void 0;if(A){const m=c.associations.get(u);u=c.extensions[oi.KHR_TEXTURE_TRANSFORM].extendTexture(u,A),c.associations.set(u,m)}}return a!==void 0&&(u.colorSpace=a),e[n]=u,u})}assignFinalMaterial(e){const n=e.geometry;let s=e.material;const a=n.attributes.tangent===void 0,c=n.attributes.color!==void 0,u=n.attributes.normal===void 0;if(e.isPoints){const A="PointsMaterial:"+s.uuid;let m=this.cache.get(A);m||(m=new ph,Ur.prototype.copy.call(m,s),m.color.copy(s.color),m.map=s.map,m.sizeAttenuation=!1,this.cache.add(A,m)),s=m}else if(e.isLine){const A="LineBasicMaterial:"+s.uuid;let m=this.cache.get(A);m||(m=new zr,Ur.prototype.copy.call(m,s),m.color.copy(s.color),m.map=s.map,this.cache.add(A,m)),s=m}if(a||c||u){let A="ClonedMaterial:"+s.uuid+":";a&&(A+="derivative-tangents:"),c&&(A+="vertex-colors:"),u&&(A+="flat-shading:");let m=this.cache.get(A);m||(m=s.clone(),c&&(m.vertexColors=!0),u&&(m.flatShading=!0),a&&(m.normalScale&&(m.normalScale.y*=-1),m.clearcoatNormalScale&&(m.clearcoatNormalScale.y*=-1)),this.cache.add(A,m),this.associations.set(m,this.associations.get(s))),s=m}e.material=s}getMaterialType(){return gh}loadMaterial(e){const n=this,s=this.json,a=this.extensions,c=s.materials[e];let u;const A={},m=[];if((c.extensions||{})[oi.KHR_MATERIALS_UNLIT]){const E=a[oi.KHR_MATERIALS_UNLIT];u=E.getMaterialType(),m.push(E.extendParams(A,c,n))}else{const E=c.pbrMetallicRoughness||{};if(A.color=new Mt(1,1,1),A.opacity=1,Array.isArray(E.baseColorFactor)){const C=E.baseColorFactor;A.color.setRGB(C[0],C[1],C[2],xr),A.opacity=C[3]}E.baseColorTexture!==void 0&&m.push(n.assignTexture(A,"map",E.baseColorTexture,si)),A.metalness=E.metallicFactor!==void 0?E.metallicFactor:1,A.roughness=E.roughnessFactor!==void 0?E.roughnessFactor:1,E.metallicRoughnessTexture!==void 0&&(m.push(n.assignTexture(A,"metalnessMap",E.metallicRoughnessTexture)),m.push(n.assignTexture(A,"roughnessMap",E.metallicRoughnessTexture))),u=this._invokeOne(function(C){return C.getMaterialType&&C.getMaterialType(e)}),m.push(Promise.all(this._invokeAll(function(C){return C.extendMaterialParams&&C.extendMaterialParams(e,A)})))}c.doubleSided===!0&&(A.side=Dt);const v=c.alphaMode||"OPAQUE";if(v==="BLEND"?(A.transparent=!0,A.depthWrite=!1):(A.transparent=!1,v==="MASK"&&(A.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&u!==Jr&&(m.push(n.assignTexture(A,"normalMap",c.normalTexture)),A.normalScale=new ct(1,1),c.normalTexture.scale!==void 0)){const E=c.normalTexture.scale;A.normalScale.set(E,E)}if(c.occlusionTexture!==void 0&&u!==Jr&&(m.push(n.assignTexture(A,"aoMap",c.occlusionTexture)),c.occlusionTexture.strength!==void 0&&(A.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&u!==Jr){const E=c.emissiveFactor;A.emissive=new Mt().setRGB(E[0],E[1],E[2],xr)}return c.emissiveTexture!==void 0&&u!==Jr&&m.push(n.assignTexture(A,"emissiveMap",c.emissiveTexture,si)),Promise.all(m).then(function(){const E=new u(A);return c.name&&(E.name=c.name),gc(E,c),n.associations.set(E,{materials:e}),c.extensions&&qu(a,E,c),E})}createUniqueName(e){const n=vi.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,s=this.extensions,a=this.primitiveCache;function c(A){return s[oi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(A,n).then(function(m){return bT(m,A,n)})}const u=[];for(let A=0,m=e.length;A<m;A++){const v=e[A],E=wQ(v),C=a[E];if(C)u.push(C.promise);else{let M;M=v.extensions&&v.extensions[oi.KHR_DRACO_MESH_COMPRESSION]?c(v):bT(new vn,v,n),a[E]={primitive:v,promise:M},u.push(M)}}return Promise.all(u)}loadMesh(e){const n=this,s=this.json,a=this.extensions,c=s.meshes[e],u=c.primitives,A=[];for(let m=0,v=u.length;m<v;m++){const E=u[m].material===void 0?bQ(this.cache):this.getDependency("material",u[m].material);A.push(E)}return A.push(n.loadGeometries(u)),Promise.all(A).then(function(m){const v=m.slice(0,m.length-1),E=m[m.length-1],C=[];for(let S=0,B=E.length;S<B;S++){const N=E[S],L=u[S];let F;const O=v[S];if(L.mode===ho.TRIANGLES||L.mode===ho.TRIANGLE_STRIP||L.mode===ho.TRIANGLE_FAN||L.mode===void 0)F=c.isSkinnedMesh===!0?new Fx(N,O):new Ti(N,O),F.isSkinnedMesh===!0&&F.normalizeSkinWeights(),L.mode===ho.TRIANGLE_STRIP?F.geometry=H_(F.geometry,Jd):L.mode===ho.TRIANGLE_FAN&&(F.geometry=H_(F.geometry,sh));else if(L.mode===ho.LINES)F=new Ha(N,O);else if(L.mode===ho.LINE_STRIP)F=new yl(N,O);else if(L.mode===ho.LINE_LOOP)F=new Vx(N,O);else{if(L.mode!==ho.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+L.mode);F=new gp(N,O)}Object.keys(F.geometry.morphAttributes).length>0&&CQ(F,c),F.name=n.createUniqueName(c.name||"mesh_"+e),gc(F,c),L.extensions&&qu(a,F,L),n.assignFinalMaterial(F),C.push(F)}for(let S=0,B=C.length;S<B;S++)n.associations.set(C[S],{meshes:e,primitives:S});if(C.length===1)return c.extensions&&qu(a,C[0],c),C[0];const M=new wa;c.extensions&&qu(a,M,c),n.associations.set(M,{meshes:e});for(let S=0,B=C.length;S<B;S++)M.add(C[S]);return M})}loadCamera(e){let n;const s=this.json.cameras[e],a=s[s.type];if(a)return s.type==="perspective"?n=new Hr(Tr.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):s.type==="orthographic"&&(n=new mc(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),s.name&&(n.name=this.createUniqueName(s.name)),gc(n,s),Promise.resolve(n);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const n=this.json.skins[e],s=[];for(let a=0,c=n.joints.length;a<c;a++)s.push(this._loadNodeShallow(n.joints[a]));return n.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",n.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(a){const c=a.pop(),u=a,A=[],m=[];for(let v=0,E=u.length;v<E;v++){const C=u[v];if(C){A.push(C);const M=new Qt;c!==null&&M.fromArray(c.array,16*v),m.push(M)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[v])}return new wf(A,m)})}loadAnimation(e){const n=this.json,s=this,a=n.animations[e],c=a.name?a.name:"animation_"+e,u=[],A=[],m=[],v=[],E=[];for(let C=0,M=a.channels.length;C<M;C++){const S=a.channels[C],B=a.samplers[S.sampler],N=S.target,L=N.node,F=a.parameters!==void 0?a.parameters[B.input]:B.input,O=a.parameters!==void 0?a.parameters[B.output]:B.output;N.node!==void 0&&(u.push(this.getDependency("node",L)),A.push(this.getDependency("accessor",F)),m.push(this.getDependency("accessor",O)),v.push(B),E.push(N))}return Promise.all([Promise.all(u),Promise.all(A),Promise.all(m),Promise.all(v),Promise.all(E)]).then(function(C){const M=C[0],S=C[1],B=C[2],N=C[3],L=C[4],F=[];for(let O=0,H=M.length;O<H;O++){const X=M[O],$=S[O],ee=B[O],ie=N[O],ce=L[O];if(X===void 0)continue;X.updateMatrix&&X.updateMatrix();const oe=s._createAnimationTracks(X,$,ee,ie,ce);if(oe)for(let Se=0;Se<oe.length;Se++)F.push(oe[Se])}return new _p(c,void 0,F)})}createNodeMesh(e){const n=this.json,s=this,a=n.nodes[e];return a.mesh===void 0?null:s.getDependency("mesh",a.mesh).then(function(c){const u=s._getNodeRef(s.meshCache,a.mesh,c);return a.weights!==void 0&&u.traverse(function(A){if(A.isMesh)for(let m=0,v=a.weights.length;m<v;m++)A.morphTargetInfluences[m]=a.weights[m]}),u})}loadNode(e){const n=this,s=this.json.nodes[e],a=n._loadNodeShallow(e),c=[],u=s.children||[];for(let m=0,v=u.length;m<v;m++)c.push(n.getDependency("node",u[m]));const A=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([a,Promise.all(c),A]).then(function(m){const v=m[0],E=m[1],C=m[2];C!==null&&v.traverse(function(M){M.isSkinnedMesh&&M.bind(C,MQ)});for(let M=0,S=E.length;M<S;M++)v.add(E[M]);return v})}_loadNodeShallow(e){const n=this.json,s=this.extensions,a=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const c=n.nodes[e],u=c.name?a.createUniqueName(c.name):"",A=[],m=a._invokeOne(function(v){return v.createNodeMesh&&v.createNodeMesh(e)});return m&&A.push(m),c.camera!==void 0&&A.push(a.getDependency("camera",c.camera).then(function(v){return a._getNodeRef(a.cameraCache,c.camera,v)})),a._invokeAll(function(v){return v.createNodeAttachment&&v.createNodeAttachment(e)}).forEach(function(v){A.push(v)}),this.nodeCache[e]=Promise.all(A).then(function(v){let E;if(E=c.isBone===!0?new g0:v.length>1?new wa:v.length===1?v[0]:new kn,E!==v[0])for(let C=0,M=v.length;C<M;C++)E.add(v[C]);if(c.name&&(E.userData.name=c.name,E.name=u),gc(E,c),c.extensions&&qu(s,E,c),c.matrix!==void 0){const C=new Qt;C.fromArray(c.matrix),E.applyMatrix4(C)}else c.translation!==void 0&&E.position.fromArray(c.translation),c.rotation!==void 0&&E.quaternion.fromArray(c.rotation),c.scale!==void 0&&E.scale.fromArray(c.scale);return a.associations.has(E)||a.associations.set(E,{}),a.associations.get(E).nodes=e,E}),this.nodeCache[e]}loadScene(e){const n=this.extensions,s=this.json.scenes[e],a=this,c=new wa;s.name&&(c.name=a.createUniqueName(s.name)),gc(c,s),s.extensions&&qu(n,c,s);const u=s.nodes||[],A=[];for(let m=0,v=u.length;m<v;m++)A.push(a.getDependency("node",u[m]));return Promise.all(A).then(function(m){for(let v=0,E=m.length;v<E;v++)c.add(m[v]);return a.associations=(v=>{const E=new Map;for(const[C,M]of a.associations)(C instanceof Ur||C instanceof Pi)&&E.set(C,M);return v.traverse(C=>{const M=a.associations.get(C);M!=null&&E.set(C,M)}),E})(c),c})}_createAnimationTracks(e,n,s,a,c){const u=[],A=e.name?e.name:e.uuid,m=[];let v;switch(Eh[c.path]===Eh.weights?e.traverse(function(M){M.morphTargetInfluences&&m.push(M.name?M.name:M.uuid)}):m.push(A),Eh[c.path]){case Eh.weights:v=Du;break;case Eh.rotation:v=Pu;break;case Eh.position:case Eh.scale:v=Nu;break;default:v=s.itemSize===1?Du:Nu}const E=a.interpolation!==void 0?_Q[a.interpolation]:Zl,C=this._getArrayFromAccessor(s);for(let M=0,S=m.length;M<S;M++){const B=new v(m[M]+"."+Eh[c.path],n.array,C,E);a.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(B),u.push(B)}return u}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const s=q_(n.constructor),a=new Float32Array(n.length);for(let c=0,u=n.length;c<u;c++)a[c]=n[c]*s;n=a}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){return new(this instanceof Pu?xQ:ET)(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function bT(r,e,n){const s=e.attributes,a=[];function c(u,A){return n.getDependency("accessor",u).then(function(m){r.setAttribute(A,m)})}for(const u in s){const A=W_[u]||u.toLowerCase();A in r.attributes||a.push(c(s[u],A))}if(e.indices!==void 0&&!r.index){const u=n.getDependency("accessor",e.indices).then(function(A){r.setIndex(A)});a.push(u)}return Dn.workingColorSpace!==xr&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Dn.workingColorSpace}" not supported.`),gc(r,e),function(u,A,m){const v=A.attributes,E=new te;if(v.POSITION===void 0)return;{const S=m.json.accessors[v.POSITION],B=S.min,N=S.max;if(B===void 0||N===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(E.set(new R(B[0],B[1],B[2]),new R(N[0],N[1],N[2])),S.normalized){const L=q_(Mp[S.componentType]);E.min.multiplyScalar(L),E.max.multiplyScalar(L)}}const C=A.targets;if(C!==void 0){const S=new R,B=new R;for(let N=0,L=C.length;N<L;N++){const F=C[N];if(F.POSITION!==void 0){const O=m.json.accessors[F.POSITION],H=O.min,X=O.max;if(H!==void 0&&X!==void 0){if(B.setX(Math.max(Math.abs(H[0]),Math.abs(X[0]))),B.setY(Math.max(Math.abs(H[1]),Math.abs(X[1]))),B.setZ(Math.max(Math.abs(H[2]),Math.abs(X[2]))),O.normalized){const $=q_(Mp[O.componentType]);B.multiplyScalar($)}S.max(B)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}E.expandByVector(S)}u.boundingBox=E;const M=new on;E.getCenter(M.center),M.radius=E.min.distanceTo(E.max)/2,u.boundingSphere=M}(r,e,n),Promise.all(a).then(function(){return e.targets!==void 0?function(u,A,m){let v=!1,E=!1,C=!1;for(let N=0,L=A.length;N<L;N++){const F=A[N];if(F.POSITION!==void 0&&(v=!0),F.NORMAL!==void 0&&(E=!0),F.COLOR_0!==void 0&&(C=!0),v&&E&&C)break}if(!v&&!E&&!C)return Promise.resolve(u);const M=[],S=[],B=[];for(let N=0,L=A.length;N<L;N++){const F=A[N];if(v){const O=F.POSITION!==void 0?m.getDependency("accessor",F.POSITION):u.attributes.position;M.push(O)}if(E){const O=F.NORMAL!==void 0?m.getDependency("accessor",F.NORMAL):u.attributes.normal;S.push(O)}if(C){const O=F.COLOR_0!==void 0?m.getDependency("accessor",F.COLOR_0):u.attributes.color;B.push(O)}}return Promise.all([Promise.all(M),Promise.all(S),Promise.all(B)]).then(function(N){const L=N[0],F=N[1],O=N[2];return v&&(u.morphAttributes.position=L),E&&(u.morphAttributes.normal=F),C&&(u.morphAttributes.color=O),u.morphTargetsRelative=!0,u})}(r,e.targets,n):r})}class IQ{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const n=this.workerCreator();n.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=n}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,n){const s=this.workersResolve[e];if(s&&s(n),this.queue.length){const{resolve:a,msg:c,transfer:u}=this.queue.shift();this.workersResolve[e]=a,this.workers[e].postMessage(c,u)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,n){return new Promise(s=>{const a=this._getIdleWorker();a!==-1?(this._initWorker(a),this.workerStatus|=1<<a,this.workersResolve[a]=s,this.workers[a].postMessage(e,n)):this.queue.push({resolve:s,msg:e,transfer:n})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const CT=9,wT=15,MT=16,ST=22,IT=37,TT=43,BT=76,RT=83,LT=97,DT=100,PT=103,UT=109,NT=165,FT=166,X_=1000066e3;class TQ{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Yf{constructor(e,n,s,a){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+n,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const n=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,n}_skip(e){return this._offset+=e,this}_scan(e,n){n===void 0&&(n=0);const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==n&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}new Uint8Array([0]);const ea=[171,75,84,88,32,50,48,187,13,10,26,10];function OT(r){return new TextDecoder().decode(r)}var BQ=i(9922).hp;let Y_,vc,K_;const J_={env:{emscripten_notify_memory_growth:function(r){K_=new Uint8Array(vc.exports.memory.buffer)}}};class RQ{init(){return Y_||(Y_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+kT).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,J_)).then(this._init):WebAssembly.instantiate(BQ.from(kT,"base64"),J_).then(this._init),Y_)}_init(e){vc=e.instance,J_.env.emscripten_notify_memory_growth(0)}decode(e,n=0){if(!vc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,a=vc.exports.malloc(s);K_.set(e,a),n=n||Number(vc.exports.ZSTD_findDecompressedSize(a,s));const c=vc.exports.malloc(n),u=vc.exports.ZSTD_decompress(c,n,a,s),A=K_.slice(c,c+u);return vc.exports.free(a),vc.exports.free(c),A}}const kT="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",$_=new WeakMap;let Z_,eb=0;class za extends $r{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new IQ,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new Zr(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const n=e.loadAsync("basis_transcoder.js"),s=new Zr(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const a=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([n,a]).then(([c,u])=>{const A=za.BasisWorker.toString(),m=["/* constants */","let _EngineFormat = "+JSON.stringify(za.EngineFormat),"let _EngineType = "+JSON.stringify(za.EngineType),"let _TranscoderFormat = "+JSON.stringify(za.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(za.BasisFormat),"/* basis_transcoder.js */",c,"/* worker */",A.substring(A.indexOf("{")+1,A.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([m])),this.transcoderBinary=u,this.workerPool.setWorkerCreator(()=>{const v=new Worker(this.workerSourceURL),E=this.transcoderBinary.slice(0);return v.postMessage({type:"init",config:this.workerConfig,transcoderBinary:E},[E]),v})}),eb>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),eb++}return this.transcoderPending}load(e,n,s,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const c=new Zr(this.manager);c.setResponseType("arraybuffer"),c.setWithCredentials(this.withCredentials),c.load(e,u=>{this.parse(u,n,a)},s,a)}parse(e,n,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if($_.has(e))return $_.get(e).promise.then(n).catch(s);this._createTexture(e).then(a=>n?n(a):null).catch(s)}_createTextureFrom(e,n){const{type:s,error:a,data:{faces:c,width:u,height:A,format:m,type:v,dfdFlags:E}}=e;if(s==="error")return Promise.reject(a);let C;if(n.faceCount===6)C=new US(c,m,v);else{const M=c[0].mipmaps;C=n.layerCount>1?new PS(M,u,A,n.layerCount,m,v):new vp(M,u,A,m,v)}return C.minFilter=c[0].mipmaps.length===1?bi:hs,C.magFilter=bi,C.generateMipmaps=!1,C.needsUpdate=!0,C.colorSpace=QT(n),C.premultiplyAlpha=!!(1&E),C}async _createTexture(e,n={}){const s=function(A){const m=new Uint8Array(A.buffer,A.byteOffset,ea.length);if(m[0]!==ea[0]||m[1]!==ea[1]||m[2]!==ea[2]||m[3]!==ea[3]||m[4]!==ea[4]||m[5]!==ea[5]||m[6]!==ea[6]||m[7]!==ea[7]||m[8]!==ea[8]||m[9]!==ea[9]||m[10]!==ea[10]||m[11]!==ea[11])throw new Error("Missing KTX 2.0 identifier.");const v=new TQ,E=17*Uint32Array.BYTES_PER_ELEMENT,C=new Yf(A,ea.length,E,!0);v.vkFormat=C._nextUint32(),v.typeSize=C._nextUint32(),v.pixelWidth=C._nextUint32(),v.pixelHeight=C._nextUint32(),v.pixelDepth=C._nextUint32(),v.layerCount=C._nextUint32(),v.faceCount=C._nextUint32();const M=C._nextUint32();v.supercompressionScheme=C._nextUint32();const S=C._nextUint32(),B=C._nextUint32(),N=C._nextUint32(),L=C._nextUint32(),F=C._nextUint64(),O=C._nextUint64(),H=new Yf(A,ea.length+E,3*M*8,!0);for(let Ot=0;Ot<M;Ot++)v.levels.push({levelData:new Uint8Array(A.buffer,A.byteOffset+H._nextUint64(),H._nextUint64()),uncompressedByteLength:H._nextUint64()});const X=new Yf(A,S,B,!0),$={vendorId:X._skip(4)._nextUint16(),descriptorType:X._nextUint16(),versionNumber:X._nextUint16(),descriptorBlockSize:X._nextUint16(),colorModel:X._nextUint8(),colorPrimaries:X._nextUint8(),transferFunction:X._nextUint8(),flags:X._nextUint8(),texelBlockDimension:[X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8()],bytesPlane:[X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8()],samples:[]},ee=($.descriptorBlockSize/4-6)/4;for(let Ot=0;Ot<ee;Ot++){const nt={bitOffset:X._nextUint16(),bitLength:X._nextUint8(),channelType:X._nextUint8(),samplePosition:[X._nextUint8(),X._nextUint8(),X._nextUint8(),X._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&nt.channelType?(nt.sampleLower=X._nextInt32(),nt.sampleUpper=X._nextInt32()):(nt.sampleLower=X._nextUint32(),nt.sampleUpper=X._nextUint32()),$.samples[Ot]=nt}v.dataFormatDescriptor.length=0,v.dataFormatDescriptor.push($);const ie=new Yf(A,N,L,!0);for(;ie._offset<L;){const Ot=ie._nextUint32(),nt=ie._scan(Ot),Rt=OT(nt);if(v.keyValue[Rt]=ie._nextUint8Array(Ot-nt.byteLength-1),Rt.match(/^ktx/i)){const jt=OT(v.keyValue[Rt]);v.keyValue[Rt]=jt.substring(0,jt.lastIndexOf("\0"))}ie._skip(Ot%4?4-Ot%4:0)}if(O<=0)return v;const ce=new Yf(A,F,O,!0),oe=ce._nextUint16(),Se=ce._nextUint16(),Ne=ce._nextUint32(),ke=ce._nextUint32(),Oe=ce._nextUint32(),Te=ce._nextUint32(),Je=[];for(let Ot=0;Ot<M;Ot++)Je.push({imageFlags:ce._nextUint32(),rgbSliceByteOffset:ce._nextUint32(),rgbSliceByteLength:ce._nextUint32(),alphaSliceByteOffset:ce._nextUint32(),alphaSliceByteLength:ce._nextUint32()});const st=F+ce._offset,Et=st+Ne,dt=Et+ke,Bt=dt+Oe,qt=new Uint8Array(A.buffer,A.byteOffset+st,Ne),Kt=new Uint8Array(A.buffer,A.byteOffset+Et,ke),Jt=new Uint8Array(A.buffer,A.byteOffset+dt,Oe),ln=new Uint8Array(A.buffer,A.byteOffset+Bt,Te);return v.globalData={endpointCount:oe,selectorCount:Se,imageDescs:Je,endpointsData:qt,selectorsData:Kt,tablesData:Jt,extendedData:ln},v}(new Uint8Array(e)),a=s.vkFormat===X_&&s.dataFormatDescriptor[0].colorModel===167;if(s.vkFormat!==0&&(!a||this.workerConfig.astcHDRSupported))return async function(A){const{vkFormat:m}=A;if(tb[m]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let v;A.supercompressionScheme===2&&(Z_||(Z_=new Promise(async M=>{const S=new RQ;await S.init(),M(S)})),v=await Z_);const E=[];for(let M=0;M<A.levels.length;M++){const S=Math.max(1,A.pixelWidth>>M),B=Math.max(1,A.pixelHeight>>M),N=A.pixelDepth?Math.max(1,A.pixelDepth>>M):0,L=A.levels[M];let F,O;if(A.supercompressionScheme===0)F=L.levelData;else{if(A.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");F=v.decode(L.levelData,L.uncompressedByteLength)}O=nb[m]===Ir?new Float32Array(F.buffer,F.byteOffset,F.byteLength/Float32Array.BYTES_PER_ELEMENT):nb[m]===Cs?new Uint16Array(F.buffer,F.byteOffset,F.byteLength/Uint16Array.BYTES_PER_ELEMENT):F,E.push({data:O,width:S,height:B,depth:N})}let C;if(LQ.has(tb[m]))C=A.pixelDepth===0?new Fo(E[0].data,A.pixelWidth,A.pixelHeight):new bu(E[0].data,A.pixelWidth,A.pixelHeight,A.pixelDepth);else{if(A.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");C=new vp(E,A.pixelWidth,A.pixelHeight),C.minFilter=E.length===1?bi:hs,C.magFilter=bi}return C.mipmaps=E,C.type=nb[m],C.format=tb[m],C.colorSpace=QT(A),C.needsUpdate=!0,Promise.resolve(C)}(s);const c=n,u=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:c},[e])).then(A=>this._createTextureFrom(A.data,s));return $_.set(e,{promise:u}),u}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),eb--,this}}za.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},za.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},za.EngineFormat={RGBAFormat:nr,RGBA_ASTC_4x4_Format:th,RGB_BPTC_UNSIGNED_Format:ih,RGBA_BPTC_Format:nh,RGBA_ETC2_EAC_Format:uu,RGBA_PVRTC_4BPPV1_Format:lu,RGBA_S3TC_DXT5_Format:eh,RGB_ETC1_Format:cu,RGB_ETC2_Format:hu,RGB_PVRTC_4BPPV1_Format:pl,RGBA_S3TC_DXT1_Format:Na},za.EngineType={UnsignedByteType:Er,HalfFloatType:Cs,FloatType:Ir},za.BasisWorker=function(){let r,e,n;const s=_EngineFormat,a=_EngineType,c=_TranscoderFormat,u=_BasisFormat;self.addEventListener("message",function(C){const M=C.data;switch(M.type){case"init":r=M.config,S=M.transcoderBinary,e=new Promise(B=>{n={wasmBinary:S,onRuntimeInitialized:B},BASIS(n)}).then(()=>{n.initializeBasis(),n.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{faces:B,buffers:N,width:L,height:F,hasAlpha:O,format:H,type:X,dfdFlags:$}=function(ee){const ie=new n.KTX2File(new Uint8Array(ee));function ce(){ie.close(),ie.delete()}if(!ie.isValid())throw ce(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let oe;if(ie.isUASTC())oe=u.UASTC;else if(ie.isETC1S())oe=u.ETC1S;else{if(!ie.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");oe=u.UASTC_HDR}const Se=ie.getWidth(),Ne=ie.getHeight(),ke=ie.getLayers()||1,Oe=ie.getLevels(),Te=ie.getFaces(),Je=ie.getHasAlpha(),st=ie.getDFDFlags(),{transcoderFormat:Et,engineFormat:dt,engineType:Bt}=function(Jt,ln,Ot,nt){const Rt=m[Jt];for(let jt=0;jt<Rt.length;jt++){const It=Rt[jt];if((!It.if||r[It.if])&&It.basisFormat.includes(Jt)&&!(nt&&It.transcoderFormat.length<2)&&(!It.needsPowerOfTwo||v(ln)&&v(Ot)))return{transcoderFormat:It.transcoderFormat[nt?1:0],engineFormat:It.engineFormat[nt?1:0],engineType:It.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(oe,Se,Ne,Je);if(!Se||!Ne||!Oe)throw ce(),new Error("THREE.KTX2Loader:	Invalid texture");if(!ie.startTranscoding())throw ce(),new Error("THREE.KTX2Loader: .startTranscoding failed");const qt=[],Kt=[];for(let Jt=0;Jt<Te;Jt++){const ln=[];for(let Ot=0;Ot<Oe;Ot++){const nt=[];let Rt,jt;for(let mt=0;mt<ke;mt++){const vt=ie.getImageLevelInfo(Ot,mt,Jt);Jt!==0||Ot!==0||mt!==0||vt.origWidth%4==0&&vt.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),Oe>1?(Rt=vt.origWidth,jt=vt.origHeight):(Rt=vt.width,jt=vt.height);let re=new Uint8Array(ie.getImageTranscodedSizeInBytes(Ot,mt,0,Et));const W=ie.transcodeImage(re,Ot,mt,Jt,Et,0,-1,-1);if(Bt===a.HalfFloatType&&(re=new Uint16Array(re.buffer,re.byteOffset,re.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!W)throw ce(),new Error("THREE.KTX2Loader: .transcodeImage failed.");nt.push(re)}const It=E(nt);ln.push({data:It,width:Rt,height:jt}),Kt.push(It.buffer)}qt.push({mipmaps:ln,width:Se,height:Ne,format:dt,type:Bt})}return ce(),{faces:qt,buffers:Kt,width:Se,height:Ne,hasAlpha:Je,dfdFlags:st,format:dt,type:Bt}}(M.buffer);self.postMessage({type:"transcode",id:M.id,data:{faces:B,width:L,height:F,hasAlpha:O,format:H,type:X,dfdFlags:$}},N)}catch(B){console.error(B),self.postMessage({type:"error",id:M.id,error:B.message})}})}var S});const A=[{if:"astcSupported",basisFormat:[u.UASTC],transcoderFormat:[c.ASTC_4x4,c.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],engineType:[a.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[c.BC7_M5,c.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],engineType:[a.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[c.BC1,c.BC3],engineFormat:[s.RGBA_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],engineType:[a.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[c.ETC1,c.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],engineType:[a.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[c.ETC1],engineFormat:[s.RGB_ETC1_Format],engineType:[a.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[c.PVRTC1_4_RGB,c.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],engineType:[a.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[u.UASTC_HDR],transcoderFormat:[c.BC6H],engineFormat:[s.RGB_BPTC_UNSIGNED_Format],engineType:[a.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[c.RGBA32,c.RGBA32],engineFormat:[s.RGBAFormat,s.RGBAFormat],engineType:[a.UnsignedByteType,a.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[u.UASTC_HDR],transcoderFormat:[c.RGBA_HALF],engineFormat:[s.RGBAFormat],engineType:[a.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],m={[u.ETC1S]:A.filter(C=>C.basisFormat.includes(u.ETC1S)).sort((C,M)=>C.priorityUASTC-M.priorityUASTC),[u.UASTC]:A.filter(C=>C.basisFormat.includes(u.UASTC)).sort((C,M)=>C.priorityUASTC-M.priorityUASTC),[u.UASTC_HDR]:A.filter(C=>C.basisFormat.includes(u.UASTC_HDR)).sort((C,M)=>C.priorityHDR-M.priorityHDR)};function v(C){return C<=2||!(C&C-1)&&C!==0}function E(C){if(C.length===1)return C[0];let M=0;for(let N=0;N<C.length;N++)M+=C[N].byteLength;const S=new Uint8Array(M);let B=0;for(let N=0;N<C.length;N++){const L=C[N];S.set(L,B),B+=L.byteLength}return S}};const LQ=new Set([nr,dl,Bo]),tb={[UT]:nr,[LT]:nr,[IT]:nr,[TT]:nr,[PT]:dl,[RT]:dl,[MT]:dl,[ST]:dl,[DT]:Bo,[BT]:Bo,[wT]:Bo,[CT]:Bo,[X_]:th,[FT]:Yl,[NT]:Yl},nb={[UT]:Ir,[LT]:Cs,[IT]:Er,[TT]:Er,[PT]:Ir,[RT]:Cs,[MT]:Er,[ST]:Er,[DT]:Ir,[BT]:Cs,[wT]:Er,[CT]:Er,[X_]:Cs,[FT]:Er,[NT]:Er};function QT(r){const e=r.dataFormatDescriptor[0];return e.colorPrimaries===1?e.transferFunction===2?si:xr:e.colorPrimaries===10?e.transferFunction===2?"display-p3":"display-p3-linear":(e.colorPrimaries===0||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),va)}const yi={c:null,u:[new R,new R,new R],e:[]},Ui={c:null,u:[new R,new R,new R],e:[]},wr=[[],[],[]],Qn=[[],[],[]],rr=[],Xu=new R,Yu=new R,Ku=new R,ns=new R,GT=new R,HT=new R,Go=new wn,zT=new te,ov=new Qt,VT=new Qt,WT=new _r;class lv{constructor(e=new R,n=new R,s=new wn){this.center=e,this.halfSize=n,this.rotation=s}set(e,n,s){return this.center=e,this.halfSize=n,this.rotation=s,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,n){const s=this.halfSize;ns.subVectors(e,this.center),this.rotation.extractBasis(Xu,Yu,Ku),n.copy(this.center);const a=Tr.clamp(ns.dot(Xu),-s.x,s.x);n.add(Xu.multiplyScalar(a));const c=Tr.clamp(ns.dot(Yu),-s.y,s.y);n.add(Yu.multiplyScalar(c));const u=Tr.clamp(ns.dot(Ku),-s.z,s.z);return n.add(Ku.multiplyScalar(u)),n}containsPoint(e){return ns.subVectors(e,this.center),this.rotation.extractBasis(Xu,Yu,Ku),Math.abs(ns.dot(Xu))<=this.halfSize.x&&Math.abs(ns.dot(Yu))<=this.halfSize.y&&Math.abs(ns.dot(Ku))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(DQ.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,HT),HT.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,n=Number.EPSILON){yi.c=this.center,yi.e[0]=this.halfSize.x,yi.e[1]=this.halfSize.y,yi.e[2]=this.halfSize.z,this.rotation.extractBasis(yi.u[0],yi.u[1],yi.u[2]),Ui.c=e.center,Ui.e[0]=e.halfSize.x,Ui.e[1]=e.halfSize.y,Ui.e[2]=e.halfSize.z,e.rotation.extractBasis(Ui.u[0],Ui.u[1],Ui.u[2]);for(let c=0;c<3;c++)for(let u=0;u<3;u++)wr[c][u]=yi.u[c].dot(Ui.u[u]);ns.subVectors(Ui.c,yi.c),rr[0]=ns.dot(yi.u[0]),rr[1]=ns.dot(yi.u[1]),rr[2]=ns.dot(yi.u[2]);for(let c=0;c<3;c++)for(let u=0;u<3;u++)Qn[c][u]=Math.abs(wr[c][u])+n;let s,a;for(let c=0;c<3;c++)if(s=yi.e[c],a=Ui.e[0]*Qn[c][0]+Ui.e[1]*Qn[c][1]+Ui.e[2]*Qn[c][2],Math.abs(rr[c])>s+a)return!1;for(let c=0;c<3;c++)if(s=yi.e[0]*Qn[0][c]+yi.e[1]*Qn[1][c]+yi.e[2]*Qn[2][c],a=Ui.e[c],Math.abs(rr[0]*wr[0][c]+rr[1]*wr[1][c]+rr[2]*wr[2][c])>s+a)return!1;return s=yi.e[1]*Qn[2][0]+yi.e[2]*Qn[1][0],a=Ui.e[1]*Qn[0][2]+Ui.e[2]*Qn[0][1],!(Math.abs(rr[2]*wr[1][0]-rr[1]*wr[2][0])>s+a||(s=yi.e[1]*Qn[2][1]+yi.e[2]*Qn[1][1],a=Ui.e[0]*Qn[0][2]+Ui.e[2]*Qn[0][0],Math.abs(rr[2]*wr[1][1]-rr[1]*wr[2][1])>s+a||(s=yi.e[1]*Qn[2][2]+yi.e[2]*Qn[1][2],a=Ui.e[0]*Qn[0][1]+Ui.e[1]*Qn[0][0],Math.abs(rr[2]*wr[1][2]-rr[1]*wr[2][2])>s+a||(s=yi.e[0]*Qn[2][0]+yi.e[2]*Qn[0][0],a=Ui.e[1]*Qn[1][2]+Ui.e[2]*Qn[1][1],Math.abs(rr[0]*wr[2][0]-rr[2]*wr[0][0])>s+a||(s=yi.e[0]*Qn[2][1]+yi.e[2]*Qn[0][1],a=Ui.e[0]*Qn[1][2]+Ui.e[2]*Qn[1][0],Math.abs(rr[0]*wr[2][1]-rr[2]*wr[0][1])>s+a||(s=yi.e[0]*Qn[2][2]+yi.e[2]*Qn[0][2],a=Ui.e[0]*Qn[1][1]+Ui.e[1]*Qn[1][0],Math.abs(rr[0]*wr[2][2]-rr[2]*wr[0][2])>s+a||(s=yi.e[0]*Qn[1][0]+yi.e[1]*Qn[0][0],a=Ui.e[1]*Qn[2][2]+Ui.e[2]*Qn[2][1],Math.abs(rr[1]*wr[0][0]-rr[0]*wr[1][0])>s+a||(s=yi.e[0]*Qn[1][1]+yi.e[1]*Qn[0][1],a=Ui.e[0]*Qn[2][2]+Ui.e[2]*Qn[2][0],Math.abs(rr[1]*wr[0][1]-rr[0]*wr[1][1])>s+a||(s=yi.e[0]*Qn[1][2]+yi.e[1]*Qn[0][2],a=Ui.e[0]*Qn[2][1]+Ui.e[1]*Qn[2][0],Math.abs(rr[1]*wr[0][2]-rr[0]*wr[1][2])>s+a)))))))))}intersectsPlane(e){this.rotation.extractBasis(Xu,Yu,Ku);const n=this.halfSize.x*Math.abs(e.normal.dot(Xu))+this.halfSize.y*Math.abs(e.normal.dot(Yu))+this.halfSize.z*Math.abs(e.normal.dot(Ku)),s=e.normal.dot(this.center)-e.constant;return Math.abs(s)<=n}intersectRay(e,n){return this.getSize(GT),zT.setFromCenterAndSize(ns.set(0,0,0),GT),ov.setFromMatrix3(this.rotation),ov.setPosition(this.center),VT.copy(ov).invert(),WT.copy(e).applyMatrix4(VT),WT.intersectBox(zT,n)?n.applyMatrix4(ov):null}intersectsRay(e){return this.intersectRay(e,ns)!==null}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){const n=e.elements;let s=ns.set(n[0],n[1],n[2]).length();const a=ns.set(n[4],n[5],n[6]).length(),c=ns.set(n[8],n[9],n[10]).length();e.determinant()<0&&(s=-s),Go.setFromMatrix4(e);const u=1/s,A=1/a,m=1/c;return Go.elements[0]*=u,Go.elements[1]*=u,Go.elements[2]*=u,Go.elements[3]*=A,Go.elements[4]*=A,Go.elements[5]*=A,Go.elements[6]*=m,Go.elements[7]*=m,Go.elements[8]*=m,this.rotation.multiply(Go),this.halfSize.x*=s,this.halfSize.y*=a,this.halfSize.z*=c,ns.setFromMatrixPosition(e),this.center.add(ns),this}}const DQ=new lv,PQ=/^[og]\s*(.+)?/,UQ=/^mtllib /,NQ=/^usemtl /,FQ=/^usemap /,jT=/\s+/,qT=new R,ib=new R,XT=new R,YT=new R,uo=new R,cv=new Mt;function OQ(){const r={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,n){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=n!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:n!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,c){const u=this._finalize(!1);u&&(u.inherited||u.groupCount<=0)&&this.materials.splice(u.index,1);const A={index:this.materials.length,name:a||"",mtllib:Array.isArray(c)&&c.length>0?c[c.length-1]:"",smooth:u!==void 0?u.smooth:this.smooth,groupStart:u!==void 0?u.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(m){const v={index:typeof m=="number"?m:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return v.clone=this.clone.bind(v),v}};return this.materials.push(A),A},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const c=this.currentMaterial();if(c&&c.groupEnd===-1&&(c.groupEnd=this.geometry.vertices.length/3,c.groupCount=c.groupEnd-c.groupStart,c.inherited=!1),a&&this.materials.length>1)for(let u=this.materials.length-1;u>=0;u--)this.materials[u].groupCount<=0&&this.materials.splice(u,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),c}},s&&s.name&&typeof s.clone=="function"){const a=s.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,n){const s=parseInt(e,10);return 3*(s>=0?s-1:s+n/3)},parseNormalIndex:function(e,n){const s=parseInt(e,10);return 3*(s>=0?s-1:s+n/3)},parseUVIndex:function(e,n){const s=parseInt(e,10);return 2*(s>=0?s-1:s+n/2)},addVertex:function(e,n,s){const a=this.vertices,c=this.object.geometry.vertices;c.push(a[e+0],a[e+1],a[e+2]),c.push(a[n+0],a[n+1],a[n+2]),c.push(a[s+0],a[s+1],a[s+2])},addVertexPoint:function(e){const n=this.vertices;this.object.geometry.vertices.push(n[e+0],n[e+1],n[e+2])},addVertexLine:function(e){const n=this.vertices;this.object.geometry.vertices.push(n[e+0],n[e+1],n[e+2])},addNormal:function(e,n,s){const a=this.normals,c=this.object.geometry.normals;c.push(a[e+0],a[e+1],a[e+2]),c.push(a[n+0],a[n+1],a[n+2]),c.push(a[s+0],a[s+1],a[s+2])},addFaceNormal:function(e,n,s){const a=this.vertices,c=this.object.geometry.normals;qT.fromArray(a,e),ib.fromArray(a,n),XT.fromArray(a,s),uo.subVectors(XT,ib),YT.subVectors(qT,ib),uo.cross(YT),uo.normalize(),c.push(uo.x,uo.y,uo.z),c.push(uo.x,uo.y,uo.z),c.push(uo.x,uo.y,uo.z)},addColor:function(e,n,s){const a=this.colors,c=this.object.geometry.colors;a[e]!==void 0&&c.push(a[e+0],a[e+1],a[e+2]),a[n]!==void 0&&c.push(a[n+0],a[n+1],a[n+2]),a[s]!==void 0&&c.push(a[s+0],a[s+1],a[s+2])},addUV:function(e,n,s){const a=this.uvs,c=this.object.geometry.uvs;c.push(a[e+0],a[e+1]),c.push(a[n+0],a[n+1]),c.push(a[s+0],a[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const n=this.uvs;this.object.geometry.uvs.push(n[e+0],n[e+1])},addFace:function(e,n,s,a,c,u,A,m,v){const E=this.vertices.length;let C=this.parseVertexIndex(e,E),M=this.parseVertexIndex(n,E),S=this.parseVertexIndex(s,E);if(this.addVertex(C,M,S),this.addColor(C,M,S),A!==void 0&&A!==""){const B=this.normals.length;C=this.parseNormalIndex(A,B),M=this.parseNormalIndex(m,B),S=this.parseNormalIndex(v,B),this.addNormal(C,M,S)}else this.addFaceNormal(C,M,S);if(a!==void 0&&a!==""){const B=this.uvs.length;C=this.parseUVIndex(a,B),M=this.parseUVIndex(c,B),S=this.parseUVIndex(u,B),this.addUV(C,M,S),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const n=this.vertices.length;for(let s=0,a=e.length;s<a;s++){const c=this.parseVertexIndex(e[s],n);this.addVertexPoint(c),this.addColor(c)}},addLineGeometry:function(e,n){this.object.geometry.type="Line";const s=this.vertices.length,a=this.uvs.length;for(let c=0,u=e.length;c<u;c++)this.addVertexLine(this.parseVertexIndex(e[c],s));for(let c=0,u=n.length;c<u;c++)this.addUVLine(this.parseUVIndex(n[c],a))}};return r.startObject("",!1),r}class KT extends $r{constructor(e){super(e),this.materials=null}load(e,n,s,a){const c=this,u=new Zr(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(A){try{n(c.parse(A))}catch(m){a?a(m):console.error(m),c.manager.itemError(e)}},s,a)}setMaterials(e){return this.materials=e,this}parse(e){const n=new OQ;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let a=[];for(let u=0,A=s.length;u<A;u++){const m=s[u].trimStart();if(m.length===0)continue;const v=m.charAt(0);if(v!=="#")if(v==="v"){const E=m.split(jT);switch(E[0]){case"v":n.vertices.push(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3])),E.length>=7?(cv.setRGB(parseFloat(E[4]),parseFloat(E[5]),parseFloat(E[6]),si),n.colors.push(cv.r,cv.g,cv.b)):n.colors.push(void 0,void 0,void 0);break;case"vn":n.normals.push(parseFloat(E[1]),parseFloat(E[2]),parseFloat(E[3]));break;case"vt":n.uvs.push(parseFloat(E[1]),parseFloat(E[2]))}}else if(v==="f"){const E=m.slice(1).trim().split(jT),C=[];for(let S=0,B=E.length;S<B;S++){const N=E[S];if(N.length>0){const L=N.split("/");C.push(L)}}const M=C[0];for(let S=1,B=C.length-1;S<B;S++){const N=C[S],L=C[S+1];n.addFace(M[0],N[0],L[0],M[1],N[1],L[1],M[2],N[2],L[2])}}else if(v==="l"){const E=m.substring(1).trim().split(" ");let C=[];const M=[];if(m.indexOf("/")===-1)C=E;else for(let S=0,B=E.length;S<B;S++){const N=E[S].split("/");N[0]!==""&&C.push(N[0]),N[1]!==""&&M.push(N[1])}n.addLineGeometry(C,M)}else if(v==="p"){const E=m.slice(1).trim().split(" ");n.addPointGeometry(E)}else if((a=PQ.exec(m))!==null){const E=(" "+a[0].slice(1).trim()).slice(1);n.startObject(E)}else if(NQ.test(m))n.object.startMaterial(m.substring(7).trim(),n.materialLibraries);else if(UQ.test(m))n.materialLibraries.push(m.substring(7).trim());else if(FQ.test(m))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(v==="s"){if(a=m.split(" "),a.length>1){const C=a[1].trim().toLowerCase();n.object.smooth=C!=="0"&&C!=="off"}else n.object.smooth=!0;const E=n.object.currentMaterial();E&&(E.smooth=n.object.smooth)}else{if(m==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+m+'"')}}n.finalize();const c=new wa;if(c.materialLibraries=[].concat(n.materialLibraries),!(n.objects.length===1&&n.objects[0].geometry.vertices.length===0))for(let u=0,A=n.objects.length;u<A;u++){const m=n.objects[u],v=m.geometry,E=m.materials,C=v.type==="Line",M=v.type==="Points";let S=!1;if(v.vertices.length===0)continue;const B=new vn;B.setAttribute("position",new Wt(v.vertices,3)),v.normals.length>0&&B.setAttribute("normal",new Wt(v.normals,3)),v.colors.length>0&&(S=!0,B.setAttribute("color",new Wt(v.colors,3))),v.hasUVIndices===!0&&B.setAttribute("uv",new Wt(v.uvs,2));const N=[];for(let F=0,O=E.length;F<O;F++){const H=E[F],X=H.name+"_"+H.smooth+"_"+S;let $=n.materials[X];if(this.materials!==null)if($=this.materials.create(H.name),!C||!$||$ instanceof zr){if(M&&$&&!($ instanceof ph)){const ee=new ph({size:10,sizeAttenuation:!1});Ur.prototype.copy.call(ee,$),ee.color.copy($.color),ee.map=$.map,$=ee}}else{const ee=new zr;Ur.prototype.copy.call(ee,$),ee.color.copy($.color),$=ee}$===void 0&&($=C?new zr:M?new ph({size:1,sizeAttenuation:!1}):new jf,$.name=H.name,$.flatShading=!H.smooth,$.vertexColors=S,n.materials[X]=$),N.push($)}let L;if(N.length>1){for(let F=0,O=E.length;F<O;F++){const H=E[F];B.addGroup(H.groupStart,H.groupCount,F)}L=C?new Ha(B,N):M?new gp(B,N):new Ti(B,N)}else L=C?new Ha(B,N[0]):M?new gp(B,N[0]):new Ti(B,N[0]);L.name=m.name,c.add(L)}else if(n.vertices.length>0){const u=new ph({size:1,sizeAttenuation:!1}),A=new vn;A.setAttribute("position",new Wt(n.vertices,3)),n.colors.length>0&&n.colors[0]!==void 0&&(A.setAttribute("color",new Wt(n.colors,3)),u.vertexColors=!0);const m=new gp(A,u);c.add(m)}return c}}class JT extends $r{constructor(e){super(e)}load(e,n,s,a){const c=this,u=this.path===""?xl.extractUrlBase(e):this.path,A=new Zr(this.manager);A.setPath(this.path),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(e,function(m){try{n(c.parse(m,u))}catch(v){a?a(v):console.error(v),c.manager.itemError(e)}},s,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,n){const s=e.split(`
`);let a={};const c=/\s+/,u={};for(let m=0;m<s.length;m++){let v=s[m];if(v=v.trim(),v.length===0||v.charAt(0)==="#")continue;const E=v.indexOf(" ");let C=E>=0?v.substring(0,E):v;C=C.toLowerCase();let M=E>=0?v.substring(E+1):"";if(M=M.trim(),C==="newmtl")a={name:M},u[M]=a;else if(C==="ka"||C==="kd"||C==="ks"||C==="ke"){const S=M.split(c,3);a[C]=[parseFloat(S[0]),parseFloat(S[1]),parseFloat(S[2])]}else a[C]=M}const A=new kQ(this.resourcePath||n,this.materialOptions);return A.setCrossOrigin(this.crossOrigin),A.setManager(this.manager),A.setMaterials(u),A}}class kQ{constructor(e="",n={}){this.baseUrl=e,this.options=n,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:ut,this.wrap=this.options.wrap!==void 0?this.options.wrap:ga}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const n={};for(const s in e){const a=e[s],c={};n[s]=c;for(const u in a){let A=!0,m=a[u];const v=u.toLowerCase();switch(v){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(m=[m[0]/255,m[1]/255,m[2]/255]),this.options&&this.options.ignoreZeroRGBs&&m[0]===0&&m[1]===0&&m[2]===0&&(A=!1)}A&&(c[v]=m)}}return n}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const n in this.materialsInfo)this.materialsArray[e]=this.create(n),this.nameLookup[n]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const n=this,s=this.materialsInfo[e],a={name:e,side:this.side};function c(u,A){if(a[u])return;const m=n.getTextureParams(A,a),v=n.loadTexture((E=n.baseUrl,typeof(C=m.url)!="string"||C===""?"":/^https?:\/\//i.test(C)?C:E+C));var E,C;v.repeat.copy(m.scale),v.offset.copy(m.offset),v.wrapS=n.wrap,v.wrapT=n.wrap,u!=="map"&&u!=="emissiveMap"||(v.colorSpace=si),a[u]=v}for(const u in s){const A=s[u];let m;if(A!=="")switch(u.toLowerCase()){case"kd":a.color=Dn.toWorkingColorSpace(new Mt().fromArray(A),si);break;case"ks":a.specular=Dn.toWorkingColorSpace(new Mt().fromArray(A),si);break;case"ke":a.emissive=Dn.toWorkingColorSpace(new Mt().fromArray(A),si);break;case"map_kd":c("map",A);break;case"map_ks":c("specularMap",A);break;case"map_ke":c("emissiveMap",A);break;case"norm":c("normalMap",A);break;case"map_bump":case"bump":c("bumpMap",A);break;case"map_d":c("alphaMap",A),a.transparent=!0;break;case"ns":a.shininess=parseFloat(A);break;case"d":m=parseFloat(A),m<1&&(a.opacity=m,a.transparent=!0);break;case"tr":m=parseFloat(A),this.options&&this.options.invertTrProperty&&(m=1-m),m>0&&(a.opacity=1-m,a.transparent=!0)}}return this.materials[e]=new jf(a),this.materials[e]}getTextureParams(e,n){const s={scale:new ct(1,1),offset:new ct(0,0)},a=e.split(/\s+/);let c;return c=a.indexOf("-bm"),c>=0&&(n.bumpScale=parseFloat(a[c+1]),a.splice(c,2)),c=a.indexOf("-s"),c>=0&&(s.scale.set(parseFloat(a[c+1]),parseFloat(a[c+2])),a.splice(c,4)),c=a.indexOf("-o"),c>=0&&(s.offset.set(parseFloat(a[c+1]),parseFloat(a[c+2])),a.splice(c,4)),s.url=a.join(" ").trim(),s}loadTexture(e,n,s,a,c){const u=this.manager!==void 0?this.manager:m_;let A=u.getHandler(e);A===null&&(A=new H0(u)),A.setCrossOrigin&&A.setCrossOrigin(this.crossOrigin);const m=A.load(e,s,a,c);return n!==void 0&&(m.mapping=n),m}}class $T{static fromCubeTexture(e){let n=0;const s=new R,a=new R,c=new Mt,u=[0,0,0,0,0,0,0,0,0],A=new bp,m=A.coefficients;for(let E=0;E<6;E++){const C=e.image[E],M=C.width,S=C.height,B=document.createElement("canvas");B.width=M,B.height=S;const N=B.getContext("2d");N.drawImage(C,0,0,M,S);const L=N.getImageData(0,0,M,S),F=L.data,O=L.width,H=2/O;for(let X=0,$=F.length;X<$;X+=4){c.setRGB(F[X]/255,F[X+1]/255,F[X+2]/255),ZT(c,e.colorSpace);const ee=X/4,ie=(ee%O+.5)*H-1,ce=1-(Math.floor(ee/O)+.5)*H;switch(E){case 0:s.set(-1,ce,-ie);break;case 1:s.set(1,ce,ie);break;case 2:s.set(-ie,1,-ce);break;case 3:s.set(-ie,-1,ce);break;case 4:s.set(-ie,ce,1);break;case 5:s.set(ie,ce,-1)}const oe=s.lengthSq(),Se=4/(Math.sqrt(oe)*oe);n+=Se,a.copy(s).normalize(),bp.getBasisAt(a,u);for(let Ne=0;Ne<9;Ne++)m[Ne].x+=u[Ne]*c.r*Se,m[Ne].y+=u[Ne]*c.g*Se,m[Ne].z+=u[Ne]*c.b*Se}}const v=4*Math.PI/n;for(let E=0;E<9;E++)m[E].x*=v,m[E].y*=v,m[E].z*=v;return new Ou(A)}static async fromCubeRenderTarget(e,n){const s=e.coordinateSystem===ya?-1:1;let a=0;const c=new R,u=new R,A=new Mt,m=[0,0,0,0,0,0,0,0,0],v=new bp,E=v.coefficients,C=n.texture.type,M=n.width;let S;e.isWebGLRenderer&&(S=C===Cs?new Uint16Array(M*M*4):new Uint8Array(M*M*4));for(let N=0;N<6;N++){e.isWebGLRenderer?await e.readRenderTargetPixelsAsync(n,0,0,M,M,S,N):S=await e.readRenderTargetPixelsAsync(n,0,0,M,M,0,N);const L=2/M;for(let F=0,O=S.length;F<O;F+=4){let H,X,$;C===Cs?(H=Zg.fromHalfFloat(S[F]),X=Zg.fromHalfFloat(S[F+1]),$=Zg.fromHalfFloat(S[F+2])):(H=S[F]/255,X=S[F+1]/255,$=S[F+2]/255),A.setRGB(H,X,$),ZT(A,n.texture.colorSpace);const ee=F/4,ie=(1-(ee%M+.5)*L)*s,ce=1-(Math.floor(ee/M)+.5)*L;switch(N){case 0:c.set(-1*s,ce,ie*s);break;case 1:c.set(1*s,ce,-ie*s);break;case 2:c.set(ie,1,-ce);break;case 3:c.set(ie,-1,ce);break;case 4:c.set(ie,ce,1);break;case 5:c.set(-ie,ce,-1)}const oe=c.lengthSq(),Se=4/(Math.sqrt(oe)*oe);a+=Se,u.copy(c).normalize(),bp.getBasisAt(u,m);for(let Ne=0;Ne<9;Ne++)E[Ne].x+=m[Ne]*A.r*Se,E[Ne].y+=m[Ne]*A.g*Se,E[Ne].z+=m[Ne]*A.b*Se}}const B=4*Math.PI/a;for(let N=0;N<9;N++)E[N].x*=B,E[N].y*=B,E[N].z*=B;return new Ou(v)}}function ZT(r,e){switch(e){case si:r.convertSRGBToLinear();break;case xr:case va:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.")}return r}var eB=function(r){var e=this;this.object=r,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var n,s,a,c,u=function(v){e.deviceOrientation=v},A=function(){e.screenOrientation=window.orientation||0},m=(n=new THREE.Vector3(0,0,1),s=new THREE.Euler,a=new THREE.Quaternion,c=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(v,E,C,M,S){s.set(C,E,-M,"YXZ"),v.setFromEuler(s),v.multiply(c),v.multiply(a.setFromAxisAngle(n,-S))});this.connect=function(){A(),window.addEventListener("orientationchange",A,!1),window.addEventListener("deviceorientation",u,!1),e.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",A,!1),window.removeEventListener("deviceorientation",u,!1),e.enabled=!1},this.update=function(){if(e.enabled!==!1){var v=e.deviceOrientation;if(v){var E=v.alpha?THREE.MathUtils.degToRad(v.alpha)+e.alphaOffset:0,C=v.beta?THREE.MathUtils.degToRad(v.beta):0,M=v.gamma?THREE.MathUtils.degToRad(v.gamma):0,S=e.screenOrientation?THREE.MathUtils.degToRad(e.screenOrientation):0;m(e.object.quaternion,E,C,M,S)}}},this.dispose=function(){e.disconnect()},this.connect()},Ho=globalThis.THREE={...l};Ho.DRACOLoader=vT,Ho.GLTFLoader=z_,Ho.KTX2Loader=za,Ho.OBJLoader=KT,Ho.MTLLoader=JT,Ho.OBB=lv,Ho.BufferGeometryUtils=h,Ho.LightProbeGenerator=$T,Ho.DeviceOrientationControls=eB,Ho.Cache.enabled=!0;const tB=Ho;var Fr=window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",Ms="aframe-injected",QQ=i(8878),Kf=i.n(QQ),nB={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};Kf().formatArgs=function(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" "),this.useColors){var e;this.color=(e=function(c){var u=c.split(":");return u[u.length-1]}(this.namespace),nB.colors&&nB.colors[e]||null);var n="color: "+this.color;r.splice(1,0,n,"color: inherit");var s=0,a=0;r[0].replace(/%[a-zA-Z%]/g,function(c){c!=="%%"&&(s++,c==="%c"&&(a=s))}),r.splice(a,0,n)}};var rb=function(){try{return window.localStorage}catch{}}();rb&&(parseInt(rb.logs,10)||rb.logs==="true")?Kf().enable("*"):Kf().enable("*:error,*:info,*:warn");const Bi=Kf();var GQ=i(1124),HQ=i.n(GQ),iB=Bi("device:error"),hv=!1,uv=!1,dv=navigator.xr!==void 0;if(dv){var Sp=function(){var r=document.querySelector("a-scene");r?r.hasLoaded?r.components["xr-mode-ui"].updateEnterInterfaces():r.addEventListener("loaded",Sp):window.addEventListener("DOMContentLoaded",Sp)},rB=function(r){iB("WebXR session support error: "+r.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(r){hv=r,Sp()}).catch(rB),navigator.xr.isSessionSupported("immersive-ar").then(function(r){uv=r,Sp()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){hv=!0,Sp()}).catch(rB),navigator.xr.supportsSession("immersive-ar").then(function(){uv=!0,Sp()}).catch(function(){})):iB("WebXR has neither isSessionSupported or supportsSession?!")}function sb(){return hv||uv}function ab(){return uv}function ob(){return hv}var Jf,lb,xh=(Jf=!1,lb=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(lb)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(lb.substr(0,4)))&&(Jf=!0),($f()||sB()||db())&&(Jf=!0),ub()&&(Jf=!1),function(){return Jf});function sB(r){var e=r||window.navigator.userAgent;return/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(e)||aB()}function aB(r,e,n){var s=r||window.navigator.userAgent,a=e||window.navigator.platform,c=n||window.navigator.maxTouchPoints||0;return(a==="iPad"||a==="MacIntel")&&c>0&&/Macintosh|Intel|iPad|ipad/i.test(s)&&!window.MSStream}function oB(){var r=navigator.userAgent.includes("Macintosh"),e=navigator.maxTouchPoints===5;return r&&e&&dv}function $f(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function cb(){return!xh()&&!ub()&&window.orientation!==void 0}function hb(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function lB(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function ub(){return hb()||lB()||oB()}function db(){return/R7 Build/.test(window.navigator.userAgent)}function cB(){var r=window.orientation;return db()&&(r+=90),r===90||r===-90}var pb=typeof process>"u",zQ=!pb,VQ=Object.freeze(Object.create(null));function WQ(){return{}}function Ab(r){var e=[],n=null;function s(a){var c,u;if((a=a===void 0?e.length:a)>0&&n==null&&(n=0),a>0)for(c=e.length,e.length+=Number(a),u=c;u<e.length;u++)e[u]=r();return e.length}return r=r||WQ,{grow:s,pool:e,recycle:function(a){a instanceof Object&&(n!==null&&n!==-1?e[--n]=a:e[e.length]=a)},size:function(){return e.length},use:function(){var a;return n!==null&&n!==e.length||s(e.length||5),a=e[n],e[n++]=VQ,fb(a),a}}}function fb(r){var e;if(r&&r.constructor===Object)for(e in r)r[e]=void 0}function Zf(r,e){var n;if(r&&r.constructor===Object)for(n in r)n in e||delete r[n]}var jQ=Bi("utils:coordinates:warn"),hB=["x","y","z","w"],uB=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/,qQ=/\s+/g;function pv(r,e,n){var s,a,c,u,A,m,v,E,C=n&&typeof n=="object"?n:{};if(r&&r instanceof Object)return A=r.x===void 0?e&&e.x:r.x,m=r.y===void 0?e&&e.y:r.y,v=r.z===void 0?e&&e.z:r.z,E=r.w===void 0?e&&e.w:r.w,A!=null&&(C.x=em(A)),m!=null&&(C.y=em(m)),v!=null&&(C.z=em(v)),E!=null&&(C.w=em(E)),C;if(r==null)return typeof e=="object"?Object.assign(C,e):e;for(s=r.trim().split(qQ),u=0;u<hB.length;u++)if(c=hB[u],s[u])C[c]=parseFloat(s[u],10);else{if((a=e&&e[c])===void 0)continue;C[c]=em(a)}return C}function Av(r){var e;return typeof r!="object"?r:(e=r.x+" "+r.y,r.z!=null&&(e+=" "+r.z),r.w!=null&&(e+=" "+r.w),e)}function fv(r,e){return typeof r!="object"||typeof e!="object"?r===e:r.x===e.x&&r.y===e.y&&r.z===e.z&&r.w===e.w}function dB(r){return uB.test(r)}function XQ(r){return jQ("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),dB(r)}function em(r){return r!=null&&r.constructor===String?parseFloat(r,10):r}function YQ(r){return new R(r.x,r.y,r.z)}var yc=function(){var r={};return function(e,n){return n in r||(r[n]={}),e in r[n]||(r[n][e]=e.split(n)),r[n][e]}}();function mv(r,e){var n=yc(r,e=e||".");return n.length===1?n[0]:n}function pB(r,e,n){var s;return n=n||".",e.indexOf(n)!==-1?(s=mv(e,n)).constructor===String?r.getAttribute(s):r.getAttribute(s[0])[s[1]]:r.getAttribute(e)}function mb(r,e,n,s){var a;s=s||".",e.indexOf(s)===-1?r.setAttribute(e,n):(a=mv(e,s)).constructor===String?r.setAttribute(a,n):r.setAttribute(a[0],a[1],n)}function AB(r){var e=r.style.width,n=r.style.height;r.style.width=parseInt(e,10)+1+"px",r.style.height=parseInt(n,10)+1+"px",setTimeout(function(){r.style.width=e,r.style.height=n},200)}var gv=Bi("utils:src-loader:warn");function vv(r,e,n){(function(s,a){var c;s.tagName?a(s.tagName==="IMG"):((c=new XMLHttpRequest).open("HEAD",s),c.addEventListener("load",function(u){var A;c.status>=200&&c.status<300?(A=c.getResponseHeader("Content-Type"))==null?mB(s,a):A.startsWith("image")?a(!0):a(!1):mB(s,a),c.abort()}),c.send())})(r,function(s){s?e(r):n(r)})}function gb(r,e,n){var s,a,c,u="",A=[];if(typeof r=="string"){let m=function(v){A.push(v),A.length===6&&e(A)};for(a=0;a<5;a++)u+="(url\\((?:[^\\)]+)\\),\\s*)";if(u+="(url\\((?:[^\\)]+)\\)\\s*)",c=r.match(new RegExp(u))){for(a=1;a<7;a++)vv(vb(c[a]),m);return}if(!r.startsWith("#"))return void vv(vb(r)||r,n)}if(s=r.tagName?r:function(m){try{var v=document.querySelector(m);return v||gv('No element was found matching the selector: "%s"',m),v}catch{return void gv('"%s" is not a valid selector',m)}}(r))return s.tagName==="A-CUBEMAP"&&s.srcs?e(s.srcs):s.tagName==="IMG"?n(s):void gv('Selector "%s" does not point to <a-cubemap> or <img>',r)}function fB(r,e){return gb(r,e,function(){gv("Expected cubemap but got image")})}function vb(r){var e=r.match(/url\((.+)\)/);if(e)return e[1]}function mB(r,e){var n=new Image;n.addEventListener("load",function(){e(!0)}),n.addEventListener("error",function(){e(!1)}),n.src=r}var KQ=Bi("utils:material:warn"),JQ=new Set(["emissiveMap","envMap","map","specularMap"]);function yv(r,e){var n=e.offset||{x:0,y:0},s=e.repeat||{x:1,y:1},a=e.npot||!1,c=e.anisotropy||Pi.DEFAULT_ANISOTROPY,u=r.wrapS,A=r.wrapT,m=r.magFilter,v=r.minFilter;a&&(u=Dr,A=Dr,m=bi,v=bi),s.x===1&&s.y===1||(u=ga,A=ga),r.offset.set(n.x,n.y),r.repeat.set(s.x,s.y),r.wrapS===u&&r.wrapT===A&&r.magFilter===m&&r.minFilter===v&&r.anisotropy===c||(r.wrapS=u,r.wrapT=A,r.magFilter=m,r.minFilter=v,r.anisotropy=c,r.needsUpdate=!0)}function Ev(r,e,n,s){var a=n.el,c=n.material,u=a.sceneEl.systems.renderer,A=s[e];if(n.materialSrcs||(n.materialSrcs={}),!A)return delete n.materialSrcs[r],void m(null);function m(v){c[r]!==v&&(c[r]&&c[r].dispose(),c[r]=v,c.needsUpdate=!0,xb(a,v))}A===n.materialSrcs[r]&&c[r]?yv(c[r],s):(n.materialSrcs[r]=A,A instanceof Pi?m(A):a.sceneEl.systems.material.loadTextureSource(A,function(v){if(n.materialSrcs[r]===A){var E=c[r];!E||v!==null&&gB(E,v)||(E=null),!E&&v&&(E=_b(v)),E&&(E.source!==v&&(E.source=v,E.needsUpdate=!0),JQ.has(r)&&u.applyColorCorrection(E),yv(E,s)),m(E)}}))}function xv(r,e){return Ev("map","src",r,e)}function _l(r,e,n){var s=r;r==="ambientOcclusion"&&(s="ao");var a={};return a.src=n[r+"Map"],a.offset=n[r+"TextureOffset"],a.repeat=n[r+"TextureRepeat"],a.wrap=n[r+"TextureWrap"],Ev(s+"Map","src",e,a)}var yb={};function Eb(r,e){var n=r.material,s=r.el,a="envMap",c=e.envMap,u=e.sphericalEnvMap,A=e.refract;if(u&&(c=u,KQ("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),r.materialSrcs||(r.materialSrcs={}),!c)return delete r.materialSrcs[a],n.envMap=null,void(n.needsUpdate=!0);function m(v){r.materialSrcs[a]===c&&(n.envMap=v,n.needsUpdate=!0,xb(s,v))}r.materialSrcs[a]=c,yb[c]?yb[c].then(m):yb[c]=new Promise(function(v){gb(c,function(E){s.sceneEl.systems.material.loadCubeMapTexture(E,function(C){C.mapping=A?Pa:js,m(C),v(C)})},function(E){s.sceneEl.systems.material.loadTexture(E,{src:E},function(C){C.mapping=A?wo:$c,m(C),v(C)})})})}function xb(r,e){function n(){r.emit("materialvideoloadeddata",{src:e.image,texture:e})}function s(){r.emit("materialvideoended",{src:e.image,texture:e})}e&&(r.emit("materialtextureloaded",{src:e.image,texture:e}),e.image&&e.image.tagName==="VIDEO"&&(e.image.addEventListener("loadeddata",n),e.image.addEventListener("ended",s),e.addEventListener("dispose",function(){e.image.removeEventListener("loadeddata",n),e.image.removeEventListener("ended",s)})))}function gB(r,e){return r.source===e&&(e.data instanceof HTMLCanvasElement?r.isCanvasTexture:e.data instanceof HTMLVideoElement?r.isVideoTexture:r.isTexture&&!r.isCanvasTexture&&!r.isVideoTexture)}function _b(r){var e;return(e=r.data instanceof HTMLCanvasElement?new qx:r.data instanceof HTMLVideoElement?new jx(r.data):new Pi).source=r,e.needsUpdate=!0,e}var $Q=/-([a-z])/g;function tm(r,e){var n;return typeof r!="string"?r:(n=function(s,a){var c,u,A,m,v,E;for(a=a||{},c=e4(s),u=0;u<c.length;u++)(A=c[u])&&(m=A.indexOf(":"),v=A.substr(0,m).trim(),E=A.substr(m+1).trim(),a[vB(v)]=E);return a}(r,e),n[""]?r:n)}function ZQ(r){return typeof r=="string"?r:function(e){var n,s=0,a=0,c="";for(n in e)s++;for(n in e)c+=n+": "+e[n],a<s-1&&(c+="; "),a++;return c}(r)}function vB(r){return r.replace($Q,t4)}var _v,yB,e4=(_v=[],yB=/url\([^)]+$/,function(r){var e,n="",s=0;for(_v.length=0;s<r.length;)(e=r.indexOf(";",s))===-1&&(e=r.length),n+=r.substring(s,e),yB.test(n)?(n+=";",s=e+1):(_v.push(n.trim()),n="",s=e+1);return _v});function t4(r){return r[1].toUpperCase()}var n4=["x","y","z","w"];function Va(r,e,n){var s,a,c=r.el;if((a=!!(s=EB(r,e,n)))===r.controllerPresent)return a;r.controllerPresent=a,a?(r.addEventListeners(),r.injectTrackedControls(s),c.emit("controllerconnected",{name:r.name,component:r})):(r.removeEventListeners(),c.emit("controllerdisconnected",{name:r.name,component:r}))}function EB(r,e,n){var s,a=r.el.sceneEl,c=a&&a.systems["tracked-controls"];return!!c&&!(!(s=c.controllers)||!s.length)&&bb(s,e,n.hand,n.index,n.iterateControllerProfiles,n.handTracking)}function bb(r,e,n,s,a,c){var u,A,m,v,E=!1;for(u=0;u<r.length;u++){if(v=(m=r[u]).profiles,c)E=m.hand;else if(a)for(A=0;A<v.length&&!(E=v[A].startsWith(e));A++);else E=v.length>0&&v[0].startsWith(e);if(E){if(m.handedness==="right"||m.handedness==="left"){if(m.handedness===n)return r[u]}else if(u===s)return r[u]}}}function po(r,e,n){var s,a,c,u,A;for(a in e){for(s=e[a],c=!1,A=0;A<s.length;A++)n.detail.changed[s[A]]&&(c=!0);if(c){for(u={},A=0;A<s.length;A++)u[n4[A]]=n.detail.axis[s[A]];r.el.emit(a+"moved",u)}}}function Un(r,e,n,s){var a=(s?n.mapping[s]:n.mapping).buttons[r];n.el.emit(a+e),n.updateModel&&n.updateModel(a,e)}var Cb=Bi("utils:warn");function i4(r){return r.bind.apply(r,Array.prototype.slice.call(arguments,1))}function r4(){return Cb("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),sb()}function s4(){return Cb("`utils.isIOS` has moved to `utils.device.isIOS`"),$f()}function a4(){return Cb("`utils.isMobile has moved to `utils.device.isMobile`"),xh(arguments)}function o4(r,e,n){var s;return n&&(r=r.bind(n)),function(){var a=Date.now();(s===void 0||(s===void 0?e:a-s)>=e)&&(s=a,r.apply(null,arguments))}}function xB(r,e,n){var s,a,c;n&&(r=r.bind(n));var u=function(){s=Date.now(),r.apply(this,c),a=void 0};return function(){var A=Date.now(),m=s===void 0?e:A-s;m>=e?(clearTimeout(a),a=void 0,s=A,r.apply(null,arguments)):(a=a||setTimeout(u,e-m),c=arguments)}}function l4(r,e,n){var s;return n&&(r=r.bind(n)),function(a,c){var u=s===void 0?c:a-s;(s===void 0||u>=e)&&(s=a,r(a,u))}}function _B(r,e,n){var s;return function(){var a=this,c=arguments,u=n&&!s;clearTimeout(s),s=setTimeout(function(){s=null,n||r.apply(a,c)},e),u&&r.apply(a,c)}}var Sa=Object.assign,Wa=HQ();function wb(r){return JSON.parse(JSON.stringify(r))}var zo,Ju,Mb=(zo=Ab(function(){return[]}),function(r,e){var n,s,a,c,u,A;if(r===void 0||e===void 0||r===null||e===null||!(r&&e&&r.constructor===Object&&e.constructor===Object||r.constructor===Array&&e.constructor===Array))return r===e;for(n in s=zo.use(),a=zo.use(),s.length=0,a.length=0,r)s.push(n);for(n in e)a.push(n);if(s.length!==a.length)return zo.recycle(s),zo.recycle(a),!1;for(c=0;c<s.length;++c)if(u=r[s[c]],A=e[s[c]],typeof u=="object"||typeof A=="object"||Array.isArray(u)&&Array.isArray(A)){if(u===A)continue;if(!Mb(u,A))return zo.recycle(s),zo.recycle(a),!1}else if(u!==A)return zo.recycle(s),zo.recycle(a),!1;return zo.recycle(s),zo.recycle(a),!0}),bB=(Ju=[],function(r,e,n){var s,a,c,u,A,m,v;for(A in u=n||{},Ju.length=0,r)Ju.push(A);if(!e)return u;for(c in e)Ju.indexOf(c)===-1&&Ju.push(c);for(m=0;m<Ju.length;m++)s=r[A=Ju[m]],a=e[A],((v=s&&a&&s.constructor===Object&&a.constructor===Object)&&!Mb(s,a)||!v&&s!==a)&&(u[A]=a);return u});function Sb(r){return!r.metaKey&&document.activeElement===document.body}function c4(r,e){e===void 0&&(e=" ");var n=new RegExp(e,"g");return(r=(r||"").replace(n,e)).split(e)}function h4(r,e){e=e||{};var n={};return Object.keys(e).forEach(function(s){r.hasAttribute(s)&&(n[s]=r.getAttribute(s))}),n}function nm(r){r=r.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+r+"=([^&#]*)").exec(location.search);return e===null?"":decodeURIComponent(e[1].replace(/\+/g," "))}function CB(){return window.top!==window.self}function wB(r){for(var e=[],n=r.getElementsByTagName("*"),s=0,a=n.length;s<a;s++)n[s].isScene&&e.push(n[s]);return e}var Ib,u4=[im({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),im({name:"mobile-web-app-capable",content:"yes"}),im({name:"theme-color",content:"black"})],d4=[im({name:"apple-mobile-web-app-capable",content:"yes"}),im({name:"apple-mobile-web-app-status-bar-style",content:"black"}),(Ib={rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"},{tagName:"link",attributes:Ib,exists:function(){return document.querySelector('link[rel="'+Ib.rel+'"]')}})];function im(r){return{tagName:"meta",attributes:r,exists:function(){return document.querySelector('meta[name="'+r.name+'"]')}}}var Vo,_h,MB,p4=i(5928),A4=i.n(p4),f4=_,SB="loading-screen";function Tb(r){var e=Vo.hasAttribute("embedded"),n=MB(Vo.canvas,e,Vo.maxCanvasSize,Vo.is("vr-mode"));r.aspect=n.width/n.height,r.updateProjectionMatrix(),Vo.renderer.setSize(n.width,n.height,!1)}const $u=[];var IB=Kf()("core:propertyTypes:warn"),Bb={},m4=/[,> .[\]:]/,g4=/url\((.+)\)/;function Ss(r,e,n,s,a,c){if(r in Bb)throw new Error("Property type "+r+" is already registered.");Bb[r]={default:e,parse:n||v4,stringify:s||bv,equals:a||BB,isCacheable:c!==!1}}function TB(r,e){if(!Array.isArray(r)||!Array.isArray(e))return r===e;if(r.length!==e.length)return!1;for(var n=0;n<r.length;n++)if(r[n]!==e[n])return!1;return!0}function rm(r){var e,n;return typeof r!="string"?r:(n=r.match(g4))?n[1]:r.charAt(0)==="#"?(e=document.getElementById(r.substring(1)))?e.tagName==="CANVAS"||e.tagName==="VIDEO"||e.tagName==="IMG"?e:e.getAttribute("src"):void IB('"'+r+'" asset not found.'):r}function sm(r){return r.getAttribute?r.getAttribute("id")?"#"+r.getAttribute("id"):r.getAttribute("src"):bv(r)}function v4(r){return r}function bv(r){return r===null?"null":r.toString()}function BB(r,e){return r===e}function RB(r){return parseInt(r,10)}function Rb(r,e,n){return pv(r,e,n)}function Lb(r,e){if(r===null)return!0;if(typeof r!="object"||Object.keys(r).length!==e)return!1;var n=r.x,s=r.y,a=r.z,c=r.w;return!(typeof n!="number"||typeof s!="number"||e>2&&typeof a!="number"||e>3&&typeof c!="number")}Ss("audio","",rm,sm),Ss("array",[],function(r){return Array.isArray(r)?r:r&&typeof r=="string"?r.split(",").map(function(e){return e.trim()}):[]},function(r){return r.join(", ")},TB),Ss("asset","",rm,sm),Ss("boolean",!1,function(r){return r!=="false"&&r!==!1}),Ss("color","#FFF"),Ss("int",0,RB),Ss("number",0,function(r){return parseFloat(r,10)}),Ss("map","",rm,sm),Ss("model","",rm,sm),Ss("selector",null,function(r){return r?typeof r!="string"?r:r[0]!=="#"||m4.test(r)?document.querySelector(r):document.getElementById(r.substring(1)):null},function(r){return r.getAttribute?"#"+r.getAttribute("id"):bv(r)},BB,!1),Ss("selectorAll",null,function(r){return r?typeof r!="string"?r:Array.prototype.slice.call(document.querySelectorAll(r),0):null},function(r){return r instanceof Array?r.map(function(e){return"#"+e.getAttribute("id")}).join(", "):bv(r)},TB,!1),Ss("src","",function(r){return IB("`src` property type is deprecated. Use `asset` instead."),rm(r)},sm),Ss("string",""),Ss("time",0,RB),Ss("vec2",{x:0,y:0},Rb,Av,fv),Ss("vec3",{x:0,y:0,z:0},Rb,Av,fv),Ss("vec4",{x:0,y:0,z:0,w:1},Rb,Av,fv);var y4=function(r,e){return(r!=="audio"||typeof e=="string")&&!(r==="array"&&!Array.isArray(e))&&(r!=="asset"||typeof e=="string")&&(r!=="boolean"||typeof e=="boolean")&&(r!=="color"||typeof e=="string")&&(r!=="int"||typeof e=="number")&&(r!=="number"||typeof e=="number")&&(r!=="map"||typeof e=="string")&&(r!=="model"||typeof e=="string")&&(r!=="selector"||typeof e=="string"||e===null)&&(r!=="selectorAll"||typeof e=="string"||e===null)&&(r!=="src"||typeof e=="string")&&(r!=="string"||typeof e=="string")&&(r!=="time"||typeof e=="number")&&(r==="vec2"?Lb(e,2):r==="vec3"?Lb(e,3):r!=="vec4"||Lb(e,4))},E4=Bb,Cv=Bi("core:schema:warn");function wv(r){return"type"in r?typeof r.type=="string":"default"in r}function am(r,e){var n;if(wv(r))return Db(r,e);for(n in r)r[n]=Db(r[n],e);return r}function Db(r,e){var n,s,a=r.default,c=r.type;return r.type?r.type==="bool"?c="boolean":r.type==="float"&&(c="number"):c=a===void 0||typeof a!="boolean"&&typeof a!="number"?Array.isArray(a)?"array":"string":typeof a,(s=E4[c])||Cv("Unknown property type for component `"+e+"`: "+c),n=!!r.parse,r.parse=r.parse||s.parse,r.stringify=r.stringify||s.stringify,r.equals=r.equals||s.equals,r.isCacheable=r.isCacheable===!0||s.isCacheable,r.type=c,"default"in r?n||y4(c,a)||Cv("Default value `"+a+"` does not match type `"+c+"` in component `"+e+"`"):r.default=s.default,r}var om,LB=(om=[],function(r,e,n,s,a){var c,u,A,m;for(u in om.length=0,n?r:e)n&&r[u]===void 0||om.push(u);if(r===null||typeof r!="object")return r;for(u in r)r[u]===void 0||e[u]||a||Cv("Unknown property `"+u+"` for component/system `"+s+"`.");for(c=0;c<om.length;c++){if(A=e[u=om[c]],m=r[u],!e[u])return;r[u]=Mv(m,A)}return r});function Mv(r,e,n){return r!=null&&r!==""||(r=e.default,Array.isArray(r)&&(r=r.slice())),e.parse(r,e.default,n)}function DB(r,e){var n,s,a,c,u={};for(n in r)s=e[n],typeof(c=a=r[n])=="object"&&(c=Pb(a,s),s||Cv("Unknown component property: "+n)),c!==void 0&&(u[n]=c);return u}function Pb(r,e){return typeof r!="object"?r:e&&r!==null?e.stringify(r):JSON.stringify(r)}var Or={},lm=Mv,PB=am,x4=wv,_4=DB,b4=Pb,Ub=_,cm=Bi("core:component:warn"),C4=document.currentScript,w4=new RegExp("[A-Z]+"),UB={},M4=Object.freeze({}),Ip=[],S4={get:function(r,e){return r.getComputedPropertyValue(e)},set:function(r,e,n){return e in r.schema?r.recomputeProperty(e,n):n!==void 0&&r.handleUnknownProperty(e,n),!0}},hm=function(r,e,n){var s=this;if(this.sceneOnly&&!r.isScene)throw new Error("Component `"+this.name+"` can only be applied to <a-scene>");if(n&&!this.multiple)throw new Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=r,this.id=n,this.attrName=this.name+(n?"__"+n:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=UB[this.name];var a=this.events;this.events={},function(c,u){var A;for(A in u)c.events[A]=u[A].bind(c)}(this,a),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),Zf(this.data,this.schema),this.oldData=this.objectPool.use(),Zf(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,S4)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.throttledEmitComponentChanged=xB(function(){r.emit("componentchanged",s.evtDetail,!1)},200),this.updateProperties(e,!0)};hm.prototype={schema:{},init:function(){},events:{},update:function(r){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(r){var e=this.schema;return typeof r=="string"?r:this.isSingleProperty?b4(r,e):(r=_4(r,e),Ub.stringify(r))},flushToDOM:function(r){var e=r?this.data:this.attrValue;e!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(e))},updateProperties:function(r,e){var n=this.el;this.updateData(r,e),(n.hasLoaded||n.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var r,e=this.el;e.initializingComponents[this.name]||(e.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete e.initializingComponents[this.name],r=this.isObjectBased?M4:void 0,this.dataChanged=!1,this.storeOldData(),this.update(r),e.isPlaying&&this.play(),e.emit("componentinitialized",this.evtDetail,!1))},updateData:function(r,e){this.isSingleProperty?this.recomputeProperty(void 0,r):(e?(fb(this.attrValue),this.recomputeData(r),this.schemaChangeRequired=!!this.updateSchema):typeof r=="string"?Ub.parse(r,this.attrValueProxy):Sa(this.attrValueProxy,r),this.updateSchemaIfNeeded(r))},updateSchemaIfNeeded:function(r){if(this.schemaChangeRequired&&this.updateSchema)for(var e in Ip.length=0,this.updateSchema(this.data),Zf(this.data,this.schema),this.recomputeData(r),this.schemaChangeRequired=!1,this.attrValue)this.attrValue[e]!==void 0&&Ip.indexOf(e)===-1&&(e in this.schema||cm("Unknown property `"+e+"` for component `"+this.name+"`."));for(var n=0;n<Ip.length;n++)cm("Unknown property `"+Ip[n]+"` for component `"+this.name+"`.");Ip.length=0},callUpdateHandler:function(){if(this.isPositionRotationScale||this.dataChanged){this.dataChanged=!1;var r=this.oldData;this.oldDataInUse=!0,this.update(r),r!==this.oldData&&this.objectPool.recycle(r),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(r){(this.isSingleProperty||r in this.schema)&&(r?this.attrValue[r]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(r,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(r){var e;e=Sa({},Or[this.name].schema),Sa(e,r),this.schema=PB(e),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(r){var e=this.el.mixinEls,n=this.attrValue&&r?this.attrValue[r]:this.attrValue;if(n!==void 0)return n;for(var s=e.length-1;s>=0;s--){var a=e[s].getAttribute(this.attrName);if(a!==null&&(!r||r in a))return r?a[r]:a}return r?this.schema[r].default:this.schema.default},recomputeProperty:function(r,e){var n=r?this.schema[r]:this.schema;if(e!=null){this.attrValue===void 0&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var s=r?this.attrValue[r]:this.attrValue;typeof(s=n.isCacheable?lm(e,n,s):e)=="string"&&(s=e===""?void 0:e),r?this.attrValue[r]=s:this.attrValue=s}this.oldDataInUse&&(this.oldData=this.objectPool.use(),Zf(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var a=r?this.oldData[r]:this.oldData,c=r?this.data[r]:this.data,u=lm(this.getComputedPropertyValue(r),n,c);return n.type!=="array"||r||(u=wb(u)),n.equals(u,a)||(this.dataChanged=!0,n.schemaChange&&(this.schemaChangeRequired=!0)),r?this.data[r]=u:this.data=u,u},handleUnknownProperty:function(r,e){this.attrValue===void 0&&(this.attrValue=this.objectPool.use()),this.attrValue[r]=e,this.deferUnknownPropertyWarnings?Ip.push(r):this.silenceUnknownPropertyWarnings||cm("Unknown property `"+r+"` for component `"+this.name+"`.")},storeOldData:function(){var r;if(this.isObjectBased)if(this.isSingleProperty)this.oldData=lm(this.data,this.schema,this.oldData);else for(r in this.schema)this.data[r]!==void 0&&(this.data[r]&&typeof this.data[r]=="object"?this.oldData[r]=lm(this.data[r],this.schema[r],this.oldData[r]):this.oldData[r]=this.data[r]);else this.oldData=this.data},recomputeData:function(r){var e;if(this.isSingleProperty)this.recomputeProperty(void 0,r);else{for(e in this.schema)this.attrValueProxy[e]=void 0;r&&typeof r=="object"?Sa(this.attrValueProxy,r):typeof r=="string"&&Ub.parse(r,this.attrValueProxy)}},eventsAttach:function(){var r;for(r in this.eventsDetach(),this.events)this.el.addEventListener(r,this.events[r])},eventsDetach:function(){var r;for(r in this.events)this.el.removeEventListener(r,this.events[r])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}};var NB={};function sn(r,e){var n,s,a,c,u,A={};if(document.currentScript&&document.currentScript!==C4&&$u.forEach(function(v){v.hasLoaded||document.currentScript.compareDocumentPosition(v)!==Node.DOCUMENT_POSITION_FOLLOWING&&(cm("The component `"+r+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(NB[r]=!0))}),w4.test(r)===!0&&cm("The component name `"+r+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+r.toLowerCase()+"`"),r.indexOf("__")!==-1)throw new Error("The component name `"+r+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(e).forEach(function(v){A[v]={value:e[v],writable:!0}}),Or[r])throw new Error("The component `"+r+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");((n=function(v,E,C){hm.call(this,v,E,C)}).prototype=Object.create(hm.prototype,A)).name=r,n.prototype.isPositionRotationScale=r==="position"||r==="rotation"||r==="scale",n.prototype.constructor=n,n.prototype.system=D&&Ec[r],n.prototype.play=(c=n.prototype.play,function(){var v=this.el.sceneEl,E=this.el.isPlaying&&!this.isPlaying;this.initialized&&E&&(c.call(this),this.isPlaying=!0,this.eventsAttach(),FB(this)&&v.addBehavior(this))}),n.prototype.pause=(u=n.prototype.pause,function(){var v=this.el.sceneEl;this.isPlaying&&(u.call(this),this.isPlaying=!1,this.eventsDetach(),FB(this)&&v.removeBehavior(this))}),s=Sa(PB(n.prototype.schema,n.prototype.name)),n.prototype.isSingleProperty=a=x4(n.prototype.schema),n.prototype.isObjectBased=!a||a&&(OB(s.default)||OB(lm(void 0,s))),UB[r]=Ab(),Or[r]={Component:n,dependencies:n.prototype.dependencies,before:n.prototype.before,after:n.prototype.after,isSingleProperty:n.prototype.isSingleProperty,isObjectBased:n.prototype.isObjectBased,multiple:n.prototype.multiple,sceneOnly:n.prototype.sceneOnly,name:r,schema:s,stringify:n.prototype.stringify};for(var m=0;m<$u.length;m++)$u[m].emit("componentregistered",{name:r},!1);return n}function FB(r){return r.tick||r.tock}function OB(r){return r&&r.constructor===Object&&!(r instanceof window.HTMLElement)}var Sv=!1;function Nb(){Sv||(Sv=!0,setTimeout(function(){document.dispatchEvent(new CustomEvent("aframeready"))}))}var I4=_,Ec={},Iv=function(r){var e=U&&Or[this.name];this.el=r,this.sceneEl=r,e&&(e.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};function Ao(r,e){var n,s,a={},c=wB(document);if(Object.keys(e).forEach(function(u){a[u]={value:e[u],writable:!0}}),Ec[r])throw new Error("The system `"+r+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if(s=function(u){Iv.call(this,u)},(s.prototype=Object.create(Iv.prototype,a)).name=r,s.prototype.constructor=s,s.prototype.schema=Sa(am(s.prototype.schema)),Ec[r]=s,Sv)for(n=0;n<c.length;n++)c[n].initSystem(r)}Iv.prototype={schema:{},init:function(){},update:function(r){},updateProperties:function(r){var e=this.data;Object.keys(this.schema).length!==0&&(this.buildData(r),this.update(e))},buildData:function(r){var e=this.schema;Object.keys(e).length!==0&&(r=r||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),wv(e)?this.data=Mv(r,e):this.data=LB(I4.parse(r)||{},e,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}};var Fb=Bi("core:a-node:warn"),Ob={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function T4(r){return r.tagName.toLowerCase()in Ob||r.isANode}class Is extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isANode=!0,this.mixinEls=[]}connectedCallback(){Sv?this.doConnectedCallback():document.addEventListener("aframeready",this.connectedCallback.bind(this))}doConnectedCallback(){var e;this.sceneEl=this.closestScene(),this.sceneEl||Fb("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(e=this.getAttribute("mixin"))&&this.updateMixins(e)}attributeChangedCallback(e,n,s){s!==this.computedMixinStr&&(e!=="mixin"||this.isMixin||this.updateMixins(s,n))}closestScene(){for(var e=this;e&&!e.isScene;)e=e.parentElement;return e}closest(e){for(var n=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,s=this;s&&!n.call(s,e);)s=s.parentElement;return s}disconnectedCallback(){this.hasLoaded=!1}load(e,n){var s,a=this;this.hasLoaded||(n=n||T4,s=this.getChildren().filter(n).map(function(c){return new Promise(function(u,A){if(c.hasLoaded)return u();c.addEventListener("loaded",u),c.addEventListener("error",A)})}),Promise.allSettled(s).then(function(c){c.forEach(function(u){u.status==="rejected"&&Fb("Rendering scene with errors on node: ",u.reason.target)}),a.isLoading=!0,a.setupMutationObserver(),e&&e(),a.isLoading=!1,a.hasLoaded=!0,a.emit("loaded-private",void 0,!1),a.emit("loaded",void 0,!1)}))}setupMutationObserver(){var e=this;new MutationObserver(function(n){var s;for(s=0;s<n.length;s++)if(n[s].type==="attributes"){var a=n[s].attributeName,c=window.HTMLElement.prototype.getAttribute.call(e,a),u=n[s].oldValue;e.attributeChangedCallback(a,u,c)}}).observe(this,{attributes:!0,attributeOldValue:!0})}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(e,n){var s,a,c,u=Is.newMixinIdArray,A=Is.oldMixinIdArray,m=Is.mixinIds;for(u.length=0,A.length=0,a=e?yc(e.trim(),/\s+/):u,c=n?yc(n.trim(),/\s+/):A,m.newMixinIds=a,m.oldMixinIds=c,s=0;s<c.length;s++)a.indexOf(c[s])===-1&&this.unregisterMixin(c[s]);for(this.computedMixinStr="",this.mixinEls.length=0,s=0;s<a.length;s++)this.registerMixin(a[s]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),a.length===0&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),m}registerMixin(e){var n,s,a,c=document.getElementById(e);if(c){if(a=c.getAttribute("mixin"))for(n=yc(a.trim(),/\s+/),s=0;s<n.length;s++)this.registerMixin(n[s]);this.computedMixinStr=this.computedMixinStr+" "+c.id,this.mixinEls.push(c)}else Fb("No mixin was found with id `%s`",e)}setAttribute(e,n){e==="mixin"&&this.updateMixins(n),window.HTMLElement.prototype.setAttribute.call(this,e,n)}unregisterMixin(e){var n,s=this.mixinEls;for(n=0;n<s.length;++n)if(e===s[n].id){s.splice(n,1);break}}emit(e,n,s,a){var c=Is.evtData;s===void 0&&(s=!0),c.bubbles=!!s,c.detail=n,a&&(c=Sa({},a,c)),this.dispatchEvent(new CustomEvent(e,c))}}Is.evtData={},Is.newMixinIdArray=[],Is.oldMixinIdArray=[],Is.mixinIds={},customElements.define("a-node",Is);var B4=Bi("core:a-entity:debug"),kb=Bi("core:a-entity:warn"),Tv="__",Qb=["position","rotation","scale","visible"],R4={once:!0};class is extends Is{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new wa,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(e,n,s){var a=this.components[e];super.attributeChangedCallback(),a&&a.justInitialized&&s===""?delete a.justInitialized:(a||s!==null)&&this.setEntityAttribute(e,n,s)}doConnectedCallback(){var e,n,s=this;super.doConnectedCallback(),n=this.sceneEl,this.addToParent(),this.isScene||(n?!(e=n.querySelector("a-assets"))||e.hasLoaded?this.load():e.addEventListener("loaded",function(){s.load()}):this.load())}disconnectedCallback(){var e;if(this.parentEl){for(e in this.components)this.removeComponent(e,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(e){return this.object3DMap[e]}setObject3D(e,n){var s,a=this;if(!(n instanceof kn))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(s=this.getObject3D(e))&&this.object3D.remove(s),n.el=this,n.children.length&&n.traverse(function(c){c.el=a}),this.object3D.add(n),this.object3DMap[e]=n,this.emit("object3dset",{object:n,type:e})}removeObject3D(e){var n=this.getObject3D(e);n?(this.object3D.remove(n),delete this.object3DMap[e],this.emit("object3dremove",{type:e})):kb("Tried to remove `Object3D` of type:",e,"which was not defined.")}getOrCreateObject3D(e,n){var s=this.getObject3D(e);return!s&&n&&(s=new n,this.setObject3D(e,s)),kb("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),s}add(e){if(!e.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(e.object3D),this.emit("child-attached",{el:e})}addToParent(){var e=this.parentEl=this.parentNode;e&&e.add&&!this.attachedToParent&&(e.add(this),this.attachedToParent=!0)}removeFromParent(){var e=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,e.emit("child-detached",{el:this})}load(){var e=this;!this.hasLoaded&&this.parentEl&&super.load.call(this,function(){e.parentEl&&(e.updateComponents(),(e.isScene||e.parentEl.isPlaying)&&e.play())})}remove(e){e?this.object3D.remove(e.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var e=this.children,n=[],s=0;s<e.length;s++){var a=e[s];a instanceof is&&n.push(a)}return n}initComponent(e,n,s){var a,c,u,A;A=(u=yc(e,Tv))[0],c=u.length>2?u.slice(1).join("__"):u[1],Or[A]&&(kB(this,e)||n!==void 0||s)&&(e in this.components||(this.initComponentDependencies(A),a=new Or[A].Component(this,n,c),this.isPlaying&&a.play(),this.hasAttribute(e)||(a.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,e,"")),B4("Component initialized: %s",e)))}initComponentDependencies(e){var n,s;if(Or[e]&&(n=Or[e].dependencies))for(s=0;s<n.length;s++)this.initComponent(n[s],window.HTMLElement.prototype.getAttribute.call(this,n[s])||void 0,!0)}removeComponent(e,n){var s;(s=this.components[e])&&(s.initialized?(s.pause(),s.remove(),n&&(s.destroy(),delete this.components[e],this.hasAttribute(e)&&window.HTMLElement.prototype.removeAttribute.call(this,e)),this.emit("componentremoved",s.evtDetail,!1)):this.addEventListener("componentinitialized",function a(c){c.detail.name===e&&(this.removeComponent(e,n),this.removeEventListener("componentinitialized",a))}))}updateComponents(){var e,n,s,a,c,u,A=this.componentsToUpdate;if(this.hasLoaded||this.isLoading){for(s=0;s<this.mixinEls.length;s++)for(a in this.mixinEls[s].componentCache)Gb(a)&&(A[a]=!0);if(this.getExtraComponents)for(a in n=this.getExtraComponents())Gb(a)&&(A[a]=!0);for(s=0;s<this.attributes.length;++s)a=this.attributes[s].name,Qb.indexOf(a)===-1&&Gb(a)&&(A[a]=!0);for(s=0;s<Qb.length;s++)a=Qb[s],this.hasAttribute(a)&&this.updateComponent(a,this.getDOMAttribute(a));for(a in A)c=this.getDOMAttribute(a),e=(u=n&&n[a])?u.constructor===Object?Sa(u,tm(c||{})):c||u:c,this.updateComponent(a,e),delete A[a]}}updateComponent(e,n,s){var a=this.components[e];if(a)return n!==null||kB(this,e)?void a.updateProperties(n,s):void this.removeComponent(e,!0);this.initComponent(e,n,!1)}removeAttribute(e,n){var s=this.components[e];s&&n===void 0&&this.removeComponent(e,!0),s&&n!==void 0?s.resetProperty(n):(e==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,e))}play(){var e,n,s;if(!this.isPlaying&&(this.hasLoaded||this.isLoading)){for(s in this.isPlaying=!0,this.components)this.components[s].play();for(e=this.getChildEntities(),n=0;n<e.length;n++)e[n].play();this.emit("play")}}pause(){var e,n,s;if(this.isPlaying){for(s in this.isPlaying=!1,this.components)this.components[s].pause();for(e=this.getChildEntities(),n=0;n<e.length;n++)e[n].pause();this.emit("pause")}}setEntityAttribute(e,n,s){if(Or[e]||this.components[e])this.updateComponent(e,s);else if(e==="mixin"){if(s===this.computedMixinStr)return;this.mixinUpdate(s,n)}}mixinUpdate(e,n,s){var a,c,u,A,m=is.componentsUpdated,v=this;if(s||(n=n||this.getAttribute("mixin")),this.hasLoaded){for(u=this.updateMixins(e,n),m.length=0,A=0;A<this.mixinEls.length;A++)for(a in this.mixinEls[A].componentCache)m.indexOf(a)===-1&&(this.components[a]?this.components[a].handleMixinUpdate():this.initComponent(a,null),m.push(a));for(A=0;A<u.oldMixinIds.length;A++)if(c=document.getElementById(u.oldMixinIds[A]))for(a in c.componentCache)m.indexOf(a)===-1&&this.components[a]&&(this.getDOMAttribute(a)?this.components[a].handleMixinUpdate():this.removeComponent(a,!0))}else this.addEventListener("loaded-private",function(){v.mixinUpdate(e,n,!0)},R4)}setAttribute(e,n,s){var a,c,u,A,m,v=is.singlePropUpdate;if(u=(A=e.indexOf(Tv))>0?e.substring(0,A):e,!Or[u])return e==="mixin"&&this.mixinUpdate(n),void super.setAttribute.call(this,e,n);if(!this.components[e]&&this.hasAttribute(e)&&this.updateComponent(e,window.HTMLElement.prototype.getAttribute.call(this,e)),s!==void 0&&typeof n=="string"&&n.length>0&&typeof tm(n)=="string"){for(m in v)delete v[m];(a=v)[n]=s,c=!1}else a=n,c=s===!0;this.updateComponent(e,a,c),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[e].flushToDOM()}flushToDOM(e){var n,s,a,c=this.components,u=this.children;for(a in c)c[a].flushToDOM();if(e)for(s=0;s<u.length;++s)(n=u[s]).flushToDOM&&n.flushToDOM(e)}getAttribute(e){var n,s,a,c,u;return e==="position"?this.object3D.position:e==="rotation"?(s=this,a=Tr.radToDeg,c=s.object3D.rotation,(u=s.rotationObj).x=a(c.x),u.y=a(c.y),u.z=a(c.z),u):e==="scale"?this.object3D.scale:e==="visible"?this.object3D.visible:(n=this.components[e])?n.data:window.HTMLElement.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var n=this.components[e];return n?n.attrValue:window.HTMLElement.prototype.getAttribute.call(this,e)}addState(e){this.is(e)||(this.states.push(e),this.emit("stateadded",e))}removeState(e){var n=this.states.indexOf(e);n!==-1&&(this.states.splice(n,1),this.emit("stateremoved",e))}is(e){return this.states.indexOf(e)!==-1}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var e;if(this.parentNode)kb("Entity can only be destroyed if detached from scenegraph.");else for(e in this.components)this.components[e].destroy()}}function kB(r,e){return!(!r.components[e]||!r.components[e].attrValue)||function(n,s){var a,c=!1;for(a=0;a<s.length&&!(c=s[a].hasAttribute(n));++a);return c}(e,r.mixinEls)}function Gb(r){return r.indexOf(Tv)!==-1&&(r=yc(r,Tv)[0]),!!Or[r]}function L4(r){if(r.data&&r.data.type==="vr")switch(r.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}is.componentsUpdated=[],is.singlePropUpdate={},customElements.define("a-entity",is),$f()&&window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)});var Hb=Bi("core:a-scene:warn"),D4=$f(),QB=xh(),P4=dv;class GB extends is{constructor(){var e;super(),(e=this).clock=new X0,e.isIOS=D4,e.isMobile=QB,e.hasWebXR=P4,e.isAR=!1,e.isScene=!0,e.object3D=new u0,e.resize=e.resize.bind(e),e.render=e.render.bind(e),e.systems={},e.systemNames=[],e.time=e.delta=0,e.usedOfferSession=!1,e.componentOrder=[],e.behaviors={},e.hasLoaded=!1,e.isPlaying=!1,e.originalHTML=e.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var e=this,n=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),function(s){var a;function c(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||s.exitVR(),document.activeElement.blur(),document.body.focus()}(a=document.createElement("canvas")).classList.add("a-canvas"),a.dataset.aframeCanvas=!0,s.appendChild(a),document.addEventListener("fullscreenchange",c),document.addEventListener("mozfullscreenchange",c),document.addEventListener("webkitfullscreenchange",c),document.addEventListener("MSFullscreenChange",c),a.addEventListener("touchmove",function(u){u.preventDefault()},{passive:!1}),s.canvas=a,s.emit("render-target-loaded",{target:a}),setTimeout(s.resize.bind(s),0)}(this),this.setupRenderer(),function(s,a){MB=a;var c,u,A,m,v,E,C,M,S,B,N=(Vo=s).hasAttribute(SB)?f4.parse(Vo.getAttribute(SB)):void 0,L=N&&N.dotsColor||"white",F=N&&N.backgroundColor||"#24CAFF";(N===void 0||N.enabled==="true"||N.enabled===void 0)&&(c=new u0,u=new Bu(.2,36,18,0,2*Math.PI,0,Math.PI),A=new Jr({color:L}),m=new Ti(u,A),v=m.clone(),E=m.clone(),C=new Hr(80,window.innerWidth/window.innerHeight,5e-4,1e4),M=new X0,S=0,B=function(){Vo.renderer.render(c,C),S=M.getElapsedTime()%4,m.visible=S>=1,v.visible=S>=2,E.visible=S>=3},c.background=new Mt(F),c.add(C),m.position.set(-1,0,-15),v.position.set(0,0,-15),E.position.set(1,0,-15),C.add(m),C.add(v),C.add(E),(_h=document.createElement("div")).className="a-loader-title",_h.innerHTML=document.title,_h.style.display="none",_h.setAttribute(Ms,""),Vo.appendChild(_h),setTimeout(function(){Vo.hasLoaded||(Tb(C),_h.style.display="block",window.addEventListener("resize",function(){Tb(C)}),Vo.renderer.setAnimationLoop(B))},200))}(this,VB),this.resize(),n||this.addFullScreenStyles(),CB()&&window.addEventListener("message",L4.bind(this)),function(s){var a,c=document.head,u=c.querySelector("script"),A=[];return u4.forEach(m),s.isIOS&&d4.forEach(m),A;function m(v){v&&!v.exists()&&(a=function(E){if(E&&E.tagName){var C=document.createElement(E.tagName);return C.setAttribute(Ms,""),Sa(C,E.attributes)}}(v),a&&(u?u.parentNode.insertBefore(a,u):c.appendChild(a),A.push(a)))}}(this),function(s){if(s.isMobile){var a=s.wakelock=new(A4());s.addEventListener("enter-vr",function(){a.request()}),s.addEventListener("exit-vr",function(){a.release()})}}(this),this.enterVRBound=function(){e.enterVR()},this.exitVRBound=function(){e.exitVR()},window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){e.attachedCallbackPostCamera()}),this.initSystems(),this.componentOrder=HB(Or,this.componentOrder),this.addEventListener("componentregistered",function(){e.componentOrder=HB(Or,e.componentOrder)}),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){e.enterVR()})}attachedCallbackPostCamera(){var e=this;window.addEventListener("load",void 0),window.addEventListener("resize",function(){e.isIOS?setTimeout(e.resize,100):e.resize()}),this.play(),$u.push(this)}initSystems(){var e;for(e in this.initSystem("camera"),Ec)e!=="camera"&&this.initSystem(e)}initSystem(e){this.systems[e]||(this.systems[e]=new Ec[e](this),this.systemNames.push(e))}disconnectedCallback(){var e=$u.indexOf(this);super.disconnectedCallback(),$u.splice(e,1),window.removeEventListener("sessionend",this.resize),this.removeFullScreenStyles(),this.renderer.dispose()}addBehavior(e){var n,s,a=this.behaviors[e.name];for(s in a||(a=this.behaviors[e.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}}),a)if(e[s]){if((n=a[s]).inUse){var c=n.markedForRemoval.indexOf(e);c!==-1&&n.markedForRemoval.splice(c,1)}n.array.indexOf(e)===-1&&n.array.push(e)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return sb()}enterAR(){var e;if(!this.hasWebXR)throw e="Failed to enter AR mode, WebXR not supported.",new Error(e);if(!ab())throw e="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(e);return this.enterVR(!0)}enterVR(e,n){var s,a=this,c=a.renderer.xr;if(n&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(a.usedOfferSession&&n)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var u=a.getAttribute("renderer");if(c.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var A=this.sceneEl.systems.webxr.sessionReferenceSpaceType;c.setReferenceSpaceType(A);var m=e?"immersive-ar":"immersive-vr";return s=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(E,C){var M=n?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);a.usedOfferSession|=n,M(m,s).then(function(S){n&&(a.usedOfferSession=!1),c.layersEnabled=s.requiredFeatures.indexOf("layers")!==-1,c.setSession(S).then(function(){c.setFoveation(u.foveationLevel),a.xrSession=S,a.systems.renderer.setWebXRFrameRate(S),S.addEventListener("end",a.exitVRBound),v(E)})},function(S){C(new Error("Failed to enter "+(m==="immersive-ar"?"AR":"VR")+" mode (`requestSession`)",{cause:S}))})})}throw new Error("Failed to enter "+(e?"AR":"VR")+" no WebXR")}return v(),Promise.resolve();function v(E){var C;e?a.addState("ar-mode"):a.addState("vr-mode"),a.emit("enter-vr",{target:a}),!a.hasWebXR&&a.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),a.addFullScreenStyles(),a.isMobile||a.checkHeadsetConnected()||((C=a.canvas).requestFullscreen||C.webkitRequestFullscreen||C.mozRequestFullScreen||C.msRequestFullscreen).apply(C,[{navigationUI:"hide"}]),a.resize(),E&&E()}}exitVR(){var e=this,n=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(n.enabled=!1,!this.hasWebXR)throw Error("Failed to exit VR - no WebXR");this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0}else(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());return e.removeState("vr-mode"),e.removeState("ar-mode"),e.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),e.hasAttribute("embedded")&&e.removeFullScreenStyles(),e.resize(),e.isIOS&&AB(e.canvas),e.renderer.setPixelRatio(window.devicePixelRatio),e.emit("exit-vr",{target:e}),Promise.resolve()}getAttribute(e){var n=this.systems[e];return n?n.data:is.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var n=this.systems[e];return n?n.data:is.prototype.getDOMAttribute.call(this,e)}setAttribute(e,n,s){if(Ec[e]){Is.prototype.setAttribute.call(this,e,n);var a=this.systems[e];a&&a.updateProperties(n)}else is.prototype.setAttribute.call(this,e,n,s)}removeBehavior(e){var n,s,a,c=this.behaviors[e.name];for(s in c)e[s]&&(a=(n=c[s]).array.indexOf(e))!==-1&&(n.inUse?n.markedForRemoval.indexOf(e)===-1&&n.markedForRemoval.push(e):(n.array[a]=n.array[n.array.length-1],n.array.pop()))}resize(){var e,n,s=this.camera,a=this.canvas,c=this.renderer.xr.isPresenting;e=this.renderer.xr.enabled&&c,!s||!a||this.is("vr-mode")&&(this.isMobile||e)||(n=VB(a,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),s.aspect=n.width/n.height,s.updateProjectionMatrix(),this.renderer.setSize(n.width,n.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var e,n,s,a=this;s={alpha:!0,antialias:!QB,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&((n=tm(this.getAttribute("renderer"))).precision&&(s.precision=n.precision+"p"),n.antialias&&n.antialias!=="auto"&&(s.antialias=n.antialias==="true"),n.logarithmicDepthBuffer&&n.logarithmicDepthBuffer!=="auto"&&(s.logarithmicDepthBuffer=n.logarithmicDepthBuffer==="true"),n.alpha&&(s.alpha=n.alpha==="true"),n.stencil&&(s.stencil=n.stencil==="true"),n.multiviewStereo&&(s.multiviewStereo=n.multiviewStereo==="true"),this.maxCanvasSize={width:n.maxCanvasWidth?parseInt(n.maxCanvasWidth):this.maxCanvasSize.width,height:n.maxCanvasHeight?parseInt(n.maxCanvasHeight):this.maxCanvasSize.height});var c=["WebGLRenderer","WebGPURenderer"].find(function(u){return l[u]});(e=this.renderer=new l[c](s)).xr.setPoseTarget||(e.xr.setPoseTarget=function(){}),e.setPixelRatio(window.devicePixelRatio),this.camera&&e.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){e.xr.setPoseTarget(a.camera.el.object3D)})}play(){var e=this,n=this;this.renderStarted?is.prototype.play.call(this):(this.addEventListener("loaded",function(){var s=this.renderer;is.prototype.play.call(this),n.renderStarted||(n.resize(),n.renderer&&(window.performance&&window.performance.mark("render-started"),window.removeEventListener("resize",Tb),_h&&(_h.style.display="none"),s.setAnimationLoop(this.render),n.renderStarted=!0,n.emit("renderstart")))}),setTimeout(function(){is.prototype.load.call(e)}))}updateComponent(e){e in Ec||is.prototype.updateComponent.apply(this,arguments)}tick(e,n){var s,a=this.systems;for(this.callComponentBehaviors("tick",e,n),s=0;s<this.systemNames.length;s++)a[this.systemNames[s]].tick&&a[this.systemNames[s]].tick(e,n)}tock(e,n,s){var a,c=this.systems;for(this.callComponentBehaviors("tock",e,n),a=0;a<this.systemNames.length;a++)c[this.systemNames[a]].tock&&c[this.systemNames[a]].tock(e,n,s)}render(e,n){var s=this.renderer;this.frame=n,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var a=null;if(this.is("ar-mode")&&(a=this.object3D.background,this.object3D.background=null),s.render(this.object3D,this.camera),a&&(this.object3D.background=a),this.isPlaying){var c=s.xr.isPresenting?s.xr.getCamera():this.camera;this.tock(this.time,this.delta,c)}}callComponentBehaviors(e,n,s){for(var a,c=0;c<this.componentOrder.length;c++){var u=this.behaviors[this.componentOrder[c]];if(u){var A=u[e];for(A.inUse=!0,a=0;a<A.array.length;a++)A.array[a].isPlaying&&A.array[a][e](n,s);for(A.inUse=!1,a=0;a<A.markedForRemoval.length;a++)this.removeBehavior(A.markedForRemoval[a]);A.markedForRemoval.length=0}}}}function HB(r,e){var n,s,a={},c=e||[];for(s in c.length=0,r){var u=r[s];if(u!==void 0){var A=u.before?u.before.slice(0):[],m=u.after?u.after.slice(0):[];a[s]={before:A,after:m,visited:!1,done:!1}}}for(s in a)for(n=0;n<a[s].before.length;n++){var v=a[s].before[n];v in a?a[v].after.push(s):Hb("Invalid ordering constraint, no component named `"+v+"` referenced by `"+s+"`")}function E(C){if(C in a&&!a[C].done)if(a[C].visited)Hb("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");else{a[C].visited=!0;for(var M=0;M<a[C].after.length;M++){var S=a[C].after[M];S in a||Hb("Invalid before/after constraint, no component named `"+S+"` referenced in `"+C+"`"),E(S)}a[C].done=!0,c.push(C)}}for(s in a)a[s].done||E(s);return c}function zB(r,e){var n,s=window.devicePixelRatio;return!e||e.width===-1&&e.height===-1||r.width*s<e.width&&r.height*s<e.height||(n=r.width/r.height,r.width*s>e.width&&e.width!==-1&&(r.width=Math.round(e.width/s),r.height=Math.round(e.width/n/s)),r.height*s>e.height&&e.height!==-1&&(r.height=Math.round(e.height/s),r.width=Math.round(e.height*n/s))),r}function VB(r,e,n,s){return r.parentElement?e?zB({height:r.parentElement.offsetHeight,width:r.parentElement.offsetWidth},n):function(a,c){var u;return u={height:document.body.offsetHeight,width:document.body.offsetWidth},c?u:zB(u,a)}(n,s):{height:0,width:0}}customElements.define("a-scene",GB);var U4=am,bh={},zb=[],Vb=function(){};function ta(r,e){var n,s={};if(Object.keys(e).forEach(function(a){s[a]={value:e[a],writable:!0}}),bh[r])throw new Error("The geometry `"+r+"` has been already registered");return((n=function(){Vb.call(this)}).prototype=Object.create(Vb.prototype,s)).name=r,n.prototype.constructor=n,bh[r]={Geometry:n,schema:U4(n.prototype.schema)},zb.push(r),n}Vb.prototype={schema:{},init:function(r){return this.geometry=new vn,this.geometry},update:function(r){}};var Wb=Bi,N4=mb,F4=Wb("extras:primitives:debug"),WB=Wb("extras:primitives:warn"),O4=Wb("extras:primitives:error"),jB={};function na(r,e){if(r=r.toLowerCase(),!Ob[r]){Ob[r]=!0,F4("Registering <%s>",r),e.defaultAttributes&&WB("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var n=e.mappings||{},s=class extends is{constructor(){super(),this.defaultComponentsFromPrimitive=e.defaultComponents||e.defaultAttributes||{},this.deprecated=e.deprecated||null,this.deprecatedMappings=e.deprecatedMappings||{},this.mappings=n,e.deprecated&&console.warn(e.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var a=this.mappings,c=this;Object.keys(a).forEach(function(u){var A;u!==u.toLowerCase()&&WB("Mapping keys should be specified in lower case. The mapping key "+u+" may not be recognized"),Or[u]&&(A=a[u].replace(".","-"),a[A]=a[u],delete a[u],console.warn("The primitive "+c.tagName.toLowerCase()+" has a mapping collision. The attribute "+u+" has the same name as a registered component and has been renamed to "+A))})}getExtraComponents(){var a,c,u,A,m,v=this;for(c=wb(this.defaultComponentsFromPrimitive),(m=this.getAttribute("mixin"))&&(m=yc(m.trim(),/\s+/)).forEach(function(S){var B,N,L=document.getElementById(S);if(L){var F=L.rawAttributeCache,O=L.componentCache;for(var H in F){if(A=v.mappings[H])return void qB(A,F[H],c);H in O&&(c[H]=(B=c[H],N=O[H],E(B)?C(N):E(N)?C(B):M(B)&&M(N)?Wa(B,N):C(N)))}}}),u=0;u<this.attributes.length;u++)a=this.attributes[u],(A=this.mappings[a.name])&&qB(A,a.value,c);return c;function E(S){return S===void 0}function C(S){return M(S)?Wa({},S):S}function M(S){return S!==null&&S.constructor===Object}}attributeChangedCallback(a,c,u){var A=this.mappings[a];a in this.deprecatedMappings&&console.warn(this.deprecatedMappings[a]),a&&A?N4(this,A,u):super.attributeChangedCallback(a,c,u)}};return customElements.define(r,s),s.mappings=n,jB[r]=s,s}O4("Trying to register primitive "+r+" that has been already previously registered")}function qB(r,e,n){var s=mv(r);s.constructor===Array?(n[s[0]]=n[s[0]]||{},n[s[0]][s[1]]=e.trim()):n[s]=e.trim()}var bl={},XB=[],k4={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},jb=function(){};function Ch(r,e){var n,s={};if(Object.keys(e).forEach(function(a){s[a]={value:e[a],writable:!0}}),bl[r])throw new Error("The shader "+r+" has already been registered");return((n=function(){jb.call(this)}).prototype=Object.create(jb.prototype,s)).name=r,n.prototype.constructor=n,bl[r]={Shader:n,schema:am(n.prototype.schema)},XB.push(r),n}jb.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(r){return this.uniforms=this.initUniforms(),this.material=new(this.raw?G0:Ca)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?xu:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var r,e,n=this.schema,s={};for(r in n)n[r].is==="uniform"&&(e=k4[n[r].type],s[r]={type:e,value:void 0});return s},update:function(r){var e,n,s=this.schema,a=this.uniforms;for(e in r)if(s[e]&&s[e].is==="uniform")if(s[e].type!=="map")a[e].value=this.parseValue(s[e].type,r[e]),a[e].needsUpdate=!0;else{if(!a[e]||a[e].value===r[e])continue;n="_texture_"+e,this.setMapOnTextureLoad(a,e,n),Ev(n,e,this,r)}},parseValue:function(r,e){var n;switch(r){case"vec2":return new ct(e.x,e.y);case"vec3":return new R(e.x,e.y,e.z);case"vec4":return new pi(e.x,e.y,e.z,e.w);case"color":return n=new Mt(e),new R(n.r,n.g,n.b);default:return e}},setMapOnTextureLoad:function(r,e,n){var s=this;this.el.addEventListener("materialtextureloaded",function(){r[e].value=s.material[n],r[e].needsUpdate=!0})}};var qb=new Zr,Xb=Bi("core:a-assets:warn");function Q4(r){if(r.hasAttribute("autoplay")||r.getAttribute("preload")==="auto")return new Promise(function(e,n){if(r.readyState===4)return e();if(r.error)return n();function s(){for(var a=0,c=0;c<r.buffered.length;c++)a+=r.buffered.end(c)-r.buffered.start(c);a>=r.duration&&(r.tagName==="VIDEO"&&co.add(r.getAttribute("src"),r),e())}r.addEventListener("loadeddata",s,!1),r.addEventListener("progress",s,!1),r.addEventListener("error",n,!1)})}function YB(r){var e=function(n){var s,a,c;return n.hasAttribute("crossorigin")||(s=n.getAttribute("src"))!==null&&(s.indexOf("://")===-1||(c=(a=s).indexOf("://")>-1?a.split("/")[2]:a.split("/")[0]).substring(0,c.indexOf(":"))===window.location.host)?n:(Xb('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',s),n.crossOrigin="anonymous",n.cloneNode(!0))}(r);return e.tagName&&e.tagName.toLowerCase()==="video"&&(e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline","")),e!==r&&(r.parentNode.appendChild(e),r.parentNode.removeChild(r)),e}customElements.define("a-assets",class extends Is{constructor(){super(),this.isAssets=!0,this.fileLoader=qb,this.timeout=null}doConnectedCallback(){var r,e,n,s,a,c,u=this,A=[];if(super.doConnectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(a=this.querySelectorAll("img"),r=0;r<a.length;r++)s=YB(a[r]),A.push(new Promise(function(m,v){co.add(a[r].getAttribute("src"),s),s.complete?m():(s.onload=m,s.onerror=v)}));for(n=this.querySelectorAll("audio, video"),r=0;r<n.length;r++)(e=YB(n[r])).src||e.srcObject||Xb("Audio/video asset has neither `src` nor `srcObject` attributes."),A.push(Q4(e));this.getChildren().forEach(function(m){m.isAssetItem&&m.hasAttribute("src")&&A.push(new Promise(function(v,E){if(m.hasLoaded)return v();m.addEventListener("loaded",v),m.addEventListener("error",E)}))}),Promise.allSettled(A).then(function(){u.timeout!==null&&u.load()}),c=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){u.hasLoaded||(Xb("Asset loading timed out in",c,"ms"),u.timeout=null,u.emit("timeout"),u.load())},c)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(){return!1})}}),customElements.define("a-asset-item",class extends Is{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var r=this,e=this.getAttribute("src");qb.setResponseType(this.getAttribute("response-type")||function(n){var s=function(c){var u=document.createElement("a");u.href=c;var A=u.search.replace(/^\?/,""),m=c.replace(A,"").replace("?","");return m.substring(m.lastIndexOf("/")+1)}(n),a=s.lastIndexOf(".");return a>=0&&s.slice(a,n.search(/\?|#|$/))===".glb"?"arraybuffer":"text"}(e)),qb.load(e,function(n){r.data=n,Is.prototype.load.call(r)},function(n){r.emit("progress",{loadedBytes:n.loaded,totalBytes:n.total,xhr:n})},function(n){r.emit("error",{xhr:n},!1)})}});var G4=Bi("core:cubemap:warn");class Yb extends HTMLElement{constructor(e){return super(e)}onReadyStateChange(){document.readyState==="complete"&&this.doConnectedCallback()}connectedCallback(){document.readyState==="complete"?Yb.prototype.doConnectedCallback.call(this):document.addEventListener("readystatechange",this.onReadyStateChange.bind(this))}doConnectedCallback(){this.srcs=this.validate()}validate(){var e,n=this.querySelectorAll("[src]"),s=[];if(n.length===6){for(e=0;e<n.length;e++)n[e].tagName==="IMG"?s.push(n[e]):s.push(n[e].getAttribute("src"));return s}G4("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",Yb),customElements.define("a-mixin",class extends Is{constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(r,e,n){super.attributeChangedCallback(),this.cacheAttribute(r,n),this.updateEntities()}setAttribute(r,e){window.HTMLElement.prototype.setAttribute.call(this,r,e),this.cacheAttribute(r,e)}cacheAttribute(r,e){var n,s;s=yc(r,"__")[0],n=Or[s],e===void 0&&(e=window.HTMLElement.prototype.getAttribute.call(this,r)),this.rawAttributeCache[r]=e,n&&(this.componentCache[r]=this.parseComponentAttrValue(n,e))}parseComponentAttrValue(r,e){var n;return typeof e!="string"?e:(r.isSingleProperty?typeof(n=r.schema.parse(e))=="string"&&(n=e):n=tm(e),n)}getAttribute(r){return this.componentCache[r]||window.HTMLElement.prototype.getAttribute.call(this,r)}cacheAttributes(){var r,e,n=this.attributes;for(e=0;e<n.length;e++)r=n[e].name,this.cacheAttribute(r)}updateEntities(){var r,e,n;if(this.sceneEl)for(e=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),n=0;n<e.length;n++)(r=e[n]).hasLoaded&&!r.isMixin&&r.mixinUpdate(this.id)}});const KB="1.7.0";var Bv=new Mt,Rv=new Mt,JB=pB,$B=mb,Kb={},ZB="color",e2="rotation",t2="components";function n2(r){r.x=Tr.degToRad(r.x),r.y=Tr.degToRad(r.y),r.z=Tr.degToRad(r.z)}function Jb(r,e,n){var s;for(s=0;s<e.length;s++)r.addEventListener(e[s],n)}function $b(r,e,n){var s;for(s=0;s<e.length;s++)r.removeEventListener(e[s],n)}function i2(r,e){var n,s,a;for(s=Lv(e),a=r,n=0;n<s.length;n++)a=a[s[n]];if(a===void 0)throw console.log(r),new Error("[animation] property ("+e+") could not be found");return a}function r2(r,e,n,s){var a,c,u,A;for(e.startsWith("object3D.rotation")&&(n=Tr.degToRad(n)),c=Lv(e),A=r,a=0;a<c.length-1;a++)A=A[c[a]];u=c[c.length-1],s!==ZB?A[u]=n:"r"in A[u]?(A[u].r=n.r,A[u].g=n.g,A[u].b=n.b):(A[u].x=n.r,A[u].y=n.g,A[u].z=n.b)}function Lv(r){return r in Kb||(Kb[r]=r.split(".")),Kb[r]}function Zb(r){return r.isRawProperty||r.property.startsWith(t2)||r.property.startsWith("object3D")}sn("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(r){return r===!0||r==="true"||r!==!1&&r!=="false"&&parseInt(r,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var r=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){r.animationIsPlaying=!1,r.el.emit("animationcomplete",r.eventDetail,!1),r.id&&r.el.emit("animationcomplete__"+r.id,r.eventDetail,!1)}}},update:function(r){var e=this.config,n=this.data;this.animationIsPlaying=!1,this.data.enabled&&n.property&&(e.autoplay=!1,e.direction=n.dir,e.duration=n.dur,e.easing=n.easing,e.elasticity=n.elasticity,e.loop=n.loop,e.round=n.round,this.createAndStartAnimation())},tick:function(r,e){this.animationIsPlaying&&(this.time+=e,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var r=this.data;this.updateConfig(),this.animationIsPlaying=!1,this.animation=Gl(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!r.autoplay||r.startEvents&&r.startEvents.length||(r.delay?setTimeout(this.beginAnimation,r.delay):this.beginAnimation())},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){this.data.enabled&&(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=Gl(this.config),this.data.delay?setTimeout(this.beginAnimation,this.data.delay):this.beginAnimation())},updateConfigForRawColor:function(){var r,e,n,s=this.config,a=this.data,c=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(e in r=a.from===""?i2(c,a.property):a.from,n=a.to,this.setColorConfig(r,n),r=this.fromColor,n=this.toColor,this.targetsArray.length=0,this.targetsArray.push(r),s.targets=this.targetsArray,n)s[e]=n[e];var u;s.update=(u={},function(A){var m;(m=A.animatables[0].target).r===u.r&&m.g===u.g&&m.b===u.b||r2(c,a.property,m,a.type)})}},updateConfigForDefault:function(){var r,e,n,s,a=this.config,c=this.data,u=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(r=c.from===""?Zb(c)?i2(u,c.property):JB(u,c.property):c.from,n=c.to,isNaN(r||n)?(r=r&&r.toString(),n=n&&n.toString()):(r=parseFloat(r),n=parseFloat(n)),(e=c.to==="true"||c.to==="false"||c.to===!0||c.to===!1)&&(r=c.from==="true"||c.from===!0?1:0,n=c.to==="true"||c.to===!0?1:0),this.targets.aframeProperty=r,a.targets=this.targets,a.aframeProperty=n,a.update=function(A){var m;(m=A.animatables[0].target.aframeProperty)!==s&&(s=m,e&&(m=m>=1),Zb(c)?r2(u,c.property,m,c.type):$B(u,c.property,m))})},updateConfigForVector:function(){var r,e,n,s,a=this.config,c=this.data,u=this.el,A=Lv(c.property),m=A[0]==="object3D"?A[1]:A[0];for(r in e=c.from!==""?pv(c.from):JB(u,m),n=pv(c.to),m===e2&&(n2(e),n2(n)),this.targetsArray.length=0,this.targetsArray.push(e),a.targets=this.targetsArray,n)a[r]=n[r];a.update=m!=="position"&&m!==e2&&m!=="scale"?function(){var v={};return function(E){var C=E.animatables[0].target;C.x===v.x&&C.y===v.y&&C.z===v.z||(v.x=C.x,v.y=C.y,v.z=C.z,$B(u,c.property,C))}}():(s={},function(v){var E=v.animatables[0].target;E.x===s.x&&E.y===s.y&&E.z===s.z||(s.x=E.x,s.y=E.y,s.z=E.z,u.object3D[m].set(E.x,E.y,E.z))})},updateConfig:function(){var r;r=function(e,n){var s,a,c,u;return(c=n.split("."))[0]!=="object3D"||c[2]||c[1]!=="position"&&c[1]!=="rotation"&&c[1]!=="scale"?(a=c[0],u=c[1],(s=e.components[a]||Or[a])?u&&!s.schema[u]?null:u?s.schema[u].type:s.schema.type:null):"vec3"}(this.el,this.data.property),Zb(this.data)&&this.data.type===ZB?this.updateConfigForRawColor():r==="vec2"||r==="vec3"||r==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(r){var e,n=this.data,s=this.el,a=this;return n.from===""&&!!n.property.startsWith(t2)&&(e=Lv(n.property)[1],!s.components[e]&&(s.addEventListener("componentinitialized",function c(u){u.detail.name===e&&(r(),a.animation=Gl(a.config),s.removeEventListener("componentinitialized",c))}),!0))},stopRelatedAnimations:function(){var r,e;for(e in this.el.components)r=this.el.components[e],e!==this.attrName&&r.name==="animation"&&r.animationIsPlaying&&r.data.property===this.data.property&&(r.animationIsPlaying=!1)},addEventListeners:function(){var r=this.data,e=this.el;Jb(e,r.startEvents,this.onStartEvent),Jb(e,r.pauseEvents,this.pauseAnimation),Jb(e,r.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var r=this.data,e=this.el;$b(e,r.startEvents,this.onStartEvent),$b(e,r.pauseEvents,this.pauseAnimation),$b(e,r.resumeEvents,this.resumeAnimation)},setColorConfig:function(r,e){Bv.set(r),Rv.set(e),r=this.fromColor,e=this.toColor,r.r=Bv.r,r.g=Bv.g,r.b=Bv.b,e.r=Rv.r,e.g=Rv.g,e.b=Rv.b}});var eC=Bi("components:anchored:warn");sn("anchored",{schema:{persistent:{default:!1}},init:function(){var r=this.el.sceneEl.getAttribute("webxr"),e=r.optionalFeatures;e.indexOf("anchors")===-1&&(e.push("anchors"),this.el.sceneEl.setAttribute("webxr",r)),this.auxQuaternion=new ai,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var r,e,n,s=this.el.sceneEl,a=s.renderer.xr,c=this.el.object3D;(s.is("ar-mode")||s.is("vr-mode"))&&(!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(r=s.frame,e=a.getReferenceSpace(),n=r.getPose(this.anchor.anchorSpace,e),c.position.copy(n.transform.position),c.quaternion.copy(n.transform.orientation)))},createAnchor:async function(r,e){var n,s,a,c,u=this.el.sceneEl,A=u.renderer.xr,m=this.el.object3D;r=r||m.position,e=e||this.auxQuaternion.setFromEuler(m.rotation),function(v){var E=v.renderer.xr.getSession();return E&&E.restorePersistentAnchor}(u)?(this.anchor&&this.deleteAnchor(),n=u.frame,s=A.getReferenceSpace(),a=new XRRigidTransform({x:r.x,y:r.y,z:r.z},{x:e.x,y:e.y,z:e.z,w:e.w}),this.requestAnchorPending=!1,c=await n.createAnchor(a,s),this.data.persistent&&(this.el.id?(this.persistentHandle=await c.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):eC("The anchor won't be persisted because the entity has no assigned id.")),u.object3D.attach(this.el.object3D),this.anchor=c):eC("This browser doesn't support the WebXR anchors module")},restorePersistentAnchor:async function(){var r,e=this.el.sceneEl.renderer.xr.getSession(),n=e.persistentAnchors;if(this.requestPersistentAnchorPending=!1,!this.el.id)return eC("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),void(this.requestAnchorPending=!0);if(n){r=localStorage.getItem(this.el.id);for(var s=0;s<n.length;++s)if(r===n[s]){this.anchor=await e.restorePersistentAnchor(n[s]),this.anchor&&(this.persistentHandle=n[s]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var r,e=this.anchor;e&&(r=this.el.sceneEl.renderer.xr.getSession(),e.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&r.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}}),sn("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var r,e=this.el;r=this.camera=new Hr,e.setObject3D("camera",r)},update:function(r){var e=this.data,n=this.camera;n.aspect=e.aspect||window.innerWidth/window.innerHeight,n.far=e.far,n.fov=e.fov,n.near=e.near,n.zoom=e.zoom,n.updateProjectionMatrix(),this.updateActiveCamera(r),this.updateSpectatorCamera(r)},updateActiveCamera:function(r){var e=this.data,n=this.el,s=this.system;r&&r.active===e.active||e.spectator||(e.active&&s.activeCameraEl!==n?s.setActiveCamera(n):e.active||s.activeCameraEl!==n||s.disableActiveCamera())},updateSpectatorCamera:function(r){var e=this.data,n=this.el,s=this.system;r&&r.spectator===e.spectator||(e.spectator&&s.spectatorCameraEl!==n?s.setSpectatorCamera(n):e.spectator||s.spectatorCameraEl!==n||s.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}});var wh,Zu,Mh,s2,a2="click",o2="mouseup",Dv="cursor-fusing",tC="cursor-hovering",nC="cursor-hovered",Pv={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},Uv={DOWN:["selectstart"],UP:["selectend"]},l2="a-mouse-cursor-hover",H4=(sn("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:xh()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var r=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=_B(function(){r.canvasBounds=r.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(r){var e=this.data.rayOrigin;e!==r.rayOrigin&&(e==="entity"&&this.resetRaycaster(),this.updateMouseEventListeners(),e!=="xrselect"&&e!=="entity"||this.addWebXREventListeners(),r.rayOrigin!=="xrselect"&&r.rayOrigin!=="entity"||this.removeWebXREventListeners())},tick:function(){var r=this.el.sceneEl.frame,e=this.activeXRInput;this.data.rayOrigin==="xrselect"&&r&&e&&this.onMouseMove({frame:r,inputSource:e,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var r=this.el;r.removeState(tC),r.removeState(Dv),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(nC),this.removeEventListeners()},addEventListeners:function(){var r,e=this.data,n=this.el,s=this;function a(){r=n.sceneEl.canvas,e.downEvents.length||e.upEvents.length||(Pv.DOWN.forEach(function(c){r.addEventListener(c,s.onCursorDown,{passive:!1})}),Pv.UP.forEach(function(c){r.addEventListener(c,s.onCursorUp,{passive:!1})}))}(r=n.sceneEl.canvas)?a():n.sceneEl.addEventListener("render-target-loaded",a),e.downEvents.forEach(function(c){n.addEventListener(c,s.onCursorDown)}),e.upEvents.forEach(function(c){n.addEventListener(c,s.onCursorUp)}),n.addEventListener("raycaster-intersection",this.onIntersection),n.addEventListener("raycaster-closest-entity-changed",this.onIntersection),n.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),n.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),n.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var r,e=this.data,n=this.el,s=this;!(r=n.sceneEl.canvas)||e.downEvents.length||e.upEvents.length||(Pv.DOWN.forEach(function(a){r.removeEventListener(a,s.onCursorDown)}),Pv.UP.forEach(function(a){r.removeEventListener(a,s.onCursorUp)})),e.downEvents.forEach(function(a){n.removeEventListener(a,s.onCursorDown)}),e.upEvents.forEach(function(a){n.removeEventListener(a,s.onCursorUp)}),n.removeEventListener("raycaster-intersection",this.onIntersection),n.removeEventListener("raycaster-closest-entity-changed",this.onIntersection),n.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),r.removeEventListener("mousemove",this.onMouseMove),r.removeEventListener("touchstart",this.onMouseMove),r.removeEventListener("touchmove",this.onMouseMove),n.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),n.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds),this.removeWebXREventListeners()},updateMouseEventListeners:function(){var r,e=this.el;(r=e.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),r.removeEventListener("touchmove",this.onMouseMove),e.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(r.addEventListener("mousemove",this.onMouseMove),r.addEventListener("touchmove",this.onMouseMove,{passive:!1}),e.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},resetRaycaster:function(){this.el.setAttribute("raycaster",{direction:new R().set(0,0,-1),origin:new R})},addWebXREventListeners:function(){var r=this,e=this.el.sceneEl.xrSession;e&&(Uv.DOWN.forEach(function(n){e.addEventListener(n,r.onCursorDown)}),Uv.UP.forEach(function(n){e.addEventListener(n,r.onCursorUp)}))},removeWebXREventListeners:function(){var r=this,e=this.el.sceneEl.xrSession;e&&(Uv.DOWN.forEach(function(n){e.removeEventListener(n,r.onCursorDown)}),Uv.UP.forEach(function(n){e.removeEventListener(n,r.onCursorUp)}))},onMouseMove:(wh=new R,Zu=new ct,Mh=new R,s2={origin:Mh,direction:wh},function(r){var e,n,s,a,c,u,A,m,v,E=this.canvasBounds,C=this.el.sceneEl.camera;C.parent.updateMatrixWorld(),n=(s=r.type==="touchmove"||r.type==="touchstart"?r.touches.item(0):r).clientX-E.left,a=s.clientY-E.top,Zu.x=n/E.width*2-1,Zu.y=-a/E.height*2+1,this.data.rayOrigin!=="xrselect"||r.type!=="selectstart"&&r.type!=="fakeselectevent"?r.type==="fakeselectout"?(wh.set(0,1,0),Mh.set(0,9999,0)):C&&C.isPerspectiveCamera?(Mh.setFromMatrixPosition(C.matrixWorld),wh.set(Zu.x,Zu.y,.5).unproject(C).sub(Mh).normalize()):C&&C.isOrthographicCamera?(Mh.set(Zu.x,Zu.y,(C.near+C.far)/(C.near-C.far)).unproject(C),wh.set(0,0,-1).transformDirection(C.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+C.type):(c=r.frame,u=r.inputSource,A=this.el.sceneEl.renderer.xr.getReferenceSpace(),(m=c.getPose(u.targetRaySpace,A))&&(v=m.transform,wh.set(0,0,-1),wh.applyQuaternion(v.orientation),Mh.copy(v.position),(e=C.el.object3D.parent).localToWorld(Mh),wh.transformDirection(e.matrixWorld))),this.el.setAttribute("raycaster",s2),r.type==="touchmove"&&r.preventDefault()}),onCursorDown:function(r){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&r.type==="touchstart"&&(this.onMouseMove(r),this.el.components.raycaster.checkIntersections(),r.preventDefault()),this.data.rayOrigin==="xrselect"&&r.type==="selectstart"&&(this.activeXRInput=r.inputSource,this.onMouseMove(r),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&this.el.sceneEl.components["ar-hit-test"]!==void 0&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit("mousedown",r),this.cursorDownEl=this.intersectedEl},onCursorUp:function(r){if(this.isCursorDown&&(this.data.rayOrigin!=="xrselect"||this.activeXRInput===r.inputSource)){this.isCursorDown=!1;var e=this.data;this.twoWayEmit(o2,r),this.reenableARHitTest===!0&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(o2,this.intersectedEventDetail)),e.fuse&&e.rayOrigin!=="mouse"&&e.rayOrigin!=="xrselect"||!this.intersectedEl||this.cursorDownEl!==this.intersectedEl||this.twoWayEmit(a2,r),e.rayOrigin==="xrselect"&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,r.type==="touchend"&&r.preventDefault()}},onIntersection:function(r){var e,n,s,a,c=this.el;n=r.detail.els[0]===c?1:0,a=r.detail.intersections[n],(s=r.detail.els[n])&&this.intersectedEl!==s&&(this.intersectedEl&&(e=this.el.components.raycaster.getIntersection(this.intersectedEl))&&e.distance<=a.distance||(this.clearCurrentIntersection(!0),this.setIntersection(s,a)))},onIntersectionCleared:function(r){r.detail.clearedEls.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){var r=this.data.rayOrigin;this.clearCurrentIntersection(!0),r!=="xrselect"&&r!=="entity"||this.addWebXREventListeners()},setIntersection:function(r,e){var n=this.el,s=this.data,a=this;this.intersectedEl!==r&&(this.intersectedEl=r,n.addState(tC),r.addState(nC),this.twoWayEmit("mouseenter"),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(l2),s.fuseTimeout!==0&&s.fuse&&s.rayOrigin!=="xrselect"&&s.rayOrigin!=="mouse"&&(n.addState(Dv),this.twoWayEmit("fusing"),this.fuseTimeout=setTimeout(function(){n.removeState(Dv),a.twoWayEmit(a2)},s.fuseTimeout)))},clearCurrentIntersection:function(r){var e,n,s=this.el;this.intersectedEl&&(this.intersectedEl.removeState(nC),s.removeState(tC),s.removeState(Dv),this.twoWayEmit("mouseleave"),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(l2),this.intersectedEl=null,clearTimeout(this.fuseTimeout),r!==!0&&(n=this.el.components.raycaster.intersections).length!==0&&(e=n[n[0].object.el===s?1:0])&&this.setIntersection(e.object.el,e))},twoWayEmit:function(r,e){var n,s=this.el,a=this.intersectedEl;function c(u,A){e instanceof MouseEvent?u.mouseEvent=e:typeof TouchEvent<"u"&&e instanceof TouchEvent&&(u.touchEvent=e)}n=this.el.components.raycaster.getIntersection(a),this.eventDetail.intersectedEl=a,this.eventDetail.intersection=n,c(this.eventDetail),s.emit(r,this.eventDetail),a&&(this.intersectedEventDetail.intersection=n,c(this.intersectedEventDetail),a.emit(r,this.intersectedEventDetail))}}),new vn),c2=(sn("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:zb,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(r){var e,n=this.data,s=this.el,a=this.system;this.geometry&&(a.unuseGeometry(r),this.geometry=null),this.geometry=a.getOrCreateGeometry(n),(e=s.getObject3D("mesh"))?e.geometry=this.geometry:((e=new Ti).geometry=this.geometry,this.el.getAttribute("material")||(e.material=new gh({color:16777215*Math.random(),metalness:0,roughness:.5})),s.setObject3D("mesh",e))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=H4,this.geometry=null},updateSchema:function(r){var e=this.oldData&&this.oldData.primitive,n=r.primitive,s=bh[n]&&bh[n].schema;if(!s)throw new Error("Unknown geometry schema `"+n+"`");e&&e===n||this.extendSchema(s)}}),"generic"),z4=(sn("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},disabled:{default:!1}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var r=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r)},this.onButtonUp=function(e){Un(e.detail.id,"up",r)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.bindMethods(),this.el.addEventListener("controllerconnected",function(e){e.detail.name!==r.name&&(r.wasControllerConnected=!0,r.removeEventListeners(),r.removeControllersUpdateListener())})},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.data,e=r.hand?r.hand:void 0;Va(this,c2,{hand:e,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var r=this.el,e=this.data;this.el.components["tracked-controls"]?this.removeEventListeners():(r.setAttribute("tracked-controls",{hand:e.hand,idPrefix:c2,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel())},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(r){var e=this.mapping.buttons[r.detail.id];e&&this.el.emit(e+"changed",r.detail.state)},onAxisMoved:function(r){po(this,this.mapping.axes,r)},initDefaultModel:function(){var r=this.modelEl=document.createElement("a-entity");r.setAttribute("geometry",{primitive:"sphere",radius:.03}),r.setAttribute("material",{color:this.data.color}),this.el.appendChild(r),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}}),Bi("components:gltf-model:warn"));sn("gltf-model",{schema:{type:"model"},init:function(){var r=this,e=this.system.getDRACOLoader(),n=this.system.getMeshoptDecoder(),s=this.system.getKTX2Loader();this.model=null,this.loader=new z_,e&&this.loader.setDRACOLoader(e),this.ready=n?n.then(function(a){r.loader.setMeshoptDecoder(a)}):Promise.resolve(),s&&this.loader.setKTX2Loader(s)},update:function(){var r=this,e=this.el,n=this.data;n&&(this.remove(),this.ready.then(function(){r.loader.load(n,function(s){r.model=s.scene||s.scenes[0],r.model.animations=s.animations,e.setObject3D("mesh",r.model),e.emit("model-loaded",{format:"gltf",model:r.model})},void 0,function(s){var a=s&&s.message?s.message:"Failed to load glTF model";z4(a),e.emit("model-error",{format:"gltf",src:n})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),sn("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}});var Nv,V4=Fr+"controllers/oculus-hands/v4/left.glb",W4=Fr+"controllers/oculus-hands/v4/right.glb",iC=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];sn("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var r=0;r<this.jointEls.length;++r)this.jointEls[r].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var r=0;r<this.jointEls.length;++r)this.jointEls[r].object3D.visible=!1},init:function(){var r=this.el.sceneEl,e=r.getAttribute("webxr"),n=e.optionalFeatures;n.indexOf("hand-tracking")===-1&&(n.push("hand-tracking"),r.setAttribute("webxr",e)),this.wristObject3D=new kn,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new R,wristRotation:new ai},this.indexTipPosition=new R,this.hasPoses=!1,this.jointPoses=new Float32Array(16*iC.length),this.jointRadii=new Float32Array(iC.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.wristObject3D.visible=!1},onChildAttached:function(r){this.addChildEntity(r.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var r=this.jointEls,e=this.skinnedMesh,n=this.data.modelOpacity!==1;e&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=n,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var s=0;s<r.length;s++)r[s].setAttribute("material",{color:this.data.modelColor,transparent:n,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var r=this,e=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,e){var n=r.el.sceneEl.systems.webxr.sessionReferenceSpaceType;e.requestReferenceSpace(n).then(function(s){r.referenceSpace=s}).catch(function(s){throw r.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(n,"tracked-controls-webxr uses reference space "+n),s})}},checkIfControllerPresent:function(){var r=this.data;Va(this,"",{hand:r.hand?r.hand:void 0,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var r=this.el.sceneEl,e=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,n=r.frame,s=this.el.components["tracked-controls"],a=this.referenceSpace;e&&n&&a&&s&&(this.hasPoses=!1,e.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=n.fillPoses(e.hand.values(),a,this.jointPoses)&&n.fillJointRadii(e.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:(Nv=new Qt,function(){var r=this.wristObject3D;r&&this.hasPoses&&(Nv.fromArray(this.jointPoses,0),r.position.setFromMatrixPosition(Nv),r.quaternion.setFromRotationMatrix(Nv))}),updateHandModel:function(){this.wristObject3D.visible=!0,this.el.object3D.visible=!0,this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(r){for(var e=this.bones,n=0;n<e.length;n++)if(e[n].name===r)return e[n];return null},updateHandMeshModel:function(){var r=new Qt;return function(){var e=0,n=this.jointPoses,s=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(s&&this.mesh&&(this.mesh.visible=!1,this.hasPoses))for(var a of s.hand.values()){var c=this.getBone(a.jointName);c!=null&&(this.mesh.visible=!0,r.fromArray(n,16*e),c.position.setFromMatrixPosition(r),c.quaternion.setFromRotationMatrix(r)),e++}}}(),updateHandDotsModel:function(){for(var r,e,n=this.jointPoses,s=this.jointRadii,a=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,c=0;c<a.hand.size;c++)e=(r=this.jointEls[c]).object3D,r.object3D.visible=this.hasPoses,this.hasPoses&&(e.matrix.fromArray(n,16*c),e.matrix.decompose(e.position,e.rotation,e.scale),r.setAttribute("scale",{x:s[c],y:s[c],z:s[c]}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var r=new R,e=new Qt;return function(){var n=this.indexTipPosition,s=this.pinchEventDetail;if(this.hasPoses){r.setFromMatrixPosition(e.fromArray(this.jointPoses,64)),n.setFromMatrixPosition(e.fromArray(this.jointPoses,144)),s.wristRotation.setFromRotationMatrix(e.fromArray(this.jointPoses,0));var a=n.distanceTo(r);a<.015&&this.isPinched===!1&&(this.isPinched=!0,s.position.copy(n).add(r).multiplyScalar(.5),this.el.emit("pinchstarted",s)),a>.02&&this.isPinched===!0&&(this.isPinched=!1,s.position.copy(n).add(r).multiplyScalar(.5),this.el.emit("pinchended",s)),this.isPinched&&(s.position.copy(n).add(r).multiplyScalar(.5),this.el.emit("pinchmoved",s))}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{id:"",hand:e.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh?this.mesh!==r.getObject3D("mesh")&&r.setObject3D("mesh",this.mesh):this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var r,e=this.el;this.checkIfControllerPresent(),r=e.components["tracked-controls"]&&e.components["tracked-controls"].controller,this.mesh&&r&&r.hand&&r.hand instanceof XRHand&&e.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var r=this.data;r.modelStyle==="dots"&&this.initDotsModel(),r.modelStyle==="mesh"&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(this.jointEls.length===0){for(var r=0;r<iC.length;++r){var e=this.jointEl=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"sphere",radius:1}),e.object3D.visible=!1,this.el.appendChild(e),this.jointEls.push(e)}this.updateModelMaterial()}},initMeshHandModel:function(){var r=this.data.hand==="left"?V4:W4;this.el.setAttribute("gltf-model",r)},onModelLoaded:function(){var r=this.mesh=this.el.getObject3D("mesh").children[0],e=this.skinnedMesh=r.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=e.skeleton.bones,this.el.removeObject3D("mesh"),r.position.set(0,0,0),r.rotation.set(0,0,0),e.frustumCulled=!1,e.material=new gh,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",r))},setupChildrenEntities:function(){for(var r=this.el.children,e=0;e<r.length;++e)r[e]instanceof is&&this.addChildEntity(r[e])},addChildEntity:function(r){r instanceof is&&this.wristObject3D.add(r.object3D)}}),sn("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var r,e=this.el,n=this.data;r=n.hand==="right"?"components.hand-tracking-controls.bones.3":"components.hand-tracking-controls.bones.21",e.setAttribute("hand-tracking-controls",{hand:n.hand}),e.setAttribute("obb-collider",{trackedObject3D:r,size:.04}),this.auxMatrix=new Qt,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded)},transferEntityOwnership:function(){for(var r,e=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),n=0;n<e.length;++n)(r=e[n].components["hand-tracking-grab-controls"])!==this&&this.grabbedEl&&this.grabbedEl===r.grabbedEl&&r.releaseGrabbedEntity();return!1},onCollisionStarted:function(r){var e=r.detail.withEl;this.collidedEl||e.getAttribute("grabbable")&&(this.collidedEl=e,this.grabbingObject3D=r.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,this.grabbedEl||(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(r){this.collidedEl&&(this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},releaseGrabbedEntity:function(){var r=this.grabbedEl;if(r){var e=r.object3D,n=e.parent,s=this.originalParent;e.applyMatrix4(n.matrixWorld),e.applyMatrix4(this.auxMatrix.copy(s.matrixWorld).invert()),n.remove(e),s.add(e),this.el.emit("grabended",{grabbedEl:r}),this.grabbedEl=void 0,this.originalParent=void 0}},grab:function(){var r=this.grabbedEl,e=r.object3D,n=e.parent;this.originalParent=n;var s=this.el.components["hand-tracking-controls"].wristObject3D;e.applyMatrix4(n.matrixWorld),e.applyMatrix4(this.auxMatrix.copy(s.matrixWorld).invert()),n.remove(e),s.add(e),this.el.emit("grabstarted",{grabbedEl:r})}});var j4={toonLeft:Fr+"controllers/hands/leftHand.glb",toonRight:Fr+"controllers/hands/rightHand.glb",lowPolyLeft:Fr+"controllers/hands/leftHandLow.glb",lowPolyRight:Fr+"controllers/hands/rightHandLow.glb",highPolyLeft:Fr+"controllers/hands/leftHandHigh.glb",highPolyRight:Fr+"controllers/hands/rightHandHigh.glb"},rC="Point",sC="Fist",h2="Thumb Up",Fv={};function u2(r,e){var n;if(r)return(n=Fv[r])==="grip"?n+(e?"close":"open"):n==="point"?n+(e?"up":"down"):n==="pointing"||n==="pistol"?n+(e?"start":"end"):void 0}Fv[sC]="grip",Fv[h2]="pistol",Fv[rC]="pointing",sn("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var r=this,e=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new z_,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){r.handleButton("grip","down")},this.onGripUp=function(){r.handleButton("grip","up")},this.onTrackpadDown=function(){r.handleButton("trackpad","down")},this.onTrackpadUp=function(){r.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){r.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){r.handleButton("trackpad","touchend")},this.onTriggerDown=function(){r.handleButton("trigger","down")},this.onTriggerUp=function(){r.handleButton("trigger","up")},this.onTriggerTouchStart=function(){r.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){r.handleButton("trigger","touchend")},this.onGripTouchStart=function(){r.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){r.handleButton("grip","touchend")},this.onThumbstickDown=function(){r.handleButton("thumbstick","down")},this.onThumbstickUp=function(){r.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){r.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){r.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){r.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){r.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){r.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){r.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),e.addEventListener("controllerconnected",this.onControllerConnected),e.addEventListener("controllerdisconnected",this.onControllerDisconnected),e.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(r,e){var n=this.el.getObject3D("mesh");n&&n.mixer&&n.mixer.update(e/1e3)},onControllerConnected:function(r){var e=this.el,n=this.data.hand,s=this.el.getObject3D("mesh");e.object3D.visible=!0;var a=n==="left"?Math.PI/2:-Math.PI/2,c=e.sceneEl.hasWebXR?-Math.PI/2:0;r.detail.name==="pico-controls"&&(c+=Math.PI/4),s.position.set(0,0,0),s.rotation.set(c,0,a)},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var r=this.el;r.addEventListener("gripdown",this.onGripDown),r.addEventListener("gripup",this.onGripUp),r.addEventListener("trackpaddown",this.onTrackpadDown),r.addEventListener("trackpadup",this.onTrackpadUp),r.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),r.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),r.addEventListener("triggerdown",this.onTriggerDown),r.addEventListener("triggerup",this.onTriggerUp),r.addEventListener("triggertouchstart",this.onTriggerTouchStart),r.addEventListener("triggertouchend",this.onTriggerTouchEnd),r.addEventListener("griptouchstart",this.onGripTouchStart),r.addEventListener("griptouchend",this.onGripTouchEnd),r.addEventListener("thumbstickdown",this.onThumbstickDown),r.addEventListener("thumbstickup",this.onThumbstickUp),r.addEventListener("abuttontouchstart",this.onAorXTouchStart),r.addEventListener("abuttontouchend",this.onAorXTouchEnd),r.addEventListener("bbuttontouchstart",this.onBorYTouchStart),r.addEventListener("bbuttontouchend",this.onBorYTouchEnd),r.addEventListener("xbuttontouchstart",this.onAorXTouchStart),r.addEventListener("xbuttontouchend",this.onAorXTouchEnd),r.addEventListener("ybuttontouchstart",this.onBorYTouchStart),r.addEventListener("ybuttontouchend",this.onBorYTouchEnd),r.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),r.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var r=this.el;r.removeEventListener("gripdown",this.onGripDown),r.removeEventListener("gripup",this.onGripUp),r.removeEventListener("trackpaddown",this.onTrackpadDown),r.removeEventListener("trackpadup",this.onTrackpadUp),r.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),r.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),r.removeEventListener("triggerdown",this.onTriggerDown),r.removeEventListener("triggerup",this.onTriggerUp),r.removeEventListener("triggertouchstart",this.onTriggerTouchStart),r.removeEventListener("triggertouchend",this.onTriggerTouchEnd),r.removeEventListener("griptouchstart",this.onGripTouchStart),r.removeEventListener("griptouchend",this.onGripTouchEnd),r.removeEventListener("thumbstickdown",this.onThumbstickDown),r.removeEventListener("thumbstickup",this.onThumbstickUp),r.removeEventListener("abuttontouchstart",this.onAorXTouchStart),r.removeEventListener("abuttontouchend",this.onAorXTouchEnd),r.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),r.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),r.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),r.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),r.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),r.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),r.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),r.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(r){var e,n=this.el,s=this.data.hand,a=this.data.handModelStyle,c=this.data.color,u=this;if(e={hand:s,model:!1},s!==r){var A=j4[a+s.charAt(0).toUpperCase()+s.slice(1)];this.loader.load(A,function(m){var v=m.scene.children[0];v.mixer=new II(v),u.clips=m.animations,n.setObject3D("mesh",v),v.traverse(function(E){E.isMesh&&(E.material.color=new Mt(c))}),n.setAttribute("magicleap-controls",e),n.setAttribute("vive-controls",e),n.setAttribute("meta-touch-controls",e),n.setAttribute("pico-controls",e),n.setAttribute("windows-motion-controls",e),n.setAttribute("hp-mixed-reality-controls",e)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(r,e){var n,s=e==="down",a=e==="touchstart";if(e.indexOf("touch")===0){if(a===this.touchedButtons[r])return;this.touchedButtons[r]=a}else{if(s===this.pressedButtons[r])return;this.pressedButtons[r]=s}n=this.gesture,this.gesture=this.determineGesture(),this.gesture!==n&&(this.animateGesture(this.gesture,n),this.emitGestureEvents(this.gesture,n))},determineGesture:function(){var r,e,n,s=this.pressedButtons.grip,a=this.pressedButtons.surface||this.touchedButtons.surface,c=this.pressedButtons.trackpad||this.touchedButtons.trackpad,u=this.pressedButtons.trigger||this.touchedButtons.trigger,A=this.touchedButtons.AorX||this.touchedButtons.BorY;return e=this.el.components["tracked-controls"],(n=e&&e.controller)&&(n.id&&n.id.indexOf("OpenVR ")===0||n.profiles&&n.profiles[0]&&n.profiles[0]==="htc-vive")?s||u?r=sC:c&&(r=rC):s?r=a||A||c?u?sC:rC:u?h2:"Point + Thumb":u&&(r="Hold"),r},getClip:function(r){var e,n;for(n=0;n<this.clips.length;n++)if((e=this.clips[n]).name===r)return e},animateGesture:function(r,e){r?this.playAnimation(r||"Open",e,!1):this.playAnimation(e,e,!0)},emitGestureEvents:function(r,e){var n,s=this.el;e!==r&&((n=u2(e,!1))&&s.emit(n),(n=u2(r,!0))&&s.emit(n))},playAnimation:function(r,e,n){var s,a,c=this.el.getObject3D("mesh");if(c){if(s=this.getClip(r),a=c.mixer.clipAction(s),n)return a.paused=!1,void(a.timeScale=-1);if(a.clampWhenFinished=!0,a.loop=Ps,a.repetitions=0,a.timeScale=1,a.time=0,a.weight=1,!e)return c.mixer.stopAllAction(),void a.play();s=this.getClip(e),a.reset(),a.play(),c.mixer.clipAction(s).crossFadeTo(a,.15,!0)}}}),sn("hide-on-enter-ar",{init:function(){var r=this;this.el.sceneEl.addEventListener("enter-vr",function(){r.el.sceneEl.is("ar-mode")&&(r.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){r.el.object3D.visible=!0})}}),sn("hide-on-enter-vr",{init:function(){var r=this;this.el.sceneEl.addEventListener("enter-vr",function(){r.el.sceneEl.is("vr-mode")&&(r.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){r.el.object3D.visible=!0})}});var d2="hp-mixed-reality",q4=Fr+"controllers/hp/mixed-reality/",X4={x:0,y:0,z:.06},Y4={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},K4=(sn("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var r=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r,r.data.hand)},this.onButtonUp=function(e){Un(e.detail.id,"up",r,r.data.hand)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r,r.data.hand)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r,r.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var r=this.data;this.controllerIndex=r.hand==="right"?0:r.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),r.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),r.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.data;Va(this,d2,{index:this.controllerIndex,hand:r.hand})},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{idPrefix:d2,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",q4+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e,n=this.mapping[this.data.hand].buttons[r.detail.id];n&&(n==="trigger"&&(e=r.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(n+"changed",r.detail.state))},onModelLoaded:function(r){var e=r.detail.model;this.data.model&&(e.position.copy(X4),e.rotation.copy(Y4),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new R(0,0,0)}))},onAxisMoved:function(r){po(this,this.mapping.axes,r)}}),Bi("components:layer:warn"));function p2(r,e,n){return(e.dot(r)-e.dot(n))/e.length()}sn("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var r=this.el.sceneEl.renderer.getContext();this.quaternion=new ai,this.position=new R,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=r.createFramebuffer();var e=this.el.sceneEl.getAttribute("webxr"),n=e.requiredFeatures;n.indexOf("layers")===-1&&(n.push("layers"),this.el.sceneEl.setAttribute("webxr",e)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(r){this.data.src!==r.src&&this.updateSrc()},updateSrc:function(){var r=this.data.type;this.texture=void 0,r!=="quad"?r!=="monocubemap"&&r!=="stereocubemap"||this.loadCubeMapImages():this.loadQuadImage()},loadCubeMapImages:function(){var r,e=this.xrGLFactory,n=this.el.sceneEl.frame,s=this.data.src,a=this.data.type;this.visibilityChanged=!1,this.layer&&(a!=="monocubemap"&&a!=="stereocubemap"||(s.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,a==="monocubemap"?(r=e.getSubImage(this.layer,n),this.loadCubeMapImage(r.colorTexture,s,0)):(r=e.getSubImage(this.layer,n,"left"),this.loadCubeMapImage(r.colorTexture,s,0),r=e.getSubImage(this.layer,n,"right"),this.loadCubeMapImage(r.colorTexture,s,6))))},loadQuadImage:function(){var r=this.data.src,e=this;this.el.sceneEl.systems.material.loadTexture(r,{src:r},function(n){e.el.sceneEl.renderer.initTexture(n),e.texture=n,r.tagName==="VIDEO"&&setTimeout(function(){e.textureIsVideo=!0},1e3),e.layer&&(e.layer.height=e.data.height/2||e.texture.image.height/1e3,e.layer.width=e.data.width/2||e.texture.image.width/1e3,e.needsRedraw=!0),e.updateQuadPanel()})},preGenerateCubeMapTextures:function(r,e){this.data.type==="monocubemap"?this.generateCubeMapTextures(r,0,e):(this.generateCubeMapTextures(r,0,e),this.generateCubeMapTextures(r,6,e))},generateCubeMapTextures:function(r,e,n){for(var s,a,c=this.data,u=this.cubeFaceSize,A=Math.min(r.width,r.height),m=[],v=0;v<6;v++){var E=document.createElement("CANVAS");E.width=E.height=u;var C=E.getContext("2d");c.rotateCubemap&&(v!==2&&v!==3||(C.save(),C.translate(u,u),C.rotate(Math.PI))),C.drawImage(r,(v+e)*A,0,A,A,0,0,u,u),C.restore(),n&&n(),m.push(E)}return c.rotateCubemap&&(s=m[0],a=m[1],m[0]=a,m[1]=s,s=m[4],a=m[5],m[4]=a,m[5]=s),n&&n(),m},loadCubeMapImage:function(r,e,n){var s,a=this.el.sceneEl.renderer.getContext();a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.bindTexture(a.TEXTURE_CUBE_MAP,r),s=!e.complete||this.loadingScreen?this.loadingScreenImages:this.generateCubeMapTextures(e,n);var c=0;s.forEach(function(u,A){a.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+A,0,0,0,a.RGBA,a.UNSIGNED_BYTE,u),c=a.getError()}),c!==0&&console.log("renderingError, WebGL Error Code: "+c),a.bindTexture(a.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&this.referenceSpace&&(this.layer||!this.el.sceneEl.is("vr-mode")&&!this.el.sceneEl.is("ar-mode")||this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),(this.needsRedraw||this.layer.needsRedraw||this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var r=this,e=this.data.type;this.el.sceneEl.xrSession.onvisibilitychange=function(n){r.visibilityChanged=n.session.visibilityState!=="hidden"},e!=="quad"?e!=="monocubemap"&&e!=="stereocubemap"||this.initCubeMapLayer():this.initQuadLayer()},initQuadLayer:function(){var r=this.el.sceneEl,e=r.renderer.getContext(),n=this.xrGLFactory=new XRWebGLBinding(r.xrSession,e);this.texture&&(this.layer=n.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),r.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var r=this.data.src,e=this.el.sceneEl,n=e.renderer.getContext(),s=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),a=this.cubeFaceSize=Math.min(s,Math.min(r.width,r.height)),c=this.xrGLFactory=new XRWebGLBinding(e.xrSession,n);this.layer=c.createCubeLayer({space:this.referenceSpace,viewPixelWidth:a,viewPixelHeight:a,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),e.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var r=this.cubeFaceSize,e=this.loadingScreenImages=[],n=0;n<6;n++){var s=document.createElement("CANVAS");s.width=s.height=r;var a=s.getContext("2d");s.width=s.height=r,a.fillStyle="black",a.fillRect(0,0,r,r),n!==2&&n!==3&&(a.translate(r,0),a.scale(-1,1),a.fillStyle="white",a.font="30px Arial",a.fillText("Loading",r/2,r/2)),e.push(s)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(r){this.layerEnabled=r,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var r=this.quadPanelEl;this.quadPanelEl||(r=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(r)),r.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),r.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var r=this.el.sceneEl,e=this.el.sceneEl.renderer.getContext(),n=this.xrGLFactory.getSubImage(this.layer,r.frame),s=r.renderer.properties.get(this.texture).__webglTexture,a=e.getParameter(e.FRAMEBUFFER_BINDING);e.viewport(n.viewport.x,n.viewport.y,n.viewport.width,n.viewport.height),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n.colorTexture,0),function(c,u,A,m){var v=c.createFramebuffer(),E=A.viewport.x,C=A.viewport.y,M=A.viewport.x+A.viewport.width,S=A.viewport.y+A.viewport.height;m.tagName==="VIDEO"&&(c.bindTexture(c.TEXTURE_2D,u),c.texSubImage2D(c.TEXTURE_2D,0,0,0,m.width,m.height,c.RGB,c.UNSIGNED_BYTE,m)),c.bindFramebuffer(c.READ_FRAMEBUFFER,v),c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,u,0),c.readBuffer(c.COLOR_ATTACHMENT0),c.blitFramebuffer(0,0,m.width,m.height,E,C,M,S,c.COLOR_BUFFER_BIT,c.NEAREST),c.bindFramebuffer(c.READ_FRAMEBUFFER,null),c.deleteFramebuffer(v)}(e,s,n,this.data.src),e.bindFramebuffer(e.FRAMEBUFFER,a)},updateTransform:function(){var r=this.el,e=this.position,n=this.quaternion;r.object3D.updateMatrixWorld(),e.setFromMatrixPosition(r.object3D.matrixWorld),n.setFromRotationMatrix(r.object3D.matrixWorld),this.layerEnabled||e.set(0,0,1e8),this.layer.transform=new XRRigidTransform(e,n)},onEnterVR:function(){var r=this.el.sceneEl,e=r.xrSession;r.hasWebXR&&XRWebGLBinding&&e?(e.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()):K4("The layer component requires WebXR and the layers API enabled")},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(r){this.referenceSpace=r}}),sn("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var r=this.config,e=this.data,n=this.el,s=this,a={hand:e.hand,model:e.model};function c(u){var A=r[u.detail.name];if(A){var m=Sa({showLine:!0},A.raycaster||{});u.detail.rayOrigin&&(m.origin=u.detail.rayOrigin.origin,m.direction=u.detail.rayOrigin.direction,m.showLine=!0),u.detail.rayOrigin||!s.modelReady?n.setAttribute("raycaster",m):n.setAttribute("raycaster","showLine",!0),n.setAttribute("cursor",Sa({fuse:!1},A.cursor))}}n.setAttribute("hp-mixed-reality-controls",a),n.setAttribute("magicleap-controls",a),n.setAttribute("oculus-go-controls",a),n.setAttribute("meta-touch-controls",a),n.setAttribute("pico-controls",a),n.setAttribute("valve-index-controls",a),n.setAttribute("vive-controls",a),n.setAttribute("vive-focus-controls",a),n.setAttribute("windows-motion-controls",a),n.setAttribute("generic-tracked-controller-controls",{hand:a.hand}),n.addEventListener("controllerconnected",c),n.addEventListener("controllerdisconnected",function(u){r[u.detail.name]&&n.setAttribute("raycaster","showLine",!1)}),n.addEventListener("controllermodelready",function(u){c(u),s.modelReady=!0})},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"meta-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}});var aC,Ov,kv,Qv,xc,A2,oC,um,dm,Gv,f2=Tr.degToRad,J4=Bi("components:light:warn"),$4=new oI,ed={};function m2(r,e){return!(!r||!e)&&r.x===e.x&&r.y===e.y&&r.z===e.z}sn("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:3.14,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var r=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(r)},update:function(r){var e=this.data,n=bB(e,r),s=this.light,a=this;if(!s||"type"in n)this.setLight(this.data),this.updateShadow();else{var c=!1;Object.keys(n).forEach(function(u){var A=e[u];switch(u){case"color":s.color.set(A);break;case"groundColor":s.groundColor.set(A);break;case"angle":s.angle=f2(A);break;case"target":A===null?e.type!=="spot"&&e.type!=="directional"||(s.target=a.defaultTarget):A.hasLoaded?a.onSetTarget(A,s):A.addEventListener("loaded",a.onSetTarget.bind(a,A,s));break;case"envMap":a.updateProbeMap(e,s);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":c||(a.updateShadow(),c=!0);break;case"shadowCameraAutomatic":e.shadowCameraAutomatic?a.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(e.shadowCameraAutomatic)):a.shadowCameraAutomaticEls=[];break;default:s[u]=A}})}},tick:(aC=new te,Ov=new R,kv=new R,Qv=new Qt,xc=new on,A2=new R,function(){if(this.data.type==="directional"&&this.light.shadow&&this.light.shadow.camera instanceof mc&&this.shadowCameraAutomaticEls.length){var r=this.light.shadow.camera;r.getWorldDirection(Ov),r.getWorldPosition(kv),Qv.copy(r.matrixWorld),Qv.invert(),r.near=1,r.left=1e5,r.right=-1e5,r.top=-1e5,r.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(e){aC.setFromObject(e.object3D),aC.getBoundingSphere(xc);var n,s,a,c,u,A=p2(kv,Ov,xc.center),m=(n=kv,s=Ov,a=xc.center,c=A2,u=p2(n,s,a),c.copy(s),c.multiplyScalar(u),c.add(a),c).applyMatrix4(Qv);r.near=Math.min(-A-xc.radius-1,r.near),r.left=Math.min(-xc.radius+m.x,r.left),r.right=Math.max(xc.radius+m.x,r.right),r.top=Math.max(xc.radius+m.y,r.top),r.bottom=Math.min(-xc.radius+m.y,r.bottom)}),r.updateProjectionMatrix()}}),setLight:function(r){var e=this.el,n=this.getLight(r);n&&(this.light&&e.removeObject3D("light"),this.light=n,this.light.el=e,e.setObject3D("light",this.light),r.type!=="spot"&&r.type!=="directional"&&r.type!=="hemisphere"||e.getObject3D("light").translateY(-1),r.type==="spot"&&(e.setObject3D("light-target",this.defaultTarget),e.getObject3D("light-target").position.set(0,0,-1)),r.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(r.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var r=this.el,e=this.data,n=this.light;n.castShadow=e.castShadow;var s=r.getObject3D("cameraHelper");if(e.shadowCameraVisible&&!s?(s=new QI(n.shadow.camera),r.setObject3D("cameraHelper",s)):!e.shadowCameraVisible&&s&&r.removeObject3D("cameraHelper"),!e.castShadow)return n;n.shadow.bias=e.shadowBias,n.shadow.radius=e.shadowRadius,n.shadow.mapSize.height=e.shadowMapHeight,n.shadow.mapSize.width=e.shadowMapWidth,n.shadow.camera.near=e.shadowCameraNear,n.shadow.camera.far=e.shadowCameraFar,n.shadow.camera instanceof mc?(n.shadow.camera.top=e.shadowCameraTop,n.shadow.camera.right=e.shadowCameraRight,n.shadow.camera.bottom=e.shadowCameraBottom,n.shadow.camera.left=e.shadowCameraLeft):n.shadow.camera.fov=e.shadowCameraFov,n.shadow.camera.updateProjectionMatrix(),s&&s.update()},getLight:function(r){var e=r.angle,n=new Mt(r.color);n=n.getHex();var s=r.decay,a=r.distance,c=new Mt(r.groundColor);c=c.getHex();var u=r.intensity,A=r.type,m=r.target,v=null;switch(A.toLowerCase()){case"ambient":return new x_(n,u);case"directional":return v=new W0(n,u),this.defaultTarget=v.target,m&&(m.hasLoaded?this.onSetTarget(m,v):m.addEventListener("loaded",this.onSetTarget.bind(this,m,v))),v;case"hemisphere":return new g_(n,c,u);case"point":return new V0(n,u,a,s);case"spot":return v=new z0(n,u,a,f2(e),r.penumbra,s),this.defaultTarget=v.target,m&&(m.hasLoaded?this.onSetTarget(m,v):m.addEventListener("loaded",this.onSetTarget.bind(this,m,v))),v;case"probe":return v=new Ou,this.updateProbeMap(r,v),v;default:J4("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",A)}},updateProbeMap:function(r,e){r.envMap?(ed[r.envMap]===void 0&&(ed[r.envMap]=new window.Promise(function(n){fB(r.envMap,function(s){$4.load(s,function(a){var c=$T.fromCubeTexture(a);ed[r.envMap]=c,n(c)})})})),ed[r.envMap]instanceof window.Promise?ed[r.envMap].then(function(n){e.copy(n)}):ed[r.envMap]instanceof Ou&&e.copy(ed[r.envMap])):e.copy(new Ou)},onSetTarget:function(r,e){e.target=r.object3D},remove:function(){var r=this.el;r.removeObject3D("light"),r.getObject3D("cameraHelper")&&r.removeObject3D("cameraHelper")}}),sn("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var r,e,n=this.data;e=this.material=new zr({color:n.color,opacity:n.opacity,transparent:n.opacity<1,visible:n.visible}),(r=this.geometry=new vn).setAttribute("position",new qn(new Float32Array(6),3)),this.line=new yl(r,e),this.el.setObject3D(this.attrName,this.line)},update:function(r){var e=this.data,n=this.geometry,s=!1,a=this.material,c=n.attributes.position.array;m2(e.start,r.start)||(c[0]=e.start.x,c[1]=e.start.y,c[2]=e.start.z,s=!0),m2(e.end,r.end)||(c[3]=e.end.x,c[4]=e.end.y,c[5]=e.end.z,s=!0),s&&(n.attributes.position.needsUpdate=!0,n.computeBoundingSphere()),a.color.setStyle(e.color),a.opacity=e.opacity,a.transparent=e.opacity<1,a.visible=e.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}}),sn("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new ai,this.hiddenEls=[]},update:function(r){var e,n,s=this.data,a=this.el;if(s.visualAspectEnabled){var c=this.el.getAttribute("scale");this.previewDistance=15*(c.x+c.y)/2,this.initVisualAspect(),e=s.highlighted?s.highlightedColor:s.backgroundColor,n=s.highlighted?s.highlightedColor:s.borderColor,a.setAttribute("material","backgroundColor",e),a.setAttribute("material","strokeColor",n),s.on!==r.on&&this.updateEventListener(),r.peekMode!==void 0&&s.peekMode!==r.peekMode&&this.updatePeekMode(),s.image&&r.image!==s.image&&a.setAttribute("material","pano",typeof s.image=="string"?s.image:s.image.src)}},updatePeekMode:function(){var r=this.el,e=this.sphereEl;this.data.peekMode?(this.hideAll(),r.getObject3D("mesh").visible=!1,e.setAttribute("visible",!0)):(this.showAll(),r.getObject3D("mesh").visible=!0,e.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var r=this.el;r.isPlaying&&(this.removeEventListener(),r.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var r=this.data.on;r&&this.el.removeEventListener(r,this.navigate)},initVisualAspect:function(){var r,e,n,s=this.el;this.data.visualAspectEnabled&&!this.visualAspectInitialized&&(n=this.textEl=this.textEl||document.createElement("a-entity"),e=this.sphereEl=this.sphereEl||document.createElement("a-entity"),r=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),s.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),s.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double",previewDistance:this.previewDistance}),n.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),n.setAttribute("position","0 1.5 0"),s.appendChild(n),r.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),r.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back",previewDistance:this.previewDistance}),r.setAttribute("rotation","0 180 0"),r.setAttribute("position","0 0 0"),r.setAttribute("visible",!1),s.appendChild(r),e.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),e.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back",previewDistance:this.previewDistance}),e.setAttribute("visible",!1),s.appendChild(e),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var r=new R,e=new R,n=new ai,s=new R;return function(){var a,c,u=this.el,A=u.object3D,m=u.sceneEl.camera,v=this.textEl;if(this.data.visualAspectEnabled)if(A.updateMatrixWorld(),m.parent.updateMatrixWorld(),m.updateMatrixWorld(),A.matrix.decompose(e,n,s),e.setFromMatrixPosition(A.matrixWorld),r.setFromMatrixPosition(m.matrixWorld),(c=e.distanceTo(r))>1.33333*this.previewDistance)this.previousQuaternion||(this.quaternionClone.copy(n),this.previousQuaternion=this.quaternionClone),A.lookAt(r);else{if(a=this.calculateCameraPortalOrientation(),c<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;v.setAttribute("text","width",1.5),a<=0?(v.setAttribute("position","0 0 0.75"),v.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(v.setAttribute("position","0 0 -0.75"),v.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),u.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=a}else a<=0?v.setAttribute("rotation","0 180 0"):v.setAttribute("rotation","0 0 0"),v.setAttribute("text","width",5),v.setAttribute("position","0 1.5 0"),u.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(A.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var r=this.el,e=this.hiddenEls,n=this;e.length>0||r.sceneEl.object3D.traverse(function(s){s&&s.el&&s.el.hasAttribute("link-controls")||s.el&&s!==r.sceneEl.object3D&&s.el!==r&&s.el!==n.sphereEl&&s.el!==r.sceneEl.cameraEl&&s.el.getAttribute("visible")!==!1&&s.el!==n.textEl&&s.el!==n.semiSphereEl&&(s.el.setAttribute("visible",!1),e.push(s.el))})},showAll:function(){this.hiddenEls.forEach(function(r){r.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:(oC=new Qt,um=new R,dm=new R(0,0,1),Gv=new R(0,0,0),function(){var r=this.el,e=r.sceneEl.camera;return um.set(0,0,0),dm.set(0,0,1),Gv.set(0,0,0),r.object3D.matrixWorld.extractRotation(oC),dm.applyMatrix4(oC),r.object3D.updateMatrixWorld(),r.object3D.localToWorld(Gv),e.parent.parent.updateMatrixWorld(),e.parent.updateMatrixWorld(),e.updateMatrixWorld(),e.localToWorld(um),um.sub(Gv).normalize(),dm.normalize(),Math.sign(dm.dot(um))}),remove:function(){this.removeEventListener()}}),Ch("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"},previewDistance:{default:15,type:"float",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","uniform float previewDistance;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / previewDistance), 2.0), 0.0, 1.0));","}","}"].join(`
`)});var g2="logitech-mx-ink",Z4=Fr+"controllers/logitech/",v2=(sn("logitech-mx-ink-controls",{schema:{hand:{default:"left"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{left:{buttons:["front","back","none","none","none","tip"]},right:{buttons:["front","back","none","none","none","tip"]}},init:function(){var r=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r,r.data.hand)},this.onButtonUp=function(e){Un(e.detail.id,"up",r,r.data.hand)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r,r.data.hand)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r,r.data.hand)},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),r.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),r.removeEventListener("model-loaded",this.onModelLoaded),r.sceneEl.removeEventListener("enter-vr",this.onEnterVR),r.sceneEl.removeEventListener("exit-vr",this.onExitVR),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.controllerObject3D;r&&(r.visible=!1),Va(this,g2,{hand:this.data.hand,iterateControllerProfiles:!0})},injectTrackedControls:function(){var r=this.el,e=this.data,n=g2;r.setAttribute("tracked-controls",{id:n,hand:e.hand,handTrackingEnabled:!1,iterateControllerProfiles:!0,orientationOffset:e.orientationOffset}),this.loadModel()},loadModel:function(){var r=this.controllerObject3D;if(this.data.model)return r?(r.visible=this.el.sceneEl.is("vr-mode"),void this.el.setObject3D("mesh",r)):void this.el.setAttribute("gltf-model",Z4+"logitech-mx-ink.glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e,n=this.mapping[this.data.hand].buttons[r.detail.id];n&&(n==="trigger"&&(e=r.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(n+"changed",r.detail.state))},onModelLoaded:function(r){r.target===this.el&&this.data.model&&(this.el.emit("controllermodelready",{name:"logitech-mx-ink-controls",model:this.data.model,rayOrigin:new R(0,0,0)}),this.controllerObject3D=this.el.getObject3D("mesh"),this.controllerObject3D.visible=this.el.sceneEl.is("vr-mode"))},onAxisMoved:function(r){po(this,this.mapping.axes,r)}}),Math.PI/2),y2=(sn("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new R,this.hmdQuaternion=new ai,this.magicWindowAbsoluteEuler=new ii,this.magicWindowDeltaEuler=new ii,this.position=new R,this.magicWindowObject=new kn,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new R,rotation:new ii},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var r,e=this.data;(xh()||cb())&&(r=this.magicWindowControls=new eB(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(r.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?r.enabled=e.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){r.enabled=e.magicWindowTrackingEnabled})))},update:function(r){var e=this.data;e.enabled!==r.enabled&&this.updateGrabCursor(e.enabled),r&&!e.magicWindowTrackingEnabled&&r.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=e.magicWindowTrackingEnabled),r&&!e.pointerLockEnabled!==r.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(r){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new kn,this.yawObject=new kn,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var r=this.el.sceneEl,e=r.canvas;e?(e.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),r.addEventListener("enter-vr",this.onEnterVR),r.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):r.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var r=this.el.sceneEl,e=r&&r.canvas;e&&(e.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),r.removeEventListener("enter-vr",this.onEnterVR),r.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var r=this.el.object3D,e=this.pitchObject,n=this.yawObject,s=this.el.sceneEl;(s.is("vr-mode")||s.is("ar-mode"))&&s.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),r.rotation.x=this.magicWindowDeltaEuler.x+e.rotation.x,r.rotation.y=this.magicWindowDeltaEuler.y+n.rotation.y,r.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var r=this.magicWindowAbsoluteEuler,e=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),r.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),this.previousMagicWindowYaw||r.y===0||(this.previousMagicWindowYaw=r.y),this.previousMagicWindowYaw&&(e.x=r.x,e.y+=r.y-this.previousMagicWindowYaw,e.z=r.z,this.previousMagicWindowYaw=r.y))},onMouseMove:function(r){var e,n,s,a=this.pitchObject,c=this.previousMouseEvent,u=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(n=r.movementX||r.mozMovementX||0,s=r.movementY||r.mozMovementY||0):(n=r.screenX-c.screenX,s=r.screenY-c.screenY),this.previousMouseEvent.screenX=r.screenX,this.previousMouseEvent.screenY=r.screenY,e=this.data.reverseMouseDrag?1:-1,u.rotation.y+=.002*n*e,a.rotation.x+=.002*s*e,a.rotation.x=Math.max(-v2,Math.min(v2,a.rotation.x)))},onMouseDown:function(r){var e=this.el.sceneEl;if(this.data.enabled&&this.data.mouseEnabled&&(!e.is("vr-mode")&&!e.is("ar-mode")||!e.checkHeadsetConnected())&&r.button===0){var n=e&&e.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=r.screenX,this.previousMouseEvent.screenY=r.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(n.requestPointerLock?n.requestPointerLock():n.mozRequestPointerLock&&n.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(r){r.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:r.touches[0].pageX,y:r.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(r){var e,n,s=this.el.sceneEl.canvas,a=this.yawObject;this.touchStarted&&this.data.touchEnabled&&(n=2*Math.PI*(r.touches[0].pageX-this.touchStart.x)/s.clientWidth,e=this.data.reverseTouchDrag?1:-1,a.rotation.y-=.5*n*e,this.touchStart={x:r.touches[0].pageX,y:r.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var r=this.el.sceneEl;r.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),r.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(r){var e=this.el.sceneEl;function n(){e.canvas.classList.add("a-grab-cursor")}function s(){e.canvas.classList.remove("a-grab-cursor")}e.canvas?r?n():s():r?e.addEventListener("render-target-loaded",n):e.addEventListener("render-target-loaded",s)},saveCameraPose:function(){var r=this.el;this.savedPose.position.copy(r.object3D.position),this.savedPose.rotation.copy(r.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var r=this.el,e=this.savedPose;this.hasSavedPose&&(r.object3D.position.copy(e.position),r.object3D.rotation.copy(e.rotation),this.hasSavedPose=!1)}}),"magicleap-one"),e5=Fr+"controllers/magicleap/magicleap-one-controller.glb",t5=(sn("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var r=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r)},this.onButtonUp=function(e){Un(e.detail.id,"up",r)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r)},this.previousButtonValues={},this.bindMethods()},update:function(){var r=this.data;this.controllerIndex=r.hand==="right"?0:r.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),r.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),r.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.data;Va(this,y2,{index:this.controllerIndex,hand:r.hand})},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{idPrefix:y2,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",e5)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e,n=this.mapping.buttons[r.detail.id];n&&(n==="trigger"&&(e=r.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(n+"changed",r.detail.state))},onModelLoaded:function(r){r.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(r){po(this,this.mapping.axes,r)},updateModel:function(r,e){},setButtonColor:function(r,e){}}),Bi("components:material:error"));function E2(r,e){r.dispose(),e.unregisterMaterial(r),Object.keys(r).filter(function(n){return r[n]&&r[n].isTexture}).forEach(function(n){r[n].dispose()})}sn("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:XB,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(r){var e=this.data;this.shader&&e.shader===r.shader||this.updateShader(e.shader),this.shader.update(this.data),this.updateMaterial(r)},updateSchema:function(r){var e,n,s,a;n=r&&r.shader,e=this.oldData&&this.oldData.shader,(s=bl[a=n||e]&&bl[a].schema)||t5("Unknown shader schema "+a),e&&n===e||(this.extendSchema(s),this.updateBehavior())},updateBehavior:function(){var r,e,n=this.el.sceneEl,s=this.schema,a=this;function c(u,A){var m;for(m in e)e[m]=u;a.shader.update(e)}for(r in this.tick=void 0,e={},s)s[r].type==="time"&&(this.tick=c,e[r]=!0);n&&(this.tick?n.addBehavior(this):n.removeBehavior(this))},updateShader:function(r){var e,n=this.data,s=bl[r]&&bl[r].Shader;if(!s)throw new Error("Unknown shader "+r);(e=this.shader=new s).el=this.el,e.init(n),this.setMaterial(e.material),this.updateSchema(n)},updateMaterial:function(r){var e,n=this.data,s=this.material;for(e in s.alphaTest=n.alphaTest,s.depthTest=n.depthTest!==!1,s.depthWrite=n.depthWrite!==!1,s.opacity=n.opacity,s.flatShading=n.flatShading,s.side=function(a){switch(a){case"back":return Lt;case"double":return Dt;default:return ut}}(n.side),s.transparent=n.transparent!==!1||n.opacity<1,s.vertexColors=n.vertexColorsEnabled,s.visible=n.visible,s.blending=function(a){switch(a){case"none":return Yt;case"additive":return An;case"subtractive":return dn;case"multiply":return Tn;default:return rn}}(n.blending),s.dithering=n.dithering,r)break;!e||r.alphaTest===n.alphaTest&&r.side===n.side&&r.vertexColorsEnabled===n.vertexColorsEnabled||(s.needsUpdate=!0)},remove:function(){var r=new Jr,e=this.material,n=this.el.getObject3D("mesh");n&&(n.material=r),E2(e,this.system)},setMaterial:function(r){var e,n=this.el,s=this.system;this.material&&E2(this.material,s),this.material=r,s.registerMaterial(r),(e=n.getObject3D("mesh"))?e.material=r:n.addEventListener("object3dset",function a(c){c.detail.type==="mesh"&&c.target===n&&(n.getObject3D("mesh").material=r,n.removeEventListener("object3dset",a))})}});var Hv,zv,lC,x2,cC,_2="oculus-touch",Tp=Fr+"controllers/oculus/oculus-touch-controller-",Vv=Fr+"controllers/meta/",n5={left:{modelUrl:Tp+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new R(-.005,.036,-.037),modelPivotRotation:new ii(Math.PI/4.5,0,0)},right:{modelUrl:Tp+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new R(.005,.036,-.037),modelPivotRotation:new ii(Math.PI/4.5,0,0)}},b2="oculus-touch",td={"oculus-touch":n5,"oculus-touch-v2":{left:{modelUrl:Tp+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new R(0,-.007,-.021),modelPivotRotation:new ii(-Math.PI/4,0,0)},right:{modelUrl:Tp+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new R(0,-.007,-.021),modelPivotRotation:new ii(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:Tp+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new R(0,0,0),modelPivotRotation:new ii(0,0,0)},right:{modelUrl:Tp+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new R(0,0,0),modelPivotRotation:new ii(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:Vv+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new R(0,0,0),modelPivotRotation:new ii(0,0,0)},right:{modelUrl:Vv+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new R(0,0,0),modelPivotRotation:new ii(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:Vv+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new R(0,0,0),modelPivotRotation:new ii(0,0,0)},right:{modelUrl:Vv+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new R(0,0,0),modelPivotRotation:new ii(0,0,0)}}},C2={schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]}},after:["tracked-controls"],mapping:{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var r=this;this.onButtonDown=function(e){Un(e.detail.id,"down",r,r.data.hand)},this.onButtonUp=function(e){Un(e.detail.id,"up",r,r.data.hand)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r,r.data.hand)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r,r.data.hand)},this.controllerPresent=!1,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new ii},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),r.addEventListener("model-loaded",this.onModelLoaded),r.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),r.removeEventListener("model-loaded",this.onModelLoaded),r.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.controllerObject3D;r&&(r.visible=!1),Va(this,_2,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(r){var e,n=this.data;if(n.model){if(this.controllerObject3D)return this.controllerObject3D.visible=!0,void this.el.setObject3D("mesh",this.controllerObject3D);if(this.displayModel=td[n.controllerType]||td[b2],n.controllerType==="auto"){e=b2;for(var s=Object.keys(td),a=0;a<r.profiles.length;a++)if(s.indexOf(r.profiles[a])!==-1){e=r.profiles[a];break}this.displayModel=td[e]}var c=this.displayModel[n.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===td["oculus-touch-v3"]||this.displayModel===td["meta-quest-touch-pro"]||this.displayModel===td["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",c)}},injectTrackedControls:function(r){var e=this.data,n=_2;this.el.setAttribute("tracked-controls",{id:n,hand:e.hand,handTrackingEnabled:!1,iterateControllerProfiles:!0}),this.loadModel(r)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e=this.mapping[this.data.hand].buttons[r.detail.id];if(e){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus(r);else{var n,s=this.buttonMeshes;e!=="trigger"&&e!=="grip"||(n=r.detail.state.value),s&&(e==="trigger"&&s.trigger&&(s.trigger.rotation.x=this.originalXRotationTrigger-n*(Math.PI/26)),e==="grip"&&s.grip&&(n*=this.data.hand==="left"?-1:1,s.grip.position.x=this.originalXPositionGrip+.004*n))}this.el.emit(e+"changed",r.detail.state)}},onButtonChangedV3orPROorPlus:function(r){var e,n=this.mapping[this.data.hand].buttons[r.detail.id],s=this.buttonObjects;s&&s[n]&&(e=r.detail.state.value,s[n].quaternion.slerpQuaternions(this.buttonRanges[n].min.quaternion,this.buttonRanges[n].max.quaternion,e),s[n].position.lerpVectors(this.buttonRanges[n].min.position,this.buttonRanges[n].max.position,e))},onModelLoaded:function(r){if(r.target===this.el&&this.data.model){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded(r);else{var e,n=this.controllerObject3D=r.detail.model;(e=this.buttonMeshes={}).grip=n.getObjectByName("buttonHand"),this.originalXPositionGrip=e.grip&&e.grip.position.x,e.trigger=n.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=e.trigger&&e.trigger.rotation.x,e.thumbstick=n.getObjectByName("stick"),e.xbutton=n.getObjectByName("buttonX"),e.abutton=n.getObjectByName("buttonA"),e.ybutton=n.getObjectByName("buttonY"),e.bbutton=n.getObjectByName("buttonB")}for(var s in this.buttonMeshes)this.buttonMeshes[s]&&i5(this.buttonMeshes[s]);this.applyOffset(r.detail.model),this.el.emit("controllermodelready",{name:"meta-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(r){r.position.copy(this.displayModel[this.data.hand].modelPivotOffset),r.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function(r){var e=this.controllerObject3D=r.detail.model,n=this.buttonObjects={},s=this.buttonMeshes={},a=this.buttonRanges={};s.grip=e.getObjectByName("squeeze"),n.grip=e.getObjectByName("xr_standard_squeeze_pressed_value"),a.grip={min:e.getObjectByName("xr_standard_squeeze_pressed_min"),max:e.getObjectByName("xr_standard_squeeze_pressed_max")},n.grip.minX=n.grip.position.x,s.thumbstick=e.getObjectByName("thumbstick"),n.thumbstick=e.getObjectByName("xr_standard_thumbstick_pressed_value"),a.thumbstick={min:e.getObjectByName("xr_standard_thumbstick_pressed_min"),max:e.getObjectByName("xr_standard_thumbstick_pressed_max")},n.thumbstickXAxis=e.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),a.thumbstickXAxis={min:e.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:e.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},n.thumbstickYAxis=e.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),a.thumbstickYAxis={min:e.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:e.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},s.trigger=e.getObjectByName("trigger"),n.trigger=e.getObjectByName("xr_standard_trigger_pressed_value"),a.trigger={min:e.getObjectByName("xr_standard_trigger_pressed_min"),max:e.getObjectByName("xr_standard_trigger_pressed_max")},a.trigger.diff={x:Math.abs(a.trigger.max.rotation.x)-Math.abs(a.trigger.min.rotation.x),y:Math.abs(a.trigger.max.rotation.y)-Math.abs(a.trigger.min.rotation.y),z:Math.abs(a.trigger.max.rotation.z)-Math.abs(a.trigger.min.rotation.z)};var c=this.data.hand==="left"?"x":"a",u=this.data.hand==="left"?"y":"b",A=c+"button",m=u+"button";s[A]=e.getObjectByName(c+"_button"),n[A]=e.getObjectByName(c+"_button_pressed_value"),a[A]={min:e.getObjectByName(c+"_button_pressed_min"),max:e.getObjectByName(c+"_button_pressed_max")},s[m]=e.getObjectByName(u+"_button"),n[m]=e.getObjectByName(u+"_button_pressed_value"),a[m]={min:e.getObjectByName(u+"_button_pressed_min"),max:e.getObjectByName(u+"_button_pressed_max")}},onAxisMoved:function(r){po(this,this.mapping[this.data.hand].axes,r)},onThumbstickMoved:function(r){if(this.buttonMeshes&&this.buttonMeshes.thumbstick)if(this.isTouchV3orPROorPlus)this.updateThumbstickTouchV3orPROorPlus(r);else for(var e in r.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[e]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[e]]-Math.PI/8*r.detail[e]*(e==="y"||this.data.hand==="right"?-1:1)},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function(r){var e=(r.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,e);var n=(r.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,n)},updateModel:function(r,e){this.data.model&&this.updateButtonModel(r,e)},updateButtonModel:function(r,e){var n,s=this.buttonMeshes;s&&s[r]&&(n=e==="up"||e==="touchend"?s[r].originalColor||this.data.buttonColor:e==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,s[r].material.color.set(n))}};function i5(r){r.traverse(function(e){var n;e.type==="Mesh"&&(n=e.material.clone(),r.originalColor=e.material.color,e.material.dispose(),e.material=n)})}sn("oculus-touch-controls",C2),sn("meta-touch-controls",C2),sn("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=new R().copy(this.el.object3D.scale),this.auxEuler=new ii,this.boundingBox=new te,this.boundingBoxSize=new R,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var r,e=this.el,n=e.components["gltf-model"]&&e.components["gltf-model"].model;n&&(this.el.removeObject3D("mesh"),r=new te().setFromObject(n).getCenter(new R),n.position.x+=n.position.x-r.x,n.position.y+=n.position.y-r.y,n.position.z+=n.position.z-r.z,this.el.setObject3D("mesh",n))},updateCollider:function(){var r=this.el,e=this.boundingBoxSize,n=this.aabb=this.aabb||new lv;this.obb=this.obb||new lv,r.hasLoaded?(this.updateBoundingBox(),n.halfSize.copy(e).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()):r.addEventListener("loaded",this.updateCollider)},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var r=this.renderColliderMesh,e=this.boundingBoxSize;r?(r.geometry.dispose(),r.geometry=new vl(e.x,e.y,e.z)):this.initColliderMesh()},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var r,e,n;r=this.boundingBoxSize,e=this.renderColliderGeometry=new vl(r.x,r.y,r.z),(n=this.renderColliderMesh=new Ti(e,new l_({color:65280,side:Dt}))).matrixAutoUpdate=!1,n.matrixWorldAutoUpdate=!1,n.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(n)},updateBoundingBox:(Hv=new R,zv=new R,lC=new ai,x2=new ai,cC=new Qt,function(){var r=this.auxEuler,e=this.boundingBox,n=this.data.size,s=this.trackedObject3D||this.el.object3D,a=this.boundingBoxSize,c=this.data.minimumColliderDimension;if(n)return this.boundingBoxSize.x=n,this.boundingBoxSize.y=n,void(this.boundingBoxSize.z=n);r.copy(s.rotation),s.rotation.set(0,0,0),s.parent.matrixWorld.decompose(Hv,lC,zv),cC.compose(Hv,x2,zv),s.parent.matrixWorld.copy(cC),e.setFromObject(s,!0),e.getSize(a),a.x=a.x<c?c:a.x,a.y=a.y<c?c:a.y,a.z=a.z<c?c:a.z,s.parent.matrixWorld.compose(Hv,lC,zv),this.el.object3D.rotation.copy(r)}),checkTrackedObject:function(){var r,e=this.trackedObject3DPath;if(e&&e.length&&!this.trackedObject3D){r=this.el;for(var n=0;n<e.length&&(r=r[e[n]]);n++);r&&(this.trackedObject3D=r,this.updateCollider())}return this.trackedObject3D},tick:function(){var r=new R,e=new R,n=new ai,s=new Qt;return function(){var a=this.obb,c=this.renderColliderMesh,u=this.checkTrackedObject()||this.el.object3D;u&&(u.updateMatrix(),u.updateMatrixWorld(!0),u.matrixWorld.decompose(r,n,e),(Math.abs(e.x-this.previousScale.x)>1e-4||Math.abs(e.y-this.previousScale.y)>1e-4||Math.abs(e.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(e),e.set(1,1,1),s.compose(r,n,e),c&&c.matrixWorld.copy(s),a.copy(this.aabb),a.applyMatrix4(s))}}()});var r5=Bi("components:obj-model:warn"),s5=(sn("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var r=this;this.model=null,this.objLoader=new KT,this.mtlLoader=new JT(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(e){r.model&&e.detail.name==="material"&&r.applyMaterial()})},update:function(){var r=this.data;r.obj&&(this.resetMesh(),this.loadObj(r.obj,r.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(r,e){var n=this,s=this.el,a=this.mtlLoader,c=this.objLoader,u=this.el.sceneEl.systems.renderer,A=e.substr(0,e.lastIndexOf("/")+1);if(e)return s.hasAttribute("material")&&r5("Material component properties are ignored when a .MTL is provided"),a.setResourcePath(A),void a.load(e,function(m){m.preload(),c.setMaterials(m),c.load(r,function(v){n.model=v,n.model.traverse(function(E){if(E.isMesh){var C=E.material;C.map&&u.applyColorCorrection(C.map),C.emissiveMap&&u.applyColorCorrection(C.emissiveMap)}}),s.setObject3D("mesh",v),s.emit("model-loaded",{format:"obj",model:v})})});c.load(r,function(m){n.model=m,n.applyMaterial(),s.setObject3D("mesh",m),s.emit("model-loaded",{format:"obj",model:m})})},applyMaterial:function(){var r=this.el.components.material;r&&this.model.traverse(function(e){e instanceof Ti&&(e.material=r.material)})}}),Fr+"controllers/oculus/go/oculus-go-controller.gltf"),w2="oculus-go",M2=(sn("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var r=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r)},this.onButtonUp=function(e){Un(e.detail.id,"up",r)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r)},this.controllerPresent=!1,this.bindMethods()},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("model-loaded",this.onModelLoaded),r.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("model-loaded",this.onModelLoaded),r.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){Va(this,w2,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{hand:e.hand,idPrefix:w2}),this.data.model&&this.el.setAttribute("gltf-model",s5)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(r){var e,n=r.detail.model;r.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).trigger=n.getObjectByName("oculus_go_button_trigger"),e.trackpad=n.getObjectByName("oculus_go_touchpad"),e.touchpad=n.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(r){var e=this.mapping.buttons[r.detail.id];e&&this.el.emit(e+"changed",r.detail.state)},onAxisMoved:function(r){po(this,this.mapping.axes,r)},updateModel:function(r,e){this.data.model&&this.updateButtonModel(r,e)},updateButtonModel:function(r,e){var n=this.buttonMeshes;if(n&&n[r]){var s;switch(e){case"down":s=this.data.buttonHighlightColor;break;case"touchstart":s=this.data.buttonTouchedColor;break;default:s=this.data.buttonColor}n[r].material.color.set(s)}}}),"pico-4"),a5=Fr+"controllers/pico/pico4/",S2=(sn("pico-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var r=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r,r.data.hand)},this.onButtonUp=function(e){Un(e.detail.id,"up",r,r.data.hand)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r,r.data.hand)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r,r.data.hand)},this.bindMethods()},update:function(){var r=this.data;this.controllerIndex=r.hand==="right"?0:r.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),r.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),r.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.data;Va(this,M2,{index:this.controllerIndex,hand:r.hand})},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{idPrefix:M2,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",a5+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e,n=this.mapping[this.data.hand].buttons[r.detail.id];n&&(n==="trigger"&&(e=r.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(n+"changed",r.detail.state))},onModelLoaded:function(r){r.target===this.el&&this.data.model&&this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new R(0,0,0)})},onAxisMoved:function(r){po(this,this.mapping[this.data.hand].axes,r)}}),sn("position",{schema:{type:"vec3"},update:function(){var r=this.el.object3D,e=this.data;r.position.set(e.x,e.y,e.z)},remove:function(){this.el.object3D.position.set(0,0,0)}}),Bi("components:raycaster:warn")),o5=/^[\w\s-.,[\]#]*$/,l5={childList:!0,attributes:!0,subtree:!0},I2="raycaster-intersected-cleared",T2="raycaster-intersection-cleared";function B2(r,e){var n;for(r.length=e.length,n=0;n<e.length;n++)r[n]=e[n]}sn("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new R,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new BI,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new R,this.otherLineEndVec3=new R,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(r){var e=this.data,n=this.el,s=this.raycaster;s.far=e.far,s.near=e.near,!e.showLine||e.far===r.far&&e.origin===r.origin&&e.direction===r.direction&&r.showLine||(this.unitLineEndVec3.copy(e.direction).normalize(),this.drawLine()),!e.showLine&&r.showLine&&n.removeAttribute("line"),e.objects===r.objects||o5.test(e.objects)||S2('[raycaster] Selector "'+e.objects+'" may not update automatically with DOM changes.'),e.objects||S2('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),e.autoRefresh!==r.autoRefresh&&n.isPlaying&&(e.autoRefresh?this.addEventListeners():this.removeEventListeners()),r.enabled&&!e.enabled&&this.clearAllIntersections(),e.objects!==r.objects&&this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,l5),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var r,e=this.data;r=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(r),this.dirty=!1},tock:function(r){var e=this.data,n=this.prevCheckTime;e.enabled&&(n&&r-n<e.interval||(this.prevCheckTime=r,this.checkIntersections()))},checkIntersections:function(){var r,e,n=this.clearedIntersectedEls,s=this.el,a=this.data,c=this.intersectedEls,u=this.intersections,A=this.newIntersectedEls,m=this.newIntersections,v=this.prevIntersectedEls,E=this.rawIntersections;for(this.dirty&&this.refreshObjects(),B2(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),E.length=0,this.raycaster.intersectObjects(this.objects,!0,E),u.length=0,c.length=0,r=0;r<E.length;r++)e=E[r],a.showLine&&e.object===s.getObject3D("line")||e.object.el&&(u.push(e),c.push(e.object.el));for(m.length=0,A.length=0,r=0;r<u.length;r++)v.indexOf(u[r].object.el)===-1&&(m.push(u[r]),A.push(u[r].object.el));for(n.length=0,r=0;r<v.length;r++)c.indexOf(v[r])===-1&&(v[r].emit(I2,this.intersectedClearedDetail),n.push(v[r]));for(n.length&&s.emit(T2,this.intersectionClearedDetail),r=0;r<A.length;r++)A[r].emit("raycaster-intersected",this.intersectedDetail);m.length&&(this.intersectionDetail.els=A,this.intersectionDetail.intersections=m,s.emit("raycaster-intersection",this.intersectionDetail)),(v.length===0&&u.length>0||v.length>0&&u.length===0||v.length&&u.length&&v[0]!==u[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=u,s.emit("raycaster-closest-entity-changed",this.intersectionDetail)),a.showLine&&setTimeout(this.updateLine)},updateLine:function(){var r,e=this.el,n=this.intersections;n.length&&(r=n[0].object.el===e&&n[1]?n[1].distance:n[0].distance),this.drawLine(r)},getIntersection:function(r){var e,n;for(e=0;e<this.intersections.length;e++)if((n=this.intersections[e]).object.el===r)return n;return null},updateOriginDirection:function(){var r=new R,e=new R;return function(){var n=this.el,s=this.data;s.useWorldCoordinates?this.raycaster.set(s.origin,s.direction):(n.object3D.updateMatrixWorld(),e.setFromMatrixPosition(n.object3D.matrixWorld),s.origin.x===0&&s.origin.y===0&&s.origin.z===0||(e=n.object3D.localToWorld(e.copy(s.origin))),r.copy(s.direction).transformDirection(n.object3D.matrixWorld).normalize(),this.raycaster.set(e,r))}}(),drawLine:function(r){var e,n=this.data,s=this.el;e=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,r===void 0&&(r=n.far===1/0?1e3:n.far),this.lineData.start=n.origin,this.lineData.end=e.copy(this.unitLineEndVec3).multiplyScalar(r).add(n.origin),this.lineData.color=n.lineColor,this.lineData.opacity=n.lineOpacity,s.setAttribute("line",this.lineData)},flattenObject3DMaps:function(r){var e,n,s=this.objects,a=this.el.sceneEl.object3D;function c(A){return A.parent?c(A.parent):A===a}for(s.length=0,n=0;n<r.length;n++){var u=r[n];if(u.isEntity&&u.object3D&&c(u.object3D))for(e in u.object3DMap)s.push(u.getObject3D(e))}return s},clearAllIntersections:function(){var r;for(r=0;r<this.intersectedEls.length;r++)this.intersectedEls[r].emit(I2,this.intersectedClearedDetail);B2(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(T2,this.intersectionClearedDetail)}});var R2,Bp,L2,D2,hC=Tr.degToRad,uC=(sn("rotation",{schema:{type:"vec3"},update:function(){var r=this.data;this.el.object3D.rotation.set(hC(r.x),hC(r.y),hC(r.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}}),sn("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var r=this.data;this.el.object3D.scale.set(r.x,r.y,r.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}}),sn("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var r=this.data;this.updateDescendants(r.cast,r.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(r,e){var n=this.el.sceneEl;this.el.object3D.traverse(function(s){if(s instanceof Ti&&(s.castShadow=r,s.receiveShadow=e,n.hasLoaded&&s.material))for(var a=Array.isArray(s.material)?s.material:[s.material],c=0;c<a.length;c++)a[c].needsUpdate=!0})}}),Bi("components:sound:warn")),c5=(sn("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var r=this;this.listener=null,this.audioLoader=new gI,this.pool=new wa,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){r.playSound()}},update:function(r){var e,n,s=this.data,a=s.src!==r.src;if(a){if(!s.src)return;this.setupSound()}for(e=0;e<this.pool.children.length;e++)n=this.pool.children[e],s.positional&&(n.setDistanceModel(s.distanceModel),n.setMaxDistance(s.maxDistance),n.setRefDistance(s.refDistance),n.setRolloffFactor(s.rolloffFactor)),n.setLoop(s.loop),n.setLoopStart(s.loopStart),s.loopStart!==0&&s.loopEnd===0?n.setLoopEnd(n.buffer.duration):n.setLoopEnd(s.loopEnd),n.setVolume(s.volume),n.isPaused=!1;if(s.on!==r.on&&this.updateEventListener(r.on),a){var c=this;this.loaded=!1,this.audioLoader.load(s.src,function(u){for(e=0;e<c.pool.children.length;e++)(n=c.pool.children[e]).setBuffer(u);c.loaded=!0,co.remove(s.src),(c.data.autoplay||c.mustPlay)&&c.playSound(c.processSound),c.el.emit("sound-loaded",c.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var r;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(r=0;r<this.pool.children.length;r++)this.pool.children[r].disconnect()}catch{uC("Audio source not properly disconnected")}},updateEventListener:function(r){var e=this.el;r&&e.removeEventListener(r,this.playSoundBound),e.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var r,e,n=this.el,s=n.sceneEl,a=this;this.pool.children.length>0&&(this.stopSound(),n.removeObject3D("sound"));var c=this.listener=s.audioListener||new bI;for(s.audioListener=c,s.camera&&s.camera.add(c),s.addEventListener("camera-set-active",function(u){u.detail.cameraEl.getObject3D("camera").add(c)}),this.pool=new wa,r=0;r<this.data.poolSize;r++)e=this.data.positional?new wI(c):new b_(c),this.pool.add(e);for(n.setObject3D(this.attrName,this.pool),r=0;r<this.pool.children.length;r++)(e=this.pool.children[r]).onEnded=function(){this.isPlaying=!1,a.el.emit("sound-ended",a.evtDetail,!1)}},pauseSound:function(){var r,e;for(this.isPlaying=!1,r=0;r<this.pool.children.length;r++)(e=this.pool.children[r]).source&&e.source.buffer&&e.isPlaying&&!e.isPaused&&(e.isPaused=!0,e.pause())},playSound:function(r){var e,n,s;if(!this.loaded)return uC("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,void(this.processSound=r);for(e=!1,this.isPlaying=!0,n=0;n<this.pool.children.length;n++)(s=this.pool.children[n]).isPlaying||!s.buffer||e||(r&&r(s),s.play(),s.isPaused=!1,e=!0);e?(this.mustPlay=!1,this.processSound=void 0):uC("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el)},stopSound:function(){var r,e;for(this.isPlaying=!1,r=0;r<this.pool.children.length;r++){if(!(e=this.pool.children[r]).source||!e.source.buffer)return;e.stop()}}}),i(4433)),h5=i.n(c5),u5=i(5751),d5=i.n(u5),Rp=Bi("components:text:error"),p5=Bi("components:text:warn"),_c=Fr+"fonts/",P2={aileronsemibold:_c+"Aileron-Semibold.fnt",dejavu:_c+"DejaVu-sdf.fnt",exo2bold:_c+"Exo2Bold.fnt",exo2semibold:_c+"Exo2SemiBold.fnt",kelsonsans:_c+"KelsonSans.fnt",monoid:_c+"Monoid.fnt",mozillavr:_c+"mozillavr.fnt",roboto:_c+"Roboto-msdf.json",sourcecodepro:_c+"SourceCodePro.fnt"},U2=["roboto"],dC="roboto",N2=new function(){var r=this.cache={};this.get=function(e,n){return e in r||(r[e]=n()),r[e]}},F2={},Wv={},A5=/^\w+:/;function O2(r,e,n){return r||(.5+e)*n}sn("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:dC},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:bl},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=h5()(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(r){var e=this.data,n=this.currentFont;Wv[e.font]?this.texture=Wv[e.font]:(this.texture=Wv[e.font]=new Pi,this.texture.anisotropy=16),this.createOrUpdateMaterial(),r.font===e.font?n&&(this.updateGeometry(this.geometry,n),this.updateLayout()):this.updateFont()},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var r,e,n,s=this.data,a=this.material,c=this.shaderData;if(n=s.shader,U2.indexOf(s.font)!==-1||s.font.indexOf("-msdf.")>=0?n="msdf":s.font in P2&&U2.indexOf(s.font)===-1&&(n="sdf"),r=(this.shaderObject&&this.shaderObject.name)!==n,c.alphaTest=s.alphaTest,c.color=s.color,c.map=this.texture,c.opacity=s.opacity,c.side=function(u){switch(u){case"back":return ut;case"double":return Dt;default:return Lt}}(s.side),c.transparent=s.transparent,c.negate=s.negate,!r)return this.shaderObject.update(c),a.transparent=c.transparent,void(a.side=c.side);e=function(u,A,m){var v,E;return(E=new bl[A].Shader).el=u,E.init(m),E.update(m),(v=E.material).transparent=m.transparent,{material:v,shader:E}}(this.el,n,c),this.material=e.material,this.shaderObject=e.shader,this.material.side=c.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var r,e=this.data,n=this.el,s=this.geometry,a=this;e.font||p5("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),r=this.lookupFont(e.font||dC)||e.font,N2.get(r,function(){return function(c,u){return new Promise(function(A,m){d5()(c,function(v,E){if(v)return Rp("Error loading font",c),void m(v);c.indexOf("/Roboto-msdf.json")>=0&&(u=30),u&&E.chars.forEach(function(C){C.yoffset+=u}),A(E)})})}(r,e.yOffset)}).then(function(c){var u;if(c.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");F2[r]||(c.widthFactor=F2[c]=function(A){var m=0,v=0,E=0;return A.chars.forEach(function(C){m+=C.xadvance,C.id>=48&&C.id<=57&&(E++,v+=C.xadvance)}),E?v/E:m/A.chars.length}(c)),a.currentFont=c,u=a.getFontImageSrc(),N2.get(u,function(){return function(A){return new Promise(function(m,v){new Fu().load(A,function(E){m(E)},void 0,function(){Rp("Error loading font image",A),v(null)})})}(u)}).then(function(A){var m=a.texture;m&&(m.image=A,m.needsUpdate=!0,Wv[e.font]=m,a.texture=m,a.initMesh(),a.currentFont=c,a.updateGeometry(s,c),a.updateLayout(),a.mesh.visible=!0,n.emit("textfontset",{font:e.font,fontObj:c}))}).catch(function(A){Rp(A.message),Rp(A.stack)})}).catch(function(c){Rp(c.message),Rp(c.stack)})},initMesh:function(){this.mesh||(this.mesh=new Ti(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var r=this.lookupFont(this.data.font||dC)||this.data.font,e=this.currentFont.pages[0];return e.match(A5)&&e.indexOf("http")!==0?r.replace(/(\.fnt)|(\.json)/,".png"):xl.extractUrlBase(r)+e},updateLayout:function(){var r,e,n,s,a,c,u,A,m,v=this.el,E=this.data,C=this.geometry,M=this.mesh;if(M&&C.layout){if(n=v.getAttribute("geometry"),s=(c=(u=E.width||n&&n.width||1)/O2(E.wrapPixels,E.wrapCount,this.currentFont.widthFactor))*((a=C.layout).height+a.descender),n&&n.primitive==="plane"&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!n.width,this.hasExplicitGeoHeight=!!n.height),this.hasExplicitGeoWidth||v.setAttribute("geometry","width",u),this.hasExplicitGeoHeight||v.setAttribute("geometry","height",s)),(r=E.anchor==="align"?E.align:E.anchor)==="left")A=0;else if(r==="right")A=-1*a.width;else{if(r!=="center")throw new TypeError("Invalid text.anchor property value",r);A=-1*a.width/2}if((e=E.baseline)==="bottom")m=0;else if(e==="top")m=-1*a.height+a.ascender;else{if(e!=="center")throw new TypeError("Invalid text.baseline property value",e);m=-1*a.height/2}M.position.x=A*c+E.xOffset,M.position.y=m*c,M.position.z=E.zOffset,M.scale.set(c,-1*c,c)}},lookupFont:function(r){return P2[r]},updateGeometry:(R2={},Bp={},L2=/\\n/g,D2=/\\t/g,function(r,e){var n=this.data;Bp.font=e,Bp.lineHeight=n.lineHeight&&isFinite(n.lineHeight)?n.lineHeight:e.common.lineHeight,Bp.text=n.value.toString().replace(L2,`
`).replace(D2,"	"),Bp.width=O2(n.wrapPixels,n.wrapCount,e.widthFactor),r.update(Sa(R2,n,Bp))})});var Lp,pC,k2=(sn("tracked-controls",{schema:{id:{type:"string",default:""},controller:{default:-1},autoHide:{default:!0},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},iterateControllerProfiles:{default:!1}},init:function(){this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.updateController=this.updateController.bind(this)},update:function(){this.updateController()},play:function(){var r=this.el.sceneEl;this.updateController(),r.addEventListener("controllersupdated",this.updateController)},pause:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(r){return!(!this.controller||this.controller.gamepad||r.inputSource.handedness!=="none"&&r.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=bb(this.system.controllers,this.data.id,this.data.hand,this.data.controller,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller},tick:function(){var r=this.el.sceneEl,e=this.controller,n=r.frame;this.data.autoHide&&(this.el.object3D.visible=!!e),e&&r.frame&&this.system.referenceSpace&&(e.hand||(this.pose=n.getPose(e.gripSpace,this.system.referenceSpace),this.updatePose(),this.updateButtons()))},updatePose:function(){var r=this.el.object3D,e=this.pose;e&&(r.matrix.elements=e.transform.matrix,r.matrix.decompose(r.position,r.rotation,r.scale))},updateButtons:function(){var r,e,n,s=this.controller;if(s&&s.gamepad){for(n=s.gamepad,e=0;e<n.buttons.length;++e)this.buttonStates[e]||(this.buttonStates[e]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[e]||(this.buttonEventDetails[e]={id:e,state:this.buttonStates[e]}),r=n.buttons[e],this.handleButton(e,r);this.handleAxes()}},handleButton:function(r,e){return!!(this.handlePress(r,e)|this.handleTouch(r,e)|this.handleValue(r,e))&&(this.el.emit("buttonchanged",this.buttonEventDetails[r],!1),!0)},handleAxes:function(){var r,e=!1,n=this.controller.gamepad.axes,s=this.axis,a=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),r=0;r<n.length;++r)a.push(s[r]!==n[r]),a[r]&&(e=!0);if(!e)return!1;for(this.axis.splice(0,this.axis.length),r=0;r<n.length;r++)this.axis.push(n[r]);return this.el.emit("axismove",this.axisMoveEventDetail,!1),!0},handlePress:function(r,e){var n,s=this.buttonStates[r];return e.pressed!==s.pressed&&(n=e.pressed?"buttondown":"buttonup",this.el.emit(n,this.buttonEventDetails[r],!1),s.pressed=e.pressed,!0)},handleTouch:function(r,e){var n,s=this.buttonStates[r];return e.touched!==s.touched&&(n=e.touched?"touchstart":"touchend",this.el.emit(n,this.buttonEventDetails[r],!1),s.touched=e.touched,!0)},handleValue:function(r,e){var n=this.buttonStates[r];return e.value!==n.value&&(n.value=e.value,!0)}}),sn("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}}),Fr+"controllers/valve/index/valve-index-"),f5={left:k2+"left.glb",right:k2+"right.glb"},Q2="valve",m5={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},g5={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},v5=(sn("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var r=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r)},this.onButtonUp=function(e){Un(e.detail.id,"up",r)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("model-loaded",this.onModelLoaded),r.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("model-loaded",this.onModelLoaded),r.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.data,e=r.hand==="right"?0:r.hand==="left"?1:2;Va(this,Q2,{index:e,iterateControllerProfiles:!0,hand:r.hand})},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{idPrefix:Q2,controller:e.hand==="right"?1:e.hand==="left"?0:2,hand:e.hand}),this.loadModel()},loadModel:function(){var r=this.data;r.model&&this.el.setAttribute("gltf-model",""+f5[r.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e,n=this.mapping.buttons[r.detail.id],s=this.buttonMeshes;n&&(n==="trigger"&&(e=r.detail.state.value,s&&s.trigger&&(s.trigger.rotation.x=this.triggerOriginalRotationX-e*(Math.PI/40))),this.el.emit(n+"changed",r.detail.state))},onModelLoaded:function(r){var e,n=r.detail.model,s=this;r.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).grip={left:n.getObjectByName("leftgrip"),right:n.getObjectByName("rightgrip")},e.menu=n.getObjectByName("menubutton"),e.system=n.getObjectByName("systembutton"),e.trackpad=n.getObjectByName("touchpad"),e.trigger=n.getObjectByName("trigger"),this.triggerOriginalRotationX=e.trigger.rotation.x,Object.keys(e).forEach(function(a){s.setButtonColor(a,s.data.buttonColor)}),n.position.copy(g5[this.data.hand]),n.rotation.copy(m5[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new R(0,0,0)}))},onAxisMoved:function(r){po(this,this.mapping.axes,r)},updateModel:function(r,e){var n;this.data.model&&(e.indexOf("touch")!==-1||(n=e==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(r,n)))},setButtonColor:function(r,e){}}),Fr+"controllers/vive/vr_controller_vive.obj"),y5=Fr+"controllers/vive/vr_controller_vive.mtl",G2="htc-vive",E5=(sn("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]},init:function(){var r=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r)},this.onButtonUp=function(e){Un(e.detail.id,"up",r)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r)},this.previousButtonValues={},this.bindMethods()},update:function(){var r=this.data;this.controllerIndex=r.hand==="right"?0:r.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("model-loaded",this.onModelLoaded),r.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("model-loaded",this.onModelLoaded),r.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var r=this.data;Va(this,G2,{index:this.controllerIndex,hand:r.hand})},injectTrackedControls:function(){var r=this.el,e=this.data;r.setAttribute("tracked-controls",{idPrefix:G2,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("obj-model",{obj:v5,mtl:y5})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(r){var e,n=this.mapping.buttons[r.detail.id],s=this.buttonMeshes;n&&(n==="trigger"&&(e=r.detail.state.value,s&&s.trigger&&(s.trigger.rotation.x=-e*(Math.PI/12))),this.el.emit(n+"changed",r.detail.state))},onModelLoaded:function(r){var e,n=r.detail.model,s=this;r.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).grip={left:n.getObjectByName("leftgrip"),right:n.getObjectByName("rightgrip")},e.menu=n.getObjectByName("menubutton"),e.system=n.getObjectByName("systembutton"),e.trackpad=n.getObjectByName("touchpad"),e.touchpad=n.getObjectByName("touchpad"),e.trigger=n.getObjectByName("trigger"),Object.keys(e).forEach(function(a){s.setButtonColor(a,s.data.buttonColor)}),n.position.set(0,-.015,.04))},onAxisMoved:function(r){po(this,this.mapping.axes,r)},updateModel:function(r,e){var n;this.data.model&&(e.indexOf("touch")!==-1||(n=e==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(r,n)))},setButtonColor:function(r,e){var n=this.buttonMeshes;if(n)return r==="grip"?(n.grip.left.material.color.set(e),void n.grip.right.material.color.set(e)):void n[r].material.color.set(e)}}),Fr+"controllers/vive/focus-controller/focus-controller.gltf"),H2="htc-vive-focus",z2=(sn("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var r=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){Un(e.detail.id,"down",r)},this.onButtonUp=function(e){Un(e.detail.id,"up",r)},this.onButtonTouchStart=function(e){Un(e.detail.id,"touchstart",r)},this.onButtonTouchEnd=function(e){Un(e.detail.id,"touchend",r)},this.controllerPresent=!1,this.bindMethods()},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("model-loaded",this.onModelLoaded),r.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("model-loaded",this.onModelLoaded),r.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){Va(this,H2,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){this.el.setAttribute("tracked-controls",{idPrefix:H2}),this.data.model&&this.el.setAttribute("gltf-model",E5)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(r){var e,n=r.detail.model;r.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).trigger=n.getObjectByName("BumperKey"),e.triggerPressed=n.getObjectByName("BumperKey_Press"),e.triggerPressed&&(e.triggerPressed.visible=!1),e.touchpad=n.getObjectByName("TouchPad"),e.touchpadPressed=n.getObjectByName("TouchPad_Press"),e.trackpad=n.getObjectByName("TouchPad"),e.trackpadPressed=n.getObjectByName("TouchPad_Press"),e.trackpadPressed&&(e.trackpadPressed.visible=!1))},onButtonChanged:function(r){var e=this.mapping.buttons[r.detail.id];e&&this.el.emit(e+"changed",r.detail.state)},onAxisMoved:function(r){po(this,this.mapping.axes,r)},updateModel:function(r,e){this.data.model&&this.updateButtonModel(r,e)},updateButtonModel:function(r,e){var n=this.buttonMeshes,s=r+"Pressed";if(n&&n[r]&&n[s]){var a;switch(e){case"down":a=this.data.buttonHighlightColor;break;case"touchstart":a=this.data.buttonTouchedColor}a&&n[s].material.color.set(a),n[s].visible=!!a,n[r].visible=!a}}}),{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}),x5=Sb,V2=1e-5,_5=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];sn("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new R,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(r,e){var n=this.data,s=this.el,a=this.velocity;(a[n.adAxis]||a[n.wsAxis]||!function(c){var u;for(u in c)return!1;return!0}(this.keys))&&(e/=1e3,this.updateVelocity(e),(a[n.adAxis]||a[n.wsAxis])&&s.object3D.position.add(this.getMovementVector(e)))},update:function(r){r.adAxis!==this.data.adAxis&&(this.velocity[r.adAxis]=0),r.wsAxis!==this.data.wsAxis&&(this.velocity[r.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(r){var e,n,s,a,c,u=this.data,A=this.keys,m=this.velocity;if(n=u.adAxis,a=u.wsAxis,r>.2)return m[n]=0,void(m[a]=0);var v=Math.pow(1/this.easing,60*r);m[n]!==0&&(m[n]=m[n]*v),m[a]!==0&&(m[a]=m[a]*v),Math.abs(m[n])<V2&&(m[n]=0),Math.abs(m[a])<V2&&(m[a]=0),u.enabled&&(e=u.acceleration,u.adEnabled&&(s=u.adInverted?-1:1,(A.KeyA||A.ArrowLeft)&&(m[n]-=s*e*r),(A.KeyD||A.ArrowRight)&&(m[n]+=s*e*r)),u.wsEnabled&&(c=u.wsInverted?-1:1,(A.KeyW||A.ArrowUp)&&(m[a]-=c*e*r),(A.KeyS||A.ArrowDown)&&(m[a]+=c*e*r)))},getMovementVector:(Lp=new R(0,0,0),pC=new ii(0,0,0,"YXZ"),function(r){var e,n=this.el.getAttribute("rotation"),s=this.velocity;return Lp.copy(s),Lp.multiplyScalar(r),n&&(e=this.data.fly?n.x:0,pC.set(Tr.degToRad(e),Tr.degToRad(n.y),0),Lp.applyEuler(pC)),Lp}),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var r=Object.keys(this.keys),e=0;e<r.length;e++)delete this.keys[r[e]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(r){var e;x5(r)&&(e=r.code||z2[r.keyCode],_5.indexOf(e)!==-1&&(this.keys[e]=!0))},onKeyUp:function(r){var e;e=r.code||z2[r.keyCode],delete this.keys[e]}});var AC,jv,pm,Am=Bi("components:windows-motion-controls:debug"),Dp=Bi("components:windows-motion-controls:warn"),b5=Fr+"controllers/microsoft/",W2={left:"left.glb",right:"right.glb",default:"universal.glb"},j2="windows-mixed-reality",Pp=(sn("windows-motion-controls",{schema:{hand:{default:"right"},pair:{default:0},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var r=this,e=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(n){Un(n.detail.id,"down",r)},this.onButtonUp=function(n){Un(n.detail.id,"up",r)},this.onButtonTouchStart=function(n){Un(n.detail.id,"touchstart",r)},this.onButtonTouchEnd=function(n){Un(n.detail.id,"touchend",r)},this.onControllerConnected=function(){r.setModelVisibility(!0)},this.onControllerDisconnected=function(){r.setModelVisibility(!1)},this.controllerPresent=!1,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new R,direction:new R(0,0,-1),createdFromMesh:!1},e.addEventListener("controllerconnected",this.onControllerConnected),e.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var r=this.el;r.addEventListener("buttonchanged",this.onButtonChanged),r.addEventListener("buttondown",this.onButtonDown),r.addEventListener("buttonup",this.onButtonUp),r.addEventListener("touchstart",this.onButtonTouchStart),r.addEventListener("touchend",this.onButtonTouchEnd),r.addEventListener("axismove",this.onAxisMoved),r.addEventListener("model-error",this.onModelError),r.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var r=this.el;r.removeEventListener("buttonchanged",this.onButtonChanged),r.removeEventListener("buttondown",this.onButtonDown),r.removeEventListener("buttonup",this.onButtonUp),r.removeEventListener("touchstart",this.onButtonTouchStart),r.removeEventListener("touchend",this.onButtonTouchEnd),r.removeEventListener("axismove",this.onAxisMoved),r.removeEventListener("model-error",this.onModelError),r.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){Va(this,j2,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(this.data.model&&!this.rayOrigin.createdFromMesh){var r=this.createControllerModelUrl();this.loadModel(r)}else this.modelReady()},createControllerModelUrl:function(r){var e=this.data.hand;return b5+"default/"+(W2[e]||W2.default)},injectTrackedControls:function(){var r=this.data;this.el.setAttribute("tracked-controls",{idPrefix:j2,controller:r.pair,hand:r.hand}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(r){var e=this.createControllerModelUrl(!0);r.detail.src!==e?(Dp("Failed to load controller model for device, attempting to load default."),this.loadModel(e)):Dp("Failed to load default controller model.")},loadModel:function(r){this.el.setAttribute("gltf-model","url("+r+")")},onModelLoaded:function(r){var e,n,s,a,c=this.controllerModel=r.detail.model,u=this.loadedMeshInfo;if(r.target===this.el){if(Am("Processing model"),u.buttonMeshes={},u.axisMeshes={},c){for(e=0;e<this.mapping.buttons.length;e++)(n=this.mapping.buttonMeshNames[this.mapping.buttons[e]])?(s=c.getObjectByName(n))?(a={index:e,value:A(s,"VALUE"),pressed:A(s,"PRESSED"),unpressed:A(s,"UNPRESSED")}).value&&a.pressed&&a.unpressed?u.buttonMeshes[this.mapping.buttons[e]]=a:Dp("Missing button submesh under mesh with name: "+n+"(VALUE: "+!!a.value+", PRESSED: "+!!a.pressed+", UNPRESSED:"+!!a.unpressed+")"):Dp("Missing button mesh with name: "+n):Am("Skipping unknown button at index: "+e+" with mapped name: "+this.mapping.buttons[e]);for(e=0;e<this.mapping.axisMeshNames.length;e++)(n=this.mapping.axisMeshNames[e])?(s=c.getObjectByName(n))?(a={index:e,value:A(s,"VALUE"),min:A(s,"MIN"),max:A(s,"MAX")}).value&&a.min&&a.max?u.axisMeshes[e]=a:Dp("Missing axis submesh under mesh with name: "+n+"(VALUE: "+!!a.value+", MIN: "+!!a.min+", MAX:"+!!a.max+")"):Dp("Missing axis mesh with name: "+n):Am("Skipping unknown axis at index: "+e);this.calculateRayOriginFromMesh(c),this.setModelVisibility()}Am("Model load complete.")}function A(m,v){for(var E=0,C=m.children.length;E<C;E++){var M=m.children[E];if(M&&M.name===v)return M}}},calculateRayOriginFromMesh:function(){var r=new ai;return function(e){var n;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,n=e.getObjectByName(this.mapping.pointingPoseMeshName)){var s=e.parent;s&&(e.parent=null,e.updateMatrixWorld(!0),e.parent=s),n.getWorldPosition(this.rayOrigin.origin),n.getWorldQuaternion(r),this.rayOrigin.direction.applyQuaternion(r),s&&e.updateMatrixWorld(!0)}else Am("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var r=new ai;return function(e,n){var s=this.loadedMeshInfo.axisMeshes[e];if(s){var a=s.min,c=s.max,u=s.value,A=.5*n+.5;u.setRotationFromQuaternion(r.copy(a.quaternion).slerp(c.quaternion,A)),u.position.lerpVectors(a.position,c.position,A)}}}(),lerpButtonTransform:function(){var r=new ai;return function(e,n){var s=this.loadedMeshInfo.buttonMeshes[e];if(s){var a=s.unpressed,c=s.pressed,u=s.value;u.setRotationFromQuaternion(r.copy(a.quaternion).slerp(c.quaternion,n)),u.position.lerpVectors(a.position,c.position,n)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(r){var e=this.mapping.buttons[r.detail.id];e&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(e,r.detail.state.value),this.el.emit(e+"changed",r.detail.state))},onAxisMoved:function(r){var e=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var n=0;n<e;n++)this.lerpAxisTransform(n,r.detail.axis[n]||0);po(this,this.mapping.axes,r)},setModelVisibility:function(r){var e=this.el.getObject3D("mesh");this.controllerPresent&&(r=r!==void 0?r:this.modelVisible,this.modelVisible=r,e&&(e.visible=r))}}),AC=new ai,jv=new R,function(r,e,n){e.position.copy(r.transform.position),e.quaternion.copy(r.transform.orientation),jv.copy(n),AC.copy(r.transform.orientation),jv.applyQuaternion(AC),e.position.sub(jv)});function Os(r,e){this.renderer=r,this.xrHitTestSource=null,r.xr.addEventListener("sessionend",function(){this.xrHitTestSource=null}.bind(this)),r.xr.addEventListener("sessionstart",function(){this.sessionStart(e)}.bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(e)}function fC(r){console.warn(r.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}Pp.tempFakePose={transform:{orientation:new ai,position:new R}},Os.prototype.previousFrameAnchors=new Set,Os.prototype.anchorToObject3D=new Map,Os.prototype.sessionStart=function(r){this.session=this.renderer.xr.getSession(),"requestHitTestSource"in this.session?r.space?this.session.requestHitTestSource(r).then(function(e){this.xrHitTestSource=e}.bind(this)).catch(fC):r.profile&&this.session.requestHitTestSourceForTransientInput(r).then(function(e){this.xrHitTestSource=e,this.transient=!0}.bind(this)).catch(fC):fC({message:"No requestHitTestSource on the session."})},Os.prototype.anchorFromLastHitTestResult=function(r,e){var n=this.lastHitTest;if(n){var s={object3D:r,offset:e};Array.from(this.anchorToObject3D.entries()).forEach(function(a){var c=a[1].object3D,u=a[0];c===r&&(this.anchorToObject3D.delete(u),u.delete())}.bind(this)),n.createAnchor&&n.createAnchor().then(function(a){this.anchorToObject3D.set(a,s)}.bind(this)).catch(function(a){console.warn(a.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},Os.prototype.doHit=function(r){if(this.renderer.xr.isPresenting){var e,n,s=this.renderer.xr.getReferenceSpace(),a=r.getViewerPose(s);return this.xrHitTestSource&&a?this.transient?(e=r.getHitTestResultsForTransientInput(this.xrHitTestSource)).length>0&&(n=e[0].results).length>0&&(this.lastHitTest=n[0],n[0].getPose(s)):(e=r.getHitTestResults(this.xrHitTestSource)).length>0&&(this.lastHitTest=e[0],e[0].getPose(s)):void 0}},Os.updateAnchorPoses=function(r,e){var n=r.trackedAnchors||Os.prototype.previousFrameAnchors;Os.prototype.previousFrameAnchors.forEach(function(s){n.has(s)||Os.prototype.anchorToObject3D.delete(s)}),n.forEach(function(s){var a,c,u,A;try{if(a=r.getPose(s.anchorSpace,e)){if(!(c=Os.prototype.anchorToObject3D.get(s)))return;u=c.offset,A=c.object3D,Pp(a,A,u)}}catch(m){console.error("while updating anchor poses:",m)}}),Os.prototype.previousFrameAnchors=n},sn("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:"data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new mc,this.orthoCam.layers.set(21),this.textureTarget=new Us(512,512,{}),this.basicMaterial=new Jr({color:0,side:Dt}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new qx(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var r=this.el.getAttribute("webxr"),e=r.optionalFeatures;e.includes("hit-test")&&e.includes("anchors")||(e.push("hit-test"),e.push("anchors"),this.el.setAttribute("webxr",r)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",function(){this.hitTest=null}.bind(this)),this.el.sceneEl.renderer.xr.addEventListener("sessionstart",function(){if(this.el.is("ar-mode")){var n=this.el.sceneEl.renderer,s=this.session=n.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,pm||(pm=new Map),s.requestReferenceSpace("viewer").then(function(A){this.viewerHitTest=this.hitTest=new Os(n,{space:A}),this.el.emit("ar-hit-test-start")}.bind(this));var a=this;this.el.sceneEl.addEventListener("controllersupdated",function(){var A=this.xrSession&&this.xrSession.inputSources;if(A){for(var m=0;m<A.length;++m)if(A[m].targetRayMode==="tracked-pointer"){a.hitTest=new Os(n,{space:A[m].targetRaySpace}),pm.set(A[m],a.hitTest),a.viewerHitTest&&typeof a.viewerHitTest.cancel=="function"&&(a.viewerHitTest.cancel(),a.viewerHitTest=null);break}}});var c="generic-touchscreen",u=new Os(n,{profile:c});s.addEventListener("selectstart",function(A){if(this.data.enabled===!0){var m=A.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:m,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),m.profiles[0]===c?this.hitTest=u:(this.hitTest=pm.get(m)||new Os(n,{space:m.targetRaySpace}),pm.set(m,this.hitTest)))}}.bind(this)),s.addEventListener("selectend",function(A){if(this.hitTest&&this.data.enabled===!0){var m,v=A.inputSource;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(m=this.data.target.object3D)&&(Pp.tempFakePose.transform.position.copy(this.bboxMesh.position),Pp.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),Pp(Pp.tempFakePose,m,this.bboxOffset),m.visible=!0,this.hitTest.anchorFromLastHitTestResult(m,this.bboxOffset)),this.el.emit("ar-hit-test-select",{inputSource:v,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),this.hitTest=null)}else this.hitTest=null}.bind(this))}}.bind(this)),this.bboxOffset=new R,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.enabled===!1&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(21),this.data.target.object3D.traverse(function(r){r.layers.enable(21)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var r=new Ac(1,1),e=new Jr({transparent:!0,color:16777215});r.rotateX(-Math.PI/2),r.rotateY(-Math.PI/2),this.bbox=new te,this.bboxMesh=new Ti(r,e),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var r,e,n,s=this.el.sceneEl.renderer,a=s.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),e=s.getRenderTarget(),s.setRenderTarget(this.textureTarget),s.xr.enabled=!1,n=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,s.render(this.el.object3D,this.orthoCam),this.el.object3D.background=n,this.el.object3D.overrideMaterial=null,s.xr.enabled=a,s.setRenderTarget(e),s.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),r=this.context.getImageData(0,0,512,512);for(var c=0;c<262144;c++)r.data[4*c+3]!==0&&r.data[4*c+3]!==255&&(r.data[4*c+3]=128);this.context.putImageData(r,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var r,e,n=this.el.sceneEl.frame,s=this.el.sceneEl.renderer;n&&Os.updateAnchorPoses(n,s.xr.getReferenceSpace()),this.bboxNeedsUpdate&&(this.bboxNeedsUpdate=!1,this.data.target&&this.data.type!=="map"||(this.textureCache.has(this.data.src)?e=this.textureCache.get(this.data.src):(e=new H0().load(this.data.src),this.textureCache.set(this.data.src,e)),this.bboxMesh.material.map=e,this.bboxMesh.material.needsUpdate=!0),this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)),this.hitTest&&(r=this.hitTest.doHit(n))&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(r.transform.position),this.bboxMesh.quaternion.copy(r.transform.orientation))}}),sn("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var r=this.data,e=this.el.object3D;r.transparent?e.background=null:e.background=new Mt(r.color)},remove:function(){this.el.object3D.background=null}}),sn("debug",{schema:{default:!0},sceneOnly:!0});var q2="a-dialog-buttons-container",mC="a-dialog-button";function X2(r,e){var n,s,a,c;return(n=document.createElement("div")).classList.add("a-modal"),n.setAttribute(Ms,""),(s=document.createElement("div")).className="a-dialog",s.setAttribute(Ms,""),n.appendChild(s),(a=document.createElement("div")).classList.add("a-dialog-text-container"),s.appendChild(a),(c=document.createElement("div")).classList.add("a-dialog-text"),c.innerHTML=r,a.appendChild(c),s.appendChild(e),n}sn("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var r=this;this.data.enabled&&(window.isSecureContext||this.showHTTPAlert(),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission?(this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then(function(){r.el.emit("deviceorientationpermissiongranted"),r.permissionGranted=!0}).catch(function(){var e,n,s,a,c,u,A,m;r.devicePermissionDialogEl=(e=r.data.denyButtonText,n=r.data.allowButtonText,s=r.data.deviceMotionMessage,a=r.onDeviceMotionDialogAllowClicked,c=r.onDeviceMotionDialogDenyClicked,(u=document.createElement("div")).classList.add(q2),(A=document.createElement("button")).classList.add(mC,"a-dialog-deny-button"),A.setAttribute(Ms,""),A.innerHTML=e,u.appendChild(A),(m=document.createElement("button")).classList.add(mC,"a-dialog-allow-button"),m.setAttribute(Ms,""),m.innerHTML=n,u.appendChild(m),m.addEventListener("click",function(v){v.stopPropagation(),a()}),A.addEventListener("click",function(v){v.stopPropagation(),c()}),X2(s,u)),r.el.appendChild(r.devicePermissionDialogEl)})):this.permissionGranted=!0)},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var r,e,n,s,a,c=this,u=(r=c.data.cancelButtonText,e=c.data.httpsMessage,n=function(){c.el.removeChild(u)},(s=document.createElement("div")).classList.add(q2),(a=document.createElement("button")).classList.add(mC,"a-dialog-ok-button"),a.setAttribute(Ms,""),a.innerHTML=r,s.appendChild(a),a.addEventListener("click",function(A){A.stopPropagation(),n()}),X2(e,s));this.el.appendChild(u)},onDeviceMotionDialogAllowClicked:function(){var r=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(e){e==="granted"?(r.el.emit("deviceorientationpermissiongranted"),r.permissionGranted=!0):r.el.emit("deviceorientationpermissionrejected"),r.remove()}).catch(console.error)}}),sn("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var r=this.el,e=r.querySelector(".a-enter-vr");this.data===!0?(e&&e.classList.add("embedded"),r.removeFullScreenStyles()):(e&&e.classList.remove("embedded"),r.addFullScreenStyles())}});var C5="https://unpkg.com/aframe-inspector@"+function(r){var e=r.split(".");return e[2]="x",e.join(".")}(KB)+"/dist/aframe-inspector.min.js";sn("inspector",{schema:{url:{default:C5}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var r;this.firstPlay&&(r=nm("inspector"))!=="false"&&r&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(r){r.keyCode===73&&(r.ctrlKey&&r.altKey||r.getModifierState("AltGraph"))&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(r){r.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(r){var e,n=this;AFRAME.INSPECTOR||AFRAME.inspectorInjected?AFRAME.INSPECTOR.open(r):(this.showLoader(),(e=document.createElement("script")).src=this.data.url,e.setAttribute("data-name","aframe-inspector"),e.setAttribute(Ms,""),e.onload=function(){AFRAME.INSPECTOR.open(r),n.hideLoader(),n.removeEventListeners()},e.onerror=function(){n.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(e),AFRAME.inspectorInjected=!0)},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}}),sn("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var r=this.data,e=this.el,n=this.el.object3D.fog;n&&r.type===n.name?Object.keys(this.schema).forEach(function(s){var a=r[s];s==="color"&&(a=new Mt(a)),n[s]=a}):e.object3D.fog=function(s){var a;return(a=s.type==="exponential"?new Ef(s.color,s.density):new xf(s.color,s.near,s.far)).name=s.type,a}(r)},remove:function(){var r=this.el;this.el.object3D.fog&&(r.object3D.fog=null)}}),sn("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(r){var e=this.el;Sb(r)&&(this.data.enterVR&&r.keyCode===70&&e.enterVR(),this.data.exitVR&&r.keyCode===27&&e.exitVR())}});var fm=Bi("components:pool:warn");sn("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var r;for(this.availableEls=[],this.usedEls=[],this.data.mixin||fm("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||fm("Container "+this.data.container+" not found.")),this.container=this.container||this.el,r=0;r<this.data.size;++r)this.createEntity()},update:function(r){var e=this.data;r.mixin===e.mixin&&r.size===e.size||this.initPool()},createEntity:function(){var r;(r=document.createElement("a-entity")).play=this.wrapPlay(r.play),r.setAttribute("mixin",this.data.mixin),r.object3D.visible=!1,r.pause(),this.container.appendChild(r),this.availableEls.push(r);var e=this.usedEls;r.addEventListener("loaded",function(){e.indexOf(r)===-1&&(r.object3DParent=r.object3D.parent,r.object3D.parent.remove(r.object3D))})},wrapPlay:function(r){var e=this.usedEls;return function(){e.indexOf(this)!==-1&&r.call(this)}},requestEntity:function(){var r;if(this.availableEls.length===0){if(this.data.dynamic===!1)return void fm("Requested entity from empty pool: "+this.attrName);fm("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return r=this.availableEls.shift(),this.usedEls.push(r),r.object3DParent&&(r.object3DParent.add(r.object3D),this.updateRaycasters()),r.object3D.visible=!0,r},returnEntity:function(r){var e=this.usedEls.indexOf(r);if(e!==-1)return this.usedEls.splice(e,1),this.availableEls.push(r),r.object3DParent=r.object3D.parent,r.object3D.parent.remove(r.object3D),this.updateRaycasters(),r.object3D.visible=!1,r.pause(),r;fm("The returned entity was not previously pooled from "+this.attrName)},updateRaycasters:function(){document.querySelectorAll("[raycaster]").forEach(function(r){r.components.raycaster.setDirty()})}}),sn("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var r=this.el.getAttribute("webxr"),e=r.requiredFeatures;e.indexOf("mesh-detection")===-1&&(e.push("mesh-detection"),this.el.setAttribute("webxr",r)),e.indexOf("plane-detection")===-1&&(e.push("plane-detection"),this.el.setAttribute("webxr",r)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var r,e,n,s=this.data,a=this.el,c=this.meshEntities,u=!1,A=[],m=this.data.filterLabels;r=(n=a.frame).detectedMeshes,e=n.detectedPlanes;for(var v=0;v<c.length;v++)c[v].present=!1;if(s.meshesEnabled){for(var E of r.values())if(!m.length||m.indexOf(E.semanticLabel)!==-1){for(v=0;v<c.length;v++)if(E===c[v].mesh){u=!0,c[v].present=!0,c[v].lastChangedTime<E.lastChangedTime&&this.updateMeshGeometry(c[v].el,E),c[v].lastChangedTime=E.lastChangedTime;break}u||A.push(E),u=!1}}if(s.planesEnabled){for(E of e.values())if(!m.length||m.indexOf(E.semanticLabel)!==-1){for(v=0;v<c.length;v++)if(E===c[v].mesh){u=!0,c[v].present=!0,c[v].lastChangedTime<E.lastChangedTime&&this.updateMeshGeometry(c[v].el,E),c[v].lastChangedTime=E.lastChangedTime;break}u||A.push(E),u=!1}}this.deleteMeshes(),this.createNewMeshes(A)},updateMeshes:function(){var r=new Qt;return function(){for(var e,n,s,a=this.el,c=a.frame,u=this.meshEntities,A=a.renderer.xr.getReferenceSpace(),m=0;m<u.length;m++)s=u[m].mesh.meshSpace||u[m].mesh.planeSpace,e=c.getPose(s,A),(n=u[m].el).hasLoaded&&(r.fromArray(e.transform.matrix),r.decompose(n.object3D.position,n.object3D.quaternion,n.object3D.scale))}}(),deleteMeshes:function(){for(var r=this.meshEntities,e=[],n=0;n<r.length;n++)r[n].present?e.push(r[n]):this.el.removeChild(r[n]);this.meshEntities=e},createNewMeshes:function(r){for(var e,n=0;n<r.length;n++)e=document.createElement("a-entity"),this.meshEntities.push({mesh:r[n],el:e}),e.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(e)},initMeshGeometry:function(r){var e,n,s;if(r instanceof XRPlane){n=new mh,s=r.polygon;for(var a=0;a<s.length;++a)a===0?n.moveTo(s[a].x,s[a].z):n.lineTo(s[a].x,s[a].z);return(e=new Hf(n)).rotateX(Math.PI/2),e}return(e=new vn).setAttribute("position",new qn(r.vertices,3)),e.setIndex(new qn(r.indices,1)),e},initWorldMeshEntity:function(r){for(var e,n,s,a=r.target,c=this.meshEntities,u=0;u<c.length;u++)if(c[u].el===a){s=c[u];break}e=this.initMeshGeometry(s.mesh),n=new Ti(e,new Jr({color:16777215*Math.random(),side:Dt})),a.setObject3D("mesh",n),s.mesh instanceof XRPlane&&this.data.planeMixin?a.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&a.setAttribute("mixin",this.data.meshMixin),a.setAttribute("data-world-mesh",s.mesh.semanticLabel)},updateMeshGeometry:function(r,e){var n=r.getObject3D("mesh");n.geometry.dispose(),n.geometry=this.initMeshGeometry(e)}}),sn("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var r=this;this.cubeRenderTarget=new yf(16),this.cubeCamera=new c0(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new yf(16).texture,this.needsVREnvironmentUpdate=!0;var e=this.el.getAttribute("webxr"),n=e.optionalFeatures;n.includes("light-estimation")||(n.push("light-estimation"),this.el.setAttribute("webxr",e)),this.el.addEventListener("enter-vr",function(){r.el.is("ar-mode")&&r.el.renderer.xr.getSession().requestLightProbe&&r.startLightProbe()}),this.el.addEventListener("exit-vr",function(){r.xrLightProbe&&r.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var r=this.el.renderer,e=r.xr.getSession(),n=this,s=r.getContext();if(!this.probeLight){var a=document.createElement("a-light");a.setAttribute("type","probe"),a.setAttribute("intensity",0),this.el.appendChild(a),this.probeLight=a}switch(e.preferredReflectionFormat){case"srgba8":s.getExtension("EXT_sRGB");break;case"rgba16f":s.getExtension("OES_texture_half_float")}this.glBinding=new XRWebGLBinding(e,s),s.getExtension("EXT_sRGB"),s.getExtension("OES_texture_half_float"),e.requestLightProbe().then(function(c){n.xrLightProbe=c,c.addEventListener("reflectionchange",n.updateXRCubeMap.bind(n))}).catch(function(c){console.warn("Lighting estimation not supported: "+c.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var r=this.el.renderer,e=this.glBinding.getReflectionCubeMap(this.xrLightProbe);e&&(r.properties.get(this.lightingEstimationTexture).__webglTexture=e,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture)},tick:function(){var r=this.el.object3D,e=this.el.renderer,n=this.el.frame;if(n&&this.xrLightProbe){var s=n.getLightEstimate(this.xrLightProbe);s&&function(a,c,u,A){var m=Math.max(a.primaryLightIntensity.x,Math.max(a.primaryLightIntensity.y,a.primaryLightIntensity.z));c.sh.fromArray(a.sphericalHarmonicsCoefficients),c.intensity=3.14,u&&(u.color.setRGB(a.primaryLightIntensity.x/m,a.primaryLightIntensity.y/m,a.primaryLightIntensity.z/m),u.intensity=m,A.copy(a.primaryLightDirection))}(s,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(r.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(e,r),r.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&n&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}});var w5=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),M5=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`),S5=(sn("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var r=this.el;if(!this.canvas){var e=r.renderer.getContext();e&&(this.cubeMapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new G0({uniforms:{map:{type:"t",value:null}},vertexShader:w5,fragmentShader:M5,side:Dt}),this.quad=new Ti(new Ac(1,1),this.material),this.quad.visible=!1,this.camera=new mc(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),r.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(r,e){return new Us(r,e,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:bi,magFilter:bi,wrapS:Dr,wrapT:Dr,format:nr,type:Er})},resize:function(r,e){this.quad.scale.set(r,e,1),this.camera.left=-1*r/2,this.camera.right=r/2,this.camera.top=e/2,this.camera.bottom=-1*e/2,this.camera.updateProjectionMatrix(),this.canvas.width=r,this.canvas.height=e},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(r){var e=r.keyCode===83&&r.ctrlKey&&r.altKey;if(this.data&&e){var n=r.shiftKey?"equirectangular":"perspective";this.capture(n)}},setCapture:function(r){var e,n,s,a,c=this.el;return r==="perspective"?(this.quad.visible=!1,n=this.data.camera&&this.data.camera.components.camera.camera||c.camera,e={width:this.data.width,height:this.data.height}):(n=this.camera,a=new yf(Math.min(this.cubeMapSize,2048),{format:iu,generateMipmaps:!0,minFilter:hs,colorSpace:si}),s=new c0(c.camera.near,c.camera.far,a),c.camera.getWorldPosition(s.position),c.camera.getWorldQuaternion(s.quaternion),s.update(c.renderer,c.object3D),this.quad.material.uniforms.map.value=s.renderTarget.texture,e={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:n,size:e,projection:r}},capture:function(r){var e,n=this.el.renderer.xr.enabled,s=this.el.renderer;this.setup(),s.xr.enabled=!1,e=this.setCapture(r),this.renderCapture(e.camera,e.size,e.projection),this.saveCapture(),s.xr.enabled=n},getCanvas:function(r){var e=this.el.renderer.xr.enabled,n=this.el.renderer;this.setup();var s=this.setCapture(r);return n.xr.enabled=!1,this.renderCapture(s.camera,s.size,s.projection),n.xr.enabled=e,this.canvas},renderCapture:function(r,e,n){var s,a,c,u=this.el.renderer.autoClear,A=this.el,m=A.renderer;a=this.getRenderTarget(e.width,e.height),c=new Uint8Array(4*e.width*e.height),this.resize(e.width,e.height),m.autoClear=!0,m.clear(),m.setRenderTarget(a),m.render(A.object3D,r),m.autoClear=u,m.readRenderTargetPixels(a,0,0,e.width,e.height,c),m.setRenderTarget(null),n==="perspective"&&(c=this.flipPixelsVertically(c,e.width,e.height)),s=new ImageData(new Uint8ClampedArray(c),e.width,e.height),this.quad.visible=!1,this.ctx.putImageData(s,0,0)},flipPixelsVertically:function(r,e,n){for(var s=r.slice(0),a=0;a<e;++a)for(var c=0;c<n;++c)s[4*a+c*e*4]=r[4*a+(n-c)*e*4],s[4*a+1+c*e*4]=r[4*a+1+(n-c)*e*4],s[4*a+2+c*e*4]=r[4*a+2+(n-c)*e*4],s[4*a+3+c*e*4]=r[4*a+3+(n-c)*e*4];return s},saveCapture:function(){this.canvas.toBlob(function(r){var e="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",n=document.createElement("a"),s=URL.createObjectURL(r);n.href=s,n.setAttribute("download",e),n.innerHTML="downloading...",n.style.display="none",document.body.appendChild(n),setTimeout(function(){n.click(),document.body.removeChild(n)},1)},"image/png")}}),i(282)),I5=i.n(S5),T5=(i(3729),i(8132),window.aframeStats),Y2="a-hidden",B5=window.threeStats;sn("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var r=this.el;nm("stats")!=="false"&&(this.stats=function(e){var n=new B5(e.renderer),s=new T5(e),a=e.isMobile?[]:[n,s];return new(I5())({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:a})}(r),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),r.addEventListener("enter-vr",this.hideBound),r.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var r=this.stats;r&&(r("rAF").tick(),r("FPS").frame(),r().update())},hide:function(){this.statsEl.classList.add(Y2)},show:function(){this.statsEl.classList.remove(Y2)}});var nd="a-hidden";function K2(r){r.addEventListener("touchstart",function(){r.classList.remove("resethover")},{passive:!0}),r.addEventListener("touchend",function(){r.classList.add("resethover")},{passive:!0})}sn("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var r=this,e=this.el;nm("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),e.addEventListener("enter-vr",this.updateEnterInterfaces),e.addEventListener("exit-vr",this.updateEnterInterfaces),e.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(n){n.data.type==="loaderReady"&&(r.insideLoader=!0,r.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var r,e,n,s=this.data,a=this.el;if(!s.enabled||this.insideLoader||nm("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(this.enterVREl||!s.enterVREnabled||s.XRMode!=="xr"&&s.XRMode!=="vr"||(s.enterVRButton?(this.enterVREl=document.querySelector(s.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=(r=this.onEnterVRButtonClick,(n=document.createElement("div")).classList.add("a-enter-vr"),n.setAttribute(Ms,""),(e=document.createElement("button")).className="a-enter-vr-button",e.setAttribute("title","Enter VR mode with a headset or fullscreen without"),e.setAttribute(Ms,""),xh()&&K2(e),n.appendChild(e),e.addEventListener("click",function(c){r(),c.stopPropagation()}),n),a.appendChild(this.enterVREl))),this.enterAREl||!s.enterAREnabled||s.XRMode!=="xr"&&s.XRMode!=="ar"||(s.enterARButton?(this.enterAREl=document.querySelector(s.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=function(c,u){var A,m;return(m=document.createElement("div")).classList.add("a-enter-ar"),u&&m.classList.add("xr"),m.setAttribute(Ms,""),(A=document.createElement("button")).className="a-enter-ar-button",A.setAttribute("title","Enter AR mode with a headset or handheld device."),A.setAttribute(Ms,""),xh()&&K2(A),m.appendChild(A),A.addEventListener("click",function(v){c(),v.stopPropagation()}),m}(this.onEnterARButtonClick,s.XRMode==="xr"),a.appendChild(this.enterAREl))),this.orientationModalEl=function(c){var u=document.createElement("div");u.className="a-orientation-modal",u.classList.add(nd),u.setAttribute(Ms,"");var A=document.createElement("button");return A.setAttribute(Ms,""),A.innerHTML="Exit VR",A.addEventListener("click",c),u.appendChild(A),u}(this.onModalClick),a.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(r){r&&r.parentNode&&r.parentNode.removeChild(r)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var r=this.el;this.enterVREl&&(r.is("vr-mode")||(r.isMobile||cb())&&!ob()?this.enterVREl.classList.add(nd):(ob()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(nd),r.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var r=this.el;this.enterAREl&&(r.is("vr-mode")||!ab()?this.enterAREl.classList.add(nd):(this.enterAREl.classList.remove(nd),r.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var r=this.el,e=this.orientationModalEl;e&&r.isMobile&&(!cB()&&r.is("vr-mode")?e.classList.remove(nd):e.classList.add(nd))}}),ta("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(r){this.geometry=new vl(r.width,r.height,r.depth,r.segmentsWidth,r.segmentsHeight,r.segmentsDepth)}});var J2=Tr.degToRad;ta("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(r){this.geometry=new Uf(r.radius,r.segments,J2(r.thetaStart),J2(r.thetaLength))}});var $2=Tr.degToRad;ta("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(r){this.geometry=new Ah(r.radiusTop,r.radiusBottom,r.height,r.segmentsRadial,r.segmentsHeight,r.openEnded,$2(r.thetaStart),$2(r.thetaLength))}});var Z2=Tr.degToRad;ta("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(r){this.geometry=new Ah(r.radius,r.radius,r.height,r.segmentsRadial,r.segmentsHeight,r.openEnded,Z2(r.thetaStart),Z2(r.thetaLength))}}),ta("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(r){this.geometry=new Nf(r.radius,r.detail)}}),ta("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(r){this.geometry=new Qf(r.radius,r.detail)}}),ta("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(r){this.geometry=new Ep(r.radius,r.detail)}}),ta("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(r){this.geometry=new Ac(r.width,r.height,r.segmentsWidth,r.segmentsHeight)}});var eR=Tr.degToRad;ta("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(r){this.geometry=new Gf(r.radiusInner,r.radiusOuter,r.segmentsTheta,r.segmentsPhi,eR(r.thetaStart),eR(r.thetaLength))}});var qv=Tr.degToRad;ta("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(r){this.geometry=new Bu(r.radius,r.segmentsWidth,r.segmentsHeight,qv(r.phiStart),qv(r.phiLength),qv(r.thetaStart),qv(r.thetaLength))}}),ta("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(r){this.geometry=new zf(r.radius,r.detail)}});var R5=Tr.degToRad;ta("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(r){this.geometry=new Vf(r.radius,2*r.radiusTubular,r.segmentsRadial,r.segmentsTubular,R5(r.arc))}}),ta("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(r){this.geometry=new Wf(r.radius,2*r.radiusTubular,r.segmentsTubular,r.segmentsRadial,r.p,r.q)}});var Xv=new ai,L5=new R(0,0,1),mm=new ct,tR=new ct,Yv=new ct;function nR(r,e){return e.color.set(r.color),e.fog=r.fog,e.wireframe=r.wireframe,e.toneMapped=r.toneMapped,e.wireframeLinewidth=r.wireframeLinewidth,e}function iR(r,e){return e.color.set(r.color),e.emissive.set(r.emissive),e.emissiveIntensity=r.emissiveIntensity,e.fog=r.fog,e.metalness=r.metalness,e.roughness=r.roughness,e.wireframe=r.wireframe,e.wireframeLinewidth=r.wireframeLinewidth,r.normalMap&&(e.normalScale=r.normalScale),r.ambientOcclusionMap&&(e.aoMapIntensity=r.ambientOcclusionMapIntensity),r.displacementMap&&(e.displacementScale=r.displacementScale,e.displacementBias=r.displacementBias),e}function rR(r,e){switch(e.color.set(r.color),e.specular.set(r.specular),e.emissive.set(r.emissive),e.emissiveIntensity=r.emissiveIntensity,e.fog=r.fog,e.transparent=r.transparent,e.wireframe=r.wireframe,e.wireframeLinewidth=r.wireframeLinewidth,e.shininess=r.shininess,e.flatShading=r.flatShading,e.wireframe=r.wireframe,e.wireframeLinewidth=r.wireframeLinewidth,e.reflectivity=r.reflectivity,e.refractionRatio=r.refractionRatio,r.combine){case"mix":e.combine=Ls;break;case"multiply":e.combine=bs;break;case"add":e.combine=Yr}return r.normalMap&&(e.normalScale=r.normalScale),r.ambientOcclusionMap&&(e.aoMapIntensity=r.ambientOcclusionMapIntensity),r.bumpMap&&(e.bumpScale=r.bumpMapScale),r.displacementMap&&(e.displacementScale=r.displacementScale,e.displacementBias=r.displacementBias),e}ta("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(r){var e,n,s,a,c,u,A,m,v;(s=new Js).a.set(r.vertexA.x,r.vertexA.y,r.vertexA.z),s.b.set(r.vertexB.x,r.vertexB.y,r.vertexB.z),s.c.set(r.vertexC.x,r.vertexC.y,r.vertexC.z),n=s.getNormal(new R),Xv.setFromUnitVectors(n,L5),a=s.a.clone().applyQuaternion(Xv),c=s.b.clone().applyQuaternion(Xv),u=s.c.clone().applyQuaternion(Xv),mm.set(Math.min(a.x,c.x,u.x),Math.min(a.y,c.y,u.y)),tR.set(Math.max(a.x,c.x,u.x),Math.max(a.y,c.y,u.y)),Yv.set(0,0).subVectors(tR,mm),a=new ct().subVectors(a,mm).divide(Yv),c=new ct().subVectors(c,mm).divide(Yv),u=new ct().subVectors(u,mm).divide(Yv),e=this.geometry=new vn,A=[s.a.x,s.a.y,s.a.z,s.b.x,s.b.y,s.b.z,s.c.x,s.c.y,s.c.z],m=[n.x,n.y,n.z,n.x,n.y,n.z,n.x,n.y,n.z],v=[a.x,a.y,c.x,c.y,u.x,u.y],e.setAttribute("position",new Wt(A,3)),e.setAttribute("normal",new Wt(m,3)),e.setAttribute("uv",new Wt(v,2))}}),Ch("flat",{schema:{color:{type:"color"},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(r){this.materialData={color:new Mt},nR(r,this.materialData),this.material=new Jr(this.materialData)},update:function(r){this.updateMaterial(r),xv(this,r)},updateMaterial:function(r){var e;for(e in nR(r,this.materialData),this.materialData)this.material[e]=this.materialData[e]}}),Ch("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(r){this.materialData={color:new Mt,emissive:new Mt},iR(r,this.materialData),this.material=new gh(this.materialData)},update:function(r){this.updateMaterial(r),xv(this,r),_l("normal",this,r),_l("displacement",this,r),_l("ambientOcclusion",this,r),_l("metalness",this,r),_l("roughness",this,r),Eb(this,r)},updateMaterial:function(r){var e,n=this.material;for(e in iR(r,this.materialData),this.materialData)n[e]=this.materialData[e]}}),Ch("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(r){this.materialData={color:new Mt,specular:new Mt,emissive:new Mt},rR(r,this.materialData),this.material=new jf(this.materialData);var e=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||e.object3D.environment},set:function(n){this._envMap=n}})},update:function(r){this.updateMaterial(r),xv(this,r),_l("normal",this,r),_l("displacement",this,r),_l("ambientOcclusion",this,r),_l("bump",this,r),Eb(this,r)},updateMaterial:function(r){var e;for(e in rR(r,this.materialData),this.materialData)this.material[e]=this.materialData[e]}}),Ch("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec2 uv = vUV;","  vec4 texColor = texture(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture(map, box.xy).a, width)","      + contour(texture(map, box.zw).a, width)","      + contour(texture(map, box.xw).a, width)","      + contour(texture(map, box.zy).a, width)","    )) / 3.0;","  }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color, opacity * alpha);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`),init:function(){return this.uniforms=this.initUniforms(),lp&&(this.uniforms=lp.merge([Ft.fog,this.uniforms])),this.material=new Ca({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}}),Ch("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`),init:function(){return this.uniforms=this.initUniforms(),lp&&(this.uniforms=lp.merge([Ft.fog,this.uniforms])),this.material=new Ca({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}}),Ch("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(r){this.material=new o_},update:function(r){this.material.opacity=r.opacity,this.material.alphaToCoverage=r.alphaToCoverage,this.material.transparent=r.transparent}});var sR="data-aframe-default-camera";function aR(r){var e=r.primitive,n=bh[e]&&bh[e].Geometry,s=new n;if(!n)throw new Error("Unknown geometry `"+e+"`");return s.init(r),s.geometry}Ao("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var r,e,n=this.sceneEl,s=this;if(!n.camera||n.camera.el.getAttribute("camera").spectator)if((r=n.querySelectorAll("a-camera, :not(a-mixin)[camera]")).length)for(this.numUserCameras=r.length,e=0;e<r.length;e++)r[e].addEventListener("object3dset",function(a){a.detail.type==="camera"&&s.checkUserCamera(this)}),r[e].isANode?r[e].load():r[e].addEventListener("nodeready",function(){this.load()});else this.createDefaultCamera();else n.emit("cameraready",{cameraEl:n.camera.el})},checkUserCamera:function(r){var e,n=this.el.sceneEl;this.numUserCamerasChecked++,this.initialCameraFound||((e=r.getAttribute("camera")).active&&!e.spectator?(this.initialCameraFound=!0,n.camera=r.getObject3D("camera"),n.emit("cameraready",{cameraEl:r})):this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera())},createDefaultCamera:function(){var r,e=this.sceneEl;(r=document.createElement("a-entity")).setAttribute("camera",{active:!0}),r.setAttribute("position",{x:0,y:1.6,z:0}),r.setAttribute("wasd-controls",""),r.setAttribute("look-controls",""),r.setAttribute(Ms,""),r.addEventListener("object3dset",function(n){n.detail.type==="camera"&&(e.camera=n.detail.object,e.emit("cameraready",{cameraEl:r}))}),e.appendChild(r)},disableActiveCamera:function(){var r;(r=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"))[r.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(r){var e,n,s,a,c=this.activeCameraEl,u=this.sceneEl;if((a=r.getObject3D("camera"))&&r!==this.activeCameraEl){var A=u.querySelector("["+sR+"]");for(r!==(A&&A.querySelector(":not(a-mixin)[camera]"))&&function(m){var v;m.camera&&(v=m.querySelector("["+sR+"]"))&&m.removeChild(v)}(u),this.activeCameraEl=r,this.activeCameraEl.play(),u.camera=a,c&&c.setAttribute("camera","active",!1),n=u.querySelectorAll(":not(a-mixin)[camera]"),s=0;s<n.length;s++)(e=n[s]).isEntity&&r!==e&&(e.setAttribute("camera","active",!1),e.pause());u.emit("camera-set-active",{cameraEl:r})}},setSpectatorCamera:function(r){var e,n=this.spectatorCameraEl,s=this.sceneEl;r.getObject3D("camera")&&r!==this.spectatorCameraEl&&(n&&n.setAttribute("camera","spectator",!1),e=this.spectatorCameraEl=r,s.addEventListener("enter-vr",this.wrapRender),s.addEventListener("exit-vr",this.unwrapRender),e.setAttribute("camera","active",!1),e.play(),s.emit("camera-set-spectator",{cameraEl:r}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){this.spectatorCameraEl&&!this.originalRender&&(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(r,e){var n,s,a=this.sceneEl;n=a.renderer.xr.enabled,this.originalRender.call(a.renderer,r,e),this.spectatorCameraEl&&!a.isMobile&&n&&(s=this.spectatorCameraEl.components.camera.camera,a.renderer.xr.enabled=!1,this.originalRender.call(a.renderer,r,s),a.renderer.xr.enabled=n)}}),Ao("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(r){var e,n,s=this.cache;return r.skipCache?aR(r):(e=s[n=this.hash(r)],function(a,c){a[c]=a[c]===void 0?1:a[c]+1}(this.cacheCount,n),e||(e=aR(r),s[n]=e,e))},unuseGeometry:function(r){var e,n=this.cache,s=this.cacheCount;r.skipCache||n[e=this.hash(r)]&&(function(a,c){a[c]--}(s,e),s[e]>0||(n[e].dispose(),delete n[e],delete s[e]))},hash:function(r){return JSON.stringify(r)}}),Ao("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.7/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var r=this.data.dracoDecoderPath,e=this.data.basisTranscoderPath,n=this.data.meshoptDecoderPath;!this.dracoLoader&&r&&(this.dracoLoader=new vT,this.dracoLoader.setDecoderPath(r)),!this.ktx2Loader&&e&&(this.ktx2Loader=new za,this.ktx2Loader.setTranscoderPath(e).detectSupport(this.el.renderer)),!this.meshoptDecoder&&n&&(this.meshoptDecoder=function(s){return new Promise(function(a,c){var u=document.createElement("script");document.body.appendChild(u),u.onload=a,u.onerror=c,u.async=!0,u.src=s})}(n).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}});var Kv="data-aframe-default-light",oR=(Ao("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(r){r.hasAttribute(Kv)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var r,e=this.sceneEl;if(this.defaultLights){r=document.querySelectorAll("["+Kv+"]");for(var n=0;n<r.length;n++)e.removeChild(r[n]);this.defaultLights=!1}},setupDefaultLights:function(){var r,e,n=this.sceneEl;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||((r=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),r.setAttribute(Kv,""),r.setAttribute(Ms,""),n.appendChild(r),(e=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:1.884,castShadow:!0}),e.setAttribute("position",{x:-.5,y:1,z:1}),e.setAttribute(Kv,""),e.setAttribute(Ms,""),n.appendChild(e),this.defaultLights=!0)}}),Bi),D5=oR("components:texture:error"),lR=oR("components:texture:warn"),P5=new Fu;Ao("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(r,e,n){this.loadTextureSource(r,function(s){var a=_b(s);yv(a,e),n(a)})},loadTextureSource:function(r,e){var n=this,s=this.sourceCache,a=this.hash(r);function c(u){s[a]=Promise.resolve(u),s[a].then(e)}s[a]?s[a].then(e):r.tagName!=="CANVAS"?c(new Promise(function(u,A){vv(r,function(m){n.loadImage(m,u)},function(m){n.loadVideo(m,u)})})):c(new ka(r))},loadCubeMapTexture:function(r,e){var n=this,s=0,a=new hp;function c(A){n.loadTextureSource(r[A],function(m){a.images[A]=m.data,++s==6&&(a.needsUpdate=!0,e(a))})}if(a.colorSpace=si,r.length===6)for(var u=0;u<r.length;u++)c(u);else lR("Cube map texture requires exactly 6 sources, got only %s sources",r.length)},loadImage:function(r,e){e(typeof r=="string"?function(n){return new Promise(function(s,a){P5.load(n,function(c){s(new ka(c))},function(){},function(c){D5("`$s` could not be fetched (Error code: %s; Response: %s)",c.status,c.statusText)})})}(r):new ka(r))},loadVideo:function(r,e){var n;typeof r!="string"&&function(s){s.autoplay=s.hasAttribute("autoplay")&&s.getAttribute("autoplay")!=="false",s.controls=s.hasAttribute("controls")&&s.getAttribute("controls")!=="false",s.getAttribute("loop")==="false"&&s.removeAttribute("loop"),s.getAttribute("preload")==="false"&&(s.preload="none"),s.crossOrigin=s.crossOrigin||"anonymous",s.setAttribute("playsinline",""),s.setAttribute("webkit-playsinline","")}(n=r),n=n||function(s){var a=document.createElement("video");return a.setAttribute("playsinline",""),a.setAttribute("webkit-playsinline",""),a.autoplay=!0,a.loop=!0,a.crossOrigin="anonymous",a.addEventListener("error",function(){lR("`%s` is not a valid video",s)},!0),a.src=s,a}(r),e(new ka(n))},hash:function(r){return r.tagName&&(r.id||r.src)||r},registerMaterial:function(r){this.materials[r.uuid]=r},unregisterMaterial:function(r){delete this.materials[r.uuid]}}),Ao("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(r){this.colliderEls.push(r),this.data.showColliders?r.components["obb-collider"].showCollider():r.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(r){var e=this.colliderEls,n=e.indexOf(r);r.components["obb-collider"].hideCollider(),n>-1&&e.splice(n,1),e.length===0&&(this.tick=void 0)},registerCollision:function(r,e){var n=this.collisions,s=!1,a=r.obb,c=e.obb,u=r.renderColliderMesh,A=e.renderColliderMesh;u&&u.material.color.set(16711680),A&&A.material.color.set(16711680);for(var m=0;m<n.length;m++)if(n[m].componentA.obb===a&&n[m].componentB.obb===c||n[m].componentA.obb===c&&n[m].componentB.obb===a){s=!0,n[m].detected=!0;break}s||(n.push({componentA:r,componentB:e,detected:!0}),r.el.emit("obbcollisionstarted",{trackedObject3D:r.trackedObject3D,withEl:e.el}),e.el.emit("obbcollisionstarted",{trackedObject3D:e.trackedObject3D,withEl:r.el}))},resetCollisions:function(){for(var r=this.collisions,e=0;e<r.length;e++)r[e].detected=!1},clearCollisions:function(){for(var r,e,n,s,a=this.collisions,c=[],u=0;u<a.length;u++)a[u].detected?c.push(a[u]):(r=a[u].componentA,e=a[u].componentB,n=r.renderColliderMesh,s=e.renderColliderMesh,n&&n.material.color.set(65280),r.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:e.el}),s&&s.material.color.set(65280),e.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:r.el}));this.collisions=c},detectCollisions:function(){var r,e,n,s,a=this.colliderEls;if(!(a.length<2)){this.resetCollisions();for(var c=0;c<a.length;c++)if(n=a[c].components["obb-collider"],(r=a[c].components["obb-collider"].obb).halfSize.x!==0&&r.halfSize.y!==0&&r.halfSize.z!==0)for(var u=c+1;u<a.length;u++)(e=(s=a[u].components["obb-collider"]).obb).halfSize.x!==0&&e.halfSize.y!==0&&e.halfSize.z!==0&&r.intersectsOBB(e)&&this.registerCollision(n,s);this.clearCollisions()}}});var gC=Bi("components:renderer:warn");function U5(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z-e.z}function N5(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder-e.renderOrder}function F5(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:e.z-r.z}Ao("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:hb()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon","AgX","neutral"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon","AgX","neutral"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var r=this.data,e=this.el,n=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),s=e.renderer;s.toneMapping=l[n+"ToneMapping"],Pi.DEFAULT_ANISOTROPY=r.anisotropy,Dn.enabled=r.colorManagement,s.outputColorSpace=r.colorManagement?si:xr,e.hasAttribute("antialias")&&gC('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),e.hasAttribute("logarithmicDepthBuffer")&&gC('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),s.sortObjects=!0,s.setOpaqueSort(U5)},update:function(){var r=this.data,e=this.el.renderer,n=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);e.toneMapping=l[n+"ToneMapping"],e.toneMappingExposure=r.exposure,e.xr.setFoveation(r.foveationLevel),r.sortObjects&&gC('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),r.sortTransparentObjects?e.setTransparentSort(F5):e.setTransparentSort(N5)},applyColorCorrection:function(r){this.data.colorManagement&&r&&r.isTexture&&r.colorSpace!==si&&(r.colorSpace=si,r.needsUpdate=!0)},setWebXRFrameRate:function(r){var e,n=this.data,s=r.supportedFrameRates;s&&r.updateTargetFrameRate&&(e=s.includes(90)?n.highRefreshRate?90:72:n.highRefreshRate?72:60,r.updateTargetFrameRate(e).catch(function(a){console.warn("failed to set target frame rate of "+e+". Error info: "+a)}))}});var O5={basic:Ge,pcf:qe,pcfsoft:ot};Ao("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var r=this.sceneEl,e=this.data;this.shadowMapEnabled=!1,r.renderer.shadowMap.type=O5[e.type],r.renderer.shadowMap.autoUpdate=e.autoUpdate},update:function(r){r.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(r){var e=this.sceneEl,n=this.sceneEl.renderer;this.shadowMapEnabled=r;var s=this.data.enabled&&this.shadowMapEnabled;n&&s!==n.shadowMap.enabled&&(n.shadowMap.enabled=s,function(a){a.hasLoaded&&a.object3D.traverse(function(c){if(c.material)for(var u=Array.isArray(c.material)?c.material:[c.material],A=0;A<u.length;A++)u[A].needsUpdate=!0})}(e))}}),Ao("tracked-controls",{init:function(){this.controllers=[],this.onInputSourcesChange=this.onInputSourcesChange.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.el.addEventListener("enter-vr",this.onEnterVR),this.onExitVR=this.onExitVR.bind(this),this.el.addEventListener("exit-vr",this.onExitVR)},onEnterVR:function(){this.el.xrSession&&this.el.xrSession.addEventListener("inputsourceschange",this.onInputSourcesChange)},onExitVR:function(){this.referenceSpace=void 0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1)},onInputSourcesChange:function(){var r=this,e=this.el.xrSession,n=this.el.sceneEl.systems.webxr.sessionReferenceSpaceType;e.requestReferenceSpace(n).then(function(s){r.referenceSpace=s}).catch(function(s){throw r.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(n,'tracked-controls uses reference space "'+n+'".'),s}),this.controllers=e.inputSources,this.el.emit("controllersupdated",void 0,!1)}});var k5=Bi("systems:webxr:warn"),cR=(Ao("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var r=this.data;this.sessionConfiguration={requiredFeatures:r.requiredFeatures,optionalFeatures:r.optionalFeatures},this.sessionReferenceSpaceType=r.referenceSpaceType,r.overlayElement&&(r.overlayElement.classList.remove("a-dom-overlay"),r.optionalFeatures.includes("dom-overlay")||(r.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",r)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:r.overlayElement},r.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(r){return r==="viewer"||r==="local"||!(!this.sessionConfiguration.requiredFeatures.includes(r)&&!this.sessionConfiguration.optionalFeatures.includes(r))},warnIfFeatureNotRequested:function(r,e){this.wasFeatureRequested(r)||k5((e?e+" ":"")+'Please add the feature "'+r+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`)}}),{});function hR(r){var e=r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();r==="fog"&&(e="material-fog"),r==="visible"&&(e="material-visible"),cR[e]="material."+r}function bc(){return{defaultComponents:{material:{}},mappings:Sa({},cR)}}Object.keys(Or.material.schema).forEach(hR),Object.keys(bl.standard.schema).forEach(hR);var Jv=new R,Q5=new R;sn("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var r=this.data,e=this.el,n=e.object3D.parent,s=e.object3D,a=new wa;Jv.copy(s.position),Q5.copy(s.rotation),n.remove(s),a.add(s),n.add(a),e.object3D=a,s.position.set(-1*r.x,-1*r.y,-1*r.z),a.position.set(r.x+Jv.x,r.y+Jv.y,r.z+Jv.z),a.rotation.copy(s.rotation),s.rotation.set(0,0,0)}}),na("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}}),na("a-cursor",Wa({},bc(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}})),na("a-curvedimage",Wa({},bc(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}})),na("a-gltf-model",{mappings:{src:"gltf-model"}}),na("a-image",Wa({},bc(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}})),na("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}}),na("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}}),na("a-obj-model",Wa({},bc(),{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}));const uR={},G5=uR;function dR(r){return r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var vC,$v;zb.forEach(function(r){var e=bh[r],n=dR(r),s={};Object.keys(e.schema).forEach(function(u){s[dR(u)]="geometry."+u});var a="a-"+n,c=na(a,Wa({},bc(),{defaultComponents:{geometry:{primitive:r}},mappings:s}));uR[a]=c}),na("a-sky",Wa({},bc(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:Wa({},G5["a-sphere"].mappings)})),na("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}}),vC={text:{anchor:"align",width:5}},$v=$v||{},Object.keys(vC).forEach(function(r){(function(e,n){var s=Or[e].schema;Object.keys(s).forEach(function(a){var c=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();n[c]!==void 0&&(c=e+"-"+a),n[c]=e+"."+a})})(r,$v)}),na("a-text",Wa({},null,{defaultComponents:vC,mappings:$v})),na("a-video",Wa({},bc(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}})),na("a-videosphere",Wa({},bc(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}));var yC=Bi,H5=yC("A-Frame:error"),z5=yC("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&z5("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),window.cordova||window.location.protocol!=="file:"||H5("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),pb&&(window.logs=yC,i(7180),i(9379)),console.log("A-Frame Version: 1.7.0 (Date 2025-02-20, Commit #ad5cef10)"),console.log("THREE Version (https://github.com/supermedium/three.js):",tB.REVISION),window.AFRAME_ASYNC||(document.readyState!=="complete"?document.addEventListener("readystatechange",function r(){document.readyState==="complete"&&(document.removeEventListener("readystatechange",r),Nb())}):Nb());const V5=globalThis.AFRAME={AComponent:hm,AEntity:is,ANode:Is,ANIME:Gl,AScene:GB,components:Or,coreComponents:Object.keys(Or),geometries:bh,registerComponent:sn,registerGeometry:ta,registerPrimitive:na,registerShader:Ch,registerSystem:Ao,primitives:{getMeshMixin:bc,primitives:jB},scenes:$u,schema:P,shaders:bl,systems:Ec,emitReady:Nb,THREE:tB,utils:T,version:KB}})(),o.default})());/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(p,t){typeof exports=="object"&&typeof module<"u"?module.exports=t():typeof define=="function"&&define.amd?define(t):(p=typeof globalThis<"u"?globalThis:p||self).bootstrap=t()})(void 0,function(){"use strict";const p=new Map,t={set(R,I,V){p.has(R)||p.set(R,new Map);const te=p.get(R);te.has(I)||te.size===0?te.set(I,V):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(te.keys())[0]}.`)},get:(R,I)=>p.has(R)&&p.get(R).get(I)||null,remove(R,I){if(!p.has(R))return;const V=p.get(R);V.delete(I),V.size===0&&p.delete(R)}},i="transitionend",o=R=>(R&&window.CSS&&window.CSS.escape&&(R=R.replace(/#([^\s"#']+)/g,(I,V)=>`#${CSS.escape(V)}`)),R),l=R=>{R.dispatchEvent(new Event(i))},h=R=>!(!R||typeof R!="object")&&(R.jquery!==void 0&&(R=R[0]),R.nodeType!==void 0),d=R=>h(R)?R.jquery?R[0]:R:typeof R=="string"&&R.length>0?document.querySelector(o(R)):null,f=R=>{if(!h(R)||R.getClientRects().length===0)return!1;const I=getComputedStyle(R).getPropertyValue("visibility")==="visible",V=R.closest("details:not([open])");if(!V)return I;if(V!==R){const te=R.closest("summary");if(te&&te.parentNode!==V||te===null)return!1}return I},g=R=>!R||R.nodeType!==Node.ELEMENT_NODE||!!R.classList.contains("disabled")||(R.disabled!==void 0?R.disabled:R.hasAttribute("disabled")&&R.getAttribute("disabled")!=="false"),y=R=>{if(!document.documentElement.attachShadow)return null;if(typeof R.getRootNode=="function"){const I=R.getRootNode();return I instanceof ShadowRoot?I:null}return R instanceof ShadowRoot?R:R.parentNode?y(R.parentNode):null},x=()=>{},b=R=>{R.offsetHeight},_=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,w=[],T=()=>document.documentElement.dir==="rtl",P=R=>{var I;I=()=>{const V=_();if(V){const te=R.NAME,Ie=V.fn[te];V.fn[te]=R.jQueryInterface,V.fn[te].Constructor=R,V.fn[te].noConflict=()=>(V.fn[te]=Ie,R.jQueryInterface)}},document.readyState==="loading"?(w.length||document.addEventListener("DOMContentLoaded",()=>{for(const V of w)V()}),w.push(I)):I()},U=(R,I=[],V=R)=>typeof R=="function"?R(...I):V,D=(R,I,V=!0)=>{if(!V)return void U(R);const te=(et=>{if(!et)return 0;let{transitionDuration:At,transitionDelay:Tt}=window.getComputedStyle(et);const zt=Number.parseFloat(At),Ht=Number.parseFloat(Tt);return zt||Ht?(At=At.split(",")[0],Tt=Tt.split(",")[0],1e3*(Number.parseFloat(At)+Number.parseFloat(Tt))):0})(I)+5;let Ie=!1;const Be=({target:et})=>{et===I&&(Ie=!0,I.removeEventListener(i,Be),U(R))};I.addEventListener(i,Be),setTimeout(()=>{Ie||l(I)},te)},z=(R,I,V,te)=>{const Ie=R.length;let Be=R.indexOf(I);return Be===-1?!V&&te?R[Ie-1]:R[0]:(Be+=V?1:-1,te&&(Be=(Be+Ie)%Ie),R[Math.max(0,Math.min(Be,Ie-1))])},G=/[^.]*(?=\..*)\.|.*/,Q=/\..*/,Y=/::\d+$/,q={};let K=1;const ne={mouseenter:"mouseover",mouseleave:"mouseout"},le=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function fe(R,I){return I&&`${I}::${K++}`||R.uidEvent||K++}function be(R){const I=fe(R);return R.uidEvent=I,q[I]=q[I]||{},q[I]}function de(R,I,V=null){return Object.values(R).find(te=>te.callable===I&&te.delegationSelector===V)}function Fe(R,I,V){const te=typeof I=="string",Ie=te?V:I||V;let Be=tt(R);return le.has(Be)||(Be=R),[te,Ie,Be]}function we(R,I,V,te,Ie){if(typeof I!="string"||!R)return;let[Be,et,At]=Fe(I,V,te);I in ne&&(et=(bn=>function(gn){if(!gn.relatedTarget||gn.relatedTarget!==gn.delegateTarget&&!gn.delegateTarget.contains(gn.relatedTarget))return bn.call(this,gn)})(et));const Tt=be(R),zt=Tt[At]||(Tt[At]={}),Ht=de(zt,et,Be?V:null);if(Ht)return void(Ht.oneOff=Ht.oneOff&&Ie);const Pt=fe(et,I.replace(G,"")),_n=Be?function(pn,bn,gn){return function mn(Ii){const Xi=pn.querySelectorAll(bn);for(let{target:Fn}=Ii;Fn&&Fn!==this;Fn=Fn.parentNode)for(const Ai of Xi)if(Ai===Fn)return wt(Ii,{delegateTarget:Fn}),mn.oneOff&&me.off(pn,Ii.type,bn,gn),gn.apply(Fn,[Ii])}}(R,V,et):function(pn,bn){return function gn(mn){return wt(mn,{delegateTarget:pn}),gn.oneOff&&me.off(pn,mn.type,bn),bn.apply(pn,[mn])}}(R,et);_n.delegationSelector=Be?V:null,_n.callable=et,_n.oneOff=Ie,_n.uidEvent=Pt,zt[Pt]=_n,R.addEventListener(At,_n,Be)}function Me(R,I,V,te,Ie){const Be=de(I[V],te,Ie);Be&&(R.removeEventListener(V,Be,!!Ie),delete I[V][Be.uidEvent])}function _e(R,I,V,te){const Ie=I[V]||{};for(const[Be,et]of Object.entries(Ie))Be.includes(te)&&Me(R,I,V,et.callable,et.delegationSelector)}function tt(R){return R=R.replace(Q,""),ne[R]||R}const me={on(R,I,V,te){we(R,I,V,te,!1)},one(R,I,V,te){we(R,I,V,te,!0)},off(R,I,V,te){if(typeof I!="string"||!R)return;const[Ie,Be,et]=Fe(I,V,te),At=et!==I,Tt=be(R),zt=Tt[et]||{},Ht=I.startsWith(".");if(Be===void 0){if(Ht)for(const Pt of Object.keys(Tt))_e(R,Tt,Pt,I.slice(1));for(const[Pt,_n]of Object.entries(zt)){const pn=Pt.replace(Y,"");At&&!I.includes(pn)||Me(R,Tt,et,_n.callable,_n.delegationSelector)}}else{if(!Object.keys(zt).length)return;Me(R,Tt,et,Be,Ie?V:null)}},trigger(R,I,V){if(typeof I!="string"||!R)return null;const te=_();let Ie=null,Be=!0,et=!0,At=!1;I!==tt(I)&&te&&(Ie=te.Event(I,V),te(R).trigger(Ie),Be=!Ie.isPropagationStopped(),et=!Ie.isImmediatePropagationStopped(),At=Ie.isDefaultPrevented());const Tt=wt(new Event(I,{bubbles:Be,cancelable:!0}),V);return At&&Tt.preventDefault(),et&&R.dispatchEvent(Tt),Tt.defaultPrevented&&Ie&&Ie.preventDefault(),Tt}};function wt(R,I={}){for(const[V,te]of Object.entries(I))try{R[V]=te}catch{Object.defineProperty(R,V,{configurable:!0,get:()=>te})}return R}function ft(R){if(R==="true")return!0;if(R==="false")return!1;if(R===Number(R).toString())return Number(R);if(R===""||R==="null")return null;if(typeof R!="string")return R;try{return JSON.parse(decodeURIComponent(R))}catch{return R}}function ze(R){return R.replace(/[A-Z]/g,I=>`-${I.toLowerCase()}`)}const $e={setDataAttribute(R,I,V){R.setAttribute(`data-bs-${ze(I)}`,V)},removeDataAttribute(R,I){R.removeAttribute(`data-bs-${ze(I)}`)},getDataAttributes(R){if(!R)return{};const I={},V=Object.keys(R.dataset).filter(te=>te.startsWith("bs")&&!te.startsWith("bsConfig"));for(const te of V){let Ie=te.replace(/^bs/,"");Ie=Ie.charAt(0).toLowerCase()+Ie.slice(1,Ie.length),I[Ie]=ft(R.dataset[te])}return I},getDataAttribute:(R,I)=>ft(R.getAttribute(`data-bs-${ze(I)}`))};class pt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(I){return I=this._mergeConfigObj(I),I=this._configAfterMerge(I),this._typeCheckConfig(I),I}_configAfterMerge(I){return I}_mergeConfigObj(I,V){const te=h(V)?$e.getDataAttribute(V,"config"):{};return{...this.constructor.Default,...typeof te=="object"?te:{},...h(V)?$e.getDataAttributes(V):{},...typeof I=="object"?I:{}}}_typeCheckConfig(I,V=this.constructor.DefaultType){for(const[Ie,Be]of Object.entries(V)){const et=I[Ie],At=h(et)?"element":(te=et)==null?`${te}`:Object.prototype.toString.call(te).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Be).test(At))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Ie}" provided type "${At}" but expected type "${Be}".`)}var te}}class lt extends pt{constructor(I,V){super(),(I=d(I))&&(this._element=I,this._config=this._getConfig(V),t.set(this._element,this.constructor.DATA_KEY,this))}dispose(){t.remove(this._element,this.constructor.DATA_KEY),me.off(this._element,this.constructor.EVENT_KEY);for(const I of Object.getOwnPropertyNames(this))this[I]=null}_queueCallback(I,V,te=!0){D(I,V,te)}_getConfig(I){return I=this._mergeConfigObj(I,this._element),I=this._configAfterMerge(I),this._typeCheckConfig(I),I}static getInstance(I){return t.get(d(I),this.DATA_KEY)}static getOrCreateInstance(I,V={}){return this.getInstance(I)||new this(I,typeof V=="object"?V:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(I){return`${I}${this.EVENT_KEY}`}}const he=R=>{let I=R.getAttribute("data-bs-target");if(!I||I==="#"){let V=R.getAttribute("href");if(!V||!V.includes("#")&&!V.startsWith("."))return null;V.includes("#")&&!V.startsWith("#")&&(V=`#${V.split("#")[1]}`),I=V&&V!=="#"?V.trim():null}return I?I.split(",").map(V=>o(V)).join(","):null},Z={find:(R,I=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(I,R)),findOne:(R,I=document.documentElement)=>Element.prototype.querySelector.call(I,R),children:(R,I)=>[].concat(...R.children).filter(V=>V.matches(I)),parents(R,I){const V=[];let te=R.parentNode.closest(I);for(;te;)V.push(te),te=te.parentNode.closest(I);return V},prev(R,I){let V=R.previousElementSibling;for(;V;){if(V.matches(I))return[V];V=V.previousElementSibling}return[]},next(R,I){let V=R.nextElementSibling;for(;V;){if(V.matches(I))return[V];V=V.nextElementSibling}return[]},focusableChildren(R){const I=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(V=>`${V}:not([tabindex^="-"])`).join(",");return this.find(I,R).filter(V=>!g(V)&&f(V))},getSelectorFromElement(R){const I=he(R);return I&&Z.findOne(I)?I:null},getElementFromSelector(R){const I=he(R);return I?Z.findOne(I):null},getMultipleElementsFromSelector(R){const I=he(R);return I?Z.find(I):[]}},Ce=(R,I="hide")=>{const V=`click.dismiss${R.EVENT_KEY}`,te=R.NAME;me.on(document,V,`[data-bs-dismiss="${te}"]`,function(Ie){if(["A","AREA"].includes(this.tagName)&&Ie.preventDefault(),g(this))return;const Be=Z.getElementFromSelector(this)||this.closest(`.${te}`);R.getOrCreateInstance(Be)[I]()})},Qe=".bs.alert",Pe=`close${Qe}`,je=`closed${Qe}`;class pe extends lt{static get NAME(){return"alert"}close(){if(me.trigger(this._element,Pe).defaultPrevented)return;this._element.classList.remove("show");const I=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,I)}_destroyElement(){this._element.remove(),me.trigger(this._element,je),this.dispose()}static jQueryInterface(I){return this.each(function(){const V=pe.getOrCreateInstance(this);if(typeof I=="string"){if(V[I]===void 0||I.startsWith("_")||I==="constructor")throw new TypeError(`No method named "${I}"`);V[I](this)}})}}Ce(pe,"close"),P(pe);const Ve='[data-bs-toggle="button"]';class Ye extends lt{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(I){return this.each(function(){const V=Ye.getOrCreateInstance(this);I==="toggle"&&V[I]()})}}me.on(document,"click.bs.button.data-api",Ve,R=>{R.preventDefault();const I=R.target.closest(Ve);Ye.getOrCreateInstance(I).toggle()}),P(Ye);const Ct=".bs.swipe",Ke=`touchstart${Ct}`,yt=`touchmove${Ct}`,bt=`touchend${Ct}`,ht=`pointerdown${Ct}`,Vt=`pointerup${Ct}`,Nt={endCallback:null,leftCallback:null,rightCallback:null},nn={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class k extends pt{constructor(I,V){super(),this._element=I,I&&k.isSupported()&&(this._config=this._getConfig(V),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return Nt}static get DefaultType(){return nn}static get NAME(){return"swipe"}dispose(){me.off(this._element,Ct)}_start(I){this._supportPointerEvents?this._eventIsPointerPenTouch(I)&&(this._deltaX=I.clientX):this._deltaX=I.touches[0].clientX}_end(I){this._eventIsPointerPenTouch(I)&&(this._deltaX=I.clientX-this._deltaX),this._handleSwipe(),U(this._config.endCallback)}_move(I){this._deltaX=I.touches&&I.touches.length>1?0:I.touches[0].clientX-this._deltaX}_handleSwipe(){const I=Math.abs(this._deltaX);if(I<=40)return;const V=I/this._deltaX;this._deltaX=0,V&&U(V>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(me.on(this._element,ht,I=>this._start(I)),me.on(this._element,Vt,I=>this._end(I)),this._element.classList.add("pointer-event")):(me.on(this._element,Ke,I=>this._start(I)),me.on(this._element,yt,I=>this._move(I)),me.on(this._element,bt,I=>this._end(I)))}_eventIsPointerPenTouch(I){return this._supportPointerEvents&&(I.pointerType==="pen"||I.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const j=".bs.carousel",J=".data-api",Ae="next",ye="prev",Re="left",rt="right",_t=`slide${j}`,kt=`slid${j}`,un=`keydown${j}`,Jn=`mouseenter${j}`,Ri=`mouseleave${j}`,Xr=`dragstart${j}`,da=`load${j}${J}`,$a=`click${j}${J}`,De="carousel",pa="active",sl=".active",cr=".carousel-item",Yh=sl+cr,Nd={ArrowLeft:rt,ArrowRight:Re},Kh={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Ql={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Za extends lt{constructor(I,V){super(I,V),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Z.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===De&&this.cycle()}static get Default(){return Kh}static get DefaultType(){return Ql}static get NAME(){return"carousel"}next(){this._slide(Ae)}nextWhenVisible(){!document.hidden&&f(this._element)&&this.next()}prev(){this._slide(ye)}pause(){this._isSliding&&l(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?me.one(this._element,kt,()=>this.cycle()):this.cycle())}to(I){const V=this._getItems();if(I>V.length-1||I<0)return;if(this._isSliding)return void me.one(this._element,kt,()=>this.to(I));const te=this._getItemIndex(this._getActive());if(te===I)return;const Ie=I>te?Ae:ye;this._slide(Ie,V[I])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(I){return I.defaultInterval=I.interval,I}_addEventListeners(){this._config.keyboard&&me.on(this._element,un,I=>this._keydown(I)),this._config.pause==="hover"&&(me.on(this._element,Jn,()=>this.pause()),me.on(this._element,Ri,()=>this._maybeEnableCycle())),this._config.touch&&k.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const V of Z.find(".carousel-item img",this._element))me.on(V,Xr,te=>te.preventDefault());const I={leftCallback:()=>this._slide(this._directionToOrder(Re)),rightCallback:()=>this._slide(this._directionToOrder(rt)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new k(this._element,I)}_keydown(I){if(/input|textarea/i.test(I.target.tagName))return;const V=Nd[I.key];V&&(I.preventDefault(),this._slide(this._directionToOrder(V)))}_getItemIndex(I){return this._getItems().indexOf(I)}_setActiveIndicatorElement(I){if(!this._indicatorsElement)return;const V=Z.findOne(sl,this._indicatorsElement);V.classList.remove(pa),V.removeAttribute("aria-current");const te=Z.findOne(`[data-bs-slide-to="${I}"]`,this._indicatorsElement);te&&(te.classList.add(pa),te.setAttribute("aria-current","true"))}_updateInterval(){const I=this._activeElement||this._getActive();if(!I)return;const V=Number.parseInt(I.getAttribute("data-bs-interval"),10);this._config.interval=V||this._config.defaultInterval}_slide(I,V=null){if(this._isSliding)return;const te=this._getActive(),Ie=I===Ae,Be=V||z(this._getItems(),te,Ie,this._config.wrap);if(Be===te)return;const et=this._getItemIndex(Be),At=Pt=>me.trigger(this._element,Pt,{relatedTarget:Be,direction:this._orderToDirection(I),from:this._getItemIndex(te),to:et});if(At(_t).defaultPrevented||!te||!Be)return;const Tt=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(et),this._activeElement=Be;const zt=Ie?"carousel-item-start":"carousel-item-end",Ht=Ie?"carousel-item-next":"carousel-item-prev";Be.classList.add(Ht),b(Be),te.classList.add(zt),Be.classList.add(zt),this._queueCallback(()=>{Be.classList.remove(zt,Ht),Be.classList.add(pa),te.classList.remove(pa,Ht,zt),this._isSliding=!1,At(kt)},te,this._isAnimated()),Tt&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Z.findOne(Yh,this._element)}_getItems(){return Z.find(cr,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(I){return T()?I===Re?ye:Ae:I===Re?Ae:ye}_orderToDirection(I){return T()?I===ye?Re:rt:I===ye?rt:Re}static jQueryInterface(I){return this.each(function(){const V=Za.getOrCreateInstance(this,I);if(typeof I!="number"){if(typeof I=="string"){if(V[I]===void 0||I.startsWith("_")||I==="constructor")throw new TypeError(`No method named "${I}"`);V[I]()}}else V.to(I)})}}me.on(document,$a,"[data-bs-slide], [data-bs-slide-to]",function(R){const I=Z.getElementFromSelector(this);if(!I||!I.classList.contains(De))return;R.preventDefault();const V=Za.getOrCreateInstance(I),te=this.getAttribute("data-bs-slide-to");return te?(V.to(te),void V._maybeEnableCycle()):$e.getDataAttribute(this,"slide")==="next"?(V.next(),void V._maybeEnableCycle()):(V.prev(),void V._maybeEnableCycle())}),me.on(window,da,()=>{const R=Z.find('[data-bs-ride="carousel"]');for(const I of R)Za.getOrCreateInstance(I)}),P(Za);const hr=".bs.collapse",qc=`show${hr}`,Fd=`shown${hr}`,Qi=`hide${hr}`,Xc=`hidden${hr}`,Gl=`click${hr}.data-api`,bo="show",La="collapse",Hl="collapsing",zl=`:scope .${La} .${La}`,al='[data-bs-toggle="collapse"]',Jh={parent:null,toggle:!0},ue={parent:"(null|element)",toggle:"boolean"};class Ge extends lt{constructor(I,V){super(I,V),this._isTransitioning=!1,this._triggerArray=[];const te=Z.find(al);for(const Ie of te){const Be=Z.getSelectorFromElement(Ie),et=Z.find(Be).filter(At=>At===this._element);Be!==null&&et.length&&this._triggerArray.push(Ie)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Jh}static get DefaultType(){return ue}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let I=[];if(this._config.parent&&(I=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(Ie=>Ie!==this._element).map(Ie=>Ge.getOrCreateInstance(Ie,{toggle:!1}))),I.length&&I[0]._isTransitioning||me.trigger(this._element,qc).defaultPrevented)return;for(const Ie of I)Ie.hide();const V=this._getDimension();this._element.classList.remove(La),this._element.classList.add(Hl),this._element.style[V]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const te=`scroll${V[0].toUpperCase()+V.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Hl),this._element.classList.add(La,bo),this._element.style[V]="",me.trigger(this._element,Fd)},this._element,!0),this._element.style[V]=`${this._element[te]}px`}hide(){if(this._isTransitioning||!this._isShown()||me.trigger(this._element,Qi).defaultPrevented)return;const I=this._getDimension();this._element.style[I]=`${this._element.getBoundingClientRect()[I]}px`,b(this._element),this._element.classList.add(Hl),this._element.classList.remove(La,bo);for(const V of this._triggerArray){const te=Z.getElementFromSelector(V);te&&!this._isShown(te)&&this._addAriaAndCollapsedClass([V],!1)}this._isTransitioning=!0,this._element.style[I]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Hl),this._element.classList.add(La),me.trigger(this._element,Xc)},this._element,!0)}_isShown(I=this._element){return I.classList.contains(bo)}_configAfterMerge(I){return I.toggle=!!I.toggle,I.parent=d(I.parent),I}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const I=this._getFirstLevelChildren(al);for(const V of I){const te=Z.getElementFromSelector(V);te&&this._addAriaAndCollapsedClass([V],this._isShown(te))}}_getFirstLevelChildren(I){const V=Z.find(zl,this._config.parent);return Z.find(I,this._config.parent).filter(te=>!V.includes(te))}_addAriaAndCollapsedClass(I,V){if(I.length)for(const te of I)te.classList.toggle("collapsed",!V),te.setAttribute("aria-expanded",V)}static jQueryInterface(I){const V={};return typeof I=="string"&&/show|hide/.test(I)&&(V.toggle=!1),this.each(function(){const te=Ge.getOrCreateInstance(this,V);if(typeof I=="string"){if(te[I]===void 0)throw new TypeError(`No method named "${I}"`);te[I]()}})}}me.on(document,Gl,al,function(R){(R.target.tagName==="A"||R.delegateTarget&&R.delegateTarget.tagName==="A")&&R.preventDefault();for(const I of Z.getMultipleElementsFromSelector(this))Ge.getOrCreateInstance(I,{toggle:!1}).toggle()}),P(Ge);var qe="top",ot="bottom",He="right",ut="left",Lt="auto",Dt=[qe,ot,He,ut],Yt="start",rn="end",An="clippingParents",dn="viewport",Tn="popper",Ki="reference",ui=Dt.reduce(function(R,I){return R.concat([I+"-"+Yt,I+"-"+rn])},[]),tr=[].concat(Dt,[Lt]).reduce(function(R,I){return R.concat([I,I+"-"+Yt,I+"-"+rn])},[]),Li="beforeRead",$n="read",Gi="afterRead",vr="beforeMain",Ln="main",xn="afterMain",xs="beforeWrite",Vl="write",Wl="afterWrite",ol=[Li,$n,Gi,vr,Ln,xn,xs,Vl,Wl];function Ws(R){return R?(R.nodeName||"").toLowerCase():null}function ls(R){if(R==null)return window;if(R.toString()!=="[object Window]"){var I=R.ownerDocument;return I&&I.defaultView||window}return R}function eo(R){return R instanceof ls(R).Element||R instanceof Element}function _s(R){return R instanceof ls(R).HTMLElement||R instanceof HTMLElement}function Yc(R){return typeof ShadowRoot<"u"&&(R instanceof ls(R).ShadowRoot||R instanceof ShadowRoot)}const jl={name:"applyStyles",enabled:!0,phase:"write",fn:function(R){var I=R.state;Object.keys(I.elements).forEach(function(V){var te=I.styles[V]||{},Ie=I.attributes[V]||{},Be=I.elements[V];_s(Be)&&Ws(Be)&&(Object.assign(Be.style,te),Object.keys(Ie).forEach(function(et){var At=Ie[et];At===!1?Be.removeAttribute(et):Be.setAttribute(et,At===!0?"":At)}))})},effect:function(R){var I=R.state,V={popper:{position:I.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(I.elements.popper.style,V.popper),I.styles=V,I.elements.arrow&&Object.assign(I.elements.arrow.style,V.arrow),function(){Object.keys(I.elements).forEach(function(te){var Ie=I.elements[te],Be=I.attributes[te]||{},et=Object.keys(I.styles.hasOwnProperty(te)?I.styles[te]:V[te]).reduce(function(At,Tt){return At[Tt]="",At},{});_s(Ie)&&Ws(Ie)&&(Object.assign(Ie.style,et),Object.keys(Be).forEach(function(At){Ie.removeAttribute(At)}))})}},requires:["computeStyles"]};function Rs(R){return R.split("-")[0]}var to=Math.max,Bn=Math.min,Da=Math.round;function Qr(){var R=navigator.userAgentData;return R!=null&&R.brands&&Array.isArray(R.brands)?R.brands.map(function(I){return I.brand+"/"+I.version}).join(" "):navigator.userAgent}function cs(){return!/^((?!chrome|android).)*safari/i.test(Qr())}function Aa(R,I,V){I===void 0&&(I=!1),V===void 0&&(V=!1);var te=R.getBoundingClientRect(),Ie=1,Be=1;I&&_s(R)&&(Ie=R.offsetWidth>0&&Da(te.width)/R.offsetWidth||1,Be=R.offsetHeight>0&&Da(te.height)/R.offsetHeight||1);var et=(eo(R)?ls(R):window).visualViewport,At=!cs()&&V,Tt=(te.left+(At&&et?et.offsetLeft:0))/Ie,zt=(te.top+(At&&et?et.offsetTop:0))/Be,Ht=te.width/Ie,Pt=te.height/Be;return{width:Ht,height:Pt,top:zt,right:Tt+Ht,bottom:zt+Pt,left:Tt,x:Tt,y:zt}}function fa(R){var I=Aa(R),V=R.offsetWidth,te=R.offsetHeight;return Math.abs(I.width-V)<=1&&(V=I.width),Math.abs(I.height-te)<=1&&(te=I.height),{x:R.offsetLeft,y:R.offsetTop,width:V,height:te}}function Co(R,I){var V=I.getRootNode&&I.getRootNode();if(R.contains(I))return!0;if(V&&Yc(V)){var te=I;do{if(te&&R.isSameNode(te))return!0;te=te.parentNode||te.host}while(te)}return!1}function di(R){return ls(R).getComputedStyle(R)}function bs(R){return["table","td","th"].indexOf(Ws(R))>=0}function Ls(R){return((eo(R)?R.ownerDocument:R.document)||window.document).documentElement}function Yr(R){return Ws(R)==="html"?R:R.assignedSlot||R.parentNode||(Yc(R)?R.host:null)||Ls(R)}function ur(R){return _s(R)&&di(R).position!=="fixed"?R.offsetParent:null}function Lr(R){for(var I=ls(R),V=ur(R);V&&bs(V)&&di(V).position==="static";)V=ur(V);return V&&(Ws(V)==="html"||Ws(V)==="body"&&di(V).position==="static")?I:V||function(te){var Ie=/firefox/i.test(Qr());if(/Trident/i.test(Qr())&&_s(te)&&di(te).position==="fixed")return null;var Be=Yr(te);for(Yc(Be)&&(Be=Be.host);_s(Be)&&["html","body"].indexOf(Ws(Be))<0;){var et=di(Be);if(et.transform!=="none"||et.perspective!=="none"||et.contain==="paint"||["transform","perspective"].indexOf(et.willChange)!==-1||Ie&&et.willChange==="filter"||Ie&&et.filter&&et.filter!=="none")return Be;Be=Be.parentNode}return null}(R)||I}function ma(R){return["top","bottom"].indexOf(R)>=0?"x":"y"}function _i(R,I,V){return to(R,Bn(I,V))}function Kc(R){return Object.assign({},{top:0,right:0,bottom:0,left:0},R)}function YA(R,I){return I.reduce(function(V,te){return V[te]=R,V},{})}const KA={name:"arrow",enabled:!0,phase:"main",fn:function(R){var I,V=R.state,te=R.name,Ie=R.options,Be=V.elements.arrow,et=V.modifiersData.popperOffsets,At=Rs(V.placement),Tt=ma(At),zt=[ut,He].indexOf(At)>=0?"height":"width";if(Be&&et){var Ht=function(wi,ni){return Kc(typeof(wi=typeof wi=="function"?wi(Object.assign({},ni.rects,{placement:ni.placement})):wi)!="number"?wi:YA(wi,Dt))}(Ie.padding,V),Pt=fa(Be),_n=Tt==="y"?qe:ut,pn=Tt==="y"?ot:He,bn=V.rects.reference[zt]+V.rects.reference[Tt]-et[Tt]-V.rects.popper[zt],gn=et[Tt]-V.rects.reference[Tt],mn=Lr(Be),Ii=mn?Tt==="y"?mn.clientHeight||0:mn.clientWidth||0:0,Xi=bn/2-gn/2,Fn=Ht[_n],Ai=Ii-Pt[zt]-Ht[pn],on=Ii/2-Pt[zt]/2+Xi,Pn=_i(Fn,on,Ai),Ci=Tt;V.modifiersData[te]=((I={})[Ci]=Pn,I.centerOffset=Pn-on,I)}},effect:function(R){var I=R.state,V=R.options.element,te=V===void 0?"[data-popper-arrow]":V;te!=null&&(typeof te!="string"||(te=I.elements.popper.querySelector(te)))&&Co(I.elements.popper,te)&&(I.elements.arrow=te)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ql(R){return R.split("-")[1]}var JA={top:"auto",right:"auto",bottom:"auto",left:"auto"};function $A(R){var I,V=R.popper,te=R.popperRect,Ie=R.placement,Be=R.variation,et=R.offsets,At=R.position,Tt=R.gpuAcceleration,zt=R.adaptive,Ht=R.roundOffsets,Pt=R.isFixed,_n=et.x,pn=_n===void 0?0:_n,bn=et.y,gn=bn===void 0?0:bn,mn=typeof Ht=="function"?Ht({x:pn,y:gn}):{x:pn,y:gn};pn=mn.x,gn=mn.y;var Ii=et.hasOwnProperty("x"),Xi=et.hasOwnProperty("y"),Fn=ut,Ai=qe,on=window;if(zt){var Pn=Lr(V),Ci="clientHeight",wi="clientWidth";Pn===ls(V)&&di(Pn=Ls(V)).position!=="static"&&At==="absolute"&&(Ci="scrollHeight",wi="scrollWidth"),(Ie===qe||(Ie===ut||Ie===He)&&Be===rn)&&(Ai=ot,gn-=(Pt&&Pn===on&&on.visualViewport?on.visualViewport.height:Pn[Ci])-te.height,gn*=Tt?1:-1),Ie!==ut&&(Ie!==qe&&Ie!==ot||Be!==rn)||(Fn=He,pn-=(Pt&&Pn===on&&on.visualViewport?on.visualViewport.width:Pn[wi])-te.width,pn*=Tt?1:-1)}var ni,ir=Object.assign({position:At},zt&&JA),ds=Ht===!0?function(Xs,_r){var Qt=Xs.x,Kr=Xs.y,gi=_r.devicePixelRatio||1;return{x:Da(Qt*gi)/gi||0,y:Da(Kr*gi)/gi||0}}({x:pn,y:gn},ls(V)):{x:pn,y:gn};return pn=ds.x,gn=ds.y,Tt?Object.assign({},ir,((ni={})[Ai]=Xi?"0":"",ni[Fn]=Ii?"0":"",ni.transform=(on.devicePixelRatio||1)<=1?"translate("+pn+"px, "+gn+"px)":"translate3d("+pn+"px, "+gn+"px, 0)",ni)):Object.assign({},ir,((I={})[Ai]=Xi?gn+"px":"",I[Fn]=Ii?pn+"px":"",I.transform="",I))}const Jc={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(R){var I=R.state,V=R.options,te=V.gpuAcceleration,Ie=te===void 0||te,Be=V.adaptive,et=Be===void 0||Be,At=V.roundOffsets,Tt=At===void 0||At,zt={placement:Rs(I.placement),variation:ql(I.placement),popper:I.elements.popper,popperRect:I.rects.popper,gpuAcceleration:Ie,isFixed:I.options.strategy==="fixed"};I.modifiersData.popperOffsets!=null&&(I.styles.popper=Object.assign({},I.styles.popper,$A(Object.assign({},zt,{offsets:I.modifiersData.popperOffsets,position:I.options.strategy,adaptive:et,roundOffsets:Tt})))),I.modifiersData.arrow!=null&&(I.styles.arrow=Object.assign({},I.styles.arrow,$A(Object.assign({},zt,{offsets:I.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Tt})))),I.attributes.popper=Object.assign({},I.attributes.popper,{"data-popper-placement":I.placement})},data:{}};var js={passive:!0};const Pa={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(R){var I=R.state,V=R.instance,te=R.options,Ie=te.scroll,Be=Ie===void 0||Ie,et=te.resize,At=et===void 0||et,Tt=ls(I.elements.popper),zt=[].concat(I.scrollParents.reference,I.scrollParents.popper);return Be&&zt.forEach(function(Ht){Ht.addEventListener("scroll",V.update,js)}),At&&Tt.addEventListener("resize",V.update,js),function(){Be&&zt.forEach(function(Ht){Ht.removeEventListener("scroll",V.update,js)}),At&&Tt.removeEventListener("resize",V.update,js)}},data:{}};var $c={left:"right",right:"left",bottom:"top",top:"bottom"};function wo(R){return R.replace(/left|right|bottom|top/g,function(I){return $c[I]})}var Zc={start:"end",end:"start"};function ga(R){return R.replace(/start|end/g,function(I){return Zc[I]})}function Dr(R){var I=ls(R);return{scrollLeft:I.pageXOffset,scrollTop:I.pageYOffset}}function ll(R){return Aa(Ls(R)).left+Dr(R).scrollLeft}function yr(R){var I=di(R),V=I.overflow,te=I.overflowX,Ie=I.overflowY;return/auto|scroll|overlay|hidden/.test(V+Ie+te)}function $h(R){return["html","body","#document"].indexOf(Ws(R))>=0?R.ownerDocument.body:_s(R)&&yr(R)?R:$h(Yr(R))}function Zh(R,I){var V;I===void 0&&(I=[]);var te=$h(R),Ie=te===((V=R.ownerDocument)==null?void 0:V.body),Be=ls(te),et=Ie?[Be].concat(Be.visualViewport||[],yr(te)?te:[]):te,At=I.concat(et);return Ie?At:At.concat(Zh(Yr(et)))}function Mo(R){return Object.assign({},R,{left:R.x,top:R.y,right:R.x+R.width,bottom:R.y+R.height})}function Ig(R,I,V){return I===dn?Mo(function(te,Ie){var Be=ls(te),et=Ls(te),At=Be.visualViewport,Tt=et.clientWidth,zt=et.clientHeight,Ht=0,Pt=0;if(At){Tt=At.width,zt=At.height;var _n=cs();(_n||!_n&&Ie==="fixed")&&(Ht=At.offsetLeft,Pt=At.offsetTop)}return{width:Tt,height:zt,x:Ht+ll(te),y:Pt}}(R,V)):eo(I)?function(te,Ie){var Be=Aa(te,!1,Ie==="fixed");return Be.top=Be.top+te.clientTop,Be.left=Be.left+te.clientLeft,Be.bottom=Be.top+te.clientHeight,Be.right=Be.left+te.clientWidth,Be.width=te.clientWidth,Be.height=te.clientHeight,Be.x=Be.left,Be.y=Be.top,Be}(I,V):Mo(function(te){var Ie,Be=Ls(te),et=Dr(te),At=(Ie=te.ownerDocument)==null?void 0:Ie.body,Tt=to(Be.scrollWidth,Be.clientWidth,At?At.scrollWidth:0,At?At.clientWidth:0),zt=to(Be.scrollHeight,Be.clientHeight,At?At.scrollHeight:0,At?At.clientHeight:0),Ht=-et.scrollLeft+ll(te),Pt=-et.scrollTop;return di(At||Be).direction==="rtl"&&(Ht+=to(Be.clientWidth,At?At.clientWidth:0)-Tt),{width:Tt,height:zt,x:Ht,y:Pt}}(Ls(R)))}function bi(R){var I,V=R.reference,te=R.element,Ie=R.placement,Be=Ie?Rs(Ie):null,et=Ie?ql(Ie):null,At=V.x+V.width/2-te.width/2,Tt=V.y+V.height/2-te.height/2;switch(Be){case qe:I={x:At,y:V.y-te.height};break;case ot:I={x:At,y:V.y+V.height};break;case He:I={x:V.x+V.width,y:Tt};break;case ut:I={x:V.x-te.width,y:Tt};break;default:I={x:V.x,y:V.y}}var zt=Be?ma(Be):null;if(zt!=null){var Ht=zt==="y"?"height":"width";switch(et){case Yt:I[zt]=I[zt]-(V[Ht]/2-te[Ht]/2);break;case rn:I[zt]=I[zt]+(V[Ht]/2-te[Ht]/2)}}return I}function Ua(R,I){I===void 0&&(I={});var V=I,te=V.placement,Ie=te===void 0?R.placement:te,Be=V.strategy,et=Be===void 0?R.strategy:Be,At=V.boundary,Tt=At===void 0?An:At,zt=V.rootBoundary,Ht=zt===void 0?dn:zt,Pt=V.elementContext,_n=Pt===void 0?Tn:Pt,pn=V.altBoundary,bn=pn!==void 0&&pn,gn=V.padding,mn=gn===void 0?0:gn,Ii=Kc(typeof mn!="number"?mn:YA(mn,Dt)),Xi=_n===Tn?Ki:Tn,Fn=R.rects.popper,Ai=R.elements[bn?Xi:_n],on=function(_r,Qt,Kr,gi){var ro=Qt==="clippingParents"?function(jn){var ps=Zh(Yr(jn)),Ks=["absolute","fixed"].indexOf(di(jn).position)>=0&&_s(jn)?Lr(jn):jn;return eo(Ks)?ps.filter(function(ii){return eo(ii)&&Co(ii,Ks)&&Ws(ii)!=="body"}):[]}(_r):[].concat(Qt),so=[].concat(ro,[Kr]),Ys=so[0],br=so.reduce(function(jn,ps){var Ks=Ig(_r,ps,gi);return jn.top=to(Ks.top,jn.top),jn.right=Bn(Ks.right,jn.right),jn.bottom=Bn(Ks.bottom,jn.bottom),jn.left=to(Ks.left,jn.left),jn},Ig(_r,Ys,gi));return br.width=br.right-br.left,br.height=br.bottom-br.top,br.x=br.left,br.y=br.top,br}(eo(Ai)?Ai:Ai.contextElement||Ls(R.elements.popper),Tt,Ht,et),Pn=Aa(R.elements.reference),Ci=bi({reference:Pn,element:Fn,strategy:"absolute",placement:Ie}),wi=Mo(Object.assign({},Fn,Ci)),ni=_n===Tn?wi:Pn,ir={top:on.top-ni.top+Ii.top,bottom:ni.bottom-on.bottom+Ii.bottom,left:on.left-ni.left+Ii.left,right:ni.right-on.right+Ii.right},ds=R.modifiersData.offset;if(_n===Tn&&ds){var Xs=ds[Ie];Object.keys(ir).forEach(function(_r){var Qt=[He,ot].indexOf(_r)>=0?1:-1,Kr=[qe,ot].indexOf(_r)>=0?"y":"x";ir[_r]+=Xs[Kr]*Qt})}return ir}function ix(R,I){I===void 0&&(I={});var V=I,te=V.placement,Ie=V.boundary,Be=V.rootBoundary,et=V.padding,At=V.flipVariations,Tt=V.allowedAutoPlacements,zt=Tt===void 0?tr:Tt,Ht=ql(te),Pt=Ht?At?ui:ui.filter(function(bn){return ql(bn)===Ht}):Dt,_n=Pt.filter(function(bn){return zt.indexOf(bn)>=0});_n.length===0&&(_n=Pt);var pn=_n.reduce(function(bn,gn){return bn[gn]=Ua(R,{placement:gn,boundary:Ie,rootBoundary:Be,padding:et})[Rs(gn)],bn},{});return Object.keys(pn).sort(function(bn,gn){return pn[bn]-pn[gn]})}const hs={name:"flip",enabled:!0,phase:"main",fn:function(R){var I=R.state,V=R.options,te=R.name;if(!I.modifiersData[te]._skip){for(var Ie=V.mainAxis,Be=Ie===void 0||Ie,et=V.altAxis,At=et===void 0||et,Tt=V.fallbackPlacements,zt=V.padding,Ht=V.boundary,Pt=V.rootBoundary,_n=V.altBoundary,pn=V.flipVariations,bn=pn===void 0||pn,gn=V.allowedAutoPlacements,mn=I.options.placement,Ii=Rs(mn),Xi=Tt||(Ii!==mn&&bn?function(jn){if(Rs(jn)===Lt)return[];var ps=wo(jn);return[ga(jn),ps,ga(ps)]}(mn):[wo(mn)]),Fn=[mn].concat(Xi).reduce(function(jn,ps){return jn.concat(Rs(ps)===Lt?ix(I,{placement:ps,boundary:Ht,rootBoundary:Pt,padding:zt,flipVariations:bn,allowedAutoPlacements:gn}):ps)},[]),Ai=I.rects.reference,on=I.rects.popper,Pn=new Map,Ci=!0,wi=Fn[0],ni=0;ni<Fn.length;ni++){var ir=Fn[ni],ds=Rs(ir),Xs=ql(ir)===Yt,_r=[qe,ot].indexOf(ds)>=0,Qt=_r?"width":"height",Kr=Ua(I,{placement:ir,boundary:Ht,rootBoundary:Pt,altBoundary:_n,padding:zt}),gi=_r?Xs?He:ut:Xs?ot:qe;Ai[Qt]>on[Qt]&&(gi=wo(gi));var ro=wo(gi),so=[];if(Be&&so.push(Kr[ds]<=0),At&&so.push(Kr[gi]<=0,Kr[ro]<=0),so.every(function(jn){return jn})){wi=ir,Ci=!1;break}Pn.set(ir,so)}if(Ci)for(var Ys=function(jn){var ps=Fn.find(function(Ks){var ii=Pn.get(Ks);if(ii)return ii.slice(0,jn).every(function(oc){return oc})});if(ps)return wi=ps,"break"},br=bn?3:1;br>0&&Ys(br)!=="break";br--);I.placement!==wi&&(I.modifiersData[te]._skip=!0,I.placement=wi,I.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Tg(R,I,V){return V===void 0&&(V={x:0,y:0}),{top:R.top-I.height-V.y,right:R.right-I.width+V.x,bottom:R.bottom-I.height+V.y,left:R.left-I.width-V.x}}function Er(R){return[qe,He,ot,ut].some(function(I){return R[I]>=0})}const Od={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(R){var I=R.state,V=R.name,te=I.rects.reference,Ie=I.rects.popper,Be=I.modifiersData.preventOverflow,et=Ua(I,{elementContext:"reference"}),At=Ua(I,{altBoundary:!0}),Tt=Tg(et,te),zt=Tg(At,Ie,Be),Ht=Er(Tt),Pt=Er(zt);I.modifiersData[V]={referenceClippingOffsets:Tt,popperEscapeOffsets:zt,isReferenceHidden:Ht,hasPopperEscaped:Pt},I.attributes.popper=Object.assign({},I.attributes.popper,{"data-popper-reference-hidden":Ht,"data-popper-escaped":Pt})}},kd={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(R){var I=R.state,V=R.options,te=R.name,Ie=V.offset,Be=Ie===void 0?[0,0]:Ie,et=tr.reduce(function(Ht,Pt){return Ht[Pt]=function(_n,pn,bn){var gn=Rs(_n),mn=[ut,qe].indexOf(gn)>=0?-1:1,Ii=typeof bn=="function"?bn(Object.assign({},pn,{placement:_n})):bn,Xi=Ii[0],Fn=Ii[1];return Xi=Xi||0,Fn=(Fn||0)*mn,[ut,He].indexOf(gn)>=0?{x:Fn,y:Xi}:{x:Xi,y:Fn}}(Pt,I.rects,Be),Ht},{}),At=et[I.placement],Tt=At.x,zt=At.y;I.modifiersData.popperOffsets!=null&&(I.modifiersData.popperOffsets.x+=Tt,I.modifiersData.popperOffsets.y+=zt),I.modifiersData[te]=et}},cl={name:"popperOffsets",enabled:!0,phase:"read",fn:function(R){var I=R.state,V=R.name;I.modifiersData[V]=bi({reference:I.rects.reference,element:I.rects.popper,strategy:"absolute",placement:I.placement})},data:{}},eu={name:"preventOverflow",enabled:!0,phase:"main",fn:function(R){var I=R.state,V=R.options,te=R.name,Ie=V.mainAxis,Be=Ie===void 0||Ie,et=V.altAxis,At=et!==void 0&&et,Tt=V.boundary,zt=V.rootBoundary,Ht=V.altBoundary,Pt=V.padding,_n=V.tether,pn=_n===void 0||_n,bn=V.tetherOffset,gn=bn===void 0?0:bn,mn=Ua(I,{boundary:Tt,rootBoundary:zt,padding:Pt,altBoundary:Ht}),Ii=Rs(I.placement),Xi=ql(I.placement),Fn=!Xi,Ai=ma(Ii),on=Ai==="x"?"y":"x",Pn=I.modifiersData.popperOffsets,Ci=I.rects.reference,wi=I.rects.popper,ni=typeof gn=="function"?gn(Object.assign({},I.rects,{placement:I.placement})):gn,ir=typeof ni=="number"?{mainAxis:ni,altAxis:ni}:Object.assign({mainAxis:0,altAxis:0},ni),ds=I.modifiersData.offset?I.modifiersData.offset[I.placement]:null,Xs={x:0,y:0};if(Pn){if(Be){var _r,Qt=Ai==="y"?qe:ut,Kr=Ai==="y"?ot:He,gi=Ai==="y"?"height":"width",ro=Pn[Ai],so=ro+mn[Qt],Ys=ro-mn[Kr],br=pn?-wi[gi]/2:0,jn=Xi===Yt?Ci[gi]:wi[gi],ps=Xi===Yt?-wi[gi]:-Ci[gi],Ks=I.elements.arrow,ii=pn&&Ks?fa(Ks):{width:0,height:0},oc=I.modifiersData["arrow#persistent"]?I.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},qg=oc[Qt],pf=oc[Kr],Uo=_i(0,Ci[gi],ii[gi]),No=Fn?Ci[gi]/2-br-Uo-qg-ir.mainAxis:jn-Uo-qg-ir.mainAxis,ip=Fn?-Ci[gi]/2+br+Uo+pf+ir.mainAxis:ps+Uo+pf+ir.mainAxis,lc=I.elements.arrow&&Lr(I.elements.arrow),bx=lc?Ai==="y"?lc.clientTop||0:lc.clientLeft||0:0,Xg=(_r=ds?.[Ai])!=null?_r:0,Yg=ro+ip-Xg,Af=_i(pn?Bn(so,ro+No-Xg-bx):so,ro,pn?to(Ys,Yg):Ys);Pn[Ai]=Af,Xs[Ai]=Af-ro}if(At){var ff,Kg=Ai==="x"?qe:ut,Cx=Ai==="x"?ot:He,xa=Pn[on],ch=on==="y"?"height":"width",kn=xa+mn[Kg],_a=xa-mn[Cx],Qa=[qe,ut].indexOf(Ii)!==-1,rp=(ff=ds?.[on])!=null?ff:0,ao=Qa?kn:xa-Ci[ch]-wi[ch]-rp+ir.altAxis,cc=Qa?xa+Ci[ch]+wi[ch]-rp-ir.altAxis:_a,hc=pn&&Qa?function(Jg,mf,Cu){var sp=_i(Jg,mf,Cu);return sp>Cu?Cu:sp}(ao,xa,cc):_i(pn?ao:kn,xa,pn?cc:_a);Pn[on]=hc,Xs[on]=hc-xa}I.modifiersData[te]=Xs}},requiresIfExists:["offset"]};function So(R,I,V){V===void 0&&(V=!1);var te,Ie,Be=_s(I),et=_s(I)&&function(Pt){var _n=Pt.getBoundingClientRect(),pn=Da(_n.width)/Pt.offsetWidth||1,bn=Da(_n.height)/Pt.offsetHeight||1;return pn!==1||bn!==1}(I),At=Ls(I),Tt=Aa(R,et,V),zt={scrollLeft:0,scrollTop:0},Ht={x:0,y:0};return(Be||!Be&&!V)&&((Ws(I)!=="body"||yr(At))&&(zt=(te=I)!==ls(te)&&_s(te)?{scrollLeft:(Ie=te).scrollLeft,scrollTop:Ie.scrollTop}:Dr(te)),_s(I)?((Ht=Aa(I,!0)).x+=I.clientLeft,Ht.y+=I.clientTop):At&&(Ht.x=ll(At))),{x:Tt.left+zt.scrollLeft-Ht.x,y:Tt.top+zt.scrollTop-Ht.y,width:Tt.width,height:Tt.height}}function Ir(R){var I=new Map,V=new Set,te=[];function Ie(Be){V.add(Be.name),[].concat(Be.requires||[],Be.requiresIfExists||[]).forEach(function(et){if(!V.has(et)){var At=I.get(et);At&&Ie(At)}}),te.push(Be)}return R.forEach(function(Be){I.set(Be.name,Be)}),R.forEach(function(Be){V.has(Be.name)||Ie(Be)}),te}var Cs={placement:"bottom",modifiers:[],strategy:"absolute"};function tu(){for(var R=arguments.length,I=new Array(R),V=0;V<R;V++)I[V]=arguments[V];return!I.some(function(te){return!(te&&typeof te.getBoundingClientRect=="function")})}function Xl(R){R===void 0&&(R={});var I=R,V=I.defaultModifiers,te=V===void 0?[]:V,Ie=I.defaultOptions,Be=Ie===void 0?Cs:Ie;return function(et,At,Tt){Tt===void 0&&(Tt=Be);var zt,Ht,Pt={placement:"bottom",orderedModifiers:[],options:Object.assign({},Cs,Be),modifiersData:{},elements:{reference:et,popper:At},attributes:{},styles:{}},_n=[],pn=!1,bn={state:Pt,setOptions:function(mn){var Ii=typeof mn=="function"?mn(Pt.options):mn;gn(),Pt.options=Object.assign({},Be,Pt.options,Ii),Pt.scrollParents={reference:eo(et)?Zh(et):et.contextElement?Zh(et.contextElement):[],popper:Zh(At)};var Xi,Fn,Ai=function(on){var Pn=Ir(on);return ol.reduce(function(Ci,wi){return Ci.concat(Pn.filter(function(ni){return ni.phase===wi}))},[])}((Xi=[].concat(te,Pt.options.modifiers),Fn=Xi.reduce(function(on,Pn){var Ci=on[Pn.name];return on[Pn.name]=Ci?Object.assign({},Ci,Pn,{options:Object.assign({},Ci.options,Pn.options),data:Object.assign({},Ci.data,Pn.data)}):Pn,on},{}),Object.keys(Fn).map(function(on){return Fn[on]})));return Pt.orderedModifiers=Ai.filter(function(on){return on.enabled}),Pt.orderedModifiers.forEach(function(on){var Pn=on.name,Ci=on.options,wi=Ci===void 0?{}:Ci,ni=on.effect;if(typeof ni=="function"){var ir=ni({state:Pt,name:Pn,instance:bn,options:wi});_n.push(ir||function(){})}}),bn.update()},forceUpdate:function(){if(!pn){var mn=Pt.elements,Ii=mn.reference,Xi=mn.popper;if(tu(Ii,Xi)){Pt.rects={reference:So(Ii,Lr(Xi),Pt.options.strategy==="fixed"),popper:fa(Xi)},Pt.reset=!1,Pt.placement=Pt.options.placement,Pt.orderedModifiers.forEach(function(ni){return Pt.modifiersData[ni.name]=Object.assign({},ni.data)});for(var Fn=0;Fn<Pt.orderedModifiers.length;Fn++)if(Pt.reset!==!0){var Ai=Pt.orderedModifiers[Fn],on=Ai.fn,Pn=Ai.options,Ci=Pn===void 0?{}:Pn,wi=Ai.name;typeof on=="function"&&(Pt=on({state:Pt,options:Ci,name:wi,instance:bn})||Pt)}else Pt.reset=!1,Fn=-1}}},update:(zt=function(){return new Promise(function(mn){bn.forceUpdate(),mn(Pt)})},function(){return Ht||(Ht=new Promise(function(mn){Promise.resolve().then(function(){Ht=void 0,mn(zt())})})),Ht}),destroy:function(){gn(),pn=!0}};if(!tu(et,At))return bn;function gn(){_n.forEach(function(mn){return mn()}),_n=[]}return bn.setOptions(Tt).then(function(mn){!pn&&Tt.onFirstUpdate&&Tt.onFirstUpdate(mn)}),bn}}var hl=Xl(),ZA=Xl({defaultModifiers:[Pa,cl,Jc,jl]}),nu=Xl({defaultModifiers:[Pa,cl,Jc,jl,kd,hs,eu,KA,Od]});const iu=Object.freeze(Object.defineProperty({__proto__:null,afterMain:xn,afterRead:Gi,afterWrite:Wl,applyStyles:jl,arrow:KA,auto:Lt,basePlacements:Dt,beforeMain:vr,beforeRead:Li,beforeWrite:xs,bottom:ot,clippingParents:An,computeStyles:Jc,createPopper:nu,createPopperBase:hl,createPopperLite:ZA,detectOverflow:Ua,end:rn,eventListeners:Pa,flip:hs,hide:Od,left:ut,main:Ln,modifierPhases:ol,offset:kd,placements:tr,popper:Tn,popperGenerator:Xl,popperOffsets:cl,preventOverflow:eu,read:$n,reference:Ki,right:He,start:Yt,top:qe,variationPlacements:ui,viewport:dn,write:Vl},Symbol.toStringTag,{value:"Module"})),nr="dropdown",Io=".bs.dropdown",ru=".data-api",ul="ArrowUp",To="ArrowDown",Bo=`hide${Io}`,su=`hidden${Io}`,dl=`show${Io}`,Qd=`shown${Io}`,Bg=`click${Io}${ru}`,au=`keydown${Io}${ru}`,ou=`keyup${Io}${ru}`,Na="show",Fa='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',eh=`${Fa}.${Na}`,pl=".dropdown-menu",Gd=T()?"top-end":"top-start",lu=T()?"top-start":"top-end",Hd=T()?"bottom-end":"bottom-start",cu=T()?"bottom-start":"bottom-end",hu=T()?"left-start":"right-start",uu=T()?"right-start":"left-start",th={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},zd={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Ds extends lt{constructor(I,V){super(I,V),this._popper=null,this._parent=this._element.parentNode,this._menu=Z.next(this._element,pl)[0]||Z.prev(this._element,pl)[0]||Z.findOne(pl,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return th}static get DefaultType(){return zd}static get NAME(){return nr}toggle(){return this._isShown()?this.hide():this.show()}show(){if(g(this._element)||this._isShown())return;const I={relatedTarget:this._element};if(!me.trigger(this._element,dl,I).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const V of[].concat(...document.body.children))me.on(V,"mouseover",x);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Na),this._element.classList.add(Na),me.trigger(this._element,Qd,I)}}hide(){if(g(this._element)||!this._isShown())return;const I={relatedTarget:this._element};this._completeHide(I)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(I){if(!me.trigger(this._element,Bo,I).defaultPrevented){if("ontouchstart"in document.documentElement)for(const V of[].concat(...document.body.children))me.off(V,"mouseover",x);this._popper&&this._popper.destroy(),this._menu.classList.remove(Na),this._element.classList.remove(Na),this._element.setAttribute("aria-expanded","false"),$e.removeDataAttribute(this._menu,"popper"),me.trigger(this._element,su,I)}}_getConfig(I){if(typeof(I=super._getConfig(I)).reference=="object"&&!h(I.reference)&&typeof I.reference.getBoundingClientRect!="function")throw new TypeError(`${nr.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return I}_createPopper(){if(iu===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let I=this._element;this._config.reference==="parent"?I=this._parent:h(this._config.reference)?I=d(this._config.reference):typeof this._config.reference=="object"&&(I=this._config.reference);const V=this._getPopperConfig();this._popper=nu(I,this._menu,V)}_isShown(){return this._menu.classList.contains(Na)}_getPlacement(){const I=this._parent;if(I.classList.contains("dropend"))return hu;if(I.classList.contains("dropstart"))return uu;if(I.classList.contains("dropup-center"))return"top";if(I.classList.contains("dropdown-center"))return"bottom";const V=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return I.classList.contains("dropup")?V?lu:Gd:V?cu:Hd}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:I}=this._config;return typeof I=="string"?I.split(",").map(V=>Number.parseInt(V,10)):typeof I=="function"?V=>I(V,this._element):I}_getPopperConfig(){const I={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&($e.setDataAttribute(this._menu,"popper","static"),I.modifiers=[{name:"applyStyles",enabled:!1}]),{...I,...U(this._config.popperConfig,[I])}}_selectMenuItem({key:I,target:V}){const te=Z.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(Ie=>f(Ie));te.length&&z(te,V,I===To,!te.includes(V)).focus()}static jQueryInterface(I){return this.each(function(){const V=Ds.getOrCreateInstance(this,I);if(typeof I=="string"){if(V[I]===void 0)throw new TypeError(`No method named "${I}"`);V[I]()}})}static clearMenus(I){if(I.button===2||I.type==="keyup"&&I.key!=="Tab")return;const V=Z.find(eh);for(const te of V){const Ie=Ds.getInstance(te);if(!Ie||Ie._config.autoClose===!1)continue;const Be=I.composedPath(),et=Be.includes(Ie._menu);if(Be.includes(Ie._element)||Ie._config.autoClose==="inside"&&!et||Ie._config.autoClose==="outside"&&et||Ie._menu.contains(I.target)&&(I.type==="keyup"&&I.key==="Tab"||/input|select|option|textarea|form/i.test(I.target.tagName)))continue;const At={relatedTarget:Ie._element};I.type==="click"&&(At.clickEvent=I),Ie._completeHide(At)}}static dataApiKeydownHandler(I){const V=/input|textarea/i.test(I.target.tagName),te=I.key==="Escape",Ie=[ul,To].includes(I.key);if(!Ie&&!te||V&&!te)return;I.preventDefault();const Be=this.matches(Fa)?this:Z.prev(this,Fa)[0]||Z.next(this,Fa)[0]||Z.findOne(Fa,I.delegateTarget.parentNode),et=Ds.getOrCreateInstance(Be);if(Ie)return I.stopPropagation(),et.show(),void et._selectMenuItem(I);et._isShown()&&(I.stopPropagation(),et.hide(),Be.focus())}}me.on(document,au,Fa,Ds.dataApiKeydownHandler),me.on(document,au,pl,Ds.dataApiKeydownHandler),me.on(document,Bg,Ds.clearMenus),me.on(document,ou,Ds.clearMenus),me.on(document,Bg,Fa,function(R){R.preventDefault(),Ds.getOrCreateInstance(this).toggle()}),P(Ds);const du="backdrop",Yl="show",pu=`mousedown.bs.${du}`,Vd={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Wd={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Au extends pt{constructor(I){super(),this._config=this._getConfig(I),this._isAppended=!1,this._element=null}static get Default(){return Vd}static get DefaultType(){return Wd}static get NAME(){return du}show(I){if(!this._config.isVisible)return void U(I);this._append();const V=this._getElement();this._config.isAnimated&&b(V),V.classList.add(Yl),this._emulateAnimation(()=>{U(I)})}hide(I){this._config.isVisible?(this._getElement().classList.remove(Yl),this._emulateAnimation(()=>{this.dispose(),U(I)})):U(I)}dispose(){this._isAppended&&(me.off(this._element,pu),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const I=document.createElement("div");I.className=this._config.className,this._config.isAnimated&&I.classList.add("fade"),this._element=I}return this._element}_configAfterMerge(I){return I.rootElement=d(I.rootElement),I}_append(){if(this._isAppended)return;const I=this._getElement();this._config.rootElement.append(I),me.on(I,pu,()=>{U(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(I){D(I,this._getElement(),this._config.isAnimated)}}const Kl=".bs.focustrap",jd=`focusin${Kl}`,qd=`keydown.tab${Kl}`,fu="backward",Xd={autofocus:!0,trapElement:null},nh={autofocus:"boolean",trapElement:"element"};class mu extends pt{constructor(I){super(),this._config=this._getConfig(I),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Xd}static get DefaultType(){return nh}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),me.off(document,Kl),me.on(document,jd,I=>this._handleFocusin(I)),me.on(document,qd,I=>this._handleKeydown(I)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,me.off(document,Kl))}_handleFocusin(I){const{trapElement:V}=this._config;if(I.target===document||I.target===V||V.contains(I.target))return;const te=Z.focusableChildren(V);te.length===0?V.focus():this._lastTabNavDirection===fu?te[te.length-1].focus():te[0].focus()}_handleKeydown(I){I.key==="Tab"&&(this._lastTabNavDirection=I.shiftKey?fu:"forward")}}const ih=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Yd=".sticky-top",Jl="padding-right",gu="margin-right";class rh{constructor(){this._element=document.body}getWidth(){const I=document.documentElement.clientWidth;return Math.abs(window.innerWidth-I)}hide(){const I=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Jl,V=>V+I),this._setElementAttributes(ih,Jl,V=>V+I),this._setElementAttributes(Yd,gu,V=>V-I)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Jl),this._resetElementAttributes(ih,Jl),this._resetElementAttributes(Yd,gu)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(I,V,te){const Ie=this.getWidth();this._applyManipulationCallback(I,Be=>{if(Be!==this._element&&window.innerWidth>Be.clientWidth+Ie)return;this._saveInitialAttribute(Be,V);const et=window.getComputedStyle(Be).getPropertyValue(V);Be.style.setProperty(V,`${te(Number.parseFloat(et))}px`)})}_saveInitialAttribute(I,V){const te=I.style.getPropertyValue(V);te&&$e.setDataAttribute(I,V,te)}_resetElementAttributes(I,V){this._applyManipulationCallback(I,te=>{const Ie=$e.getDataAttribute(te,V);Ie!==null?($e.removeDataAttribute(te,V),te.style.setProperty(V,Ie)):te.style.removeProperty(V)})}_applyManipulationCallback(I,V){if(h(I))V(I);else for(const te of Z.find(I,this._element))V(te)}}const Ps=".bs.modal",Rg=`hide${Ps}`,Lg=`hidePrevented${Ps}`,$l=`hidden${Ps}`,Zl=`show${Ps}`,Kd=`shown${Ps}`,ec=`resize${Ps}`,tc=`click.dismiss${Ps}`,vu=`mousedown.dismiss${Ps}`,ef=`keydown.dismiss${Ps}`,tf=`click${Ps}.data-api`,nf="modal-open",Jd="show",sh="modal-static",Dg={backdrop:!0,focus:!0,keyboard:!0},Pg={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class nc extends lt{constructor(I,V){super(I,V),this._dialog=Z.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new rh,this._addEventListeners()}static get Default(){return Dg}static get DefaultType(){return Pg}static get NAME(){return"modal"}toggle(I){return this._isShown?this.hide():this.show(I)}show(I){this._isShown||this._isTransitioning||me.trigger(this._element,Zl,{relatedTarget:I}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(nf),this._adjustDialog(),this._backdrop.show(()=>this._showElement(I)))}hide(){this._isShown&&!this._isTransitioning&&(me.trigger(this._element,Rg).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Jd),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){me.off(window,Ps),me.off(this._dialog,Ps),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Au({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new mu({trapElement:this._element})}_showElement(I){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const V=Z.findOne(".modal-body",this._dialog);V&&(V.scrollTop=0),b(this._element),this._element.classList.add(Jd),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,me.trigger(this._element,Kd,{relatedTarget:I})},this._dialog,this._isAnimated())}_addEventListeners(){me.on(this._element,ef,I=>{I.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),me.on(window,ec,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),me.on(this._element,vu,I=>{me.one(this._element,tc,V=>{this._element===I.target&&this._element===V.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(nf),this._resetAdjustments(),this._scrollBar.reset(),me.trigger(this._element,$l)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(me.trigger(this._element,Lg).defaultPrevented)return;const I=this._element.scrollHeight>document.documentElement.clientHeight,V=this._element.style.overflowY;V==="hidden"||this._element.classList.contains(sh)||(I||(this._element.style.overflowY="hidden"),this._element.classList.add(sh),this._queueCallback(()=>{this._element.classList.remove(sh),this._queueCallback(()=>{this._element.style.overflowY=V},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const I=this._element.scrollHeight>document.documentElement.clientHeight,V=this._scrollBar.getWidth(),te=V>0;if(te&&!I){const Ie=T()?"paddingLeft":"paddingRight";this._element.style[Ie]=`${V}px`}if(!te&&I){const Ie=T()?"paddingRight":"paddingLeft";this._element.style[Ie]=`${V}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(I,V){return this.each(function(){const te=nc.getOrCreateInstance(this,I);if(typeof I=="string"){if(te[I]===void 0)throw new TypeError(`No method named "${I}"`);te[I](V)}})}}me.on(document,tf,'[data-bs-toggle="modal"]',function(R){const I=Z.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&R.preventDefault(),me.one(I,Zl,te=>{te.defaultPrevented||me.one(I,$l,()=>{f(this)&&this.focus()})});const V=Z.findOne(".modal.show");V&&nc.getInstance(V).hide(),nc.getOrCreateInstance(I).toggle(this)}),Ce(nc),P(nc);const Ro=".bs.offcanvas",Lo=".data-api",Ug=`load${Ro}${Lo}`,va="show",si="showing",xr="hiding",ah=".offcanvas.show",Di=`show${Ro}`,rx=`shown${Ro}`,ic=`hide${Ro}`,Ng=`hidePrevented${Ro}`,Fg=`hidden${Ro}`,sx=`resize${Ro}`,ax=`click${Ro}${Lo}`,ox=`keydown.dismiss${Ro}`,lx={backdrop:!0,keyboard:!0,scroll:!1},cx={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Do extends lt{constructor(I,V){super(I,V),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return lx}static get DefaultType(){return cx}static get NAME(){return"offcanvas"}toggle(I){return this._isShown?this.hide():this.show(I)}show(I){this._isShown||me.trigger(this._element,Di,{relatedTarget:I}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new rh().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(si),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(va),this._element.classList.remove(si),me.trigger(this._element,rx,{relatedTarget:I})},this._element,!0))}hide(){this._isShown&&(me.trigger(this._element,ic).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(xr),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(va,xr),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new rh().reset(),me.trigger(this._element,Fg)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const I=!!this._config.backdrop;return new Au({className:"offcanvas-backdrop",isVisible:I,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:I?()=>{this._config.backdrop!=="static"?this.hide():me.trigger(this._element,Ng)}:null})}_initializeFocusTrap(){return new mu({trapElement:this._element})}_addEventListeners(){me.on(this._element,ox,I=>{I.key==="Escape"&&(this._config.keyboard?this.hide():me.trigger(this._element,Ng))})}static jQueryInterface(I){return this.each(function(){const V=Do.getOrCreateInstance(this,I);if(typeof I=="string"){if(V[I]===void 0||I.startsWith("_")||I==="constructor")throw new TypeError(`No method named "${I}"`);V[I](this)}})}}me.on(document,ax,'[data-bs-toggle="offcanvas"]',function(R){const I=Z.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&R.preventDefault(),g(this))return;me.one(I,Fg,()=>{f(this)&&this.focus()});const V=Z.findOne(ah);V&&V!==I&&Do.getInstance(V).hide(),Do.getOrCreateInstance(I).toggle(this)}),me.on(window,Ug,()=>{for(const R of Z.find(ah))Do.getOrCreateInstance(R).show()}),me.on(window,sx,()=>{for(const R of Z.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(R).position!=="fixed"&&Do.getOrCreateInstance(R).hide()}),Ce(Do),P(Do);const Og={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},hx=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ux=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,dx=(R,I)=>{const V=R.nodeName.toLowerCase();return I.includes(V)?!hx.has(V)||!!ux.test(R.nodeValue):I.filter(te=>te instanceof RegExp).some(te=>te.test(V))},px={allowList:Og,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},rf={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},kg={entry:"(string|element|function|null)",selector:"(string|element)"};class Qg extends pt{constructor(I){super(),this._config=this._getConfig(I)}static get Default(){return px}static get DefaultType(){return rf}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(I=>this._resolvePossibleFunction(I)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(I){return this._checkContent(I),this._config.content={...this._config.content,...I},this}toHtml(){const I=document.createElement("div");I.innerHTML=this._maybeSanitize(this._config.template);for(const[Ie,Be]of Object.entries(this._config.content))this._setContent(I,Be,Ie);const V=I.children[0],te=this._resolvePossibleFunction(this._config.extraClass);return te&&V.classList.add(...te.split(" ")),V}_typeCheckConfig(I){super._typeCheckConfig(I),this._checkContent(I.content)}_checkContent(I){for(const[V,te]of Object.entries(I))super._typeCheckConfig({selector:V,entry:te},kg)}_setContent(I,V,te){const Ie=Z.findOne(te,I);Ie&&((V=this._resolvePossibleFunction(V))?h(V)?this._putElementInTemplate(d(V),Ie):this._config.html?Ie.innerHTML=this._maybeSanitize(V):Ie.textContent=V:Ie.remove())}_maybeSanitize(I){return this._config.sanitize?function(V,te,Ie){if(!V.length)return V;if(Ie&&typeof Ie=="function")return Ie(V);const Be=new window.DOMParser().parseFromString(V,"text/html"),et=[].concat(...Be.body.querySelectorAll("*"));for(const At of et){const Tt=At.nodeName.toLowerCase();if(!Object.keys(te).includes(Tt)){At.remove();continue}const zt=[].concat(...At.attributes),Ht=[].concat(te["*"]||[],te[Tt]||[]);for(const Pt of zt)dx(Pt,Ht)||At.removeAttribute(Pt.nodeName)}return Be.body.innerHTML}(I,this._config.allowList,this._config.sanitizeFn):I}_resolvePossibleFunction(I){return U(I,[this])}_putElementInTemplate(I,V){if(this._config.html)return V.innerHTML="",void V.append(I);V.textContent=I.textContent}}const Gg=new Set(["sanitize","allowList","sanitizeFn"]),yu="fade",Eu="show",sf=".modal",af="hide.bs.modal",oh="hover",rc="focus",Ax={AUTO:"auto",TOP:"top",RIGHT:T()?"left":"right",BOTTOM:"bottom",LEFT:T()?"right":"left"},fx={allowList:Og,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},mx={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class sc extends lt{constructor(I,V){if(iu===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(I,V),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return fx}static get DefaultType(){return mx}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),me.off(this._element.closest(sf),af,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const I=me.trigger(this._element,this.constructor.eventName("show")),V=(y(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(I.defaultPrevented||!V)return;this._disposePopper();const te=this._getTipElement();this._element.setAttribute("aria-describedby",te.getAttribute("id"));const{container:Ie}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(Ie.append(te),me.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(te),te.classList.add(Eu),"ontouchstart"in document.documentElement)for(const Be of[].concat(...document.body.children))me.on(Be,"mouseover",x);this._queueCallback(()=>{me.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!me.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Eu),"ontouchstart"in document.documentElement)for(const I of[].concat(...document.body.children))me.off(I,"mouseover",x);this._activeTrigger.click=!1,this._activeTrigger[rc]=!1,this._activeTrigger[oh]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),me.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(I){const V=this._getTemplateFactory(I).toHtml();if(!V)return null;V.classList.remove(yu,Eu),V.classList.add(`bs-${this.constructor.NAME}-auto`);const te=(Ie=>{do Ie+=Math.floor(1e6*Math.random());while(document.getElementById(Ie));return Ie})(this.constructor.NAME).toString();return V.setAttribute("id",te),this._isAnimated()&&V.classList.add(yu),V}setContent(I){this._newContent=I,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(I){return this._templateFactory?this._templateFactory.changeContent(I):this._templateFactory=new Qg({...this._config,content:I,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(I){return this.constructor.getOrCreateInstance(I.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(yu)}_isShown(){return this.tip&&this.tip.classList.contains(Eu)}_createPopper(I){const V=U(this._config.placement,[this,I,this._element]),te=Ax[V.toUpperCase()];return nu(this._element,I,this._getPopperConfig(te))}_getOffset(){const{offset:I}=this._config;return typeof I=="string"?I.split(",").map(V=>Number.parseInt(V,10)):typeof I=="function"?V=>I(V,this._element):I}_resolvePossibleFunction(I){return U(I,[this._element])}_getPopperConfig(I){const V={placement:I,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:te=>{this._getTipElement().setAttribute("data-popper-placement",te.state.placement)}}]};return{...V,...U(this._config.popperConfig,[V])}}_setListeners(){const I=this._config.trigger.split(" ");for(const V of I)if(V==="click")me.on(this._element,this.constructor.eventName("click"),this._config.selector,te=>{this._initializeOnDelegatedTarget(te).toggle()});else if(V!=="manual"){const te=V===oh?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),Ie=V===oh?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");me.on(this._element,te,this._config.selector,Be=>{const et=this._initializeOnDelegatedTarget(Be);et._activeTrigger[Be.type==="focusin"?rc:oh]=!0,et._enter()}),me.on(this._element,Ie,this._config.selector,Be=>{const et=this._initializeOnDelegatedTarget(Be);et._activeTrigger[Be.type==="focusout"?rc:oh]=et._element.contains(Be.relatedTarget),et._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},me.on(this._element.closest(sf),af,this._hideModalHandler)}_fixTitle(){const I=this._element.getAttribute("title");I&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",I),this._element.setAttribute("data-bs-original-title",I),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(I,V){clearTimeout(this._timeout),this._timeout=setTimeout(I,V)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(I){const V=$e.getDataAttributes(this._element);for(const te of Object.keys(V))Gg.has(te)&&delete V[te];return I={...V,...typeof I=="object"&&I?I:{}},I=this._mergeConfigObj(I),I=this._configAfterMerge(I),this._typeCheckConfig(I),I}_configAfterMerge(I){return I.container=I.container===!1?document.body:d(I.container),typeof I.delay=="number"&&(I.delay={show:I.delay,hide:I.delay}),typeof I.title=="number"&&(I.title=I.title.toString()),typeof I.content=="number"&&(I.content=I.content.toString()),I}_getDelegateConfig(){const I={};for(const[V,te]of Object.entries(this._config))this.constructor.Default[V]!==te&&(I[V]=te);return I.selector=!1,I.trigger="manual",I}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(I){return this.each(function(){const V=sc.getOrCreateInstance(this,I);if(typeof I=="string"){if(V[I]===void 0)throw new TypeError(`No method named "${I}"`);V[I]()}})}}P(sc);const gx={...sc.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},vx={...sc.DefaultType,content:"(null|string|element|function)"};class $d extends sc{static get Default(){return gx}static get DefaultType(){return vx}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(I){return this.each(function(){const V=$d.getOrCreateInstance(this,I);if(typeof I=="string"){if(V[I]===void 0)throw new TypeError(`No method named "${I}"`);V[I]()}})}}P($d);const of=".bs.scrollspy",yx=`activate${of}`,xu=`click${of}`,ya=`load${of}.data-api`,no="active",lf="[href]",Oa=".nav-link",us=`${Oa}, .nav-item > ${Oa}, .list-group-item`,Hg={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},ac={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class io extends lt{constructor(I,V){super(I,V),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Hg}static get DefaultType(){return ac}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const I of this._observableSections.values())this._observer.observe(I)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(I){return I.target=d(I.target)||document.body,I.rootMargin=I.offset?`${I.offset}px 0px -30%`:I.rootMargin,typeof I.threshold=="string"&&(I.threshold=I.threshold.split(",").map(V=>Number.parseFloat(V))),I}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(me.off(this._config.target,xu),me.on(this._config.target,xu,lf,I=>{const V=this._observableSections.get(I.target.hash);if(V){I.preventDefault();const te=this._rootElement||window,Ie=V.offsetTop-this._element.offsetTop;if(te.scrollTo)return void te.scrollTo({top:Ie,behavior:"smooth"});te.scrollTop=Ie}}))}_getNewObserver(){const I={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(V=>this._observerCallback(V),I)}_observerCallback(I){const V=et=>this._targetLinks.get(`#${et.target.id}`),te=et=>{this._previousScrollData.visibleEntryTop=et.target.offsetTop,this._process(V(et))},Ie=(this._rootElement||document.documentElement).scrollTop,Be=Ie>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Ie;for(const et of I){if(!et.isIntersecting){this._activeTarget=null,this._clearActiveClass(V(et));continue}const At=et.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Be&&At){if(te(et),!Ie)return}else Be||At||te(et)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const I=Z.find(lf,this._config.target);for(const V of I){if(!V.hash||g(V))continue;const te=Z.findOne(decodeURI(V.hash),this._element);f(te)&&(this._targetLinks.set(decodeURI(V.hash),V),this._observableSections.set(V.hash,te))}}_process(I){this._activeTarget!==I&&(this._clearActiveClass(this._config.target),this._activeTarget=I,I.classList.add(no),this._activateParents(I),me.trigger(this._element,yx,{relatedTarget:I}))}_activateParents(I){if(I.classList.contains("dropdown-item"))Z.findOne(".dropdown-toggle",I.closest(".dropdown")).classList.add(no);else for(const V of Z.parents(I,".nav, .list-group"))for(const te of Z.prev(V,us))te.classList.add(no)}_clearActiveClass(I){I.classList.remove(no);const V=Z.find(`${lf}.${no}`,I);for(const te of V)te.classList.remove(no)}static jQueryInterface(I){return this.each(function(){const V=io.getOrCreateInstance(this,I);if(typeof I=="string"){if(V[I]===void 0||I.startsWith("_")||I==="constructor")throw new TypeError(`No method named "${I}"`);V[I]()}})}}me.on(window,ya,()=>{for(const R of Z.find('[data-bs-spy="scroll"]'))io.getOrCreateInstance(R)}),P(io);const Pr=".bs.tab",Rn=`hide${Pr}`,cf=`hidden${Pr}`,_u=`show${Pr}`,ws=`shown${Pr}`,Nn=`click${Pr}`,Tr=`keydown${Pr}`,ct=`load${Pr}`,wn="ArrowLeft",Zd="ArrowRight",zg="ArrowUp",Vg="ArrowDown",Al="Home",lh="End",fl="active",hf="fade",ml="show",uf=".dropdown-toggle",ep=`:not(${uf})`,Wg='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Dn=`.nav-link${ep}, .list-group-item${ep}, [role="tab"]${ep}, ${Wg}`,Po=`.${fl}[data-bs-toggle="tab"], .${fl}[data-bs-toggle="pill"], .${fl}[data-bs-toggle="list"]`;class Ea extends lt{constructor(I){super(I),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),me.on(this._element,Tr,V=>this._keydown(V)))}static get NAME(){return"tab"}show(){const I=this._element;if(this._elemIsActive(I))return;const V=this._getActiveElem(),te=V?me.trigger(V,Rn,{relatedTarget:I}):null;me.trigger(I,_u,{relatedTarget:V}).defaultPrevented||te&&te.defaultPrevented||(this._deactivate(V,I),this._activate(I,V))}_activate(I,V){I&&(I.classList.add(fl),this._activate(Z.getElementFromSelector(I)),this._queueCallback(()=>{I.getAttribute("role")==="tab"?(I.removeAttribute("tabindex"),I.setAttribute("aria-selected",!0),this._toggleDropDown(I,!0),me.trigger(I,ws,{relatedTarget:V})):I.classList.add(ml)},I,I.classList.contains(hf)))}_deactivate(I,V){I&&(I.classList.remove(fl),I.blur(),this._deactivate(Z.getElementFromSelector(I)),this._queueCallback(()=>{I.getAttribute("role")==="tab"?(I.setAttribute("aria-selected",!1),I.setAttribute("tabindex","-1"),this._toggleDropDown(I,!1),me.trigger(I,cf,{relatedTarget:V})):I.classList.remove(ml)},I,I.classList.contains(hf)))}_keydown(I){if(![wn,Zd,zg,Vg,Al,lh].includes(I.key))return;I.stopPropagation(),I.preventDefault();const V=this._getChildren().filter(Ie=>!g(Ie));let te;if([Al,lh].includes(I.key))te=V[I.key===Al?0:V.length-1];else{const Ie=[Zd,Vg].includes(I.key);te=z(V,I.target,Ie,!0)}te&&(te.focus({preventScroll:!0}),Ea.getOrCreateInstance(te).show())}_getChildren(){return Z.find(Dn,this._parent)}_getActiveElem(){return this._getChildren().find(I=>this._elemIsActive(I))||null}_setInitialAttributes(I,V){this._setAttributeIfNotExists(I,"role","tablist");for(const te of V)this._setInitialAttributesOnChild(te)}_setInitialAttributesOnChild(I){I=this._getInnerElement(I);const V=this._elemIsActive(I),te=this._getOuterElement(I);I.setAttribute("aria-selected",V),te!==I&&this._setAttributeIfNotExists(te,"role","presentation"),V||I.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(I,"role","tab"),this._setInitialAttributesOnTargetPanel(I)}_setInitialAttributesOnTargetPanel(I){const V=Z.getElementFromSelector(I);V&&(this._setAttributeIfNotExists(V,"role","tabpanel"),I.id&&this._setAttributeIfNotExists(V,"aria-labelledby",`${I.id}`))}_toggleDropDown(I,V){const te=this._getOuterElement(I);if(!te.classList.contains("dropdown"))return;const Ie=(Be,et)=>{const At=Z.findOne(Be,te);At&&At.classList.toggle(et,V)};Ie(uf,fl),Ie(".dropdown-menu",ml),te.setAttribute("aria-expanded",V)}_setAttributeIfNotExists(I,V,te){I.hasAttribute(V)||I.setAttribute(V,te)}_elemIsActive(I){return I.classList.contains(fl)}_getInnerElement(I){return I.matches(Dn)?I:Z.findOne(Dn,I)}_getOuterElement(I){return I.closest(".nav-item, .list-group-item")||I}static jQueryInterface(I){return this.each(function(){const V=Ea.getOrCreateInstance(this);if(typeof I=="string"){if(V[I]===void 0||I.startsWith("_")||I==="constructor")throw new TypeError(`No method named "${I}"`);V[I]()}})}}me.on(document,Nn,Wg,function(R){["A","AREA"].includes(this.tagName)&&R.preventDefault(),g(this)||Ea.getOrCreateInstance(this).show()}),me.on(window,ct,()=>{for(const R of Z.find(Po))Ea.getOrCreateInstance(R)}),P(Ea);const qs=".bs.toast",jg=`mouseover${qs}`,Ex=`mouseout${qs}`,ka=`focusin${qs}`,df=`focusout${qs}`,xx=`hide${qs}`,Pi=`hidden${qs}`,pi=`show${qs}`,tp=`shown${qs}`,Us="hide",gl="show",np="showing",bu={animation:"boolean",autohide:"boolean",delay:"number"},_x={animation:!0,autohide:!0,delay:5e3};class ai extends lt{constructor(I,V){super(I,V),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return _x}static get DefaultType(){return bu}static get NAME(){return"toast"}show(){me.trigger(this._element,pi).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Us),b(this._element),this._element.classList.add(gl,np),this._queueCallback(()=>{this._element.classList.remove(np),me.trigger(this._element,tp),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(me.trigger(this._element,xx).defaultPrevented||(this._element.classList.add(np),this._queueCallback(()=>{this._element.classList.add(Us),this._element.classList.remove(np,gl),me.trigger(this._element,Pi)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(gl),super.dispose()}isShown(){return this._element.classList.contains(gl)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(I,V){switch(I.type){case"mouseover":case"mouseout":this._hasMouseInteraction=V;break;case"focusin":case"focusout":this._hasKeyboardInteraction=V}if(V)return void this._clearTimeout();const te=I.relatedTarget;this._element===te||this._element.contains(te)||this._maybeScheduleHide()}_setListeners(){me.on(this._element,jg,I=>this._onInteraction(I,!0)),me.on(this._element,Ex,I=>this._onInteraction(I,!1)),me.on(this._element,ka,I=>this._onInteraction(I,!0)),me.on(this._element,df,I=>this._onInteraction(I,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(I){return this.each(function(){const V=ai.getOrCreateInstance(this,I);if(typeof I=="string"){if(V[I]===void 0)throw new TypeError(`No method named "${I}"`);V[I](this)}})}}return Ce(ai),P(ai),{Alert:pe,Button:Ye,Carousel:Za,Collapse:Ge,Dropdown:Ds,Modal:nc,Offcanvas:Do,Popover:$d,ScrollSpy:io,Tab:Ea,Toast:ai,Tooltip:sc}});/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const J5=(p,t)=>t.kind==="method"&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(i){i.createProperty(t.key,p)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){typeof t.initializer=="function"&&(this[t.key]=t.initializer.call(this))},finisher(i){i.createProperty(t.key,p)}};function Cn(p){return(t,i)=>i!==void 0?((o,l,h)=>{l.constructor.createProperty(h,o)})(p,t,i):J5(p,t);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}var IC;(IC=window.HTMLSlotElement)===null||IC===void 0||IC.prototype.assignedElements;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ny="169",$5=0,Z5=1,eG=2,sd=100,tG=101,nG=102,iG=200,rG=201,sG=202,aG=203,oG=204,lG=205,cG=206,hG=207,uG=208,dG=209,pG=210,AG=211,fG=212,mG=213,gG=214,vG=0,yG=1,EG=2,xG=3,_G=4,bG=5,CG=6,wG=7,BR="attached",Fp=300,ad=301,Op=302,iy=303,ry=306,Sl=1e3,rs=1001,kp=1002,fs=1003,sy=1004,od=1005,Fi=1006,Qp=1007,mo=1008,Rr=1009,TC=1010,BC=1011,vm=1012,ay=1013,Th=1014,Wr=1015,ss=1016,RC=1017,LC=1018,Gp=1020,RR=35902,fr=1023,ym=1026,Hp=1027,Bh=1028,DC=1029,ld=1030,PC=1031,UC=1033,oy=33776,Em=33777,ly=33778,xm=33779,cy=35840,NC=35841,hy=35842,FC=35843,uy=36196,dy=37492,py=37496,_m=37808,OC=37809,kC=37810,QC=37811,bm=37812,GC=37813,HC=37814,zC=37815,VC=37816,WC=37817,jC=37818,qC=37819,XC=37820,YC=37821,Cm=36492,KC=36494,JC=36495,$C=36284,ZC=36285,ew=36286,LR=2201,tw=2202,zp=2300,Vp=2301,nw=2302,Wp=2400,jp=2401,Ay=2402,MG=2500,Sc="",sr="srgb",Yi="srgb-linear",fy="display-p3",wm="display-p3-linear",my="linear",ar="srgb",gy="rec709",vy="p3",qp=7680,SG=512,IG=513,TG=514,BG=515,RG=516,LG=517,DG=518,PG=519,iw=35044,DR="300 es",Xp=2e3,yy=2001;class Xo{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const o=this._listeners;o[t]===void 0&&(o[t]=[]),o[t].indexOf(i)===-1&&o[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const o=this._listeners;return o[t]!==void 0&&o[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const o=this._listeners[t];if(o!==void 0){const l=o.indexOf(i);l!==-1&&o.splice(l,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const o=i.slice(0);for(let l=0,h=o.length;l<h;l++)o[l].call(this,t);t.target=null}}}const ks=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let PR=1234567;const Mm=Math.PI/180,Yp=180/Math.PI;function Yo(){const p=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=4294967295*Math.random()|0;return(ks[255&p]+ks[p>>8&255]+ks[p>>16&255]+ks[p>>24&255]+"-"+ks[255&t]+ks[t>>8&255]+"-"+ks[t>>16&15|64]+ks[t>>24&255]+"-"+ks[63&i|128]+ks[i>>8&255]+"-"+ks[i>>16&255]+ks[i>>24&255]+ks[255&o]+ks[o>>8&255]+ks[o>>16&255]+ks[o>>24&255]).toLowerCase()}function ms(p,t,i){return Math.max(t,Math.min(i,p))}function rw(p,t){return(p%t+t)%t}function Sm(p,t,i){return(1-i)*p+i*t}function Ko(p,t){switch(t.constructor){case Float32Array:return p;case Uint32Array:return p/4294967295;case Uint16Array:return p/65535;case Uint8Array:return p/255;case Int32Array:return Math.max(p/2147483647,-1);case Int16Array:return Math.max(p/32767,-1);case Int8Array:return Math.max(p/127,-1);default:throw new Error("Invalid component type.")}}function zi(p,t){switch(t.constructor){case Float32Array:return p;case Uint32Array:return Math.round(4294967295*p);case Uint16Array:return Math.round(65535*p);case Uint8Array:return Math.round(255*p);case Int32Array:return Math.round(2147483647*p);case Int16Array:return Math.round(32767*p);case Int8Array:return Math.round(127*p);default:throw new Error("Invalid component type.")}}const Ey={DEG2RAD:Mm,RAD2DEG:Yp,generateUUID:Yo,clamp:ms,euclideanModulo:rw,mapLinear:function(p,t,i,o,l){return o+(p-t)*(l-o)/(i-t)},inverseLerp:function(p,t,i){return p!==t?(i-p)/(t-p):0},lerp:Sm,damp:function(p,t,i,o){return Sm(p,t,1-Math.exp(-i*o))},pingpong:function(p,t=1){return t-Math.abs(rw(p,2*t)-t)},smoothstep:function(p,t,i){return p<=t?0:p>=i?1:(p=(p-t)/(i-t))*p*(3-2*p)},smootherstep:function(p,t,i){return p<=t?0:p>=i?1:(p=(p-t)/(i-t))*p*p*(p*(6*p-15)+10)},randInt:function(p,t){return p+Math.floor(Math.random()*(t-p+1))},randFloat:function(p,t){return p+Math.random()*(t-p)},randFloatSpread:function(p){return p*(.5-Math.random())},seededRandom:function(p){p!==void 0&&(PR=p);let t=PR+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(p){return p*Mm},radToDeg:function(p){return p*Yp},isPowerOfTwo:function(p){return!(p&p-1)&&p!==0},ceilPowerOfTwo:function(p){return Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},floorPowerOfTwo:function(p){return Math.pow(2,Math.floor(Math.log(p)/Math.LN2))},setQuaternionFromProperEuler:function(p,t,i,o,l){const h=Math.cos,d=Math.sin,f=h(i/2),g=d(i/2),y=h((t+o)/2),x=d((t+o)/2),b=h((t-o)/2),_=d((t-o)/2),w=h((o-t)/2),T=d((o-t)/2);switch(l){case"XYX":p.set(f*x,g*b,g*_,f*y);break;case"YZY":p.set(g*_,f*x,g*b,f*y);break;case"ZXZ":p.set(g*b,g*_,f*x,f*y);break;case"XZX":p.set(f*x,g*T,g*w,f*y);break;case"YXY":p.set(g*w,f*x,g*T,f*y);break;case"ZYZ":p.set(g*T,g*w,f*x,f*y);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+l)}},normalize:zi,denormalize:Ko};class Hn{constructor(t=0,i=0){Hn.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,o=this.y,l=t.elements;return this.x=l[0]*i+l[3]*o+l[6],this.y=l[1]*i+l[4]*o+l[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(i,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const o=this.dot(t)/i;return Math.acos(ms(o,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,o=this.y-t.y;return i*i+o*o}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,o){return this.x=t.x+(i.x-t.x)*o,this.y=t.y+(i.y-t.y)*o,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const o=Math.cos(i),l=Math.sin(i),h=this.x-t.x,d=this.y-t.y;return this.x=h*o-d*l+t.x,this.y=h*l+d*o+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class zn{constructor(t,i,o,l,h,d,f,g,y){zn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,o,l,h,d,f,g,y)}set(t,i,o,l,h,d,f,g,y){const x=this.elements;return x[0]=t,x[1]=l,x[2]=f,x[3]=i,x[4]=h,x[5]=g,x[6]=o,x[7]=d,x[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,o=t.elements;return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],this}extractBasis(t,i,o){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),o.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const o=t.elements,l=i.elements,h=this.elements,d=o[0],f=o[3],g=o[6],y=o[1],x=o[4],b=o[7],_=o[2],w=o[5],T=o[8],P=l[0],U=l[3],D=l[6],z=l[1],G=l[4],Q=l[7],Y=l[2],q=l[5],K=l[8];return h[0]=d*P+f*z+g*Y,h[3]=d*U+f*G+g*q,h[6]=d*D+f*Q+g*K,h[1]=y*P+x*z+b*Y,h[4]=y*U+x*G+b*q,h[7]=y*D+x*Q+b*K,h[2]=_*P+w*z+T*Y,h[5]=_*U+w*G+T*q,h[8]=_*D+w*Q+T*K,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],o=t[1],l=t[2],h=t[3],d=t[4],f=t[5],g=t[6],y=t[7],x=t[8];return i*d*x-i*f*y-o*h*x+o*f*g+l*h*y-l*d*g}invert(){const t=this.elements,i=t[0],o=t[1],l=t[2],h=t[3],d=t[4],f=t[5],g=t[6],y=t[7],x=t[8],b=x*d-f*y,_=f*g-x*h,w=y*h-d*g,T=i*b+o*_+l*w;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);const P=1/T;return t[0]=b*P,t[1]=(l*y-x*o)*P,t[2]=(f*o-l*d)*P,t[3]=_*P,t[4]=(x*i-l*g)*P,t[5]=(l*h-f*i)*P,t[6]=w*P,t[7]=(o*g-y*i)*P,t[8]=(d*i-o*h)*P,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,o,l,h,d,f){const g=Math.cos(h),y=Math.sin(h);return this.set(o*g,o*y,-o*(g*d+y*f)+d+t,-l*y,l*g,-l*(-y*d+g*f)+f+i,0,0,1),this}scale(t,i){return this.premultiply(sw.makeScale(t,i)),this}rotate(t){return this.premultiply(sw.makeRotation(-t)),this}translate(t,i){return this.premultiply(sw.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),o=Math.sin(t);return this.set(i,-o,0,o,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,o=t.elements;for(let l=0;l<9;l++)if(i[l]!==o[l])return!1;return!0}fromArray(t,i=0){for(let o=0;o<9;o++)this.elements[o]=t[o+i];return this}toArray(t=[],i=0){const o=this.elements;return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],t[i+4]=o[4],t[i+5]=o[5],t[i+6]=o[6],t[i+7]=o[7],t[i+8]=o[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const sw=new zn;function UR(p){for(let t=p.length-1;t>=0;--t)if(p[t]>=65535)return!0;return!1}function Im(p){return document.createElementNS("http://www.w3.org/1999/xhtml",p)}function UG(){const p=Im("canvas");return p.style.display="block",p}const NR={};function xy(p){p in NR||(NR[p]=!0,console.warn(p))}const FR=new zn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),OR=new zn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Tm={[Yi]:{transfer:my,primaries:gy,luminanceCoefficients:[.2126,.7152,.0722],toReference:p=>p,fromReference:p=>p},[sr]:{transfer:ar,primaries:gy,luminanceCoefficients:[.2126,.7152,.0722],toReference:p=>p.convertSRGBToLinear(),fromReference:p=>p.convertLinearToSRGB()},[wm]:{transfer:my,primaries:vy,luminanceCoefficients:[.2289,.6917,.0793],toReference:p=>p.applyMatrix3(OR),fromReference:p=>p.applyMatrix3(FR)},[fy]:{transfer:ar,primaries:vy,luminanceCoefficients:[.2289,.6917,.0793],toReference:p=>p.convertSRGBToLinear().applyMatrix3(OR),fromReference:p=>p.applyMatrix3(FR).convertLinearToSRGB()}},NG=new Set([Yi,wm]),Si={enabled:!0,_workingColorSpace:Yi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(p){if(!NG.has(p))throw new Error(`Unsupported working color space, "${p}".`);this._workingColorSpace=p},convert:function(p,t,i){if(this.enabled===!1||t===i||!t||!i)return p;const o=Tm[t].toReference;return(0,Tm[i].fromReference)(o(p))},fromWorkingColorSpace:function(p,t){return this.convert(p,this._workingColorSpace,t)},toWorkingColorSpace:function(p,t){return this.convert(p,t,this._workingColorSpace)},getPrimaries:function(p){return Tm[p].primaries},getTransfer:function(p){return p===Sc?my:Tm[p].transfer},getLuminanceCoefficients:function(p,t=this._workingColorSpace){return p.fromArray(Tm[t].luminanceCoefficients)}};function Kp(p){return p<.04045?.0773993808*p:Math.pow(.9478672986*p+.0521327014,2.4)}function aw(p){return p<.0031308?12.92*p:1.055*Math.pow(p,.41666)-.055}let Jp;class FG{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Jp===void 0&&(Jp=Im("canvas")),Jp.width=t.width,Jp.height=t.height;const o=Jp.getContext("2d");t instanceof ImageData?o.putImageData(t,0,0):o.drawImage(t,0,0,t.width,t.height),i=Jp}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=Im("canvas");i.width=t.width,i.height=t.height;const o=i.getContext("2d");o.drawImage(t,0,0,t.width,t.height);const l=o.getImageData(0,0,t.width,t.height),h=l.data;for(let d=0;d<h.length;d++)h[d]=255*Kp(h[d]/255);return o.putImageData(l,0,0),i}if(t.data){const i=t.data.slice(0);for(let o=0;o<i.length;o++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[o]=Math.floor(255*Kp(i[o]/255)):i[o]=Kp(i[o]);return{data:i,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let OG=0;class ow{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:OG++}),this.uuid=Yo(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const o={uuid:this.uuid,url:""},l=this.data;if(l!==null){let h;if(Array.isArray(l)){h=[];for(let d=0,f=l.length;d<f;d++)l[d].isDataTexture?h.push(lw(l[d].image)):h.push(lw(l[d]))}else h=lw(l);o.url=h}return i||(t.images[this.uuid]=o),o}}function lw(p){return typeof HTMLImageElement<"u"&&p instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&p instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&p instanceof ImageBitmap?FG.getDataURL(p):p.data?{data:Array.from(p.data),width:p.width,height:p.height,type:p.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kG=0;class qi extends Xo{constructor(t=qi.DEFAULT_IMAGE,i=qi.DEFAULT_MAPPING,o=1001,l=1001,h=1006,d=1008,f=1023,g=1009,y=qi.DEFAULT_ANISOTROPY,x=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kG++}),this.uuid=Yo(),this.name="",this.source=new ow(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=o,this.wrapT=l,this.magFilter=h,this.minFilter=d,this.anisotropy=y,this.format=f,this.internalFormat=null,this.type=g,this.offset=new Hn(0,0),this.repeat=new Hn(1,1),this.center=new Hn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const o={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(o.userData=this.userData),i||(t.textures[this.uuid]=o),o}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Fp)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Sl:t.x=t.x-Math.floor(t.x);break;case rs:t.x=t.x<0?0:1;break;case kp:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Sl:t.y=t.y-Math.floor(t.y);break;case rs:t.y=t.y<0?0:1;break;case kp:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}qi.DEFAULT_IMAGE=null,qi.DEFAULT_MAPPING=Fp,qi.DEFAULT_ANISOTROPY=1;class Oi{constructor(t=0,i=0,o=0,l=1){Oi.prototype.isVector4=!0,this.x=t,this.y=i,this.z=o,this.w=l}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,o,l){return this.x=t,this.y=i,this.z=o,this.w=l,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,o=this.y,l=this.z,h=this.w,d=t.elements;return this.x=d[0]*i+d[4]*o+d[8]*l+d[12]*h,this.y=d[1]*i+d[5]*o+d[9]*l+d[13]*h,this.z=d[2]*i+d[6]*o+d[10]*l+d[14]*h,this.w=d[3]*i+d[7]*o+d[11]*l+d[15]*h,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,o,l,h;const g=t.elements,y=g[0],x=g[4],b=g[8],_=g[1],w=g[5],T=g[9],P=g[2],U=g[6],D=g[10];if(Math.abs(x-_)<.01&&Math.abs(b-P)<.01&&Math.abs(T-U)<.01){if(Math.abs(x+_)<.1&&Math.abs(b+P)<.1&&Math.abs(T+U)<.1&&Math.abs(y+w+D-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const G=(y+1)/2,Q=(w+1)/2,Y=(D+1)/2,q=(x+_)/4,K=(b+P)/4,ne=(T+U)/4;return G>Q&&G>Y?G<.01?(o=0,l=.707106781,h=.707106781):(o=Math.sqrt(G),l=q/o,h=K/o):Q>Y?Q<.01?(o=.707106781,l=0,h=.707106781):(l=Math.sqrt(Q),o=q/l,h=ne/l):Y<.01?(o=.707106781,l=.707106781,h=0):(h=Math.sqrt(Y),o=K/h,l=ne/h),this.set(o,l,h,i),this}let z=Math.sqrt((U-T)*(U-T)+(b-P)*(b-P)+(_-x)*(_-x));return Math.abs(z)<.001&&(z=1),this.x=(U-T)/z,this.y=(b-P)/z,this.z=(_-x)/z,this.w=Math.acos((y+w+D-1)/2),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(i,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,o){return this.x=t.x+(i.x-t.x)*o,this.y=t.y+(i.y-t.y)*o,this.z=t.z+(i.z-t.z)*o,this.w=t.w+(i.w-t.w)*o,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class QG extends Xo{constructor(t=1,i=1,o={}){super(),this.isRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new Oi(0,0,t,i),this.scissorTest=!1,this.viewport=new Oi(0,0,t,i);const l={width:t,height:i,depth:1};o=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Fi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},o);const h=new qi(l,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.colorSpace);h.flipY=!1,h.generateMipmaps=o.generateMipmaps,h.internalFormat=o.internalFormat,this.textures=[];const d=o.count;for(let f=0;f<d;f++)this.textures[f]=h.clone(),this.textures[f].isRenderTargetTexture=!0;this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,this.resolveDepthBuffer=o.resolveDepthBuffer,this.resolveStencilBuffer=o.resolveStencilBuffer,this.depthTexture=o.depthTexture,this.samples=o.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,i,o=1){if(this.width!==t||this.height!==i||this.depth!==o){this.width=t,this.height=i,this.depth=o;for(let l=0,h=this.textures.length;l<h;l++)this.textures[l].image.width=t,this.textures[l].image.height=i,this.textures[l].image.depth=o;this.dispose()}this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let o=0,l=t.textures.length;o<l;o++)this.textures[o]=t.textures[o].clone(),this.textures[o].isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new ow(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class go extends QG{constructor(t=1,i=1,o={}){super(t,i,o),this.isWebGLRenderTarget=!0}}class kR extends qi{constructor(t=null,i=1,o=1,l=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:o,depth:l},this.magFilter=fs,this.minFilter=fs,this.wrapR=rs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class QR extends qi{constructor(t=null,i=1,o=1,l=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:o,depth:l},this.magFilter=fs,this.minFilter=fs,this.wrapR=rs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ra{constructor(t=0,i=0,o=0,l=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=o,this._w=l}static slerpFlat(t,i,o,l,h,d,f){let g=o[l+0],y=o[l+1],x=o[l+2],b=o[l+3];const _=h[d+0],w=h[d+1],T=h[d+2],P=h[d+3];if(f===0)return t[i+0]=g,t[i+1]=y,t[i+2]=x,void(t[i+3]=b);if(f===1)return t[i+0]=_,t[i+1]=w,t[i+2]=T,void(t[i+3]=P);if(b!==P||g!==_||y!==w||x!==T){let U=1-f;const D=g*_+y*w+x*T+b*P,z=D>=0?1:-1,G=1-D*D;if(G>Number.EPSILON){const Y=Math.sqrt(G),q=Math.atan2(Y,D*z);U=Math.sin(U*q)/Y,f=Math.sin(f*q)/Y}const Q=f*z;if(g=g*U+_*Q,y=y*U+w*Q,x=x*U+T*Q,b=b*U+P*Q,U===1-f){const Y=1/Math.sqrt(g*g+y*y+x*x+b*b);g*=Y,y*=Y,x*=Y,b*=Y}}t[i]=g,t[i+1]=y,t[i+2]=x,t[i+3]=b}static multiplyQuaternionsFlat(t,i,o,l,h,d){const f=o[l],g=o[l+1],y=o[l+2],x=o[l+3],b=h[d],_=h[d+1],w=h[d+2],T=h[d+3];return t[i]=f*T+x*b+g*w-y*_,t[i+1]=g*T+x*_+y*b-f*w,t[i+2]=y*T+x*w+f*_-g*b,t[i+3]=x*T-f*b-g*_-y*w,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,o,l){return this._x=t,this._y=i,this._z=o,this._w=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i=!0){const o=t._x,l=t._y,h=t._z,d=t._order,f=Math.cos,g=Math.sin,y=f(o/2),x=f(l/2),b=f(h/2),_=g(o/2),w=g(l/2),T=g(h/2);switch(d){case"XYZ":this._x=_*x*b+y*w*T,this._y=y*w*b-_*x*T,this._z=y*x*T+_*w*b,this._w=y*x*b-_*w*T;break;case"YXZ":this._x=_*x*b+y*w*T,this._y=y*w*b-_*x*T,this._z=y*x*T-_*w*b,this._w=y*x*b+_*w*T;break;case"ZXY":this._x=_*x*b-y*w*T,this._y=y*w*b+_*x*T,this._z=y*x*T+_*w*b,this._w=y*x*b-_*w*T;break;case"ZYX":this._x=_*x*b-y*w*T,this._y=y*w*b+_*x*T,this._z=y*x*T-_*w*b,this._w=y*x*b+_*w*T;break;case"YZX":this._x=_*x*b+y*w*T,this._y=y*w*b+_*x*T,this._z=y*x*T-_*w*b,this._w=y*x*b-_*w*T;break;case"XZY":this._x=_*x*b-y*w*T,this._y=y*w*b-_*x*T,this._z=y*x*T+_*w*b,this._w=y*x*b+_*w*T;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+d)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const o=i/2,l=Math.sin(o);return this._x=t.x*l,this._y=t.y*l,this._z=t.z*l,this._w=Math.cos(o),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,o=i[0],l=i[4],h=i[8],d=i[1],f=i[5],g=i[9],y=i[2],x=i[6],b=i[10],_=o+f+b;if(_>0){const w=.5/Math.sqrt(_+1);this._w=.25/w,this._x=(x-g)*w,this._y=(h-y)*w,this._z=(d-l)*w}else if(o>f&&o>b){const w=2*Math.sqrt(1+o-f-b);this._w=(x-g)/w,this._x=.25*w,this._y=(l+d)/w,this._z=(h+y)/w}else if(f>b){const w=2*Math.sqrt(1+f-o-b);this._w=(h-y)/w,this._x=(l+d)/w,this._y=.25*w,this._z=(g+x)/w}else{const w=2*Math.sqrt(1+b-o-f);this._w=(d-l)/w,this._x=(h+y)/w,this._y=(g+x)/w,this._z=.25*w}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let o=t.dot(i)+1;return o<Number.EPSILON?(o=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=o):(this._x=0,this._y=-t.z,this._z=t.y,this._w=o)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=o),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ms(this.dot(t),-1,1)))}rotateTowards(t,i){const o=this.angleTo(t);if(o===0)return this;const l=Math.min(1,i/o);return this.slerp(t,l),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const o=t._x,l=t._y,h=t._z,d=t._w,f=i._x,g=i._y,y=i._z,x=i._w;return this._x=o*x+d*f+l*y-h*g,this._y=l*x+d*g+h*f-o*y,this._z=h*x+d*y+o*g-l*f,this._w=d*x-o*f-l*g-h*y,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const o=this._x,l=this._y,h=this._z,d=this._w;let f=d*t._w+o*t._x+l*t._y+h*t._z;if(f<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,f=-f):this.copy(t),f>=1)return this._w=d,this._x=o,this._y=l,this._z=h,this;const g=1-f*f;if(g<=Number.EPSILON){const w=1-i;return this._w=w*d+i*this._w,this._x=w*o+i*this._x,this._y=w*l+i*this._y,this._z=w*h+i*this._z,this.normalize(),this}const y=Math.sqrt(g),x=Math.atan2(y,f),b=Math.sin((1-i)*x)/y,_=Math.sin(i*x)/y;return this._w=d*b+this._w*_,this._x=o*b+this._x*_,this._y=l*b+this._y*_,this._z=h*b+this._z*_,this._onChangeCallback(),this}slerpQuaternions(t,i,o){return this.copy(t).slerp(i,o)}random(){const t=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),o=Math.random(),l=Math.sqrt(1-o),h=Math.sqrt(o);return this.set(l*Math.sin(t),l*Math.cos(t),h*Math.sin(i),h*Math.cos(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ve{constructor(t=0,i=0,o=0){ve.prototype.isVector3=!0,this.x=t,this.y=i,this.z=o}set(t,i,o){return o===void 0&&(o=this.z),this.x=t,this.y=i,this.z=o,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(GR.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(GR.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,o=this.y,l=this.z,h=t.elements;return this.x=h[0]*i+h[3]*o+h[6]*l,this.y=h[1]*i+h[4]*o+h[7]*l,this.z=h[2]*i+h[5]*o+h[8]*l,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,o=this.y,l=this.z,h=t.elements,d=1/(h[3]*i+h[7]*o+h[11]*l+h[15]);return this.x=(h[0]*i+h[4]*o+h[8]*l+h[12])*d,this.y=(h[1]*i+h[5]*o+h[9]*l+h[13])*d,this.z=(h[2]*i+h[6]*o+h[10]*l+h[14])*d,this}applyQuaternion(t){const i=this.x,o=this.y,l=this.z,h=t.x,d=t.y,f=t.z,g=t.w,y=2*(d*l-f*o),x=2*(f*i-h*l),b=2*(h*o-d*i);return this.x=i+g*y+d*b-f*x,this.y=o+g*x+f*y-h*b,this.z=l+g*b+h*x-d*y,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,o=this.y,l=this.z,h=t.elements;return this.x=h[0]*i+h[4]*o+h[8]*l,this.y=h[1]*i+h[5]*o+h[9]*l,this.z=h[2]*i+h[6]*o+h[10]*l,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(t,Math.min(i,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,o){return this.x=t.x+(i.x-t.x)*o,this.y=t.y+(i.y-t.y)*o,this.z=t.z+(i.z-t.z)*o,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const o=t.x,l=t.y,h=t.z,d=i.x,f=i.y,g=i.z;return this.x=l*g-h*f,this.y=h*d-o*g,this.z=o*f-l*d,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const o=t.dot(this)/i;return this.copy(t).multiplyScalar(o)}projectOnPlane(t){return cw.copy(this).projectOnVector(t),this.sub(cw)}reflect(t){return this.sub(cw.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const o=this.dot(t)/i;return Math.acos(ms(o,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,o=this.y-t.y,l=this.z-t.z;return i*i+o*o+l*l}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,o){const l=Math.sin(i)*t;return this.x=l*Math.sin(o),this.y=Math.cos(i)*t,this.z=l*Math.cos(o),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,o){return this.x=t*Math.sin(i),this.y=o,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),o=this.setFromMatrixColumn(t,1).length(),l=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=o,this.z=l,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,4*i)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,3*i)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,i=2*Math.random()-1,o=Math.sqrt(1-i*i);return this.x=o*Math.cos(t),this.y=i,this.z=o*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const cw=new ve,GR=new ra;class sa{constructor(t=new ve(1/0,1/0,1/0),i=new ve(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,o=t.length;i<o;i+=3)this.expandByPoint(Jo.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,o=t.count;i<o;i++)this.expandByPoint(Jo.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,o=t.length;i<o;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const o=Jo.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const o=t.geometry;if(o!==void 0){const h=o.getAttribute("position");if(i===!0&&h!==void 0&&t.isInstancedMesh!==!0)for(let d=0,f=h.count;d<f;d++)t.isMesh===!0?t.getVertexPosition(d,Jo):Jo.fromBufferAttribute(h,d),Jo.applyMatrix4(t.matrixWorld),this.expandByPoint(Jo);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),_y.copy(t.boundingBox)):(o.boundingBox===null&&o.computeBoundingBox(),_y.copy(o.boundingBox)),_y.applyMatrix4(t.matrixWorld),this.union(_y)}const l=t.children;for(let h=0,d=l.length;h<d;h++)this.expandByObject(l[h],i);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Jo),Jo.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,o;return t.normal.x>0?(i=t.normal.x*this.min.x,o=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,o=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,o+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,o+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,o+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,o+=t.normal.z*this.min.z),i<=-t.constant&&o>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Bm),by.subVectors(this.max,Bm),$p.subVectors(t.a,Bm),Zp.subVectors(t.b,Bm),eA.subVectors(t.c,Bm),Rh.subVectors(Zp,$p),Lh.subVectors(eA,Zp),cd.subVectors($p,eA);let i=[0,-Rh.z,Rh.y,0,-Lh.z,Lh.y,0,-cd.z,cd.y,Rh.z,0,-Rh.x,Lh.z,0,-Lh.x,cd.z,0,-cd.x,-Rh.y,Rh.x,0,-Lh.y,Lh.x,0,-cd.y,cd.x,0];return!!hw(i,$p,Zp,eA,by)&&(i=[1,0,0,0,1,0,0,0,1],!!hw(i,$p,Zp,eA,by)&&(Cy.crossVectors(Rh,Lh),i=[Cy.x,Cy.y,Cy.z],hw(i,$p,Zp,eA,by)))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Jo).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Jo).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Ic[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ic[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ic[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ic[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ic[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ic[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ic[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ic[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ic)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Ic=[new ve,new ve,new ve,new ve,new ve,new ve,new ve,new ve],Jo=new ve,_y=new sa,$p=new ve,Zp=new ve,eA=new ve,Rh=new ve,Lh=new ve,cd=new ve,Bm=new ve,by=new ve,Cy=new ve,hd=new ve;function hw(p,t,i,o,l){for(let h=0,d=p.length-3;h<=d;h+=3){hd.fromArray(p,h);const f=l.x*Math.abs(hd.x)+l.y*Math.abs(hd.y)+l.z*Math.abs(hd.z),g=t.dot(hd),y=i.dot(hd),x=o.dot(hd);if(Math.max(-Math.max(g,y,x),Math.min(g,y,x))>f)return!1}return!0}const GG=new sa,Rm=new ve,uw=new ve;class vo{constructor(t=new ve,i=-1){this.isSphere=!0,this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const o=this.center;i!==void 0?o.copy(i):GG.setFromPoints(t).getCenter(o);let l=0;for(let h=0,d=t.length;h<d;h++)l=Math.max(l,o.distanceToSquared(t[h]));return this.radius=Math.sqrt(l),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const o=this.center.distanceToSquared(t);return i.copy(t),o>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Rm.subVectors(t,this.center);const i=Rm.lengthSq();if(i>this.radius*this.radius){const o=Math.sqrt(i),l=.5*(o-this.radius);this.center.addScaledVector(Rm,l/o),this.radius+=l}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(uw.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Rm.copy(t.center).add(uw)),this.expandByPoint(Rm.copy(t.center).sub(uw))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Tc=new ve,dw=new ve,wy=new ve,Dh=new ve,pw=new ve,My=new ve,Aw=new ve;class Lm{constructor(t=new ve,i=new ve(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Tc)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const o=i.dot(this.direction);return o<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,o)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=Tc.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(Tc.copy(this.origin).addScaledVector(this.direction,i),Tc.distanceToSquared(t))}distanceSqToSegment(t,i,o,l){dw.copy(t).add(i).multiplyScalar(.5),wy.copy(i).sub(t).normalize(),Dh.copy(this.origin).sub(dw);const h=.5*t.distanceTo(i),d=-this.direction.dot(wy),f=Dh.dot(this.direction),g=-Dh.dot(wy),y=Dh.lengthSq(),x=Math.abs(1-d*d);let b,_,w,T;if(x>0)if(b=d*g-f,_=d*f-g,T=h*x,b>=0)if(_>=-T)if(_<=T){const P=1/x;b*=P,_*=P,w=b*(b+d*_+2*f)+_*(d*b+_+2*g)+y}else _=h,b=Math.max(0,-(d*_+f)),w=-b*b+_*(_+2*g)+y;else _=-h,b=Math.max(0,-(d*_+f)),w=-b*b+_*(_+2*g)+y;else _<=-T?(b=Math.max(0,-(-d*h+f)),_=b>0?-h:Math.min(Math.max(-h,-g),h),w=-b*b+_*(_+2*g)+y):_<=T?(b=0,_=Math.min(Math.max(-h,-g),h),w=_*(_+2*g)+y):(b=Math.max(0,-(d*h+f)),_=b>0?h:Math.min(Math.max(-h,-g),h),w=-b*b+_*(_+2*g)+y);else _=d>0?-h:h,b=Math.max(0,-(d*_+f)),w=-b*b+_*(_+2*g)+y;return o&&o.copy(this.origin).addScaledVector(this.direction,b),l&&l.copy(dw).addScaledVector(wy,_),w}intersectSphere(t,i){Tc.subVectors(t.center,this.origin);const o=Tc.dot(this.direction),l=Tc.dot(Tc)-o*o,h=t.radius*t.radius;if(l>h)return null;const d=Math.sqrt(h-l),f=o-d,g=o+d;return g<0?null:f<0?this.at(g,i):this.at(f,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const o=-(this.origin.dot(t.normal)+t.constant)/i;return o>=0?o:null}intersectPlane(t,i){const o=this.distanceToPlane(t);return o===null?null:this.at(o,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0?!0:t.normal.dot(this.direction)*i<0}intersectBox(t,i){let o,l,h,d,f,g;const y=1/this.direction.x,x=1/this.direction.y,b=1/this.direction.z,_=this.origin;return y>=0?(o=(t.min.x-_.x)*y,l=(t.max.x-_.x)*y):(o=(t.max.x-_.x)*y,l=(t.min.x-_.x)*y),x>=0?(h=(t.min.y-_.y)*x,d=(t.max.y-_.y)*x):(h=(t.max.y-_.y)*x,d=(t.min.y-_.y)*x),o>d||h>l?null:((h>o||isNaN(o))&&(o=h),(d<l||isNaN(l))&&(l=d),b>=0?(f=(t.min.z-_.z)*b,g=(t.max.z-_.z)*b):(f=(t.max.z-_.z)*b,g=(t.min.z-_.z)*b),o>g||f>l?null:((f>o||o!=o)&&(o=f),(g<l||l!=l)&&(l=g),l<0?null:this.at(o>=0?o:l,i)))}intersectsBox(t){return this.intersectBox(t,Tc)!==null}intersectTriangle(t,i,o,l,h){pw.subVectors(i,t),My.subVectors(o,t),Aw.crossVectors(pw,My);let d,f=this.direction.dot(Aw);if(f>0){if(l)return null;d=1}else{if(!(f<0))return null;d=-1,f=-f}Dh.subVectors(this.origin,t);const g=d*this.direction.dot(My.crossVectors(Dh,My));if(g<0)return null;const y=d*this.direction.dot(pw.cross(Dh));if(y<0||g+y>f)return null;const x=-d*Dh.dot(Aw);return x<0?null:this.at(x/f,h)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class In{constructor(t,i,o,l,h,d,f,g,y,x,b,_,w,T,P,U){In.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,o,l,h,d,f,g,y,x,b,_,w,T,P,U)}set(t,i,o,l,h,d,f,g,y,x,b,_,w,T,P,U){const D=this.elements;return D[0]=t,D[4]=i,D[8]=o,D[12]=l,D[1]=h,D[5]=d,D[9]=f,D[13]=g,D[2]=y,D[6]=x,D[10]=b,D[14]=_,D[3]=w,D[7]=T,D[11]=P,D[15]=U,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new In().fromArray(this.elements)}copy(t){const i=this.elements,o=t.elements;return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],this}copyPosition(t){const i=this.elements,o=t.elements;return i[12]=o[12],i[13]=o[13],i[14]=o[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,o){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),o.setFromMatrixColumn(this,2),this}makeBasis(t,i,o){return this.set(t.x,i.x,o.x,0,t.y,i.y,o.y,0,t.z,i.z,o.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,o=t.elements,l=1/tA.setFromMatrixColumn(t,0).length(),h=1/tA.setFromMatrixColumn(t,1).length(),d=1/tA.setFromMatrixColumn(t,2).length();return i[0]=o[0]*l,i[1]=o[1]*l,i[2]=o[2]*l,i[3]=0,i[4]=o[4]*h,i[5]=o[5]*h,i[6]=o[6]*h,i[7]=0,i[8]=o[8]*d,i[9]=o[9]*d,i[10]=o[10]*d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,o=t.x,l=t.y,h=t.z,d=Math.cos(o),f=Math.sin(o),g=Math.cos(l),y=Math.sin(l),x=Math.cos(h),b=Math.sin(h);if(t.order==="XYZ"){const _=d*x,w=d*b,T=f*x,P=f*b;i[0]=g*x,i[4]=-g*b,i[8]=y,i[1]=w+T*y,i[5]=_-P*y,i[9]=-f*g,i[2]=P-_*y,i[6]=T+w*y,i[10]=d*g}else if(t.order==="YXZ"){const _=g*x,w=g*b,T=y*x,P=y*b;i[0]=_+P*f,i[4]=T*f-w,i[8]=d*y,i[1]=d*b,i[5]=d*x,i[9]=-f,i[2]=w*f-T,i[6]=P+_*f,i[10]=d*g}else if(t.order==="ZXY"){const _=g*x,w=g*b,T=y*x,P=y*b;i[0]=_-P*f,i[4]=-d*b,i[8]=T+w*f,i[1]=w+T*f,i[5]=d*x,i[9]=P-_*f,i[2]=-d*y,i[6]=f,i[10]=d*g}else if(t.order==="ZYX"){const _=d*x,w=d*b,T=f*x,P=f*b;i[0]=g*x,i[4]=T*y-w,i[8]=_*y+P,i[1]=g*b,i[5]=P*y+_,i[9]=w*y-T,i[2]=-y,i[6]=f*g,i[10]=d*g}else if(t.order==="YZX"){const _=d*g,w=d*y,T=f*g,P=f*y;i[0]=g*x,i[4]=P-_*b,i[8]=T*b+w,i[1]=b,i[5]=d*x,i[9]=-f*x,i[2]=-y*x,i[6]=w*b+T,i[10]=_-P*b}else if(t.order==="XZY"){const _=d*g,w=d*y,T=f*g,P=f*y;i[0]=g*x,i[4]=-b,i[8]=y*x,i[1]=_*b+P,i[5]=d*x,i[9]=w*b-T,i[2]=T*b-w,i[6]=f*x,i[10]=P*b+_}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(HG,t,zG)}lookAt(t,i,o){const l=this.elements;return ja.subVectors(t,i),ja.lengthSq()===0&&(ja.z=1),ja.normalize(),Ph.crossVectors(o,ja),Ph.lengthSq()===0&&(Math.abs(o.z)===1?ja.x+=1e-4:ja.z+=1e-4,ja.normalize(),Ph.crossVectors(o,ja)),Ph.normalize(),Sy.crossVectors(ja,Ph),l[0]=Ph.x,l[4]=Sy.x,l[8]=ja.x,l[1]=Ph.y,l[5]=Sy.y,l[9]=ja.y,l[2]=Ph.z,l[6]=Sy.z,l[10]=ja.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const o=t.elements,l=i.elements,h=this.elements,d=o[0],f=o[4],g=o[8],y=o[12],x=o[1],b=o[5],_=o[9],w=o[13],T=o[2],P=o[6],U=o[10],D=o[14],z=o[3],G=o[7],Q=o[11],Y=o[15],q=l[0],K=l[4],ne=l[8],le=l[12],fe=l[1],be=l[5],de=l[9],Fe=l[13],we=l[2],Me=l[6],_e=l[10],tt=l[14],me=l[3],wt=l[7],ft=l[11],ze=l[15];return h[0]=d*q+f*fe+g*we+y*me,h[4]=d*K+f*be+g*Me+y*wt,h[8]=d*ne+f*de+g*_e+y*ft,h[12]=d*le+f*Fe+g*tt+y*ze,h[1]=x*q+b*fe+_*we+w*me,h[5]=x*K+b*be+_*Me+w*wt,h[9]=x*ne+b*de+_*_e+w*ft,h[13]=x*le+b*Fe+_*tt+w*ze,h[2]=T*q+P*fe+U*we+D*me,h[6]=T*K+P*be+U*Me+D*wt,h[10]=T*ne+P*de+U*_e+D*ft,h[14]=T*le+P*Fe+U*tt+D*ze,h[3]=z*q+G*fe+Q*we+Y*me,h[7]=z*K+G*be+Q*Me+Y*wt,h[11]=z*ne+G*de+Q*_e+Y*ft,h[15]=z*le+G*Fe+Q*tt+Y*ze,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],o=t[4],l=t[8],h=t[12],d=t[1],f=t[5],g=t[9],y=t[13],x=t[2],b=t[6],_=t[10],w=t[14];return t[3]*(+h*g*b-l*y*b-h*f*_+o*y*_+l*f*w-o*g*w)+t[7]*(+i*g*w-i*y*_+h*d*_-l*d*w+l*y*x-h*g*x)+t[11]*(+i*y*b-i*f*w-h*d*b+o*d*w+h*f*x-o*y*x)+t[15]*(-l*f*x-i*g*b+i*f*_+l*d*b-o*d*_+o*g*x)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,o){const l=this.elements;return t.isVector3?(l[12]=t.x,l[13]=t.y,l[14]=t.z):(l[12]=t,l[13]=i,l[14]=o),this}invert(){const t=this.elements,i=t[0],o=t[1],l=t[2],h=t[3],d=t[4],f=t[5],g=t[6],y=t[7],x=t[8],b=t[9],_=t[10],w=t[11],T=t[12],P=t[13],U=t[14],D=t[15],z=b*U*y-P*_*y+P*g*w-f*U*w-b*g*D+f*_*D,G=T*_*y-x*U*y-T*g*w+d*U*w+x*g*D-d*_*D,Q=x*P*y-T*b*y+T*f*w-d*P*w-x*f*D+d*b*D,Y=T*b*g-x*P*g-T*f*_+d*P*_+x*f*U-d*b*U,q=i*z+o*G+l*Q+h*Y;if(q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const K=1/q;return t[0]=z*K,t[1]=(P*_*h-b*U*h-P*l*w+o*U*w+b*l*D-o*_*D)*K,t[2]=(f*U*h-P*g*h+P*l*y-o*U*y-f*l*D+o*g*D)*K,t[3]=(b*g*h-f*_*h-b*l*y+o*_*y+f*l*w-o*g*w)*K,t[4]=G*K,t[5]=(x*U*h-T*_*h+T*l*w-i*U*w-x*l*D+i*_*D)*K,t[6]=(T*g*h-d*U*h-T*l*y+i*U*y+d*l*D-i*g*D)*K,t[7]=(d*_*h-x*g*h+x*l*y-i*_*y-d*l*w+i*g*w)*K,t[8]=Q*K,t[9]=(T*b*h-x*P*h-T*o*w+i*P*w+x*o*D-i*b*D)*K,t[10]=(d*P*h-T*f*h+T*o*y-i*P*y-d*o*D+i*f*D)*K,t[11]=(x*f*h-d*b*h-x*o*y+i*b*y+d*o*w-i*f*w)*K,t[12]=Y*K,t[13]=(x*P*l-T*b*l+T*o*_-i*P*_-x*o*U+i*b*U)*K,t[14]=(T*f*l-d*P*l-T*o*g+i*P*g+d*o*U-i*f*U)*K,t[15]=(d*b*l-x*f*l+x*o*g-i*b*g-d*o*_+i*f*_)*K,this}scale(t){const i=this.elements,o=t.x,l=t.y,h=t.z;return i[0]*=o,i[4]*=l,i[8]*=h,i[1]*=o,i[5]*=l,i[9]*=h,i[2]*=o,i[6]*=l,i[10]*=h,i[3]*=o,i[7]*=l,i[11]*=h,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],l=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,o,l))}makeTranslation(t,i,o){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,o,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),o=Math.sin(t);return this.set(1,0,0,0,0,i,-o,0,0,o,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),o=Math.sin(t);return this.set(i,0,o,0,0,1,0,0,-o,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),o=Math.sin(t);return this.set(i,-o,0,0,o,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const o=Math.cos(i),l=Math.sin(i),h=1-o,d=t.x,f=t.y,g=t.z,y=h*d,x=h*f;return this.set(y*d+o,y*f-l*g,y*g+l*f,0,y*f+l*g,x*f+o,x*g-l*d,0,y*g-l*f,x*g+l*d,h*g*g+o,0,0,0,0,1),this}makeScale(t,i,o){return this.set(t,0,0,0,0,i,0,0,0,0,o,0,0,0,0,1),this}makeShear(t,i,o,l,h,d){return this.set(1,o,h,0,t,1,d,0,i,l,1,0,0,0,0,1),this}compose(t,i,o){const l=this.elements,h=i._x,d=i._y,f=i._z,g=i._w,y=h+h,x=d+d,b=f+f,_=h*y,w=h*x,T=h*b,P=d*x,U=d*b,D=f*b,z=g*y,G=g*x,Q=g*b,Y=o.x,q=o.y,K=o.z;return l[0]=(1-(P+D))*Y,l[1]=(w+Q)*Y,l[2]=(T-G)*Y,l[3]=0,l[4]=(w-Q)*q,l[5]=(1-(_+D))*q,l[6]=(U+z)*q,l[7]=0,l[8]=(T+G)*K,l[9]=(U-z)*K,l[10]=(1-(_+P))*K,l[11]=0,l[12]=t.x,l[13]=t.y,l[14]=t.z,l[15]=1,this}decompose(t,i,o){const l=this.elements;let h=tA.set(l[0],l[1],l[2]).length();const d=tA.set(l[4],l[5],l[6]).length(),f=tA.set(l[8],l[9],l[10]).length();this.determinant()<0&&(h=-h),t.x=l[12],t.y=l[13],t.z=l[14],$o.copy(this);const g=1/h,y=1/d,x=1/f;return $o.elements[0]*=g,$o.elements[1]*=g,$o.elements[2]*=g,$o.elements[4]*=y,$o.elements[5]*=y,$o.elements[6]*=y,$o.elements[8]*=x,$o.elements[9]*=x,$o.elements[10]*=x,i.setFromRotationMatrix($o),o.x=h,o.y=d,o.z=f,this}makePerspective(t,i,o,l,h,d,f=2e3){const g=this.elements,y=2*h/(i-t),x=2*h/(o-l),b=(i+t)/(i-t),_=(o+l)/(o-l);let w,T;if(f===Xp)w=-(d+h)/(d-h),T=-2*d*h/(d-h);else{if(f!==yy)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+f);w=-d/(d-h),T=-d*h/(d-h)}return g[0]=y,g[4]=0,g[8]=b,g[12]=0,g[1]=0,g[5]=x,g[9]=_,g[13]=0,g[2]=0,g[6]=0,g[10]=w,g[14]=T,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(t,i,o,l,h,d,f=2e3){const g=this.elements,y=1/(i-t),x=1/(o-l),b=1/(d-h),_=(i+t)*y,w=(o+l)*x;let T,P;if(f===Xp)T=(d+h)*b,P=-2*b;else{if(f!==yy)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+f);T=h*b,P=-1*b}return g[0]=2*y,g[4]=0,g[8]=0,g[12]=-_,g[1]=0,g[5]=2*x,g[9]=0,g[13]=-w,g[2]=0,g[6]=0,g[10]=P,g[14]=-T,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(t){const i=this.elements,o=t.elements;for(let l=0;l<16;l++)if(i[l]!==o[l])return!1;return!0}fromArray(t,i=0){for(let o=0;o<16;o++)this.elements[o]=t[o+i];return this}toArray(t=[],i=0){const o=this.elements;return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],t[i+4]=o[4],t[i+5]=o[5],t[i+6]=o[6],t[i+7]=o[7],t[i+8]=o[8],t[i+9]=o[9],t[i+10]=o[10],t[i+11]=o[11],t[i+12]=o[12],t[i+13]=o[13],t[i+14]=o[14],t[i+15]=o[15],t}}const tA=new ve,$o=new In,HG=new ve(0,0,0),zG=new ve(1,1,1),Ph=new ve,Sy=new ve,ja=new ve,HR=new In,zR=new ra;class _o{constructor(t=0,i=0,o=0,l=_o.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=o,this._order=l}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,o,l=this._order){return this._x=t,this._y=i,this._z=o,this._order=l,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,o=!0){const l=t.elements,h=l[0],d=l[4],f=l[8],g=l[1],y=l[5],x=l[9],b=l[2],_=l[6],w=l[10];switch(i){case"XYZ":this._y=Math.asin(ms(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(-x,w),this._z=Math.atan2(-d,h)):(this._x=Math.atan2(_,y),this._z=0);break;case"YXZ":this._x=Math.asin(-ms(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(f,w),this._z=Math.atan2(g,y)):(this._y=Math.atan2(-b,h),this._z=0);break;case"ZXY":this._x=Math.asin(ms(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(-b,w),this._z=Math.atan2(-d,y)):(this._y=0,this._z=Math.atan2(g,h));break;case"ZYX":this._y=Math.asin(-ms(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(_,w),this._z=Math.atan2(g,h)):(this._x=0,this._z=Math.atan2(-d,y));break;case"YZX":this._z=Math.asin(ms(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-x,y),this._y=Math.atan2(-b,h)):(this._x=0,this._y=Math.atan2(f,w));break;case"XZY":this._z=Math.asin(-ms(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(_,y),this._y=Math.atan2(f,h)):(this._x=Math.atan2(-x,w),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,o===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,o){return HR.makeRotationFromQuaternion(t),this.setFromRotationMatrix(HR,i,o)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return zR.setFromEuler(this),this.setFromQuaternion(zR,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}_o.DEFAULT_ORDER="XYZ";class fw{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let VG=0;const VR=new ve,nA=new ra,Bc=new In,Iy=new ve,Dm=new ve,WG=new ve,jG=new ra,WR=new ve(1,0,0),jR=new ve(0,1,0),qR=new ve(0,0,1),XR={type:"added"},qG={type:"removed"},iA={type:"childadded",child:null},mw={type:"childremoved",child:null};class $i extends Xo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:VG++}),this.uuid=Yo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=$i.DEFAULT_UP.clone();const t=new ve,i=new _o,o=new ra,l=new ve(1,1,1);i._onChange(function(){o.setFromEuler(i,!1)}),o._onChange(function(){i.setFromQuaternion(o,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:l},modelViewMatrix:{value:new In},normalMatrix:{value:new zn}}),this.matrix=new In,this.matrixWorld=new In,this.matrixAutoUpdate=$i.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=$i.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new fw,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return nA.setFromAxisAngle(t,i),this.quaternion.multiply(nA),this}rotateOnWorldAxis(t,i){return nA.setFromAxisAngle(t,i),this.quaternion.premultiply(nA),this}rotateX(t){return this.rotateOnAxis(WR,t)}rotateY(t){return this.rotateOnAxis(jR,t)}rotateZ(t){return this.rotateOnAxis(qR,t)}translateOnAxis(t,i){return VR.copy(t).applyQuaternion(this.quaternion),this.position.add(VR.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(WR,t)}translateY(t){return this.translateOnAxis(jR,t)}translateZ(t){return this.translateOnAxis(qR,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Bc.copy(this.matrixWorld).invert())}lookAt(t,i,o){t.isVector3?Iy.copy(t):Iy.set(t,i,o);const l=this.parent;this.updateWorldMatrix(!0,!1),Dm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bc.lookAt(Dm,Iy,this.up):Bc.lookAt(Iy,Dm,this.up),this.quaternion.setFromRotationMatrix(Bc),l&&(Bc.extractRotation(l.matrixWorld),nA.setFromRotationMatrix(Bc),this.quaternion.premultiply(nA.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(XR),iA.child=t,this.dispatchEvent(iA),iA.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let o=0;o<arguments.length;o++)this.remove(arguments[o]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(qG),mw.child=t,this.dispatchEvent(mw),mw.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Bc.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Bc.multiply(t.parent.matrixWorld)),t.applyMatrix4(Bc),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(XR),iA.child=t,this.dispatchEvent(iA),iA.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let o=0,l=this.children.length;o<l;o++){const h=this.children[o].getObjectByProperty(t,i);if(h!==void 0)return h}}getObjectsByProperty(t,i,o=[]){this[t]===i&&o.push(this);const l=this.children;for(let h=0,d=l.length;h<d;h++)l[h].getObjectsByProperty(t,i,o);return o}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dm,t,WG),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dm,jG,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let o=0,l=i.length;o<l;o++)i[o].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let o=0,l=i.length;o<l;o++)i[o].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let o=0,l=i.length;o<l;o++)i[o].updateMatrixWorld(t)}updateWorldMatrix(t,i){const o=this.parent;if(t===!0&&o!==null&&o.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const l=this.children;for(let h=0,d=l.length;h<d;h++)l[h].updateWorldMatrix(!1,!0)}}toJSON(t){const i=t===void 0||typeof t=="string",o={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},o.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const l={};function h(f,g){return f[g.uuid]===void 0&&(f[g.uuid]=g.toJSON(t)),g.uuid}if(l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),l.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(l.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(l.type="BatchedMesh",l.perObjectFrustumCulled=this.perObjectFrustumCulled,l.sortObjects=this.sortObjects,l.drawRanges=this._drawRanges,l.reservedRanges=this._reservedRanges,l.visibility=this._visibility,l.active=this._active,l.bounds=this._bounds.map(f=>({boxInitialized:f.boxInitialized,boxMin:f.box.min.toArray(),boxMax:f.box.max.toArray(),sphereInitialized:f.sphereInitialized,sphereRadius:f.sphere.radius,sphereCenter:f.sphere.center.toArray()})),l.maxInstanceCount=this._maxInstanceCount,l.maxVertexCount=this._maxVertexCount,l.maxIndexCount=this._maxIndexCount,l.geometryInitialized=this._geometryInitialized,l.geometryCount=this._geometryCount,l.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(l.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(l.boundingSphere={center:l.boundingSphere.center.toArray(),radius:l.boundingSphere.radius}),this.boundingBox!==null&&(l.boundingBox={min:l.boundingBox.min.toArray(),max:l.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(l.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=h(t.geometries,this.geometry);const f=this.geometry.parameters;if(f!==void 0&&f.shapes!==void 0){const g=f.shapes;if(Array.isArray(g))for(let y=0,x=g.length;y<x;y++){const b=g[y];h(t.shapes,b)}else h(t.shapes,g)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(h(t.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const f=[];for(let g=0,y=this.material.length;g<y;g++)f.push(h(t.materials,this.material[g]));l.material=f}else l.material=h(t.materials,this.material);if(this.children.length>0){l.children=[];for(let f=0;f<this.children.length;f++)l.children.push(this.children[f].toJSON(t).object)}if(this.animations.length>0){l.animations=[];for(let f=0;f<this.animations.length;f++){const g=this.animations[f];l.animations.push(h(t.animations,g))}}if(i){const f=d(t.geometries),g=d(t.materials),y=d(t.textures),x=d(t.images),b=d(t.shapes),_=d(t.skeletons),w=d(t.animations),T=d(t.nodes);f.length>0&&(o.geometries=f),g.length>0&&(o.materials=g),y.length>0&&(o.textures=y),x.length>0&&(o.images=x),b.length>0&&(o.shapes=b),_.length>0&&(o.skeletons=_),w.length>0&&(o.animations=w),T.length>0&&(o.nodes=T)}return o.object=l,o;function d(f){const g=[];for(const y in f){const x=f[y];delete x.metadata,g.push(x)}return g}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let o=0;o<t.children.length;o++){const l=t.children[o];this.add(l.clone())}return this}}$i.DEFAULT_UP=new ve(0,1,0),$i.DEFAULT_MATRIX_AUTO_UPDATE=!0,$i.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Zo=new ve,Rc=new ve,gw=new ve,Lc=new ve,rA=new ve,sA=new ve,YR=new ve,vw=new ve,yw=new ve,Ew=new ve,xw=new Oi,_w=new Oi,bw=new Oi;class Ja{constructor(t=new ve,i=new ve,o=new ve){this.a=t,this.b=i,this.c=o}static getNormal(t,i,o,l){l.subVectors(o,i),Zo.subVectors(t,i),l.cross(Zo);const h=l.lengthSq();return h>0?l.multiplyScalar(1/Math.sqrt(h)):l.set(0,0,0)}static getBarycoord(t,i,o,l,h){Zo.subVectors(l,i),Rc.subVectors(o,i),gw.subVectors(t,i);const d=Zo.dot(Zo),f=Zo.dot(Rc),g=Zo.dot(gw),y=Rc.dot(Rc),x=Rc.dot(gw),b=d*y-f*f;if(b===0)return h.set(0,0,0),null;const _=1/b,w=(y*g-f*x)*_,T=(d*x-f*g)*_;return h.set(1-w-T,T,w)}static containsPoint(t,i,o,l){return this.getBarycoord(t,i,o,l,Lc)!==null&&Lc.x>=0&&Lc.y>=0&&Lc.x+Lc.y<=1}static getInterpolation(t,i,o,l,h,d,f,g){return this.getBarycoord(t,i,o,l,Lc)===null?(g.x=0,g.y=0,"z"in g&&(g.z=0),"w"in g&&(g.w=0),null):(g.setScalar(0),g.addScaledVector(h,Lc.x),g.addScaledVector(d,Lc.y),g.addScaledVector(f,Lc.z),g)}static getInterpolatedAttribute(t,i,o,l,h,d){return xw.setScalar(0),_w.setScalar(0),bw.setScalar(0),xw.fromBufferAttribute(t,i),_w.fromBufferAttribute(t,o),bw.fromBufferAttribute(t,l),d.setScalar(0),d.addScaledVector(xw,h.x),d.addScaledVector(_w,h.y),d.addScaledVector(bw,h.z),d}static isFrontFacing(t,i,o,l){return Zo.subVectors(o,i),Rc.subVectors(t,i),Zo.cross(Rc).dot(l)<0}set(t,i,o){return this.a.copy(t),this.b.copy(i),this.c.copy(o),this}setFromPointsAndIndices(t,i,o,l){return this.a.copy(t[i]),this.b.copy(t[o]),this.c.copy(t[l]),this}setFromAttributeAndIndices(t,i,o,l){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,o),this.c.fromBufferAttribute(t,l),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Zo.subVectors(this.c,this.b),Rc.subVectors(this.a,this.b),.5*Zo.cross(Rc).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ja.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return Ja.getBarycoord(t,this.a,this.b,this.c,i)}getInterpolation(t,i,o,l,h){return Ja.getInterpolation(t,this.a,this.b,this.c,i,o,l,h)}containsPoint(t){return Ja.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ja.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const o=this.a,l=this.b,h=this.c;let d,f;rA.subVectors(l,o),sA.subVectors(h,o),vw.subVectors(t,o);const g=rA.dot(vw),y=sA.dot(vw);if(g<=0&&y<=0)return i.copy(o);yw.subVectors(t,l);const x=rA.dot(yw),b=sA.dot(yw);if(x>=0&&b<=x)return i.copy(l);const _=g*b-x*y;if(_<=0&&g>=0&&x<=0)return d=g/(g-x),i.copy(o).addScaledVector(rA,d);Ew.subVectors(t,h);const w=rA.dot(Ew),T=sA.dot(Ew);if(T>=0&&w<=T)return i.copy(h);const P=w*y-g*T;if(P<=0&&y>=0&&T<=0)return f=y/(y-T),i.copy(o).addScaledVector(sA,f);const U=x*T-w*b;if(U<=0&&b-x>=0&&w-T>=0)return YR.subVectors(h,l),f=(b-x)/(b-x+(w-T)),i.copy(l).addScaledVector(YR,f);const D=1/(U+P+_);return d=P*D,f=_*D,i.copy(o).addScaledVector(rA,d).addScaledVector(sA,f)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const KR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Uh={h:0,s:0,l:0},Ty={h:0,s:0,l:0};function Cw(p,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?p+6*(t-p)*i:i<.5?t:i<2/3?p+6*(t-p)*(2/3-i):p}class fn{constructor(t,i,o){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,o)}set(t,i,o){if(i===void 0&&o===void 0){const l=t;l&&l.isColor?this.copy(l):typeof l=="number"?this.setHex(l):typeof l=="string"&&this.setStyle(l)}else this.setRGB(t,i,o);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=sr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Si.toWorkingColorSpace(this,i),this}setRGB(t,i,o,l=Si.workingColorSpace){return this.r=t,this.g=i,this.b=o,Si.toWorkingColorSpace(this,l),this}setHSL(t,i,o,l=Si.workingColorSpace){if(t=rw(t,1),i=ms(i,0,1),o=ms(o,0,1),i===0)this.r=this.g=this.b=o;else{const h=o<=.5?o*(1+i):o+i-o*i,d=2*o-h;this.r=Cw(d,h,t+1/3),this.g=Cw(d,h,t),this.b=Cw(d,h,t-1/3)}return Si.toWorkingColorSpace(this,l),this}setStyle(t,i=sr){function o(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let l;if(l=/^(\w+)\(([^\)]*)\)/.exec(t)){let h;const d=l[1],f=l[2];switch(d){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return o(h[4]),this.setRGB(Math.min(255,parseInt(h[1],10))/255,Math.min(255,parseInt(h[2],10))/255,Math.min(255,parseInt(h[3],10))/255,i);if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return o(h[4]),this.setRGB(Math.min(100,parseInt(h[1],10))/100,Math.min(100,parseInt(h[2],10))/100,Math.min(100,parseInt(h[3],10))/100,i);break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(f))return o(h[4]),this.setHSL(parseFloat(h[1])/360,parseFloat(h[2])/100,parseFloat(h[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(l=/^\#([A-Fa-f\d]+)$/.exec(t)){const h=l[1],d=h.length;if(d===3)return this.setRGB(parseInt(h.charAt(0),16)/15,parseInt(h.charAt(1),16)/15,parseInt(h.charAt(2),16)/15,i);if(d===6)return this.setHex(parseInt(h,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=sr){const o=KR[t.toLowerCase()];return o!==void 0?this.setHex(o,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Kp(t.r),this.g=Kp(t.g),this.b=Kp(t.b),this}copyLinearToSRGB(t){return this.r=aw(t.r),this.g=aw(t.g),this.b=aw(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=sr){return Si.fromWorkingColorSpace(Qs.copy(this),t),65536*Math.round(ms(255*Qs.r,0,255))+256*Math.round(ms(255*Qs.g,0,255))+Math.round(ms(255*Qs.b,0,255))}getHexString(t=sr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Si.workingColorSpace){Si.fromWorkingColorSpace(Qs.copy(this),i);const o=Qs.r,l=Qs.g,h=Qs.b,d=Math.max(o,l,h),f=Math.min(o,l,h);let g,y;const x=(f+d)/2;if(f===d)g=0,y=0;else{const b=d-f;switch(y=x<=.5?b/(d+f):b/(2-d-f),d){case o:g=(l-h)/b+(l<h?6:0);break;case l:g=(h-o)/b+2;break;case h:g=(o-l)/b+4}g/=6}return t.h=g,t.s=y,t.l=x,t}getRGB(t,i=Si.workingColorSpace){return Si.fromWorkingColorSpace(Qs.copy(this),i),t.r=Qs.r,t.g=Qs.g,t.b=Qs.b,t}getStyle(t=sr){Si.fromWorkingColorSpace(Qs.copy(this),t);const i=Qs.r,o=Qs.g,l=Qs.b;return t!==sr?`color(${t} ${i.toFixed(3)} ${o.toFixed(3)} ${l.toFixed(3)})`:`rgb(${Math.round(255*i)},${Math.round(255*o)},${Math.round(255*l)})`}offsetHSL(t,i,o){return this.getHSL(Uh),this.setHSL(Uh.h+t,Uh.s+i,Uh.l+o)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,o){return this.r=t.r+(i.r-t.r)*o,this.g=t.g+(i.g-t.g)*o,this.b=t.b+(i.b-t.b)*o,this}lerpHSL(t,i){this.getHSL(Uh),t.getHSL(Ty);const o=Sm(Uh.h,Ty.h,i),l=Sm(Uh.s,Ty.s,i),h=Sm(Uh.l,Ty.l,i);return this.setHSL(o,l,h),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,o=this.g,l=this.b,h=t.elements;return this.r=h[0]*i+h[3]*o+h[6]*l,this.g=h[1]*i+h[4]*o+h[7]*l,this.b=h[2]*i+h[5]*o+h[8]*l,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Qs=new fn;fn.NAMES=KR;let XG=0;class el extends Xo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:XG++}),this.uuid=Yo(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=sd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new fn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=qp,this.stencilZFail=qp,this.stencilZPass=qp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const o=t[i];if(o===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const l=this[i];l!==void 0?l&&l.isColor?l.set(o):l&&l.isVector3&&o&&o.isVector3?l.copy(o):this[i]=o:console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`)}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const o={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function l(h){const d=[];for(const f in h){const g=h[f];delete g.metadata,d.push(g)}return d}if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.color&&this.color.isColor&&(o.color=this.color.getHex()),this.roughness!==void 0&&(o.roughness=this.roughness),this.metalness!==void 0&&(o.metalness=this.metalness),this.sheen!==void 0&&(o.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(o.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(o.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(o.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(o.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(o.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(o.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(o.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(o.shininess=this.shininess),this.clearcoat!==void 0&&(o.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(o.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(o.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(o.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(o.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,o.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(o.dispersion=this.dispersion),this.iridescence!==void 0&&(o.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(o.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(o.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(o.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(o.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(o.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(o.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(o.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(o.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(o.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(o.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(o.lightMap=this.lightMap.toJSON(t).uuid,o.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(o.aoMap=this.aoMap.toJSON(t).uuid,o.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(o.bumpMap=this.bumpMap.toJSON(t).uuid,o.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(o.normalMap=this.normalMap.toJSON(t).uuid,o.normalMapType=this.normalMapType,o.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(o.displacementMap=this.displacementMap.toJSON(t).uuid,o.displacementScale=this.displacementScale,o.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(o.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(o.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(o.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(o.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(o.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(o.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(o.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(o.combine=this.combine)),this.envMapRotation!==void 0&&(o.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(o.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(o.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(o.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(o.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(o.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(o.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(o.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(o.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(o.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(o.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(o.size=this.size),this.shadowSide!==null&&(o.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(o.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(o.blending=this.blending),this.side!==0&&(o.side=this.side),this.vertexColors===!0&&(o.vertexColors=!0),this.opacity<1&&(o.opacity=this.opacity),this.transparent===!0&&(o.transparent=!0),this.blendSrc!==204&&(o.blendSrc=this.blendSrc),this.blendDst!==205&&(o.blendDst=this.blendDst),this.blendEquation!==sd&&(o.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(o.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(o.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(o.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(o.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(o.blendAlpha=this.blendAlpha),this.depthFunc!==3&&(o.depthFunc=this.depthFunc),this.depthTest===!1&&(o.depthTest=this.depthTest),this.depthWrite===!1&&(o.depthWrite=this.depthWrite),this.colorWrite===!1&&(o.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(o.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==519&&(o.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(o.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(o.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==qp&&(o.stencilFail=this.stencilFail),this.stencilZFail!==qp&&(o.stencilZFail=this.stencilZFail),this.stencilZPass!==qp&&(o.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(o.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(o.rotation=this.rotation),this.polygonOffset===!0&&(o.polygonOffset=!0),this.polygonOffsetFactor!==0&&(o.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(o.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(o.linewidth=this.linewidth),this.dashSize!==void 0&&(o.dashSize=this.dashSize),this.gapSize!==void 0&&(o.gapSize=this.gapSize),this.scale!==void 0&&(o.scale=this.scale),this.dithering===!0&&(o.dithering=!0),this.alphaTest>0&&(o.alphaTest=this.alphaTest),this.alphaHash===!0&&(o.alphaHash=!0),this.alphaToCoverage===!0&&(o.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(o.premultipliedAlpha=!0),this.forceSinglePass===!0&&(o.forceSinglePass=!0),this.wireframe===!0&&(o.wireframe=!0),this.wireframeLinewidth>1&&(o.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(o.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(o.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(o.flatShading=!0),this.visible===!1&&(o.visible=!1),this.toneMapped===!1&&(o.toneMapped=!1),this.fog===!1&&(o.fog=!1),Object.keys(this.userData).length>0&&(o.userData=this.userData),i){const h=l(t.textures),d=l(t.images);h.length>0&&(o.textures=h),d.length>0&&(o.images=d)}return o}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let o=null;if(i!==null){const l=i.length;o=new Array(l);for(let h=0;h!==l;++h)o[h]=i[h].clone()}return this.clippingPlanes=o,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class yo extends el{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new fn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _o,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Dc=YG();function YG(){const p=new ArrayBuffer(4),t=new Float32Array(p),i=new Uint32Array(p),o=new Uint32Array(512),l=new Uint32Array(512);for(let g=0;g<256;++g){const y=g-127;y<-27?(o[g]=0,o[256|g]=32768,l[g]=24,l[256|g]=24):y<-14?(o[g]=1024>>-y-14,o[256|g]=1024>>-y-14|32768,l[g]=-y-1,l[256|g]=-y-1):y<=15?(o[g]=y+15<<10,o[256|g]=y+15<<10|32768,l[g]=13,l[256|g]=13):y<128?(o[g]=31744,o[256|g]=64512,l[g]=24,l[256|g]=24):(o[g]=31744,o[256|g]=64512,l[g]=13,l[256|g]=13)}const h=new Uint32Array(2048),d=new Uint32Array(64),f=new Uint32Array(64);for(let g=1;g<1024;++g){let y=g<<13,x=0;for(;!(8388608&y);)y<<=1,x-=8388608;y&=-8388609,x+=947912704,h[g]=y|x}for(let g=1024;g<2048;++g)h[g]=939524096+(g-1024<<13);for(let g=1;g<31;++g)d[g]=g<<23;d[31]=1199570944,d[32]=2147483648;for(let g=33;g<63;++g)d[g]=2147483648+(g-32<<23);d[63]=3347054592;for(let g=1;g<64;++g)g!==32&&(f[g]=1024);return{floatView:t,uint32View:i,baseTable:o,shiftTable:l,mantissaTable:h,exponentTable:d,offsetTable:f}}const By={toHalfFloat:function(p){Math.abs(p)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),p=ms(p,-65504,65504),Dc.floatView[0]=p;const t=Dc.uint32View[0],i=t>>23&511;return Dc.baseTable[i]+((8388607&t)>>Dc.shiftTable[i])},fromHalfFloat:function(p){const t=p>>10;return Dc.uint32View[0]=Dc.mantissaTable[Dc.offsetTable[t]+(1023&p)]+Dc.exponentTable[t],Dc.floatView[0]}},jr=new ve,Ry=new Hn;class mr{constructor(t,i,o=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=o,this.usage=iw,this.updateRanges=[],this.gpuType=Wr,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,o){t*=this.itemSize,o*=i.itemSize;for(let l=0,h=this.itemSize;l<h;l++)this.array[t+l]=i.array[o+l];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,o=this.count;i<o;i++)Ry.fromBufferAttribute(this,i),Ry.applyMatrix3(t),this.setXY(i,Ry.x,Ry.y);else if(this.itemSize===3)for(let i=0,o=this.count;i<o;i++)jr.fromBufferAttribute(this,i),jr.applyMatrix3(t),this.setXYZ(i,jr.x,jr.y,jr.z);return this}applyMatrix4(t){for(let i=0,o=this.count;i<o;i++)jr.fromBufferAttribute(this,i),jr.applyMatrix4(t),this.setXYZ(i,jr.x,jr.y,jr.z);return this}applyNormalMatrix(t){for(let i=0,o=this.count;i<o;i++)jr.fromBufferAttribute(this,i),jr.applyNormalMatrix(t),this.setXYZ(i,jr.x,jr.y,jr.z);return this}transformDirection(t){for(let i=0,o=this.count;i<o;i++)jr.fromBufferAttribute(this,i),jr.transformDirection(t),this.setXYZ(i,jr.x,jr.y,jr.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let o=this.array[t*this.itemSize+i];return this.normalized&&(o=Ko(o,this.array)),o}setComponent(t,i,o){return this.normalized&&(o=zi(o,this.array)),this.array[t*this.itemSize+i]=o,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=Ko(i,this.array)),i}setX(t,i){return this.normalized&&(i=zi(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=Ko(i,this.array)),i}setY(t,i){return this.normalized&&(i=zi(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=Ko(i,this.array)),i}setZ(t,i){return this.normalized&&(i=zi(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=Ko(i,this.array)),i}setW(t,i){return this.normalized&&(i=zi(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,o){return t*=this.itemSize,this.normalized&&(i=zi(i,this.array),o=zi(o,this.array)),this.array[t+0]=i,this.array[t+1]=o,this}setXYZ(t,i,o,l){return t*=this.itemSize,this.normalized&&(i=zi(i,this.array),o=zi(o,this.array),l=zi(l,this.array)),this.array[t+0]=i,this.array[t+1]=o,this.array[t+2]=l,this}setXYZW(t,i,o,l,h){return t*=this.itemSize,this.normalized&&(i=zi(i,this.array),o=zi(o,this.array),l=zi(l,this.array),h=zi(h,this.array)),this.array[t+0]=i,this.array[t+1]=o,this.array[t+2]=l,this.array[t+3]=h,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==iw&&(t.usage=this.usage),t}}class JR extends mr{constructor(t,i,o){super(new Uint16Array(t),i,o)}}class $R extends mr{constructor(t,i,o){super(new Uint32Array(t),i,o)}}class qa extends mr{constructor(t,i,o){super(new Float32Array(t),i,o)}}let KG=0;const Eo=new In,ww=new $i,aA=new ve,Xa=new sa,Pm=new sa,gs=new ve;class Ra extends Xo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:KG++}),this.uuid=Yo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(UR(t)?$R:JR)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,o=0){this.groups.push({start:t,count:i,materialIndex:o})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const o=this.attributes.normal;if(o!==void 0){const h=new zn().getNormalMatrix(t);o.applyNormalMatrix(h),o.needsUpdate=!0}const l=this.attributes.tangent;return l!==void 0&&(l.transformDirection(t),l.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Eo.makeRotationFromQuaternion(t),this.applyMatrix4(Eo),this}rotateX(t){return Eo.makeRotationX(t),this.applyMatrix4(Eo),this}rotateY(t){return Eo.makeRotationY(t),this.applyMatrix4(Eo),this}rotateZ(t){return Eo.makeRotationZ(t),this.applyMatrix4(Eo),this}translate(t,i,o){return Eo.makeTranslation(t,i,o),this.applyMatrix4(Eo),this}scale(t,i,o){return Eo.makeScale(t,i,o),this.applyMatrix4(Eo),this}lookAt(t){return ww.lookAt(t),ww.updateMatrix(),this.applyMatrix4(ww.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(aA).negate(),this.translate(aA.x,aA.y,aA.z),this}setFromPoints(t){const i=[];for(let o=0,l=t.length;o<l;o++){const h=t[o];i.push(h.x,h.y,h.z||0)}return this.setAttribute("position",new qa(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new sa);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new ve(-1/0,-1/0,-1/0),new ve(1/0,1/0,1/0));if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let o=0,l=i.length;o<l;o++){const h=i[o];Xa.setFromBufferAttribute(h),this.morphTargetsRelative?(gs.addVectors(this.boundingBox.min,Xa.min),this.boundingBox.expandByPoint(gs),gs.addVectors(this.boundingBox.max,Xa.max),this.boundingBox.expandByPoint(gs)):(this.boundingBox.expandByPoint(Xa.min),this.boundingBox.expandByPoint(Xa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new vo);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new ve,1/0);if(t){const o=this.boundingSphere.center;if(Xa.setFromBufferAttribute(t),i)for(let h=0,d=i.length;h<d;h++){const f=i[h];Pm.setFromBufferAttribute(f),this.morphTargetsRelative?(gs.addVectors(Xa.min,Pm.min),Xa.expandByPoint(gs),gs.addVectors(Xa.max,Pm.max),Xa.expandByPoint(gs)):(Xa.expandByPoint(Pm.min),Xa.expandByPoint(Pm.max))}Xa.getCenter(o);let l=0;for(let h=0,d=t.count;h<d;h++)gs.fromBufferAttribute(t,h),l=Math.max(l,o.distanceToSquared(gs));if(i)for(let h=0,d=i.length;h<d;h++){const f=i[h],g=this.morphTargetsRelative;for(let y=0,x=f.count;y<x;y++)gs.fromBufferAttribute(f,y),g&&(aA.fromBufferAttribute(t,y),gs.add(aA)),l=Math.max(l,o.distanceToSquared(gs))}this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const o=i.position,l=i.normal,h=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mr(new Float32Array(4*o.count),4));const d=this.getAttribute("tangent"),f=[],g=[];for(let ne=0;ne<o.count;ne++)f[ne]=new ve,g[ne]=new ve;const y=new ve,x=new ve,b=new ve,_=new Hn,w=new Hn,T=new Hn,P=new ve,U=new ve;function D(ne,le,fe){y.fromBufferAttribute(o,ne),x.fromBufferAttribute(o,le),b.fromBufferAttribute(o,fe),_.fromBufferAttribute(h,ne),w.fromBufferAttribute(h,le),T.fromBufferAttribute(h,fe),x.sub(y),b.sub(y),w.sub(_),T.sub(_);const be=1/(w.x*T.y-T.x*w.y);isFinite(be)&&(P.copy(x).multiplyScalar(T.y).addScaledVector(b,-w.y).multiplyScalar(be),U.copy(b).multiplyScalar(w.x).addScaledVector(x,-T.x).multiplyScalar(be),f[ne].add(P),f[le].add(P),f[fe].add(P),g[ne].add(U),g[le].add(U),g[fe].add(U))}let z=this.groups;z.length===0&&(z=[{start:0,count:t.count}]);for(let ne=0,le=z.length;ne<le;++ne){const fe=z[ne],be=fe.start;for(let de=be,Fe=be+fe.count;de<Fe;de+=3)D(t.getX(de+0),t.getX(de+1),t.getX(de+2))}const G=new ve,Q=new ve,Y=new ve,q=new ve;function K(ne){Y.fromBufferAttribute(l,ne),q.copy(Y);const le=f[ne];G.copy(le),G.sub(Y.multiplyScalar(Y.dot(le))).normalize(),Q.crossVectors(q,le);const fe=Q.dot(g[ne])<0?-1:1;d.setXYZW(ne,G.x,G.y,G.z,fe)}for(let ne=0,le=z.length;ne<le;++ne){const fe=z[ne],be=fe.start;for(let de=be,Fe=be+fe.count;de<Fe;de+=3)K(t.getX(de+0)),K(t.getX(de+1)),K(t.getX(de+2))}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let o=this.getAttribute("normal");if(o===void 0)o=new mr(new Float32Array(3*i.count),3),this.setAttribute("normal",o);else for(let _=0,w=o.count;_<w;_++)o.setXYZ(_,0,0,0);const l=new ve,h=new ve,d=new ve,f=new ve,g=new ve,y=new ve,x=new ve,b=new ve;if(t)for(let _=0,w=t.count;_<w;_+=3){const T=t.getX(_+0),P=t.getX(_+1),U=t.getX(_+2);l.fromBufferAttribute(i,T),h.fromBufferAttribute(i,P),d.fromBufferAttribute(i,U),x.subVectors(d,h),b.subVectors(l,h),x.cross(b),f.fromBufferAttribute(o,T),g.fromBufferAttribute(o,P),y.fromBufferAttribute(o,U),f.add(x),g.add(x),y.add(x),o.setXYZ(T,f.x,f.y,f.z),o.setXYZ(P,g.x,g.y,g.z),o.setXYZ(U,y.x,y.y,y.z)}else for(let _=0,w=i.count;_<w;_+=3)l.fromBufferAttribute(i,_+0),h.fromBufferAttribute(i,_+1),d.fromBufferAttribute(i,_+2),x.subVectors(d,h),b.subVectors(l,h),x.cross(b),o.setXYZ(_+0,x.x,x.y,x.z),o.setXYZ(_+1,x.x,x.y,x.z),o.setXYZ(_+2,x.x,x.y,x.z);this.normalizeNormals(),o.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,o=t.count;i<o;i++)gs.fromBufferAttribute(t,i),gs.normalize(),t.setXYZ(i,gs.x,gs.y,gs.z)}toNonIndexed(){function t(f,g){const y=f.array,x=f.itemSize,b=f.normalized,_=new y.constructor(g.length*x);let w=0,T=0;for(let P=0,U=g.length;P<U;P++){w=f.isInterleavedBufferAttribute?g[P]*f.data.stride+f.offset:g[P]*x;for(let D=0;D<x;D++)_[T++]=y[w++]}return new mr(_,x,b)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Ra,o=this.index.array,l=this.attributes;for(const f in l){const g=t(l[f],o);i.setAttribute(f,g)}const h=this.morphAttributes;for(const f in h){const g=[],y=h[f];for(let x=0,b=y.length;x<b;x++){const _=t(y[x],o);g.push(_)}i.morphAttributes[f]=g}i.morphTargetsRelative=this.morphTargetsRelative;const d=this.groups;for(let f=0,g=d.length;f<g;f++){const y=d[f];i.addGroup(y.start,y.count,y.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const g=this.parameters;for(const y in g)g[y]!==void 0&&(t[y]=g[y]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const o=this.attributes;for(const g in o){const y=o[g];t.data.attributes[g]=y.toJSON(t.data)}const l={};let h=!1;for(const g in this.morphAttributes){const y=this.morphAttributes[g],x=[];for(let b=0,_=y.length;b<_;b++){const w=y[b];x.push(w.toJSON(t.data))}x.length>0&&(l[g]=x,h=!0)}h&&(t.data.morphAttributes=l,t.data.morphTargetsRelative=this.morphTargetsRelative);const d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));const f=this.boundingSphere;return f!==null&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const o=t.index;o!==null&&this.setIndex(o.clone(i));const l=t.attributes;for(const y in l){const x=l[y];this.setAttribute(y,x.clone(i))}const h=t.morphAttributes;for(const y in h){const x=[],b=h[y];for(let _=0,w=b.length;_<w;_++)x.push(b[_].clone(i));this.morphAttributes[y]=x}this.morphTargetsRelative=t.morphTargetsRelative;const d=t.groups;for(let y=0,x=d.length;y<x;y++){const b=d[y];this.addGroup(b.start,b.count,b.materialIndex)}const f=t.boundingBox;f!==null&&(this.boundingBox=f.clone());const g=t.boundingSphere;return g!==null&&(this.boundingSphere=g.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const ZR=new In,ud=new Lm,Ly=new vo,eL=new ve,Dy=new ve,Py=new ve,Uy=new ve,Mw=new ve,Ny=new ve,tL=new ve,Fy=new ve;class Vi extends $i{constructor(t=new Ra,i=new yo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=o.length;l<h;l++){const d=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}getVertexPosition(t,i){const o=this.geometry,l=o.attributes.position,h=o.morphAttributes.position,d=o.morphTargetsRelative;i.fromBufferAttribute(l,t);const f=this.morphTargetInfluences;if(h&&f){Ny.set(0,0,0);for(let g=0,y=h.length;g<y;g++){const x=f[g],b=h[g];x!==0&&(Mw.fromBufferAttribute(b,t),d?Ny.addScaledVector(Mw,x):Ny.addScaledVector(Mw.sub(i),x))}i.add(Ny)}return i}raycast(t,i){const o=this.geometry,l=this.material,h=this.matrixWorld;if(l!==void 0){if(o.boundingSphere===null&&o.computeBoundingSphere(),Ly.copy(o.boundingSphere),Ly.applyMatrix4(h),ud.copy(t.ray).recast(t.near),Ly.containsPoint(ud.origin)===!1&&(ud.intersectSphere(Ly,eL)===null||ud.origin.distanceToSquared(eL)>(t.far-t.near)**2))return;ZR.copy(h).invert(),ud.copy(t.ray).applyMatrix4(ZR),o.boundingBox!==null&&ud.intersectsBox(o.boundingBox)===!1||this._computeIntersections(t,i,ud)}}_computeIntersections(t,i,o){let l;const h=this.geometry,d=this.material,f=h.index,g=h.attributes.position,y=h.attributes.uv,x=h.attributes.uv1,b=h.attributes.normal,_=h.groups,w=h.drawRange;if(f!==null)if(Array.isArray(d))for(let T=0,P=_.length;T<P;T++){const U=_[T],D=d[U.materialIndex];for(let z=Math.max(U.start,w.start),G=Math.min(f.count,Math.min(U.start+U.count,w.start+w.count));z<G;z+=3)l=Oy(this,D,t,o,y,x,b,f.getX(z),f.getX(z+1),f.getX(z+2)),l&&(l.faceIndex=Math.floor(z/3),l.face.materialIndex=U.materialIndex,i.push(l))}else for(let T=Math.max(0,w.start),P=Math.min(f.count,w.start+w.count);T<P;T+=3)l=Oy(this,d,t,o,y,x,b,f.getX(T),f.getX(T+1),f.getX(T+2)),l&&(l.faceIndex=Math.floor(T/3),i.push(l));else if(g!==void 0)if(Array.isArray(d))for(let T=0,P=_.length;T<P;T++){const U=_[T],D=d[U.materialIndex];for(let z=Math.max(U.start,w.start),G=Math.min(g.count,Math.min(U.start+U.count,w.start+w.count));z<G;z+=3)l=Oy(this,D,t,o,y,x,b,z,z+1,z+2),l&&(l.faceIndex=Math.floor(z/3),l.face.materialIndex=U.materialIndex,i.push(l))}else for(let T=Math.max(0,w.start),P=Math.min(g.count,w.start+w.count);T<P;T+=3)l=Oy(this,d,t,o,y,x,b,T,T+1,T+2),l&&(l.faceIndex=Math.floor(T/3),i.push(l))}}function Oy(p,t,i,o,l,h,d,f,g,y){p.getVertexPosition(f,Dy),p.getVertexPosition(g,Py),p.getVertexPosition(y,Uy);const x=function(b,_,w,T,P,U,D,z){let G;if(G=_.side===1?T.intersectTriangle(D,U,P,!0,z):T.intersectTriangle(P,U,D,_.side===0,z),G===null)return null;Fy.copy(z),Fy.applyMatrix4(b.matrixWorld);const Q=w.ray.origin.distanceTo(Fy);return Q<w.near||Q>w.far?null:{distance:Q,point:Fy.clone(),object:b}}(p,t,i,o,Dy,Py,Uy,tL);if(x){const b=new ve;Ja.getBarycoord(tL,Dy,Py,Uy,b),l&&(x.uv=Ja.getInterpolatedAttribute(l,f,g,y,b,new Hn)),h&&(x.uv1=Ja.getInterpolatedAttribute(h,f,g,y,b,new Hn)),d&&(x.normal=Ja.getInterpolatedAttribute(d,f,g,y,b,new ve),x.normal.dot(o.direction)>0&&x.normal.multiplyScalar(-1));const _={a:f,b:g,c:y,normal:new ve,materialIndex:0};Ja.getNormal(Dy,Py,Uy,_.normal),x.face=_,x.barycoord=b}return x}class jc extends Ra{constructor(t=1,i=1,o=1,l=1,h=1,d=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:o,widthSegments:l,heightSegments:h,depthSegments:d};const f=this;l=Math.floor(l),h=Math.floor(h),d=Math.floor(d);const g=[],y=[],x=[],b=[];let _=0,w=0;function T(P,U,D,z,G,Q,Y,q,K,ne,le){const fe=Q/K,be=Y/ne,de=Q/2,Fe=Y/2,we=q/2,Me=K+1,_e=ne+1;let tt=0,me=0;const wt=new ve;for(let ft=0;ft<_e;ft++){const ze=ft*be-Fe;for(let $e=0;$e<Me;$e++){const pt=$e*fe-de;wt[P]=pt*z,wt[U]=ze*G,wt[D]=we,y.push(wt.x,wt.y,wt.z),wt[P]=0,wt[U]=0,wt[D]=q>0?1:-1,x.push(wt.x,wt.y,wt.z),b.push($e/K),b.push(1-ft/ne),tt+=1}}for(let ft=0;ft<ne;ft++)for(let ze=0;ze<K;ze++){const $e=_+ze+Me*ft,pt=_+ze+Me*(ft+1),lt=_+(ze+1)+Me*(ft+1),he=_+(ze+1)+Me*ft;g.push($e,pt,he),g.push(pt,lt,he),me+=6}f.addGroup(w,me,le),w+=me,_+=tt}T("z","y","x",-1,-1,o,i,t,d,h,0),T("z","y","x",1,-1,o,i,-t,d,h,1),T("x","z","y",1,1,t,o,i,l,d,2),T("x","z","y",1,-1,t,o,-i,l,d,3),T("x","y","z",1,-1,t,i,o,l,h,4),T("x","y","z",-1,-1,t,i,-o,l,h,5),this.setIndex(g),this.setAttribute("position",new qa(y,3)),this.setAttribute("normal",new qa(x,3)),this.setAttribute("uv",new qa(b,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new jc(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function oA(p){const t={};for(const i in p){t[i]={};for(const o in p[i]){const l=p[i][o];l&&(l.isColor||l.isMatrix3||l.isMatrix4||l.isVector2||l.isVector3||l.isVector4||l.isTexture||l.isQuaternion)?l.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][o]=null):t[i][o]=l.clone():Array.isArray(l)?t[i][o]=l.slice():t[i][o]=l}}return t}function aa(p){const t={};for(let i=0;i<p.length;i++){const o=oA(p[i]);for(const l in o)t[l]=o[l]}return t}function nL(p){const t=p.getRenderTarget();return t===null?p.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:Si.workingColorSpace}const JG={clone:oA,merge:aa};class Ta extends el{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=oA(t.uniforms),this.uniformsGroups=function(i){const o=[];for(let l=0;l<i.length;l++)o.push(i[l].clone());return o}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const l in this.uniforms){const h=this.uniforms[l].value;h&&h.isTexture?i.uniforms[l]={type:"t",value:h.toJSON(t).uuid}:h&&h.isColor?i.uniforms[l]={type:"c",value:h.getHex()}:h&&h.isVector2?i.uniforms[l]={type:"v2",value:h.toArray()}:h&&h.isVector3?i.uniforms[l]={type:"v3",value:h.toArray()}:h&&h.isVector4?i.uniforms[l]={type:"v4",value:h.toArray()}:h&&h.isMatrix3?i.uniforms[l]={type:"m3",value:h.toArray()}:h&&h.isMatrix4?i.uniforms[l]={type:"m4",value:h.toArray()}:i.uniforms[l]={value:h}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const o={};for(const l in this.extensions)this.extensions[l]===!0&&(o[l]=!0);return Object.keys(o).length>0&&(i.extensions=o),i}}class iL extends $i{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new In,this.projectionMatrix=new In,this.projectionMatrixInverse=new In,this.coordinateSystem=Xp}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Nh=new ve,rL=new Hn,sL=new Hn;class vs extends iL{constructor(t=50,i=1,o=.1,l=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=o,this.far=l,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=2*Yp*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Mm*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Yp*Math.atan(Math.tan(.5*Mm*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,i,o){Nh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Nh.x,Nh.y).multiplyScalar(-t/Nh.z),Nh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),o.set(Nh.x,Nh.y).multiplyScalar(-t/Nh.z)}getViewSize(t,i){return this.getViewBounds(t,rL,sL),i.subVectors(sL,rL)}setViewOffset(t,i,o,l,h,d){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=o,this.view.offsetY=l,this.view.width=h,this.view.height=d,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(.5*Mm*this.fov)/this.zoom,o=2*i,l=this.aspect*o,h=-.5*l;const d=this.view;if(this.view!==null&&this.view.enabled){const g=d.fullWidth,y=d.fullHeight;h+=d.offsetX*l/g,i-=d.offsetY*o/y,l*=d.width/g,o*=d.height/y}const f=this.filmOffset;f!==0&&(h+=t*f/this.getFilmWidth()),this.projectionMatrix.makePerspective(h,h+l,i,i-o,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const lA=-90;class Sw extends $i{constructor(t,i,o){super(),this.type="CubeCamera",this.renderTarget=o,this.coordinateSystem=null,this.activeMipmapLevel=0;const l=new vs(lA,1,t,i);l.layers=this.layers,this.add(l);const h=new vs(lA,1,t,i);h.layers=this.layers,this.add(h);const d=new vs(lA,1,t,i);d.layers=this.layers,this.add(d);const f=new vs(lA,1,t,i);f.layers=this.layers,this.add(f);const g=new vs(lA,1,t,i);g.layers=this.layers,this.add(g);const y=new vs(lA,1,t,i);y.layers=this.layers,this.add(y)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[o,l,h,d,f,g]=i;for(const y of i)this.remove(y);if(t===Xp)o.up.set(0,1,0),o.lookAt(1,0,0),l.up.set(0,1,0),l.lookAt(-1,0,0),h.up.set(0,0,-1),h.lookAt(0,1,0),d.up.set(0,0,1),d.lookAt(0,-1,0),f.up.set(0,1,0),f.lookAt(0,0,1),g.up.set(0,1,0),g.lookAt(0,0,-1);else{if(t!==yy)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);o.up.set(0,-1,0),o.lookAt(-1,0,0),l.up.set(0,-1,0),l.lookAt(1,0,0),h.up.set(0,0,1),h.lookAt(0,1,0),d.up.set(0,0,-1),d.lookAt(0,-1,0),f.up.set(0,-1,0),f.lookAt(0,0,1),g.up.set(0,-1,0),g.lookAt(0,0,-1)}for(const y of i)this.add(y),y.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:o,activeMipmapLevel:l}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[h,d,f,g,y,x]=this.children,b=t.getRenderTarget(),_=t.getActiveCubeFace(),w=t.getActiveMipmapLevel(),T=t.xr.enabled;t.xr.enabled=!1;const P=o.texture.generateMipmaps;o.texture.generateMipmaps=!1,t.setRenderTarget(o,0,l),t.render(i,h),t.setRenderTarget(o,1,l),t.render(i,d),t.setRenderTarget(o,2,l),t.render(i,f),t.setRenderTarget(o,3,l),t.render(i,g),t.setRenderTarget(o,4,l),t.render(i,y),o.texture.generateMipmaps=P,t.setRenderTarget(o,5,l),t.render(i,x),t.setRenderTarget(b,_,w),t.xr.enabled=T,o.texture.needsPMREMUpdate=!0}}class aL extends qi{constructor(t,i,o,l,h,d,f,g,y,x){super(t=t!==void 0?t:[],i=i!==void 0?i:ad,o,l,h,d,f,g,y,x),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Iw extends go{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const o={width:t,height:t,depth:1},l=[o,o,o,o,o,o];this.texture=new aL(l,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0&&i.generateMipmaps,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Fi}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const o={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},l=new jc(5,5,5),h=new Ta({name:"CubemapFromEquirect",uniforms:oA(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,side:1,blending:0});h.uniforms.tEquirect.value=i;const d=new Vi(l,h),f=i.minFilter;return i.minFilter===mo&&(i.minFilter=Fi),new Sw(1,10,this).update(t,d),i.minFilter=f,d.geometry.dispose(),d.material.dispose(),this}clear(t,i,o,l){const h=t.getRenderTarget();for(let d=0;d<6;d++)t.setRenderTarget(this,d),t.clear(i,o,l);t.setRenderTarget(h)}}const Tw=new ve,$G=new ve,ZG=new zn;class dd{constructor(t=new ve(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,o,l){return this.normal.set(t,i,o),this.constant=l,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,o){const l=Tw.subVectors(o,i).cross($G.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(l,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const o=t.delta(Tw),l=this.normal.dot(o);if(l===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const h=-(t.start.dot(this.normal)+this.constant)/l;return h<0||h>1?null:i.copy(t.start).addScaledVector(o,h)}intersectsLine(t){const i=this.distanceToPoint(t.start),o=this.distanceToPoint(t.end);return i<0&&o>0||o<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const o=i||ZG.getNormalMatrix(t),l=this.coplanarPoint(Tw).applyMatrix4(t),h=this.normal.applyMatrix3(o).normalize();return this.constant=-l.dot(h),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const pd=new vo,ky=new ve;class Bw{constructor(t=new dd,i=new dd,o=new dd,l=new dd,h=new dd,d=new dd){this.planes=[t,i,o,l,h,d]}set(t,i,o,l,h,d){const f=this.planes;return f[0].copy(t),f[1].copy(i),f[2].copy(o),f[3].copy(l),f[4].copy(h),f[5].copy(d),this}copy(t){const i=this.planes;for(let o=0;o<6;o++)i[o].copy(t.planes[o]);return this}setFromProjectionMatrix(t,i=2e3){const o=this.planes,l=t.elements,h=l[0],d=l[1],f=l[2],g=l[3],y=l[4],x=l[5],b=l[6],_=l[7],w=l[8],T=l[9],P=l[10],U=l[11],D=l[12],z=l[13],G=l[14],Q=l[15];if(o[0].setComponents(g-h,_-y,U-w,Q-D).normalize(),o[1].setComponents(g+h,_+y,U+w,Q+D).normalize(),o[2].setComponents(g+d,_+x,U+T,Q+z).normalize(),o[3].setComponents(g-d,_-x,U-T,Q-z).normalize(),o[4].setComponents(g-f,_-b,U-P,Q-G).normalize(),i===Xp)o[5].setComponents(g+f,_+b,U+P,Q+G).normalize();else{if(i!==yy)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);o[5].setComponents(f,b,P,G).normalize()}return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),pd.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),pd.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(pd)}intersectsSprite(t){return pd.center.set(0,0,0),pd.radius=.7071067811865476,pd.applyMatrix4(t.matrixWorld),this.intersectsSphere(pd)}intersectsSphere(t){const i=this.planes,o=t.center,l=-t.radius;for(let h=0;h<6;h++)if(i[h].distanceToPoint(o)<l)return!1;return!0}intersectsBox(t){const i=this.planes;for(let o=0;o<6;o++){const l=i[o];if(ky.x=l.normal.x>0?t.max.x:t.min.x,ky.y=l.normal.y>0?t.max.y:t.min.y,ky.z=l.normal.z>0?t.max.z:t.min.z,l.distanceToPoint(ky)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let o=0;o<6;o++)if(i[o].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function oL(){let p=null,t=!1,i=null,o=null;function l(h,d){i(h,d),o=p.requestAnimationFrame(l)}return{start:function(){t!==!0&&i!==null&&(o=p.requestAnimationFrame(l),t=!0)},stop:function(){p.cancelAnimationFrame(o),t=!1},setAnimationLoop:function(h){i=h},setContext:function(h){p=h}}}function eH(p){const t=new WeakMap;return{get:function(i){return i.isInterleavedBufferAttribute&&(i=i.data),t.get(i)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);const o=t.get(i);o&&(p.deleteBuffer(o.buffer),t.delete(i))},update:function(i,o){if(i.isInterleavedBufferAttribute&&(i=i.data),i.isGLBufferAttribute){const h=t.get(i);return void((!h||h.version<i.version)&&t.set(i,{buffer:i.buffer,type:i.type,bytesPerElement:i.elementSize,version:i.version}))}const l=t.get(i);if(l===void 0)t.set(i,function(h,d){const f=h.array,g=h.usage,y=f.byteLength,x=p.createBuffer();let b;if(p.bindBuffer(d,x),p.bufferData(d,f,g),h.onUploadCallback(),f instanceof Float32Array)b=p.FLOAT;else if(f instanceof Uint16Array)b=h.isFloat16BufferAttribute?p.HALF_FLOAT:p.UNSIGNED_SHORT;else if(f instanceof Int16Array)b=p.SHORT;else if(f instanceof Uint32Array)b=p.UNSIGNED_INT;else if(f instanceof Int32Array)b=p.INT;else if(f instanceof Int8Array)b=p.BYTE;else if(f instanceof Uint8Array)b=p.UNSIGNED_BYTE;else{if(!(f instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);b=p.UNSIGNED_BYTE}return{buffer:x,type:b,bytesPerElement:f.BYTES_PER_ELEMENT,version:h.version,size:y}}(i,o));else if(l.version<i.version){if(l.size!==i.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(h,d,f){const g=d.array,y=d.updateRanges;if(p.bindBuffer(f,h),y.length===0)p.bufferSubData(f,0,g);else{y.sort((b,_)=>b.start-_.start);let x=0;for(let b=1;b<y.length;b++){const _=y[x],w=y[b];w.start<=_.start+_.count+1?_.count=Math.max(_.count,w.start+w.count-_.start):(++x,y[x]=w)}y.length=x+1;for(let b=0,_=y.length;b<_;b++){const w=y[b];p.bufferSubData(f,w.start*g.BYTES_PER_ELEMENT,g,w.start,w.count)}d.clearUpdateRanges()}d.onUploadCallback()})(l.buffer,i,o),l.version=i.version}}}}class Fl extends Ra{constructor(t=1,i=1,o=1,l=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:o,heightSegments:l};const h=t/2,d=i/2,f=Math.floor(o),g=Math.floor(l),y=f+1,x=g+1,b=t/f,_=i/g,w=[],T=[],P=[],U=[];for(let D=0;D<x;D++){const z=D*_-d;for(let G=0;G<y;G++){const Q=G*b-h;T.push(Q,-z,0),P.push(0,0,1),U.push(G/f),U.push(1-D/g)}}for(let D=0;D<g;D++)for(let z=0;z<f;z++){const G=z+y*D,Q=z+y*(D+1),Y=z+1+y*(D+1),q=z+1+y*D;w.push(G,Q,q),w.push(Q,Y,q)}this.setIndex(w),this.setAttribute("position",new qa(T,3)),this.setAttribute("normal",new qa(P,3)),this.setAttribute("uv",new qa(U,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Fl(t.width,t.height,t.widthSegments,t.heightSegments)}}const Zn={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex:`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex:`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex:`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Gt={common:{diffuse:{value:new fn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new zn},alphaMap:{value:null},alphaMapTransform:{value:new zn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new zn}},envmap:{envMap:{value:null},envMapRotation:{value:new zn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new zn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new zn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new zn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new zn},normalScale:{value:new Hn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new zn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new zn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new zn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new zn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new zn},alphaTest:{value:0},uvTransform:{value:new zn}},sprite:{diffuse:{value:new fn(16777215)},opacity:{value:1},center:{value:new Hn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new zn},alphaMap:{value:null},alphaMapTransform:{value:new zn},alphaTest:{value:0}}},Il={basic:{uniforms:aa([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.fog]),vertexShader:Zn.meshbasic_vert,fragmentShader:Zn.meshbasic_frag},lambert:{uniforms:aa([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new fn(0)}}]),vertexShader:Zn.meshlambert_vert,fragmentShader:Zn.meshlambert_frag},phong:{uniforms:aa([Gt.common,Gt.specularmap,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,Gt.lights,{emissive:{value:new fn(0)},specular:{value:new fn(1118481)},shininess:{value:30}}]),vertexShader:Zn.meshphong_vert,fragmentShader:Zn.meshphong_frag},standard:{uniforms:aa([Gt.common,Gt.envmap,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.roughnessmap,Gt.metalnessmap,Gt.fog,Gt.lights,{emissive:{value:new fn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Zn.meshphysical_vert,fragmentShader:Zn.meshphysical_frag},toon:{uniforms:aa([Gt.common,Gt.aomap,Gt.lightmap,Gt.emissivemap,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.gradientmap,Gt.fog,Gt.lights,{emissive:{value:new fn(0)}}]),vertexShader:Zn.meshtoon_vert,fragmentShader:Zn.meshtoon_frag},matcap:{uniforms:aa([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,Gt.fog,{matcap:{value:null}}]),vertexShader:Zn.meshmatcap_vert,fragmentShader:Zn.meshmatcap_frag},points:{uniforms:aa([Gt.points,Gt.fog]),vertexShader:Zn.points_vert,fragmentShader:Zn.points_frag},dashed:{uniforms:aa([Gt.common,Gt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zn.linedashed_vert,fragmentShader:Zn.linedashed_frag},depth:{uniforms:aa([Gt.common,Gt.displacementmap]),vertexShader:Zn.depth_vert,fragmentShader:Zn.depth_frag},normal:{uniforms:aa([Gt.common,Gt.bumpmap,Gt.normalmap,Gt.displacementmap,{opacity:{value:1}}]),vertexShader:Zn.meshnormal_vert,fragmentShader:Zn.meshnormal_frag},sprite:{uniforms:aa([Gt.sprite,Gt.fog]),vertexShader:Zn.sprite_vert,fragmentShader:Zn.sprite_frag},background:{uniforms:{uvTransform:{value:new zn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Zn.background_vert,fragmentShader:Zn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new zn}},vertexShader:Zn.backgroundCube_vert,fragmentShader:Zn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Zn.cube_vert,fragmentShader:Zn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zn.equirect_vert,fragmentShader:Zn.equirect_frag},distanceRGBA:{uniforms:aa([Gt.common,Gt.displacementmap,{referencePosition:{value:new ve},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zn.distanceRGBA_vert,fragmentShader:Zn.distanceRGBA_frag},shadow:{uniforms:aa([Gt.lights,Gt.fog,{color:{value:new fn(0)},opacity:{value:1}}]),vertexShader:Zn.shadow_vert,fragmentShader:Zn.shadow_frag}};Il.physical={uniforms:aa([Il.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new zn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new zn},clearcoatNormalScale:{value:new Hn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new zn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new zn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new zn},sheen:{value:0},sheenColor:{value:new fn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new zn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new zn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new zn},transmissionSamplerSize:{value:new Hn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new zn},attenuationDistance:{value:0},attenuationColor:{value:new fn(0)},specularColor:{value:new fn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new zn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new zn},anisotropyVector:{value:new Hn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new zn}}]),vertexShader:Zn.meshphysical_vert,fragmentShader:Zn.meshphysical_frag};const Qy={r:0,b:0,g:0},Ad=new _o,tH=new In;function nH(p,t,i,o,l,h,d){const f=new fn(0);let g,y,x=h===!0?0:1,b=null,_=0,w=null;function T(U){let D=U.isScene===!0?U.background:null;return D&&D.isTexture&&(D=(U.backgroundBlurriness>0?i:t).get(D)),D}function P(U,D){U.getRGB(Qy,nL(p)),o.buffers.color.setClear(Qy.r,Qy.g,Qy.b,D,d)}return{getClearColor:function(){return f},setClearColor:function(U,D=1){f.set(U),x=D,P(f,x)},getClearAlpha:function(){return x},setClearAlpha:function(U){x=U,P(f,x)},render:function(U){let D=!1;const z=T(U);z===null?P(f,x):z&&z.isColor&&(P(z,1),D=!0);const G=p.xr.getEnvironmentBlendMode();G==="additive"?o.buffers.color.setClear(0,0,0,1,d):G==="alpha-blend"&&o.buffers.color.setClear(0,0,0,0,d),(p.autoClear||D)&&(o.buffers.depth.setTest(!0),o.buffers.depth.setMask(!0),o.buffers.color.setMask(!0),p.clear(p.autoClearColor,p.autoClearDepth,p.autoClearStencil))},addToRenderList:function(U,D){const z=T(D);z&&(z.isCubeTexture||z.mapping===ry)?(y===void 0&&(y=new Vi(new jc(1,1,1),new Ta({name:"BackgroundCubeMaterial",uniforms:oA(Il.backgroundCube.uniforms),vertexShader:Il.backgroundCube.vertexShader,fragmentShader:Il.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),y.geometry.deleteAttribute("normal"),y.geometry.deleteAttribute("uv"),y.onBeforeRender=function(G,Q,Y){this.matrixWorld.copyPosition(Y.matrixWorld)},Object.defineProperty(y.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),l.update(y)),Ad.copy(D.backgroundRotation),Ad.x*=-1,Ad.y*=-1,Ad.z*=-1,z.isCubeTexture&&z.isRenderTargetTexture===!1&&(Ad.y*=-1,Ad.z*=-1),y.material.uniforms.envMap.value=z,y.material.uniforms.flipEnvMap.value=z.isCubeTexture&&z.isRenderTargetTexture===!1?-1:1,y.material.uniforms.backgroundBlurriness.value=D.backgroundBlurriness,y.material.uniforms.backgroundIntensity.value=D.backgroundIntensity,y.material.uniforms.backgroundRotation.value.setFromMatrix4(tH.makeRotationFromEuler(Ad)),y.material.toneMapped=Si.getTransfer(z.colorSpace)!==ar,b===z&&_===z.version&&w===p.toneMapping||(y.material.needsUpdate=!0,b=z,_=z.version,w=p.toneMapping),y.layers.enableAll(),U.unshift(y,y.geometry,y.material,0,0,null)):z&&z.isTexture&&(g===void 0&&(g=new Vi(new Fl(2,2),new Ta({name:"BackgroundMaterial",uniforms:oA(Il.background.uniforms),vertexShader:Il.background.vertexShader,fragmentShader:Il.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),l.update(g)),g.material.uniforms.t2D.value=z,g.material.uniforms.backgroundIntensity.value=D.backgroundIntensity,g.material.toneMapped=Si.getTransfer(z.colorSpace)!==ar,z.matrixAutoUpdate===!0&&z.updateMatrix(),g.material.uniforms.uvTransform.value.copy(z.matrix),b===z&&_===z.version&&w===p.toneMapping||(g.material.needsUpdate=!0,b=z,_=z.version,w=p.toneMapping),g.layers.enableAll(),U.unshift(g,g.geometry,g.material,0,0,null))}}}function iH(p,t){const i=p.getParameter(p.MAX_VERTEX_ATTRIBS),o={},l=y(null);let h=l,d=!1;function f(D){return p.bindVertexArray(D)}function g(D){return p.deleteVertexArray(D)}function y(D){const z=[],G=[],Q=[];for(let Y=0;Y<i;Y++)z[Y]=0,G[Y]=0,Q[Y]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:G,attributeDivisors:Q,object:D,attributes:{},index:null}}function x(){const D=h.newAttributes;for(let z=0,G=D.length;z<G;z++)D[z]=0}function b(D){_(D,0)}function _(D,z){const G=h.newAttributes,Q=h.enabledAttributes,Y=h.attributeDivisors;G[D]=1,Q[D]===0&&(p.enableVertexAttribArray(D),Q[D]=1),Y[D]!==z&&(p.vertexAttribDivisor(D,z),Y[D]=z)}function w(){const D=h.newAttributes,z=h.enabledAttributes;for(let G=0,Q=z.length;G<Q;G++)z[G]!==D[G]&&(p.disableVertexAttribArray(G),z[G]=0)}function T(D,z,G,Q,Y,q,K){K===!0?p.vertexAttribIPointer(D,z,G,Y,q):p.vertexAttribPointer(D,z,G,Q,Y,q)}function P(){U(),d=!0,h!==l&&(h=l,f(h.object))}function U(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(D,z,G,Q,Y){let q=!1;const K=function(ne,le,fe){const be=fe.wireframe===!0;let de=o[ne.id];de===void 0&&(de={},o[ne.id]=de);let Fe=de[le.id];Fe===void 0&&(Fe={},de[le.id]=Fe);let we=Fe[be];return we===void 0&&(we=y(p.createVertexArray()),Fe[be]=we),we}(Q,G,z);h!==K&&(h=K,f(h.object)),q=function(ne,le,fe,be){const de=h.attributes,Fe=le.attributes;let we=0;const Me=fe.getAttributes();for(const _e in Me)if(Me[_e].location>=0){const tt=de[_e];let me=Fe[_e];if(me===void 0&&(_e==="instanceMatrix"&&ne.instanceMatrix&&(me=ne.instanceMatrix),_e==="instanceColor"&&ne.instanceColor&&(me=ne.instanceColor)),tt===void 0||tt.attribute!==me||me&&tt.data!==me.data)return!0;we++}return h.attributesNum!==we||h.index!==be}(D,Q,G,Y),q&&function(ne,le,fe,be){const de={},Fe=le.attributes;let we=0;const Me=fe.getAttributes();for(const _e in Me)if(Me[_e].location>=0){let tt=Fe[_e];tt===void 0&&(_e==="instanceMatrix"&&ne.instanceMatrix&&(tt=ne.instanceMatrix),_e==="instanceColor"&&ne.instanceColor&&(tt=ne.instanceColor));const me={};me.attribute=tt,tt&&tt.data&&(me.data=tt.data),de[_e]=me,we++}h.attributes=de,h.attributesNum=we,h.index=be}(D,Q,G,Y),Y!==null&&t.update(Y,p.ELEMENT_ARRAY_BUFFER),(q||d)&&(d=!1,function(ne,le,fe,be){x();const de=be.attributes,Fe=fe.getAttributes(),we=le.defaultAttributeValues;for(const Me in Fe){const _e=Fe[Me];if(_e.location>=0){let tt=de[Me];if(tt===void 0&&(Me==="instanceMatrix"&&ne.instanceMatrix&&(tt=ne.instanceMatrix),Me==="instanceColor"&&ne.instanceColor&&(tt=ne.instanceColor)),tt!==void 0){const me=tt.normalized,wt=tt.itemSize,ft=t.get(tt);if(ft===void 0)continue;const ze=ft.buffer,$e=ft.type,pt=ft.bytesPerElement,lt=$e===p.INT||$e===p.UNSIGNED_INT||tt.gpuType===ay;if(tt.isInterleavedBufferAttribute){const he=tt.data,Z=he.stride,Ce=tt.offset;if(he.isInstancedInterleavedBuffer){for(let Qe=0;Qe<_e.locationSize;Qe++)_(_e.location+Qe,he.meshPerAttribute);ne.isInstancedMesh!==!0&&be._maxInstanceCount===void 0&&(be._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let Qe=0;Qe<_e.locationSize;Qe++)b(_e.location+Qe);p.bindBuffer(p.ARRAY_BUFFER,ze);for(let Qe=0;Qe<_e.locationSize;Qe++)T(_e.location+Qe,wt/_e.locationSize,$e,me,Z*pt,(Ce+wt/_e.locationSize*Qe)*pt,lt)}else{if(tt.isInstancedBufferAttribute){for(let he=0;he<_e.locationSize;he++)_(_e.location+he,tt.meshPerAttribute);ne.isInstancedMesh!==!0&&be._maxInstanceCount===void 0&&(be._maxInstanceCount=tt.meshPerAttribute*tt.count)}else for(let he=0;he<_e.locationSize;he++)b(_e.location+he);p.bindBuffer(p.ARRAY_BUFFER,ze);for(let he=0;he<_e.locationSize;he++)T(_e.location+he,wt/_e.locationSize,$e,me,wt*pt,wt/_e.locationSize*he*pt,lt)}}else if(we!==void 0){const me=we[Me];if(me!==void 0)switch(me.length){case 2:p.vertexAttrib2fv(_e.location,me);break;case 3:p.vertexAttrib3fv(_e.location,me);break;case 4:p.vertexAttrib4fv(_e.location,me);break;default:p.vertexAttrib1fv(_e.location,me)}}}}w()}(D,z,G,Q),Y!==null&&p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,t.get(Y).buffer))},reset:P,resetDefaultState:U,dispose:function(){P();for(const D in o){const z=o[D];for(const G in z){const Q=z[G];for(const Y in Q)g(Q[Y].object),delete Q[Y];delete z[G]}delete o[D]}},releaseStatesOfGeometry:function(D){if(o[D.id]===void 0)return;const z=o[D.id];for(const G in z){const Q=z[G];for(const Y in Q)g(Q[Y].object),delete Q[Y];delete z[G]}delete o[D.id]},releaseStatesOfProgram:function(D){for(const z in o){const G=o[z];if(G[D.id]===void 0)continue;const Q=G[D.id];for(const Y in Q)g(Q[Y].object),delete Q[Y];delete G[D.id]}},initAttributes:x,enableAttribute:b,disableUnusedAttributes:w}}function rH(p,t,i){let o;function l(h,d,f){f!==0&&(p.drawArraysInstanced(o,h,d,f),i.update(d,o,f))}this.setMode=function(h){o=h},this.render=function(h,d){p.drawArrays(o,h,d),i.update(d,o,1)},this.renderInstances=l,this.renderMultiDraw=function(h,d,f){if(f===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(o,h,0,d,0,f);let g=0;for(let y=0;y<f;y++)g+=d[y];i.update(g,o,1)},this.renderMultiDrawInstances=function(h,d,f,g){if(f===0)return;const y=t.get("WEBGL_multi_draw");if(y===null)for(let x=0;x<h.length;x++)l(h[x],d[x],g[x]);else{y.multiDrawArraysInstancedWEBGL(o,h,0,d,0,g,0,f);let x=0;for(let b=0;b<f;b++)x+=d[b];for(let b=0;b<g.length;b++)i.update(x,o,g[b])}}}function sH(p,t,i,o){let l;function h(_){if(_==="highp"){if(p.getShaderPrecisionFormat(p.VERTEX_SHADER,p.HIGH_FLOAT).precision>0&&p.getShaderPrecisionFormat(p.FRAGMENT_SHADER,p.HIGH_FLOAT).precision>0)return"highp";_="mediump"}return _==="mediump"&&p.getShaderPrecisionFormat(p.VERTEX_SHADER,p.MEDIUM_FLOAT).precision>0&&p.getShaderPrecisionFormat(p.FRAGMENT_SHADER,p.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let d=i.precision!==void 0?i.precision:"highp";const f=h(d);f!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",f,"instead."),d=f);const g=i.logarithmicDepthBuffer===!0,y=i.reverseDepthBuffer===!0&&t.has("EXT_clip_control");if(y===!0){const _=t.get("EXT_clip_control");_.clipControlEXT(_.LOWER_LEFT_EXT,_.ZERO_TO_ONE_EXT)}const x=p.getParameter(p.MAX_TEXTURE_IMAGE_UNITS),b=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(l!==void 0)return l;if(t.has("EXT_texture_filter_anisotropic")===!0){const _=t.get("EXT_texture_filter_anisotropic");l=p.getParameter(_.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else l=0;return l},getMaxPrecision:h,textureFormatReadable:function(_){return _===fr||o.convert(_)===p.getParameter(p.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(_){const w=_===ss&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(_!==Rr&&o.convert(_)!==p.getParameter(p.IMPLEMENTATION_COLOR_READ_TYPE)&&_!==Wr&&!w)},precision:d,logarithmicDepthBuffer:g,reverseDepthBuffer:y,maxTextures:x,maxVertexTextures:b,maxTextureSize:p.getParameter(p.MAX_TEXTURE_SIZE),maxCubemapSize:p.getParameter(p.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:p.getParameter(p.MAX_VERTEX_ATTRIBS),maxVertexUniforms:p.getParameter(p.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:p.getParameter(p.MAX_VARYING_VECTORS),maxFragmentUniforms:p.getParameter(p.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:b>0,maxSamples:p.getParameter(p.MAX_SAMPLES)}}function aH(p){const t=this;let i=null,o=0,l=!1,h=!1;const d=new dd,f=new zn,g={value:null,needsUpdate:!1};function y(x,b,_,w){const T=x!==null?x.length:0;let P=null;if(T!==0){if(P=g.value,w!==!0||P===null){const U=_+4*T,D=b.matrixWorldInverse;f.getNormalMatrix(D),(P===null||P.length<U)&&(P=new Float32Array(U));for(let z=0,G=_;z!==T;++z,G+=4)d.copy(x[z]).applyMatrix4(D,f),d.normal.toArray(P,G),P[G+3]=d.constant}g.value=P,g.needsUpdate=!0}return t.numPlanes=T,t.numIntersection=0,P}this.uniform=g,this.numPlanes=0,this.numIntersection=0,this.init=function(x,b){const _=x.length!==0||b||o!==0||l;return l=b,o=x.length,_},this.beginShadows=function(){h=!0,y(null)},this.endShadows=function(){h=!1},this.setGlobalState=function(x,b){i=y(x,b,0)},this.setState=function(x,b,_){const w=x.clippingPlanes,T=x.clipIntersection,P=x.clipShadows,U=p.get(x);if(!l||w===null||w.length===0||h&&!P)h?y(null):function(){g.value!==i&&(g.value=i,g.needsUpdate=o>0),t.numPlanes=o,t.numIntersection=0}();else{const D=h?0:o,z=4*D;let G=U.clippingState||null;g.value=G,G=y(w,b,z,_);for(let Q=0;Q!==z;++Q)G[Q]=i[Q];U.clippingState=G,this.numIntersection=T?this.numPlanes:0,this.numPlanes+=D}}}function oH(p){let t=new WeakMap;function i(l,h){return h===iy?l.mapping=ad:h===304&&(l.mapping=Op),l}function o(l){const h=l.target;h.removeEventListener("dispose",o);const d=t.get(h);d!==void 0&&(t.delete(h),d.dispose())}return{get:function(l){if(l&&l.isTexture){const h=l.mapping;if(h===iy||h===304){if(t.has(l))return i(t.get(l).texture,l.mapping);{const d=l.image;if(d&&d.height>0){const f=new Iw(d.height);return f.fromEquirectangularTexture(p,l),t.set(l,f),l.addEventListener("dispose",o),i(f.texture,l.mapping)}return null}}}return l},dispose:function(){t=new WeakMap}}}class cA extends iL{constructor(t=-1,i=1,o=1,l=-1,h=.1,d=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=o,this.bottom=l,this.near=h,this.far=d,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,o,l,h,d){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=o,this.view.offsetY=l,this.view.width=h,this.view.height=d,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),o=(this.right+this.left)/2,l=(this.top+this.bottom)/2;let h=o-t,d=o+t,f=l+i,g=l-i;if(this.view!==null&&this.view.enabled){const y=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h+=y*this.view.offsetX,d=h+y*this.view.width,f-=x*this.view.offsetY,g=f-x*this.view.height}this.projectionMatrix.makeOrthographic(h,d,f,g,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const lL=[.125,.215,.35,.446,.526,.582],Um=20,Rw=new cA,cL=new fn;let Lw=null,Dw=0,Pw=0,Uw=!1;const fd=(1+Math.sqrt(5))/2,hA=1/fd,hL=[new ve(-fd,hA,0),new ve(fd,hA,0),new ve(-hA,0,fd),new ve(hA,0,fd),new ve(0,fd,-hA),new ve(0,fd,hA),new ve(-1,1,-1),new ve(1,1,-1),new ve(-1,1,1),new ve(1,1,1)];class uL{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,o=.1,l=100){Lw=this._renderer.getRenderTarget(),Dw=this._renderer.getActiveCubeFace(),Pw=this._renderer.getActiveMipmapLevel(),Uw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const h=this._allocateTargets();return h.depthBuffer=!0,this._sceneToCubeUV(t,o,l,h),i>0&&this._blur(h,0,0,i),this._applyPMREM(h),this._cleanup(h),h}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=AL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=pL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Lw,Dw,Pw),this._renderer.xr.enabled=Uw,t.scissorTest=!1,Gy(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===ad||t.mapping===Op?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Lw=this._renderer.getRenderTarget(),Dw=this._renderer.getActiveCubeFace(),Pw=this._renderer.getActiveMipmapLevel(),Uw=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const o=i||this._allocateTargets();return this._textureToCubeUV(t,o),this._applyPMREM(o),this._cleanup(o),o}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,o={magFilter:Fi,minFilter:Fi,generateMipmaps:!1,type:ss,format:fr,colorSpace:Yi,depthBuffer:!1},l=dL(t,i,o);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=dL(t,i,o);const{_lodMax:h}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(d){const f=[],g=[],y=[];let x=d;const b=d-4+1+lL.length;for(let _=0;_<b;_++){const w=Math.pow(2,x);g.push(w);let T=1/w;_>d-4?T=lL[_-d+4-1]:_===0&&(T=0),y.push(T);const P=1/(w-2),U=-P,D=1+P,z=[U,U,D,U,D,D,U,U,D,D,U,D],G=6,Q=6,Y=3,q=2,K=1,ne=new Float32Array(Y*Q*G),le=new Float32Array(q*Q*G),fe=new Float32Array(K*Q*G);for(let de=0;de<G;de++){const Fe=de%3*2/3-1,we=de>2?0:-1,Me=[Fe,we,0,Fe+2/3,we,0,Fe+2/3,we+1,0,Fe,we,0,Fe+2/3,we+1,0,Fe,we+1,0];ne.set(Me,Y*Q*de),le.set(z,q*Q*de);const _e=[de,de,de,de,de,de];fe.set(_e,K*Q*de)}const be=new Ra;be.setAttribute("position",new mr(ne,Y)),be.setAttribute("uv",new mr(le,q)),be.setAttribute("faceIndex",new mr(fe,K)),f.push(be),x>4&&x--}return{lodPlanes:f,sizeLods:g,sigmas:y}}(h)),this._blurMaterial=function(d,f,g){const y=new Float32Array(Um),x=new ve(0,1,0);return new Ta({name:"SphericalGaussianBlur",defines:{n:Um,CUBEUV_TEXEL_WIDTH:1/f,CUBEUV_TEXEL_HEIGHT:1/g,CUBEUV_MAX_MIP:`${d}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:y},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:x}},vertexShader:Nw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(h,t,i)}return l}_compileMaterial(t){const i=new Vi(this._lodPlanes[0],t);this._renderer.compile(i,Rw)}_sceneToCubeUV(t,i,o,l){const h=new vs(90,1,i,o),d=[1,-1,1,1,1,1],f=[1,1,1,-1,-1,-1],g=this._renderer,y=g.autoClear,x=g.toneMapping;g.getClearColor(cL),g.toneMapping=0,g.autoClear=!1;const b=new yo({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),_=new Vi(new jc,b);let w=!1;const T=t.background;T?T.isColor&&(b.color.copy(T),t.background=null,w=!0):(b.color.copy(cL),w=!0);for(let P=0;P<6;P++){const U=P%3;U===0?(h.up.set(0,d[P],0),h.lookAt(f[P],0,0)):U===1?(h.up.set(0,0,d[P]),h.lookAt(0,f[P],0)):(h.up.set(0,d[P],0),h.lookAt(0,0,f[P]));const D=this._cubeSize;Gy(l,U*D,P>2?D:0,D,D),g.setRenderTarget(l),w&&g.render(_,h),g.render(t,h)}_.geometry.dispose(),_.material.dispose(),g.toneMapping=x,g.autoClear=y,t.background=T}_textureToCubeUV(t,i){const o=this._renderer,l=t.mapping===ad||t.mapping===Op;l?(this._cubemapMaterial===null&&(this._cubemapMaterial=AL()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=pL());const h=l?this._cubemapMaterial:this._equirectMaterial,d=new Vi(this._lodPlanes[0],h);h.uniforms.envMap.value=t;const f=this._cubeSize;Gy(i,0,0,3*f,2*f),o.setRenderTarget(i),o.render(d,Rw)}_applyPMREM(t){const i=this._renderer,o=i.autoClear;i.autoClear=!1;const l=this._lodPlanes.length;for(let h=1;h<l;h++){const d=Math.sqrt(this._sigmas[h]*this._sigmas[h]-this._sigmas[h-1]*this._sigmas[h-1]),f=hL[(l-h-1)%hL.length];this._blur(t,h-1,h,d,f)}i.autoClear=o}_blur(t,i,o,l,h){const d=this._pingPongRenderTarget;this._halfBlur(t,d,i,o,l,"latitudinal",h),this._halfBlur(d,t,o,o,l,"longitudinal",h)}_halfBlur(t,i,o,l,h,d,f){const g=this._renderer,y=this._blurMaterial;d!=="latitudinal"&&d!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const x=new Vi(this._lodPlanes[l],y),b=y.uniforms,_=this._sizeLods[o]-1,w=isFinite(h)?Math.PI/(2*_):2*Math.PI/39,T=h/w,P=isFinite(h)?1+Math.floor(3*T):Um;P>Um&&console.warn(`sigmaRadians, ${h}, is too large and will clip, as it requested ${P} samples when the maximum is set to 20`);const U=[];let D=0;for(let Q=0;Q<Um;++Q){const Y=Q/T,q=Math.exp(-Y*Y/2);U.push(q),Q===0?D+=q:Q<P&&(D+=2*q)}for(let Q=0;Q<U.length;Q++)U[Q]=U[Q]/D;b.envMap.value=t.texture,b.samples.value=P,b.weights.value=U,b.latitudinal.value=d==="latitudinal",f&&(b.poleAxis.value=f);const{_lodMax:z}=this;b.dTheta.value=w,b.mipInt.value=z-o;const G=this._sizeLods[l];Gy(i,3*G*(l>z-4?l-z+4:0),4*(this._cubeSize-G),3*G,2*G),g.setRenderTarget(i),g.render(x,Rw)}}function dL(p,t,i){const o=new go(p,t,i);return o.texture.mapping=ry,o.texture.name="PMREM.cubeUv",o.scissorTest=!0,o}function Gy(p,t,i,o,l){p.viewport.set(t,i,o,l),p.scissor.set(t,i,o,l)}function pL(){return new Ta({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Nw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function AL(){return new Ta({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Nw(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Nw(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function lH(p){let t=new WeakMap,i=null;function o(l){const h=l.target;h.removeEventListener("dispose",o);const d=t.get(h);d!==void 0&&(t.delete(h),d.dispose())}return{get:function(l){if(l&&l.isTexture){const h=l.mapping,d=h===iy||h===304,f=h===ad||h===Op;if(d||f){let g=t.get(l);const y=g!==void 0?g.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==y)return i===null&&(i=new uL(p)),g=d?i.fromEquirectangular(l,g):i.fromCubemap(l,g),g.texture.pmremVersion=l.pmremVersion,t.set(l,g),g.texture;if(g!==void 0)return g.texture;{const x=l.image;return d&&x&&x.height>0||f&&x&&function(b){let _=0;const w=6;for(let T=0;T<w;T++)b[T]!==void 0&&_++;return _===w}(x)?(i===null&&(i=new uL(p)),g=d?i.fromEquirectangular(l):i.fromCubemap(l),g.texture.pmremVersion=l.pmremVersion,t.set(l,g),l.addEventListener("dispose",o),g.texture):null}}}return l},dispose:function(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}}}function cH(p){const t={};function i(o){if(t[o]!==void 0)return t[o];let l;switch(o){case"WEBGL_depth_texture":l=p.getExtension("WEBGL_depth_texture")||p.getExtension("MOZ_WEBGL_depth_texture")||p.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":l=p.getExtension("EXT_texture_filter_anisotropic")||p.getExtension("MOZ_EXT_texture_filter_anisotropic")||p.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":l=p.getExtension("WEBGL_compressed_texture_s3tc")||p.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||p.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":l=p.getExtension("WEBGL_compressed_texture_pvrtc")||p.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:l=p.getExtension(o)}return t[o]=l,l}return{has:function(o){return i(o)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(o){const l=i(o);return l===null&&xy("THREE.WebGLRenderer: "+o+" extension not supported."),l}}}function hH(p,t,i,o){const l={},h=new WeakMap;function d(g){const y=g.target;y.index!==null&&t.remove(y.index);for(const b in y.attributes)t.remove(y.attributes[b]);for(const b in y.morphAttributes){const _=y.morphAttributes[b];for(let w=0,T=_.length;w<T;w++)t.remove(_[w])}y.removeEventListener("dispose",d),delete l[y.id];const x=h.get(y);x&&(t.remove(x),h.delete(y)),o.releaseStatesOfGeometry(y),y.isInstancedBufferGeometry===!0&&delete y._maxInstanceCount,i.memory.geometries--}function f(g){const y=[],x=g.index,b=g.attributes.position;let _=0;if(x!==null){const P=x.array;_=x.version;for(let U=0,D=P.length;U<D;U+=3){const z=P[U+0],G=P[U+1],Q=P[U+2];y.push(z,G,G,Q,Q,z)}}else{if(b===void 0)return;{const P=b.array;_=b.version;for(let U=0,D=P.length/3-1;U<D;U+=3){const z=U+0,G=U+1,Q=U+2;y.push(z,G,G,Q,Q,z)}}}const w=new(UR(y)?$R:JR)(y,1);w.version=_;const T=h.get(g);T&&t.remove(T),h.set(g,w)}return{get:function(g,y){return l[y.id]===!0||(y.addEventListener("dispose",d),l[y.id]=!0,i.memory.geometries++),y},update:function(g){const y=g.attributes;for(const b in y)t.update(y[b],p.ARRAY_BUFFER);const x=g.morphAttributes;for(const b in x){const _=x[b];for(let w=0,T=_.length;w<T;w++)t.update(_[w],p.ARRAY_BUFFER)}},getWireframeAttribute:function(g){const y=h.get(g);if(y){const x=g.index;x!==null&&y.version<x.version&&f(g)}else f(g);return h.get(g)}}}function uH(p,t,i){let o,l,h;function d(f,g,y){y!==0&&(p.drawElementsInstanced(o,g,l,f*h,y),i.update(g,o,y))}this.setMode=function(f){o=f},this.setIndex=function(f){l=f.type,h=f.bytesPerElement},this.render=function(f,g){p.drawElements(o,g,l,f*h),i.update(g,o,1)},this.renderInstances=d,this.renderMultiDraw=function(f,g,y){if(y===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(o,g,0,l,f,0,y);let x=0;for(let b=0;b<y;b++)x+=g[b];i.update(x,o,1)},this.renderMultiDrawInstances=function(f,g,y,x){if(y===0)return;const b=t.get("WEBGL_multi_draw");if(b===null)for(let _=0;_<f.length;_++)d(f[_]/h,g[_],x[_]);else{b.multiDrawElementsInstancedWEBGL(o,g,0,l,f,0,x,0,y);let _=0;for(let w=0;w<y;w++)_+=g[w];for(let w=0;w<x.length;w++)i.update(_,o,x[w])}}}function dH(p){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(i,o,l){switch(t.calls++,o){case p.TRIANGLES:t.triangles+=l*(i/3);break;case p.LINES:t.lines+=l*(i/2);break;case p.LINE_STRIP:t.lines+=l*(i-1);break;case p.LINE_LOOP:t.lines+=l*i;break;case p.POINTS:t.points+=l*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function pH(p,t,i){const o=new WeakMap,l=new Oi;return{update:function(h,d,f){const g=h.morphTargetInfluences,y=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,x=y!==void 0?y.length:0;let b=o.get(d);if(b===void 0||b.count!==x){let ne=function(){q.dispose(),o.delete(d),d.removeEventListener("dispose",ne)};b!==void 0&&b.texture.dispose();const _=d.morphAttributes.position!==void 0,w=d.morphAttributes.normal!==void 0,T=d.morphAttributes.color!==void 0,P=d.morphAttributes.position||[],U=d.morphAttributes.normal||[],D=d.morphAttributes.color||[];let z=0;_===!0&&(z=1),w===!0&&(z=2),T===!0&&(z=3);let G=d.attributes.position.count*z,Q=1;G>t.maxTextureSize&&(Q=Math.ceil(G/t.maxTextureSize),G=t.maxTextureSize);const Y=new Float32Array(G*Q*4*x),q=new kR(Y,G,Q,x);q.type=Wr,q.needsUpdate=!0;const K=4*z;for(let le=0;le<x;le++){const fe=P[le],be=U[le],de=D[le],Fe=G*Q*4*le;for(let we=0;we<fe.count;we++){const Me=we*K;_===!0&&(l.fromBufferAttribute(fe,we),Y[Fe+Me+0]=l.x,Y[Fe+Me+1]=l.y,Y[Fe+Me+2]=l.z,Y[Fe+Me+3]=0),w===!0&&(l.fromBufferAttribute(be,we),Y[Fe+Me+4]=l.x,Y[Fe+Me+5]=l.y,Y[Fe+Me+6]=l.z,Y[Fe+Me+7]=0),T===!0&&(l.fromBufferAttribute(de,we),Y[Fe+Me+8]=l.x,Y[Fe+Me+9]=l.y,Y[Fe+Me+10]=l.z,Y[Fe+Me+11]=de.itemSize===4?l.w:1)}}b={count:x,texture:q,size:new Hn(G,Q)},o.set(d,b),d.addEventListener("dispose",ne)}if(h.isInstancedMesh===!0&&h.morphTexture!==null)f.getUniforms().setValue(p,"morphTexture",h.morphTexture,i);else{let _=0;for(let T=0;T<g.length;T++)_+=g[T];const w=d.morphTargetsRelative?1:1-_;f.getUniforms().setValue(p,"morphTargetBaseInfluence",w),f.getUniforms().setValue(p,"morphTargetInfluences",g)}f.getUniforms().setValue(p,"morphTargetsTexture",b.texture,i),f.getUniforms().setValue(p,"morphTargetsTextureSize",b.size)}}}function AH(p,t,i,o){let l=new WeakMap;function h(d){const f=d.target;f.removeEventListener("dispose",h),i.remove(f.instanceMatrix),f.instanceColor!==null&&i.remove(f.instanceColor)}return{update:function(d){const f=o.render.frame,g=d.geometry,y=t.get(d,g);if(l.get(y)!==f&&(t.update(y),l.set(y,f)),d.isInstancedMesh&&(d.hasEventListener("dispose",h)===!1&&d.addEventListener("dispose",h),l.get(d)!==f&&(i.update(d.instanceMatrix,p.ARRAY_BUFFER),d.instanceColor!==null&&i.update(d.instanceColor,p.ARRAY_BUFFER),l.set(d,f))),d.isSkinnedMesh){const x=d.skeleton;l.get(x)!==f&&(x.update(),l.set(x,f))}return y},dispose:function(){l=new WeakMap}}}class fL extends qi{constructor(t,i,o,l,h,d,f,g,y,x=1026){if(x!==ym&&x!==Hp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");o===void 0&&x===ym&&(o=Th),o===void 0&&x===Hp&&(o=Gp),super(null,l,h,d,f,g,x,o,y),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=f!==void 0?f:fs,this.minFilter=g!==void 0?g:fs,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const mL=new qi,gL=new fL(1,1),vL=new kR,yL=new QR,EL=new aL,xL=[],_L=[],bL=new Float32Array(16),CL=new Float32Array(9),wL=new Float32Array(4);function uA(p,t,i){const o=p[0];if(o<=0||o>0)return p;const l=t*i;let h=xL[l];if(h===void 0&&(h=new Float32Array(l),xL[l]=h),t!==0){o.toArray(h,0);for(let d=1,f=0;d!==t;++d)f+=i,p[d].toArray(h,f)}return h}function as(p,t){if(p.length!==t.length)return!1;for(let i=0,o=p.length;i<o;i++)if(p[i]!==t[i])return!1;return!0}function os(p,t){for(let i=0,o=t.length;i<o;i++)p[i]=t[i]}function Hy(p,t){let i=_L[t];i===void 0&&(i=new Int32Array(t),_L[t]=i);for(let o=0;o!==t;++o)i[o]=p.allocateTextureUnit();return i}function fH(p,t){const i=this.cache;i[0]!==t&&(p.uniform1f(this.addr,t),i[0]=t)}function mH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y||(p.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(as(i,t))return;p.uniform2fv(this.addr,t),os(i,t)}}function gH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(p.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(p.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(as(i,t))return;p.uniform3fv(this.addr,t),os(i,t)}}function vH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(p.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(as(i,t))return;p.uniform4fv(this.addr,t),os(i,t)}}function yH(p,t){const i=this.cache,o=t.elements;if(o===void 0){if(as(i,t))return;p.uniformMatrix2fv(this.addr,!1,t),os(i,t)}else{if(as(i,o))return;wL.set(o),p.uniformMatrix2fv(this.addr,!1,wL),os(i,o)}}function EH(p,t){const i=this.cache,o=t.elements;if(o===void 0){if(as(i,t))return;p.uniformMatrix3fv(this.addr,!1,t),os(i,t)}else{if(as(i,o))return;CL.set(o),p.uniformMatrix3fv(this.addr,!1,CL),os(i,o)}}function xH(p,t){const i=this.cache,o=t.elements;if(o===void 0){if(as(i,t))return;p.uniformMatrix4fv(this.addr,!1,t),os(i,t)}else{if(as(i,o))return;bL.set(o),p.uniformMatrix4fv(this.addr,!1,bL),os(i,o)}}function _H(p,t){const i=this.cache;i[0]!==t&&(p.uniform1i(this.addr,t),i[0]=t)}function bH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y||(p.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(as(i,t))return;p.uniform2iv(this.addr,t),os(i,t)}}function CH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(p.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(as(i,t))return;p.uniform3iv(this.addr,t),os(i,t)}}function wH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(p.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(as(i,t))return;p.uniform4iv(this.addr,t),os(i,t)}}function MH(p,t){const i=this.cache;i[0]!==t&&(p.uniform1ui(this.addr,t),i[0]=t)}function SH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y||(p.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(as(i,t))return;p.uniform2uiv(this.addr,t),os(i,t)}}function IH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(p.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(as(i,t))return;p.uniform3uiv(this.addr,t),os(i,t)}}function TH(p,t){const i=this.cache;if(t.x!==void 0)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(p.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(as(i,t))return;p.uniform4uiv(this.addr,t),os(i,t)}}function BH(p,t,i){const o=this.cache,l=i.allocateTextureUnit();let h;o[0]!==l&&(p.uniform1i(this.addr,l),o[0]=l),this.type===p.SAMPLER_2D_SHADOW?(gL.compareFunction=515,h=gL):h=mL,i.setTexture2D(t||h,l)}function RH(p,t,i){const o=this.cache,l=i.allocateTextureUnit();o[0]!==l&&(p.uniform1i(this.addr,l),o[0]=l),i.setTexture3D(t||yL,l)}function LH(p,t,i){const o=this.cache,l=i.allocateTextureUnit();o[0]!==l&&(p.uniform1i(this.addr,l),o[0]=l),i.setTextureCube(t||EL,l)}function DH(p,t,i){const o=this.cache,l=i.allocateTextureUnit();o[0]!==l&&(p.uniform1i(this.addr,l),o[0]=l),i.setTexture2DArray(t||vL,l)}function PH(p,t){p.uniform1fv(this.addr,t)}function UH(p,t){const i=uA(t,this.size,2);p.uniform2fv(this.addr,i)}function NH(p,t){const i=uA(t,this.size,3);p.uniform3fv(this.addr,i)}function FH(p,t){const i=uA(t,this.size,4);p.uniform4fv(this.addr,i)}function OH(p,t){const i=uA(t,this.size,4);p.uniformMatrix2fv(this.addr,!1,i)}function kH(p,t){const i=uA(t,this.size,9);p.uniformMatrix3fv(this.addr,!1,i)}function QH(p,t){const i=uA(t,this.size,16);p.uniformMatrix4fv(this.addr,!1,i)}function GH(p,t){p.uniform1iv(this.addr,t)}function HH(p,t){p.uniform2iv(this.addr,t)}function zH(p,t){p.uniform3iv(this.addr,t)}function VH(p,t){p.uniform4iv(this.addr,t)}function WH(p,t){p.uniform1uiv(this.addr,t)}function jH(p,t){p.uniform2uiv(this.addr,t)}function qH(p,t){p.uniform3uiv(this.addr,t)}function XH(p,t){p.uniform4uiv(this.addr,t)}function YH(p,t,i){const o=this.cache,l=t.length,h=Hy(i,l);as(o,h)||(p.uniform1iv(this.addr,h),os(o,h));for(let d=0;d!==l;++d)i.setTexture2D(t[d]||mL,h[d])}function KH(p,t,i){const o=this.cache,l=t.length,h=Hy(i,l);as(o,h)||(p.uniform1iv(this.addr,h),os(o,h));for(let d=0;d!==l;++d)i.setTexture3D(t[d]||yL,h[d])}function JH(p,t,i){const o=this.cache,l=t.length,h=Hy(i,l);as(o,h)||(p.uniform1iv(this.addr,h),os(o,h));for(let d=0;d!==l;++d)i.setTextureCube(t[d]||EL,h[d])}function $H(p,t,i){const o=this.cache,l=t.length,h=Hy(i,l);as(o,h)||(p.uniform1iv(this.addr,h),os(o,h));for(let d=0;d!==l;++d)i.setTexture2DArray(t[d]||vL,h[d])}class ZH{constructor(t,i,o){this.id=t,this.addr=o,this.cache=[],this.type=i.type,this.setValue=function(l){switch(l){case 5126:return fH;case 35664:return mH;case 35665:return gH;case 35666:return vH;case 35674:return yH;case 35675:return EH;case 35676:return xH;case 5124:case 35670:return _H;case 35667:case 35671:return bH;case 35668:case 35672:return CH;case 35669:case 35673:return wH;case 5125:return MH;case 36294:return SH;case 36295:return IH;case 36296:return TH;case 35678:case 36198:case 36298:case 36306:case 35682:return BH;case 35679:case 36299:case 36307:return RH;case 35680:case 36300:case 36308:case 36293:return LH;case 36289:case 36303:case 36311:case 36292:return DH}}(i.type)}}class e6{constructor(t,i,o){this.id=t,this.addr=o,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=function(l){switch(l){case 5126:return PH;case 35664:return UH;case 35665:return NH;case 35666:return FH;case 35674:return OH;case 35675:return kH;case 35676:return QH;case 5124:case 35670:return GH;case 35667:case 35671:return HH;case 35668:case 35672:return zH;case 35669:case 35673:return VH;case 5125:return WH;case 36294:return jH;case 36295:return qH;case 36296:return XH;case 35678:case 36198:case 36298:case 36306:case 35682:return YH;case 35679:case 36299:case 36307:return KH;case 35680:case 36300:case 36308:case 36293:return JH;case 36289:case 36303:case 36311:case 36292:return $H}}(i.type)}}class t6{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,o){const l=this.seq;for(let h=0,d=l.length;h!==d;++h){const f=l[h];f.setValue(t,i[f.id],o)}}}const Fw=/(\w+)(\])?(\[|\.)?/g;function ML(p,t){p.seq.push(t),p.map[t.id]=t}function n6(p,t,i){const o=p.name,l=o.length;for(Fw.lastIndex=0;;){const h=Fw.exec(o),d=Fw.lastIndex;let f=h[1];const g=h[2]==="]",y=h[3];if(g&&(f|=0),y===void 0||y==="["&&d+2===l){ML(i,y===void 0?new ZH(f,p,t):new e6(f,p,t));break}{let x=i.map[f];x===void 0&&(x=new t6(f),ML(i,x)),i=x}}}class zy{constructor(t,i){this.seq=[],this.map={};const o=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let l=0;l<o;++l){const h=t.getActiveUniform(i,l);n6(h,t.getUniformLocation(i,h.name),this)}}setValue(t,i,o,l){const h=this.map[i];h!==void 0&&h.setValue(t,o,l)}setOptional(t,i,o){const l=i[o];l!==void 0&&this.setValue(t,o,l)}static upload(t,i,o,l){for(let h=0,d=i.length;h!==d;++h){const f=i[h],g=o[f.id];g.needsUpdate!==!1&&f.setValue(t,g.value,l)}}static seqWithValue(t,i){const o=[];for(let l=0,h=t.length;l!==h;++l){const d=t[l];d.id in i&&o.push(d)}return o}}function SL(p,t,i){const o=p.createShader(t);return p.shaderSource(o,i),p.compileShader(o),o}let i6=0;function IL(p,t,i){const o=p.getShaderParameter(t,p.COMPILE_STATUS),l=p.getShaderInfoLog(t).trim();if(o&&l==="")return"";const h=/ERROR: 0:(\d+)/.exec(l);if(h){const d=parseInt(h[1]);return i.toUpperCase()+`

`+l+`

`+function(f,g){const y=f.split(`
`),x=[],b=Math.max(g-6,0),_=Math.min(g+6,y.length);for(let w=b;w<_;w++){const T=w+1;x.push(`${T===g?">":" "} ${T}: ${y[w]}`)}return x.join(`
`)}(p.getShaderSource(t),d)}return l}function r6(p,t){const i=function(o){const l=Si.getPrimaries(Si.workingColorSpace),h=Si.getPrimaries(o);let d;switch(l===h?d="":l===vy&&h===gy?d="LinearDisplayP3ToLinearSRGB":l===gy&&h===vy&&(d="LinearSRGBToLinearDisplayP3"),o){case Yi:case wm:return[d,"LinearTransferOETF"];case sr:case fy:return[d,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",o),[d,"LinearTransferOETF"]}}(t);return`vec4 ${p}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function s6(p,t){let i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="Cineon";break;case 4:i="ACESFilmic";break;case 6:i="AgX";break;case 7:i="Neutral";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+p+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const Vy=new ve;function a6(){return Si.getLuminanceCoefficients(Vy),["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${Vy.x.toFixed(4)}, ${Vy.y.toFixed(4)}, ${Vy.z.toFixed(4)} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Nm(p){return p!==""}function TL(p,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return p.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function BL(p,t){return p.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const o6=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ow(p){return p.replace(o6,c6)}const l6=new Map;function c6(p,t){let i=Zn[t];if(i===void 0){const o=l6.get(t);if(o===void 0)throw new Error("Can not resolve #include <"+t+">");i=Zn[o],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,o)}return Ow(i)}const h6=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function RL(p){return p.replace(h6,u6)}function u6(p,t,i,o){let l="";for(let h=parseInt(t);h<parseInt(i);h++)l+=o.replace(/\[\s*i\s*\]/g,"[ "+h+" ]").replace(/UNROLLED_LOOP_INDEX/g,h);return l}function LL(p){let t=`precision ${p.precision} float;
	precision ${p.precision} int;
	precision ${p.precision} sampler2D;
	precision ${p.precision} samplerCube;
	precision ${p.precision} sampler3D;
	precision ${p.precision} sampler2DArray;
	precision ${p.precision} sampler2DShadow;
	precision ${p.precision} samplerCubeShadow;
	precision ${p.precision} sampler2DArrayShadow;
	precision ${p.precision} isampler2D;
	precision ${p.precision} isampler3D;
	precision ${p.precision} isamplerCube;
	precision ${p.precision} isampler2DArray;
	precision ${p.precision} usampler2D;
	precision ${p.precision} usampler3D;
	precision ${p.precision} usamplerCube;
	precision ${p.precision} usampler2DArray;
	`;return p.precision==="highp"?t+=`
#define HIGH_PRECISION`:p.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:p.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function d6(p,t,i,o){const l=p.getContext(),h=i.defines;let d=i.vertexShader,f=i.fragmentShader;const g=function(be){let de="SHADOWMAP_TYPE_BASIC";return be.shadowMapType===1?de="SHADOWMAP_TYPE_PCF":be.shadowMapType===2?de="SHADOWMAP_TYPE_PCF_SOFT":be.shadowMapType===3&&(de="SHADOWMAP_TYPE_VSM"),de}(i),y=function(be){let de="ENVMAP_TYPE_CUBE";if(be.envMap)switch(be.envMapMode){case ad:case Op:de="ENVMAP_TYPE_CUBE";break;case ry:de="ENVMAP_TYPE_CUBE_UV"}return de}(i),x=function(be){let de="ENVMAP_MODE_REFLECTION";return be.envMap&&be.envMapMode===Op&&(de="ENVMAP_MODE_REFRACTION"),de}(i),b=function(be){let de="ENVMAP_BLENDING_NONE";if(be.envMap)switch(be.combine){case 0:de="ENVMAP_BLENDING_MULTIPLY";break;case 1:de="ENVMAP_BLENDING_MIX";break;case 2:de="ENVMAP_BLENDING_ADD"}return de}(i),_=function(be){const de=be.envMapCubeUVHeight;if(de===null)return null;const Fe=Math.log2(de)-2,we=1/de;return{texelWidth:1/(3*Math.max(Math.pow(2,Fe),112)),texelHeight:we,maxMip:Fe}}(i),w=function(be){return[be.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",be.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Nm).join(`
`)}(i),T=function(be){const de=[];for(const Fe in be){const we=be[Fe];we!==!1&&de.push("#define "+Fe+" "+we)}return de.join(`
`)}(h),P=l.createProgram();let U,D,z=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(U=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,T].filter(Nm).join(`
`),U.length>0&&(U+=`
`),D=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,T].filter(Nm).join(`
`),D.length>0&&(D+=`
`)):(U=[LL(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,T,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+x:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+g:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Nm).join(`
`),D=[LL(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,T,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+y:"",i.envMap?"#define "+x:"",i.envMap?"#define "+b:"",_?"#define CUBEUV_TEXEL_WIDTH "+_.texelWidth:"",_?"#define CUBEUV_TEXEL_HEIGHT "+_.texelHeight:"",_?"#define CUBEUV_MAX_MIP "+_.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+g:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==0?"#define TONE_MAPPING":"",i.toneMapping!==0?Zn.tonemapping_pars_fragment:"",i.toneMapping!==0?s6("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Zn.colorspace_pars_fragment,r6("linearToOutputTexel",i.outputColorSpace),a6(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Nm).join(`
`)),d=Ow(d),d=TL(d,i),d=BL(d,i),f=Ow(f),f=TL(f,i),f=BL(f,i),d=RL(d),f=RL(f),i.isRawShaderMaterial!==!0&&(z=`#version 300 es
`,U=[w,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+U,D=["#define varying in",i.glslVersion===DR?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===DR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+D);const G=z+U+d,Q=z+D+f,Y=SL(l,l.VERTEX_SHADER,G),q=SL(l,l.FRAGMENT_SHADER,Q);function K(be){if(p.debug.checkShaderErrors){const de=l.getProgramInfoLog(P).trim(),Fe=l.getShaderInfoLog(Y).trim(),we=l.getShaderInfoLog(q).trim();let Me=!0,_e=!0;if(l.getProgramParameter(P,l.LINK_STATUS)===!1)if(Me=!1,typeof p.debug.onShaderError=="function")p.debug.onShaderError(l,P,Y,q);else{const tt=IL(l,Y,"vertex"),me=IL(l,q,"fragment");console.error("THREE.WebGLProgram: Shader Error "+l.getError()+" - VALIDATE_STATUS "+l.getProgramParameter(P,l.VALIDATE_STATUS)+`

Material Name: `+be.name+`
Material Type: `+be.type+`

Program Info Log: `+de+`
`+tt+`
`+me)}else de!==""?console.warn("THREE.WebGLProgram: Program Info Log:",de):Fe!==""&&we!==""||(_e=!1);_e&&(be.diagnostics={runnable:Me,programLog:de,vertexShader:{log:Fe,prefix:U},fragmentShader:{log:we,prefix:D}})}l.deleteShader(Y),l.deleteShader(q),ne=new zy(l,P),le=function(de,Fe){const we={},Me=de.getProgramParameter(Fe,de.ACTIVE_ATTRIBUTES);for(let _e=0;_e<Me;_e++){const tt=de.getActiveAttrib(Fe,_e),me=tt.name;let wt=1;tt.type===de.FLOAT_MAT2&&(wt=2),tt.type===de.FLOAT_MAT3&&(wt=3),tt.type===de.FLOAT_MAT4&&(wt=4),we[me]={type:tt.type,location:de.getAttribLocation(Fe,me),locationSize:wt}}return we}(l,P)}let ne,le;l.attachShader(P,Y),l.attachShader(P,q),i.index0AttributeName!==void 0?l.bindAttribLocation(P,0,i.index0AttributeName):i.morphTargets===!0&&l.bindAttribLocation(P,0,"position"),l.linkProgram(P),this.getUniforms=function(){return ne===void 0&&K(this),ne},this.getAttributes=function(){return le===void 0&&K(this),le};let fe=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return fe===!1&&(fe=l.getProgramParameter(P,37297)),fe},this.destroy=function(){o.releaseStatesOfProgram(this),l.deleteProgram(P),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=i6++,this.cacheKey=t,this.usedTimes=1,this.program=P,this.vertexShader=Y,this.fragmentShader=q,this}let p6=0;class A6{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,o=t.fragmentShader,l=this._getShaderStage(i),h=this._getShaderStage(o),d=this._getShaderCacheForMaterial(t);return d.has(l)===!1&&(d.add(l),l.usedTimes++),d.has(h)===!1&&(d.add(h),h.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const o of i)o.usedTimes--,o.usedTimes===0&&this.shaderCache.delete(o.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let o=i.get(t);return o===void 0&&(o=new Set,i.set(t,o)),o}_getShaderStage(t){const i=this.shaderCache;let o=i.get(t);return o===void 0&&(o=new f6(t),i.set(t,o)),o}}class f6{constructor(t){this.id=p6++,this.code=t,this.usedTimes=0}}function m6(p,t,i,o,l,h,d){const f=new fw,g=new A6,y=new Set,x=[],b=l.logarithmicDepthBuffer,_=l.reverseDepthBuffer,w=l.vertexTextures;let T=l.precision;const P={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function U(D){return y.add(D),D===0?"uv":`uv${D}`}return{getParameters:function(D,z,G,Q,Y){const q=Q.fog,K=Y.geometry,ne=D.isMeshStandardMaterial?Q.environment:null,le=(D.isMeshStandardMaterial?i:t).get(D.envMap||ne),fe=le&&le.mapping===ry?le.image.height:null,be=P[D.type];D.precision!==null&&(T=l.getMaxPrecision(D.precision),T!==D.precision&&console.warn("THREE.WebGLProgram.getParameters:",D.precision,"not supported, using",T,"instead."));const de=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,Fe=de!==void 0?de.length:0;let we,Me,_e,tt,me=0;if(K.morphAttributes.position!==void 0&&(me=1),K.morphAttributes.normal!==void 0&&(me=2),K.morphAttributes.color!==void 0&&(me=3),be){const sl=Il[be];we=sl.vertexShader,Me=sl.fragmentShader}else we=D.vertexShader,Me=D.fragmentShader,g.update(D),_e=g.getVertexShaderID(D),tt=g.getFragmentShaderID(D);const wt=p.getRenderTarget(),ft=Y.isInstancedMesh===!0,ze=Y.isBatchedMesh===!0,$e=!!D.map,pt=!!D.matcap,lt=!!le,he=!!D.aoMap,Z=!!D.lightMap,Ce=!!D.bumpMap,Qe=!!D.normalMap,Pe=!!D.displacementMap,je=!!D.emissiveMap,pe=!!D.metalnessMap,Ve=!!D.roughnessMap,Ye=D.anisotropy>0,Ct=D.clearcoat>0,Ke=D.dispersion>0,yt=D.iridescence>0,bt=D.sheen>0,ht=D.transmission>0,Vt=Ye&&!!D.anisotropyMap,Nt=Ct&&!!D.clearcoatMap,nn=Ct&&!!D.clearcoatNormalMap,k=Ct&&!!D.clearcoatRoughnessMap,j=yt&&!!D.iridescenceMap,J=yt&&!!D.iridescenceThicknessMap,Ae=bt&&!!D.sheenColorMap,ye=bt&&!!D.sheenRoughnessMap,Re=!!D.specularMap,rt=!!D.specularColorMap,_t=!!D.specularIntensityMap,kt=ht&&!!D.transmissionMap,un=ht&&!!D.thicknessMap,Jn=!!D.gradientMap,Ri=!!D.alphaMap,Xr=D.alphaTest>0,da=!!D.alphaHash,$a=!!D.extensions;let De=0;D.toneMapped&&(wt!==null&&wt.isXRRenderTarget!==!0||(De=p.toneMapping));const pa={shaderID:be,shaderType:D.type,shaderName:D.name,vertexShader:we,fragmentShader:Me,defines:D.defines,customVertexShaderID:_e,customFragmentShaderID:tt,isRawShaderMaterial:D.isRawShaderMaterial===!0,glslVersion:D.glslVersion,precision:T,batching:ze,batchingColor:ze&&Y._colorsTexture!==null,instancing:ft,instancingColor:ft&&Y.instanceColor!==null,instancingMorph:ft&&Y.morphTexture!==null,supportsVertexTextures:w,outputColorSpace:wt===null?p.outputColorSpace:wt.isXRRenderTarget===!0?wt.texture.colorSpace:Yi,alphaToCoverage:!!D.alphaToCoverage,map:$e,matcap:pt,envMap:lt,envMapMode:lt&&le.mapping,envMapCubeUVHeight:fe,aoMap:he,lightMap:Z,bumpMap:Ce,normalMap:Qe,displacementMap:w&&Pe,emissiveMap:je,normalMapObjectSpace:Qe&&D.normalMapType===1,normalMapTangentSpace:Qe&&D.normalMapType===0,metalnessMap:pe,roughnessMap:Ve,anisotropy:Ye,anisotropyMap:Vt,clearcoat:Ct,clearcoatMap:Nt,clearcoatNormalMap:nn,clearcoatRoughnessMap:k,dispersion:Ke,iridescence:yt,iridescenceMap:j,iridescenceThicknessMap:J,sheen:bt,sheenColorMap:Ae,sheenRoughnessMap:ye,specularMap:Re,specularColorMap:rt,specularIntensityMap:_t,transmission:ht,transmissionMap:kt,thicknessMap:un,gradientMap:Jn,opaque:D.transparent===!1&&D.blending===1&&D.alphaToCoverage===!1,alphaMap:Ri,alphaTest:Xr,alphaHash:da,combine:D.combine,mapUv:$e&&U(D.map.channel),aoMapUv:he&&U(D.aoMap.channel),lightMapUv:Z&&U(D.lightMap.channel),bumpMapUv:Ce&&U(D.bumpMap.channel),normalMapUv:Qe&&U(D.normalMap.channel),displacementMapUv:Pe&&U(D.displacementMap.channel),emissiveMapUv:je&&U(D.emissiveMap.channel),metalnessMapUv:pe&&U(D.metalnessMap.channel),roughnessMapUv:Ve&&U(D.roughnessMap.channel),anisotropyMapUv:Vt&&U(D.anisotropyMap.channel),clearcoatMapUv:Nt&&U(D.clearcoatMap.channel),clearcoatNormalMapUv:nn&&U(D.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:k&&U(D.clearcoatRoughnessMap.channel),iridescenceMapUv:j&&U(D.iridescenceMap.channel),iridescenceThicknessMapUv:J&&U(D.iridescenceThicknessMap.channel),sheenColorMapUv:Ae&&U(D.sheenColorMap.channel),sheenRoughnessMapUv:ye&&U(D.sheenRoughnessMap.channel),specularMapUv:Re&&U(D.specularMap.channel),specularColorMapUv:rt&&U(D.specularColorMap.channel),specularIntensityMapUv:_t&&U(D.specularIntensityMap.channel),transmissionMapUv:kt&&U(D.transmissionMap.channel),thicknessMapUv:un&&U(D.thicknessMap.channel),alphaMapUv:Ri&&U(D.alphaMap.channel),vertexTangents:!!K.attributes.tangent&&(Qe||Ye),vertexColors:D.vertexColors,vertexAlphas:D.vertexColors===!0&&!!K.attributes.color&&K.attributes.color.itemSize===4,pointsUvs:Y.isPoints===!0&&!!K.attributes.uv&&($e||Ri),fog:!!q,useFog:D.fog===!0,fogExp2:!!q&&q.isFogExp2,flatShading:D.flatShading===!0,sizeAttenuation:D.sizeAttenuation===!0,logarithmicDepthBuffer:b,reverseDepthBuffer:_,skinning:Y.isSkinnedMesh===!0,morphTargets:K.morphAttributes.position!==void 0,morphNormals:K.morphAttributes.normal!==void 0,morphColors:K.morphAttributes.color!==void 0,morphTargetsCount:Fe,morphTextureStride:me,numDirLights:z.directional.length,numPointLights:z.point.length,numSpotLights:z.spot.length,numSpotLightMaps:z.spotLightMap.length,numRectAreaLights:z.rectArea.length,numHemiLights:z.hemi.length,numDirLightShadows:z.directionalShadowMap.length,numPointLightShadows:z.pointShadowMap.length,numSpotLightShadows:z.spotShadowMap.length,numSpotLightShadowsWithMaps:z.numSpotLightShadowsWithMaps,numLightProbes:z.numLightProbes,numClippingPlanes:d.numPlanes,numClipIntersection:d.numIntersection,dithering:D.dithering,shadowMapEnabled:p.shadowMap.enabled&&G.length>0,shadowMapType:p.shadowMap.type,toneMapping:De,decodeVideoTexture:$e&&D.map.isVideoTexture===!0&&Si.getTransfer(D.map.colorSpace)===ar,premultipliedAlpha:D.premultipliedAlpha,doubleSided:D.side===2,flipSided:D.side===1,useDepthPacking:D.depthPacking>=0,depthPacking:D.depthPacking||0,index0AttributeName:D.index0AttributeName,extensionClipCullDistance:$a&&D.extensions.clipCullDistance===!0&&o.has("WEBGL_clip_cull_distance"),extensionMultiDraw:($a&&D.extensions.multiDraw===!0||ze)&&o.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:o.has("KHR_parallel_shader_compile"),customProgramCacheKey:D.customProgramCacheKey()};return pa.vertexUv1s=y.has(1),pa.vertexUv2s=y.has(2),pa.vertexUv3s=y.has(3),y.clear(),pa},getProgramCacheKey:function(D){const z=[];if(D.shaderID?z.push(D.shaderID):(z.push(D.customVertexShaderID),z.push(D.customFragmentShaderID)),D.defines!==void 0)for(const G in D.defines)z.push(G),z.push(D.defines[G]);return D.isRawShaderMaterial===!1&&(function(G,Q){G.push(Q.precision),G.push(Q.outputColorSpace),G.push(Q.envMapMode),G.push(Q.envMapCubeUVHeight),G.push(Q.mapUv),G.push(Q.alphaMapUv),G.push(Q.lightMapUv),G.push(Q.aoMapUv),G.push(Q.bumpMapUv),G.push(Q.normalMapUv),G.push(Q.displacementMapUv),G.push(Q.emissiveMapUv),G.push(Q.metalnessMapUv),G.push(Q.roughnessMapUv),G.push(Q.anisotropyMapUv),G.push(Q.clearcoatMapUv),G.push(Q.clearcoatNormalMapUv),G.push(Q.clearcoatRoughnessMapUv),G.push(Q.iridescenceMapUv),G.push(Q.iridescenceThicknessMapUv),G.push(Q.sheenColorMapUv),G.push(Q.sheenRoughnessMapUv),G.push(Q.specularMapUv),G.push(Q.specularColorMapUv),G.push(Q.specularIntensityMapUv),G.push(Q.transmissionMapUv),G.push(Q.thicknessMapUv),G.push(Q.combine),G.push(Q.fogExp2),G.push(Q.sizeAttenuation),G.push(Q.morphTargetsCount),G.push(Q.morphAttributeCount),G.push(Q.numDirLights),G.push(Q.numPointLights),G.push(Q.numSpotLights),G.push(Q.numSpotLightMaps),G.push(Q.numHemiLights),G.push(Q.numRectAreaLights),G.push(Q.numDirLightShadows),G.push(Q.numPointLightShadows),G.push(Q.numSpotLightShadows),G.push(Q.numSpotLightShadowsWithMaps),G.push(Q.numLightProbes),G.push(Q.shadowMapType),G.push(Q.toneMapping),G.push(Q.numClippingPlanes),G.push(Q.numClipIntersection),G.push(Q.depthPacking)}(z,D),function(G,Q){f.disableAll(),Q.supportsVertexTextures&&f.enable(0),Q.instancing&&f.enable(1),Q.instancingColor&&f.enable(2),Q.instancingMorph&&f.enable(3),Q.matcap&&f.enable(4),Q.envMap&&f.enable(5),Q.normalMapObjectSpace&&f.enable(6),Q.normalMapTangentSpace&&f.enable(7),Q.clearcoat&&f.enable(8),Q.iridescence&&f.enable(9),Q.alphaTest&&f.enable(10),Q.vertexColors&&f.enable(11),Q.vertexAlphas&&f.enable(12),Q.vertexUv1s&&f.enable(13),Q.vertexUv2s&&f.enable(14),Q.vertexUv3s&&f.enable(15),Q.vertexTangents&&f.enable(16),Q.anisotropy&&f.enable(17),Q.alphaHash&&f.enable(18),Q.batching&&f.enable(19),Q.dispersion&&f.enable(20),Q.batchingColor&&f.enable(21),G.push(f.mask),f.disableAll(),Q.fog&&f.enable(0),Q.useFog&&f.enable(1),Q.flatShading&&f.enable(2),Q.logarithmicDepthBuffer&&f.enable(3),Q.reverseDepthBuffer&&f.enable(4),Q.skinning&&f.enable(5),Q.morphTargets&&f.enable(6),Q.morphNormals&&f.enable(7),Q.morphColors&&f.enable(8),Q.premultipliedAlpha&&f.enable(9),Q.shadowMapEnabled&&f.enable(10),Q.doubleSided&&f.enable(11),Q.flipSided&&f.enable(12),Q.useDepthPacking&&f.enable(13),Q.dithering&&f.enable(14),Q.transmission&&f.enable(15),Q.sheen&&f.enable(16),Q.opaque&&f.enable(17),Q.pointsUvs&&f.enable(18),Q.decodeVideoTexture&&f.enable(19),Q.alphaToCoverage&&f.enable(20),G.push(f.mask)}(z,D),z.push(p.outputColorSpace)),z.push(D.customProgramCacheKey),z.join()},getUniforms:function(D){const z=P[D.type];let G;if(z){const Q=Il[z];G=JG.clone(Q.uniforms)}else G=D.uniforms;return G},acquireProgram:function(D,z){let G;for(let Q=0,Y=x.length;Q<Y;Q++){const q=x[Q];if(q.cacheKey===z){G=q,++G.usedTimes;break}}return G===void 0&&(G=new d6(p,z,D,h),x.push(G)),G},releaseProgram:function(D){if(--D.usedTimes==0){const z=x.indexOf(D);x[z]=x[x.length-1],x.pop(),D.destroy()}},releaseShaderCache:function(D){g.remove(D)},programs:x,dispose:function(){g.dispose()}}}function g6(){let p=new WeakMap;return{has:function(t){return p.has(t)},get:function(t){let i=p.get(t);return i===void 0&&(i={},p.set(t,i)),i},remove:function(t){p.delete(t)},update:function(t,i,o){p.get(t)[i]=o},dispose:function(){p=new WeakMap}}}function v6(p,t){return p.groupOrder!==t.groupOrder?p.groupOrder-t.groupOrder:p.renderOrder!==t.renderOrder?p.renderOrder-t.renderOrder:p.material.id!==t.material.id?p.material.id-t.material.id:p.z!==t.z?p.z-t.z:p.id-t.id}function DL(p,t){return p.groupOrder!==t.groupOrder?p.groupOrder-t.groupOrder:p.renderOrder!==t.renderOrder?p.renderOrder-t.renderOrder:p.z!==t.z?t.z-p.z:p.id-t.id}function PL(){const p=[];let t=0;const i=[],o=[],l=[];function h(d,f,g,y,x,b){let _=p[t];return _===void 0?(_={id:d.id,object:d,geometry:f,material:g,groupOrder:y,renderOrder:d.renderOrder,z:x,group:b},p[t]=_):(_.id=d.id,_.object=d,_.geometry=f,_.material=g,_.groupOrder=y,_.renderOrder=d.renderOrder,_.z=x,_.group=b),t++,_}return{opaque:i,transmissive:o,transparent:l,init:function(){t=0,i.length=0,o.length=0,l.length=0},push:function(d,f,g,y,x,b){const _=h(d,f,g,y,x,b);g.transmission>0?o.push(_):g.transparent===!0?l.push(_):i.push(_)},unshift:function(d,f,g,y,x,b){const _=h(d,f,g,y,x,b);g.transmission>0?o.unshift(_):g.transparent===!0?l.unshift(_):i.unshift(_)},finish:function(){for(let d=t,f=p.length;d<f;d++){const g=p[d];if(g.id===null)break;g.id=null,g.object=null,g.geometry=null,g.material=null,g.group=null}},sort:function(d,f){i.length>1&&i.sort(d||v6),o.length>1&&o.sort(f||DL),l.length>1&&l.sort(f||DL)}}}function y6(){let p=new WeakMap;return{get:function(t,i){const o=p.get(t);let l;return o===void 0?(l=new PL,p.set(t,[l])):i>=o.length?(l=new PL,o.push(l)):l=o[i],l},dispose:function(){p=new WeakMap}}}function E6(){const p={};return{get:function(t){if(p[t.id]!==void 0)return p[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new ve,color:new fn};break;case"SpotLight":i={position:new ve,direction:new ve,color:new fn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ve,color:new fn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ve,skyColor:new fn,groundColor:new fn};break;case"RectAreaLight":i={color:new fn,position:new ve,halfWidth:new ve,halfHeight:new ve}}return p[t.id]=i,i}}}let x6=0;function _6(p,t){return(t.castShadow?2:0)-(p.castShadow?2:0)+(t.map?1:0)-(p.map?1:0)}function b6(p){const t=new E6,i=function(){const f={};return{get:function(g){if(f[g.id]!==void 0)return f[g.id];let y;switch(g.type){case"DirectionalLight":case"SpotLight":y={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Hn};break;case"PointLight":y={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Hn,shadowCameraNear:1,shadowCameraFar:1e3}}return f[g.id]=y,y}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let f=0;f<9;f++)o.probe.push(new ve);const l=new ve,h=new In,d=new In;return{setup:function(f){let g=0,y=0,x=0;for(let K=0;K<9;K++)o.probe[K].set(0,0,0);let b=0,_=0,w=0,T=0,P=0,U=0,D=0,z=0,G=0,Q=0,Y=0;f.sort(_6);for(let K=0,ne=f.length;K<ne;K++){const le=f[K],fe=le.color,be=le.intensity,de=le.distance,Fe=le.shadow&&le.shadow.map?le.shadow.map.texture:null;if(le.isAmbientLight)g+=fe.r*be,y+=fe.g*be,x+=fe.b*be;else if(le.isLightProbe){for(let we=0;we<9;we++)o.probe[we].addScaledVector(le.sh.coefficients[we],be);Y++}else if(le.isDirectionalLight){const we=t.get(le);if(we.color.copy(le.color).multiplyScalar(le.intensity),le.castShadow){const Me=le.shadow,_e=i.get(le);_e.shadowIntensity=Me.intensity,_e.shadowBias=Me.bias,_e.shadowNormalBias=Me.normalBias,_e.shadowRadius=Me.radius,_e.shadowMapSize=Me.mapSize,o.directionalShadow[b]=_e,o.directionalShadowMap[b]=Fe,o.directionalShadowMatrix[b]=le.shadow.matrix,U++}o.directional[b]=we,b++}else if(le.isSpotLight){const we=t.get(le);we.position.setFromMatrixPosition(le.matrixWorld),we.color.copy(fe).multiplyScalar(be),we.distance=de,we.coneCos=Math.cos(le.angle),we.penumbraCos=Math.cos(le.angle*(1-le.penumbra)),we.decay=le.decay,o.spot[w]=we;const Me=le.shadow;if(le.map&&(o.spotLightMap[G]=le.map,G++,Me.updateMatrices(le),le.castShadow&&Q++),o.spotLightMatrix[w]=Me.matrix,le.castShadow){const _e=i.get(le);_e.shadowIntensity=Me.intensity,_e.shadowBias=Me.bias,_e.shadowNormalBias=Me.normalBias,_e.shadowRadius=Me.radius,_e.shadowMapSize=Me.mapSize,o.spotShadow[w]=_e,o.spotShadowMap[w]=Fe,z++}w++}else if(le.isRectAreaLight){const we=t.get(le);we.color.copy(fe).multiplyScalar(be),we.halfWidth.set(.5*le.width,0,0),we.halfHeight.set(0,.5*le.height,0),o.rectArea[T]=we,T++}else if(le.isPointLight){const we=t.get(le);if(we.color.copy(le.color).multiplyScalar(le.intensity),we.distance=le.distance,we.decay=le.decay,le.castShadow){const Me=le.shadow,_e=i.get(le);_e.shadowIntensity=Me.intensity,_e.shadowBias=Me.bias,_e.shadowNormalBias=Me.normalBias,_e.shadowRadius=Me.radius,_e.shadowMapSize=Me.mapSize,_e.shadowCameraNear=Me.camera.near,_e.shadowCameraFar=Me.camera.far,o.pointShadow[_]=_e,o.pointShadowMap[_]=Fe,o.pointShadowMatrix[_]=le.shadow.matrix,D++}o.point[_]=we,_++}else if(le.isHemisphereLight){const we=t.get(le);we.skyColor.copy(le.color).multiplyScalar(be),we.groundColor.copy(le.groundColor).multiplyScalar(be),o.hemi[P]=we,P++}}T>0&&(p.has("OES_texture_float_linear")===!0?(o.rectAreaLTC1=Gt.LTC_FLOAT_1,o.rectAreaLTC2=Gt.LTC_FLOAT_2):(o.rectAreaLTC1=Gt.LTC_HALF_1,o.rectAreaLTC2=Gt.LTC_HALF_2)),o.ambient[0]=g,o.ambient[1]=y,o.ambient[2]=x;const q=o.hash;q.directionalLength===b&&q.pointLength===_&&q.spotLength===w&&q.rectAreaLength===T&&q.hemiLength===P&&q.numDirectionalShadows===U&&q.numPointShadows===D&&q.numSpotShadows===z&&q.numSpotMaps===G&&q.numLightProbes===Y||(o.directional.length=b,o.spot.length=w,o.rectArea.length=T,o.point.length=_,o.hemi.length=P,o.directionalShadow.length=U,o.directionalShadowMap.length=U,o.pointShadow.length=D,o.pointShadowMap.length=D,o.spotShadow.length=z,o.spotShadowMap.length=z,o.directionalShadowMatrix.length=U,o.pointShadowMatrix.length=D,o.spotLightMatrix.length=z+G-Q,o.spotLightMap.length=G,o.numSpotLightShadowsWithMaps=Q,o.numLightProbes=Y,q.directionalLength=b,q.pointLength=_,q.spotLength=w,q.rectAreaLength=T,q.hemiLength=P,q.numDirectionalShadows=U,q.numPointShadows=D,q.numSpotShadows=z,q.numSpotMaps=G,q.numLightProbes=Y,o.version=x6++)},setupView:function(f,g){let y=0,x=0,b=0,_=0,w=0;const T=g.matrixWorldInverse;for(let P=0,U=f.length;P<U;P++){const D=f[P];if(D.isDirectionalLight){const z=o.directional[y];z.direction.setFromMatrixPosition(D.matrixWorld),l.setFromMatrixPosition(D.target.matrixWorld),z.direction.sub(l),z.direction.transformDirection(T),y++}else if(D.isSpotLight){const z=o.spot[b];z.position.setFromMatrixPosition(D.matrixWorld),z.position.applyMatrix4(T),z.direction.setFromMatrixPosition(D.matrixWorld),l.setFromMatrixPosition(D.target.matrixWorld),z.direction.sub(l),z.direction.transformDirection(T),b++}else if(D.isRectAreaLight){const z=o.rectArea[_];z.position.setFromMatrixPosition(D.matrixWorld),z.position.applyMatrix4(T),d.identity(),h.copy(D.matrixWorld),h.premultiply(T),d.extractRotation(h),z.halfWidth.set(.5*D.width,0,0),z.halfHeight.set(0,.5*D.height,0),z.halfWidth.applyMatrix4(d),z.halfHeight.applyMatrix4(d),_++}else if(D.isPointLight){const z=o.point[x];z.position.setFromMatrixPosition(D.matrixWorld),z.position.applyMatrix4(T),x++}else if(D.isHemisphereLight){const z=o.hemi[w];z.direction.setFromMatrixPosition(D.matrixWorld),z.direction.transformDirection(T),w++}}},state:o}}function UL(p){const t=new b6(p),i=[],o=[],l={lightsArray:i,shadowsArray:o,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(h){l.camera=h,i.length=0,o.length=0},state:l,setupLights:function(){t.setup(i)},setupLightsView:function(h){t.setupView(i,h)},pushLight:function(h){i.push(h)},pushShadow:function(h){o.push(h)}}}function C6(p){let t=new WeakMap;return{get:function(i,o=0){const l=t.get(i);let h;return l===void 0?(h=new UL(p),t.set(i,[h])):o>=l.length?(h=new UL(p),l.push(h)):h=l[o],h},dispose:function(){t=new WeakMap}}}class NL extends el{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class w6 extends el{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function M6(p,t,i){let o=new Bw;const l=new Hn,h=new Hn,d=new Oi,f=new NL({depthPacking:3201}),g=new w6,y={},x=i.maxTextureSize,b={[$5]:1,[Z5]:0,[eG]:2},_=new Ta({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Hn},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),w=_.clone();w.defines.HORIZONTAL_PASS=1;const T=new Ra;T.setAttribute("position",new mr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const P=new Vi(T,_),U=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let D=this.type;function z(q,K){const ne=t.update(P);_.defines.VSM_SAMPLES!==q.blurSamples&&(_.defines.VSM_SAMPLES=q.blurSamples,w.defines.VSM_SAMPLES=q.blurSamples,_.needsUpdate=!0,w.needsUpdate=!0),q.mapPass===null&&(q.mapPass=new go(l.x,l.y)),_.uniforms.shadow_pass.value=q.map.texture,_.uniforms.resolution.value=q.mapSize,_.uniforms.radius.value=q.radius,p.setRenderTarget(q.mapPass),p.clear(),p.renderBufferDirect(K,null,ne,_,P,null),w.uniforms.shadow_pass.value=q.mapPass.texture,w.uniforms.resolution.value=q.mapSize,w.uniforms.radius.value=q.radius,p.setRenderTarget(q.map),p.clear(),p.renderBufferDirect(K,null,ne,w,P,null)}function G(q,K,ne,le){let fe=null;const be=ne.isPointLight===!0?q.customDistanceMaterial:q.customDepthMaterial;if(be!==void 0)fe=be;else if(fe=ne.isPointLight===!0?g:f,p.localClippingEnabled&&K.clipShadows===!0&&Array.isArray(K.clippingPlanes)&&K.clippingPlanes.length!==0||K.displacementMap&&K.displacementScale!==0||K.alphaMap&&K.alphaTest>0||K.map&&K.alphaTest>0){const de=fe.uuid,Fe=K.uuid;let we=y[de];we===void 0&&(we={},y[de]=we);let Me=we[Fe];Me===void 0&&(Me=fe.clone(),we[Fe]=Me,K.addEventListener("dispose",Y)),fe=Me}return fe.visible=K.visible,fe.wireframe=K.wireframe,fe.side=le===3?K.shadowSide!==null?K.shadowSide:K.side:K.shadowSide!==null?K.shadowSide:b[K.side],fe.alphaMap=K.alphaMap,fe.alphaTest=K.alphaTest,fe.map=K.map,fe.clipShadows=K.clipShadows,fe.clippingPlanes=K.clippingPlanes,fe.clipIntersection=K.clipIntersection,fe.displacementMap=K.displacementMap,fe.displacementScale=K.displacementScale,fe.displacementBias=K.displacementBias,fe.wireframeLinewidth=K.wireframeLinewidth,fe.linewidth=K.linewidth,ne.isPointLight===!0&&fe.isMeshDistanceMaterial===!0&&(p.properties.get(fe).light=ne),fe}function Q(q,K,ne,le,fe){if(q.visible===!1)return;if(q.layers.test(K.layers)&&(q.isMesh||q.isLine||q.isPoints)&&(q.castShadow||q.receiveShadow&&fe===3)&&(!q.frustumCulled||o.intersectsObject(q))){q.modelViewMatrix.multiplyMatrices(ne.matrixWorldInverse,q.matrixWorld);const de=t.update(q),Fe=q.material;if(Array.isArray(Fe)){const we=de.groups;for(let Me=0,_e=we.length;Me<_e;Me++){const tt=we[Me],me=Fe[tt.materialIndex];if(me&&me.visible){const wt=G(q,me,le,fe);q.onBeforeShadow(p,q,K,ne,de,wt,tt),p.renderBufferDirect(ne,null,de,wt,q,tt),q.onAfterShadow(p,q,K,ne,de,wt,tt)}}}else if(Fe.visible){const we=G(q,Fe,le,fe);q.onBeforeShadow(p,q,K,ne,de,we,null),p.renderBufferDirect(ne,null,de,we,q,null),q.onAfterShadow(p,q,K,ne,de,we,null)}}const be=q.children;for(let de=0,Fe=be.length;de<Fe;de++)Q(be[de],K,ne,le,fe)}function Y(q){q.target.removeEventListener("dispose",Y);for(const K in y){const ne=y[K],le=q.target.uuid;le in ne&&(ne[le].dispose(),delete ne[le])}}this.render=function(q,K,ne){if(U.enabled===!1||U.autoUpdate===!1&&U.needsUpdate===!1||q.length===0)return;const le=p.getRenderTarget(),fe=p.getActiveCubeFace(),be=p.getActiveMipmapLevel(),de=p.state;de.setBlending(0),de.buffers.color.setClear(1,1,1,1),de.buffers.depth.setTest(!0),de.setScissorTest(!1);const Fe=D!==3&&this.type===3,we=D===3&&this.type!==3;for(let Me=0,_e=q.length;Me<_e;Me++){const tt=q[Me],me=tt.shadow;if(me===void 0){console.warn("THREE.WebGLShadowMap:",tt,"has no shadow.");continue}if(me.autoUpdate===!1&&me.needsUpdate===!1)continue;l.copy(me.mapSize);const wt=me.getFrameExtents();if(l.multiply(wt),h.copy(me.mapSize),(l.x>x||l.y>x)&&(l.x>x&&(h.x=Math.floor(x/wt.x),l.x=h.x*wt.x,me.mapSize.x=h.x),l.y>x&&(h.y=Math.floor(x/wt.y),l.y=h.y*wt.y,me.mapSize.y=h.y)),me.map===null||Fe===!0||we===!0){const ze=this.type!==3?{minFilter:fs,magFilter:fs}:{};me.map!==null&&me.map.dispose(),me.map=new go(l.x,l.y,ze),me.map.texture.name=tt.name+".shadowMap",me.camera.updateProjectionMatrix()}p.setRenderTarget(me.map),p.clear();const ft=me.getViewportCount();for(let ze=0;ze<ft;ze++){const $e=me.getViewport(ze);d.set(h.x*$e.x,h.y*$e.y,h.x*$e.z,h.y*$e.w),de.viewport(d),me.updateMatrices(tt,ze),o=me.getFrustum(),Q(K,ne,me.camera,tt,this.type)}me.isPointLightShadow!==!0&&this.type===3&&z(me,ne),me.needsUpdate=!1}D=this.type,U.needsUpdate=!1,p.setRenderTarget(le,fe,be)}}const S6={[vG]:1,[EG]:6,[_G]:7,[xG]:5,[yG]:0,[CG]:2,[wG]:4,[bG]:3};function I6(p){const t=new function(){let pe=!1;const Ve=new Oi;let Ye=null;const Ct=new Oi(0,0,0,0);return{setMask:function(Ke){Ye===Ke||pe||(p.colorMask(Ke,Ke,Ke,Ke),Ye=Ke)},setLocked:function(Ke){pe=Ke},setClear:function(Ke,yt,bt,ht,Vt){Vt===!0&&(Ke*=ht,yt*=ht,bt*=ht),Ve.set(Ke,yt,bt,ht),Ct.equals(Ve)===!1&&(p.clearColor(Ke,yt,bt,ht),Ct.copy(Ve))},reset:function(){pe=!1,Ye=null,Ct.set(-1,0,0,0)}}},i=new function(){let pe=!1,Ve=!1,Ye=null,Ct=null,Ke=null;return{setReversed:function(yt){Ve=yt},setTest:function(yt){yt?pt(p.DEPTH_TEST):lt(p.DEPTH_TEST)},setMask:function(yt){Ye===yt||pe||(p.depthMask(yt),Ye=yt)},setFunc:function(yt){if(Ve&&(yt=S6[yt]),Ct!==yt){switch(yt){case 0:p.depthFunc(p.NEVER);break;case 1:p.depthFunc(p.ALWAYS);break;case 2:p.depthFunc(p.LESS);break;case 3:default:p.depthFunc(p.LEQUAL);break;case 4:p.depthFunc(p.EQUAL);break;case 5:p.depthFunc(p.GEQUAL);break;case 6:p.depthFunc(p.GREATER);break;case 7:p.depthFunc(p.NOTEQUAL)}Ct=yt}},setLocked:function(yt){pe=yt},setClear:function(yt){Ke!==yt&&(p.clearDepth(yt),Ke=yt)},reset:function(){pe=!1,Ye=null,Ct=null,Ke=null}}},o=new function(){let pe=!1,Ve=null,Ye=null,Ct=null,Ke=null,yt=null,bt=null,ht=null,Vt=null;return{setTest:function(Nt){pe||(Nt?pt(p.STENCIL_TEST):lt(p.STENCIL_TEST))},setMask:function(Nt){Ve===Nt||pe||(p.stencilMask(Nt),Ve=Nt)},setFunc:function(Nt,nn,k){Ye===Nt&&Ct===nn&&Ke===k||(p.stencilFunc(Nt,nn,k),Ye=Nt,Ct=nn,Ke=k)},setOp:function(Nt,nn,k){yt===Nt&&bt===nn&&ht===k||(p.stencilOp(Nt,nn,k),yt=Nt,bt=nn,ht=k)},setLocked:function(Nt){pe=Nt},setClear:function(Nt){Vt!==Nt&&(p.clearStencil(Nt),Vt=Nt)},reset:function(){pe=!1,Ve=null,Ye=null,Ct=null,Ke=null,yt=null,bt=null,ht=null,Vt=null}}},l=new WeakMap,h=new WeakMap;let d={},f={},g=new WeakMap,y=[],x=null,b=!1,_=null,w=null,T=null,P=null,U=null,D=null,z=null,G=new fn(0,0,0),Q=0,Y=!1,q=null,K=null,ne=null,le=null,fe=null;const be=p.getParameter(p.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let de=!1,Fe=0;const we=p.getParameter(p.VERSION);we.indexOf("WebGL")!==-1?(Fe=parseFloat(/^WebGL (\d)/.exec(we)[1]),de=Fe>=1):we.indexOf("OpenGL ES")!==-1&&(Fe=parseFloat(/^OpenGL ES (\d)/.exec(we)[1]),de=Fe>=2);let Me=null,_e={};const tt=p.getParameter(p.SCISSOR_BOX),me=p.getParameter(p.VIEWPORT),wt=new Oi().fromArray(tt),ft=new Oi().fromArray(me);function ze(pe,Ve,Ye,Ct){const Ke=new Uint8Array(4),yt=p.createTexture();p.bindTexture(pe,yt),p.texParameteri(pe,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(pe,p.TEXTURE_MAG_FILTER,p.NEAREST);for(let bt=0;bt<Ye;bt++)pe===p.TEXTURE_3D||pe===p.TEXTURE_2D_ARRAY?p.texImage3D(Ve,0,p.RGBA,1,1,Ct,0,p.RGBA,p.UNSIGNED_BYTE,Ke):p.texImage2D(Ve+bt,0,p.RGBA,1,1,0,p.RGBA,p.UNSIGNED_BYTE,Ke);return yt}const $e={};function pt(pe){d[pe]!==!0&&(p.enable(pe),d[pe]=!0)}function lt(pe){d[pe]!==!1&&(p.disable(pe),d[pe]=!1)}$e[p.TEXTURE_2D]=ze(p.TEXTURE_2D,p.TEXTURE_2D,1),$e[p.TEXTURE_CUBE_MAP]=ze(p.TEXTURE_CUBE_MAP,p.TEXTURE_CUBE_MAP_POSITIVE_X,6),$e[p.TEXTURE_2D_ARRAY]=ze(p.TEXTURE_2D_ARRAY,p.TEXTURE_2D_ARRAY,1,1),$e[p.TEXTURE_3D]=ze(p.TEXTURE_3D,p.TEXTURE_3D,1,1),t.setClear(0,0,0,1),i.setClear(1),o.setClear(0),pt(p.DEPTH_TEST),i.setFunc(3),Qe(!1),Pe(1),pt(p.CULL_FACE),Ce(0);const he={[sd]:p.FUNC_ADD,[tG]:p.FUNC_SUBTRACT,[nG]:p.FUNC_REVERSE_SUBTRACT};he[103]=p.MIN,he[104]=p.MAX;const Z={[iG]:p.ZERO,[rG]:p.ONE,[sG]:p.SRC_COLOR,[oG]:p.SRC_ALPHA,[pG]:p.SRC_ALPHA_SATURATE,[uG]:p.DST_COLOR,[cG]:p.DST_ALPHA,[aG]:p.ONE_MINUS_SRC_COLOR,[lG]:p.ONE_MINUS_SRC_ALPHA,[dG]:p.ONE_MINUS_DST_COLOR,[hG]:p.ONE_MINUS_DST_ALPHA,[AG]:p.CONSTANT_COLOR,[fG]:p.ONE_MINUS_CONSTANT_COLOR,[mG]:p.CONSTANT_ALPHA,[gG]:p.ONE_MINUS_CONSTANT_ALPHA};function Ce(pe,Ve,Ye,Ct,Ke,yt,bt,ht,Vt,Nt){if(pe!==0){if(b===!1&&(pt(p.BLEND),b=!0),pe===5)Ke=Ke||Ve,yt=yt||Ye,bt=bt||Ct,Ve===w&&Ke===U||(p.blendEquationSeparate(he[Ve],he[Ke]),w=Ve,U=Ke),Ye===T&&Ct===P&&yt===D&&bt===z||(p.blendFuncSeparate(Z[Ye],Z[Ct],Z[yt],Z[bt]),T=Ye,P=Ct,D=yt,z=bt),ht.equals(G)!==!1&&Vt===Q||(p.blendColor(ht.r,ht.g,ht.b,Vt),G.copy(ht),Q=Vt),_=pe,Y=!1;else if(pe!==_||Nt!==Y){if(w===sd&&U===sd||(p.blendEquation(p.FUNC_ADD),w=sd,U=sd),Nt)switch(pe){case 1:p.blendFuncSeparate(p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA);break;case 2:p.blendFunc(p.ONE,p.ONE);break;case 3:p.blendFuncSeparate(p.ZERO,p.ONE_MINUS_SRC_COLOR,p.ZERO,p.ONE);break;case 4:p.blendFuncSeparate(p.ZERO,p.SRC_COLOR,p.ZERO,p.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}else switch(pe){case 1:p.blendFuncSeparate(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA,p.ONE,p.ONE_MINUS_SRC_ALPHA);break;case 2:p.blendFunc(p.SRC_ALPHA,p.ONE);break;case 3:p.blendFuncSeparate(p.ZERO,p.ONE_MINUS_SRC_COLOR,p.ZERO,p.ONE);break;case 4:p.blendFunc(p.ZERO,p.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",pe)}T=null,P=null,D=null,z=null,G.set(0,0,0),Q=0,_=pe,Y=Nt}}else b===!0&&(lt(p.BLEND),b=!1)}function Qe(pe){q!==pe&&(pe?p.frontFace(p.CW):p.frontFace(p.CCW),q=pe)}function Pe(pe){pe!==0?(pt(p.CULL_FACE),pe!==K&&(pe===1?p.cullFace(p.BACK):pe===2?p.cullFace(p.FRONT):p.cullFace(p.FRONT_AND_BACK))):lt(p.CULL_FACE),K=pe}function je(pe,Ve,Ye){pe?(pt(p.POLYGON_OFFSET_FILL),le===Ve&&fe===Ye||(p.polygonOffset(Ve,Ye),le=Ve,fe=Ye)):lt(p.POLYGON_OFFSET_FILL)}return{buffers:{color:t,depth:i,stencil:o},enable:pt,disable:lt,bindFramebuffer:function(pe,Ve){return f[pe]!==Ve&&(p.bindFramebuffer(pe,Ve),f[pe]=Ve,pe===p.DRAW_FRAMEBUFFER&&(f[p.FRAMEBUFFER]=Ve),pe===p.FRAMEBUFFER&&(f[p.DRAW_FRAMEBUFFER]=Ve),!0)},drawBuffers:function(pe,Ve){let Ye=y,Ct=!1;if(pe){Ye=g.get(Ve),Ye===void 0&&(Ye=[],g.set(Ve,Ye));const Ke=pe.textures;if(Ye.length!==Ke.length||Ye[0]!==p.COLOR_ATTACHMENT0){for(let yt=0,bt=Ke.length;yt<bt;yt++)Ye[yt]=p.COLOR_ATTACHMENT0+yt;Ye.length=Ke.length,Ct=!0}}else Ye[0]!==p.BACK&&(Ye[0]=p.BACK,Ct=!0);Ct&&p.drawBuffers(Ye)},useProgram:function(pe){return x!==pe&&(p.useProgram(pe),x=pe,!0)},setBlending:Ce,setMaterial:function(pe,Ve){pe.side===2?lt(p.CULL_FACE):pt(p.CULL_FACE);let Ye=pe.side===1;Ve&&(Ye=!Ye),Qe(Ye),pe.blending===1&&pe.transparent===!1?Ce(0):Ce(pe.blending,pe.blendEquation,pe.blendSrc,pe.blendDst,pe.blendEquationAlpha,pe.blendSrcAlpha,pe.blendDstAlpha,pe.blendColor,pe.blendAlpha,pe.premultipliedAlpha),i.setFunc(pe.depthFunc),i.setTest(pe.depthTest),i.setMask(pe.depthWrite),t.setMask(pe.colorWrite);const Ct=pe.stencilWrite;o.setTest(Ct),Ct&&(o.setMask(pe.stencilWriteMask),o.setFunc(pe.stencilFunc,pe.stencilRef,pe.stencilFuncMask),o.setOp(pe.stencilFail,pe.stencilZFail,pe.stencilZPass)),je(pe.polygonOffset,pe.polygonOffsetFactor,pe.polygonOffsetUnits),pe.alphaToCoverage===!0?pt(p.SAMPLE_ALPHA_TO_COVERAGE):lt(p.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Qe,setCullFace:Pe,setLineWidth:function(pe){pe!==ne&&(de&&p.lineWidth(pe),ne=pe)},setPolygonOffset:je,setScissorTest:function(pe){pe?pt(p.SCISSOR_TEST):lt(p.SCISSOR_TEST)},activeTexture:function(pe){pe===void 0&&(pe=p.TEXTURE0+be-1),Me!==pe&&(p.activeTexture(pe),Me=pe)},bindTexture:function(pe,Ve,Ye){Ye===void 0&&(Ye=Me===null?p.TEXTURE0+be-1:Me);let Ct=_e[Ye];Ct===void 0&&(Ct={type:void 0,texture:void 0},_e[Ye]=Ct),Ct.type===pe&&Ct.texture===Ve||(Me!==Ye&&(p.activeTexture(Ye),Me=Ye),p.bindTexture(pe,Ve||$e[pe]),Ct.type=pe,Ct.texture=Ve)},unbindTexture:function(){const pe=_e[Me];pe!==void 0&&pe.type!==void 0&&(p.bindTexture(pe.type,null),pe.type=void 0,pe.texture=void 0)},compressedTexImage2D:function(){try{p.compressedTexImage2D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexImage3D:function(){try{p.compressedTexImage3D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage2D:function(){try{p.texImage2D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texImage3D:function(){try{p.texImage3D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},updateUBOMapping:function(pe,Ve){let Ye=h.get(Ve);Ye===void 0&&(Ye=new WeakMap,h.set(Ve,Ye));let Ct=Ye.get(pe);Ct===void 0&&(Ct=p.getUniformBlockIndex(Ve,pe.name),Ye.set(pe,Ct))},uniformBlockBinding:function(pe,Ve){const Ye=h.get(Ve).get(pe);l.get(Ve)!==Ye&&(p.uniformBlockBinding(Ve,Ye,pe.__bindingPointIndex),l.set(Ve,Ye))},texStorage2D:function(){try{p.texStorage2D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texStorage3D:function(){try{p.texStorage3D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage2D:function(){try{p.texSubImage2D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},texSubImage3D:function(){try{p.texSubImage3D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexSubImage2D:function(){try{p.compressedTexSubImage2D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},compressedTexSubImage3D:function(){try{p.compressedTexSubImage3D.apply(p,arguments)}catch(pe){console.error("THREE.WebGLState:",pe)}},scissor:function(pe){wt.equals(pe)===!1&&(p.scissor(pe.x,pe.y,pe.z,pe.w),wt.copy(pe))},viewport:function(pe){ft.equals(pe)===!1&&(p.viewport(pe.x,pe.y,pe.z,pe.w),ft.copy(pe))},reset:function(){p.disable(p.BLEND),p.disable(p.CULL_FACE),p.disable(p.DEPTH_TEST),p.disable(p.POLYGON_OFFSET_FILL),p.disable(p.SCISSOR_TEST),p.disable(p.STENCIL_TEST),p.disable(p.SAMPLE_ALPHA_TO_COVERAGE),p.blendEquation(p.FUNC_ADD),p.blendFunc(p.ONE,p.ZERO),p.blendFuncSeparate(p.ONE,p.ZERO,p.ONE,p.ZERO),p.blendColor(0,0,0,0),p.colorMask(!0,!0,!0,!0),p.clearColor(0,0,0,0),p.depthMask(!0),p.depthFunc(p.LESS),p.clearDepth(1),p.stencilMask(4294967295),p.stencilFunc(p.ALWAYS,0,4294967295),p.stencilOp(p.KEEP,p.KEEP,p.KEEP),p.clearStencil(0),p.cullFace(p.BACK),p.frontFace(p.CCW),p.polygonOffset(0,0),p.activeTexture(p.TEXTURE0),p.bindFramebuffer(p.FRAMEBUFFER,null),p.bindFramebuffer(p.DRAW_FRAMEBUFFER,null),p.bindFramebuffer(p.READ_FRAMEBUFFER,null),p.useProgram(null),p.lineWidth(1),p.scissor(0,0,p.canvas.width,p.canvas.height),p.viewport(0,0,p.canvas.width,p.canvas.height),d={},Me=null,_e={},f={},g=new WeakMap,y=[],x=null,b=!1,_=null,w=null,T=null,P=null,U=null,D=null,z=null,G=new fn(0,0,0),Q=0,Y=!1,q=null,K=null,ne=null,le=null,fe=null,wt.set(0,0,p.canvas.width,p.canvas.height),ft.set(0,0,p.canvas.width,p.canvas.height),t.reset(),i.reset(),o.reset()}}}function FL(p,t,i,o){const l=function(h){switch(h){case Rr:case TC:return{byteLength:1,components:1};case vm:case BC:case ss:return{byteLength:2,components:1};case RC:case LC:return{byteLength:2,components:4};case Th:case ay:case Wr:return{byteLength:4,components:1};case RR:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${h}.`)}(o);switch(i){case 1021:case 1024:return p*t;case 1025:return p*t*2;case Bh:case DC:return p*t/l.components*l.byteLength;case ld:case PC:return p*t*2/l.components*l.byteLength;case 1022:return p*t*3/l.components*l.byteLength;case fr:case UC:return p*t*4/l.components*l.byteLength;case oy:case Em:return Math.floor((p+3)/4)*Math.floor((t+3)/4)*8;case ly:case xm:return Math.floor((p+3)/4)*Math.floor((t+3)/4)*16;case NC:case FC:return Math.max(p,16)*Math.max(t,8)/4;case cy:case hy:return Math.max(p,8)*Math.max(t,8)/2;case uy:case dy:return Math.floor((p+3)/4)*Math.floor((t+3)/4)*8;case py:case _m:return Math.floor((p+3)/4)*Math.floor((t+3)/4)*16;case OC:return Math.floor((p+4)/5)*Math.floor((t+3)/4)*16;case kC:return Math.floor((p+4)/5)*Math.floor((t+4)/5)*16;case QC:return Math.floor((p+5)/6)*Math.floor((t+4)/5)*16;case bm:return Math.floor((p+5)/6)*Math.floor((t+5)/6)*16;case GC:return Math.floor((p+7)/8)*Math.floor((t+4)/5)*16;case HC:return Math.floor((p+7)/8)*Math.floor((t+5)/6)*16;case zC:return Math.floor((p+7)/8)*Math.floor((t+7)/8)*16;case VC:return Math.floor((p+9)/10)*Math.floor((t+4)/5)*16;case WC:return Math.floor((p+9)/10)*Math.floor((t+5)/6)*16;case jC:return Math.floor((p+9)/10)*Math.floor((t+7)/8)*16;case qC:return Math.floor((p+9)/10)*Math.floor((t+9)/10)*16;case XC:return Math.floor((p+11)/12)*Math.floor((t+9)/10)*16;case YC:return Math.floor((p+11)/12)*Math.floor((t+11)/12)*16;case Cm:case KC:case JC:return Math.ceil(p/4)*Math.ceil(t/4)*16;case 36283:case $C:return Math.ceil(p/4)*Math.ceil(t/4)*8;case ZC:case ew:return Math.ceil(p/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function T6(p,t,i,o,l,h,d){const f=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,g=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),y=new Hn,x=new WeakMap;let b;const _=new WeakMap;let w=!1;try{w=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function T(he,Z){return w?new OffscreenCanvas(he,Z):Im("canvas")}function P(he,Z,Ce){let Qe=1;const Pe=lt(he);if((Pe.width>Ce||Pe.height>Ce)&&(Qe=Ce/Math.max(Pe.width,Pe.height)),Qe<1){if(typeof HTMLImageElement<"u"&&he instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&he instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&he instanceof ImageBitmap||typeof VideoFrame<"u"&&he instanceof VideoFrame){const je=Math.floor(Qe*Pe.width),pe=Math.floor(Qe*Pe.height);b===void 0&&(b=T(je,pe));const Ve=Z?T(je,pe):b;return Ve.width=je,Ve.height=pe,Ve.getContext("2d").drawImage(he,0,0,je,pe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+je+"x"+pe+")."),Ve}return"data"in he&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),he}return he}function U(he){return he.generateMipmaps&&he.minFilter!==fs&&he.minFilter!==Fi}function D(he){p.generateMipmap(he)}function z(he,Z,Ce,Qe,Pe=!1){if(he!==null){if(p[he]!==void 0)return p[he];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+he+"'")}let je=Z;if(Z===p.RED&&(Ce===p.FLOAT&&(je=p.R32F),Ce===p.HALF_FLOAT&&(je=p.R16F),Ce===p.UNSIGNED_BYTE&&(je=p.R8)),Z===p.RED_INTEGER&&(Ce===p.UNSIGNED_BYTE&&(je=p.R8UI),Ce===p.UNSIGNED_SHORT&&(je=p.R16UI),Ce===p.UNSIGNED_INT&&(je=p.R32UI),Ce===p.BYTE&&(je=p.R8I),Ce===p.SHORT&&(je=p.R16I),Ce===p.INT&&(je=p.R32I)),Z===p.RG&&(Ce===p.FLOAT&&(je=p.RG32F),Ce===p.HALF_FLOAT&&(je=p.RG16F),Ce===p.UNSIGNED_BYTE&&(je=p.RG8)),Z===p.RG_INTEGER&&(Ce===p.UNSIGNED_BYTE&&(je=p.RG8UI),Ce===p.UNSIGNED_SHORT&&(je=p.RG16UI),Ce===p.UNSIGNED_INT&&(je=p.RG32UI),Ce===p.BYTE&&(je=p.RG8I),Ce===p.SHORT&&(je=p.RG16I),Ce===p.INT&&(je=p.RG32I)),Z===p.RGB_INTEGER&&(Ce===p.UNSIGNED_BYTE&&(je=p.RGB8UI),Ce===p.UNSIGNED_SHORT&&(je=p.RGB16UI),Ce===p.UNSIGNED_INT&&(je=p.RGB32UI),Ce===p.BYTE&&(je=p.RGB8I),Ce===p.SHORT&&(je=p.RGB16I),Ce===p.INT&&(je=p.RGB32I)),Z===p.RGBA_INTEGER&&(Ce===p.UNSIGNED_BYTE&&(je=p.RGBA8UI),Ce===p.UNSIGNED_SHORT&&(je=p.RGBA16UI),Ce===p.UNSIGNED_INT&&(je=p.RGBA32UI),Ce===p.BYTE&&(je=p.RGBA8I),Ce===p.SHORT&&(je=p.RGBA16I),Ce===p.INT&&(je=p.RGBA32I)),Z===p.RGB&&Ce===p.UNSIGNED_INT_5_9_9_9_REV&&(je=p.RGB9_E5),Z===p.RGBA){const pe=Pe?my:Si.getTransfer(Qe);Ce===p.FLOAT&&(je=p.RGBA32F),Ce===p.HALF_FLOAT&&(je=p.RGBA16F),Ce===p.UNSIGNED_BYTE&&(je=pe===ar?p.SRGB8_ALPHA8:p.RGBA8),Ce===p.UNSIGNED_SHORT_4_4_4_4&&(je=p.RGBA4),Ce===p.UNSIGNED_SHORT_5_5_5_1&&(je=p.RGB5_A1)}return je!==p.R16F&&je!==p.R32F&&je!==p.RG16F&&je!==p.RG32F&&je!==p.RGBA16F&&je!==p.RGBA32F||t.get("EXT_color_buffer_float"),je}function G(he,Z){let Ce;return he?Z===null||Z===Th||Z===Gp?Ce=p.DEPTH24_STENCIL8:Z===Wr?Ce=p.DEPTH32F_STENCIL8:Z===vm&&(Ce=p.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Z===null||Z===Th||Z===Gp?Ce=p.DEPTH_COMPONENT24:Z===Wr?Ce=p.DEPTH_COMPONENT32F:Z===vm&&(Ce=p.DEPTH_COMPONENT16),Ce}function Q(he,Z){return U(he)===!0||he.isFramebufferTexture&&he.minFilter!==fs&&he.minFilter!==Fi?Math.log2(Math.max(Z.width,Z.height))+1:he.mipmaps!==void 0&&he.mipmaps.length>0?he.mipmaps.length:he.isCompressedTexture&&Array.isArray(he.image)?Z.mipmaps.length:1}function Y(he){const Z=he.target;Z.removeEventListener("dispose",Y),function(Ce){const Qe=o.get(Ce);if(Qe.__webglInit===void 0)return;const Pe=Ce.source,je=_.get(Pe);if(je){const pe=je[Qe.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&K(Ce),Object.keys(je).length===0&&_.delete(Pe)}o.remove(Ce)}(Z),Z.isVideoTexture&&x.delete(Z)}function q(he){const Z=he.target;Z.removeEventListener("dispose",q),function(Ce){const Qe=o.get(Ce);if(Ce.depthTexture&&Ce.depthTexture.dispose(),Ce.isWebGLCubeRenderTarget)for(let je=0;je<6;je++){if(Array.isArray(Qe.__webglFramebuffer[je]))for(let pe=0;pe<Qe.__webglFramebuffer[je].length;pe++)p.deleteFramebuffer(Qe.__webglFramebuffer[je][pe]);else p.deleteFramebuffer(Qe.__webglFramebuffer[je]);Qe.__webglDepthbuffer&&p.deleteRenderbuffer(Qe.__webglDepthbuffer[je])}else{if(Array.isArray(Qe.__webglFramebuffer))for(let je=0;je<Qe.__webglFramebuffer.length;je++)p.deleteFramebuffer(Qe.__webglFramebuffer[je]);else p.deleteFramebuffer(Qe.__webglFramebuffer);if(Qe.__webglDepthbuffer&&p.deleteRenderbuffer(Qe.__webglDepthbuffer),Qe.__webglMultisampledFramebuffer&&p.deleteFramebuffer(Qe.__webglMultisampledFramebuffer),Qe.__webglColorRenderbuffer)for(let je=0;je<Qe.__webglColorRenderbuffer.length;je++)Qe.__webglColorRenderbuffer[je]&&p.deleteRenderbuffer(Qe.__webglColorRenderbuffer[je]);Qe.__webglDepthRenderbuffer&&p.deleteRenderbuffer(Qe.__webglDepthRenderbuffer)}const Pe=Ce.textures;for(let je=0,pe=Pe.length;je<pe;je++){const Ve=o.get(Pe[je]);Ve.__webglTexture&&(p.deleteTexture(Ve.__webglTexture),d.memory.textures--),o.remove(Pe[je])}o.remove(Ce)}(Z)}function K(he){const Z=o.get(he);p.deleteTexture(Z.__webglTexture);const Ce=he.source;delete _.get(Ce)[Z.__cacheKey],d.memory.textures--}let ne=0;function le(he,Z){const Ce=o.get(he);if(he.isVideoTexture&&function(Qe){const Pe=d.render.frame;x.get(Qe)!==Pe&&(x.set(Qe,Pe),Qe.update())}(he),he.isRenderTargetTexture===!1&&he.version>0&&Ce.__version!==he.version){const Qe=he.image;if(Qe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Qe.complete!==!1)return void Me(Ce,he,Z);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(p.TEXTURE_2D,Ce.__webglTexture,p.TEXTURE0+Z)}const fe={[Sl]:p.REPEAT,[rs]:p.CLAMP_TO_EDGE,[kp]:p.MIRRORED_REPEAT},be={[fs]:p.NEAREST,[sy]:p.NEAREST_MIPMAP_NEAREST,[od]:p.NEAREST_MIPMAP_LINEAR,[Fi]:p.LINEAR,[Qp]:p.LINEAR_MIPMAP_NEAREST,[mo]:p.LINEAR_MIPMAP_LINEAR},de={[SG]:p.NEVER,[PG]:p.ALWAYS,[IG]:p.LESS,[BG]:p.LEQUAL,[TG]:p.EQUAL,[DG]:p.GEQUAL,[RG]:p.GREATER,[LG]:p.NOTEQUAL};function Fe(he,Z){if(Z.type!==Wr||t.has("OES_texture_float_linear")!==!1||Z.magFilter!==Fi&&Z.magFilter!==Qp&&Z.magFilter!==od&&Z.magFilter!==mo&&Z.minFilter!==Fi&&Z.minFilter!==Qp&&Z.minFilter!==od&&Z.minFilter!==mo||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),p.texParameteri(he,p.TEXTURE_WRAP_S,fe[Z.wrapS]),p.texParameteri(he,p.TEXTURE_WRAP_T,fe[Z.wrapT]),he!==p.TEXTURE_3D&&he!==p.TEXTURE_2D_ARRAY||p.texParameteri(he,p.TEXTURE_WRAP_R,fe[Z.wrapR]),p.texParameteri(he,p.TEXTURE_MAG_FILTER,be[Z.magFilter]),p.texParameteri(he,p.TEXTURE_MIN_FILTER,be[Z.minFilter]),Z.compareFunction&&(p.texParameteri(he,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE),p.texParameteri(he,p.TEXTURE_COMPARE_FUNC,de[Z.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(Z.magFilter===fs||Z.minFilter!==od&&Z.minFilter!==mo||Z.type===Wr&&t.has("OES_texture_float_linear")===!1)return;if(Z.anisotropy>1||o.get(Z).__currentAnisotropy){const Ce=t.get("EXT_texture_filter_anisotropic");p.texParameterf(he,Ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z.anisotropy,l.getMaxAnisotropy())),o.get(Z).__currentAnisotropy=Z.anisotropy}}}function we(he,Z){let Ce=!1;he.__webglInit===void 0&&(he.__webglInit=!0,Z.addEventListener("dispose",Y));const Qe=Z.source;let Pe=_.get(Qe);Pe===void 0&&(Pe={},_.set(Qe,Pe));const je=function(pe){const Ve=[];return Ve.push(pe.wrapS),Ve.push(pe.wrapT),Ve.push(pe.wrapR||0),Ve.push(pe.magFilter),Ve.push(pe.minFilter),Ve.push(pe.anisotropy),Ve.push(pe.internalFormat),Ve.push(pe.format),Ve.push(pe.type),Ve.push(pe.generateMipmaps),Ve.push(pe.premultiplyAlpha),Ve.push(pe.flipY),Ve.push(pe.unpackAlignment),Ve.push(pe.colorSpace),Ve.join()}(Z);if(je!==he.__cacheKey){Pe[je]===void 0&&(Pe[je]={texture:p.createTexture(),usedTimes:0},d.memory.textures++,Ce=!0),Pe[je].usedTimes++;const pe=Pe[he.__cacheKey];pe!==void 0&&(Pe[he.__cacheKey].usedTimes--,pe.usedTimes===0&&K(Z)),he.__cacheKey=je,he.__webglTexture=Pe[je].texture}return Ce}function Me(he,Z,Ce){let Qe=p.TEXTURE_2D;(Z.isDataArrayTexture||Z.isCompressedArrayTexture)&&(Qe=p.TEXTURE_2D_ARRAY),Z.isData3DTexture&&(Qe=p.TEXTURE_3D);const Pe=we(he,Z),je=Z.source;i.bindTexture(Qe,he.__webglTexture,p.TEXTURE0+Ce);const pe=o.get(je);if(je.version!==pe.__version||Pe===!0){i.activeTexture(p.TEXTURE0+Ce);const Ve=Si.getPrimaries(Si.workingColorSpace),Ye=Z.colorSpace===Sc?null:Si.getPrimaries(Z.colorSpace),Ct=Z.colorSpace===Sc||Ve===Ye?p.NONE:p.BROWSER_DEFAULT_WEBGL;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,Z.flipY),p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),p.pixelStorei(p.UNPACK_ALIGNMENT,Z.unpackAlignment),p.pixelStorei(p.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ct);let Ke=P(Z.image,!1,l.maxTextureSize);Ke=pt(Z,Ke);const yt=h.convert(Z.format,Z.colorSpace),bt=h.convert(Z.type);let ht,Vt=z(Z.internalFormat,yt,bt,Z.colorSpace,Z.isVideoTexture);Fe(Qe,Z);const Nt=Z.mipmaps,nn=Z.isVideoTexture!==!0,k=pe.__version===void 0||Pe===!0,j=je.dataReady,J=Q(Z,Ke);if(Z.isDepthTexture)Vt=G(Z.format===Hp,Z.type),k&&(nn?i.texStorage2D(p.TEXTURE_2D,1,Vt,Ke.width,Ke.height):i.texImage2D(p.TEXTURE_2D,0,Vt,Ke.width,Ke.height,0,yt,bt,null));else if(Z.isDataTexture)if(Nt.length>0){nn&&k&&i.texStorage2D(p.TEXTURE_2D,J,Vt,Nt[0].width,Nt[0].height);for(let Ae=0,ye=Nt.length;Ae<ye;Ae++)ht=Nt[Ae],nn?j&&i.texSubImage2D(p.TEXTURE_2D,Ae,0,0,ht.width,ht.height,yt,bt,ht.data):i.texImage2D(p.TEXTURE_2D,Ae,Vt,ht.width,ht.height,0,yt,bt,ht.data);Z.generateMipmaps=!1}else nn?(k&&i.texStorage2D(p.TEXTURE_2D,J,Vt,Ke.width,Ke.height),j&&i.texSubImage2D(p.TEXTURE_2D,0,0,0,Ke.width,Ke.height,yt,bt,Ke.data)):i.texImage2D(p.TEXTURE_2D,0,Vt,Ke.width,Ke.height,0,yt,bt,Ke.data);else if(Z.isCompressedTexture)if(Z.isCompressedArrayTexture){nn&&k&&i.texStorage3D(p.TEXTURE_2D_ARRAY,J,Vt,Nt[0].width,Nt[0].height,Ke.depth);for(let Ae=0,ye=Nt.length;Ae<ye;Ae++)if(ht=Nt[Ae],Z.format!==fr)if(yt!==null)if(nn){if(j)if(Z.layerUpdates.size>0){const Re=FL(ht.width,ht.height,Z.format,Z.type);for(const rt of Z.layerUpdates){const _t=ht.data.subarray(rt*Re/ht.data.BYTES_PER_ELEMENT,(rt+1)*Re/ht.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(p.TEXTURE_2D_ARRAY,Ae,0,0,rt,ht.width,ht.height,1,yt,_t,0,0)}Z.clearLayerUpdates()}else i.compressedTexSubImage3D(p.TEXTURE_2D_ARRAY,Ae,0,0,0,ht.width,ht.height,Ke.depth,yt,ht.data,0,0)}else i.compressedTexImage3D(p.TEXTURE_2D_ARRAY,Ae,Vt,ht.width,ht.height,Ke.depth,0,ht.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else nn?j&&i.texSubImage3D(p.TEXTURE_2D_ARRAY,Ae,0,0,0,ht.width,ht.height,Ke.depth,yt,bt,ht.data):i.texImage3D(p.TEXTURE_2D_ARRAY,Ae,Vt,ht.width,ht.height,Ke.depth,0,yt,bt,ht.data)}else{nn&&k&&i.texStorage2D(p.TEXTURE_2D,J,Vt,Nt[0].width,Nt[0].height);for(let Ae=0,ye=Nt.length;Ae<ye;Ae++)ht=Nt[Ae],Z.format!==fr?yt!==null?nn?j&&i.compressedTexSubImage2D(p.TEXTURE_2D,Ae,0,0,ht.width,ht.height,yt,ht.data):i.compressedTexImage2D(p.TEXTURE_2D,Ae,Vt,ht.width,ht.height,0,ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):nn?j&&i.texSubImage2D(p.TEXTURE_2D,Ae,0,0,ht.width,ht.height,yt,bt,ht.data):i.texImage2D(p.TEXTURE_2D,Ae,Vt,ht.width,ht.height,0,yt,bt,ht.data)}else if(Z.isDataArrayTexture)if(nn){if(k&&i.texStorage3D(p.TEXTURE_2D_ARRAY,J,Vt,Ke.width,Ke.height,Ke.depth),j)if(Z.layerUpdates.size>0){const Ae=FL(Ke.width,Ke.height,Z.format,Z.type);for(const ye of Z.layerUpdates){const Re=Ke.data.subarray(ye*Ae/Ke.data.BYTES_PER_ELEMENT,(ye+1)*Ae/Ke.data.BYTES_PER_ELEMENT);i.texSubImage3D(p.TEXTURE_2D_ARRAY,0,0,0,ye,Ke.width,Ke.height,1,yt,bt,Re)}Z.clearLayerUpdates()}else i.texSubImage3D(p.TEXTURE_2D_ARRAY,0,0,0,0,Ke.width,Ke.height,Ke.depth,yt,bt,Ke.data)}else i.texImage3D(p.TEXTURE_2D_ARRAY,0,Vt,Ke.width,Ke.height,Ke.depth,0,yt,bt,Ke.data);else if(Z.isData3DTexture)nn?(k&&i.texStorage3D(p.TEXTURE_3D,J,Vt,Ke.width,Ke.height,Ke.depth),j&&i.texSubImage3D(p.TEXTURE_3D,0,0,0,0,Ke.width,Ke.height,Ke.depth,yt,bt,Ke.data)):i.texImage3D(p.TEXTURE_3D,0,Vt,Ke.width,Ke.height,Ke.depth,0,yt,bt,Ke.data);else if(Z.isFramebufferTexture){if(k)if(nn)i.texStorage2D(p.TEXTURE_2D,J,Vt,Ke.width,Ke.height);else{let Ae=Ke.width,ye=Ke.height;for(let Re=0;Re<J;Re++)i.texImage2D(p.TEXTURE_2D,Re,Vt,Ae,ye,0,yt,bt,null),Ae>>=1,ye>>=1}}else if(Nt.length>0){if(nn&&k){const Ae=lt(Nt[0]);i.texStorage2D(p.TEXTURE_2D,J,Vt,Ae.width,Ae.height)}for(let Ae=0,ye=Nt.length;Ae<ye;Ae++)ht=Nt[Ae],nn?j&&i.texSubImage2D(p.TEXTURE_2D,Ae,0,0,yt,bt,ht):i.texImage2D(p.TEXTURE_2D,Ae,Vt,yt,bt,ht);Z.generateMipmaps=!1}else if(nn){if(k){const Ae=lt(Ke);i.texStorage2D(p.TEXTURE_2D,J,Vt,Ae.width,Ae.height)}j&&i.texSubImage2D(p.TEXTURE_2D,0,0,0,yt,bt,Ke)}else i.texImage2D(p.TEXTURE_2D,0,Vt,yt,bt,Ke);U(Z)&&D(Qe),pe.__version=je.version,Z.onUpdate&&Z.onUpdate(Z)}he.__version=Z.version}function _e(he,Z,Ce,Qe,Pe,je){const pe=h.convert(Ce.format,Ce.colorSpace),Ve=h.convert(Ce.type),Ye=z(Ce.internalFormat,pe,Ve,Ce.colorSpace);if(!o.get(Z).__hasExternalTextures){const Ct=Math.max(1,Z.width>>je),Ke=Math.max(1,Z.height>>je);Pe===p.TEXTURE_3D||Pe===p.TEXTURE_2D_ARRAY?i.texImage3D(Pe,je,Ye,Ct,Ke,Z.depth,0,pe,Ve,null):i.texImage2D(Pe,je,Ye,Ct,Ke,0,pe,Ve,null)}i.bindFramebuffer(p.FRAMEBUFFER,he),$e(Z)?f.framebufferTexture2DMultisampleEXT(p.FRAMEBUFFER,Qe,Pe,o.get(Ce).__webglTexture,0,ze(Z)):(Pe===p.TEXTURE_2D||Pe>=p.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=p.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&p.framebufferTexture2D(p.FRAMEBUFFER,Qe,Pe,o.get(Ce).__webglTexture,je),i.bindFramebuffer(p.FRAMEBUFFER,null)}function tt(he,Z,Ce){if(p.bindRenderbuffer(p.RENDERBUFFER,he),Z.depthBuffer){const Qe=Z.depthTexture,Pe=Qe&&Qe.isDepthTexture?Qe.type:null,je=G(Z.stencilBuffer,Pe),pe=Z.stencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT,Ve=ze(Z);$e(Z)?f.renderbufferStorageMultisampleEXT(p.RENDERBUFFER,Ve,je,Z.width,Z.height):Ce?p.renderbufferStorageMultisample(p.RENDERBUFFER,Ve,je,Z.width,Z.height):p.renderbufferStorage(p.RENDERBUFFER,je,Z.width,Z.height),p.framebufferRenderbuffer(p.FRAMEBUFFER,pe,p.RENDERBUFFER,he)}else{const Qe=Z.textures;for(let Pe=0;Pe<Qe.length;Pe++){const je=Qe[Pe],pe=h.convert(je.format,je.colorSpace),Ve=h.convert(je.type),Ye=z(je.internalFormat,pe,Ve,je.colorSpace),Ct=ze(Z);Ce&&$e(Z)===!1?p.renderbufferStorageMultisample(p.RENDERBUFFER,Ct,Ye,Z.width,Z.height):$e(Z)?f.renderbufferStorageMultisampleEXT(p.RENDERBUFFER,Ct,Ye,Z.width,Z.height):p.renderbufferStorage(p.RENDERBUFFER,Ye,Z.width,Z.height)}}p.bindRenderbuffer(p.RENDERBUFFER,null)}function me(he){const Z=o.get(he),Ce=he.isWebGLCubeRenderTarget===!0;if(Z.__boundDepthTexture!==he.depthTexture){const Qe=he.depthTexture;if(Z.__depthDisposeCallback&&Z.__depthDisposeCallback(),Qe){const Pe=()=>{delete Z.__boundDepthTexture,delete Z.__depthDisposeCallback,Qe.removeEventListener("dispose",Pe)};Qe.addEventListener("dispose",Pe),Z.__depthDisposeCallback=Pe}Z.__boundDepthTexture=Qe}if(he.depthTexture&&!Z.__autoAllocateDepthBuffer){if(Ce)throw new Error("target.depthTexture not supported in Cube render targets");(function(Qe,Pe){if(Pe&&Pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(p.FRAMEBUFFER,Qe),!Pe.depthTexture||!Pe.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");o.get(Pe.depthTexture).__webglTexture&&Pe.depthTexture.image.width===Pe.width&&Pe.depthTexture.image.height===Pe.height||(Pe.depthTexture.image.width=Pe.width,Pe.depthTexture.image.height=Pe.height,Pe.depthTexture.needsUpdate=!0),le(Pe.depthTexture,0);const je=o.get(Pe.depthTexture).__webglTexture,pe=ze(Pe);if(Pe.depthTexture.format===ym)$e(Pe)?f.framebufferTexture2DMultisampleEXT(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.TEXTURE_2D,je,0,pe):p.framebufferTexture2D(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.TEXTURE_2D,je,0);else{if(Pe.depthTexture.format!==Hp)throw new Error("Unknown depthTexture format");$e(Pe)?f.framebufferTexture2DMultisampleEXT(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.TEXTURE_2D,je,0,pe):p.framebufferTexture2D(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.TEXTURE_2D,je,0)}})(Z.__webglFramebuffer,he)}else if(Ce){Z.__webglDepthbuffer=[];for(let Qe=0;Qe<6;Qe++)if(i.bindFramebuffer(p.FRAMEBUFFER,Z.__webglFramebuffer[Qe]),Z.__webglDepthbuffer[Qe]===void 0)Z.__webglDepthbuffer[Qe]=p.createRenderbuffer(),tt(Z.__webglDepthbuffer[Qe],he,!1);else{const Pe=he.stencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT,je=Z.__webglDepthbuffer[Qe];p.bindRenderbuffer(p.RENDERBUFFER,je),p.framebufferRenderbuffer(p.FRAMEBUFFER,Pe,p.RENDERBUFFER,je)}}else if(i.bindFramebuffer(p.FRAMEBUFFER,Z.__webglFramebuffer),Z.__webglDepthbuffer===void 0)Z.__webglDepthbuffer=p.createRenderbuffer(),tt(Z.__webglDepthbuffer,he,!1);else{const Qe=he.stencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT,Pe=Z.__webglDepthbuffer;p.bindRenderbuffer(p.RENDERBUFFER,Pe),p.framebufferRenderbuffer(p.FRAMEBUFFER,Qe,p.RENDERBUFFER,Pe)}i.bindFramebuffer(p.FRAMEBUFFER,null)}const wt=[],ft=[];function ze(he){return Math.min(l.maxSamples,he.samples)}function $e(he){const Z=o.get(he);return he.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&Z.__useRenderToTexture!==!1}function pt(he,Z){const Ce=he.colorSpace,Qe=he.format,Pe=he.type;return he.isCompressedTexture===!0||he.isVideoTexture===!0||Ce!==Yi&&Ce!==Sc&&(Si.getTransfer(Ce)===ar?Qe===fr&&Pe===Rr||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ce)),Z}function lt(he){return typeof HTMLImageElement<"u"&&he instanceof HTMLImageElement?(y.width=he.naturalWidth||he.width,y.height=he.naturalHeight||he.height):typeof VideoFrame<"u"&&he instanceof VideoFrame?(y.width=he.displayWidth,y.height=he.displayHeight):(y.width=he.width,y.height=he.height),y}this.allocateTextureUnit=function(){const he=ne;return he>=l.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+he+" texture units while this GPU supports only "+l.maxTextures),ne+=1,he},this.resetTextureUnits=function(){ne=0},this.setTexture2D=le,this.setTexture2DArray=function(he,Z){const Ce=o.get(he);he.version>0&&Ce.__version!==he.version?Me(Ce,he,Z):i.bindTexture(p.TEXTURE_2D_ARRAY,Ce.__webglTexture,p.TEXTURE0+Z)},this.setTexture3D=function(he,Z){const Ce=o.get(he);he.version>0&&Ce.__version!==he.version?Me(Ce,he,Z):i.bindTexture(p.TEXTURE_3D,Ce.__webglTexture,p.TEXTURE0+Z)},this.setTextureCube=function(he,Z){const Ce=o.get(he);he.version>0&&Ce.__version!==he.version?function(Qe,Pe,je){if(Pe.image.length!==6)return;const pe=we(Qe,Pe),Ve=Pe.source;i.bindTexture(p.TEXTURE_CUBE_MAP,Qe.__webglTexture,p.TEXTURE0+je);const Ye=o.get(Ve);if(Ve.version!==Ye.__version||pe===!0){i.activeTexture(p.TEXTURE0+je);const Ct=Si.getPrimaries(Si.workingColorSpace),Ke=Pe.colorSpace===Sc?null:Si.getPrimaries(Pe.colorSpace),yt=Pe.colorSpace===Sc||Ct===Ke?p.NONE:p.BROWSER_DEFAULT_WEBGL;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,Pe.flipY),p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Pe.premultiplyAlpha),p.pixelStorei(p.UNPACK_ALIGNMENT,Pe.unpackAlignment),p.pixelStorei(p.UNPACK_COLORSPACE_CONVERSION_WEBGL,yt);const bt=Pe.isCompressedTexture||Pe.image[0].isCompressedTexture,ht=Pe.image[0]&&Pe.image[0].isDataTexture,Vt=[];for(let _t=0;_t<6;_t++)Vt[_t]=bt||ht?ht?Pe.image[_t].image:Pe.image[_t]:P(Pe.image[_t],!0,l.maxCubemapSize),Vt[_t]=pt(Pe,Vt[_t]);const Nt=Vt[0],nn=h.convert(Pe.format,Pe.colorSpace),k=h.convert(Pe.type),j=z(Pe.internalFormat,nn,k,Pe.colorSpace),J=Pe.isVideoTexture!==!0,Ae=Ye.__version===void 0||pe===!0,ye=Ve.dataReady;let Re,rt=Q(Pe,Nt);if(Fe(p.TEXTURE_CUBE_MAP,Pe),bt){J&&Ae&&i.texStorage2D(p.TEXTURE_CUBE_MAP,rt,j,Nt.width,Nt.height);for(let _t=0;_t<6;_t++){Re=Vt[_t].mipmaps;for(let kt=0;kt<Re.length;kt++){const un=Re[kt];Pe.format!==fr?nn!==null?J?ye&&i.compressedTexSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt,0,0,un.width,un.height,nn,un.data):i.compressedTexImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt,j,un.width,un.height,0,un.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):J?ye&&i.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt,0,0,un.width,un.height,nn,k,un.data):i.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt,j,un.width,un.height,0,nn,k,un.data)}}}else{if(Re=Pe.mipmaps,J&&Ae){Re.length>0&&rt++;const _t=lt(Vt[0]);i.texStorage2D(p.TEXTURE_CUBE_MAP,rt,j,_t.width,_t.height)}for(let _t=0;_t<6;_t++)if(ht){J?ye&&i.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,0,0,Vt[_t].width,Vt[_t].height,nn,k,Vt[_t].data):i.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,j,Vt[_t].width,Vt[_t].height,0,nn,k,Vt[_t].data);for(let kt=0;kt<Re.length;kt++){const un=Re[kt].image[_t].image;J?ye&&i.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt+1,0,0,un.width,un.height,nn,k,un.data):i.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt+1,j,un.width,un.height,0,nn,k,un.data)}}else{J?ye&&i.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,0,0,nn,k,Vt[_t]):i.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,0,j,nn,k,Vt[_t]);for(let kt=0;kt<Re.length;kt++){const un=Re[kt];J?ye&&i.texSubImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt+1,0,0,nn,k,un.image[_t]):i.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+_t,kt+1,j,nn,k,un.image[_t])}}}U(Pe)&&D(p.TEXTURE_CUBE_MAP),Ye.__version=Ve.version,Pe.onUpdate&&Pe.onUpdate(Pe)}Qe.__version=Pe.version}(Ce,he,Z):i.bindTexture(p.TEXTURE_CUBE_MAP,Ce.__webglTexture,p.TEXTURE0+Z)},this.rebindTextures=function(he,Z,Ce){const Qe=o.get(he);Z!==void 0&&_e(Qe.__webglFramebuffer,he,he.texture,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,0),Ce!==void 0&&me(he)},this.setupRenderTarget=function(he){const Z=he.texture,Ce=o.get(he),Qe=o.get(Z);he.addEventListener("dispose",q);const Pe=he.textures,je=he.isWebGLCubeRenderTarget===!0,pe=Pe.length>1;if(pe||(Qe.__webglTexture===void 0&&(Qe.__webglTexture=p.createTexture()),Qe.__version=Z.version,d.memory.textures++),je){Ce.__webglFramebuffer=[];for(let Ve=0;Ve<6;Ve++)if(Z.mipmaps&&Z.mipmaps.length>0){Ce.__webglFramebuffer[Ve]=[];for(let Ye=0;Ye<Z.mipmaps.length;Ye++)Ce.__webglFramebuffer[Ve][Ye]=p.createFramebuffer()}else Ce.__webglFramebuffer[Ve]=p.createFramebuffer()}else{if(Z.mipmaps&&Z.mipmaps.length>0){Ce.__webglFramebuffer=[];for(let Ve=0;Ve<Z.mipmaps.length;Ve++)Ce.__webglFramebuffer[Ve]=p.createFramebuffer()}else Ce.__webglFramebuffer=p.createFramebuffer();if(pe)for(let Ve=0,Ye=Pe.length;Ve<Ye;Ve++){const Ct=o.get(Pe[Ve]);Ct.__webglTexture===void 0&&(Ct.__webglTexture=p.createTexture(),d.memory.textures++)}if(he.samples>0&&$e(he)===!1){Ce.__webglMultisampledFramebuffer=p.createFramebuffer(),Ce.__webglColorRenderbuffer=[],i.bindFramebuffer(p.FRAMEBUFFER,Ce.__webglMultisampledFramebuffer);for(let Ve=0;Ve<Pe.length;Ve++){const Ye=Pe[Ve];Ce.__webglColorRenderbuffer[Ve]=p.createRenderbuffer(),p.bindRenderbuffer(p.RENDERBUFFER,Ce.__webglColorRenderbuffer[Ve]);const Ct=h.convert(Ye.format,Ye.colorSpace),Ke=h.convert(Ye.type),yt=z(Ye.internalFormat,Ct,Ke,Ye.colorSpace,he.isXRRenderTarget===!0),bt=ze(he);p.renderbufferStorageMultisample(p.RENDERBUFFER,bt,yt,he.width,he.height),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0+Ve,p.RENDERBUFFER,Ce.__webglColorRenderbuffer[Ve])}p.bindRenderbuffer(p.RENDERBUFFER,null),he.depthBuffer&&(Ce.__webglDepthRenderbuffer=p.createRenderbuffer(),tt(Ce.__webglDepthRenderbuffer,he,!0)),i.bindFramebuffer(p.FRAMEBUFFER,null)}}if(je){i.bindTexture(p.TEXTURE_CUBE_MAP,Qe.__webglTexture),Fe(p.TEXTURE_CUBE_MAP,Z);for(let Ve=0;Ve<6;Ve++)if(Z.mipmaps&&Z.mipmaps.length>0)for(let Ye=0;Ye<Z.mipmaps.length;Ye++)_e(Ce.__webglFramebuffer[Ve][Ye],he,Z,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,Ye);else _e(Ce.__webglFramebuffer[Ve],he,Z,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,0);U(Z)&&D(p.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(pe){for(let Ve=0,Ye=Pe.length;Ve<Ye;Ve++){const Ct=Pe[Ve],Ke=o.get(Ct);i.bindTexture(p.TEXTURE_2D,Ke.__webglTexture),Fe(p.TEXTURE_2D,Ct),_e(Ce.__webglFramebuffer,he,Ct,p.COLOR_ATTACHMENT0+Ve,p.TEXTURE_2D,0),U(Ct)&&D(p.TEXTURE_2D)}i.unbindTexture()}else{let Ve=p.TEXTURE_2D;if((he.isWebGL3DRenderTarget||he.isWebGLArrayRenderTarget)&&(Ve=he.isWebGL3DRenderTarget?p.TEXTURE_3D:p.TEXTURE_2D_ARRAY),i.bindTexture(Ve,Qe.__webglTexture),Fe(Ve,Z),Z.mipmaps&&Z.mipmaps.length>0)for(let Ye=0;Ye<Z.mipmaps.length;Ye++)_e(Ce.__webglFramebuffer[Ye],he,Z,p.COLOR_ATTACHMENT0,Ve,Ye);else _e(Ce.__webglFramebuffer,he,Z,p.COLOR_ATTACHMENT0,Ve,0);U(Z)&&D(Ve),i.unbindTexture()}he.depthBuffer&&me(he)},this.updateRenderTargetMipmap=function(he){const Z=he.textures;for(let Ce=0,Qe=Z.length;Ce<Qe;Ce++){const Pe=Z[Ce];if(U(Pe)){const je=he.isWebGLCubeRenderTarget?p.TEXTURE_CUBE_MAP:p.TEXTURE_2D,pe=o.get(Pe).__webglTexture;i.bindTexture(je,pe),D(je),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(he){if(he.samples>0){if($e(he)===!1){const Z=he.textures,Ce=he.width,Qe=he.height;let Pe=p.COLOR_BUFFER_BIT;const je=he.stencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT,pe=o.get(he),Ve=Z.length>1;if(Ve)for(let Ye=0;Ye<Z.length;Ye++)i.bindFramebuffer(p.FRAMEBUFFER,pe.__webglMultisampledFramebuffer),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0+Ye,p.RENDERBUFFER,null),i.bindFramebuffer(p.FRAMEBUFFER,pe.__webglFramebuffer),p.framebufferTexture2D(p.DRAW_FRAMEBUFFER,p.COLOR_ATTACHMENT0+Ye,p.TEXTURE_2D,null,0);i.bindFramebuffer(p.READ_FRAMEBUFFER,pe.__webglMultisampledFramebuffer),i.bindFramebuffer(p.DRAW_FRAMEBUFFER,pe.__webglFramebuffer);for(let Ye=0;Ye<Z.length;Ye++){if(he.resolveDepthBuffer&&(he.depthBuffer&&(Pe|=p.DEPTH_BUFFER_BIT),he.stencilBuffer&&he.resolveStencilBuffer&&(Pe|=p.STENCIL_BUFFER_BIT)),Ve){p.framebufferRenderbuffer(p.READ_FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.RENDERBUFFER,pe.__webglColorRenderbuffer[Ye]);const Ct=o.get(Z[Ye]).__webglTexture;p.framebufferTexture2D(p.DRAW_FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,Ct,0)}p.blitFramebuffer(0,0,Ce,Qe,0,0,Ce,Qe,Pe,p.NEAREST),g===!0&&(wt.length=0,ft.length=0,wt.push(p.COLOR_ATTACHMENT0+Ye),he.depthBuffer&&he.resolveDepthBuffer===!1&&(wt.push(je),ft.push(je),p.invalidateFramebuffer(p.DRAW_FRAMEBUFFER,ft)),p.invalidateFramebuffer(p.READ_FRAMEBUFFER,wt))}if(i.bindFramebuffer(p.READ_FRAMEBUFFER,null),i.bindFramebuffer(p.DRAW_FRAMEBUFFER,null),Ve)for(let Ye=0;Ye<Z.length;Ye++){i.bindFramebuffer(p.FRAMEBUFFER,pe.__webglMultisampledFramebuffer),p.framebufferRenderbuffer(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0+Ye,p.RENDERBUFFER,pe.__webglColorRenderbuffer[Ye]);const Ct=o.get(Z[Ye]).__webglTexture;i.bindFramebuffer(p.FRAMEBUFFER,pe.__webglFramebuffer),p.framebufferTexture2D(p.DRAW_FRAMEBUFFER,p.COLOR_ATTACHMENT0+Ye,p.TEXTURE_2D,Ct,0)}i.bindFramebuffer(p.DRAW_FRAMEBUFFER,pe.__webglMultisampledFramebuffer)}else if(he.depthBuffer&&he.resolveDepthBuffer===!1&&g){const Z=he.stencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT;p.invalidateFramebuffer(p.DRAW_FRAMEBUFFER,[Z])}}},this.setupDepthRenderbuffer=me,this.setupFrameBufferTexture=_e,this.useMultisampledRTT=$e}function B6(p,t){return{convert:function(i,o=""){let l;const h=Si.getTransfer(o);if(i===Rr)return p.UNSIGNED_BYTE;if(i===RC)return p.UNSIGNED_SHORT_4_4_4_4;if(i===LC)return p.UNSIGNED_SHORT_5_5_5_1;if(i===RR)return p.UNSIGNED_INT_5_9_9_9_REV;if(i===TC)return p.BYTE;if(i===BC)return p.SHORT;if(i===vm)return p.UNSIGNED_SHORT;if(i===ay)return p.INT;if(i===Th)return p.UNSIGNED_INT;if(i===Wr)return p.FLOAT;if(i===ss)return p.HALF_FLOAT;if(i===1021)return p.ALPHA;if(i===1022)return p.RGB;if(i===fr)return p.RGBA;if(i===1024)return p.LUMINANCE;if(i===1025)return p.LUMINANCE_ALPHA;if(i===ym)return p.DEPTH_COMPONENT;if(i===Hp)return p.DEPTH_STENCIL;if(i===Bh)return p.RED;if(i===DC)return p.RED_INTEGER;if(i===ld)return p.RG;if(i===PC)return p.RG_INTEGER;if(i===UC)return p.RGBA_INTEGER;if(i===oy||i===Em||i===ly||i===xm)if(h===ar){if(l=t.get("WEBGL_compressed_texture_s3tc_srgb"),l===null)return null;if(i===oy)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Em)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===ly)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===xm)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(l=t.get("WEBGL_compressed_texture_s3tc"),l===null)return null;if(i===oy)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Em)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===ly)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===xm)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===cy||i===NC||i===hy||i===FC){if(l=t.get("WEBGL_compressed_texture_pvrtc"),l===null)return null;if(i===cy)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===NC)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===hy)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===FC)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===uy||i===dy||i===py){if(l=t.get("WEBGL_compressed_texture_etc"),l===null)return null;if(i===uy||i===dy)return h===ar?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(i===py)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}if(i===_m||i===OC||i===kC||i===QC||i===bm||i===GC||i===HC||i===zC||i===VC||i===WC||i===jC||i===qC||i===XC||i===YC){if(l=t.get("WEBGL_compressed_texture_astc"),l===null)return null;if(i===_m)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===OC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===kC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===QC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===bm)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===GC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===HC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===zC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===VC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===WC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===jC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===qC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===XC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===YC)return h===ar?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===Cm||i===KC||i===JC){if(l=t.get("EXT_texture_compression_bptc"),l===null)return null;if(i===Cm)return h===ar?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===KC)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===JC)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(i===36283||i===$C||i===ZC||i===ew){if(l=t.get("EXT_texture_compression_rgtc"),l===null)return null;if(i===Cm)return l.COMPRESSED_RED_RGTC1_EXT;if(i===$C)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===ZC)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===ew)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===Gp?p.UNSIGNED_INT_24_8:p[i]!==void 0?p[i]:null}}}class R6 extends vs{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Fh extends $i{constructor(){super(),this.isGroup=!0,this.type="Group"}}const L6={type:"move"};class kw{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Fh,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Fh,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ve,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ve),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Fh,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ve,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ve),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const o of t.hand.values())this._getHandJoint(i,o)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,o){let l=null,h=null,d=null;const f=this._targetRay,g=this._grip,y=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(y&&t.hand){d=!0;for(const P of t.hand.values()){const U=i.getJointPose(P,o),D=this._getHandJoint(y,P);U!==null&&(D.matrix.fromArray(U.transform.matrix),D.matrix.decompose(D.position,D.rotation,D.scale),D.matrixWorldNeedsUpdate=!0,D.jointRadius=U.radius),D.visible=U!==null}const x=y.joints["index-finger-tip"],b=y.joints["thumb-tip"],_=x.position.distanceTo(b.position),w=.02,T=.005;y.inputState.pinching&&_>w+T?(y.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!y.inputState.pinching&&_<=w-T&&(y.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else g!==null&&t.gripSpace&&(h=i.getPose(t.gripSpace,o),h!==null&&(g.matrix.fromArray(h.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,h.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(h.linearVelocity)):g.hasLinearVelocity=!1,h.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(h.angularVelocity)):g.hasAngularVelocity=!1));f!==null&&(l=i.getPose(t.targetRaySpace,o),l===null&&h!==null&&(l=h),l!==null&&(f.matrix.fromArray(l.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,l.linearVelocity?(f.hasLinearVelocity=!0,f.linearVelocity.copy(l.linearVelocity)):f.hasLinearVelocity=!1,l.angularVelocity?(f.hasAngularVelocity=!0,f.angularVelocity.copy(l.angularVelocity)):f.hasAngularVelocity=!1,this.dispatchEvent(L6)))}return f!==null&&(f.visible=l!==null),g!==null&&(g.visible=h!==null),y!==null&&(y.visible=d!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const o=new Fh;o.matrixAutoUpdate=!1,o.visible=!1,t.joints[i.jointName]=o,t.add(o)}return t.joints[i.jointName]}}class D6{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,i,o){if(this.texture===null){const l=new qi;t.properties.get(l).__webglTexture=i.texture,i.depthNear==o.depthNear&&i.depthFar==o.depthFar||(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=l}}getMesh(t){if(this.texture!==null&&this.mesh===null){const i=t.cameras[0].viewport,o=new Ta({vertexShader:`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new Vi(new Fl(20,20),o)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class P6 extends Xo{constructor(t,i){super();const o=this;let l=null,h=1,d=null,f="local-floor",g=1,y=null,x=null,b=null,_=null,w=null,T=null;const P=new D6,U=i.getContextAttributes();let D=null,z=null;const G=[],Q=[],Y=new Hn;let q=null;const K=new vs;K.layers.enable(1),K.viewport=new Oi;const ne=new vs;ne.layers.enable(2),ne.viewport=new Oi;const le=[K,ne],fe=new R6;fe.layers.enable(1),fe.layers.enable(2);let be=null,de=null;function Fe(ze){const $e=Q.indexOf(ze.inputSource);if($e===-1)return;const pt=G[$e];pt!==void 0&&(pt.update(ze.inputSource,ze.frame,y||d),pt.dispatchEvent({type:ze.type,data:ze.inputSource}))}function we(){l.removeEventListener("select",Fe),l.removeEventListener("selectstart",Fe),l.removeEventListener("selectend",Fe),l.removeEventListener("squeeze",Fe),l.removeEventListener("squeezestart",Fe),l.removeEventListener("squeezeend",Fe),l.removeEventListener("end",we),l.removeEventListener("inputsourceschange",Me);for(let ze=0;ze<G.length;ze++){const $e=Q[ze];$e!==null&&(Q[ze]=null,G[ze].disconnect($e))}be=null,de=null,P.reset(),t.setRenderTarget(D),w=null,_=null,b=null,l=null,z=null,ft.stop(),o.isPresenting=!1,t.setPixelRatio(q),t.setSize(Y.width,Y.height,!1),o.dispatchEvent({type:"sessionend"})}function Me(ze){for(let $e=0;$e<ze.removed.length;$e++){const pt=ze.removed[$e],lt=Q.indexOf(pt);lt>=0&&(Q[lt]=null,G[lt].disconnect(pt))}for(let $e=0;$e<ze.added.length;$e++){const pt=ze.added[$e];let lt=Q.indexOf(pt);if(lt===-1){for(let Z=0;Z<G.length;Z++){if(Z>=Q.length){Q.push(pt),lt=Z;break}if(Q[Z]===null){Q[Z]=pt,lt=Z;break}}if(lt===-1)break}const he=G[lt];he&&he.connect(pt)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ze){let $e=G[ze];return $e===void 0&&($e=new kw,G[ze]=$e),$e.getTargetRaySpace()},this.getControllerGrip=function(ze){let $e=G[ze];return $e===void 0&&($e=new kw,G[ze]=$e),$e.getGripSpace()},this.getHand=function(ze){let $e=G[ze];return $e===void 0&&($e=new kw,G[ze]=$e),$e.getHandSpace()},this.setFramebufferScaleFactor=function(ze){h=ze,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ze){f=ze,o.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return y||d},this.setReferenceSpace=function(ze){y=ze},this.getBaseLayer=function(){return _!==null?_:w},this.getBinding=function(){return b},this.getFrame=function(){return T},this.getSession=function(){return l},this.setSession=async function(ze){if(l=ze,l!==null){if(D=t.getRenderTarget(),l.addEventListener("select",Fe),l.addEventListener("selectstart",Fe),l.addEventListener("selectend",Fe),l.addEventListener("squeeze",Fe),l.addEventListener("squeezestart",Fe),l.addEventListener("squeezeend",Fe),l.addEventListener("end",we),l.addEventListener("inputsourceschange",Me),U.xrCompatible!==!0&&await i.makeXRCompatible(),q=t.getPixelRatio(),t.getSize(Y),l.renderState.layers===void 0){const $e={antialias:U.antialias,alpha:!0,depth:U.depth,stencil:U.stencil,framebufferScaleFactor:h};w=new XRWebGLLayer(l,i,$e),l.updateRenderState({baseLayer:w}),t.setPixelRatio(1),t.setSize(w.framebufferWidth,w.framebufferHeight,!1),z=new go(w.framebufferWidth,w.framebufferHeight,{format:fr,type:Rr,colorSpace:t.outputColorSpace,stencilBuffer:U.stencil})}else{let $e=null,pt=null,lt=null;U.depth&&(lt=U.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,$e=U.stencil?Hp:ym,pt=U.stencil?Gp:Th);const he={colorFormat:i.RGBA8,depthFormat:lt,scaleFactor:h};b=new XRWebGLBinding(l,i),_=b.createProjectionLayer(he),l.updateRenderState({layers:[_]}),t.setPixelRatio(1),t.setSize(_.textureWidth,_.textureHeight,!1),z=new go(_.textureWidth,_.textureHeight,{format:fr,type:Rr,depthTexture:new fL(_.textureWidth,_.textureHeight,pt,void 0,void 0,void 0,void 0,void 0,void 0,$e),stencilBuffer:U.stencil,colorSpace:t.outputColorSpace,samples:U.antialias?4:0,resolveDepthBuffer:_.ignoreDepthValues===!1})}z.isXRRenderTarget=!0,this.setFoveation(g),y=null,d=await l.requestReferenceSpace(f),ft.setContext(l),ft.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(l!==null)return l.environmentBlendMode},this.getDepthTexture=function(){return P.getDepthTexture()};const _e=new ve,tt=new ve;function me(ze,$e){$e===null?ze.matrixWorld.copy(ze.matrix):ze.matrixWorld.multiplyMatrices($e.matrixWorld,ze.matrix),ze.matrixWorldInverse.copy(ze.matrixWorld).invert()}this.updateCamera=function(ze){if(l===null)return;let $e=ze.near,pt=ze.far;P.texture!==null&&(P.depthNear>0&&($e=P.depthNear),P.depthFar>0&&(pt=P.depthFar)),fe.near=ne.near=K.near=$e,fe.far=ne.far=K.far=pt,be===fe.near&&de===fe.far||(l.updateRenderState({depthNear:fe.near,depthFar:fe.far}),be=fe.near,de=fe.far);const lt=ze.parent,he=fe.cameras;me(fe,lt);for(let Z=0;Z<he.length;Z++)me(he[Z],lt);he.length===2?function(Z,Ce,Qe){_e.setFromMatrixPosition(Ce.matrixWorld),tt.setFromMatrixPosition(Qe.matrixWorld);const Pe=_e.distanceTo(tt),je=Ce.projectionMatrix.elements,pe=Qe.projectionMatrix.elements,Ve=je[14]/(je[10]-1),Ye=je[14]/(je[10]+1),Ct=(je[9]+1)/je[5],Ke=(je[9]-1)/je[5],yt=(je[8]-1)/je[0],bt=(pe[8]+1)/pe[0],ht=Ve*yt,Vt=Ve*bt,Nt=Pe/(-yt+bt),nn=Nt*-yt;if(Ce.matrixWorld.decompose(Z.position,Z.quaternion,Z.scale),Z.translateX(nn),Z.translateZ(Nt),Z.matrixWorld.compose(Z.position,Z.quaternion,Z.scale),Z.matrixWorldInverse.copy(Z.matrixWorld).invert(),je[10]===-1)Z.projectionMatrix.copy(Ce.projectionMatrix),Z.projectionMatrixInverse.copy(Ce.projectionMatrixInverse);else{const k=Ve+Nt,j=Ye+Nt,J=ht-nn,Ae=Vt+(Pe-nn),ye=Ct*Ye/j*k,Re=Ke*Ye/j*k;Z.projectionMatrix.makePerspective(J,Ae,ye,Re,k,j),Z.projectionMatrixInverse.copy(Z.projectionMatrix).invert()}}(fe,K,ne):fe.projectionMatrix.copy(K.projectionMatrix),function(Z,Ce,Qe){Qe===null?Z.matrix.copy(Ce.matrixWorld):(Z.matrix.copy(Qe.matrixWorld),Z.matrix.invert(),Z.matrix.multiply(Ce.matrixWorld)),Z.matrix.decompose(Z.position,Z.quaternion,Z.scale),Z.updateMatrixWorld(!0),Z.projectionMatrix.copy(Ce.projectionMatrix),Z.projectionMatrixInverse.copy(Ce.projectionMatrixInverse),Z.isPerspectiveCamera&&(Z.fov=2*Yp*Math.atan(1/Z.projectionMatrix.elements[5]),Z.zoom=1)}(ze,fe,lt)},this.getCamera=function(){return fe},this.getFoveation=function(){if(_!==null||w!==null)return g},this.setFoveation=function(ze){g=ze,_!==null&&(_.fixedFoveation=ze),w!==null&&w.fixedFoveation!==void 0&&(w.fixedFoveation=ze)},this.hasDepthSensing=function(){return P.texture!==null},this.getDepthSensingMesh=function(){return P.getMesh(fe)};let wt=null;const ft=new oL;ft.setAnimationLoop(function(ze,$e){if(x=$e.getViewerPose(y||d),T=$e,x!==null){const pt=x.views;w!==null&&(t.setRenderTargetFramebuffer(z,w.framebuffer),t.setRenderTarget(z));let lt=!1;pt.length!==fe.cameras.length&&(fe.cameras.length=0,lt=!0);for(let Z=0;Z<pt.length;Z++){const Ce=pt[Z];let Qe=null;if(w!==null)Qe=w.getViewport(Ce);else{const je=b.getViewSubImage(_,Ce);Qe=je.viewport,Z===0&&(t.setRenderTargetTextures(z,je.colorTexture,_.ignoreDepthValues?void 0:je.depthStencilTexture),t.setRenderTarget(z))}let Pe=le[Z];Pe===void 0&&(Pe=new vs,Pe.layers.enable(Z),Pe.viewport=new Oi,le[Z]=Pe),Pe.matrix.fromArray(Ce.transform.matrix),Pe.matrix.decompose(Pe.position,Pe.quaternion,Pe.scale),Pe.projectionMatrix.fromArray(Ce.projectionMatrix),Pe.projectionMatrixInverse.copy(Pe.projectionMatrix).invert(),Pe.viewport.set(Qe.x,Qe.y,Qe.width,Qe.height),Z===0&&(fe.matrix.copy(Pe.matrix),fe.matrix.decompose(fe.position,fe.quaternion,fe.scale)),lt===!0&&fe.cameras.push(Pe)}const he=l.enabledFeatures;if(he&&he.includes("depth-sensing")){const Z=b.getDepthInformation(pt[0]);Z&&Z.isValid&&Z.texture&&P.init(t,Z,l.renderState)}}for(let pt=0;pt<G.length;pt++){const lt=Q[pt],he=G[pt];lt!==null&&he!==void 0&&he.update(lt,$e,y||d)}wt&&wt(ze,$e),$e.detectedPlanes&&o.dispatchEvent({type:"planesdetected",data:$e}),T=null}),this.setAnimationLoop=function(ze){wt=ze},this.dispose=function(){}}}const md=new _o,U6=new In;function N6(p,t){function i(l,h){l.matrixAutoUpdate===!0&&l.updateMatrix(),h.value.copy(l.matrix)}function o(l,h){l.opacity.value=h.opacity,h.color&&l.diffuse.value.copy(h.color),h.emissive&&l.emissive.value.copy(h.emissive).multiplyScalar(h.emissiveIntensity),h.map&&(l.map.value=h.map,i(h.map,l.mapTransform)),h.alphaMap&&(l.alphaMap.value=h.alphaMap,i(h.alphaMap,l.alphaMapTransform)),h.bumpMap&&(l.bumpMap.value=h.bumpMap,i(h.bumpMap,l.bumpMapTransform),l.bumpScale.value=h.bumpScale,h.side===1&&(l.bumpScale.value*=-1)),h.normalMap&&(l.normalMap.value=h.normalMap,i(h.normalMap,l.normalMapTransform),l.normalScale.value.copy(h.normalScale),h.side===1&&l.normalScale.value.negate()),h.displacementMap&&(l.displacementMap.value=h.displacementMap,i(h.displacementMap,l.displacementMapTransform),l.displacementScale.value=h.displacementScale,l.displacementBias.value=h.displacementBias),h.emissiveMap&&(l.emissiveMap.value=h.emissiveMap,i(h.emissiveMap,l.emissiveMapTransform)),h.specularMap&&(l.specularMap.value=h.specularMap,i(h.specularMap,l.specularMapTransform)),h.alphaTest>0&&(l.alphaTest.value=h.alphaTest);const d=t.get(h),f=d.envMap,g=d.envMapRotation;f&&(l.envMap.value=f,md.copy(g),md.x*=-1,md.y*=-1,md.z*=-1,f.isCubeTexture&&f.isRenderTargetTexture===!1&&(md.y*=-1,md.z*=-1),l.envMapRotation.value.setFromMatrix4(U6.makeRotationFromEuler(md)),l.flipEnvMap.value=f.isCubeTexture&&f.isRenderTargetTexture===!1?-1:1,l.reflectivity.value=h.reflectivity,l.ior.value=h.ior,l.refractionRatio.value=h.refractionRatio),h.lightMap&&(l.lightMap.value=h.lightMap,l.lightMapIntensity.value=h.lightMapIntensity,i(h.lightMap,l.lightMapTransform)),h.aoMap&&(l.aoMap.value=h.aoMap,l.aoMapIntensity.value=h.aoMapIntensity,i(h.aoMap,l.aoMapTransform))}return{refreshFogUniforms:function(l,h){h.color.getRGB(l.fogColor.value,nL(p)),h.isFog?(l.fogNear.value=h.near,l.fogFar.value=h.far):h.isFogExp2&&(l.fogDensity.value=h.density)},refreshMaterialUniforms:function(l,h,d,f,g){h.isMeshBasicMaterial||h.isMeshLambertMaterial?o(l,h):h.isMeshToonMaterial?(o(l,h),function(y,x){x.gradientMap&&(y.gradientMap.value=x.gradientMap)}(l,h)):h.isMeshPhongMaterial?(o(l,h),function(y,x){y.specular.value.copy(x.specular),y.shininess.value=Math.max(x.shininess,1e-4)}(l,h)):h.isMeshStandardMaterial?(o(l,h),function(y,x){y.metalness.value=x.metalness,x.metalnessMap&&(y.metalnessMap.value=x.metalnessMap,i(x.metalnessMap,y.metalnessMapTransform)),y.roughness.value=x.roughness,x.roughnessMap&&(y.roughnessMap.value=x.roughnessMap,i(x.roughnessMap,y.roughnessMapTransform)),x.envMap&&(y.envMapIntensity.value=x.envMapIntensity)}(l,h),h.isMeshPhysicalMaterial&&function(y,x,b){y.ior.value=x.ior,x.sheen>0&&(y.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),y.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(y.sheenColorMap.value=x.sheenColorMap,i(x.sheenColorMap,y.sheenColorMapTransform)),x.sheenRoughnessMap&&(y.sheenRoughnessMap.value=x.sheenRoughnessMap,i(x.sheenRoughnessMap,y.sheenRoughnessMapTransform))),x.clearcoat>0&&(y.clearcoat.value=x.clearcoat,y.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(y.clearcoatMap.value=x.clearcoatMap,i(x.clearcoatMap,y.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,i(x.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(y.clearcoatNormalMap.value=x.clearcoatNormalMap,i(x.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===1&&y.clearcoatNormalScale.value.negate())),x.dispersion>0&&(y.dispersion.value=x.dispersion),x.iridescence>0&&(y.iridescence.value=x.iridescence,y.iridescenceIOR.value=x.iridescenceIOR,y.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(y.iridescenceMap.value=x.iridescenceMap,i(x.iridescenceMap,y.iridescenceMapTransform)),x.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=x.iridescenceThicknessMap,i(x.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),x.transmission>0&&(y.transmission.value=x.transmission,y.transmissionSamplerMap.value=b.texture,y.transmissionSamplerSize.value.set(b.width,b.height),x.transmissionMap&&(y.transmissionMap.value=x.transmissionMap,i(x.transmissionMap,y.transmissionMapTransform)),y.thickness.value=x.thickness,x.thicknessMap&&(y.thicknessMap.value=x.thicknessMap,i(x.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=x.attenuationDistance,y.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(y.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(y.anisotropyMap.value=x.anisotropyMap,i(x.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=x.specularIntensity,y.specularColor.value.copy(x.specularColor),x.specularColorMap&&(y.specularColorMap.value=x.specularColorMap,i(x.specularColorMap,y.specularColorMapTransform)),x.specularIntensityMap&&(y.specularIntensityMap.value=x.specularIntensityMap,i(x.specularIntensityMap,y.specularIntensityMapTransform))}(l,h,g)):h.isMeshMatcapMaterial?(o(l,h),function(y,x){x.matcap&&(y.matcap.value=x.matcap)}(l,h)):h.isMeshDepthMaterial?o(l,h):h.isMeshDistanceMaterial?(o(l,h),function(y,x){const b=t.get(x).light;y.referencePosition.value.setFromMatrixPosition(b.matrixWorld),y.nearDistance.value=b.shadow.camera.near,y.farDistance.value=b.shadow.camera.far}(l,h)):h.isMeshNormalMaterial?o(l,h):h.isLineBasicMaterial?(function(y,x){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,x.map&&(y.map.value=x.map,i(x.map,y.mapTransform))}(l,h),h.isLineDashedMaterial&&function(y,x){y.dashSize.value=x.dashSize,y.totalSize.value=x.dashSize+x.gapSize,y.scale.value=x.scale}(l,h)):h.isPointsMaterial?function(y,x,b,_){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,y.size.value=x.size*b,y.scale.value=.5*_,x.map&&(y.map.value=x.map,i(x.map,y.uvTransform)),x.alphaMap&&(y.alphaMap.value=x.alphaMap,i(x.alphaMap,y.alphaMapTransform)),x.alphaTest>0&&(y.alphaTest.value=x.alphaTest)}(l,h,d,f):h.isSpriteMaterial?function(y,x){y.diffuse.value.copy(x.color),y.opacity.value=x.opacity,y.rotation.value=x.rotation,x.map&&(y.map.value=x.map,i(x.map,y.mapTransform)),x.alphaMap&&(y.alphaMap.value=x.alphaMap,i(x.alphaMap,y.alphaMapTransform)),x.alphaTest>0&&(y.alphaTest.value=x.alphaTest)}(l,h):h.isShadowMaterial?(l.color.value.copy(h.color),l.opacity.value=h.opacity):h.isShaderMaterial&&(h.uniformsNeedUpdate=!1)}}}function F6(p,t,i,o){let l={},h={},d=[];const f=p.getParameter(p.MAX_UNIFORM_BUFFER_BINDINGS);function g(b,_,w,T){const P=b.value,U=_+"_"+w;if(T[U]===void 0)return T[U]=typeof P=="number"||typeof P=="boolean"?P:P.clone(),!0;{const D=T[U];if(typeof P=="number"||typeof P=="boolean"){if(D!==P)return T[U]=P,!0}else if(D.equals(P)===!1)return D.copy(P),!0}return!1}function y(b){const _={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(_.boundary=4,_.storage=4):b.isVector2?(_.boundary=8,_.storage=8):b.isVector3||b.isColor?(_.boundary=16,_.storage=12):b.isVector4?(_.boundary=16,_.storage=16):b.isMatrix3?(_.boundary=48,_.storage=48):b.isMatrix4?(_.boundary=64,_.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),_}function x(b){const _=b.target;_.removeEventListener("dispose",x);const w=d.indexOf(_.__bindingPointIndex);d.splice(w,1),p.deleteBuffer(l[_.id]),delete l[_.id],delete h[_.id]}return{bind:function(b,_){const w=_.program;o.uniformBlockBinding(b,w)},update:function(b,_){let w=l[b.id];w===void 0&&(function(U){const D=U.uniforms;let z=0;const G=16;for(let Y=0,q=D.length;Y<q;Y++){const K=Array.isArray(D[Y])?D[Y]:[D[Y]];for(let ne=0,le=K.length;ne<le;ne++){const fe=K[ne],be=Array.isArray(fe.value)?fe.value:[fe.value];for(let de=0,Fe=be.length;de<Fe;de++){const we=y(be[de]),Me=z%G,_e=Me%we.boundary,tt=Me+_e;z+=_e,tt!==0&&G-tt<we.storage&&(z+=G-tt),fe.__data=new Float32Array(we.storage/Float32Array.BYTES_PER_ELEMENT),fe.__offset=z,z+=we.storage}}}const Q=z%G;Q>0&&(z+=G-Q),U.__size=z,U.__cache={}}(b),w=function(U){const D=function(){for(let Y=0;Y<f;Y++)if(d.indexOf(Y)===-1)return d.push(Y),Y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();U.__bindingPointIndex=D;const z=p.createBuffer(),G=U.__size,Q=U.usage;return p.bindBuffer(p.UNIFORM_BUFFER,z),p.bufferData(p.UNIFORM_BUFFER,G,Q),p.bindBuffer(p.UNIFORM_BUFFER,null),p.bindBufferBase(p.UNIFORM_BUFFER,D,z),z}(b),l[b.id]=w,b.addEventListener("dispose",x));const T=_.program;o.updateUBOMapping(b,T);const P=t.render.frame;h[b.id]!==P&&(function(U){const D=l[U.id],z=U.uniforms,G=U.__cache;p.bindBuffer(p.UNIFORM_BUFFER,D);for(let Q=0,Y=z.length;Q<Y;Q++){const q=Array.isArray(z[Q])?z[Q]:[z[Q]];for(let K=0,ne=q.length;K<ne;K++){const le=q[K];if(g(le,Q,K,G)===!0){const fe=le.__offset,be=Array.isArray(le.value)?le.value:[le.value];let de=0;for(let Fe=0;Fe<be.length;Fe++){const we=be[Fe],Me=y(we);typeof we=="number"||typeof we=="boolean"?(le.__data[0]=we,p.bufferSubData(p.UNIFORM_BUFFER,fe+de,le.__data)):we.isMatrix3?(le.__data[0]=we.elements[0],le.__data[1]=we.elements[1],le.__data[2]=we.elements[2],le.__data[3]=0,le.__data[4]=we.elements[3],le.__data[5]=we.elements[4],le.__data[6]=we.elements[5],le.__data[7]=0,le.__data[8]=we.elements[6],le.__data[9]=we.elements[7],le.__data[10]=we.elements[8],le.__data[11]=0):(we.toArray(le.__data,de),de+=Me.storage/Float32Array.BYTES_PER_ELEMENT)}p.bufferSubData(p.UNIFORM_BUFFER,fe,le.__data)}}}p.bindBuffer(p.UNIFORM_BUFFER,null)}(b),h[b.id]=P)},dispose:function(){for(const b in l)p.deleteBuffer(l[b]);d=[],l={},h={}}}}class Qw{constructor(t={}){const{canvas:i=UG(),context:o=null,depth:l=!0,stencil:h=!1,alpha:d=!1,antialias:f=!1,premultipliedAlpha:g=!0,preserveDrawingBuffer:y=!1,powerPreference:x="default",failIfMajorPerformanceCaveat:b=!1}=t;let _;if(this.isWebGLRenderer=!0,o!==null){if(typeof WebGLRenderingContext<"u"&&o instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");_=o.getContextAttributes().alpha}else _=d;const w=new Uint32Array(4),T=new Int32Array(4);let P=null,U=null;const D=[],z=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=sr,this.toneMapping=0,this.toneMappingExposure=1;const G=this;let Q=!1,Y=0,q=0,K=null,ne=-1,le=null;const fe=new Oi,be=new Oi;let de=null;const Fe=new fn(0);let we=0,Me=i.width,_e=i.height,tt=1,me=null,wt=null;const ft=new Oi(0,0,Me,_e),ze=new Oi(0,0,Me,_e);let $e=!1;const pt=new Bw;let lt=!1,he=!1;const Z=new In,Ce=new In,Qe=new ve,Pe=new Oi,je={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let pe=!1;function Ve(){return K===null?tt:1}let Ye,Ct,Ke,yt,bt,ht,Vt,Nt,nn,k,j,J,Ae,ye,Re,rt,_t,kt,un,Jn,Ri,Xr,da,$a,De=o;function pa(ue,Ge){return i.getContext(ue,Ge)}try{const ue={alpha:!0,depth:l,stencil:h,antialias:f,premultipliedAlpha:g,preserveDrawingBuffer:y,powerPreference:x,failIfMajorPerformanceCaveat:b};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${ny}`),i.addEventListener("webglcontextlost",Yh,!1),i.addEventListener("webglcontextrestored",Nd,!1),i.addEventListener("webglcontextcreationerror",Kh,!1),De===null){const Ge="webgl2";if(De=pa(Ge,ue),De===null)throw pa(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ue){throw console.error("THREE.WebGLRenderer: "+ue.message),ue}function sl(){Ye=new cH(De),Ye.init(),Xr=new B6(De,Ye),Ct=new sH(De,Ye,t,Xr),Ke=new I6(De),Ct.reverseDepthBuffer&&Ke.buffers.depth.setReversed(!0),yt=new dH(De),bt=new g6,ht=new T6(De,Ye,Ke,bt,Ct,Xr,yt),Vt=new oH(G),Nt=new lH(G),nn=new eH(De),da=new iH(De,nn),k=new hH(De,nn,yt,da),j=new AH(De,k,nn,yt),un=new pH(De,Ct,ht),rt=new aH(bt),J=new m6(G,Vt,Nt,Ye,Ct,da,rt),Ae=new N6(G,bt),ye=new y6,Re=new C6(Ye),kt=new nH(G,Vt,Nt,Ke,j,_,g),_t=new M6(G,j,Ct),$a=new F6(De,yt,Ct,Ke),Jn=new rH(De,Ye,yt),Ri=new uH(De,Ye,yt),yt.programs=J.programs,G.capabilities=Ct,G.extensions=Ye,G.properties=bt,G.renderLists=ye,G.shadowMap=_t,G.state=Ke,G.info=yt}sl();const cr=new P6(G,De);function Yh(ue){ue.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Q=!0}function Nd(){console.log("THREE.WebGLRenderer: Context Restored."),Q=!1;const ue=yt.autoReset,Ge=_t.enabled,qe=_t.autoUpdate,ot=_t.needsUpdate,He=_t.type;sl(),yt.autoReset=ue,_t.enabled=Ge,_t.autoUpdate=qe,_t.needsUpdate=ot,_t.type=He}function Kh(ue){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ue.statusMessage)}function Ql(ue){const Ge=ue.target;Ge.removeEventListener("dispose",Ql),function(qe){(function(ot){const He=bt.get(ot).programs;He!==void 0&&(He.forEach(function(ut){J.releaseProgram(ut)}),ot.isShaderMaterial&&J.releaseShaderCache(ot))})(qe),bt.remove(qe)}(Ge)}function Za(ue,Ge,qe){ue.transparent===!0&&ue.side===2&&ue.forceSinglePass===!1?(ue.side=1,ue.needsUpdate=!0,zl(ue,Ge,qe),ue.side=0,ue.needsUpdate=!0,zl(ue,Ge,qe),ue.side=2):zl(ue,Ge,qe)}this.xr=cr,this.getContext=function(){return De},this.getContextAttributes=function(){return De.getContextAttributes()},this.forceContextLoss=function(){const ue=Ye.get("WEBGL_lose_context");ue&&ue.loseContext()},this.forceContextRestore=function(){const ue=Ye.get("WEBGL_lose_context");ue&&ue.restoreContext()},this.getPixelRatio=function(){return tt},this.setPixelRatio=function(ue){ue!==void 0&&(tt=ue,this.setSize(Me,_e,!1))},this.getSize=function(ue){return ue.set(Me,_e)},this.setSize=function(ue,Ge,qe=!0){cr.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Me=ue,_e=Ge,i.width=Math.floor(ue*tt),i.height=Math.floor(Ge*tt),qe===!0&&(i.style.width=ue+"px",i.style.height=Ge+"px"),this.setViewport(0,0,ue,Ge))},this.getDrawingBufferSize=function(ue){return ue.set(Me*tt,_e*tt).floor()},this.setDrawingBufferSize=function(ue,Ge,qe){Me=ue,_e=Ge,tt=qe,i.width=Math.floor(ue*qe),i.height=Math.floor(Ge*qe),this.setViewport(0,0,ue,Ge)},this.getCurrentViewport=function(ue){return ue.copy(fe)},this.getViewport=function(ue){return ue.copy(ft)},this.setViewport=function(ue,Ge,qe,ot){ue.isVector4?ft.set(ue.x,ue.y,ue.z,ue.w):ft.set(ue,Ge,qe,ot),Ke.viewport(fe.copy(ft).multiplyScalar(tt).round())},this.getScissor=function(ue){return ue.copy(ze)},this.setScissor=function(ue,Ge,qe,ot){ue.isVector4?ze.set(ue.x,ue.y,ue.z,ue.w):ze.set(ue,Ge,qe,ot),Ke.scissor(be.copy(ze).multiplyScalar(tt).round())},this.getScissorTest=function(){return $e},this.setScissorTest=function(ue){Ke.setScissorTest($e=ue)},this.setOpaqueSort=function(ue){me=ue},this.setTransparentSort=function(ue){wt=ue},this.getClearColor=function(ue){return ue.copy(kt.getClearColor())},this.setClearColor=function(){kt.setClearColor.apply(kt,arguments)},this.getClearAlpha=function(){return kt.getClearAlpha()},this.setClearAlpha=function(){kt.setClearAlpha.apply(kt,arguments)},this.clear=function(ue=!0,Ge=!0,qe=!0){let ot=0;if(ue){let He=!1;if(K!==null){const ut=K.texture.format;He=ut===UC||ut===PC||ut===DC}if(He){const ut=K.texture.type,Lt=ut===Rr||ut===Th||ut===vm||ut===Gp||ut===RC||ut===LC,Dt=kt.getClearColor(),Yt=kt.getClearAlpha(),rn=Dt.r,An=Dt.g,dn=Dt.b;Lt?(w[0]=rn,w[1]=An,w[2]=dn,w[3]=Yt,De.clearBufferuiv(De.COLOR,0,w)):(T[0]=rn,T[1]=An,T[2]=dn,T[3]=Yt,De.clearBufferiv(De.COLOR,0,T))}else ot|=De.COLOR_BUFFER_BIT}Ge&&(ot|=De.DEPTH_BUFFER_BIT,De.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),qe&&(ot|=De.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),De.clear(ot)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Yh,!1),i.removeEventListener("webglcontextrestored",Nd,!1),i.removeEventListener("webglcontextcreationerror",Kh,!1),ye.dispose(),Re.dispose(),bt.dispose(),Vt.dispose(),Nt.dispose(),j.dispose(),da.dispose(),$a.dispose(),J.dispose(),cr.dispose(),cr.removeEventListener("sessionstart",qc),cr.removeEventListener("sessionend",Fd),Qi.stop()},this.renderBufferDirect=function(ue,Ge,qe,ot,He,ut){Ge===null&&(Ge=je);const Lt=He.isMesh&&He.matrixWorld.determinant()<0,Dt=function($n,Gi,vr,Ln,xn){Gi.isScene!==!0&&(Gi=je),ht.resetTextureUnits();const xs=Gi.fog,Vl=Ln.isMeshStandardMaterial?Gi.environment:null,Wl=K===null?G.outputColorSpace:K.isXRRenderTarget===!0?K.texture.colorSpace:Yi,ol=(Ln.isMeshStandardMaterial?Nt:Vt).get(Ln.envMap||Vl),Ws=Ln.vertexColors===!0&&!!vr.attributes.color&&vr.attributes.color.itemSize===4,ls=!!vr.attributes.tangent&&(!!Ln.normalMap||Ln.anisotropy>0),eo=!!vr.morphAttributes.position,_s=!!vr.morphAttributes.normal,Yc=!!vr.morphAttributes.color;let jl=0;Ln.toneMapped&&(K!==null&&K.isXRRenderTarget!==!0||(jl=G.toneMapping));const Rs=vr.morphAttributes.position||vr.morphAttributes.normal||vr.morphAttributes.color,to=Rs!==void 0?Rs.length:0,Bn=bt.get(Ln),Da=U.state.lights;if(lt===!0&&(he===!0||$n!==le)){const Lr=$n===le&&Ln.id===ne;rt.setState(Ln,$n,Lr)}let Qr=!1;Ln.version===Bn.__version?Bn.needsLights&&Bn.lightsStateVersion!==Da.state.version||Bn.outputColorSpace!==Wl||xn.isBatchedMesh&&Bn.batching===!1?Qr=!0:xn.isBatchedMesh||Bn.batching!==!0?xn.isBatchedMesh&&Bn.batchingColor===!0&&xn.colorTexture===null||xn.isBatchedMesh&&Bn.batchingColor===!1&&xn.colorTexture!==null||xn.isInstancedMesh&&Bn.instancing===!1?Qr=!0:xn.isInstancedMesh||Bn.instancing!==!0?xn.isSkinnedMesh&&Bn.skinning===!1?Qr=!0:xn.isSkinnedMesh||Bn.skinning!==!0?xn.isInstancedMesh&&Bn.instancingColor===!0&&xn.instanceColor===null||xn.isInstancedMesh&&Bn.instancingColor===!1&&xn.instanceColor!==null||xn.isInstancedMesh&&Bn.instancingMorph===!0&&xn.morphTexture===null||xn.isInstancedMesh&&Bn.instancingMorph===!1&&xn.morphTexture!==null||Bn.envMap!==ol||Ln.fog===!0&&Bn.fog!==xs?Qr=!0:Bn.numClippingPlanes===void 0||Bn.numClippingPlanes===rt.numPlanes&&Bn.numIntersection===rt.numIntersection?(Bn.vertexAlphas!==Ws||Bn.vertexTangents!==ls||Bn.morphTargets!==eo||Bn.morphNormals!==_s||Bn.morphColors!==Yc||Bn.toneMapping!==jl||Bn.morphTargetsCount!==to)&&(Qr=!0):Qr=!0:Qr=!0:Qr=!0:Qr=!0:(Qr=!0,Bn.__version=Ln.version);let cs=Bn.currentProgram;Qr===!0&&(cs=zl(Ln,Gi,xn));let Aa=!1,fa=!1,Co=!1;const di=cs.getUniforms(),bs=Bn.uniforms;if(Ke.useProgram(cs.program)&&(Aa=!0,fa=!0,Co=!0),Ln.id!==ne&&(ne=Ln.id,fa=!0),Aa||le!==$n){Ct.reverseDepthBuffer?(Z.copy($n.projectionMatrix),function(ma){const _i=ma.elements;_i[2]=.5*_i[2]+.5*_i[3],_i[6]=.5*_i[6]+.5*_i[7],_i[10]=.5*_i[10]+.5*_i[11],_i[14]=.5*_i[14]+.5*_i[15]}(Z),function(ma){const _i=ma.elements;_i[11]===-1?(_i[10]=-_i[10]-1,_i[14]=-_i[14]):(_i[10]=-_i[10],_i[14]=1-_i[14])}(Z),di.setValue(De,"projectionMatrix",Z)):di.setValue(De,"projectionMatrix",$n.projectionMatrix),di.setValue(De,"viewMatrix",$n.matrixWorldInverse);const Lr=di.map.cameraPosition;Lr!==void 0&&Lr.setValue(De,Qe.setFromMatrixPosition($n.matrixWorld)),Ct.logarithmicDepthBuffer&&di.setValue(De,"logDepthBufFC",2/(Math.log($n.far+1)/Math.LN2)),(Ln.isMeshPhongMaterial||Ln.isMeshToonMaterial||Ln.isMeshLambertMaterial||Ln.isMeshBasicMaterial||Ln.isMeshStandardMaterial||Ln.isShaderMaterial)&&di.setValue(De,"isOrthographic",$n.isOrthographicCamera===!0),le!==$n&&(le=$n,fa=!0,Co=!0)}if(xn.isSkinnedMesh){di.setOptional(De,xn,"bindMatrix"),di.setOptional(De,xn,"bindMatrixInverse");const Lr=xn.skeleton;Lr&&(Lr.boneTexture===null&&Lr.computeBoneTexture(),di.setValue(De,"boneTexture",Lr.boneTexture,ht))}xn.isBatchedMesh&&(di.setOptional(De,xn,"batchingTexture"),di.setValue(De,"batchingTexture",xn._matricesTexture,ht),di.setOptional(De,xn,"batchingIdTexture"),di.setValue(De,"batchingIdTexture",xn._indirectTexture,ht),di.setOptional(De,xn,"batchingColorTexture"),xn._colorsTexture!==null&&di.setValue(De,"batchingColorTexture",xn._colorsTexture,ht));const Ls=vr.morphAttributes;Ls.position===void 0&&Ls.normal===void 0&&Ls.color===void 0||un.update(xn,vr,cs),(fa||Bn.receiveShadow!==xn.receiveShadow)&&(Bn.receiveShadow=xn.receiveShadow,di.setValue(De,"receiveShadow",xn.receiveShadow)),Ln.isMeshGouraudMaterial&&Ln.envMap!==null&&(bs.envMap.value=ol,bs.flipEnvMap.value=ol.isCubeTexture&&ol.isRenderTargetTexture===!1?-1:1),Ln.isMeshStandardMaterial&&Ln.envMap===null&&Gi.environment!==null&&(bs.envMapIntensity.value=Gi.environmentIntensity),fa&&(di.setValue(De,"toneMappingExposure",G.toneMappingExposure),Bn.needsLights&&(ur=Co,(Yr=bs).ambientLightColor.needsUpdate=ur,Yr.lightProbe.needsUpdate=ur,Yr.directionalLights.needsUpdate=ur,Yr.directionalLightShadows.needsUpdate=ur,Yr.pointLights.needsUpdate=ur,Yr.pointLightShadows.needsUpdate=ur,Yr.spotLights.needsUpdate=ur,Yr.spotLightShadows.needsUpdate=ur,Yr.rectAreaLights.needsUpdate=ur,Yr.hemisphereLights.needsUpdate=ur),xs&&Ln.fog===!0&&Ae.refreshFogUniforms(bs,xs),Ae.refreshMaterialUniforms(bs,Ln,tt,_e,U.state.transmissionRenderTarget[$n.id]),zy.upload(De,al(Bn),bs,ht));var Yr,ur;if(Ln.isShaderMaterial&&Ln.uniformsNeedUpdate===!0&&(zy.upload(De,al(Bn),bs,ht),Ln.uniformsNeedUpdate=!1),Ln.isSpriteMaterial&&di.setValue(De,"center",xn.center),di.setValue(De,"modelViewMatrix",xn.modelViewMatrix),di.setValue(De,"normalMatrix",xn.normalMatrix),di.setValue(De,"modelMatrix",xn.matrixWorld),Ln.isShaderMaterial||Ln.isRawShaderMaterial){const Lr=Ln.uniformsGroups;for(let ma=0,_i=Lr.length;ma<_i;ma++){const Kc=Lr[ma];$a.update(Kc,cs),$a.bind(Kc,cs)}}return cs}(ue,Ge,qe,ot,He);Ke.setMaterial(ot,Lt);let Yt=qe.index,rn=1;if(ot.wireframe===!0){if(Yt=k.getWireframeAttribute(qe),Yt===void 0)return;rn=2}const An=qe.drawRange,dn=qe.attributes.position;let Tn=An.start*rn,Ki=(An.start+An.count)*rn;ut!==null&&(Tn=Math.max(Tn,ut.start*rn),Ki=Math.min(Ki,(ut.start+ut.count)*rn)),Yt!==null?(Tn=Math.max(Tn,0),Ki=Math.min(Ki,Yt.count)):dn!=null&&(Tn=Math.max(Tn,0),Ki=Math.min(Ki,dn.count));const ui=Ki-Tn;if(ui<0||ui===1/0)return;let tr;da.setup(He,ot,Dt,qe,Yt);let Li=Jn;if(Yt!==null&&(tr=nn.get(Yt),Li=Ri,Li.setIndex(tr)),He.isMesh)ot.wireframe===!0?(Ke.setLineWidth(ot.wireframeLinewidth*Ve()),Li.setMode(De.LINES)):Li.setMode(De.TRIANGLES);else if(He.isLine){let $n=ot.linewidth;$n===void 0&&($n=1),Ke.setLineWidth($n*Ve()),He.isLineSegments?Li.setMode(De.LINES):He.isLineLoop?Li.setMode(De.LINE_LOOP):Li.setMode(De.LINE_STRIP)}else He.isPoints?Li.setMode(De.POINTS):He.isSprite&&Li.setMode(De.TRIANGLES);if(He.isBatchedMesh)if(He._multiDrawInstances!==null)Li.renderMultiDrawInstances(He._multiDrawStarts,He._multiDrawCounts,He._multiDrawCount,He._multiDrawInstances);else if(Ye.get("WEBGL_multi_draw"))Li.renderMultiDraw(He._multiDrawStarts,He._multiDrawCounts,He._multiDrawCount);else{const $n=He._multiDrawStarts,Gi=He._multiDrawCounts,vr=He._multiDrawCount,Ln=Yt?nn.get(Yt).bytesPerElement:1,xn=bt.get(ot).currentProgram.getUniforms();for(let xs=0;xs<vr;xs++)xn.setValue(De,"_gl_DrawID",xs),Li.render($n[xs]/Ln,Gi[xs])}else if(He.isInstancedMesh)Li.renderInstances(Tn,ui,He.count);else if(qe.isInstancedBufferGeometry){const $n=qe._maxInstanceCount!==void 0?qe._maxInstanceCount:1/0,Gi=Math.min(qe.instanceCount,$n);Li.renderInstances(Tn,ui,Gi)}else Li.render(Tn,ui)},this.compile=function(ue,Ge,qe=null){qe===null&&(qe=ue),U=Re.get(qe),U.init(Ge),z.push(U),qe.traverseVisible(function(He){He.isLight&&He.layers.test(Ge.layers)&&(U.pushLight(He),He.castShadow&&U.pushShadow(He))}),ue!==qe&&ue.traverseVisible(function(He){He.isLight&&He.layers.test(Ge.layers)&&(U.pushLight(He),He.castShadow&&U.pushShadow(He))}),U.setupLights();const ot=new Set;return ue.traverse(function(He){if(!(He.isMesh||He.isPoints||He.isLine||He.isSprite))return;const ut=He.material;if(ut)if(Array.isArray(ut))for(let Lt=0;Lt<ut.length;Lt++){const Dt=ut[Lt];Za(Dt,qe,He),ot.add(Dt)}else Za(ut,qe,He),ot.add(ut)}),z.pop(),U=null,ot},this.compileAsync=function(ue,Ge,qe=null){const ot=this.compile(ue,Ge,qe);return new Promise(He=>{function ut(){ot.forEach(function(Lt){bt.get(Lt).currentProgram.isReady()&&ot.delete(Lt)}),ot.size!==0?setTimeout(ut,10):He(ue)}Ye.get("KHR_parallel_shader_compile")!==null?ut():setTimeout(ut,10)})};let hr=null;function qc(){Qi.stop()}function Fd(){Qi.start()}const Qi=new oL;function Xc(ue,Ge,qe,ot){if(ue.visible===!1)return;if(ue.layers.test(Ge.layers)){if(ue.isGroup)qe=ue.renderOrder;else if(ue.isLOD)ue.autoUpdate===!0&&ue.update(Ge);else if(ue.isLight)U.pushLight(ue),ue.castShadow&&U.pushShadow(ue);else if(ue.isSprite){if(!ue.frustumCulled||pt.intersectsSprite(ue)){ot&&Pe.setFromMatrixPosition(ue.matrixWorld).applyMatrix4(Ce);const ut=j.update(ue),Lt=ue.material;Lt.visible&&P.push(ue,ut,Lt,qe,Pe.z,null)}}else if((ue.isMesh||ue.isLine||ue.isPoints)&&(!ue.frustumCulled||pt.intersectsObject(ue))){const ut=j.update(ue),Lt=ue.material;if(ot&&(ue.boundingSphere!==void 0?(ue.boundingSphere===null&&ue.computeBoundingSphere(),Pe.copy(ue.boundingSphere.center)):(ut.boundingSphere===null&&ut.computeBoundingSphere(),Pe.copy(ut.boundingSphere.center)),Pe.applyMatrix4(ue.matrixWorld).applyMatrix4(Ce)),Array.isArray(Lt)){const Dt=ut.groups;for(let Yt=0,rn=Dt.length;Yt<rn;Yt++){const An=Dt[Yt],dn=Lt[An.materialIndex];dn&&dn.visible&&P.push(ue,ut,dn,qe,Pe.z,An)}}else Lt.visible&&P.push(ue,ut,Lt,qe,Pe.z,null)}}const He=ue.children;for(let ut=0,Lt=He.length;ut<Lt;ut++)Xc(He[ut],Ge,qe,ot)}function Gl(ue,Ge,qe,ot){const He=ue.opaque,ut=ue.transmissive,Lt=ue.transparent;U.setupLightsView(qe),lt===!0&&rt.setGlobalState(G.clippingPlanes,qe),ot&&Ke.viewport(fe.copy(ot)),He.length>0&&La(He,Ge,qe),ut.length>0&&La(ut,Ge,qe),Lt.length>0&&La(Lt,Ge,qe),Ke.buffers.depth.setTest(!0),Ke.buffers.depth.setMask(!0),Ke.buffers.color.setMask(!0),Ke.setPolygonOffset(!1)}function bo(ue,Ge,qe,ot){if((qe.isScene===!0?qe.overrideMaterial:null)!==null)return;U.state.transmissionRenderTarget[ot.id]===void 0&&(U.state.transmissionRenderTarget[ot.id]=new go(1,1,{generateMipmaps:!0,type:Ye.has("EXT_color_buffer_half_float")||Ye.has("EXT_color_buffer_float")?ss:Rr,minFilter:mo,samples:4,stencilBuffer:h,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Si.workingColorSpace}));const He=U.state.transmissionRenderTarget[ot.id],ut=ot.viewport||fe;He.setSize(ut.z,ut.w);const Lt=G.getRenderTarget();G.setRenderTarget(He),G.getClearColor(Fe),we=G.getClearAlpha(),we<1&&G.setClearColor(16777215,.5),G.clear(),pe&&kt.render(qe);const Dt=G.toneMapping;G.toneMapping=0;const Yt=ot.viewport;if(ot.viewport!==void 0&&(ot.viewport=void 0),U.setupLightsView(ot),lt===!0&&rt.setGlobalState(G.clippingPlanes,ot),La(ue,qe,ot),ht.updateMultisampleRenderTarget(He),ht.updateRenderTargetMipmap(He),Ye.has("WEBGL_multisampled_render_to_texture")===!1){let rn=!1;for(let An=0,dn=Ge.length;An<dn;An++){const Tn=Ge[An],Ki=Tn.object,ui=Tn.geometry,tr=Tn.material,Li=Tn.group;if(tr.side===2&&Ki.layers.test(ot.layers)){const $n=tr.side;tr.side=1,tr.needsUpdate=!0,Hl(Ki,qe,ot,ui,tr,Li),tr.side=$n,tr.needsUpdate=!0,rn=!0}}rn===!0&&(ht.updateMultisampleRenderTarget(He),ht.updateRenderTargetMipmap(He))}G.setRenderTarget(Lt),G.setClearColor(Fe,we),Yt!==void 0&&(ot.viewport=Yt),G.toneMapping=Dt}function La(ue,Ge,qe){const ot=Ge.isScene===!0?Ge.overrideMaterial:null;for(let He=0,ut=ue.length;He<ut;He++){const Lt=ue[He],Dt=Lt.object,Yt=Lt.geometry,rn=ot===null?Lt.material:ot,An=Lt.group;Dt.layers.test(qe.layers)&&Hl(Dt,Ge,qe,Yt,rn,An)}}function Hl(ue,Ge,qe,ot,He,ut){ue.onBeforeRender(G,Ge,qe,ot,He,ut),ue.modelViewMatrix.multiplyMatrices(qe.matrixWorldInverse,ue.matrixWorld),ue.normalMatrix.getNormalMatrix(ue.modelViewMatrix),He.onBeforeRender(G,Ge,qe,ot,ue,ut),He.transparent===!0&&He.side===2&&He.forceSinglePass===!1?(He.side=1,He.needsUpdate=!0,G.renderBufferDirect(qe,Ge,ot,He,ue,ut),He.side=0,He.needsUpdate=!0,G.renderBufferDirect(qe,Ge,ot,He,ue,ut),He.side=2):G.renderBufferDirect(qe,Ge,ot,He,ue,ut),ue.onAfterRender(G,Ge,qe,ot,He,ut)}function zl(ue,Ge,qe){Ge.isScene!==!0&&(Ge=je);const ot=bt.get(ue),He=U.state.lights,ut=U.state.shadowsArray,Lt=He.state.version,Dt=J.getParameters(ue,He.state,ut,Ge,qe),Yt=J.getProgramCacheKey(Dt);let rn=ot.programs;ot.environment=ue.isMeshStandardMaterial?Ge.environment:null,ot.fog=Ge.fog,ot.envMap=(ue.isMeshStandardMaterial?Nt:Vt).get(ue.envMap||ot.environment),ot.envMapRotation=ot.environment!==null&&ue.envMap===null?Ge.environmentRotation:ue.envMapRotation,rn===void 0&&(ue.addEventListener("dispose",Ql),rn=new Map,ot.programs=rn);let An=rn.get(Yt);if(An!==void 0){if(ot.currentProgram===An&&ot.lightsStateVersion===Lt)return Jh(ue,Dt),An}else Dt.uniforms=J.getUniforms(ue),ue.onBeforeCompile(Dt,G),An=J.acquireProgram(Dt,Yt),rn.set(Yt,An),ot.uniforms=Dt.uniforms;const dn=ot.uniforms;return(ue.isShaderMaterial||ue.isRawShaderMaterial)&&ue.clipping!==!0||(dn.clippingPlanes=rt.uniform),Jh(ue,Dt),ot.needsLights=function(Tn){return Tn.isMeshLambertMaterial||Tn.isMeshToonMaterial||Tn.isMeshPhongMaterial||Tn.isMeshStandardMaterial||Tn.isShadowMaterial||Tn.isShaderMaterial&&Tn.lights===!0}(ue),ot.lightsStateVersion=Lt,ot.needsLights&&(dn.ambientLightColor.value=He.state.ambient,dn.lightProbe.value=He.state.probe,dn.directionalLights.value=He.state.directional,dn.directionalLightShadows.value=He.state.directionalShadow,dn.spotLights.value=He.state.spot,dn.spotLightShadows.value=He.state.spotShadow,dn.rectAreaLights.value=He.state.rectArea,dn.ltc_1.value=He.state.rectAreaLTC1,dn.ltc_2.value=He.state.rectAreaLTC2,dn.pointLights.value=He.state.point,dn.pointLightShadows.value=He.state.pointShadow,dn.hemisphereLights.value=He.state.hemi,dn.directionalShadowMap.value=He.state.directionalShadowMap,dn.directionalShadowMatrix.value=He.state.directionalShadowMatrix,dn.spotShadowMap.value=He.state.spotShadowMap,dn.spotLightMatrix.value=He.state.spotLightMatrix,dn.spotLightMap.value=He.state.spotLightMap,dn.pointShadowMap.value=He.state.pointShadowMap,dn.pointShadowMatrix.value=He.state.pointShadowMatrix),ot.currentProgram=An,ot.uniformsList=null,An}function al(ue){if(ue.uniformsList===null){const Ge=ue.currentProgram.getUniforms();ue.uniformsList=zy.seqWithValue(Ge.seq,ue.uniforms)}return ue.uniformsList}function Jh(ue,Ge){const qe=bt.get(ue);qe.outputColorSpace=Ge.outputColorSpace,qe.batching=Ge.batching,qe.batchingColor=Ge.batchingColor,qe.instancing=Ge.instancing,qe.instancingColor=Ge.instancingColor,qe.instancingMorph=Ge.instancingMorph,qe.skinning=Ge.skinning,qe.morphTargets=Ge.morphTargets,qe.morphNormals=Ge.morphNormals,qe.morphColors=Ge.morphColors,qe.morphTargetsCount=Ge.morphTargetsCount,qe.numClippingPlanes=Ge.numClippingPlanes,qe.numIntersection=Ge.numClipIntersection,qe.vertexAlphas=Ge.vertexAlphas,qe.vertexTangents=Ge.vertexTangents,qe.toneMapping=Ge.toneMapping}Qi.setAnimationLoop(function(ue){hr&&hr(ue)}),typeof self<"u"&&Qi.setContext(self),this.setAnimationLoop=function(ue){hr=ue,cr.setAnimationLoop(ue),ue===null?Qi.stop():Qi.start()},cr.addEventListener("sessionstart",qc),cr.addEventListener("sessionend",Fd),this.render=function(ue,Ge){if(Ge!==void 0&&Ge.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(Q===!0)return;if(ue.matrixWorldAutoUpdate===!0&&ue.updateMatrixWorld(),Ge.parent===null&&Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),cr.enabled===!0&&cr.isPresenting===!0&&(cr.cameraAutoUpdate===!0&&cr.updateCamera(Ge),Ge=cr.getCamera()),ue.isScene===!0&&ue.onBeforeRender(G,ue,Ge,K),U=Re.get(ue,z.length),U.init(Ge),z.push(U),Ce.multiplyMatrices(Ge.projectionMatrix,Ge.matrixWorldInverse),pt.setFromProjectionMatrix(Ce),he=this.localClippingEnabled,lt=rt.init(this.clippingPlanes,he),P=ye.get(ue,D.length),P.init(),D.push(P),cr.enabled===!0&&cr.isPresenting===!0){const ut=G.xr.getDepthSensingMesh();ut!==null&&Xc(ut,Ge,-1/0,G.sortObjects)}Xc(ue,Ge,0,G.sortObjects),P.finish(),G.sortObjects===!0&&P.sort(me,wt),pe=cr.enabled===!1||cr.isPresenting===!1||cr.hasDepthSensing()===!1,pe&&kt.addToRenderList(P,ue),this.info.render.frame++,lt===!0&&rt.beginShadows();const qe=U.state.shadowsArray;_t.render(qe,ue,Ge),lt===!0&&rt.endShadows(),this.info.autoReset===!0&&this.info.reset();const ot=P.opaque,He=P.transmissive;if(U.setupLights(),Ge.isArrayCamera){const ut=Ge.cameras;if(He.length>0)for(let Lt=0,Dt=ut.length;Lt<Dt;Lt++)bo(ot,He,ue,ut[Lt]);pe&&kt.render(ue);for(let Lt=0,Dt=ut.length;Lt<Dt;Lt++){const Yt=ut[Lt];Gl(P,ue,Yt,Yt.viewport)}}else He.length>0&&bo(ot,He,ue,Ge),pe&&kt.render(ue),Gl(P,ue,Ge);K!==null&&(ht.updateMultisampleRenderTarget(K),ht.updateRenderTargetMipmap(K)),ue.isScene===!0&&ue.onAfterRender(G,ue,Ge),da.resetDefaultState(),ne=-1,le=null,z.pop(),z.length>0?(U=z[z.length-1],lt===!0&&rt.setGlobalState(G.clippingPlanes,U.state.camera)):U=null,D.pop(),P=D.length>0?D[D.length-1]:null},this.getActiveCubeFace=function(){return Y},this.getActiveMipmapLevel=function(){return q},this.getRenderTarget=function(){return K},this.setRenderTargetTextures=function(ue,Ge,qe){bt.get(ue.texture).__webglTexture=Ge,bt.get(ue.depthTexture).__webglTexture=qe;const ot=bt.get(ue);ot.__hasExternalTextures=!0,ot.__autoAllocateDepthBuffer=qe===void 0,ot.__autoAllocateDepthBuffer||Ye.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ot.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ue,Ge){const qe=bt.get(ue);qe.__webglFramebuffer=Ge,qe.__useDefaultFramebuffer=Ge===void 0},this.setRenderTarget=function(ue,Ge=0,qe=0){K=ue,Y=Ge,q=qe;let ot=!0,He=null,ut=!1,Lt=!1;if(ue){const Dt=bt.get(ue);if(Dt.__useDefaultFramebuffer!==void 0)Ke.bindFramebuffer(De.FRAMEBUFFER,null),ot=!1;else if(Dt.__webglFramebuffer===void 0)ht.setupRenderTarget(ue);else if(Dt.__hasExternalTextures)ht.rebindTextures(ue,bt.get(ue.texture).__webglTexture,bt.get(ue.depthTexture).__webglTexture);else if(ue.depthBuffer){const An=ue.depthTexture;if(Dt.__boundDepthTexture!==An){if(An!==null&&bt.has(An)&&(ue.width!==An.image.width||ue.height!==An.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ht.setupDepthRenderbuffer(ue)}}const Yt=ue.texture;(Yt.isData3DTexture||Yt.isDataArrayTexture||Yt.isCompressedArrayTexture)&&(Lt=!0);const rn=bt.get(ue).__webglFramebuffer;ue.isWebGLCubeRenderTarget?(He=Array.isArray(rn[Ge])?rn[Ge][qe]:rn[Ge],ut=!0):He=ue.samples>0&&ht.useMultisampledRTT(ue)===!1?bt.get(ue).__webglMultisampledFramebuffer:Array.isArray(rn)?rn[qe]:rn,fe.copy(ue.viewport),be.copy(ue.scissor),de=ue.scissorTest}else fe.copy(ft).multiplyScalar(tt).floor(),be.copy(ze).multiplyScalar(tt).floor(),de=$e;if(Ke.bindFramebuffer(De.FRAMEBUFFER,He)&&ot&&Ke.drawBuffers(ue,He),Ke.viewport(fe),Ke.scissor(be),Ke.setScissorTest(de),ut){const Dt=bt.get(ue.texture);De.framebufferTexture2D(De.FRAMEBUFFER,De.COLOR_ATTACHMENT0,De.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,Dt.__webglTexture,qe)}else if(Lt){const Dt=bt.get(ue.texture),Yt=Ge||0;De.framebufferTextureLayer(De.FRAMEBUFFER,De.COLOR_ATTACHMENT0,Dt.__webglTexture,qe||0,Yt)}ne=-1},this.readRenderTargetPixels=function(ue,Ge,qe,ot,He,ut,Lt){if(!ue||!ue.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Dt=bt.get(ue).__webglFramebuffer;if(ue.isWebGLCubeRenderTarget&&Lt!==void 0&&(Dt=Dt[Lt]),Dt){Ke.bindFramebuffer(De.FRAMEBUFFER,Dt);try{const Yt=ue.texture,rn=Yt.format,An=Yt.type;if(!Ct.textureFormatReadable(rn))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!Ct.textureTypeReadable(An))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ge>=0&&Ge<=ue.width-ot&&qe>=0&&qe<=ue.height-He&&De.readPixels(Ge,qe,ot,He,Xr.convert(rn),Xr.convert(An),ut)}finally{const Yt=K!==null?bt.get(K).__webglFramebuffer:null;Ke.bindFramebuffer(De.FRAMEBUFFER,Yt)}}},this.readRenderTargetPixelsAsync=async function(ue,Ge,qe,ot,He,ut,Lt){if(!ue||!ue.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Dt=bt.get(ue).__webglFramebuffer;if(ue.isWebGLCubeRenderTarget&&Lt!==void 0&&(Dt=Dt[Lt]),Dt){const Yt=ue.texture,rn=Yt.format,An=Yt.type;if(!Ct.textureFormatReadable(rn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ct.textureTypeReadable(An))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ge>=0&&Ge<=ue.width-ot&&qe>=0&&qe<=ue.height-He){Ke.bindFramebuffer(De.FRAMEBUFFER,Dt);const dn=De.createBuffer();De.bindBuffer(De.PIXEL_PACK_BUFFER,dn),De.bufferData(De.PIXEL_PACK_BUFFER,ut.byteLength,De.STREAM_READ),De.readPixels(Ge,qe,ot,He,Xr.convert(rn),Xr.convert(An),0);const Tn=K!==null?bt.get(K).__webglFramebuffer:null;Ke.bindFramebuffer(De.FRAMEBUFFER,Tn);const Ki=De.fenceSync(De.SYNC_GPU_COMMANDS_COMPLETE,0);return De.flush(),await function(ui,tr,Li){return new Promise(function($n,Gi){setTimeout(function vr(){switch(ui.clientWaitSync(tr,ui.SYNC_FLUSH_COMMANDS_BIT,0)){case ui.WAIT_FAILED:Gi();break;case ui.TIMEOUT_EXPIRED:setTimeout(vr,Li);break;default:$n()}},Li)})}(De,Ki,4),De.bindBuffer(De.PIXEL_PACK_BUFFER,dn),De.getBufferSubData(De.PIXEL_PACK_BUFFER,0,ut),De.deleteBuffer(dn),De.deleteSync(Ki),ut}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ue,Ge=null,qe=0){ue.isTexture!==!0&&(xy("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ge=arguments[0]||null,ue=arguments[1]);const ot=Math.pow(2,-qe),He=Math.floor(ue.image.width*ot),ut=Math.floor(ue.image.height*ot),Lt=Ge!==null?Ge.x:0,Dt=Ge!==null?Ge.y:0;ht.setTexture2D(ue,0),De.copyTexSubImage2D(De.TEXTURE_2D,qe,0,0,Lt,Dt,He,ut),Ke.unbindTexture()},this.copyTextureToTexture=function(ue,Ge,qe=null,ot=null,He=0){let ut,Lt,Dt,Yt,rn,An;ue.isTexture!==!0&&(xy("WebGLRenderer: copyTextureToTexture function signature has changed."),ot=arguments[0]||null,ue=arguments[1],Ge=arguments[2],He=arguments[3]||0,qe=null),qe!==null?(ut=qe.max.x-qe.min.x,Lt=qe.max.y-qe.min.y,Dt=qe.min.x,Yt=qe.min.y):(ut=ue.image.width,Lt=ue.image.height,Dt=0,Yt=0),ot!==null?(rn=ot.x,An=ot.y):(rn=0,An=0);const dn=Xr.convert(Ge.format),Tn=Xr.convert(Ge.type);ht.setTexture2D(Ge,0),De.pixelStorei(De.UNPACK_FLIP_Y_WEBGL,Ge.flipY),De.pixelStorei(De.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),De.pixelStorei(De.UNPACK_ALIGNMENT,Ge.unpackAlignment);const Ki=De.getParameter(De.UNPACK_ROW_LENGTH),ui=De.getParameter(De.UNPACK_IMAGE_HEIGHT),tr=De.getParameter(De.UNPACK_SKIP_PIXELS),Li=De.getParameter(De.UNPACK_SKIP_ROWS),$n=De.getParameter(De.UNPACK_SKIP_IMAGES),Gi=ue.isCompressedTexture?ue.mipmaps[He]:ue.image;De.pixelStorei(De.UNPACK_ROW_LENGTH,Gi.width),De.pixelStorei(De.UNPACK_IMAGE_HEIGHT,Gi.height),De.pixelStorei(De.UNPACK_SKIP_PIXELS,Dt),De.pixelStorei(De.UNPACK_SKIP_ROWS,Yt),ue.isDataTexture?De.texSubImage2D(De.TEXTURE_2D,He,rn,An,ut,Lt,dn,Tn,Gi.data):ue.isCompressedTexture?De.compressedTexSubImage2D(De.TEXTURE_2D,He,rn,An,Gi.width,Gi.height,dn,Gi.data):De.texSubImage2D(De.TEXTURE_2D,He,rn,An,ut,Lt,dn,Tn,Gi),De.pixelStorei(De.UNPACK_ROW_LENGTH,Ki),De.pixelStorei(De.UNPACK_IMAGE_HEIGHT,ui),De.pixelStorei(De.UNPACK_SKIP_PIXELS,tr),De.pixelStorei(De.UNPACK_SKIP_ROWS,Li),De.pixelStorei(De.UNPACK_SKIP_IMAGES,$n),He===0&&Ge.generateMipmaps&&De.generateMipmap(De.TEXTURE_2D),Ke.unbindTexture()},this.copyTextureToTexture3D=function(ue,Ge,qe=null,ot=null,He=0){let ut,Lt,Dt,Yt,rn,An,dn,Tn,Ki;ue.isTexture!==!0&&(xy("WebGLRenderer: copyTextureToTexture3D function signature has changed."),qe=arguments[0]||null,ot=arguments[1]||null,ue=arguments[2],Ge=arguments[3],He=arguments[4]||0);const ui=ue.isCompressedTexture?ue.mipmaps[He]:ue.image;qe!==null?(ut=qe.max.x-qe.min.x,Lt=qe.max.y-qe.min.y,Dt=qe.max.z-qe.min.z,Yt=qe.min.x,rn=qe.min.y,An=qe.min.z):(ut=ui.width,Lt=ui.height,Dt=ui.depth,Yt=0,rn=0,An=0),ot!==null?(dn=ot.x,Tn=ot.y,Ki=ot.z):(dn=0,Tn=0,Ki=0);const tr=Xr.convert(Ge.format),Li=Xr.convert(Ge.type);let $n;if(Ge.isData3DTexture)ht.setTexture3D(Ge,0),$n=De.TEXTURE_3D;else{if(!Ge.isDataArrayTexture&&!Ge.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ht.setTexture2DArray(Ge,0),$n=De.TEXTURE_2D_ARRAY}De.pixelStorei(De.UNPACK_FLIP_Y_WEBGL,Ge.flipY),De.pixelStorei(De.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ge.premultiplyAlpha),De.pixelStorei(De.UNPACK_ALIGNMENT,Ge.unpackAlignment);const Gi=De.getParameter(De.UNPACK_ROW_LENGTH),vr=De.getParameter(De.UNPACK_IMAGE_HEIGHT),Ln=De.getParameter(De.UNPACK_SKIP_PIXELS),xn=De.getParameter(De.UNPACK_SKIP_ROWS),xs=De.getParameter(De.UNPACK_SKIP_IMAGES);De.pixelStorei(De.UNPACK_ROW_LENGTH,ui.width),De.pixelStorei(De.UNPACK_IMAGE_HEIGHT,ui.height),De.pixelStorei(De.UNPACK_SKIP_PIXELS,Yt),De.pixelStorei(De.UNPACK_SKIP_ROWS,rn),De.pixelStorei(De.UNPACK_SKIP_IMAGES,An),ue.isDataTexture||ue.isData3DTexture?De.texSubImage3D($n,He,dn,Tn,Ki,ut,Lt,Dt,tr,Li,ui.data):Ge.isCompressedArrayTexture?De.compressedTexSubImage3D($n,He,dn,Tn,Ki,ut,Lt,Dt,tr,ui.data):De.texSubImage3D($n,He,dn,Tn,Ki,ut,Lt,Dt,tr,Li,ui),De.pixelStorei(De.UNPACK_ROW_LENGTH,Gi),De.pixelStorei(De.UNPACK_IMAGE_HEIGHT,vr),De.pixelStorei(De.UNPACK_SKIP_PIXELS,Ln),De.pixelStorei(De.UNPACK_SKIP_ROWS,xn),De.pixelStorei(De.UNPACK_SKIP_IMAGES,xs),He===0&&Ge.generateMipmaps&&De.generateMipmap($n),Ke.unbindTexture()},this.initRenderTarget=function(ue){bt.get(ue).__webglFramebuffer===void 0&&ht.setupRenderTarget(ue)},this.initTexture=function(ue){ue.isCubeTexture?ht.setTextureCube(ue,0):ue.isData3DTexture?ht.setTexture3D(ue,0):ue.isDataArrayTexture||ue.isCompressedArrayTexture?ht.setTexture2DArray(ue,0):ht.setTexture2D(ue,0),Ke.unbindTexture()},this.resetState=function(){Y=0,q=0,K=null,Ke.reset(),da.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Xp}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const i=this.getContext();i.drawingBufferColorSpace=t===fy?"display-p3":"srgb",i.unpackColorSpace=Si.workingColorSpace===wm?"display-p3":"srgb"}}class Oh extends $i{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new _o,this.environmentIntensity=1,this.environmentRotation=new _o,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class O6{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=iw,this.updateRanges=[],this.version=0,this.uuid=Yo()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,o){t*=this.stride,o*=i.stride;for(let l=0,h=this.stride;l<h;l++)this.array[t+l]=i.array[o+l];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Yo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),o=new this.constructor(i,this.stride);return o.setUsage(this.usage),o}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Yo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const oa=new ve;class eS{constructor(t,i,o,l=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=o,this.normalized=l}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,o=this.data.count;i<o;i++)oa.fromBufferAttribute(this,i),oa.applyMatrix4(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}applyNormalMatrix(t){for(let i=0,o=this.count;i<o;i++)oa.fromBufferAttribute(this,i),oa.applyNormalMatrix(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}transformDirection(t){for(let i=0,o=this.count;i<o;i++)oa.fromBufferAttribute(this,i),oa.transformDirection(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}getComponent(t,i){let o=this.array[t*this.data.stride+this.offset+i];return this.normalized&&(o=Ko(o,this.array)),o}setComponent(t,i,o){return this.normalized&&(o=zi(o,this.array)),this.data.array[t*this.data.stride+this.offset+i]=o,this}setX(t,i){return this.normalized&&(i=zi(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=zi(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=zi(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=zi(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=Ko(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=Ko(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=Ko(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=Ko(i,this.array)),i}setXY(t,i,o){return t=t*this.data.stride+this.offset,this.normalized&&(i=zi(i,this.array),o=zi(o,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=o,this}setXYZ(t,i,o,l){return t=t*this.data.stride+this.offset,this.normalized&&(i=zi(i,this.array),o=zi(o,this.array),l=zi(l,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=o,this.data.array[t+2]=l,this}setXYZW(t,i,o,l,h){return t=t*this.data.stride+this.offset,this.normalized&&(i=zi(i,this.array),o=zi(o,this.array),l=zi(l,this.array),h=zi(h,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=o,this.data.array[t+2]=l,this.data.array[t+3]=h,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let o=0;o<this.count;o++){const l=o*this.data.stride+this.offset;for(let h=0;h<this.itemSize;h++)i.push(this.data.array[l+h])}return new mr(new this.array.constructor(i),this.itemSize,this.normalized)}return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new eS(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let o=0;o<this.count;o++){const l=o*this.data.stride+this.offset;for(let h=0;h<this.itemSize;h++)i.push(this.data.array[l+h])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const OL=new ve,kL=new Oi,QL=new Oi,k6=new ve,GL=new In,Wy=new ve,Gw=new vo,HL=new In,Hw=new Lm;class Q6 extends Vi{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=BR,this.bindMatrix=new In,this.bindMatrixInverse=new In,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new sa),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let o=0;o<i.count;o++)this.getVertexPosition(o,Wy),this.boundingBox.expandByPoint(Wy)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new vo),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let o=0;o<i.count;o++)this.getVertexPosition(o,Wy),this.boundingSphere.expandByPoint(Wy)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const o=this.material,l=this.matrixWorld;o!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Gw.copy(this.boundingSphere),Gw.applyMatrix4(l),t.ray.intersectsSphere(Gw)!==!1&&(HL.copy(l).invert(),Hw.copy(t.ray).applyMatrix4(HL),this.boundingBox!==null&&Hw.intersectsBox(this.boundingBox)===!1||this._computeIntersections(t,i,Hw)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Oi,i=this.geometry.attributes.skinWeight;for(let o=0,l=i.count;o<l;o++){t.fromBufferAttribute(i,o);const h=1/t.manhattanLength();h!==1/0?t.multiplyScalar(h):t.set(1,0,0,0),i.setXYZW(o,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===BR?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const o=this.skeleton,l=this.geometry;kL.fromBufferAttribute(l.attributes.skinIndex,t),QL.fromBufferAttribute(l.attributes.skinWeight,t),OL.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let h=0;h<4;h++){const d=QL.getComponent(h);if(d!==0){const f=kL.getComponent(h);GL.multiplyMatrices(o.bones[f].matrixWorld,o.boneInverses[f]),i.addScaledVector(k6.copy(OL).applyMatrix4(GL),d)}}return i.applyMatrix4(this.bindMatrixInverse)}}class zL extends $i{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Fm extends qi{constructor(t=null,i=1,o=1,l,h,d,f,g,y=1003,x=1003,b,_){super(null,d,f,g,y,x,l,h,b,_),this.isDataTexture=!0,this.image={data:t,width:i,height:o},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const VL=new In,G6=new In;class tS{constructor(t=[],i=[]){this.uuid=Yo(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let o=0,l=this.bones.length;o<l;o++)this.boneInverses.push(new In)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const o=new In;this.bones[t]&&o.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(o)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const o=this.bones[t];o&&o.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const o=this.bones[t];o&&(o.parent&&o.parent.isBone?(o.matrix.copy(o.parent.matrixWorld).invert(),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}}update(){const t=this.bones,i=this.boneInverses,o=this.boneMatrices,l=this.boneTexture;for(let h=0,d=t.length;h<d;h++){const f=t[h]?t[h].matrixWorld:G6;VL.multiplyMatrices(f,i[h]),VL.toArray(o,16*h)}l!==null&&(l.needsUpdate=!0)}clone(){return new tS(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const o=new Fm(i,t,t,fr,Wr);return o.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=o,this}getBoneByName(t){for(let i=0,o=this.bones.length;i<o;i++){const l=this.bones[i];if(l.name===t)return l}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let o=0,l=t.bones.length;o<l;o++){const h=t.bones[o];let d=i[h];d===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",h),d=new zL),this.bones.push(d),this.boneInverses.push(new In().fromArray(t.boneInverses[o]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,o=this.boneInverses;for(let l=0,h=i.length;l<h;l++){const d=i[l];t.bones.push(d.uuid);const f=o[l];t.boneInverses.push(f.toArray())}return t}}class zw extends mr{constructor(t,i,o,l=1){super(t,i,o),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=l}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const dA=new In,WL=new In,jy=[],jL=new sa,H6=new In,Om=new Vi,km=new vo;class z6 extends Vi{constructor(t,i,o){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new zw(new Float32Array(16*o),16),this.instanceColor=null,this.morphTexture=null,this.count=o,this.boundingBox=null,this.boundingSphere=null;for(let l=0;l<o;l++)this.setMatrixAt(l,H6)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new sa),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let o=0;o<i;o++)this.getMatrixAt(o,dA),jL.copy(t.boundingBox).applyMatrix4(dA),this.boundingBox.union(jL)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new vo),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let o=0;o<i;o++)this.getMatrixAt(o,dA),km.copy(t.boundingSphere).applyMatrix4(dA),this.boundingSphere.union(km)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,i){const o=i.morphTargetInfluences,l=this.morphTexture.source.data.data,h=t*(o.length+1)+1;for(let d=0;d<o.length;d++)o[d]=l[h+d]}raycast(t,i){const o=this.matrixWorld,l=this.count;if(Om.geometry=this.geometry,Om.material=this.material,Om.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),km.copy(this.boundingSphere),km.applyMatrix4(o),t.ray.intersectsSphere(km)!==!1))for(let h=0;h<l;h++){this.getMatrixAt(h,dA),WL.multiplyMatrices(o,dA),Om.matrixWorld=WL,Om.raycast(t,jy);for(let d=0,f=jy.length;d<f;d++){const g=jy[d];g.instanceId=h,g.object=this,i.push(g)}jy.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new zw(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),i.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,i){const o=i.morphTargetInfluences,l=o.length+1;this.morphTexture===null&&(this.morphTexture=new Fm(new Float32Array(l*this.count),l,this.count,Bh,Wr));const h=this.morphTexture.source.data.data;let d=0;for(let y=0;y<o.length;y++)d+=o[y];const f=this.geometry.morphTargetsRelative?1:1-d,g=l*t;h[g]=f,h.set(o,g+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class qL extends el{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new fn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const qy=new ve,Xy=new ve,XL=new In,Qm=new Lm,Yy=new vo,Vw=new ve,YL=new ve;class Gm extends $i{constructor(t=new Ra,i=new qL){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,o=[0];for(let l=1,h=i.count;l<h;l++)qy.fromBufferAttribute(i,l-1),Xy.fromBufferAttribute(i,l),o[l]=o[l-1],o[l]+=qy.distanceTo(Xy);t.setAttribute("lineDistance",new qa(o,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const o=this.geometry,l=this.matrixWorld,h=t.params.Line.threshold,d=o.drawRange;if(o.boundingSphere===null&&o.computeBoundingSphere(),Yy.copy(o.boundingSphere),Yy.applyMatrix4(l),Yy.radius+=h,t.ray.intersectsSphere(Yy)===!1)return;XL.copy(l).invert(),Qm.copy(t.ray).applyMatrix4(XL);const f=h/((this.scale.x+this.scale.y+this.scale.z)/3),g=f*f,y=this.isLineSegments?2:1,x=o.index,b=o.attributes.position;if(x!==null){const _=Math.max(0,d.start),w=Math.min(x.count,d.start+d.count);for(let T=_,P=w-1;T<P;T+=y){const U=x.getX(T),D=x.getX(T+1),z=Ky(this,t,Qm,g,U,D);z&&i.push(z)}if(this.isLineLoop){const T=x.getX(w-1),P=x.getX(_),U=Ky(this,t,Qm,g,T,P);U&&i.push(U)}}else{const _=Math.max(0,d.start),w=Math.min(b.count,d.start+d.count);for(let T=_,P=w-1;T<P;T+=y){const U=Ky(this,t,Qm,g,T,T+1);U&&i.push(U)}if(this.isLineLoop){const T=Ky(this,t,Qm,g,w-1,_);T&&i.push(T)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=o.length;l<h;l++){const d=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}}function Ky(p,t,i,o,l,h){const d=p.geometry.attributes.position;if(qy.fromBufferAttribute(d,l),Xy.fromBufferAttribute(d,h),i.distanceSqToSegment(qy,Xy,Vw,YL)>o)return;Vw.applyMatrix4(p.matrixWorld);const f=t.ray.origin.distanceTo(Vw);return f<t.near||f>t.far?void 0:{distance:f,point:YL.clone().applyMatrix4(p.matrixWorld),index:l,face:null,faceIndex:null,barycoord:null,object:p}}const KL=new ve,JL=new ve;class V6 extends Gm{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,o=[];for(let l=0,h=i.count;l<h;l+=2)KL.fromBufferAttribute(i,l),JL.fromBufferAttribute(i,l+1),o[l]=l===0?0:o[l-1],o[l+1]=o[l]+KL.distanceTo(JL);t.setAttribute("lineDistance",new qa(o,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class W6 extends Gm{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class $L extends el{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new fn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const ZL=new In,Ww=new Lm,Jy=new vo,$y=new ve;class j6 extends $i{constructor(t=new Ra,i=new $L){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,i){const o=this.geometry,l=this.matrixWorld,h=t.params.Points.threshold,d=o.drawRange;if(o.boundingSphere===null&&o.computeBoundingSphere(),Jy.copy(o.boundingSphere),Jy.applyMatrix4(l),Jy.radius+=h,t.ray.intersectsSphere(Jy)===!1)return;ZL.copy(l).invert(),Ww.copy(t.ray).applyMatrix4(ZL);const f=h/((this.scale.x+this.scale.y+this.scale.z)/3),g=f*f,y=o.index,x=o.attributes.position;if(y!==null)for(let b=Math.max(0,d.start),_=Math.min(y.count,d.start+d.count);b<_;b++){const w=y.getX(b);$y.fromBufferAttribute(x,w),e3($y,w,g,l,t,i,this)}else for(let b=Math.max(0,d.start),_=Math.min(x.count,d.start+d.count);b<_;b++)$y.fromBufferAttribute(x,b),e3($y,b,g,l,t,i,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=o.length;l<h;l++){const d=o[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}}function e3(p,t,i,o,l,h,d){const f=Ww.distanceSqToPoint(p);if(f<i){const g=new ve;Ww.closestPointToPoint(p,g),g.applyMatrix4(o);const y=l.ray.origin.distanceTo(g);if(y<l.near||y>l.far)return;h.push({distance:y,distanceToRay:Math.sqrt(f),point:g,index:t,face:null,faceIndex:null,barycoord:null,object:d})}}class q6 extends qi{constructor(t,i,o,l,h,d,f,g,y){super(t,i,o,l,h,d,f,g,y),this.isVideoTexture=!0,this.minFilter=d!==void 0?d:Fi,this.magFilter=h!==void 0?h:Fi,this.generateMipmaps=!1;const x=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function b(){x.needsUpdate=!0,t.requestVideoFrameCallback(b)})}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!("requestVideoFrameCallback"in t)&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class gd extends qi{constructor(t,i,o,l,h,d,f,g,y,x,b,_){super(null,d,f,g,y,x,l,h,b,_),this.isCompressedTexture=!0,this.image={width:i,height:o},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class X6 extends gd{constructor(t,i,o,l,h,d){super(t,i,o,h,d),this.isCompressedArrayTexture=!0,this.image.depth=l,this.wrapR=rs,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Y6 extends gd{constructor(t,i,o){super(void 0,t[0].width,t[0].height,i,o,ad),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class jw extends qi{constructor(t,i,o,l,h,d,f,g,y){super(t,i,o,l,h,d,f,g,y),this.isCanvasTexture=!0,this.needsUpdate=!0}}class nS extends Ra{constructor(t=1,i=32,o=16,l=0,h=2*Math.PI,d=0,f=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:o,phiStart:l,phiLength:h,thetaStart:d,thetaLength:f},i=Math.max(3,Math.floor(i)),o=Math.max(2,Math.floor(o));const g=Math.min(d+f,Math.PI);let y=0;const x=[],b=new ve,_=new ve,w=[],T=[],P=[],U=[];for(let D=0;D<=o;D++){const z=[],G=D/o;let Q=0;D===0&&d===0?Q=.5/i:D===o&&g===Math.PI&&(Q=-.5/i);for(let Y=0;Y<=i;Y++){const q=Y/i;b.x=-t*Math.cos(l+q*h)*Math.sin(d+G*f),b.y=t*Math.cos(d+G*f),b.z=t*Math.sin(l+q*h)*Math.sin(d+G*f),T.push(b.x,b.y,b.z),_.copy(b).normalize(),P.push(_.x,_.y,_.z),U.push(q+Q,1-G),z.push(y++)}x.push(z)}for(let D=0;D<o;D++)for(let z=0;z<i;z++){const G=x[D][z+1],Q=x[D][z],Y=x[D+1][z],q=x[D+1][z+1];(D!==0||d>0)&&w.push(G,Q,q),(D!==o-1||g<Math.PI)&&w.push(Q,Y,q)}this.setIndex(w),this.setAttribute("position",new qa(T,3)),this.setAttribute("normal",new qa(P,3)),this.setAttribute("uv",new qa(U,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new nS(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Hm extends el{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Hn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _o,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Tl extends Hm{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Hn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ms(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new fn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new fn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new fn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}function Zy(p,t,i){return!p||!i&&p.constructor===t?p:typeof t.BYTES_PER_ELEMENT=="number"?new t(p):Array.prototype.slice.call(p)}function K6(p){const t=p.length,i=new Array(t);for(let o=0;o!==t;++o)i[o]=o;return i.sort(function(o,l){return p[o]-p[l]}),i}function t3(p,t,i){const o=p.length,l=new p.constructor(o);for(let h=0,d=0;d!==o;++h){const f=i[h]*t;for(let g=0;g!==t;++g)l[d++]=p[f+g]}return l}function n3(p,t,i,o){let l=1,h=p[0];for(;h!==void 0&&h[o]===void 0;)h=p[l++];if(h===void 0)return;let d=h[o];if(d!==void 0)if(Array.isArray(d))do d=h[o],d!==void 0&&(t.push(h.time),i.push.apply(i,d)),h=p[l++];while(h!==void 0);else if(d.toArray!==void 0)do d=h[o],d!==void 0&&(t.push(h.time),d.toArray(i,i.length)),h=p[l++];while(h!==void 0);else do d=h[o],d!==void 0&&(t.push(h.time),i.push(d)),h=p[l++];while(h!==void 0)}class zm{constructor(t,i,o,l){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=l!==void 0?l:new i.constructor(o),this.sampleValues=i,this.valueSize=o,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let o=this._cachedIndex,l=i[o],h=i[o-1];e:{t:{let d;n:{i:if(!(t<l)){for(let f=o+2;;){if(l===void 0){if(t<h)break i;return o=i.length,this._cachedIndex=o,this.copySampleValue_(o-1)}if(o===f)break;if(h=l,l=i[++o],t<l)break t}d=i.length;break n}if(t>=h)break e;{const f=i[1];t<f&&(o=2,h=f);for(let g=o-2;;){if(h===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(o===g)break;if(l=h,h=i[--o-1],t>=h)break t}d=o,o=0}}for(;o<d;){const f=o+d>>>1;t<i[f]?d=f:o=f+1}if(l=i[o],h=i[o-1],h===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(l===void 0)return o=i.length,this._cachedIndex=o,this.copySampleValue_(o-1)}this._cachedIndex=o,this.intervalChanged_(o,h,l)}return this.interpolate_(o,h,t,l)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=t*l;for(let d=0;d!==l;++d)i[d]=o[h+d];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class J6 extends zm{constructor(t,i,o,l){super(t,i,o,l),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Wp,endingEnd:Wp}}intervalChanged_(t,i,o){const l=this.parameterPositions;let h=t-2,d=t+1,f=l[h],g=l[d];if(f===void 0)switch(this.getSettings_().endingStart){case jp:h=t,f=2*i-o;break;case Ay:h=l.length-2,f=i+l[h]-l[h+1];break;default:h=t,f=o}if(g===void 0)switch(this.getSettings_().endingEnd){case jp:d=t,g=2*o-i;break;case Ay:d=1,g=o+l[1]-l[0];break;default:d=t-1,g=i}const y=.5*(o-i),x=this.valueSize;this._weightPrev=y/(i-f),this._weightNext=y/(g-o),this._offsetPrev=h*x,this._offsetNext=d*x}interpolate_(t,i,o,l){const h=this.resultBuffer,d=this.sampleValues,f=this.valueSize,g=t*f,y=g-f,x=this._offsetPrev,b=this._offsetNext,_=this._weightPrev,w=this._weightNext,T=(o-i)/(l-i),P=T*T,U=P*T,D=-_*U+2*_*P-_*T,z=(1+_)*U+(-1.5-2*_)*P+(-.5+_)*T+1,G=(-1-w)*U+(1.5+w)*P+.5*T,Q=w*U-w*P;for(let Y=0;Y!==f;++Y)h[Y]=D*d[x+Y]+z*d[y+Y]+G*d[g+Y]+Q*d[b+Y];return h}}class i3 extends zm{constructor(t,i,o,l){super(t,i,o,l)}interpolate_(t,i,o,l){const h=this.resultBuffer,d=this.sampleValues,f=this.valueSize,g=t*f,y=g-f,x=(o-i)/(l-i),b=1-x;for(let _=0;_!==f;++_)h[_]=d[y+_]*b+d[g+_]*x;return h}}class $6 extends zm{constructor(t,i,o,l){super(t,i,o,l)}interpolate_(t){return this.copySampleValue_(t-1)}}class Bl{constructor(t,i,o,l){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Zy(i,this.TimeBufferType),this.values=Zy(o,this.ValueBufferType),this.setInterpolation(l||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let o;if(i.toJSON!==this.toJSON)o=i.toJSON(t);else{o={name:t.name,times:Zy(t.times,Array),values:Zy(t.values,Array)};const l=t.getInterpolation();l!==t.DefaultInterpolation&&(o.interpolation=l)}return o.type=t.ValueTypeName,o}InterpolantFactoryMethodDiscrete(t){return new $6(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new i3(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new J6(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case zp:i=this.InterpolantFactoryMethodDiscrete;break;case Vp:i=this.InterpolantFactoryMethodLinear;break;case nw:i=this.InterpolantFactoryMethodSmooth}if(i===void 0){const o="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(t===this.DefaultInterpolation)throw new Error(o);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",o),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zp;case this.InterpolantFactoryMethodLinear:return Vp;case this.InterpolantFactoryMethodSmooth:return nw}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let o=0,l=i.length;o!==l;++o)i[o]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let o=0,l=i.length;o!==l;++o)i[o]*=t}return this}trim(t,i){const o=this.times,l=o.length;let h=0,d=l-1;for(;h!==l&&o[h]<t;)++h;for(;d!==-1&&o[d]>i;)--d;if(++d,h!==0||d!==l){h>=d&&(d=Math.max(d,1),h=d-1);const f=this.getValueSize();this.times=o.slice(h,d),this.values=this.values.slice(h*f,d*f)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const o=this.times,l=this.values,h=o.length;h===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let d=null;for(let g=0;g!==h;g++){const y=o[g];if(typeof y=="number"&&isNaN(y)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,y),t=!1;break}if(d!==null&&d>y){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,y,d),t=!1;break}d=y}if(l!==void 0&&(f=l,ArrayBuffer.isView(f)&&!(f instanceof DataView)))for(let g=0,y=l.length;g!==y;++g){const x=l[g];if(isNaN(x)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,x),t=!1;break}}var f;return t}optimize(){const t=this.times.slice(),i=this.values.slice(),o=this.getValueSize(),l=this.getInterpolation()===nw,h=t.length-1;let d=1;for(let f=1;f<h;++f){let g=!1;const y=t[f];if(y!==t[f+1]&&(f!==1||y!==t[0]))if(l)g=!0;else{const x=f*o,b=x-o,_=x+o;for(let w=0;w!==o;++w){const T=i[x+w];if(T!==i[b+w]||T!==i[_+w]){g=!0;break}}}if(g){if(f!==d){t[d]=t[f];const x=f*o,b=d*o;for(let _=0;_!==o;++_)i[b+_]=i[x+_]}++d}}if(h>0){t[d]=t[h];for(let f=h*o,g=d*o,y=0;y!==o;++y)i[g+y]=i[f+y];++d}return d!==t.length?(this.times=t.slice(0,d),this.values=i.slice(0,d*o)):(this.times=t,this.values=i),this}clone(){const t=this.times.slice(),i=this.values.slice(),o=new this.constructor(this.name,t,i);return o.createInterpolant=this.createInterpolant,o}}Bl.prototype.TimeBufferType=Float32Array,Bl.prototype.ValueBufferType=Float32Array,Bl.prototype.DefaultInterpolation=Vp;class pA extends Bl{constructor(t,i,o){super(t,i,o)}}pA.prototype.ValueTypeName="bool",pA.prototype.ValueBufferType=Array,pA.prototype.DefaultInterpolation=zp,pA.prototype.InterpolantFactoryMethodLinear=void 0,pA.prototype.InterpolantFactoryMethodSmooth=void 0;class r3 extends Bl{}r3.prototype.ValueTypeName="color";class AA extends Bl{}AA.prototype.ValueTypeName="number";class Z6 extends zm{constructor(t,i,o,l){super(t,i,o,l)}interpolate_(t,i,o,l){const h=this.resultBuffer,d=this.sampleValues,f=this.valueSize,g=(o-i)/(l-i);let y=t*f;for(let x=y+f;y!==x;y+=4)ra.slerpFlat(h,0,d,y-f,d,y,g);return h}}class fA extends Bl{InterpolantFactoryMethodLinear(t){return new Z6(this.times,this.values,this.getValueSize(),t)}}fA.prototype.ValueTypeName="quaternion",fA.prototype.InterpolantFactoryMethodSmooth=void 0;class mA extends Bl{constructor(t,i,o){super(t,i,o)}}mA.prototype.ValueTypeName="string",mA.prototype.ValueBufferType=Array,mA.prototype.DefaultInterpolation=zp,mA.prototype.InterpolantFactoryMethodLinear=void 0,mA.prototype.InterpolantFactoryMethodSmooth=void 0;class gA extends Bl{}gA.prototype.ValueTypeName="vector";class qw{constructor(t="",i=-1,o=[],l=2500){this.name=t,this.tracks=o,this.duration=i,this.blendMode=l,this.uuid=Yo(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],o=t.tracks,l=1/(t.fps||1);for(let d=0,f=o.length;d!==f;++d)i.push(ez(o[d]).scale(l));const h=new this(t.name,t.duration,i,t.blendMode);return h.uuid=t.uuid,h}static toJSON(t){const i=[],o=t.tracks,l={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let h=0,d=o.length;h!==d;++h)i.push(Bl.toJSON(o[h]));return l}static CreateFromMorphTargetSequence(t,i,o,l){const h=i.length,d=[];for(let f=0;f<h;f++){let g=[],y=[];g.push((f+h-1)%h,f,(f+1)%h),y.push(0,1,0);const x=K6(g);g=t3(g,1,x),y=t3(y,1,x),l||g[0]!==0||(g.push(h),y.push(y[0])),d.push(new AA(".morphTargetInfluences["+i[f].name+"]",g,y).scale(1/o))}return new this(t,-1,d)}static findByName(t,i){let o=t;if(!Array.isArray(t)){const l=t;o=l.geometry&&l.geometry.animations||l.animations}for(let l=0;l<o.length;l++)if(o[l].name===i)return o[l];return null}static CreateClipsFromMorphTargetSequences(t,i,o){const l={},h=/^([\w-]*?)([\d]+)$/;for(let f=0,g=t.length;f<g;f++){const y=t[f],x=y.name.match(h);if(x&&x.length>1){const b=x[1];let _=l[b];_||(l[b]=_=[]),_.push(y)}}const d=[];for(const f in l)d.push(this.CreateFromMorphTargetSequence(f,l[f],i,o));return d}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const o=function(x,b,_,w,T){if(_.length!==0){const P=[],U=[];n3(_,P,U,w),P.length!==0&&T.push(new x(b,P,U))}},l=[],h=t.name||"default",d=t.fps||30,f=t.blendMode;let g=t.length||-1;const y=t.hierarchy||[];for(let x=0;x<y.length;x++){const b=y[x].keys;if(b&&b.length!==0)if(b[0].morphTargets){const _={};let w;for(w=0;w<b.length;w++)if(b[w].morphTargets)for(let T=0;T<b[w].morphTargets.length;T++)_[b[w].morphTargets[T]]=-1;for(const T in _){const P=[],U=[];for(let D=0;D!==b[w].morphTargets.length;++D){const z=b[w];P.push(z.time),U.push(z.morphTarget===T?1:0)}l.push(new AA(".morphTargetInfluence["+T+"]",P,U))}g=_.length*d}else{const _=".bones["+i[x].name+"]";o(gA,_+".position",b,"pos",l),o(fA,_+".quaternion",b,"rot",l),o(gA,_+".scale",b,"scl",l)}}return l.length===0?null:new this(h,g,l,f)}resetDuration(){let t=0;for(let i=0,o=this.tracks.length;i!==o;++i){const l=this.tracks[i];t=Math.max(t,l.times[l.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ez(p){if(p.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return AA;case"vector":case"vector2":case"vector3":case"vector4":return gA;case"color":return r3;case"quaternion":return fA;case"bool":case"boolean":return pA;case"string":return mA}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}(p.type);if(p.times===void 0){const i=[],o=[];n3(p.keys,i,o,"value"),p.times=i,p.values=o}return t.parse!==void 0?t.parse(p):new t(p.name,p.times,p.values,p.interpolation)}const kh={enabled:!1,files:{},add:function(p,t){this.enabled!==!1&&(this.files[p]=t)},get:function(p){if(this.enabled!==!1)return this.files[p]},remove:function(p){delete this.files[p]},clear:function(){this.files={}}};class s3{constructor(t,i,o){const l=this;let h,d=!1,f=0,g=0;const y=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=o,this.itemStart=function(x){g++,d===!1&&l.onStart!==void 0&&l.onStart(x,f,g),d=!0},this.itemEnd=function(x){f++,l.onProgress!==void 0&&l.onProgress(x,f,g),f===g&&(d=!1,l.onLoad!==void 0&&l.onLoad())},this.itemError=function(x){l.onError!==void 0&&l.onError(x)},this.resolveURL=function(x){return h?h(x):x},this.setURLModifier=function(x){return h=x,this},this.addHandler=function(x,b){return y.push(x,b),this},this.removeHandler=function(x){const b=y.indexOf(x);return b!==-1&&y.splice(b,2),this},this.getHandler=function(x){for(let b=0,_=y.length;b<_;b+=2){const w=y[b],T=y[b+1];if(w.global&&(w.lastIndex=0),w.test(x))return T}return null}}}const tz=new s3;class tl{constructor(t){this.manager=t!==void 0?t:tz,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const o=this;return new Promise(function(l,h){o.load(t,l,i,h)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}tl.DEFAULT_MATERIAL_NAME="__DEFAULT";const Pc={};class nz extends Error{constructor(t,i){super(t),this.response=i}}class Rl extends tl{constructor(t){super(t)}load(t,i,o,l){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const h=kh.get(t);if(h!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(h),this.manager.itemEnd(t)},0),h;if(Pc[t]!==void 0)return void Pc[t].push({onLoad:i,onProgress:o,onError:l});Pc[t]=[],Pc[t].push({onLoad:i,onProgress:o,onError:l});const d=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),f=this.mimeType,g=this.responseType;fetch(d).then(y=>{if(y.status===200||y.status===0){if(y.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||y.body===void 0||y.body.getReader===void 0)return y;const x=Pc[t],b=y.body.getReader(),_=y.headers.get("X-File-Size")||y.headers.get("Content-Length"),w=_?parseInt(_):0,T=w!==0;let P=0;const U=new ReadableStream({start(D){(function z(){b.read().then(({done:G,value:Q})=>{if(G)D.close();else{P+=Q.byteLength;const Y=new ProgressEvent("progress",{lengthComputable:T,loaded:P,total:w});for(let q=0,K=x.length;q<K;q++){const ne=x[q];ne.onProgress&&ne.onProgress(Y)}D.enqueue(Q),z()}},G=>{D.error(G)})})()}});return new Response(U)}throw new nz(`fetch for "${y.url}" responded with ${y.status}: ${y.statusText}`,y)}).then(y=>{switch(g){case"arraybuffer":return y.arrayBuffer();case"blob":return y.blob();case"document":return y.text().then(x=>new DOMParser().parseFromString(x,f));case"json":return y.json();default:if(f===void 0)return y.text();{const x=/charset="?([^;"\s]*)"?/i.exec(f),b=x&&x[1]?x[1].toLowerCase():void 0,_=new TextDecoder(b);return y.arrayBuffer().then(w=>_.decode(w))}}}).then(y=>{kh.add(t,y);const x=Pc[t];delete Pc[t];for(let b=0,_=x.length;b<_;b++){const w=x[b];w.onLoad&&w.onLoad(y)}}).catch(y=>{const x=Pc[t];if(x===void 0)throw this.manager.itemError(t),y;delete Pc[t];for(let b=0,_=x.length;b<_;b++){const w=x[b];w.onError&&w.onError(y)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class iz extends tl{constructor(t){super(t)}load(t,i,o,l){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const h=this,d=kh.get(t);if(d!==void 0)return h.manager.itemStart(t),setTimeout(function(){i&&i(d),h.manager.itemEnd(t)},0),d;const f=Im("img");function g(){x(),kh.add(t,this),i&&i(this),h.manager.itemEnd(t)}function y(b){x(),l&&l(b),h.manager.itemError(t),h.manager.itemEnd(t)}function x(){f.removeEventListener("load",g,!1),f.removeEventListener("error",y,!1)}return f.addEventListener("load",g,!1),f.addEventListener("error",y,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(f.crossOrigin=this.crossOrigin),h.manager.itemStart(t),f.src=t,f}}class rz extends tl{constructor(t){super(t)}load(t,i,o,l){const h=this,d=new Fm,f=new Rl(this.manager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(h.withCredentials),f.load(t,function(g){let y;try{y=h.parse(g)}catch(x){if(l===void 0)return void console.error(x);l(x)}y.image!==void 0?d.image=y.image:y.data!==void 0&&(d.image.width=y.width,d.image.height=y.height,d.image.data=y.data),d.wrapS=y.wrapS!==void 0?y.wrapS:rs,d.wrapT=y.wrapT!==void 0?y.wrapT:rs,d.magFilter=y.magFilter!==void 0?y.magFilter:Fi,d.minFilter=y.minFilter!==void 0?y.minFilter:Fi,d.anisotropy=y.anisotropy!==void 0?y.anisotropy:1,y.colorSpace!==void 0&&(d.colorSpace=y.colorSpace),y.flipY!==void 0&&(d.flipY=y.flipY),y.format!==void 0&&(d.format=y.format),y.type!==void 0&&(d.type=y.type),y.mipmaps!==void 0&&(d.mipmaps=y.mipmaps,d.minFilter=mo),y.mipmapCount===1&&(d.minFilter=Fi),y.generateMipmaps!==void 0&&(d.generateMipmaps=y.generateMipmaps),d.needsUpdate=!0,i&&i(d,y)},o,l),d}}class a3 extends tl{constructor(t){super(t)}load(t,i,o,l){const h=new qi,d=new iz(this.manager);return d.setCrossOrigin(this.crossOrigin),d.setPath(this.path),d.load(t,function(f){h.image=f,h.needsUpdate=!0,i!==void 0&&i(h)},o,l),h}}class eE extends $i{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new fn(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}const Xw=new In,o3=new ve,l3=new ve;class Yw{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Hn(512,512),this.map=null,this.mapPass=null,this.matrix=new In,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Bw,this._frameExtents=new Hn(1,1),this._viewportCount=1,this._viewports=[new Oi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,o=this.matrix;o3.setFromMatrixPosition(t.matrixWorld),i.position.copy(o3),l3.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(l3),i.updateMatrixWorld(),Xw.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Xw),o.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),o.multiply(Xw)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class sz extends Yw{constructor(){super(new vs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,o=2*Yp*t.angle*this.focus,l=this.mapSize.width/this.mapSize.height,h=t.distance||i.far;o===i.fov&&l===i.aspect&&h===i.far||(i.fov=o,i.aspect=l,i.far=h,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class az extends eE{constructor(t,i,o=0,l=Math.PI/3,h=0,d=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy($i.DEFAULT_UP),this.updateMatrix(),this.target=new $i,this.distance=o,this.angle=l,this.penumbra=h,this.decay=d,this.map=null,this.shadow=new sz}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const c3=new In,Vm=new ve,Kw=new ve;class oz extends Yw{constructor(){super(new vs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Hn(4,2),this._viewportCount=6,this._viewports=[new Oi(2,1,1,1),new Oi(0,1,1,1),new Oi(3,1,1,1),new Oi(1,1,1,1),new Oi(3,0,1,1),new Oi(1,0,1,1)],this._cubeDirections=[new ve(1,0,0),new ve(-1,0,0),new ve(0,0,1),new ve(0,0,-1),new ve(0,1,0),new ve(0,-1,0)],this._cubeUps=[new ve(0,1,0),new ve(0,1,0),new ve(0,1,0),new ve(0,1,0),new ve(0,0,1),new ve(0,0,-1)]}updateMatrices(t,i=0){const o=this.camera,l=this.matrix,h=t.distance||o.far;h!==o.far&&(o.far=h,o.updateProjectionMatrix()),Vm.setFromMatrixPosition(t.matrixWorld),o.position.copy(Vm),Kw.copy(o.position),Kw.add(this._cubeDirections[i]),o.up.copy(this._cubeUps[i]),o.lookAt(Kw),o.updateMatrixWorld(),l.makeTranslation(-Vm.x,-Vm.y,-Vm.z),c3.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this._frustum.setFromProjectionMatrix(c3)}}class h3 extends eE{constructor(t,i,o=0,l=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=o,this.decay=l,this.shadow=new oz}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class lz extends Yw{constructor(){super(new cA(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class u3 extends eE{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy($i.DEFAULT_UP),this.updateMatrix(),this.target=new $i,this.shadow=new lz}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class cz{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ve)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const o=t.x,l=t.y,h=t.z,d=this.coefficients;return i.copy(d[0]).multiplyScalar(.282095),i.addScaledVector(d[1],.488603*l),i.addScaledVector(d[2],.488603*h),i.addScaledVector(d[3],.488603*o),i.addScaledVector(d[4],o*l*1.092548),i.addScaledVector(d[5],l*h*1.092548),i.addScaledVector(d[6],.315392*(3*h*h-1)),i.addScaledVector(d[7],o*h*1.092548),i.addScaledVector(d[8],.546274*(o*o-l*l)),i}getIrradianceAt(t,i){const o=t.x,l=t.y,h=t.z,d=this.coefficients;return i.copy(d[0]).multiplyScalar(.886227),i.addScaledVector(d[1],1.023328*l),i.addScaledVector(d[2],1.023328*h),i.addScaledVector(d[3],1.023328*o),i.addScaledVector(d[4],.858086*o*l),i.addScaledVector(d[5],.858086*l*h),i.addScaledVector(d[6],.743125*h*h-.247708),i.addScaledVector(d[7],.858086*o*h),i.addScaledVector(d[8],.429043*(o*o-l*l)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let o=0;o<9;o++)this.coefficients[o].addScaledVector(t.coefficients[o],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let o=0;o<9;o++)this.coefficients[o].lerp(t.coefficients[o],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const o=this.coefficients;for(let l=0;l<9;l++)o[l].fromArray(t,i+3*l);return this}toArray(t=[],i=0){const o=this.coefficients;for(let l=0;l<9;l++)o[l].toArray(t,i+3*l);return t}static getBasisAt(t,i){const o=t.x,l=t.y,h=t.z;i[0]=.282095,i[1]=.488603*l,i[2]=.488603*h,i[3]=.488603*o,i[4]=1.092548*o*l,i[5]=1.092548*l*h,i[6]=.315392*(3*h*h-1),i[7]=1.092548*o*h,i[8]=.546274*(o*o-l*l)}}class hz extends eE{constructor(t=new cz,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class Wm{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let o=0,l=t.length;o<l;o++)i+=String.fromCharCode(t[o]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class uz extends tl{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,o,l){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const h=this,d=kh.get(t);if(d!==void 0)return h.manager.itemStart(t),d.then?void d.then(y=>{i&&i(y),h.manager.itemEnd(t)}).catch(y=>{l&&l(y)}):(setTimeout(function(){i&&i(d),h.manager.itemEnd(t)},0),d);const f={};f.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",f.headers=this.requestHeader;const g=fetch(t,f).then(function(y){return y.blob()}).then(function(y){return createImageBitmap(y,Object.assign(h.options,{colorSpaceConversion:"none"}))}).then(function(y){return kh.add(t,y),i&&i(y),h.manager.itemEnd(t),y}).catch(function(y){l&&l(y),kh.remove(t),h.manager.itemError(t),h.manager.itemEnd(t)});kh.add(t,g),h.manager.itemStart(t)}}class dz{constructor(t,i,o){let l,h,d;switch(this.binding=t,this.valueSize=o,i){case"quaternion":l=this._slerp,h=this._slerpAdditive,d=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*o),this._workIndex=5;break;case"string":case"bool":l=this._select,h=this._select,d=this._setAdditiveIdentityOther,this.buffer=new Array(5*o);break;default:l=this._lerp,h=this._lerpAdditive,d=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*o)}this._mixBufferRegion=l,this._mixBufferRegionAdditive=h,this._setIdentity=d,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const o=this.buffer,l=this.valueSize,h=t*l+l;let d=this.cumulativeWeight;if(d===0){for(let f=0;f!==l;++f)o[h+f]=o[f];d=i}else{d+=i;const f=i/d;this._mixBufferRegion(o,h,0,f,l)}this.cumulativeWeight=d}accumulateAdditive(t){const i=this.buffer,o=this.valueSize,l=o*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,l,0,t,o),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,o=this.buffer,l=t*i+i,h=this.cumulativeWeight,d=this.cumulativeWeightAdditive,f=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,h<1){const g=i*this._origIndex;this._mixBufferRegion(o,l,g,1-h,i)}d>0&&this._mixBufferRegionAdditive(o,l,this._addIndex*i,1,i);for(let g=i,y=i+i;g!==y;++g)if(o[g]!==o[g+i]){f.setValue(o,l);break}}saveOriginalState(){const t=this.binding,i=this.buffer,o=this.valueSize,l=o*this._origIndex;t.getValue(i,l);for(let h=o,d=l;h!==d;++h)i[h]=i[l+h%o];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let o=t;o<i;o++)this.buffer[o]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let o=0;o<this.valueSize;o++)this.buffer[i+o]=this.buffer[t+o]}_select(t,i,o,l,h){if(l>=.5)for(let d=0;d!==h;++d)t[i+d]=t[o+d]}_slerp(t,i,o,l){ra.slerpFlat(t,i,t,i,t,o,l)}_slerpAdditive(t,i,o,l,h){const d=this._workIndex*h;ra.multiplyQuaternionsFlat(t,d,t,i,t,o),ra.slerpFlat(t,i,t,i,t,d,l)}_lerp(t,i,o,l,h){const d=1-l;for(let f=0;f!==h;++f){const g=i+f;t[g]=t[g]*d+t[o+f]*l}}_lerpAdditive(t,i,o,l,h){for(let d=0;d!==h;++d){const f=i+d;t[f]=t[f]+t[o+d]*l}}}const Jw="\\[\\]\\.:\\/",pz=new RegExp("["+Jw+"]","g"),$w="[^"+Jw+"]",Az="[^"+Jw.replace("\\.","")+"]",fz=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",$w)+/(WCOD+)?/.source.replace("WCOD",Az)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",$w)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",$w)+"$"),mz=["material","materials","bones","map"];class xi{constructor(t,i,o){this.path=i,this.parsedPath=o||xi.parseTrackName(i),this.node=xi.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,o){return t&&t.isAnimationObjectGroup?new xi.Composite(t,i,o):new xi(t,i,o)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(pz,"")}static parseTrackName(t){const i=fz.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const o={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},l=o.nodeName&&o.nodeName.lastIndexOf(".");if(l!==void 0&&l!==-1){const h=o.nodeName.substring(l+1);mz.indexOf(h)!==-1&&(o.nodeName=o.nodeName.substring(0,l),o.objectName=h)}if(o.propertyName===null||o.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return o}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const o=t.skeleton.getBoneByName(i);if(o!==void 0)return o}if(t.children){const o=function(h){for(let d=0;d<h.length;d++){const f=h[d];if(f.name===i||f.uuid===i)return f;const g=o(f.children);if(g)return g}return null},l=o(t.children);if(l)return l}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const o=this.resolvedProperty;for(let l=0,h=o.length;l!==h;++l)t[i++]=o[l]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const o=this.resolvedProperty;for(let l=0,h=o.length;l!==h;++l)o[l]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const o=this.resolvedProperty;for(let l=0,h=o.length;l!==h;++l)o[l]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const o=this.resolvedProperty;for(let l=0,h=o.length;l!==h;++l)o[l]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,o=i.objectName,l=i.propertyName;let h=i.propertyIndex;if(t||(t=xi.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(o){let y=i.objectIndex;switch(o){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let x=0;x<t.length;x++)if(t[x].name===y){y=x;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(t[o]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[o]}if(y!==void 0){if(t[y]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[y]}}const d=t[l];if(d===void 0){const y=i.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+y+"."+l+" but it wasn't found.",t)}let f=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?f=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(f=this.Versioning.MatrixWorldNeedsUpdate);let g=this.BindingType.Direct;if(h!==void 0){if(l==="morphTargetInfluences"){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);t.morphTargetDictionary[h]!==void 0&&(h=t.morphTargetDictionary[h])}g=this.BindingType.ArrayElement,this.resolvedProperty=d,this.propertyIndex=h}else d.fromArray!==void 0&&d.toArray!==void 0?(g=this.BindingType.HasFromToArray,this.resolvedProperty=d):Array.isArray(d)?(g=this.BindingType.EntireArray,this.resolvedProperty=d):this.propertyName=l;this.getValue=this.GetterByBindingType[g],this.setValue=this.SetterByBindingTypeAndVersioning[g][f]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}xi.Composite=class{constructor(p,t,i){const o=i||xi.parseTrackName(t);this._targetGroup=p,this._bindings=p.subscribe_(t,o)}getValue(p,t){this.bind();const i=this._targetGroup.nCachedObjects_,o=this._bindings[i];o!==void 0&&o.getValue(p,t)}setValue(p,t){const i=this._bindings;for(let o=this._targetGroup.nCachedObjects_,l=i.length;o!==l;++o)i[o].setValue(p,t)}bind(){const p=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=p.length;t!==i;++t)p[t].bind()}unbind(){const p=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=p.length;t!==i;++t)p[t].unbind()}},xi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},xi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},xi.prototype.GetterByBindingType=[xi.prototype._getValue_direct,xi.prototype._getValue_array,xi.prototype._getValue_arrayElement,xi.prototype._getValue_toArray],xi.prototype.SetterByBindingTypeAndVersioning=[[xi.prototype._setValue_direct,xi.prototype._setValue_direct_setNeedsUpdate,xi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_array,xi.prototype._setValue_array_setNeedsUpdate,xi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_arrayElement,xi.prototype._setValue_arrayElement_setNeedsUpdate,xi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xi.prototype._setValue_fromArray,xi.prototype._setValue_fromArray_setNeedsUpdate,xi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class gz{constructor(t,i,o=null,l=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=o,this.blendMode=l;const h=i.tracks,d=h.length,f=new Array(d),g={endingStart:Wp,endingEnd:Wp};for(let y=0;y!==d;++y){const x=h[y].createInterpolant(null);f[y]=x,x.settings=g}this._interpolantSettings=g,this._interpolants=f,this._propertyBindings=new Array(d),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LR,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,o){if(t.fadeOut(i),this.fadeIn(i),o){const l=this._clip.duration,h=t._clip.duration,d=h/l,f=l/h;t.warp(1,d,i),this.warp(f,1,i)}return this}crossFadeTo(t,i,o){return t.crossFadeFrom(this,i,o)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,o){const l=this._mixer,h=l.time,d=this.timeScale;let f=this._timeScaleInterpolant;f===null&&(f=l._lendControlInterpolant(),this._timeScaleInterpolant=f);const g=f.parameterPositions,y=f.sampleValues;return g[0]=h,g[1]=h+o,y[0]=t/d,y[1]=i/d,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,o,l){if(!this.enabled)return void this._updateWeight(t);const h=this._startTime;if(h!==null){const g=(t-h)*o;g<0||o===0?i=0:(this._startTime=null,i=o*g)}i*=this._updateTimeScale(t);const d=this._updateTime(i),f=this._updateWeight(t);if(f>0){const g=this._interpolants,y=this._propertyBindings;if(this.blendMode===2501)for(let x=0,b=g.length;x!==b;++x)g[x].evaluate(d),y[x].accumulateAdditive(f);else for(let x=0,b=g.length;x!==b;++x)g[x].evaluate(d),y[x].accumulate(l,f)}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const o=this._weightInterpolant;if(o!==null){const l=o.evaluate(t)[0];i*=l,t>o.parameterPositions[1]&&(this.stopFading(),l===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const o=this._timeScaleInterpolant;o!==null&&(i*=o.evaluate(t)[0],t>o.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i))}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,o=this.loop;let l=this.time+t,h=this._loopCount;const d=o===tw;if(t===0)return h===-1||!d||1&~h?l:i-l;if(o===2200){h===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(l>=i)l=i;else{if(!(l<0)){this.time=l;break e}l=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(h===-1&&(t>=0?(h=0,this._setEndings(!0,this.repetitions===0,d)):this._setEndings(this.repetitions===0,!0,d)),l>=i||l<0){const f=Math.floor(l/i);l-=i*f,h+=Math.abs(f);const g=this.repetitions-h;if(g<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,l=t>0?i:0,this.time=l,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(g===1){const y=t<0;this._setEndings(y,!y,d)}else this._setEndings(!1,!1,d);this._loopCount=h,this.time=l,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=l;if(d&&!(1&~h))return i-l}return l}_setEndings(t,i,o){const l=this._interpolantSettings;o?(l.endingStart=jp,l.endingEnd=jp):(l.endingStart=t?this.zeroSlopeAtStart?jp:Wp:Ay,l.endingEnd=i?this.zeroSlopeAtEnd?jp:Wp:Ay)}_scheduleFading(t,i,o){const l=this._mixer,h=l.time;let d=this._weightInterpolant;d===null&&(d=l._lendControlInterpolant(),this._weightInterpolant=d);const f=d.parameterPositions,g=d.sampleValues;return f[0]=h,g[0]=i,f[1]=h+t,g[1]=o,this}}const vz=new Float32Array(1);class yz extends Xo{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const o=t._localRoot||this._root,l=t._clip.tracks,h=l.length,d=t._propertyBindings,f=t._interpolants,g=o.uuid,y=this._bindingsByRootAndName;let x=y[g];x===void 0&&(x={},y[g]=x);for(let b=0;b!==h;++b){const _=l[b],w=_.name;let T=x[w];if(T!==void 0)++T.referenceCount,d[b]=T;else{if(T=d[b],T!==void 0){T._cacheIndex===null&&(++T.referenceCount,this._addInactiveBinding(T,g,w));continue}const P=i&&i._propertyBindings[b].binding.parsedPath;T=new dz(xi.create(o,w,P),_.ValueTypeName,_.getValueSize()),++T.referenceCount,this._addInactiveBinding(T,g,w),d[b]=T}f[b].resultBuffer=T.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const o=(t._localRoot||this._root).uuid,l=t._clip.uuid,h=this._actionsByClip[l];this._bindAction(t,h&&h.knownActions[0]),this._addInactiveAction(t,l,o)}const i=t._propertyBindings;for(let o=0,l=i.length;o!==l;++o){const h=i[o];h.useCount++==0&&(this._lendBinding(h),h.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let o=0,l=i.length;o!==l;++o){const h=i[o];--h.useCount==0&&(h.restoreOriginalState(),this._takeBackBinding(h))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,o){const l=this._actions,h=this._actionsByClip;let d=h[i];if(d===void 0)d={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,h[i]=d;else{const f=d.knownActions;t._byClipCacheIndex=f.length,f.push(t)}t._cacheIndex=l.length,l.push(t),d.actionByRoot[o]=t}_removeInactiveAction(t){const i=this._actions,o=i[i.length-1],l=t._cacheIndex;o._cacheIndex=l,i[l]=o,i.pop(),t._cacheIndex=null;const h=t._clip.uuid,d=this._actionsByClip,f=d[h],g=f.knownActions,y=g[g.length-1],x=t._byClipCacheIndex;y._byClipCacheIndex=x,g[x]=y,g.pop(),t._byClipCacheIndex=null,delete f.actionByRoot[(t._localRoot||this._root).uuid],g.length===0&&delete d[h],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let o=0,l=i.length;o!==l;++o){const h=i[o];--h.referenceCount==0&&this._removeInactiveBinding(h)}}_lendAction(t){const i=this._actions,o=t._cacheIndex,l=this._nActiveActions++,h=i[l];t._cacheIndex=l,i[l]=t,h._cacheIndex=o,i[o]=h}_takeBackAction(t){const i=this._actions,o=t._cacheIndex,l=--this._nActiveActions,h=i[l];t._cacheIndex=l,i[l]=t,h._cacheIndex=o,i[o]=h}_addInactiveBinding(t,i,o){const l=this._bindingsByRootAndName,h=this._bindings;let d=l[i];d===void 0&&(d={},l[i]=d),d[o]=t,t._cacheIndex=h.length,h.push(t)}_removeInactiveBinding(t){const i=this._bindings,o=t.binding,l=o.rootNode.uuid,h=o.path,d=this._bindingsByRootAndName,f=d[l],g=i[i.length-1],y=t._cacheIndex;g._cacheIndex=y,i[y]=g,i.pop(),delete f[h],Object.keys(f).length===0&&delete d[l]}_lendBinding(t){const i=this._bindings,o=t._cacheIndex,l=this._nActiveBindings++,h=i[l];t._cacheIndex=l,i[l]=t,h._cacheIndex=o,i[o]=h}_takeBackBinding(t){const i=this._bindings,o=t._cacheIndex,l=--this._nActiveBindings,h=i[l];t._cacheIndex=l,i[l]=t,h._cacheIndex=o,i[o]=h}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let o=t[i];return o===void 0&&(o=new i3(new Float32Array(2),new Float32Array(2),1,vz),o.__cacheIndex=i,t[i]=o),o}_takeBackControlInterpolant(t){const i=this._controlInterpolants,o=t.__cacheIndex,l=--this._nActiveControlInterpolants,h=i[l];t.__cacheIndex=l,i[l]=t,h.__cacheIndex=o,i[o]=h}clipAction(t,i,o){const l=i||this._root,h=l.uuid;let d=typeof t=="string"?qw.findByName(l,t):t;const f=d!==null?d.uuid:t,g=this._actionsByClip[f];let y=null;if(o===void 0&&(o=d!==null?d.blendMode:MG),g!==void 0){const b=g.actionByRoot[h];if(b!==void 0&&b.blendMode===o)return b;y=g.knownActions[0],d===null&&(d=y._clip)}if(d===null)return null;const x=new gz(this,d,i,o);return this._bindAction(x,y),this._addInactiveAction(x,f,h),x}existingAction(t,i){const o=i||this._root,l=o.uuid,h=typeof t=="string"?qw.findByName(o,t):t,d=h?h.uuid:t,f=this._actionsByClip[d];return f!==void 0&&f.actionByRoot[l]||null}stopAllAction(){const t=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;const i=this._actions,o=this._nActiveActions,l=this.time+=t,h=Math.sign(t),d=this._accuIndex^=1;for(let y=0;y!==o;++y)i[y]._update(l,t,h,d);const f=this._bindings,g=this._nActiveBindings;for(let y=0;y!==g;++y)f[y].apply(d);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,o=t.uuid,l=this._actionsByClip,h=l[o];if(h!==void 0){const d=h.knownActions;for(let f=0,g=d.length;f!==g;++f){const y=d[f];this._deactivateAction(y);const x=y._cacheIndex,b=i[i.length-1];y._cacheIndex=null,y._byClipCacheIndex=null,b._cacheIndex=x,i[x]=b,i.pop(),this._removeInactiveBindingsForAction(y)}delete l[o]}}uncacheRoot(t){const i=t.uuid,o=this._actionsByClip;for(const h in o){const d=o[h].actionByRoot[i];d!==void 0&&(this._deactivateAction(d),this._removeInactiveAction(d))}const l=this._bindingsByRootAndName[i];if(l!==void 0)for(const h in l){const d=l[h];d.restoreOriginalState(),this._removeInactiveBinding(d)}}uncacheAction(t,i){const o=this.existingAction(t,i);o!==null&&(this._deactivateAction(o),this._removeInactiveAction(o))}}class iS{constructor(t){this.value=t}clone(){return new iS(this.value.clone===void 0?this.value:this.value.clone())}}const d3=new In;function p3(p,t){return p.distance-t.distance}function Zw(p,t,i,o){let l=!0;if(p.layers.test(t.layers)&&p.raycast(t,i)===!1&&(l=!1),l===!0&&o===!0){const h=p.children;for(let d=0,f=h.length;d<f;d++)Zw(h[d],t,i,!0)}}class tE{constructor(t=1,i=0,o=0){return this.radius=t,this.phi=i,this.theta=o,this}set(t,i,o){return this.radius=t,this.phi=i,this.theta=o,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,o){return this.radius=Math.sqrt(t*t+i*i+o*o),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,o),this.phi=Math.acos(ms(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ny}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ny);const nE=window,e1=nE.ShadowRoot&&(nE.ShadyCSS===void 0||nE.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,A3=Symbol(),f3=new WeakMap;class Ez{constructor(t,i,o){if(this._$cssResult$=!0,o!==A3)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=i}get styleSheet(){let t=this.o;const i=this.t;if(e1&&t===void 0){const o=i!==void 0&&i.length===1;o&&(t=f3.get(i)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),o&&f3.set(i,t))}return t}toString(){return this.cssText}}const m3=e1?p=>p:p=>p instanceof CSSStyleSheet?(t=>{let i="";for(const o of t.cssRules)i+=o.cssText;return(o=>new Ez(typeof o=="string"?o:o+"",void 0,A3))(i)})(p):p;var t1;const iE=window,g3=iE.trustedTypes,xz=g3?g3.emptyScript:"",v3=iE.reactiveElementPolyfillSupport,n1={toAttribute(p,t){switch(t){case Boolean:p=p?xz:null;break;case Object:case Array:p=p==null?p:JSON.stringify(p)}return p},fromAttribute(p,t){let i=p;switch(t){case Boolean:i=p!==null;break;case Number:i=p===null?null:Number(p);break;case Object:case Array:try{i=JSON.parse(p)}catch{i=null}}return i}},y3=(p,t)=>t!==p&&(t==t||p==p),i1={attribute:!0,type:String,converter:n1,reflect:!1,hasChanged:y3},r1="finalized";class jm extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var i;this.finalize(),((i=this.h)!==null&&i!==void 0?i:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach((i,o)=>{const l=this._$Ep(o,i);l!==void 0&&(this._$Ev.set(l,o),t.push(l))}),t}static createProperty(t,i=i1){if(i.state&&(i.attribute=!1),this.finalize(),this.elementProperties.set(t,i),!i.noAccessor&&!this.prototype.hasOwnProperty(t)){const o=typeof t=="symbol"?Symbol():"__"+t,l=this.getPropertyDescriptor(t,o,i);l!==void 0&&Object.defineProperty(this.prototype,t,l)}}static getPropertyDescriptor(t,i,o){return{get(){return this[i]},set(l){const h=this[t];this[i]=l,this.requestUpdate(t,h,o)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||i1}static finalize(){if(this.hasOwnProperty(r1))return!1;this[r1]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),t.h!==void 0&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const i=this.properties,o=[...Object.getOwnPropertyNames(i),...Object.getOwnPropertySymbols(i)];for(const l of o)this.createProperty(l,i[l])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const i=[];if(Array.isArray(t)){const o=new Set(t.flat(1/0).reverse());for(const l of o)i.unshift(m3(l))}else t!==void 0&&i.push(m3(t));return i}static _$Ep(t,i){const o=i.attribute;return o===!1?void 0:typeof o=="string"?o:typeof t=="string"?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise(i=>this.enableUpdating=i),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(t=this.constructor.h)===null||t===void 0||t.forEach(i=>i(this))}addController(t){var i,o;((i=this._$ES)!==null&&i!==void 0?i:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((o=t.hostConnected)===null||o===void 0||o.call(t))}removeController(t){var i;(i=this._$ES)===null||i===void 0||i.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((t,i)=>{this.hasOwnProperty(i)&&(this._$Ei.set(i,this[i]),delete this[i])})}createRenderRoot(){var t;const i=(t=this.shadowRoot)!==null&&t!==void 0?t:this.attachShadow(this.constructor.shadowRootOptions);return((o,l)=>{e1?o.adoptedStyleSheets=l.map(h=>h instanceof CSSStyleSheet?h:h.styleSheet):l.forEach(h=>{const d=document.createElement("style"),f=nE.litNonce;f!==void 0&&d.setAttribute("nonce",f),d.textContent=h.cssText,o.appendChild(d)})})(i,this.constructor.elementStyles),i}connectedCallback(){var t;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)===null||t===void 0||t.forEach(i=>{var o;return(o=i.hostConnected)===null||o===void 0?void 0:o.call(i)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)===null||t===void 0||t.forEach(i=>{var o;return(o=i.hostDisconnected)===null||o===void 0?void 0:o.call(i)})}attributeChangedCallback(t,i,o){this._$AK(t,o)}_$EO(t,i,o=i1){var l;const h=this.constructor._$Ep(t,o);if(h!==void 0&&o.reflect===!0){const d=(((l=o.converter)===null||l===void 0?void 0:l.toAttribute)!==void 0?o.converter:n1).toAttribute(i,o.type);this._$El=t,d==null?this.removeAttribute(h):this.setAttribute(h,d),this._$El=null}}_$AK(t,i){var o;const l=this.constructor,h=l._$Ev.get(t);if(h!==void 0&&this._$El!==h){const d=l.getPropertyOptions(h),f=typeof d.converter=="function"?{fromAttribute:d.converter}:((o=d.converter)===null||o===void 0?void 0:o.fromAttribute)!==void 0?d.converter:n1;this._$El=h,this[h]=f.fromAttribute(i,d.type),this._$El=null}}requestUpdate(t,i,o){let l=!0;t!==void 0&&(((o=o||this.constructor.getPropertyOptions(t)).hasChanged||y3)(this[t],i)?(this._$AL.has(t)||this._$AL.set(t,i),o.reflect===!0&&this._$El!==t&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(t,o))):l=!1),!this.isUpdatePending&&l&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(i){Promise.reject(i)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((l,h)=>this[h]=l),this._$Ei=void 0);let i=!1;const o=this._$AL;try{i=this.shouldUpdate(o),i?(this.willUpdate(o),(t=this._$ES)===null||t===void 0||t.forEach(l=>{var h;return(h=l.hostUpdate)===null||h===void 0?void 0:h.call(l)}),this.update(o)):this._$Ek()}catch(l){throw i=!1,this._$Ek(),l}i&&this._$AE(o)}willUpdate(t){}_$AE(t){var i;(i=this._$ES)===null||i===void 0||i.forEach(o=>{var l;return(l=o.hostUpdated)===null||l===void 0?void 0:l.call(o)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){this._$EC!==void 0&&(this._$EC.forEach((i,o)=>this._$EO(o,this[o],i)),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var s1;jm[r1]=!0,jm.elementProperties=new Map,jm.elementStyles=[],jm.shadowRootOptions={mode:"open"},v3?.({ReactiveElement:jm}),((t1=iE.reactiveElementVersions)!==null&&t1!==void 0?t1:iE.reactiveElementVersions=[]).push("1.6.3");const rE=window,vA=rE.trustedTypes,E3=vA?vA.createPolicy("lit-html",{createHTML:p=>p}):void 0,a1="$lit$",Qh=`lit$${(Math.random()+"").slice(9)}$`,x3="?"+Qh,_z=`<${x3}>`,vd=document,qm=()=>vd.createComment(""),Xm=p=>p===null||typeof p!="object"&&typeof p!="function",_3=Array.isArray,o1=`[ 	
\f\r]`,Ym=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,b3=/-->/g,C3=/>/g,yd=RegExp(`>|${o1}(?:([^\\s"'>=/]+)(${o1}*=${o1}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),w3=/'/g,M3=/"/g,S3=/^(?:script|style|textarea|title)$/i,sE=(p=>(t,...i)=>({_$litType$:p,strings:t,values:i}))(1),yA=Symbol.for("lit-noChange"),ys=Symbol.for("lit-nothing"),I3=new WeakMap,Ed=vd.createTreeWalker(vd,129,null,!1);function T3(p,t){if(!Array.isArray(p)||!p.hasOwnProperty("raw"))throw Error("invalid template strings array");return E3!==void 0?E3.createHTML(t):t}const bz=(p,t)=>{const i=p.length-1,o=[];let l,h=t===2?"<svg>":"",d=Ym;for(let f=0;f<i;f++){const g=p[f];let y,x,b=-1,_=0;for(;_<g.length&&(d.lastIndex=_,x=d.exec(g),x!==null);)_=d.lastIndex,d===Ym?x[1]==="!--"?d=b3:x[1]!==void 0?d=C3:x[2]!==void 0?(S3.test(x[2])&&(l=RegExp("</"+x[2],"g")),d=yd):x[3]!==void 0&&(d=yd):d===yd?x[0]===">"?(d=l??Ym,b=-1):x[1]===void 0?b=-2:(b=d.lastIndex-x[2].length,y=x[1],d=x[3]===void 0?yd:x[3]==='"'?M3:w3):d===M3||d===w3?d=yd:d===b3||d===C3?d=Ym:(d=yd,l=void 0);const w=d===yd&&p[f+1].startsWith("/>")?" ":"";h+=d===Ym?g+_z:b>=0?(o.push(y),g.slice(0,b)+a1+g.slice(b)+Qh+w):g+Qh+(b===-2?(o.push(void 0),f):w)}return[T3(p,h+(p[i]||"<?>")+(t===2?"</svg>":"")),o]};class wg{constructor({strings:t,_$litType$:i},o){let l;this.parts=[];let h=0,d=0;const f=t.length-1,g=this.parts,[y,x]=bz(t,i);if(this.el=wg.createElement(y,o),Ed.currentNode=this.el.content,i===2){const b=this.el.content,_=b.firstChild;_.remove(),b.append(..._.childNodes)}for(;(l=Ed.nextNode())!==null&&g.length<f;){if(l.nodeType===1){if(l.hasAttributes()){const b=[];for(const _ of l.getAttributeNames())if(_.endsWith(a1)||_.startsWith(Qh)){const w=x[d++];if(b.push(_),w!==void 0){const T=l.getAttribute(w.toLowerCase()+a1).split(Qh),P=/([.?@])?(.*)/.exec(w);g.push({type:1,index:h,name:P[2],strings:T,ctor:P[1]==="."?wz:P[1]==="?"?Sz:P[1]==="@"?Iz:aE})}else g.push({type:6,index:h})}for(const _ of b)l.removeAttribute(_)}if(S3.test(l.tagName)){const b=l.textContent.split(Qh),_=b.length-1;if(_>0){l.textContent=vA?vA.emptyScript:"";for(let w=0;w<_;w++)l.append(b[w],qm()),Ed.nextNode(),g.push({type:2,index:++h});l.append(b[_],qm())}}}else if(l.nodeType===8)if(l.data===x3)g.push({type:2,index:h});else{let b=-1;for(;(b=l.data.indexOf(Qh,b+1))!==-1;)g.push({type:7,index:h}),b+=Qh.length-1}h++}}static createElement(t,i){const o=vd.createElement("template");return o.innerHTML=t,o}}function EA(p,t,i=p,o){var l,h,d,f;if(t===yA)return t;let g=o!==void 0?(l=i._$Co)===null||l===void 0?void 0:l[o]:i._$Cl;const y=Xm(t)?void 0:t._$litDirective$;return g?.constructor!==y&&((h=g?._$AO)===null||h===void 0||h.call(g,!1),y===void 0?g=void 0:(g=new y(p),g._$AT(p,i,o)),o!==void 0?((d=(f=i)._$Co)!==null&&d!==void 0?d:f._$Co=[])[o]=g:i._$Cl=g),g!==void 0&&(t=EA(p,g._$AS(p,t.values),g,o)),t}class Cz{constructor(t,i){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var i;const{el:{content:o},parts:l}=this._$AD,h=((i=t?.creationScope)!==null&&i!==void 0?i:vd).importNode(o,!0);Ed.currentNode=h;let d=Ed.nextNode(),f=0,g=0,y=l[0];for(;y!==void 0;){if(f===y.index){let x;y.type===2?x=new Mg(d,d.nextSibling,this,t):y.type===1?x=new y.ctor(d,y.name,y.strings,this,t):y.type===6&&(x=new Tz(d,this,t)),this._$AV.push(x),y=l[++g]}f!==y?.index&&(d=Ed.nextNode(),f++)}return Ed.currentNode=vd,h}v(t){let i=0;for(const o of this._$AV)o!==void 0&&(o.strings!==void 0?(o._$AI(t,o,i),i+=o.strings.length-2):o._$AI(t[i])),i++}}class Mg{constructor(t,i,o,l){var h;this.type=2,this._$AH=ys,this._$AN=void 0,this._$AA=t,this._$AB=i,this._$AM=o,this.options=l,this._$Cp=(h=l?.isConnected)===null||h===void 0||h}get _$AU(){var t,i;return(i=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&i!==void 0?i:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&t?.nodeType===11&&(t=i.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,i=this){t=EA(this,t,i),Xm(t)?t===ys||t==null||t===""?(this._$AH!==ys&&this._$AR(),this._$AH=ys):t!==this._$AH&&t!==yA&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):(o=>_3(o)||typeof o?.[Symbol.iterator]=="function")(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==ys&&Xm(this._$AH)?this._$AA.nextSibling.data=t:this.$(vd.createTextNode(t)),this._$AH=t}g(t){var i;const{values:o,_$litType$:l}=t,h=typeof l=="number"?this._$AC(t):(l.el===void 0&&(l.el=wg.createElement(T3(l.h,l.h[0]),this.options)),l);if(((i=this._$AH)===null||i===void 0?void 0:i._$AD)===h)this._$AH.v(o);else{const d=new Cz(h,this),f=d.u(this.options);d.v(o),this.$(f),this._$AH=d}}_$AC(t){let i=I3.get(t.strings);return i===void 0&&I3.set(t.strings,i=new wg(t)),i}T(t){_3(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let o,l=0;for(const h of t)l===i.length?i.push(o=new Mg(this.k(qm()),this.k(qm()),this,this.options)):o=i[l],o._$AI(h),l++;l<i.length&&(this._$AR(o&&o._$AB.nextSibling,l),i.length=l)}_$AR(t=this._$AA.nextSibling,i){var o;for((o=this._$AP)===null||o===void 0||o.call(this,!1,!0,i);t&&t!==this._$AB;){const l=t.nextSibling;t.remove(),t=l}}setConnected(t){var i;this._$AM===void 0&&(this._$Cp=t,(i=this._$AP)===null||i===void 0||i.call(this,t))}}class aE{constructor(t,i,o,l,h){this.type=1,this._$AH=ys,this._$AN=void 0,this.element=t,this.name=i,this._$AM=l,this.options=h,o.length>2||o[0]!==""||o[1]!==""?(this._$AH=Array(o.length-1).fill(new String),this.strings=o):this._$AH=ys}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,i=this,o,l){const h=this.strings;let d=!1;if(h===void 0)t=EA(this,t,i,0),d=!Xm(t)||t!==this._$AH&&t!==yA,d&&(this._$AH=t);else{const f=t;let g,y;for(t=h[0],g=0;g<h.length-1;g++)y=EA(this,f[o+g],i,g),y===yA&&(y=this._$AH[g]),d||(d=!Xm(y)||y!==this._$AH[g]),y===ys?t=ys:t!==ys&&(t+=(y??"")+h[g+1]),this._$AH[g]=y}d&&!l&&this.j(t)}j(t){t===ys?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class wz extends aE{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===ys?void 0:t}}const Mz=vA?vA.emptyScript:"";class Sz extends aE{constructor(){super(...arguments),this.type=4}j(t){t&&t!==ys?this.element.setAttribute(this.name,Mz):this.element.removeAttribute(this.name)}}class Iz extends aE{constructor(t,i,o,l,h){super(t,i,o,l,h),this.type=5}_$AI(t,i=this){var o;if((t=(o=EA(this,t,i,0))!==null&&o!==void 0?o:ys)===yA)return;const l=this._$AH,h=t===ys&&l!==ys||t.capture!==l.capture||t.once!==l.once||t.passive!==l.passive,d=t!==ys&&(l===ys||h);h&&this.element.removeEventListener(this.name,this,l),d&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var i,o;typeof this._$AH=="function"?this._$AH.call((o=(i=this.options)===null||i===void 0?void 0:i.host)!==null&&o!==void 0?o:this.element,t):this._$AH.handleEvent(t)}}class Tz{constructor(t,i,o){this.element=t,this.type=6,this._$AN=void 0,this._$AM=i,this.options=o}get _$AU(){return this._$AM._$AU}_$AI(t){EA(this,t)}}const B3=rE.litHtmlPolyfillSupport;B3?.(wg,Mg),((s1=rE.litHtmlVersions)!==null&&s1!==void 0?s1:rE.litHtmlVersions=[]).push("2.8.0");const R3=(p,t,i)=>{var o,l;const h=(o=i?.renderBefore)!==null&&o!==void 0?o:t;let d=h._$litPart$;if(d===void 0){const f=(l=i?.renderBefore)!==null&&l!==void 0?l:null;h._$litPart$=d=new Mg(t.insertBefore(qm(),f),f,void 0,i??{})}return d._$AI(p),d;/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */},oE=window,l1=oE.ShadowRoot&&(oE.ShadyCSS===void 0||oE.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,L3=Symbol(),D3=new WeakMap;class Bz{constructor(t,i,o){if(this._$cssResult$=!0,o!==L3)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=i}get styleSheet(){let t=this.o;const i=this.t;if(l1&&t===void 0){const o=i!==void 0&&i.length===1;o&&(t=D3.get(i)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),o&&D3.set(i,t))}return t}toString(){return this.cssText}}const P3=l1?p=>p:p=>p instanceof CSSStyleSheet?(t=>{let i="";for(const o of t.cssRules)i+=o.cssText;return(o=>new Bz(typeof o=="string"?o:o+"",void 0,L3))(i)})(p):p;var c1;const lE=window,U3=lE.trustedTypes,Rz=U3?U3.emptyScript:"",N3=lE.reactiveElementPolyfillSupport,h1={toAttribute(p,t){switch(t){case Boolean:p=p?Rz:null;break;case Object:case Array:p=p==null?p:JSON.stringify(p)}return p},fromAttribute(p,t){let i=p;switch(t){case Boolean:i=p!==null;break;case Number:i=p===null?null:Number(p);break;case Object:case Array:try{i=JSON.parse(p)}catch{i=null}}return i}},F3=(p,t)=>t!==p&&(t==t||p==p),u1={attribute:!0,type:String,converter:h1,reflect:!1,hasChanged:F3},d1="finalized";class xd extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var i;this.finalize(),((i=this.h)!==null&&i!==void 0?i:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach((i,o)=>{const l=this._$Ep(o,i);l!==void 0&&(this._$Ev.set(l,o),t.push(l))}),t}static createProperty(t,i=u1){if(i.state&&(i.attribute=!1),this.finalize(),this.elementProperties.set(t,i),!i.noAccessor&&!this.prototype.hasOwnProperty(t)){const o=typeof t=="symbol"?Symbol():"__"+t,l=this.getPropertyDescriptor(t,o,i);l!==void 0&&Object.defineProperty(this.prototype,t,l)}}static getPropertyDescriptor(t,i,o){return{get(){return this[i]},set(l){const h=this[t];this[i]=l,this.requestUpdate(t,h,o)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||u1}static finalize(){if(this.hasOwnProperty(d1))return!1;this[d1]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),t.h!==void 0&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const i=this.properties,o=[...Object.getOwnPropertyNames(i),...Object.getOwnPropertySymbols(i)];for(const l of o)this.createProperty(l,i[l])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const i=[];if(Array.isArray(t)){const o=new Set(t.flat(1/0).reverse());for(const l of o)i.unshift(P3(l))}else t!==void 0&&i.push(P3(t));return i}static _$Ep(t,i){const o=i.attribute;return o===!1?void 0:typeof o=="string"?o:typeof t=="string"?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise(i=>this.enableUpdating=i),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(t=this.constructor.h)===null||t===void 0||t.forEach(i=>i(this))}addController(t){var i,o;((i=this._$ES)!==null&&i!==void 0?i:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((o=t.hostConnected)===null||o===void 0||o.call(t))}removeController(t){var i;(i=this._$ES)===null||i===void 0||i.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((t,i)=>{this.hasOwnProperty(i)&&(this._$Ei.set(i,this[i]),delete this[i])})}createRenderRoot(){var t;const i=(t=this.shadowRoot)!==null&&t!==void 0?t:this.attachShadow(this.constructor.shadowRootOptions);return((o,l)=>{l1?o.adoptedStyleSheets=l.map(h=>h instanceof CSSStyleSheet?h:h.styleSheet):l.forEach(h=>{const d=document.createElement("style"),f=oE.litNonce;f!==void 0&&d.setAttribute("nonce",f),d.textContent=h.cssText,o.appendChild(d)})})(i,this.constructor.elementStyles),i}connectedCallback(){var t;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)===null||t===void 0||t.forEach(i=>{var o;return(o=i.hostConnected)===null||o===void 0?void 0:o.call(i)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)===null||t===void 0||t.forEach(i=>{var o;return(o=i.hostDisconnected)===null||o===void 0?void 0:o.call(i)})}attributeChangedCallback(t,i,o){this._$AK(t,o)}_$EO(t,i,o=u1){var l;const h=this.constructor._$Ep(t,o);if(h!==void 0&&o.reflect===!0){const d=(((l=o.converter)===null||l===void 0?void 0:l.toAttribute)!==void 0?o.converter:h1).toAttribute(i,o.type);this._$El=t,d==null?this.removeAttribute(h):this.setAttribute(h,d),this._$El=null}}_$AK(t,i){var o;const l=this.constructor,h=l._$Ev.get(t);if(h!==void 0&&this._$El!==h){const d=l.getPropertyOptions(h),f=typeof d.converter=="function"?{fromAttribute:d.converter}:((o=d.converter)===null||o===void 0?void 0:o.fromAttribute)!==void 0?d.converter:h1;this._$El=h,this[h]=f.fromAttribute(i,d.type),this._$El=null}}requestUpdate(t,i,o){let l=!0;t!==void 0&&(((o=o||this.constructor.getPropertyOptions(t)).hasChanged||F3)(this[t],i)?(this._$AL.has(t)||this._$AL.set(t,i),o.reflect===!0&&this._$El!==t&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(t,o))):l=!1),!this.isUpdatePending&&l&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(i){Promise.reject(i)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((l,h)=>this[h]=l),this._$Ei=void 0);let i=!1;const o=this._$AL;try{i=this.shouldUpdate(o),i?(this.willUpdate(o),(t=this._$ES)===null||t===void 0||t.forEach(l=>{var h;return(h=l.hostUpdate)===null||h===void 0?void 0:h.call(l)}),this.update(o)):this._$Ek()}catch(l){throw i=!1,this._$Ek(),l}i&&this._$AE(o)}willUpdate(t){}_$AE(t){var i;(i=this._$ES)===null||i===void 0||i.forEach(o=>{var l;return(l=o.hostUpdated)===null||l===void 0?void 0:l.call(o)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){this._$EC!==void 0&&(this._$EC.forEach((i,o)=>this._$EO(o,this[o],i)),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var p1,A1;xd[d1]=!0,xd.elementProperties=new Map,xd.elementStyles=[],xd.shadowRootOptions={mode:"open"},N3?.({ReactiveElement:xd}),((c1=lE.reactiveElementVersions)!==null&&c1!==void 0?c1:lE.reactiveElementVersions=[]).push("1.6.3");class cE extends xd{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,i;const o=super.createRenderRoot();return(t=(i=this.renderOptions).renderBefore)!==null&&t!==void 0||(i.renderBefore=o.firstChild),o}update(t){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=R3(i,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!1)}render(){return yA}}cE.finalized=!0,cE._$litElement$=!0,(p1=globalThis.litElementHydrateSupport)===null||p1===void 0||p1.call(globalThis,{LitElement:cE});const O3=globalThis.litElementPolyfillSupport;O3?.({LitElement:cE}),((A1=globalThis.litElementVersions)!==null&&A1!==void 0?A1:globalThis.litElementVersions=[]).push("3.3.3");/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3=navigator.xr!=null&&self.XRSession!=null&&navigator.xr.isSessionSupported!=null,Q3=k3&&self.XRSession.prototype.requestHitTestSource!=null,f1=self.ResizeObserver!=null,m1=self.IntersectionObserver!=null,G3=Q3;(()=>{const p=navigator.userAgent||navigator.vendor||self.opera;let t=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(p.substr(0,4)))&&(t=!0)})(),/\bCrOS\b/.test(navigator.userAgent);const Lz=/android/i.test(navigator.userAgent),H3=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;/Safari\//.test(navigator.userAgent);const Dz=/firefox/i.test(navigator.userAgent),Pz=/OculusBrowser/.test(navigator.userAgent);H3&&/CriOS\//.test(navigator.userAgent);const Uz=Lz&&!Dz&&!Pz,Nz=!!(window.webkit&&window.webkit.messageHandlers),z3=(()=>{if(H3){if(Nz)return!!/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent);{const p=document.createElement("a");return!!(p.relList&&p.relList.supports&&p.relList.supports("ar"))}}return!1})(),V3=p=>p&&p!=="null"?Fz(p):null,W3=()=>{if(G3)return;const p=[];throw k3||p.push("WebXR Device API"),Q3||p.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${p.join(", ")}`)},Fz=p=>new URL(p,window.location.toString()).toString(),j3=(p,t)=>{let i=null;return(...o)=>{i!=null&&self.clearTimeout(i),i=self.setTimeout(()=>{i=null,p(...o)},t)}},Ll=(p,t,i)=>Math.max(t,Math.min(i,p)),q3=(()=>{const p=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(p)})();/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _d=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const Km=Symbol("currentEnvironmentMap"),hE=Symbol("currentBackground"),uE=Symbol("updateEnvironment"),dE=Symbol("cancelEnvironmentUpdate");/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oz=sE`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          role="button"
          href="javascript:void(0);"
          aria-label="View in your space">
        ${sE`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${sE`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${sE`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,g1=new WeakMap;function kz(){let p,t;function i(o,l,h,d,f,g){const y=g.num_components(),x=h.num_points()*y,b=x*f.BYTES_PER_ELEMENT,_=function(P,U){switch(U){case Float32Array:return P.DT_FLOAT32;case Int8Array:return P.DT_INT8;case Int16Array:return P.DT_INT16;case Int32Array:return P.DT_INT32;case Uint8Array:return P.DT_UINT8;case Uint16Array:return P.DT_UINT16;case Uint32Array:return P.DT_UINT32}}(o,f),w=o._malloc(b);l.GetAttributeDataArrayForAllPoints(h,g,_,b,w);const T=new f(o.HEAPF32.buffer,w,x).slice();return o._free(w),{name:d,array:T,itemSize:y}}onmessage=function(o){const l=o.data;switch(l.type){case"init":p=l.decoderConfig,t=new Promise(function(f){p.onModuleLoaded=function(g){f({draco:g})},DracoDecoderModule(p)});break;case"decode":const h=l.buffer,d=l.taskConfig;t.then(f=>{const g=f.draco,y=new g.Decoder;try{const x=function(_,w,T,P){const U=P.attributeIDs,D=P.attributeTypes;let z,G;const Q=w.GetEncodedGeometryType(T);if(Q===_.TRIANGULAR_MESH)z=new _.Mesh,G=w.DecodeArrayToMesh(T,T.byteLength,z);else{if(Q!==_.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");z=new _.PointCloud,G=w.DecodeArrayToPointCloud(T,T.byteLength,z)}if(!G.ok()||z.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+G.error_msg());const Y={index:null,attributes:[]};for(const q in U){const K=self[D[q]];let ne,le;if(P.useUniqueIDs)le=U[q],ne=w.GetAttributeByUniqueId(z,le);else{if(le=w.GetAttributeId(z,_[U[q]]),le===-1)continue;ne=w.GetAttribute(z,le)}const fe=i(_,w,z,q,K,ne);q==="color"&&(fe.vertexColorSpace=P.vertexColorSpace),Y.attributes.push(fe)}return Q===_.TRIANGULAR_MESH&&(Y.index=function(q,K,ne){const le=ne.num_faces(),fe=3*le,be=4*fe,de=q._malloc(be);K.GetTrianglesUInt32Array(ne,be,de);const Fe=new Uint32Array(q.HEAPF32.buffer,de,fe).slice();return q._free(de),{array:Fe,itemSize:1}}(_,w,z)),_.destroy(z),Y}(g,y,new Int8Array(h),d),b=x.attributes.map(_=>_.array.buffer);x.index&&b.push(x.index.array.buffer),self.postMessage({type:"decode",id:l.id,geometry:x},b)}catch(x){console.error(x),self.postMessage({type:"error",id:l.id,error:x.message})}finally{g.destroy(y)}})}}}function X3(p,t){if(t===0)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),p;if(t===2||t===1){let i=p.getIndex();if(i===null){const d=[],f=p.getAttribute("position");if(f===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),p;for(let g=0;g<f.count;g++)d.push(g);p.setIndex(d),i=p.getIndex()}const o=i.count-2,l=[];if(t===2)for(let d=1;d<=o;d++)l.push(i.getX(0)),l.push(i.getX(d)),l.push(i.getX(d+1));else for(let d=0;d<o;d++)d%2==0?(l.push(i.getX(d)),l.push(i.getX(d+1)),l.push(i.getX(d+2))):(l.push(i.getX(d+2)),l.push(i.getX(d+1)),l.push(i.getX(d)));l.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=p.clone();return h.setIndex(l),h.clearGroups(),h}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),p}class Qz extends tl{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new Wz(i)}),this.register(function(i){return new jz(i)}),this.register(function(i){return new t8(i)}),this.register(function(i){return new n8(i)}),this.register(function(i){return new i8(i)}),this.register(function(i){return new Xz(i)}),this.register(function(i){return new Yz(i)}),this.register(function(i){return new Kz(i)}),this.register(function(i){return new Jz(i)}),this.register(function(i){return new Vz(i)}),this.register(function(i){return new $z(i)}),this.register(function(i){return new qz(i)}),this.register(function(i){return new e8(i)}),this.register(function(i){return new Zz(i)}),this.register(function(i){return new Hz(i)}),this.register(function(i){return new r8(i)}),this.register(function(i){return new s8(i)})}load(t,i,o,l){const h=this;let d;if(this.resourcePath!=="")d=this.resourcePath;else if(this.path!==""){const y=Wm.extractUrlBase(t);d=Wm.resolveURL(y,this.path)}else d=Wm.extractUrlBase(t);this.manager.itemStart(t);const f=function(y){l?l(y):console.error(y),h.manager.itemError(t),h.manager.itemEnd(t)},g=new Rl(this.manager);g.setPath(this.path),g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(t,function(y){try{h.parse(y,d,function(x){i(x),h.manager.itemEnd(t)},f)}catch(x){f(x)}},o,f)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,i,o,l){let h;const d={},f={},g=new TextDecoder;if(typeof t=="string")h=JSON.parse(t);else if(t instanceof ArrayBuffer)if(g.decode(new Uint8Array(t,0,4))===Y3){try{d[hi.KHR_BINARY_GLTF]=new l8(t)}catch(x){return void(l&&l(x))}h=JSON.parse(d[hi.KHR_BINARY_GLTF].content)}else h=JSON.parse(g.decode(t));else h=t;if(h.asset===void 0||h.asset.version[0]<2)return void(l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const y=new _8(h,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});y.fileLoader.setRequestHeader(this.requestHeader);for(let x=0;x<this.pluginCallbacks.length;x++){const b=this.pluginCallbacks[x](y);b.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),f[b.name]=b,d[b.name]=!0}if(h.extensionsUsed)for(let x=0;x<h.extensionsUsed.length;++x){const b=h.extensionsUsed[x],_=h.extensionsRequired||[];switch(b){case hi.KHR_MATERIALS_UNLIT:d[b]=new zz;break;case hi.KHR_DRACO_MESH_COMPRESSION:d[b]=new c8(h,this.dracoLoader);break;case hi.KHR_TEXTURE_TRANSFORM:d[b]=new h8;break;case hi.KHR_MESH_QUANTIZATION:d[b]=new u8;break;default:_.indexOf(b)>=0&&f[b]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}y.setExtensions(d),y.setPlugins(f),y.parse(o,l)}parseAsync(t,i){const o=this;return new Promise(function(l,h){o.parse(t,i,l,h)})}}function Gz(){let p={};return{get:function(t){return p[t]},add:function(t,i){p[t]=i},remove:function(t){delete p[t]},removeAll:function(){p={}}}}const hi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Hz{constructor(t){this.parser=t,this.name=hi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,i=this.parser.json.nodes||[];for(let o=0,l=i.length;o<l;o++){const h=i[o];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(t){const i=this.parser,o="light:"+t;let l=i.cache.get(o);if(l)return l;const h=i.json,d=((h.extensions&&h.extensions[this.name]||{}).lights||[])[t];let f;const g=new fn(16777215);d.color!==void 0&&g.setRGB(d.color[0],d.color[1],d.color[2],Yi);const y=d.range!==void 0?d.range:0;switch(d.type){case"directional":f=new u3(g),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new h3(g),f.distance=y;break;case"spot":f=new az(g),f.distance=y,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,f.angle=d.spot.outerConeAngle,f.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return f.position.set(0,0,0),f.decay=2,Uc(f,d),d.intensity!==void 0&&(f.intensity=d.intensity),f.name=i.createUniqueName(d.name||"light_"+t),l=Promise.resolve(f),i.cache.add(o,l),l}getDependency(t,i){if(t==="light")return this._loadLight(i)}createNodeAttachment(t){const i=this,o=this.parser,l=o.json.nodes[t],h=(l.extensions&&l.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(d){return o._getNodeRef(i.cache,h,d)})}}class zz{constructor(){this.name=hi.KHR_MATERIALS_UNLIT}getMaterialType(){return yo}extendParams(t,i,o){const l=[];t.color=new fn(1,1,1),t.opacity=1;const h=i.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;t.color.setRGB(d[0],d[1],d[2],Yi),t.opacity=d[3]}h.baseColorTexture!==void 0&&l.push(o.assignTexture(t,"map",h.baseColorTexture,sr))}return Promise.all(l)}}class Vz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,i){const o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const l=o.extensions[this.name].emissiveStrength;return l!==void 0&&(i.emissiveIntensity=l),Promise.resolve()}}class Wz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];if(d.clearcoatFactor!==void 0&&(i.clearcoat=d.clearcoatFactor),d.clearcoatTexture!==void 0&&h.push(o.assignTexture(i,"clearcoatMap",d.clearcoatTexture)),d.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=d.clearcoatRoughnessFactor),d.clearcoatRoughnessTexture!==void 0&&h.push(o.assignTexture(i,"clearcoatRoughnessMap",d.clearcoatRoughnessTexture)),d.clearcoatNormalTexture!==void 0&&(h.push(o.assignTexture(i,"clearcoatNormalMap",d.clearcoatNormalTexture)),d.clearcoatNormalTexture.scale!==void 0)){const f=d.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new Hn(f,f)}return Promise.all(h)}}class jz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_DISPERSION}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const l=o.extensions[this.name];return i.dispersion=l.dispersion!==void 0?l.dispersion:0,Promise.resolve()}}class qz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];return d.iridescenceFactor!==void 0&&(i.iridescence=d.iridescenceFactor),d.iridescenceTexture!==void 0&&h.push(o.assignTexture(i,"iridescenceMap",d.iridescenceTexture)),d.iridescenceIor!==void 0&&(i.iridescenceIOR=d.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),d.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=d.iridescenceThicknessMinimum),d.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=d.iridescenceThicknessMaximum),d.iridescenceThicknessTexture!==void 0&&h.push(o.assignTexture(i,"iridescenceThicknessMap",d.iridescenceThicknessTexture)),Promise.all(h)}}class Xz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[];i.sheenColor=new fn(0,0,0),i.sheenRoughness=0,i.sheen=1;const d=l.extensions[this.name];if(d.sheenColorFactor!==void 0){const f=d.sheenColorFactor;i.sheenColor.setRGB(f[0],f[1],f[2],Yi)}return d.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=d.sheenRoughnessFactor),d.sheenColorTexture!==void 0&&h.push(o.assignTexture(i,"sheenColorMap",d.sheenColorTexture,sr)),d.sheenRoughnessTexture!==void 0&&h.push(o.assignTexture(i,"sheenRoughnessMap",d.sheenRoughnessTexture)),Promise.all(h)}}class Yz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];return d.transmissionFactor!==void 0&&(i.transmission=d.transmissionFactor),d.transmissionTexture!==void 0&&h.push(o.assignTexture(i,"transmissionMap",d.transmissionTexture)),Promise.all(h)}}class Kz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];i.thickness=d.thicknessFactor!==void 0?d.thicknessFactor:0,d.thicknessTexture!==void 0&&h.push(o.assignTexture(i,"thicknessMap",d.thicknessTexture)),i.attenuationDistance=d.attenuationDistance||1/0;const f=d.attenuationColor||[1,1,1];return i.attenuationColor=new fn().setRGB(f[0],f[1],f[2],Yi),Promise.all(h)}}class Jz{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const l=o.extensions[this.name];return i.ior=l.ior!==void 0?l.ior:1.5,Promise.resolve()}}class $z{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];i.specularIntensity=d.specularFactor!==void 0?d.specularFactor:1,d.specularTexture!==void 0&&h.push(o.assignTexture(i,"specularIntensityMap",d.specularTexture));const f=d.specularColorFactor||[1,1,1];return i.specularColor=new fn().setRGB(f[0],f[1],f[2],Yi),d.specularColorTexture!==void 0&&h.push(o.assignTexture(i,"specularColorMap",d.specularColorTexture,sr)),Promise.all(h)}}class Zz{constructor(t){this.parser=t,this.name=hi.EXT_MATERIALS_BUMP}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];return i.bumpScale=d.bumpFactor!==void 0?d.bumpFactor:1,d.bumpTexture!==void 0&&h.push(o.assignTexture(i,"bumpMap",d.bumpTexture)),Promise.all(h)}}class e8{constructor(t){this.parser=t,this.name=hi.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return i.extensions&&i.extensions[this.name]?Tl:null}extendMaterialParams(t,i){const o=this.parser,l=o.json.materials[t];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const h=[],d=l.extensions[this.name];return d.anisotropyStrength!==void 0&&(i.anisotropy=d.anisotropyStrength),d.anisotropyRotation!==void 0&&(i.anisotropyRotation=d.anisotropyRotation),d.anisotropyTexture!==void 0&&h.push(o.assignTexture(i,"anisotropyMap",d.anisotropyTexture)),Promise.all(h)}}class t8{constructor(t){this.parser=t,this.name=hi.KHR_TEXTURE_BASISU}loadTexture(t){const i=this.parser,o=i.json,l=o.textures[t];if(!l.extensions||!l.extensions[this.name])return null;const h=l.extensions[this.name],d=i.options.ktx2Loader;if(!d){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(t,h.source,d)}}class n8{constructor(t){this.parser=t,this.name=hi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const i=this.name,o=this.parser,l=o.json,h=l.textures[t];if(!h.extensions||!h.extensions[i])return null;const d=h.extensions[i],f=l.images[d.source];let g=o.textureLoader;if(f.uri){const y=o.options.manager.getHandler(f.uri);y!==null&&(g=y)}return this.detectSupport().then(function(y){if(y)return o.loadTextureImage(t,d.source,g);if(l.extensionsRequired&&l.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class i8{constructor(t){this.parser=t,this.name=hi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const i=this.name,o=this.parser,l=o.json,h=l.textures[t];if(!h.extensions||!h.extensions[i])return null;const d=h.extensions[i],f=l.images[d.source];let g=o.textureLoader;if(f.uri){const y=o.options.manager.getHandler(f.uri);y!==null&&(g=y)}return this.detectSupport().then(function(y){if(y)return o.loadTextureImage(t,d.source,g);if(l.extensionsRequired&&l.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return o.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const i=new Image;i.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",i.onload=i.onerror=function(){t(i.height===1)}})),this.isSupported}}class r8{constructor(t){this.name=hi.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const i=this.parser.json,o=i.bufferViews[t];if(o.extensions&&o.extensions[this.name]){const l=o.extensions[this.name],h=this.parser.getDependency("buffer",l.buffer),d=this.parser.options.meshoptDecoder;if(!d||!d.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function(f){const g=l.byteOffset||0,y=l.byteLength||0,x=l.count,b=l.byteStride,_=new Uint8Array(f,g,y);return d.decodeGltfBufferAsync?d.decodeGltfBufferAsync(x,b,_,l.mode,l.filter).then(function(w){return w.buffer}):d.ready.then(function(){const w=new ArrayBuffer(x*b);return d.decodeGltfBuffer(new Uint8Array(w),x,b,_,l.mode,l.filter),w})})}return null}}class s8{constructor(t){this.name=hi.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const i=this.parser.json,o=i.nodes[t];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const l=i.meshes[o.mesh];for(const g of l.primitives)if(g.mode!==xo.TRIANGLES&&g.mode!==xo.TRIANGLE_STRIP&&g.mode!==xo.TRIANGLE_FAN&&g.mode!==void 0)return null;const h=o.extensions[this.name].attributes,d=[],f={};for(const g in h)d.push(this.parser.getDependency("accessor",h[g]).then(y=>(f[g]=y,f[g])));return d.length<1?null:(d.push(this.parser.createNodeMesh(t)),Promise.all(d).then(g=>{const y=g.pop(),x=y.isGroup?y.children:[y],b=g[0].count,_=[];for(const w of x){const T=new In,P=new ve,U=new ra,D=new ve(1,1,1),z=new z6(w.geometry,w.material,b);for(let G=0;G<b;G++)f.TRANSLATION&&P.fromBufferAttribute(f.TRANSLATION,G),f.ROTATION&&U.fromBufferAttribute(f.ROTATION,G),f.SCALE&&D.fromBufferAttribute(f.SCALE,G),z.setMatrixAt(G,T.compose(P,U,D));for(const G in f)if(G==="_COLOR_0"){const Q=f[G];z.instanceColor=new zw(Q.array,Q.itemSize,Q.normalized)}else G!=="TRANSLATION"&&G!=="ROTATION"&&G!=="SCALE"&&w.geometry.setAttribute(G,f[G]);$i.prototype.copy.call(z,w),this.parser.assignFinalMaterial(z),_.push(z)}return y.isGroup?(y.clear(),y.add(..._),y):_[0]}))}}const Y3="glTF",a8=1313821514,o8=5130562;class l8{constructor(t){this.name=hi.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(t,0,12),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Y3)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const l=this.header.length-12,h=new DataView(t,12);let d=0;for(;d<l;){const f=h.getUint32(d,!0);d+=4;const g=h.getUint32(d,!0);if(d+=4,g===a8){const y=new Uint8Array(t,12+d,f);this.content=o.decode(y)}else if(g===o8){const y=12+d;this.body=t.slice(y,y+f)}d+=f}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class c8{constructor(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=hi.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(t,i){const o=this.json,l=this.dracoLoader,h=t.extensions[this.name].bufferView,d=t.extensions[this.name].attributes,f={},g={},y={};for(const x in d){const b=y1[x]||x.toLowerCase();f[b]=d[x]}for(const x in t.attributes){const b=y1[x]||x.toLowerCase();if(d[x]!==void 0){const _=o.accessors[t.attributes[x]],w=xA[_.componentType];y[b]=w.name,g[b]=_.normalized===!0}}return i.getDependency("bufferView",h).then(function(x){return new Promise(function(b,_){l.decodeDracoFile(x,function(w){for(const T in w.attributes){const P=w.attributes[T],U=g[T];U!==void 0&&(P.normalized=U)}b(w)},f,y,Yi,_)})})}}class h8{constructor(){this.name=hi.KHR_TEXTURE_TRANSFORM}extendTexture(t,i){return(i.texCoord!==void 0&&i.texCoord!==t.channel||i.offset!==void 0||i.rotation!==void 0||i.scale!==void 0)&&(t=t.clone(),i.texCoord!==void 0&&(t.channel=i.texCoord),i.offset!==void 0&&t.offset.fromArray(i.offset),i.rotation!==void 0&&(t.rotation=i.rotation),i.scale!==void 0&&t.repeat.fromArray(i.scale),t.needsUpdate=!0),t}}class u8{constructor(){this.name=hi.KHR_MESH_QUANTIZATION}}class K3 extends zm{constructor(t,i,o,l){super(t,i,o,l)}copySampleValue_(t){const i=this.resultBuffer,o=this.sampleValues,l=this.valueSize,h=t*l*3+l;for(let d=0;d!==l;d++)i[d]=o[h+d];return i}interpolate_(t,i,o,l){const h=this.resultBuffer,d=this.sampleValues,f=this.valueSize,g=2*f,y=3*f,x=l-i,b=(o-i)/x,_=b*b,w=_*b,T=t*y,P=T-y,U=-2*w+3*_,D=w-_,z=1-U,G=D-_+b;for(let Q=0;Q!==f;Q++){const Y=d[P+Q+f],q=d[P+Q+g]*x,K=d[T+Q+f],ne=d[T+Q]*x;h[Q]=z*Y+G*q+U*K+D*ne}return h}}const d8=new ra;class p8 extends K3{interpolate_(t,i,o,l){const h=super.interpolate_(t,i,o,l);return d8.fromArray(h).normalize().toArray(h),h}}const xo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},xA={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},J3={9728:fs,9729:Fi,9984:sy,9985:Qp,9986:od,9987:mo},$3={33071:rs,33648:kp,10497:Sl},v1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},y1={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A8={CUBICSPLINE:void 0,LINEAR:Vp,STEP:zp},f8="OPAQUE",m8="MASK",g8="BLEND";function v8(p){return p.DefaultMaterial===void 0&&(p.DefaultMaterial=new Hm({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),p.DefaultMaterial}function bd(p,t,i){for(const o in i.extensions)p[o]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[o]=i.extensions[o])}function Uc(p,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(p.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function y8(p,t){if(p.updateMorphTargets(),t.weights!==void 0)for(let i=0,o=t.weights.length;i<o;i++)p.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){const i=t.extras.targetNames;if(p.morphTargetInfluences.length===i.length){p.morphTargetDictionary={};for(let o=0,l=i.length;o<l;o++)p.morphTargetDictionary[i[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function E8(p){let t;const i=p.extensions&&p.extensions[hi.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+E1(i.attributes):p.indices+":"+E1(p.attributes)+":"+p.mode,p.targets!==void 0)for(let o=0,l=p.targets.length;o<l;o++)t+=":"+E1(p.targets[o]);return t}function E1(p){let t="";const i=Object.keys(p).sort();for(let o=0,l=i.length;o<l;o++)t+=i[o]+":"+p[i[o]]+";";return t}function x1(p){switch(p){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const x8=new In;class _8{constructor(t={},i={}){this.json=t,this.extensions={},this.plugins={},this.options=i,this.cache=new Gz,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,l=-1,h=!1,d=-1;if(typeof navigator<"u"){const f=navigator.userAgent;o=/^((?!chrome|android).)*safari/i.test(f)===!0;const g=f.match(/Version\/(\d+)/);l=o&&g?parseInt(g[1],10):-1,h=f.indexOf("Firefox")>-1,d=h?f.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||o&&l<17||h&&d<98?this.textureLoader=new a3(this.options.manager):this.textureLoader=new uz(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Rl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,i){const o=this,l=this.json,h=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(d){return d._markDefs&&d._markDefs()}),Promise.all(this._invokeAll(function(d){return d.beforeRoot&&d.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(d){const f={scene:d[0][l.scene||0],scenes:d[0],animations:d[1],cameras:d[2],asset:l.asset,parser:o,userData:{}};return bd(h,f,l),Uc(f,l),Promise.all(o._invokeAll(function(g){return g.afterRoot&&g.afterRoot(f)})).then(function(){for(const g of f.scenes)g.updateMatrixWorld();t(f)})}).catch(i)}_markDefs(){const t=this.json.nodes||[],i=this.json.skins||[],o=this.json.meshes||[];for(let l=0,h=i.length;l<h;l++){const d=i[l].joints;for(let f=0,g=d.length;f<g;f++)t[d[f]].isBone=!0}for(let l=0,h=t.length;l<h;l++){const d=t[l];d.mesh!==void 0&&(this._addNodeRef(this.meshCache,d.mesh),d.skin!==void 0&&(o[d.mesh].isSkinnedMesh=!0)),d.camera!==void 0&&this._addNodeRef(this.cameraCache,d.camera)}}_addNodeRef(t,i){i!==void 0&&(t.refs[i]===void 0&&(t.refs[i]=t.uses[i]=0),t.refs[i]++)}_getNodeRef(t,i,o){if(t.refs[i]<=1)return o;const l=o.clone(),h=(d,f)=>{const g=this.associations.get(d);g!=null&&this.associations.set(f,g);for(const[y,x]of d.children.entries())h(x,f.children[y])};return h(o,l),l.name+="_instance_"+t.uses[i]++,l}_invokeOne(t){const i=Object.values(this.plugins);i.push(this);for(let o=0;o<i.length;o++){const l=t(i[o]);if(l)return l}return null}_invokeAll(t){const i=Object.values(this.plugins);i.unshift(this);const o=[];for(let l=0;l<i.length;l++){const h=t(i[l]);h&&o.push(h)}return o}getDependency(t,i){const o=t+":"+i;let l=this.cache.get(o);if(!l){switch(t){case"scene":l=this.loadScene(i);break;case"node":l=this._invokeOne(function(h){return h.loadNode&&h.loadNode(i)});break;case"mesh":l=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(i)});break;case"accessor":l=this.loadAccessor(i);break;case"bufferView":l=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(i)});break;case"buffer":l=this.loadBuffer(i);break;case"material":l=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(i)});break;case"texture":l=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(i)});break;case"skin":l=this.loadSkin(i);break;case"animation":l=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(i)});break;case"camera":l=this.loadCamera(i);break;default:if(l=this._invokeOne(function(h){return h!=this&&h.getDependency&&h.getDependency(t,i)}),!l)throw new Error("Unknown type: "+t)}this.cache.add(o,l)}return l}getDependencies(t){let i=this.cache.get(t);if(!i){const o=this,l=this.json[t+(t==="mesh"?"es":"s")]||[];i=Promise.all(l.map(function(h,d){return o.getDependency(t,d)})),this.cache.add(t,i)}return i}loadBuffer(t){const i=this.json.buffers[t],o=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&t===0)return Promise.resolve(this.extensions[hi.KHR_BINARY_GLTF].body);const l=this.options;return new Promise(function(h,d){o.load(Wm.resolveURL(i.uri,l.path),h,void 0,function(){d(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(t){const i=this.json.bufferViews[t];return this.getDependency("buffer",i.buffer).then(function(o){const l=i.byteLength||0,h=i.byteOffset||0;return o.slice(h,h+l)})}loadAccessor(t){const i=this,o=this.json,l=this.json.accessors[t];if(l.bufferView===void 0&&l.sparse===void 0){const d=v1[l.type],f=xA[l.componentType],g=l.normalized===!0,y=new f(l.count*d);return Promise.resolve(new mr(y,d,g))}const h=[];return l.bufferView!==void 0?h.push(this.getDependency("bufferView",l.bufferView)):h.push(null),l.sparse!==void 0&&(h.push(this.getDependency("bufferView",l.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",l.sparse.values.bufferView))),Promise.all(h).then(function(d){const f=d[0],g=v1[l.type],y=xA[l.componentType],x=y.BYTES_PER_ELEMENT,b=x*g,_=l.byteOffset||0,w=l.bufferView!==void 0?o.bufferViews[l.bufferView].byteStride:void 0,T=l.normalized===!0;let P,U;if(w&&w!==b){const D=Math.floor(_/w),z="InterleavedBuffer:"+l.bufferView+":"+l.componentType+":"+D+":"+l.count;let G=i.cache.get(z);G||(P=new y(f,D*w,l.count*w/x),G=new O6(P,w/x),i.cache.add(z,G)),U=new eS(G,g,_%w/x,T)}else P=f===null?new y(l.count*g):new y(f,_,l.count*g),U=new mr(P,g,T);if(l.sparse!==void 0){const D=v1.SCALAR,z=xA[l.sparse.indices.componentType],G=l.sparse.indices.byteOffset||0,Q=l.sparse.values.byteOffset||0,Y=new z(d[1],G,l.sparse.count*D),q=new y(d[2],Q,l.sparse.count*g);f!==null&&(U=new mr(U.array.slice(),U.itemSize,U.normalized)),U.normalized=!1;for(let K=0,ne=Y.length;K<ne;K++){const le=Y[K];if(U.setX(le,q[K*g]),g>=2&&U.setY(le,q[K*g+1]),g>=3&&U.setZ(le,q[K*g+2]),g>=4&&U.setW(le,q[K*g+3]),g>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}U.normalized=T}return U})}loadTexture(t){const i=this.json,o=this.options,l=i.textures[t].source,h=i.images[l];let d=this.textureLoader;if(h.uri){const f=o.manager.getHandler(h.uri);f!==null&&(d=f)}return this.loadTextureImage(t,l,d)}loadTextureImage(t,i,o){const l=this,h=this.json,d=h.textures[t],f=h.images[i],g=(f.uri||f.bufferView)+":"+d.sampler;if(this.textureCache[g])return this.textureCache[g];const y=this.loadImageSource(i,o).then(function(x){x.flipY=!1,x.name=d.name||f.name||"",x.name===""&&typeof f.uri=="string"&&f.uri.startsWith("data:image/")===!1&&(x.name=f.uri);const b=(h.samplers||{})[d.sampler]||{};return x.magFilter=J3[b.magFilter]||Fi,x.minFilter=J3[b.minFilter]||mo,x.wrapS=$3[b.wrapS]||Sl,x.wrapT=$3[b.wrapT]||Sl,l.associations.set(x,{textures:t}),x}).catch(function(){return null});return this.textureCache[g]=y,y}loadImageSource(t,i){const o=this,l=this.json,h=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(b=>b.clone());const d=l.images[t],f=self.URL||self.webkitURL;let g=d.uri||"",y=!1;if(d.bufferView!==void 0)g=o.getDependency("bufferView",d.bufferView).then(function(b){y=!0;const _=new Blob([b],{type:d.mimeType});return g=f.createObjectURL(_),g});else if(d.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const x=Promise.resolve(g).then(function(b){return new Promise(function(_,w){let T=_;i.isImageBitmapLoader===!0&&(T=function(P){const U=new qi(P);U.needsUpdate=!0,_(U)}),i.load(Wm.resolveURL(b,h.path),T,void 0,w)})}).then(function(b){var _;return y===!0&&f.revokeObjectURL(g),Uc(b,d),b.userData.mimeType=d.mimeType||((_=d.uri).search(/\.jpe?g($|\?)/i)>0||_.search(/^data\:image\/jpeg/)===0?"image/jpeg":_.search(/\.webp($|\?)/i)>0||_.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),b}).catch(function(b){throw console.error("THREE.GLTFLoader: Couldn't load texture",g),b});return this.sourceCache[t]=x,x}assignTexture(t,i,o,l){const h=this;return this.getDependency("texture",o.index).then(function(d){if(!d)return null;if(o.texCoord!==void 0&&o.texCoord>0&&((d=d.clone()).channel=o.texCoord),h.extensions[hi.KHR_TEXTURE_TRANSFORM]){const f=o.extensions!==void 0?o.extensions[hi.KHR_TEXTURE_TRANSFORM]:void 0;if(f){const g=h.associations.get(d);d=h.extensions[hi.KHR_TEXTURE_TRANSFORM].extendTexture(d,f),h.associations.set(d,g)}}return l!==void 0&&(d.colorSpace=l),t[i]=d,d})}assignFinalMaterial(t){const i=t.geometry;let o=t.material;const l=i.attributes.tangent===void 0,h=i.attributes.color!==void 0,d=i.attributes.normal===void 0;if(t.isPoints){const f="PointsMaterial:"+o.uuid;let g=this.cache.get(f);g||(g=new $L,el.prototype.copy.call(g,o),g.color.copy(o.color),g.map=o.map,g.sizeAttenuation=!1,this.cache.add(f,g)),o=g}else if(t.isLine){const f="LineBasicMaterial:"+o.uuid;let g=this.cache.get(f);g||(g=new qL,el.prototype.copy.call(g,o),g.color.copy(o.color),g.map=o.map,this.cache.add(f,g)),o=g}if(l||h||d){let f="ClonedMaterial:"+o.uuid+":";l&&(f+="derivative-tangents:"),h&&(f+="vertex-colors:"),d&&(f+="flat-shading:");let g=this.cache.get(f);g||(g=o.clone(),h&&(g.vertexColors=!0),d&&(g.flatShading=!0),l&&(g.normalScale&&(g.normalScale.y*=-1),g.clearcoatNormalScale&&(g.clearcoatNormalScale.y*=-1)),this.cache.add(f,g),this.associations.set(g,this.associations.get(o))),o=g}t.material=o}getMaterialType(){return Hm}loadMaterial(t){const i=this,o=this.json,l=this.extensions,h=o.materials[t];let d;const f={},g=[];if((h.extensions||{})[hi.KHR_MATERIALS_UNLIT]){const x=l[hi.KHR_MATERIALS_UNLIT];d=x.getMaterialType(),g.push(x.extendParams(f,h,i))}else{const x=h.pbrMetallicRoughness||{};if(f.color=new fn(1,1,1),f.opacity=1,Array.isArray(x.baseColorFactor)){const b=x.baseColorFactor;f.color.setRGB(b[0],b[1],b[2],Yi),f.opacity=b[3]}x.baseColorTexture!==void 0&&g.push(i.assignTexture(f,"map",x.baseColorTexture,sr)),f.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,f.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(g.push(i.assignTexture(f,"metalnessMap",x.metallicRoughnessTexture)),g.push(i.assignTexture(f,"roughnessMap",x.metallicRoughnessTexture))),d=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(t)}),g.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(t,f)})))}h.doubleSided===!0&&(f.side=2);const y=h.alphaMode||f8;if(y===g8?(f.transparent=!0,f.depthWrite=!1):(f.transparent=!1,y===m8&&(f.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&d!==yo&&(g.push(i.assignTexture(f,"normalMap",h.normalTexture)),f.normalScale=new Hn(1,1),h.normalTexture.scale!==void 0)){const x=h.normalTexture.scale;f.normalScale.set(x,x)}if(h.occlusionTexture!==void 0&&d!==yo&&(g.push(i.assignTexture(f,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&(f.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&d!==yo){const x=h.emissiveFactor;f.emissive=new fn().setRGB(x[0],x[1],x[2],Yi)}return h.emissiveTexture!==void 0&&d!==yo&&g.push(i.assignTexture(f,"emissiveMap",h.emissiveTexture,sr)),Promise.all(g).then(function(){const x=new d(f);return h.name&&(x.name=h.name),Uc(x,h),i.associations.set(x,{materials:t}),h.extensions&&bd(l,x,h),x})}createUniqueName(t){const i=xi.sanitizeNodeName(t||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(t){const i=this,o=this.extensions,l=this.primitiveCache;function h(f){return o[hi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(f,i).then(function(g){return Z3(g,f,i)})}const d=[];for(let f=0,g=t.length;f<g;f++){const y=t[f],x=E8(y),b=l[x];if(b)d.push(b.promise);else{let _;_=y.extensions&&y.extensions[hi.KHR_DRACO_MESH_COMPRESSION]?h(y):Z3(new Ra,y,i),l[x]={primitive:y,promise:_},d.push(_)}}return Promise.all(d)}loadMesh(t){const i=this,o=this.json,l=this.extensions,h=o.meshes[t],d=h.primitives,f=[];for(let g=0,y=d.length;g<y;g++){const x=d[g].material===void 0?v8(this.cache):this.getDependency("material",d[g].material);f.push(x)}return f.push(i.loadGeometries(d)),Promise.all(f).then(function(g){const y=g.slice(0,g.length-1),x=g[g.length-1],b=[];for(let w=0,T=x.length;w<T;w++){const P=x[w],U=d[w];let D;const z=y[w];if(U.mode===xo.TRIANGLES||U.mode===xo.TRIANGLE_STRIP||U.mode===xo.TRIANGLE_FAN||U.mode===void 0)D=h.isSkinnedMesh===!0?new Q6(P,z):new Vi(P,z),D.isSkinnedMesh===!0&&D.normalizeSkinWeights(),U.mode===xo.TRIANGLE_STRIP?D.geometry=X3(D.geometry,1):U.mode===xo.TRIANGLE_FAN&&(D.geometry=X3(D.geometry,2));else if(U.mode===xo.LINES)D=new V6(P,z);else if(U.mode===xo.LINE_STRIP)D=new Gm(P,z);else if(U.mode===xo.LINE_LOOP)D=new W6(P,z);else{if(U.mode!==xo.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+U.mode);D=new j6(P,z)}Object.keys(D.geometry.morphAttributes).length>0&&y8(D,h),D.name=i.createUniqueName(h.name||"mesh_"+t),Uc(D,h),U.extensions&&bd(l,D,U),i.assignFinalMaterial(D),b.push(D)}for(let w=0,T=b.length;w<T;w++)i.associations.set(b[w],{meshes:t,primitives:w});if(b.length===1)return h.extensions&&bd(l,b[0],h),b[0];const _=new Fh;h.extensions&&bd(l,_,h),i.associations.set(_,{meshes:t});for(let w=0,T=b.length;w<T;w++)_.add(b[w]);return _})}loadCamera(t){let i;const o=this.json.cameras[t],l=o[o.type];if(l)return o.type==="perspective"?i=new vs(Ey.radToDeg(l.yfov),l.aspectRatio||1,l.znear||1,l.zfar||2e6):o.type==="orthographic"&&(i=new cA(-l.xmag,l.xmag,l.ymag,-l.ymag,l.znear,l.zfar)),o.name&&(i.name=this.createUniqueName(o.name)),Uc(i,o),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const i=this.json.skins[t],o=[];for(let l=0,h=i.joints.length;l<h;l++)o.push(this._loadNodeShallow(i.joints[l]));return i.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",i.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(l){const h=l.pop(),d=l,f=[],g=[];for(let y=0,x=d.length;y<x;y++){const b=d[y];if(b){f.push(b);const _=new In;h!==null&&_.fromArray(h.array,16*y),g.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[y])}return new tS(f,g)})}loadAnimation(t){const i=this.json,o=this,l=i.animations[t],h=l.name?l.name:"animation_"+t,d=[],f=[],g=[],y=[],x=[];for(let b=0,_=l.channels.length;b<_;b++){const w=l.channels[b],T=l.samplers[w.sampler],P=w.target,U=P.node,D=l.parameters!==void 0?l.parameters[T.input]:T.input,z=l.parameters!==void 0?l.parameters[T.output]:T.output;P.node!==void 0&&(d.push(this.getDependency("node",U)),f.push(this.getDependency("accessor",D)),g.push(this.getDependency("accessor",z)),y.push(T),x.push(P))}return Promise.all([Promise.all(d),Promise.all(f),Promise.all(g),Promise.all(y),Promise.all(x)]).then(function(b){const _=b[0],w=b[1],T=b[2],P=b[3],U=b[4],D=[];for(let z=0,G=_.length;z<G;z++){const Q=_[z],Y=w[z],q=T[z],K=P[z],ne=U[z];if(Q===void 0)continue;Q.updateMatrix&&Q.updateMatrix();const le=o._createAnimationTracks(Q,Y,q,K,ne);if(le)for(let fe=0;fe<le.length;fe++)D.push(le[fe])}return new qw(h,void 0,D)})}createNodeMesh(t){const i=this.json,o=this,l=i.nodes[t];return l.mesh===void 0?null:o.getDependency("mesh",l.mesh).then(function(h){const d=o._getNodeRef(o.meshCache,l.mesh,h);return l.weights!==void 0&&d.traverse(function(f){if(f.isMesh)for(let g=0,y=l.weights.length;g<y;g++)f.morphTargetInfluences[g]=l.weights[g]}),d})}loadNode(t){const i=this,o=this.json.nodes[t],l=i._loadNodeShallow(t),h=[],d=o.children||[];for(let g=0,y=d.length;g<y;g++)h.push(i.getDependency("node",d[g]));const f=o.skin===void 0?Promise.resolve(null):i.getDependency("skin",o.skin);return Promise.all([l,Promise.all(h),f]).then(function(g){const y=g[0],x=g[1],b=g[2];b!==null&&y.traverse(function(_){_.isSkinnedMesh&&_.bind(b,x8)});for(let _=0,w=x.length;_<w;_++)y.add(x[_]);return y})}_loadNodeShallow(t){const i=this.json,o=this.extensions,l=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const h=i.nodes[t],d=h.name?l.createUniqueName(h.name):"",f=[],g=l._invokeOne(function(y){return y.createNodeMesh&&y.createNodeMesh(t)});return g&&f.push(g),h.camera!==void 0&&f.push(l.getDependency("camera",h.camera).then(function(y){return l._getNodeRef(l.cameraCache,h.camera,y)})),l._invokeAll(function(y){return y.createNodeAttachment&&y.createNodeAttachment(t)}).forEach(function(y){f.push(y)}),this.nodeCache[t]=Promise.all(f).then(function(y){let x;if(x=h.isBone===!0?new zL:y.length>1?new Fh:y.length===1?y[0]:new $i,x!==y[0])for(let b=0,_=y.length;b<_;b++)x.add(y[b]);if(h.name&&(x.userData.name=h.name,x.name=d),Uc(x,h),h.extensions&&bd(o,x,h),h.matrix!==void 0){const b=new In;b.fromArray(h.matrix),x.applyMatrix4(b)}else h.translation!==void 0&&x.position.fromArray(h.translation),h.rotation!==void 0&&x.quaternion.fromArray(h.rotation),h.scale!==void 0&&x.scale.fromArray(h.scale);return l.associations.has(x)||l.associations.set(x,{}),l.associations.get(x).nodes=t,x}),this.nodeCache[t]}loadScene(t){const i=this.extensions,o=this.json.scenes[t],l=this,h=new Fh;o.name&&(h.name=l.createUniqueName(o.name)),Uc(h,o),o.extensions&&bd(i,h,o);const d=o.nodes||[],f=[];for(let g=0,y=d.length;g<y;g++)f.push(l.getDependency("node",d[g]));return Promise.all(f).then(function(g){for(let y=0,x=g.length;y<x;y++)h.add(g[y]);return l.associations=(y=>{const x=new Map;for(const[b,_]of l.associations)(b instanceof el||b instanceof qi)&&x.set(b,_);return y.traverse(b=>{const _=l.associations.get(b);_!=null&&x.set(b,_)}),x})(h),h})}_createAnimationTracks(t,i,o,l,h){const d=[],f=t.name?t.name:t.uuid,g=[];let y;switch(Gh[h.path]===Gh.weights?t.traverse(function(_){_.morphTargetInfluences&&g.push(_.name?_.name:_.uuid)}):g.push(f),Gh[h.path]){case Gh.weights:y=AA;break;case Gh.rotation:y=fA;break;case Gh.position:case Gh.scale:y=gA;break;default:o.itemSize===1?y=AA:y=gA}const x=l.interpolation!==void 0?A8[l.interpolation]:Vp,b=this._getArrayFromAccessor(o);for(let _=0,w=g.length;_<w;_++){const T=new y(g[_]+"."+Gh[h.path],i.array,b,x);l.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(T),d.push(T)}return d}_getArrayFromAccessor(t){let i=t.array;if(t.normalized){const o=x1(i.constructor),l=new Float32Array(i.length);for(let h=0,d=i.length;h<d;h++)l[h]=i[h]*o;i=l}return i}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(i){return new(this instanceof fA?p8:K3)(this.times,this.values,this.getValueSize()/3,i)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Z3(p,t,i){const o=t.attributes,l=[];function h(d,f){return i.getDependency("accessor",d).then(function(g){p.setAttribute(f,g)})}for(const d in o){const f=y1[d]||d.toLowerCase();f in p.attributes||l.push(h(o[d],f))}if(t.indices!==void 0&&!p.index){const d=i.getDependency("accessor",t.indices).then(function(f){p.setIndex(f)});l.push(d)}return Si.workingColorSpace!==Yi&&"COLOR_0"in o&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Si.workingColorSpace}" not supported.`),Uc(p,t),function(d,f,g){const y=f.attributes,x=new sa;if(y.POSITION===void 0)return;{const w=g.json.accessors[y.POSITION],T=w.min,P=w.max;if(T===void 0||P===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(x.set(new ve(T[0],T[1],T[2]),new ve(P[0],P[1],P[2])),w.normalized){const U=x1(xA[w.componentType]);x.min.multiplyScalar(U),x.max.multiplyScalar(U)}}const b=f.targets;if(b!==void 0){const w=new ve,T=new ve;for(let P=0,U=b.length;P<U;P++){const D=b[P];if(D.POSITION!==void 0){const z=g.json.accessors[D.POSITION],G=z.min,Q=z.max;if(G!==void 0&&Q!==void 0){if(T.setX(Math.max(Math.abs(G[0]),Math.abs(Q[0]))),T.setY(Math.max(Math.abs(G[1]),Math.abs(Q[1]))),T.setZ(Math.max(Math.abs(G[2]),Math.abs(Q[2]))),z.normalized){const Y=x1(xA[z.componentType]);T.multiplyScalar(Y)}w.max(T)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}x.expandByVector(w)}d.boundingBox=x;const _=new vo;x.getCenter(_.center),_.radius=x.min.distanceTo(x.max)/2,d.boundingSphere=_}(p,t,i),Promise.all(l).then(function(){return t.targets!==void 0?function(d,f,g){let y=!1,x=!1,b=!1;for(let P=0,U=f.length;P<U;P++){const D=f[P];if(D.POSITION!==void 0&&(y=!0),D.NORMAL!==void 0&&(x=!0),D.COLOR_0!==void 0&&(b=!0),y&&x&&b)break}if(!y&&!x&&!b)return Promise.resolve(d);const _=[],w=[],T=[];for(let P=0,U=f.length;P<U;P++){const D=f[P];if(y){const z=D.POSITION!==void 0?g.getDependency("accessor",D.POSITION):d.attributes.position;_.push(z)}if(x){const z=D.NORMAL!==void 0?g.getDependency("accessor",D.NORMAL):d.attributes.normal;w.push(z)}if(b){const z=D.COLOR_0!==void 0?g.getDependency("accessor",D.COLOR_0):d.attributes.color;T.push(z)}}return Promise.all([Promise.all(_),Promise.all(w),Promise.all(T)]).then(function(P){const U=P[0],D=P[1],z=P[2];return y&&(d.morphAttributes.position=U),x&&(d.morphAttributes.normal=D),b&&(d.morphAttributes.color=z),d.morphTargetsRelative=!0,d})}(p,t.targets,i):p})}class b8{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=i}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,i){const o=this.workersResolve[t];if(o&&o(i),this.queue.length){const{resolve:l,msg:h,transfer:d}=this.queue.shift();this.workersResolve[t]=l,this.workers[t].postMessage(h,d)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,i){return new Promise(o=>{const l=this._getIdleWorker();l!==-1?(this._initWorker(l),this.workerStatus|=1<<l,this.workersResolve[l]=o,this.workers[l].postMessage(t,i)):this.queue.push({resolve:o,msg:t,transfer:i})})}dispose(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const eD=9,tD=15,nD=16,iD=22,rD=37,sD=43,aD=76,oD=83,lD=97,cD=100,hD=103,uD=109,dD=165,pD=166,AD=1000066e3;class C8{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Jm{constructor(t,i,o,l){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(t.buffer,t.byteOffset+i,o),this._littleEndian=l,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint8Array(t){const i=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,t);return this._offset+=t,i}_skip(t){return this._offset+=t,this}_scan(t,i){i===void 0&&(i=0);const o=this._offset;let l=0;for(;this._dataView.getUint8(this._offset)!==i&&l<t;)l++,this._offset++;return l<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+o,l)}}const la=[171,75,84,88,32,50,48,187,13,10,26,10];function fD(p){return new TextDecoder().decode(p)}let _1,Nc,b1;const C1={env:{emscripten_notify_memory_growth:function(p){b1=new Uint8Array(Nc.exports.memory.buffer)}}};class w8{init(){return _1||(_1=typeof fetch<"u"?fetch("data:application/wasm;base64,"+mD).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,C1)).then(this._init):WebAssembly.instantiate(Buffer.from(mD,"base64"),C1).then(this._init),_1)}_init(t){Nc=t.instance,C1.env.emscripten_notify_memory_growth(0)}decode(t,i=0){if(!Nc)throw new Error("ZSTDDecoder: Await .init() before decoding.");const o=t.byteLength,l=Nc.exports.malloc(o);b1.set(t,l),i=i||Number(Nc.exports.ZSTD_findDecompressedSize(l,o));const h=Nc.exports.malloc(i),d=Nc.exports.ZSTD_decompress(h,i,l,o),f=b1.slice(h,h+d);return Nc.exports.free(l),Nc.exports.free(h),f}}const mD="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",w1=new WeakMap;let M1,S1=0;class kl extends tl{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new b8,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}async detectSupportAsync(t){return this.workerConfig={astcSupported:await t.hasFeatureAsync("texture-compression-astc"),etc1Supported:await t.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await t.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await t.hasFeatureAsync("texture-compression-bc"),bptcSupported:await t.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await t.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(t){return t.isWebGPURenderer===!0?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),etc1Supported:t.hasFeature("texture-compression-etc1"),etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:t.hasFeature("texture-compression-bptc"),pvrtcSupported:t.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const t=new Rl(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const i=t.loadAsync("basis_transcoder.js"),o=new Rl(this.manager);o.setPath(this.transcoderPath),o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials);const l=o.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,l]).then(([h,d])=>{const f=kl.BasisWorker.toString(),g=["/* constants */","let _EngineFormat = "+JSON.stringify(kl.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(kl.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(kl.BasisFormat),"/* basis_transcoder.js */",h,"/* worker */",f.substring(f.indexOf("{")+1,f.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([g])),this.transcoderBinary=d,this.workerPool.setWorkerCreator(()=>{const y=new Worker(this.workerSourceURL),x=this.transcoderBinary.slice(0);return y.postMessage({type:"init",config:this.workerConfig,transcoderBinary:x},[x]),y})}),S1>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),S1++}return this.transcoderPending}load(t,i,o,l){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const h=new Rl(this.manager);h.setResponseType("arraybuffer"),h.setWithCredentials(this.withCredentials),h.load(t,d=>{this.parse(d,i,l)},o,l)}parse(t,i,o){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(w1.has(t))return w1.get(t).promise.then(i).catch(o);this._createTexture(t).then(l=>i?i(l):null).catch(o)}_createTextureFrom(t,i){const{faces:o,width:l,height:h,format:d,type:f,error:g,dfdFlags:y}=t;if(f==="error")return Promise.reject(g);let x;if(i.faceCount===6)x=new Y6(o,d,Rr);else{const b=o[0].mipmaps;x=i.layerCount>1?new X6(b,l,h,i.layerCount,d,Rr):new gd(b,l,h,d,Rr)}return x.minFilter=o[0].mipmaps.length===1?Fi:mo,x.magFilter=Fi,x.generateMipmaps=!1,x.needsUpdate=!0,x.colorSpace=gD(i),x.premultiplyAlpha=!!(1&y),x}async _createTexture(t,i={}){const o=function(d){const f=new Uint8Array(d.buffer,d.byteOffset,la.length);if(f[0]!==la[0]||f[1]!==la[1]||f[2]!==la[2]||f[3]!==la[3]||f[4]!==la[4]||f[5]!==la[5]||f[6]!==la[6]||f[7]!==la[7]||f[8]!==la[8]||f[9]!==la[9]||f[10]!==la[10]||f[11]!==la[11])throw new Error("Missing KTX 2.0 identifier.");const g=new C8,y=17*Uint32Array.BYTES_PER_ELEMENT,x=new Jm(d,la.length,y,!0);g.vkFormat=x._nextUint32(),g.typeSize=x._nextUint32(),g.pixelWidth=x._nextUint32(),g.pixelHeight=x._nextUint32(),g.pixelDepth=x._nextUint32(),g.layerCount=x._nextUint32(),g.faceCount=x._nextUint32();const b=x._nextUint32();g.supercompressionScheme=x._nextUint32();const _=x._nextUint32(),w=x._nextUint32(),T=x._nextUint32(),P=x._nextUint32(),U=x._nextUint64(),D=x._nextUint64(),z=new Jm(d,la.length+y,3*b*8,!0);for(let pt=0;pt<b;pt++)g.levels.push({levelData:new Uint8Array(d.buffer,d.byteOffset+z._nextUint64(),z._nextUint64()),uncompressedByteLength:z._nextUint64()});const G=new Jm(d,_,w,!0),Q={vendorId:G._skip(4)._nextUint16(),descriptorType:G._nextUint16(),versionNumber:G._nextUint16(),descriptorBlockSize:G._nextUint16(),colorModel:G._nextUint8(),colorPrimaries:G._nextUint8(),transferFunction:G._nextUint8(),flags:G._nextUint8(),texelBlockDimension:[G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8()],bytesPlane:[G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8()],samples:[]},Y=(Q.descriptorBlockSize/4-6)/4;for(let pt=0;pt<Y;pt++){const lt={bitOffset:G._nextUint16(),bitLength:G._nextUint8(),channelType:G._nextUint8(),samplePosition:[G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&lt.channelType?(lt.sampleLower=G._nextInt32(),lt.sampleUpper=G._nextInt32()):(lt.sampleLower=G._nextUint32(),lt.sampleUpper=G._nextUint32()),Q.samples[pt]=lt}g.dataFormatDescriptor.length=0,g.dataFormatDescriptor.push(Q);const q=new Jm(d,T,P,!0);for(;q._offset<P;){const pt=q._nextUint32(),lt=q._scan(pt),he=fD(lt);if(g.keyValue[he]=q._nextUint8Array(pt-lt.byteLength-1),he.match(/^ktx/i)){const Z=fD(g.keyValue[he]);g.keyValue[he]=Z.substring(0,Z.lastIndexOf("\0"))}q._skip(pt%4?4-pt%4:0)}if(D<=0)return g;const K=new Jm(d,U,D,!0),ne=K._nextUint16(),le=K._nextUint16(),fe=K._nextUint32(),be=K._nextUint32(),de=K._nextUint32(),Fe=K._nextUint32(),we=[];for(let pt=0;pt<b;pt++)we.push({imageFlags:K._nextUint32(),rgbSliceByteOffset:K._nextUint32(),rgbSliceByteLength:K._nextUint32(),alphaSliceByteOffset:K._nextUint32(),alphaSliceByteLength:K._nextUint32()});const Me=U+K._offset,_e=Me+fe,tt=_e+be,me=tt+de,wt=new Uint8Array(d.buffer,d.byteOffset+Me,fe),ft=new Uint8Array(d.buffer,d.byteOffset+_e,be),ze=new Uint8Array(d.buffer,d.byteOffset+tt,de),$e=new Uint8Array(d.buffer,d.byteOffset+me,Fe);return g.globalData={endpointCount:ne,selectorCount:le,imageDescs:we,endpointsData:wt,selectorsData:ft,tablesData:ze,extendedData:$e},g}(new Uint8Array(t));if(o.vkFormat!==0)return async function(d){const{vkFormat:f}=d;if(I1[f]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let g;d.supercompressionScheme===2&&(M1||(M1=new Promise(async b=>{const _=new w8;await _.init(),b(_)})),g=await M1);const y=[];for(let b=0;b<d.levels.length;b++){const _=Math.max(1,d.pixelWidth>>b),w=Math.max(1,d.pixelHeight>>b),T=d.pixelDepth?Math.max(1,d.pixelDepth>>b):0,P=d.levels[b];let U,D;if(d.supercompressionScheme===0)U=P.levelData;else{if(d.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");U=g.decode(P.levelData,P.uncompressedByteLength)}D=T1[f]===Wr?new Float32Array(U.buffer,U.byteOffset,U.byteLength/Float32Array.BYTES_PER_ELEMENT):T1[f]===ss?new Uint16Array(U.buffer,U.byteOffset,U.byteLength/Uint16Array.BYTES_PER_ELEMENT):U,y.push({data:D,width:_,height:w,depth:T})}let x;if(M8.has(I1[f]))x=d.pixelDepth===0?new Fm(y[0].data,d.pixelWidth,d.pixelHeight):new QR(y[0].data,d.pixelWidth,d.pixelHeight,d.pixelDepth);else{if(d.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");x=new gd(y,d.pixelWidth,d.pixelHeight)}return x.mipmaps=y,x.type=T1[f],x.format=I1[f],x.colorSpace=gD(d),x.needsUpdate=!0,Promise.resolve(x)}(o);const l=i,h=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:l},[t])).then(d=>this._createTextureFrom(d.data,o));return w1.set(t,{promise:h}),h}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),S1--,this}}kl.BasisFormat={ETC1S:0,UASTC_4x4:1},kl.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},kl.EngineFormat={RGBAFormat:fr,RGBA_ASTC_4x4_Format:_m,RGBA_BPTC_Format:Cm,RGBA_ETC2_EAC_Format:py,RGBA_PVRTC_4BPPV1_Format:hy,RGBA_S3TC_DXT5_Format:xm,RGB_ETC1_Format:uy,RGB_ETC2_Format:dy,RGB_PVRTC_4BPPV1_Format:cy,RGBA_S3TC_DXT1_Format:Em},kl.BasisWorker=function(){let p,t,i;const o=_EngineFormat,l=_TranscoderFormat,h=_BasisFormat;self.addEventListener("message",function(b){const _=b.data;switch(_.type){case"init":p=_.config,w=_.transcoderBinary,t=new Promise(T=>{i={wasmBinary:w,onRuntimeInitialized:T},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{const{faces:T,buffers:P,width:U,height:D,hasAlpha:z,format:G,dfdFlags:Q}=function(Y){const q=new i.KTX2File(new Uint8Array(Y));function K(){q.close(),q.delete()}if(!q.isValid())throw K(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const ne=q.isUASTC()?h.UASTC_4x4:h.ETC1S,le=q.getWidth(),fe=q.getHeight(),be=q.getLayers()||1,de=q.getLevels(),Fe=q.getFaces(),we=q.getHasAlpha(),Me=q.getDFDFlags(),{transcoderFormat:_e,engineFormat:tt}=function(ft,ze,$e,pt){let lt,he;const Z=ft===h.ETC1S?f:g;for(let Ce=0;Ce<Z.length;Ce++){const Qe=Z[Ce];if(p[Qe.if]&&Qe.basisFormat.includes(ft)&&!(pt&&Qe.transcoderFormat.length<2)&&(!Qe.needsPowerOfTwo||y(ze)&&y($e)))return lt=Qe.transcoderFormat[pt?1:0],he=Qe.engineFormat[pt?1:0],{transcoderFormat:lt,engineFormat:he}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),lt=l.RGBA32,he=o.RGBAFormat,{transcoderFormat:lt,engineFormat:he}}(ne,le,fe,we);if(!le||!fe||!de)throw K(),new Error("THREE.KTX2Loader:	Invalid texture");if(!q.startTranscoding())throw K(),new Error("THREE.KTX2Loader: .startTranscoding failed");const me=[],wt=[];for(let ft=0;ft<Fe;ft++){const ze=[];for(let $e=0;$e<de;$e++){const pt=[];let lt,he;for(let Ce=0;Ce<be;Ce++){const Qe=q.getImageLevelInfo($e,Ce,ft);ft!==0||$e!==0||Ce!==0||Qe.origWidth%4==0&&Qe.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),de>1?(lt=Qe.origWidth,he=Qe.origHeight):(lt=Qe.width,he=Qe.height);const Pe=new Uint8Array(q.getImageTranscodedSizeInBytes($e,Ce,0,_e));if(!q.transcodeImage(Pe,$e,Ce,ft,_e,0,-1,-1))throw K(),new Error("THREE.KTX2Loader: .transcodeImage failed.");pt.push(Pe)}const Z=x(pt);ze.push({data:Z,width:lt,height:he}),wt.push(Z.buffer)}me.push({mipmaps:ze,width:le,height:fe,format:tt})}return K(),{faces:me,buffers:wt,width:le,height:fe,hasAlpha:we,format:tt,dfdFlags:Me}}(_.buffer);self.postMessage({type:"transcode",id:_.id,faces:T,width:U,height:D,hasAlpha:z,format:G,dfdFlags:Q},P)}catch(T){console.error(T),self.postMessage({type:"error",id:_.id,error:T.message})}})}var w});const d=[{if:"astcSupported",basisFormat:[h.UASTC_4x4],transcoderFormat:[l.ASTC_4x4,l.ASTC_4x4],engineFormat:[o.RGBA_ASTC_4x4_Format,o.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[l.BC7_M5,l.BC7_M5],engineFormat:[o.RGBA_BPTC_Format,o.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[l.BC1,l.BC3],engineFormat:[o.RGBA_S3TC_DXT1_Format,o.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[l.ETC1,l.ETC2],engineFormat:[o.RGB_ETC2_Format,o.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[l.ETC1],engineFormat:[o.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[l.PVRTC1_4_RGB,l.PVRTC1_4_RGBA],engineFormat:[o.RGB_PVRTC_4BPPV1_Format,o.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],f=d.sort(function(b,_){return b.priorityETC1S-_.priorityETC1S}),g=d.sort(function(b,_){return b.priorityUASTC-_.priorityUASTC});function y(b){return b<=2||!(b&b-1)&&b!==0}function x(b){if(b.length===1)return b[0];let _=0;for(let P=0;P<b.length;P++)_+=b[P].byteLength;const w=new Uint8Array(_);let T=0;for(let P=0;P<b.length;P++){const U=b[P];w.set(U,T),T+=U.byteLength}return w}};const M8=new Set([fr,ld,Bh]),I1={[uD]:fr,[lD]:fr,[rD]:fr,[sD]:fr,[hD]:ld,[oD]:ld,[nD]:ld,[iD]:ld,[cD]:Bh,[aD]:Bh,[tD]:Bh,[eD]:Bh,[AD]:_m,[pD]:bm,[dD]:bm},T1={[uD]:Wr,[lD]:ss,[rD]:Rr,[sD]:Rr,[hD]:Wr,[oD]:ss,[nD]:Rr,[iD]:Rr,[cD]:Wr,[aD]:ss,[tD]:Rr,[eD]:Rr,[AD]:ss,[pD]:Rr,[dD]:Rr};function gD(p){const t=p.dataFormatDescriptor[0];return t.colorPrimaries===1?t.transferFunction===2?sr:Yi:t.colorPrimaries===10?t.transferFunction===2?fy:wm:(t.colorPrimaries===0||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),Sc)}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vD,yD;const nl=Symbol("retainerCount"),Fc=Symbol("recentlyUsed"),pE=Symbol("evict"),$m=Symbol("evictionThreshold"),B1=Symbol("cache");class S8{constructor(t,i=5){this[vD]=new Map,this[yD]=[],this[B1]=t,this[$m]=i}set evictionThreshold(t){this[$m]=t,this[pE]()}get evictionThreshold(){return this[$m]}get cache(){return this[B1]}retainerCount(t){return this[nl].get(t)||0}reset(){this[nl].clear(),this[Fc]=[]}retain(t){this[nl].has(t)||this[nl].set(t,0),this[nl].set(t,this[nl].get(t)+1);const i=this[Fc].indexOf(t);i!==-1&&this[Fc].splice(i,1),this[Fc].unshift(t),this[pE]()}release(t){this[nl].has(t)&&this[nl].set(t,Math.max(this[nl].get(t)-1,0)),this[pE]()}[(vD=nl,yD=Fc,pE)](){if(!(this[Fc].length<this[$m]))for(let t=this[Fc].length-1;t>=this[$m];--t){const i=this[Fc][t];this[nl].get(i)===0&&(this[B1].delete(i),this[Fc].splice(t,1))}}}/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I8=p=>{const t=new Map;for(const i of p.mappings)for(const o of i.variants)t.set(o,{material:null,gltfMaterialIndex:i.material});return t};class T8{constructor(t){this.parser=t,this.name="KHR_materials_variants"}afterRoot(t){const i=this.parser,o=i.json;if(o.extensions===void 0||o.extensions[this.name]===void 0)return null;const l=(h=>{const d=[],f=new Set;for(const g of h){let y=g,x=0;for(;f.has(y);)y=g+"."+ ++x;f.add(y),d.push(y)}return d})((o.extensions[this.name].variants||[]).map(h=>h.name));for(const h of t.scenes)h.traverse(d=>{const f=d;if(!f.material)return;const g=i.associations.get(f);if(g==null||g.meshes==null||g.primitives==null)return;const y=o.meshes[g.meshes].primitives[g.primitives].extensions;y&&y[this.name]&&(f.userData.variantMaterials=I8(y[this.name]))});return t.userData.variants=l,Promise.resolve()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ED,xD;qi.DEFAULT_ANISOTROPY=4;const Oc=new Map,R1=new Map;let _D;const bD=new class extends tl{constructor(p){super(p),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(p){return this.decoderPath=p,this}setDecoderConfig(p){return this.decoderConfig=p,this}setWorkerLimit(p){return this.workerLimit=p,this}load(p,t,i,o){const l=new Rl(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(p,h=>{this.parse(h,t,o)},i,o)}parse(p,t,i=()=>{}){this.decodeDracoFile(p,t,null,null,sr,i).catch(i)}decodeDracoFile(p,t,i,o,l=Yi,h=()=>{}){const d={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:l};return this.decodeGeometry(p,d).then(t).catch(h)}decodeGeometry(p,t){const i=JSON.stringify(t);if(g1.has(p)){const f=g1.get(p);if(f.key===i)return f.promise;if(p.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const l=this.workerNextTaskID++,h=p.byteLength,d=this._getWorker(l,h).then(f=>(o=f,new Promise((g,y)=>{o._callbacks[l]={resolve:g,reject:y},o.postMessage({type:"decode",id:l,taskConfig:t,buffer:p},[p])}))).then(f=>this._createGeometry(f.geometry));return d.catch(()=>!0).then(()=>{o&&l&&this._releaseTask(o,l)}),g1.set(p,{key:i,promise:d}),d}_createGeometry(p){const t=new Ra;p.index&&t.setIndex(new mr(p.index.array,1));for(let i=0;i<p.attributes.length;i++){const o=p.attributes[i],l=o.name,h=o.array,d=o.itemSize,f=new mr(h,d);l==="color"&&(this._assignVertexColorSpace(f,o.vertexColorSpace),f.normalized=!(h instanceof Float32Array)),t.setAttribute(l,f)}return t}_assignVertexColorSpace(p,t){if(t!==sr)return;const i=new fn;for(let o=0,l=p.count;o<l;o++)i.fromBufferAttribute(p,o),Si.toWorkingColorSpace(i,sr),p.setXYZ(o,i.r,i.g,i.b)}_loadLibrary(p,t){const i=new Rl(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((o,l)=>{i.load(p,o,void 0,l)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const p=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return p?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const o=i[0];p||(this.decoderConfig.wasmBinary=i[1]);const l=kz.toString(),h=["/* draco decoder */",o,"","/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([h]))}),this.decoderPending}_getWorker(p,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(l){const h=l.data;switch(h.type){case"decode":o._callbacks[h.id].resolve(h);break;case"error":o._callbacks[h.id].reject(h);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,l){return o._taskLoad>l._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[p]=t,i._taskLoad+=t,i})}_releaseTask(p,t){p._taskLoad-=p._taskCosts[t],delete p._callbacks[t],delete p._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(p=>p._taskLoad))}dispose(){for(let p=0;p<this.workerPool.length;++p)this.workerPool[p].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};let CD;const L1=new kl;let D1,P1;const Cd=Symbol("loader"),Hh=Symbol("evictionPolicy"),wD=Symbol("GLTFInstance");class ca extends Xo{constructor(t){super(),this[xD]=new Qz().register(i=>new T8(i)),this[wD]=t,this[Cd].setDRACOLoader(bD),this[Cd].setKTX2Loader(L1)}static setDRACODecoderLocation(t){_D=t,bD.setDecoderPath(t)}static getDRACODecoderLocation(){return _D}static setKTX2TranscoderLocation(t){CD=t,L1.setTranscoderPath(t)}static getKTX2TranscoderLocation(){return CD}static setMeshoptDecoderLocation(t){var i;D1!==t&&(D1=t,P1=(i=t,new Promise((o,l)=>{const h=document.createElement("script");document.body.appendChild(h),h.onload=o,h.onerror=l,h.async=!0,h.src=i})).then(()=>MeshoptDecoder.ready).then(()=>MeshoptDecoder))}static getMeshoptDecoderLocation(){return D1}static initializeKTX2Loader(t){L1.detectSupport(t)}static get cache(){return Oc}static clearCache(){Oc.forEach((t,i)=>{this.delete(i)}),this[Hh].reset()}static has(t){return Oc.has(t)}static async delete(t){if(!this.has(t))return;const i=Oc.get(t);R1.delete(t),Oc.delete(t),(await i).dispose()}static hasFinishedLoading(t){return!!R1.get(t)}get[(ED=Hh,xD=Cd,Hh)](){return this.constructor[Hh]}async preload(t,i,o=()=>{}){if(this[Cd].setWithCredentials(i.withCredentials),this.dispatchEvent({type:"preload",element:i,src:t}),!Oc.has(t)){P1!=null&&this[Cd].setMeshoptDecoder(await P1);const l=((f,g,y=()=>{})=>{const x=b=>{const _=b.loaded/b.total;y(Math.max(0,Math.min(1,isFinite(_)?_:1)))};return new Promise((b,_)=>{g.load(f,b,x,_)})})(t,this[Cd],f=>{o(.8*f)}),h=this[wD],d=l.then(f=>h.prepare(f)).then(f=>(o(.9),new h(f))).catch(f=>(console.error(f),new h));Oc.set(t,d)}await Oc.get(t),R1.set(t,!0),o&&o(1)}async load(t,i,o=()=>{}){await this.preload(t,i,o);const l=await Oc.get(t),h=await l.clone();return this[Hh].retain(t),h.dispose=()=>{this[Hh].release(t)},h}}ca[ED]=new S8(ca);class B8 extends $i{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Hn(.5,.5),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(t,i){return super.copy(t,i),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const _A=new ve,MD=new In,SD=new In,ID=new ve,TD=new ve;class R8{constructor(t={}){const i=this;let o,l,h,d;const f={objects:new WeakMap},g=t.element!==void 0?t.element:document.createElement("div");function y(_){_.isCSS2DObject&&(_.element.style.display="none");for(let w=0,T=_.children.length;w<T;w++)y(_.children[w])}function x(_,w,T){if(_.visible!==!1){if(_.isCSS2DObject){_A.setFromMatrixPosition(_.matrixWorld),_A.applyMatrix4(SD);const P=_A.z>=-1&&_A.z<=1&&_.layers.test(T.layers)===!0,U=_.element;U.style.display=P===!0?"":"none",P===!0&&(_.onBeforeRender(i,w,T),U.style.transform="translate("+-100*_.center.x+"%,"+-100*_.center.y+"%)translate("+(_A.x*h+h)+"px,"+(-_A.y*d+d)+"px)",U.parentNode!==g&&g.appendChild(U),_.onAfterRender(i,w,T));const D={distanceToCameraSquared:b(T,_)};f.objects.set(_,D)}for(let P=0,U=_.children.length;P<U;P++)x(_.children[P],w,T)}else y(_)}function b(_,w){return ID.setFromMatrixPosition(_.matrixWorld),TD.setFromMatrixPosition(w.matrixWorld),ID.distanceToSquared(TD)}g.style.overflow="hidden",this.domElement=g,this.getSize=function(){return{width:o,height:l}},this.render=function(_,w){_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),w.parent===null&&w.matrixWorldAutoUpdate===!0&&w.updateMatrixWorld(),MD.copy(w.matrixWorldInverse),SD.multiplyMatrices(w.projectionMatrix,MD),x(_,_,w),function(T){const P=function(D){const z=[];return D.traverseVisible(function(G){G.isCSS2DObject&&z.push(G)}),z}(T).sort(function(D,z){return D.renderOrder!==z.renderOrder?z.renderOrder-D.renderOrder:f.objects.get(D).distanceToCameraSquared-f.objects.get(z).distanceToCameraSquared}),U=P.length;for(let D=0,z=P.length;D<z;D++)P[D].element.style.zIndex=U-D}(_)},this.setSize=function(_,w){o=_,l=w,h=o/2,d=l/2,g.style.width=_+"px",g.style.height=w+"px"}}}function AE(p,t,i){let o=i;const l=new ve;return p.updateWorldMatrix(!0,!0),p.traverseVisible(h=>{const{geometry:d}=h;if(d!==void 0){const{position:f}=d.attributes;if(f!==void 0)for(let g=0,y=f.count;g<y;g++)h.isMesh?h.getVertexPosition(g,l):l.fromBufferAttribute(f,g),h.isSkinnedMesh||l.applyMatrix4(h.matrixWorld),o=t(o,l)}}),o}let Zm,U1,bA,fE;function mE(p,t=1/0,i=null){U1||(U1=new Fl(2,2,1,1)),bA||(bA=new Ta({uniforms:{blitTexture:new iS(p)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),bA.uniforms.blitTexture.value=p,bA.defines.IS_SRGB=p.colorSpace==sr,bA.needsUpdate=!0,fE||(fE=new Vi(U1,bA),fE.frustumCulled=!1);const o=new vs,l=new Oh;l.add(fE),i===null&&(i=Zm=new Qw({antialias:!1}));const h=Math.min(p.image.width,t),d=Math.min(p.image.height,t);i.setSize(h,d),i.clear(),i.render(l,o);const f=document.createElement("canvas"),g=f.getContext("2d");f.width=h,f.height=d,g.drawImage(i.domElement,0,0,h,d);const y=new jw(f);return y.minFilter=p.minFilter,y.magFilter=p.magFilter,y.wrapS=p.wrapS,y.wrapT=p.wrapT,y.colorSpace=p.colorSpace,y.name=p.name,Zm&&(Zm.forceContextLoss(),Zm.dispose(),Zm=null),y}const BD={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class N1{constructor(){this.pluginCallbacks=[],this.register(function(t){return new X8(t)}),this.register(function(t){return new Y8(t)}),this.register(function(t){return new Z8(t)}),this.register(function(t){return new eV(t)}),this.register(function(t){return new tV(t)}),this.register(function(t){return new nV(t)}),this.register(function(t){return new K8(t)}),this.register(function(t){return new J8(t)}),this.register(function(t){return new $8(t)}),this.register(function(t){return new iV(t)}),this.register(function(t){return new rV(t)}),this.register(function(t){return new sV(t)}),this.register(function(t){return new aV(t)}),this.register(function(t){return new oV(t)})}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,i,o,l){const h=new q8,d=[];for(let f=0,g=this.pluginCallbacks.length;f<g;f++)d.push(this.pluginCallbacks[f](h));h.setPlugins(d),h.write(t,i,l).catch(o)}parseAsync(t,i){const o=this;return new Promise(function(l,h){o.parse(t,l,h,i)})}}const L8=0,RD=1,D8=2,P8=3,U8=4,F1=5120,O1=5121,k1=5122,Q1=5123,LD=5124,DD=5125,PD=5126,G1=34962,N8=34963,F8=9728,O8=9729,k8=9984,Q8=9985,G8=9986,H8=9987,z8=33071,V8=33648,W8=10497,H1="KHR_mesh_quantization",Ya={};Ya[1003]=F8,Ya[1004]=k8,Ya[1005]=G8,Ya[1006]=O8,Ya[1007]=Q8,Ya[1008]=H8,Ya[1001]=z8,Ya[1e3]=W8,Ya[1002]=V8;const UD={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},j8=new fn;function eg(p,t){return p.length===t.length&&p.every(function(i,o){return i===t[o]})}function ND(p){return 4*Math.ceil(p/4)}function z1(p,t=0){const i=ND(p.byteLength);if(i!==p.byteLength){const o=new Uint8Array(i);if(o.set(new Uint8Array(p)),t!==0)for(let l=p.byteLength;l<i;l++)o[l]=t;return o.buffer}return p}function FD(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function OD(p,t){if(p.toBlob!==void 0)return new Promise(o=>p.toBlob(o,t));let i;return t==="image/jpeg"?i=.92:t==="image/webp"&&(i=.8),p.convertToBlob({type:t,quality:i})}class q8{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+ny}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(t){this.plugins=t}async write(t,i,o={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},o),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),await Promise.all(this.pending);const l=this,h=l.buffers,d=l.json;o=l.options;const f=l.extensionsUsed,g=l.extensionsRequired,y=new Blob(h,{type:"application/octet-stream"}),x=Object.keys(f),b=Object.keys(g);if(x.length>0&&(d.extensionsUsed=x),b.length>0&&(d.extensionsRequired=b),d.buffers&&d.buffers.length>0&&(d.buffers[0].byteLength=y.size),o.binary===!0){const _=new FileReader;_.readAsArrayBuffer(y),_.onloadend=function(){const w=z1(_.result),T=new DataView(new ArrayBuffer(8));T.setUint32(0,w.byteLength,!0),T.setUint32(4,5130562,!0);const P=z1((U=JSON.stringify(d),new TextEncoder().encode(U).buffer),32);var U;const D=new DataView(new ArrayBuffer(8));D.setUint32(0,P.byteLength,!0),D.setUint32(4,1313821514,!0);const z=new ArrayBuffer(12),G=new DataView(z);G.setUint32(0,1179937895,!0),G.setUint32(4,2,!0);const Q=12+D.byteLength+P.byteLength+T.byteLength+w.byteLength;G.setUint32(8,Q,!0);const Y=new Blob([z,D,P,T,w],{type:"application/octet-stream"}),q=new FileReader;q.readAsArrayBuffer(Y),q.onloadend=function(){i(q.result)}}}else if(d.buffers&&d.buffers.length>0){const _=new FileReader;_.readAsDataURL(y),_.onloadend=function(){const w=_.result;d.buffers[0].uri=w,i(d)}}else i(d)}serializeUserData(t,i){if(Object.keys(t.userData).length===0)return;const o=this.options,l=this.extensionsUsed;try{const h=JSON.parse(JSON.stringify(t.userData));if(o.includeCustomExtensions&&h.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const d in h.gltfExtensions)i.extensions[d]=h.gltfExtensions[d],l[d]=!0;delete h.gltfExtensions}Object.keys(h).length>0&&(i.extras=h)}catch(h){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+h.message)}}getUID(t,i=!1){if(this.uids.has(t)===!1){const o=new Map;o.set(!0,this.uid++),o.set(!1,this.uid++),this.uids.set(t,o)}return this.uids.get(t).get(i)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const i=new ve;for(let o=0,l=t.count;o<l;o++)if(Math.abs(i.fromBufferAttribute(t,o).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const i=this.cache;if(i.attributesNormalized.has(t))return i.attributesNormalized.get(t);const o=t.clone(),l=new ve;for(let h=0,d=o.count;h<d;h++)l.fromBufferAttribute(o,h),l.x===0&&l.y===0&&l.z===0?l.setX(1):l.normalize(),o.setXYZ(h,l.x,l.y,l.z);return i.attributesNormalized.set(t,o),o}applyTextureTransform(t,i){let o=!1;const l={};i.offset.x===0&&i.offset.y===0||(l.offset=i.offset.toArray(),o=!0),i.rotation!==0&&(l.rotation=i.rotation,o=!0),i.repeat.x===1&&i.repeat.y===1||(l.scale=i.repeat.toArray(),o=!0),o&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=l,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(t,i){if(t===i)return t;function o(_){return _.colorSpace===sr?function(w){return w<.04045?.0773993808*w:Math.pow(.9478672986*w+.0521327014,2.4)}:function(w){return w}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),t instanceof gd&&(t=mE(t)),i instanceof gd&&(i=mE(i));const l=t?t.image:null,h=i?i.image:null,d=Math.max(l?l.width:0,h?h.width:0),f=Math.max(l?l.height:0,h?h.height:0),g=FD();g.width=d,g.height=f;const y=g.getContext("2d",{willReadFrequently:!0});y.fillStyle="#00ffff",y.fillRect(0,0,d,f);const x=y.getImageData(0,0,d,f);if(l){y.drawImage(l,0,0,d,f);const _=o(t),w=y.getImageData(0,0,d,f).data;for(let T=2;T<w.length;T+=4)x.data[T]=256*_(w[T]/256)}if(h){y.drawImage(h,0,0,d,f);const _=o(i),w=y.getImageData(0,0,d,f).data;for(let T=1;T<w.length;T+=4)x.data[T]=256*_(w[T]/256)}y.putImageData(x,0,0);const b=(t||i).clone();return b.source=new ow(g),b.colorSpace=Sc,b.channel=(t||i).channel,t&&i&&t.channel!==i.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),b}processBuffer(t){const i=this.json,o=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),o.push(t),0}processBufferView(t,i,o,l,h){const d=this.json;let f;switch(d.bufferViews||(d.bufferViews=[]),i){case F1:case O1:f=1;break;case k1:case Q1:f=2;break;default:f=4}let g=t.itemSize*f;h===G1&&(g=4*Math.ceil(g/4));const y=ND(l*g),x=new DataView(new ArrayBuffer(y));let b=0;for(let w=o;w<o+l;w++){for(let T=0;T<t.itemSize;T++){let P;t.itemSize>4?P=t.array[w*t.itemSize+T]:(T===0?P=t.getX(w):T===1?P=t.getY(w):T===2?P=t.getZ(w):T===3&&(P=t.getW(w)),t.normalized===!0&&(P=Ey.normalize(P,t.array))),i===PD?x.setFloat32(b,P,!0):i===LD?x.setInt32(b,P,!0):i===DD?x.setUint32(b,P,!0):i===k1?x.setInt16(b,P,!0):i===Q1?x.setUint16(b,P,!0):i===F1?x.setInt8(b,P):i===O1&&x.setUint8(b,P),b+=f}b%g!=0&&(b+=g-b%g)}const _={buffer:this.processBuffer(x.buffer),byteOffset:this.byteOffset,byteLength:y};return h!==void 0&&(_.target=h),h===G1&&(_.byteStride=g),this.byteOffset+=y,d.bufferViews.push(_),{id:d.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const i=this,o=i.json;return o.bufferViews||(o.bufferViews=[]),new Promise(function(l){const h=new FileReader;h.readAsArrayBuffer(t),h.onloadend=function(){const d=z1(h.result),f={buffer:i.processBuffer(d),byteOffset:i.byteOffset,byteLength:d.byteLength};i.byteOffset+=d.byteLength,l(o.bufferViews.push(f)-1)}})}processAccessor(t,i,o,l){const h=this.json;let d;if(t.array.constructor===Float32Array)d=PD;else if(t.array.constructor===Int32Array)d=LD;else if(t.array.constructor===Uint32Array)d=DD;else if(t.array.constructor===Int16Array)d=k1;else if(t.array.constructor===Uint16Array)d=Q1;else if(t.array.constructor===Int8Array)d=F1;else{if(t.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+t.array.constructor.name);d=O1}if(o===void 0&&(o=0),l!==void 0&&l!==1/0||(l=t.count),l===0)return null;const f=function(b,_,w){const T={min:new Array(b.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(b.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let P=_;P<_+w;P++)for(let U=0;U<b.itemSize;U++){let D;b.itemSize>4?D=b.array[P*b.itemSize+U]:(U===0?D=b.getX(P):U===1?D=b.getY(P):U===2?D=b.getZ(P):U===3&&(D=b.getW(P)),b.normalized===!0&&(D=Ey.normalize(D,b.array))),T.min[U]=Math.min(T.min[U],D),T.max[U]=Math.max(T.max[U],D)}return T}(t,o,l);let g;i!==void 0&&(g=t===i.index?N8:G1);const y=this.processBufferView(t,d,o,l,g),x={bufferView:y.id,byteOffset:y.byteOffset,componentType:d,count:l,max:f.max,min:f.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[t.itemSize]};return t.normalized===!0&&(x.normalized=!0),h.accessors||(h.accessors=[]),h.accessors.push(x)-1}processImage(t,i,o,l="image/png"){if(t!==null){const h=this,d=h.cache,f=h.json,g=h.options,y=h.pending;d.images.has(t)||d.images.set(t,{});const x=d.images.get(t),b=l+":flipY/"+o.toString();if(x[b]!==void 0)return x[b];f.images||(f.images=[]);const _={mimeType:l},w=FD();w.width=Math.min(t.width,g.maxTextureSize),w.height=Math.min(t.height,g.maxTextureSize);const T=w.getContext("2d",{willReadFrequently:!0});if(o===!0&&(T.translate(0,w.height),T.scale(1,-1)),t.data!==void 0){i!==fr&&console.error("GLTFExporter: Only RGBAFormat is supported.",i),(t.width>g.maxTextureSize||t.height>g.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const U=new Uint8ClampedArray(t.height*t.width*4);for(let D=0;D<U.length;D+=4)U[D+0]=t.data[D+0],U[D+1]=t.data[D+1],U[D+2]=t.data[D+2],U[D+3]=t.data[D+3];T.putImageData(new ImageData(U,t.width,t.height),0,0)}else{if(!(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas))throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");T.drawImage(t,0,0,w.width,w.height)}g.binary===!0?y.push(OD(w,l).then(U=>h.processBufferViewImage(U)).then(U=>{_.bufferView=U})):w.toDataURL!==void 0?_.uri=w.toDataURL(l):y.push(OD(w,l).then(U=>new FileReader().readAsDataURL(U)).then(U=>{_.uri=U}));const P=f.images.push(_)-1;return x[b]=P,P}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const i=this.json;i.samplers||(i.samplers=[]);const o={magFilter:Ya[t.magFilter],minFilter:Ya[t.minFilter],wrapS:Ya[t.wrapS],wrapT:Ya[t.wrapT]};return i.samplers.push(o)-1}processTexture(t){const i=this.options,o=this.cache,l=this.json;if(o.textures.has(t))return o.textures.get(t);l.textures||(l.textures=[]),t instanceof gd&&(t=mE(t,i.maxTextureSize));let h=t.userData.mimeType;h==="image/webp"&&(h="image/png");const d={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,h)};t.name&&(d.name=t.name),this._invokeAll(function(g){g.writeTexture&&g.writeTexture(t,d)});const f=l.textures.push(d)-1;return o.textures.set(t,f),f}processMaterial(t){const i=this.cache,o=this.json;if(i.materials.has(t))return i.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;o.materials||(o.materials=[]);const l={pbrMetallicRoughness:{}};t.isMeshStandardMaterial!==!0&&t.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const h=t.color.toArray().concat([t.opacity]);if(eg(h,[1,1,1,1])||(l.pbrMetallicRoughness.baseColorFactor=h),t.isMeshStandardMaterial?(l.pbrMetallicRoughness.metallicFactor=t.metalness,l.pbrMetallicRoughness.roughnessFactor=t.roughness):(l.pbrMetallicRoughness.metallicFactor=.5,l.pbrMetallicRoughness.roughnessFactor=.5),t.metalnessMap||t.roughnessMap){const f=this.buildMetalRoughTexture(t.metalnessMap,t.roughnessMap),g={index:this.processTexture(f),channel:f.channel};this.applyTextureTransform(g,f),l.pbrMetallicRoughness.metallicRoughnessTexture=g}if(t.map){const f={index:this.processTexture(t.map),texCoord:t.map.channel};this.applyTextureTransform(f,t.map),l.pbrMetallicRoughness.baseColorTexture=f}if(t.emissive){const f=t.emissive;if(Math.max(f.r,f.g,f.b)>0&&(l.emissiveFactor=t.emissive.toArray()),t.emissiveMap){const g={index:this.processTexture(t.emissiveMap),texCoord:t.emissiveMap.channel};this.applyTextureTransform(g,t.emissiveMap),l.emissiveTexture=g}}if(t.normalMap){const f={index:this.processTexture(t.normalMap),texCoord:t.normalMap.channel};t.normalScale&&t.normalScale.x!==1&&(f.scale=t.normalScale.x),this.applyTextureTransform(f,t.normalMap),l.normalTexture=f}if(t.aoMap){const f={index:this.processTexture(t.aoMap),texCoord:t.aoMap.channel};t.aoMapIntensity!==1&&(f.strength=t.aoMapIntensity),this.applyTextureTransform(f,t.aoMap),l.occlusionTexture=f}t.transparent?l.alphaMode="BLEND":t.alphaTest>0&&(l.alphaMode="MASK",l.alphaCutoff=t.alphaTest),t.side===2&&(l.doubleSided=!0),t.name!==""&&(l.name=t.name),this.serializeUserData(t,l),this._invokeAll(function(f){f.writeMaterial&&f.writeMaterial(t,l)});const d=o.materials.push(l)-1;return i.materials.set(t,d),d}processMesh(t){const i=this.cache,o=this.json,l=[t.geometry.uuid];if(Array.isArray(t.material))for(let Q=0,Y=t.material.length;Q<Y;Q++)l.push(t.material[Q].uuid);else l.push(t.material.uuid);const h=l.join(":");if(i.meshes.has(h))return i.meshes.get(h);const d=t.geometry;let f;f=t.isLineSegments?RD:t.isLineLoop?D8:t.isLine?P8:t.isPoints?L8:t.material.wireframe?RD:U8;const g={},y={},x=[],b=[],_={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},w=d.getAttribute("normal");w===void 0||this.isNormalizedNormalAttribute(w)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),d.setAttribute("normal",this.createNormalizedNormalAttribute(w)));let T=null;for(let Q in d.attributes){if(Q.slice(0,5)==="morph")continue;const Y=d.attributes[Q];if(Q=_[Q]||Q.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(Q)||(Q="_"+Q),i.attributes.has(this.getUID(Y))){y[Q]=i.attributes.get(this.getUID(Y));continue}T=null;const q=Y.array;Q!=="JOINTS_0"||q instanceof Uint16Array||q instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),T=new mr(new Uint16Array(q),Y.itemSize,Y.normalized));const K=this.processAccessor(T||Y,d);K!==null&&(Q.startsWith("_")||this.detectMeshQuantization(Q,Y),y[Q]=K,i.attributes.set(this.getUID(Y),K))}if(w!==void 0&&d.setAttribute("normal",w),Object.keys(y).length===0)return null;if(t.morphTargetInfluences!==void 0&&t.morphTargetInfluences.length>0){const Q=[],Y=[],q={};if(t.morphTargetDictionary!==void 0)for(const K in t.morphTargetDictionary)q[t.morphTargetDictionary[K]]=K;for(let K=0;K<t.morphTargetInfluences.length;++K){const ne={};let le=!1;for(const fe in d.morphAttributes){if(fe!=="position"&&fe!=="normal"){le||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),le=!0);continue}const be=d.morphAttributes[fe][K],de=fe.toUpperCase(),Fe=d.attributes[fe];if(i.attributes.has(this.getUID(be,!0))){ne[de]=i.attributes.get(this.getUID(be,!0));continue}const we=be.clone();if(!d.morphTargetsRelative)for(let Me=0,_e=be.count;Me<_e;Me++)for(let tt=0;tt<be.itemSize;tt++)tt===0&&we.setX(Me,be.getX(Me)-Fe.getX(Me)),tt===1&&we.setY(Me,be.getY(Me)-Fe.getY(Me)),tt===2&&we.setZ(Me,be.getZ(Me)-Fe.getZ(Me)),tt===3&&we.setW(Me,be.getW(Me)-Fe.getW(Me));ne[de]=this.processAccessor(we,d),i.attributes.set(this.getUID(Fe,!0),ne[de])}b.push(ne),Q.push(t.morphTargetInfluences[K]),t.morphTargetDictionary!==void 0&&Y.push(q[K])}g.weights=Q,Y.length>0&&(g.extras={},g.extras.targetNames=Y)}const P=Array.isArray(t.material);if(P&&d.groups.length===0)return null;let U=!1;if(P&&d.index===null){const Q=[];for(let Y=0,q=d.attributes.position.count;Y<q;Y++)Q[Y]=Y;d.setIndex(Q),U=!0}const D=P?t.material:[t.material],z=P?d.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let Q=0,Y=z.length;Q<Y;Q++){const q={mode:f,attributes:y};if(this.serializeUserData(d,q),b.length>0&&(q.targets=b),d.index!==null){let ne=this.getUID(d.index);z[Q].start===void 0&&z[Q].count===void 0||(ne+=":"+z[Q].start+":"+z[Q].count),i.attributes.has(ne)?q.indices=i.attributes.get(ne):(q.indices=this.processAccessor(d.index,d,z[Q].start,z[Q].count),i.attributes.set(ne,q.indices)),q.indices===null&&delete q.indices}const K=this.processMaterial(D[z[Q].materialIndex]);K!==null&&(q.material=K),x.push(q)}U===!0&&d.setIndex(null),g.primitives=x,o.meshes||(o.meshes=[]),this._invokeAll(function(Q){Q.writeMesh&&Q.writeMesh(t,g)});const G=o.meshes.push(g)-1;return i.meshes.set(h,G),G}detectMeshQuantization(t,i){if(this.extensionsUsed[H1])return;let o;switch(i.array.constructor){case Int8Array:o="byte";break;case Uint8Array:o="unsigned byte";break;case Int16Array:o="short";break;case Uint16Array:o="unsigned short";break;default:return}i.normalized&&(o+=" normalized");const l=t.split("_",1)[0];BD[l]&&BD[l].includes(o)&&(this.extensionsUsed[H1]=!0,this.extensionsRequired[H1]=!0)}processCamera(t){const i=this.json;i.cameras||(i.cameras=[]);const o=t.isOrthographicCamera,l={type:o?"orthographic":"perspective"};return o?l.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:l.perspective={aspectRatio:t.aspect,yfov:Ey.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},t.name!==""&&(l.name=t.type),i.cameras.push(l)-1}processAnimation(t,i){const o=this.json,l=this.nodeMap;o.animations||(o.animations=[]);const h=(t=N1.Utils.mergeMorphTargetTracks(t.clone(),i)).tracks,d=[],f=[];for(let g=0;g<h.length;++g){const y=h[g],x=xi.parseTrackName(y.name);let b=xi.findNode(i,x.nodeName);const _=UD[x.propertyName];if(x.objectName==="bones"&&(b=b.isSkinnedMesh===!0?b.skeleton.getBoneByName(x.objectIndex):void 0),!b||!_){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',y.name);continue}const w=1;let T,P=y.values.length/y.times.length;_===UD.morphTargetInfluences&&(P/=b.morphTargetInfluences.length),y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(T="CUBICSPLINE",P/=3):T=y.getInterpolation()===zp?"STEP":"LINEAR",f.push({input:this.processAccessor(new mr(y.times,w)),output:this.processAccessor(new mr(y.values,P)),interpolation:T}),d.push({sampler:f.length-1,target:{node:l.get(b),path:_}})}return o.animations.push({name:t.name||"clip_"+o.animations.length,samplers:f,channels:d}),o.animations.length-1}processSkin(t){const i=this.json,o=this.nodeMap,l=i.nodes[o.get(t)],h=t.skeleton;if(h===void 0)return null;const d=t.skeleton.bones[0];if(d===void 0)return null;const f=[],g=new Float32Array(16*h.bones.length),y=new In;for(let x=0;x<h.bones.length;++x)f.push(o.get(h.bones[x])),y.copy(h.boneInverses[x]),y.multiply(t.bindMatrix).toArray(g,16*x);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new mr(g,16)),joints:f,skeleton:o.get(d)}),l.skin=i.skins.length-1}processNode(t){const i=this.json,o=this.options,l=this.nodeMap;i.nodes||(i.nodes=[]);const h={};if(o.trs){const f=t.quaternion.toArray(),g=t.position.toArray(),y=t.scale.toArray();eg(f,[0,0,0,1])||(h.rotation=f),eg(g,[0,0,0])||(h.translation=g),eg(y,[1,1,1])||(h.scale=y)}else t.matrixAutoUpdate&&t.updateMatrix(),eg(t.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(h.matrix=t.matrix.elements);if(t.name!==""&&(h.name=String(t.name)),this.serializeUserData(t,h),t.isMesh||t.isLine||t.isPoints){const f=this.processMesh(t);f!==null&&(h.mesh=f)}else t.isCamera&&(h.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const f=[];for(let g=0,y=t.children.length;g<y;g++){const x=t.children[g];if(x.visible||o.onlyVisible===!1){const b=this.processNode(x);b!==null&&f.push(b)}}f.length>0&&(h.children=f)}this._invokeAll(function(f){f.writeNode&&f.writeNode(t,h)});const d=i.nodes.push(h)-1;return l.set(t,d),d}processScene(t){const i=this.json,o=this.options;i.scenes||(i.scenes=[],i.scene=0);const l={};t.name!==""&&(l.name=t.name),i.scenes.push(l);const h=[];for(let d=0,f=t.children.length;d<f;d++){const g=t.children[d];if(g.visible||o.onlyVisible===!1){const y=this.processNode(g);y!==null&&h.push(y)}}h.length>0&&(l.nodes=h),this.serializeUserData(t,l)}processObjects(t){const i=new Oh;i.name="AuxScene";for(let o=0;o<t.length;o++)i.children.push(t[o]);this.processScene(i)}processInput(t){const i=this.options;t=t instanceof Array?t:[t],this._invokeAll(function(l){l.beforeParse&&l.beforeParse(t)});const o=[];for(let l=0;l<t.length;l++)t[l]instanceof Oh?this.processScene(t[l]):o.push(t[l]);o.length>0&&this.processObjects(o);for(let l=0;l<this.skins.length;++l)this.processSkin(this.skins[l]);for(let l=0;l<i.animations.length;++l)this.processAnimation(i.animations[l],t[0]);this._invokeAll(function(l){l.afterParse&&l.afterParse(t)})}_invokeAll(t){for(let i=0,o=this.plugins.length;i<o;i++)t(this.plugins[i])}}class X8{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,i){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);const o=this.writer,l=o.json,h=o.extensionsUsed,d={};t.name&&(d.name=t.name),d.color=t.color.toArray(),d.intensity=t.intensity,t.isDirectionalLight?d.type="directional":t.isPointLight?(d.type="point",t.distance>0&&(d.range=t.distance)):t.isSpotLight&&(d.type="spot",t.distance>0&&(d.range=t.distance),d.spot={},d.spot.innerConeAngle=(1-t.penumbra)*t.angle,d.spot.outerConeAngle=t.angle),t.decay!==void 0&&t.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!t.target||t.target.parent===t&&t.target.position.x===0&&t.target.position.y===0&&t.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),h[this.name]||(l.extensions=l.extensions||{},l.extensions[this.name]={lights:[]},h[this.name]=!0);const f=l.extensions[this.name].lights;f.push(d),i.extensions=i.extensions||{},i.extensions[this.name]={light:f.length-1}}}class Y8{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}writeMaterial(t,i){if(!t.isMeshBasicMaterial)return;const o=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},o[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class K8{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.clearcoat===0)return;const o=this.writer,l=o.extensionsUsed,h={};if(h.clearcoatFactor=t.clearcoat,t.clearcoatMap){const d={index:o.processTexture(t.clearcoatMap),texCoord:t.clearcoatMap.channel};o.applyTextureTransform(d,t.clearcoatMap),h.clearcoatTexture=d}if(h.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const d={index:o.processTexture(t.clearcoatRoughnessMap),texCoord:t.clearcoatRoughnessMap.channel};o.applyTextureTransform(d,t.clearcoatRoughnessMap),h.clearcoatRoughnessTexture=d}if(t.clearcoatNormalMap){const d={index:o.processTexture(t.clearcoatNormalMap),texCoord:t.clearcoatNormalMap.channel};t.clearcoatNormalScale.x!==1&&(d.scale=t.clearcoatNormalScale.x),o.applyTextureTransform(d,t.clearcoatNormalMap),h.clearcoatNormalTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class J8{constructor(t){this.writer=t,this.name="KHR_materials_dispersion"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.dispersion===0)return;const o=this.writer.extensionsUsed,l={};l.dispersion=t.dispersion,i.extensions=i.extensions||{},i.extensions[this.name]=l,o[this.name]=!0}}class $8{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.iridescence===0)return;const o=this.writer,l=o.extensionsUsed,h={};if(h.iridescenceFactor=t.iridescence,t.iridescenceMap){const d={index:o.processTexture(t.iridescenceMap),texCoord:t.iridescenceMap.channel};o.applyTextureTransform(d,t.iridescenceMap),h.iridescenceTexture=d}if(h.iridescenceIor=t.iridescenceIOR,h.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const d={index:o.processTexture(t.iridescenceThicknessMap),texCoord:t.iridescenceThicknessMap.channel};o.applyTextureTransform(d,t.iridescenceThicknessMap),h.iridescenceThicknessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class Z8{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const o=this.writer,l=o.extensionsUsed,h={};if(h.transmissionFactor=t.transmission,t.transmissionMap){const d={index:o.processTexture(t.transmissionMap),texCoord:t.transmissionMap.channel};o.applyTextureTransform(d,t.transmissionMap),h.transmissionTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class eV{constructor(t){this.writer=t,this.name="KHR_materials_volume"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const o=this.writer,l=o.extensionsUsed,h={};if(h.thicknessFactor=t.thickness,t.thicknessMap){const d={index:o.processTexture(t.thicknessMap),texCoord:t.thicknessMap.channel};o.applyTextureTransform(d,t.thicknessMap),h.thicknessTexture=d}t.attenuationDistance!==1/0&&(h.attenuationDistance=t.attenuationDistance),h.attenuationColor=t.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class tV{constructor(t){this.writer=t,this.name="KHR_materials_ior"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.ior===1.5)return;const o=this.writer.extensionsUsed,l={};l.ior=t.ior,i.extensions=i.extensions||{},i.extensions[this.name]=l,o[this.name]=!0}}class nV{constructor(t){this.writer=t,this.name="KHR_materials_specular"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.specularIntensity===1&&t.specularColor.equals(j8)&&!t.specularIntensityMap&&!t.specularColorMap)return;const o=this.writer,l=o.extensionsUsed,h={};if(t.specularIntensityMap){const d={index:o.processTexture(t.specularIntensityMap),texCoord:t.specularIntensityMap.channel};o.applyTextureTransform(d,t.specularIntensityMap),h.specularTexture=d}if(t.specularColorMap){const d={index:o.processTexture(t.specularColorMap),texCoord:t.specularColorMap.channel};o.applyTextureTransform(d,t.specularColorMap),h.specularColorTexture=d}h.specularFactor=t.specularIntensity,h.specularColorFactor=t.specularColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class iV{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.sheen==0)return;const o=this.writer,l=o.extensionsUsed,h={};if(t.sheenRoughnessMap){const d={index:o.processTexture(t.sheenRoughnessMap),texCoord:t.sheenRoughnessMap.channel};o.applyTextureTransform(d,t.sheenRoughnessMap),h.sheenRoughnessTexture=d}if(t.sheenColorMap){const d={index:o.processTexture(t.sheenColorMap),texCoord:t.sheenColorMap.channel};o.applyTextureTransform(d,t.sheenColorMap),h.sheenColorTexture=d}h.sheenRoughnessFactor=t.sheenRoughness,h.sheenColorFactor=t.sheenColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class rV{constructor(t){this.writer=t,this.name="KHR_materials_anisotropy"}writeMaterial(t,i){if(!t.isMeshPhysicalMaterial||t.anisotropy==0)return;const o=this.writer,l=o.extensionsUsed,h={};if(t.anisotropyMap){const d={index:o.processTexture(t.anisotropyMap)};o.applyTextureTransform(d,t.anisotropyMap),h.anisotropyTexture=d}h.anisotropyStrength=t.anisotropy,h.anisotropyRotation=t.anisotropyRotation,i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class sV{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}writeMaterial(t,i){if(!t.isMeshStandardMaterial||t.emissiveIntensity===1)return;const o=this.writer.extensionsUsed,l={};l.emissiveStrength=t.emissiveIntensity,i.extensions=i.extensions||{},i.extensions[this.name]=l,o[this.name]=!0}}class aV{constructor(t){this.writer=t,this.name="EXT_materials_bump"}writeMaterial(t,i){if(!t.isMeshStandardMaterial||t.bumpScale===1&&!t.bumpMap)return;const o=this.writer,l=o.extensionsUsed,h={};if(t.bumpMap){const d={index:o.processTexture(t.bumpMap),texCoord:t.bumpMap.channel};o.applyTextureTransform(d,t.bumpMap),h.bumpTexture=d}h.bumpFactor=t.bumpScale,i.extensions=i.extensions||{},i.extensions[this.name]=h,l[this.name]=!0}}class oV{constructor(t){this.writer=t,this.name="EXT_mesh_gpu_instancing"}writeNode(t,i){if(!t.isInstancedMesh)return;const o=this.writer,l=t,h=new Float32Array(3*l.count),d=new Float32Array(4*l.count),f=new Float32Array(3*l.count),g=new In,y=new ve,x=new ra,b=new ve;for(let w=0;w<l.count;w++)l.getMatrixAt(w,g),g.decompose(y,x,b),y.toArray(h,3*w),x.toArray(d,4*w),b.toArray(f,3*w);const _={TRANSLATION:o.processAccessor(new mr(h,3)),ROTATION:o.processAccessor(new mr(d,4)),SCALE:o.processAccessor(new mr(f,3))};l.instanceColor&&(_._COLOR_0=o.processAccessor(l.instanceColor)),i.extensions=i.extensions||{},i.extensions[this.name]={attributes:_},o.extensionsUsed[this.name]=!0,o.extensionsRequired[this.name]=!0}}N1.Utils={insertKeyframe:function(p,t){const o=p.getValueSize(),l=new p.TimeBufferType(p.times.length+1),h=new p.ValueBufferType(p.values.length+o),d=p.createInterpolant(new p.ValueBufferType(o));let f;if(p.times.length===0){l[0]=t;for(let g=0;g<o;g++)h[g]=0;f=0}else if(t<p.times[0]){if(Math.abs(p.times[0]-t)<.001)return 0;l[0]=t,l.set(p.times,1),h.set(d.evaluate(t),0),h.set(p.values,o),f=0}else if(t>p.times[p.times.length-1]){if(Math.abs(p.times[p.times.length-1]-t)<.001)return p.times.length-1;l[l.length-1]=t,l.set(p.times,0),h.set(p.values,0),h.set(d.evaluate(t),p.values.length),f=l.length-1}else for(let g=0;g<p.times.length;g++){if(Math.abs(p.times[g]-t)<.001)return g;if(p.times[g]<t&&p.times[g+1]>t){l.set(p.times.slice(0,g+1),0),l[g+1]=t,l.set(p.times.slice(g+1),g+2),h.set(p.values.slice(0,(g+1)*o),0),h.set(d.evaluate(t),(g+1)*o),h.set(p.values.slice((g+1)*o),(g+2)*o),f=g+1;break}}return p.times=l,p.values=h,f},mergeMorphTargetTracks:function(p,t){const i=[],o={},l=p.tracks;for(let h=0;h<l.length;++h){let d=l[h];const f=xi.parseTrackName(d.name),g=xi.findNode(t,f.nodeName);if(f.propertyName!=="morphTargetInfluences"||f.propertyIndex===void 0){i.push(d);continue}if(d.createInterpolant!==d.InterpolantFactoryMethodDiscrete&&d.createInterpolant!==d.InterpolantFactoryMethodLinear){if(d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),d=d.clone(),d.setInterpolation(Vp)}const y=g.morphTargetInfluences.length,x=g.morphTargetDictionary[f.propertyIndex];if(x===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+f.propertyIndex);let b;if(o[g.uuid]===void 0){b=d.clone();const w=new b.ValueBufferType(y*b.times.length);for(let T=0;T<b.times.length;T++)w[T*y+x]=b.values[T];b.name=(f.nodeName||"")+".morphTargetInfluences",b.values=w,o[g.uuid]=b,i.push(b);continue}const _=d.createInterpolant(new d.ValueBufferType(1));b=o[g.uuid];for(let w=0;w<b.times.length;w++)b.values[w*y+x]=_.evaluate(b.times[w]);for(let w=0;w<d.times.length;w++){const T=this.insertKeyframe(b,d.times[w]);b.values[T*y+x]=d.values[w]}}return p.tracks=i,p}};/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD=p=>p.material!==void 0&&p.userData&&p.userData.variantMaterials&&!!Array.from(p.userData.variantMaterials.values()).filter(t=>gE(t.material)),gE=p=>p&&p.isMaterial&&!Array.isArray(p);class lV{constructor(t){this.writer=t,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(t){const i=new Set;for(const o of t)o.traverse(l=>{if(!kD(l))return;const h=l.userData.variantMaterials,d=l.userData.variantData;for(const[f,g]of d){const y=h.get(g.index);y&&gE(y.material)&&i.add(f)}});i.forEach(o=>this.variantNames.push(o))}writeMesh(t,i){if(!kD(t))return;const o=t.userData,l=o.variantMaterials,h=o.variantData,d=new Map,f=new Map,g=Array.from(h.values()).sort((b,_)=>b.index-_.index);for(const[b,_]of g.entries())f.set(_.index,b);for(const b of h.values()){const _=l.get(b.index);if(!_||!gE(_.material))continue;const w=this.writer.processMaterial(_.material);d.has(w)||d.set(w,{material:w,variants:[]}),d.get(w).variants.push(f.get(b.index))}const y=Array.from(d.values()).map(b=>b.variants.sort((_,w)=>_-w)&&b).sort((b,_)=>b.material-_.material);if(y.length===0)return;const x=gE(o.originalMaterial)?this.writer.processMaterial(o.originalMaterial):-1;for(const b of i.primitives)x>=0&&(b.material=x),b.extensions=b.extensions||{},b.extensions[this.name]={mappings:y}}afterParse(){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const i=this.variantNames.map(o=>({name:o}));t.extensions[this.name]={variants:i},this.writer.extensionsUsed[this.name]=!0}}class cV{constructor(t,i,o,l,h){this.xrLight=t,this.renderer=i,this.lightProbe=o,this.xrWebGLBinding=null,this.estimationStartCallback=h,this.frameCallback=this.onXRFrame.bind(this);const d=i.xr.getSession();if(l&&"XRWebGLBinding"in window){const f=new Iw(16);t.environment=f.texture;const g=i.getContext();switch(d.preferredReflectionFormat){case"srgba8":g.getExtension("EXT_sRGB");break;case"rgba16f":g.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(d,g),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}d.requestAnimationFrame(this.frameCallback)}updateReflection(){const t=this.renderer.properties.get(this.xrLight.environment);if(t){const i=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);i&&(t.__webglTexture=i,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(t,i){if(!this.xrLight)return;i.session.requestAnimationFrame(this.frameCallback);const o=i.getLightEstimate(this.lightProbe);if(o){this.xrLight.lightProbe.sh.fromArray(o.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const l=Math.max(1,Math.max(o.primaryLightIntensity.x,Math.max(o.primaryLightIntensity.y,o.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(o.primaryLightIntensity.x/l,o.primaryLightIntensity.y/l,o.primaryLightIntensity.z/l),this.xrLight.directionalLight.intensity=l,this.xrLight.directionalLight.position.copy(o.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class hV extends Fh{constructor(t,i=!0){super(),this.lightProbe=new hz,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new u3,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let o=null,l=!1;t.xr.addEventListener("sessionstart",()=>{const h=t.xr.getSession();"requestLightProbe"in h&&h.requestLightProbe({reflectionFormat:h.preferredReflectionFormat}).then(d=>{o=new cV(this,t,d,i,()=>{l=!0,this.dispatchEvent({type:"estimationstart"})})})}),t.xr.addEventListener("sessionend",()=>{o&&(o.dispose(),o=null),l&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{o&&(o.dispose(),o=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(t=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(t)}setDecayTime(t){this.naturalFrequency=1/Math.max(.001,t)}update(t,i,o,l){const h=2e-4*this.naturalFrequency;if(t==null||l===0||t===i&&this.velocity===0)return i;if(o<0)return t;const d=t-i,f=this.velocity+this.naturalFrequency*d,g=d+o*f,y=Math.exp(-this.naturalFrequency*o),x=(f-this.naturalFrequency*g)*y,b=-this.naturalFrequency*(x+f*y);return Math.abs(x)<h*Math.abs(l)&&b*d>=0?(this.velocity=0,i):(this.velocity=x,i+g*y)}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CA=.2,uV=Math.PI/24,QD=new Hn,vE=(p,t,i)=>{let o=t>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let l=0;l<=12;++l)p.push(t+.17*Math.cos(o),i+.17*Math.sin(o),0,t+CA*Math.cos(o),i+CA*Math.sin(o),0),o+=uV};class GD extends Vi{constructor(t,i){const o=new Ra,l=[],h=[],{size:d,boundingBox:f}=t,g=d.x/2,y=(i==="back"?d.y:d.z)/2;vE(h,g,y),vE(h,-g,y),vE(h,-g,-y),vE(h,g,-y);const x=h.length/3;for(let w=0;w<x-2;w+=2)l.push(w,w+1,w+3,w,w+3,w+2);const b=x-2;l.push(b,b+1,1,b,1,0),o.setAttribute("position",new qa(h,3)),o.setIndex(l),super(o),this.side=i;const _=this.material;switch(_.side=2,_.transparent=!0,_.opacity=0,this.goalOpacity=0,this.opacityDamper=new ha,this.hitPlane=new Vi(new Fl(2*(g+CA),2*(y+CA))),this.hitPlane.visible=!1,this.hitPlane.material.side=2,this.add(this.hitPlane),this.hitBox=new Vi(new jc(d.x+.4,d.y+CA,d.z+.4)),this.hitBox.visible=!1,this.hitBox.material.side=2,this.add(this.hitBox),f.getCenter(this.position),i){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=f.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=f.min.z,this.position.z=this.shadowHeight}t.target.add(this),this.hitBox.position.y=(d.y+CA)/2+f.min.y,t.target.add(this.hitBox),this.offsetHeight=0}getHit(t,i,o){QD.set(i,-o),this.hitPlane.visible=!0;const l=t.positionAndNormalFromPoint(QD,this.hitPlane);return this.hitPlane.visible=!1,l==null?null:l.position}getExpandedHit(t,i,o){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const l=this.getHit(t,i,o);return this.hitPlane.scale.set(1,1,1),l}controllerIntersection(t,i){this.hitBox.visible=!0;const o=t.hitFromController(i,this.hitBox);return this.hitBox.visible=!1,o}set offsetHeight(t){t-=.001,this.side==="back"?this.position.z=this.shadowHeight+t:this.position.y=this.shadowHeight+t}get offsetHeight(){return this.side==="back"?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(t){this.goalOpacity=t?.75:0}updateOpacity(t){const i=this.material;i.opacity=this.opacityDamper.update(i.opacity,this.goalOpacity,t,1),this.visible=i.opacity>0}dispose(){const{geometry:t,material:i}=this.hitPlane;t.dispose(),i.dispose(),this.hitBox.geometry.dispose(),this.hitBox.material.dispose(),this.geometry.dispose(),this.material.dispose(),this.hitBox.removeFromParent(),this.removeFromParent()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gs=(p,t)=>({type:"number",number:p,unit:t}),kc=(()=>{const p={};return t=>{const i=t;if(i in p)return p[i];const o=[];let l=0;for(;t;){if(++l>1e3){t="";break}const h=HD(t),d=h.nodes[0];if(d==null||d.terms.length===0)break;o.push(d),t=h.remainingInput}return p[i]=o}})(),HD=(()=>{const p=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/;return o=>{const l=[];for(;o.length&&(o=o.trim(),!i.test(o));)if(o[0]==="("){const{nodes:h,remainingInput:d}=zD(o);o=d,l.push({type:"function",name:{type:"ident",value:"calc"},arguments:h})}else if(p.test(o)){const h=dV(o),d=h.nodes[0];if((o=h.remainingInput)[0]==="("){const{nodes:f,remainingInput:g}=zD(o);l.push({type:"function",name:d,arguments:f}),o=g}else l.push(d)}else if(t.test(o))l.push({type:"operator",value:o[0]}),o=o.slice(1);else{const{nodes:h,remainingInput:d}=o[0]==="#"?AV(o):pV(o);if(h.length===0)break;l.push(h[0]),o=d}return{nodes:[{type:"expression",terms:l}],remainingInput:o}}})(),dV=(()=>{const p=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const i=t.match(p);return{nodes:[{type:"ident",value:i==null?t:t.substr(0,i.index)}],remainingInput:i==null?"":t.substr(i.index)}}})(),pV=(()=>{const p=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return o=>{const l=o.match(p),h=l==null?"0":l[0],d=(o=h==null?o:o.slice(h.length)).match(t);let f=d!=null&&d[0]!==""?d[0]:null;const g=d==null?o:o.slice(f.length);return f==null||i.test(f)||(f=null),{nodes:[{type:"number",number:parseFloat(h)||0,unit:f}],remainingInput:g}}})(),AV=(()=>{const p=/^[a-f0-9]*/i;return t=>{const i=(t=t.slice(1).trim()).match(p);return{nodes:i==null?[]:[{type:"hex",value:i[0]}],remainingInput:i==null?t:t.slice(i[0].length)}}})(),zD=p=>{const t=[];for(p=p.slice(1).trim();p.length;){const i=HD(p);if(t.push(i.nodes[0]),(p=i.remainingInput.trim())[0]===",")p=p.slice(1).trim();else if(p[0]===")"){p=p.slice(1);break}}return{nodes:t,remainingInput:p}},VD=Symbol("visitedTypes");class fV{constructor(t){this[VD]=t}walk(t,i){const o=t.slice();for(;o.length;){const l=o.shift();switch(this[VD].indexOf(l.type)>-1&&i(l),l.type){case"expression":o.unshift(...l.terms);break;case"function":o.unshift(l.name,...l.arguments)}}}}const zh=Object.freeze({type:"number",number:0,unit:null}),yE=(p,t=0)=>{let{number:i,unit:o}=p;if(isFinite(i)){if(p.unit==="rad"||p.unit==null)return p}else i=t,o="rad";return{type:"number",number:(o==="deg"&&i!=null?i:0)*Math.PI/180,unit:"rad"}},WD=(p,t=0)=>{let i,{number:o,unit:l}=p;if(isFinite(o)){if(p.unit==="m")return p}else o=t,l="m";switch(l){default:i=1;break;case"cm":i=.01;break;case"mm":i=.001}return{type:"number",number:i*o,unit:"m"}},Dl=(()=>{const p=i=>i,t={rad:p,deg:yE,m:p,mm:WD,cm:WD};return(i,o=zh)=>{isFinite(i.number)||(i.number=o.number,i.unit=o.unit);const{unit:l}=i;if(l==null)return i;const h=t[l];return h==null?o:h(i)}})();/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jD,qD,XD;const wA=Symbol("evaluate"),EE=Symbol("lastValue");class gr{constructor(){this[jD]=null}static evaluatableFor(t,i=zh){if(t instanceof gr)return t;if(t.type==="number")return t.unit==="%"?new mV(t,i):t;switch(t.name.value){case"calc":return new yV(t,i);case"env":return new gV(t)}return zh}static evaluate(t){return t instanceof gr?t.evaluate():t}static isConstant(t){return!(t instanceof gr)||t.isConstant}static applyIntrinsics(t,i){const{basis:o,keywords:l}=i,{auto:h}=l;return o.map((d,f)=>{const g=h[f]==null?d:h[f];let y=t[f]?t[f]:g;if(y.type==="ident"){const x=y.value;x in l&&(y=l[x][f])}return y!=null&&y.type!=="ident"||(y=g),y.unit==="%"?Gs(y.number/100*d.number,d.unit):(y=Dl(y,d),y.unit!==d.unit?d:y)})}get isConstant(){return!1}evaluate(){return this.isConstant&&this[EE]!=null||(this[EE]=this[wA]()),this[EE]}}jD=EE;const YD=Symbol("percentage"),V1=Symbol("basis");class mV extends gr{constructor(t,i){super(),this[YD]=t,this[V1]=i}get isConstant(){return!0}[wA](){return Gs(this[YD].number/100*this[V1].number,this[V1].unit)}}const xE=Symbol("identNode");class gV extends gr{constructor(t){super(),this[qD]=null;const i=t.arguments.length?t.arguments[0].terms[0]:null;i!=null&&i.type==="ident"&&(this[xE]=i)}get isConstant(){return!1}[(qD=xE,wA)](){return this[xE]!=null&&this[xE].value==="window-scroll-y"?{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}:zh}}const vV=/[\*\/]/,MA=Symbol("evaluator");class yV extends gr{constructor(t,i=zh){if(super(),this[XD]=null,t.arguments.length!==1)return;const o=t.arguments[0].terms.slice(),l=[];for(;o.length;){const h=o.shift();if(l.length>0){const d=l[l.length-1];if(d.type==="operator"&&vV.test(d.value)){const f=l.pop(),g=l.pop();if(g==null)return;l.push(new JD(f,gr.evaluatableFor(g,i),gr.evaluatableFor(h,i)));continue}}l.push(h.type==="operator"?h:gr.evaluatableFor(h,i))}for(;l.length>2;){const[h,d,f]=l.splice(0,3);if(d.type!=="operator")return;l.unshift(new JD(d,gr.evaluatableFor(h,i),gr.evaluatableFor(f,i)))}l.length===1&&(this[MA]=l[0])}get isConstant(){return this[MA]==null||gr.isConstant(this[MA])}[(XD=MA,wA)](){return this[MA]!=null?gr.evaluate(this[MA]):zh}}const KD=Symbol("operator"),W1=Symbol("left"),j1=Symbol("right");class JD extends gr{constructor(t,i,o){super(),this[KD]=t,this[W1]=i,this[j1]=o}get isConstant(){return gr.isConstant(this[W1])&&gr.isConstant(this[j1])}[wA](){const t=Dl(gr.evaluate(this[W1])),i=Dl(gr.evaluate(this[j1])),{number:o,unit:l}=t,{number:h,unit:d}=i;if(d!=null&&l!=null&&d!=l)return zh;const f=l||d;let g;switch(this[KD].value){case"+":g=o+h;break;case"-":g=o-h;break;case"/":g=o/h;break;case"*":g=o*h;break;default:return zh}return{type:"number",number:g,unit:f}}}const q1=Symbol("evaluatables"),$D=Symbol("intrinsics");class ZD extends gr{constructor(t,i){super(),this[$D]=i;const o=t[0],l=o!=null?o.terms:[];this[q1]=i.basis.map((h,d)=>{const f=l[d];return f==null?{type:"ident",value:"auto"}:f.type==="ident"?f:gr.evaluatableFor(f,h)})}get isConstant(){for(const t of this[q1])if(!gr.isConstant(t))return!1;return!0}[wA](){const t=this[q1].map(i=>gr.evaluate(i));return gr.applyIntrinsics(t,this[$D]).map(i=>i.number)}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eP,tP,nP,iP;const SA=Symbol("instances"),rP=Symbol("activateListener"),sP=Symbol("deactivateListener"),X1=Symbol("notifyInstances"),aP=Symbol("notify"),oP=Symbol("callback");class Ol{constructor(t){this[oP]=t}static[X1](){for(const t of Ol[SA])t[aP]()}static[(eP=SA,rP)](){window.addEventListener("scroll",this[X1],{passive:!0})}static[sP](){window.removeEventListener("scroll",this[X1])}observe(){Ol[SA].size===0&&Ol[rP](),Ol[SA].add(this)}disconnect(){Ol[SA].delete(this),Ol[SA].size===0&&Ol[sP]()}[aP](){this[oP]()}}Ol[eP]=new Set;const lP=Symbol("computeStyleCallback"),cP=Symbol("astWalker"),tg=Symbol("dependencies"),hP=Symbol("onScroll");class EV{constructor(t){this[tP]={},this[nP]=new fV(["function"]),this[iP]=()=>{this[lP]({relatedState:"window-scroll"})},this[lP]=t}observeEffectsFor(t){const i={},o=this[tg];this[cP].walk(t,l=>{const{name:h}=l,d=l.arguments[0].terms[0];if(h.value==="env"&&d!=null&&d.type==="ident"&&d.value==="window-scroll-y"&&i["window-scroll"]==null){const f="window-scroll"in o?o["window-scroll"]:new Ol(this[hP]);f.observe(),delete o["window-scroll"],i["window-scroll"]=f}});for(const l in o)o[l].disconnect();this[tg]=i}dispose(){for(const t in this[tg])this[tg][t].disconnect()}}tP=tg,nP=cP,iP=hP;/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vh=p=>{const t=p.observeEffects||!1,i=p.intrinsics instanceof Function?p.intrinsics:()=>p.intrinsics;return(o,l)=>{const h=o.updated,d=o.connectedCallback,f=o.disconnectedCallback,g=Symbol(`${l}StyleEffector`),y=Symbol(`${l}StyleEvaluator`),x=Symbol(`${l}UpdateEvaluator`),b=Symbol(`${l}EvaluateAndSync`);Object.defineProperties(o,{[g]:{value:null,writable:!0},[y]:{value:null,writable:!0},[x]:{value:function(){const _=kc(this[l]);this[y]=new ZD(_,i(this)),this[g]==null&&t&&(this[g]=new EV(()=>this[b]())),this[g]!=null&&this[g].observeEffectsFor(_)}},[b]:{value:function(){if(this[y]==null)return;const _=this[y].evaluate();this[p.updateHandler](_)}},updated:{value:function(_){_.has(l)&&(this[x](),this[b]()),h.call(this,_)}},connectedCallback:{value:function(){d.call(this),this.requestUpdate(l,this[l])}},disconnectedCallback:{value:function(){f.call(this),this[g]!=null&&(this[g].dispose(),this[g]=null)}}})}},uP=p=>p<.5?2*p*p:(4-2*p)*p-1,xV=(p,t,i=uP)=>o=>p+(t-p)*i(o),IA=p=>{const t=[],i=[];let o=p.initialValue;for(let l=0;l<p.keyframes.length;++l){const h=p.keyframes[l],{value:d,frames:f}=h,g=h.ease||uP,y=xV(o,d,g);t.push(y),i.push(f),o=d}return((l,h)=>{const d=h.map((f=0,g=>f+=g));var f;return g=>{g=Ll(g,0,1),g*=d[d.length-1];const y=d.findIndex(_=>_>=g),x=y<1?0:d[y-1],b=d[y];return l[y]((g-x)/(b-x))}})(t,i)};/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qr=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const _V=IA({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),bV=IA({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),dP="0deg 75deg 105%",CV=["front","right","back","left"],wV=["upper-","","lower-"],_E="auto",MV="basic",pP="wiggle",SV="none",AP=()=>({basis:[yE(Gs(30,"deg"))],keywords:{auto:[null]}}),IV=()=>({basis:[yE(Gs(12,"deg"))],keywords:{auto:[null]}}),fP=(()=>{const p=kc(dP)[0].terms,t=Dl(p[0]),i=Dl(p[1]);return o=>{const l=o[Ut].idealCameraDistance();return{basis:[t,i,Gs(l,"m")],keywords:{auto:[null,null,Gs(105,"%")]}}}})(),TV=p=>{const t=2.2*p[Ut].boundingSphere.radius;return{basis:[Gs(-1/0,"rad"),Gs(0,"rad"),Gs(t,"m")],keywords:{auto:[null,null,null]}}},BV=p=>{const t=fP(p),i=new ZD([],t).evaluate()[2];return{basis:[Gs(1/0,"rad"),Gs(Math.PI,"rad"),Gs(i,"m")],keywords:{auto:[null,null,null]}}},RV=p=>{const t=p[Ut].boundingBox.getCenter(new ve);return{basis:[Gs(t.x,"m"),Gs(t.y,"m"),Gs(t.z,"m")],keywords:{auto:[null,null,null]}}},mP=Math.PI/2,LV=Math.PI/3,DV=mP/2,PV=2*Math.PI,Wi=Symbol("controls"),bE=Symbol("panElement"),Y1=Symbol("promptElement"),CE=Symbol("promptAnimatedContainer"),K1=Symbol("fingerAnimatedContainers"),wE=Symbol("deferInteractionPrompt"),gP=Symbol("updateAria"),Qc=Symbol("a11y"),vP=Symbol("updateA11y"),yP=Symbol("updateCameraForRadius"),TA=Symbol("cancelPrompts"),J1=Symbol("onChange"),ng=Symbol("onPointerChange"),wd=Symbol("waitingToPromptUser"),ME=Symbol("userHasInteracted"),BA=Symbol("promptElementVisibleTime"),ig=Symbol("lastPromptOffset"),SE=Symbol("cancellationSource"),$1=Symbol("lastSpherical"),rg=Symbol("jumpCamera"),Z1=Symbol("initialized"),sg=Symbol("maintainThetaPhi"),EP=Symbol("syncCameraOrbit"),xP=Symbol("syncFieldOfView"),_P=Symbol("syncCameraTarget"),bP=Symbol("syncMinCameraOrbit"),CP=Symbol("syncMaxCameraOrbit"),wP=Symbol("syncMinFieldOfView"),MP=Symbol("syncMaxFieldOfView"),UV=new Hn,SP=new ve,IP=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:0,maximumPolarAngle:Math.PI,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),IE=Math.PI/8,eM=.04,Sr={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class NV extends Xo{constructor(t,i,o){super(),this.camera=t,this.element=i,this.scene=o,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=Sr.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new zn,this.panPerPixel=0,this.spherical=new tE,this.goalSpherical=new tE,this.thetaDamper=new ha,this.phiDamper=new ha,this.radiusDamper=new ha,this.logFov=Math.log(IP.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new ha,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=l=>{if(this.enablePan)l.preventDefault();else for(const h of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:h.id})))},this.touchModeZoom=(l,h)=>{if(!this._disableZoom){const d=this.twoTouchDistance(this.pointers[0],this.pointers[1]),f=eM*this.zoomSensitivity*(this.lastSeparation-d)*50/this.scene.height;this.lastSeparation=d,this.userAdjustOrbit(0,0,f)}this.panPerPixel>0&&this.movePan(l,h)},this.disableScroll=l=>{l.preventDefault()},this.touchModeRotate=(l,h)=>{const{touchAction:d}=this._options;if(!this.touchDecided&&d!=="none"){this.touchDecided=!0;const f=Math.abs(l),g=Math.abs(h);if(this.changeSource===Sr.USER_INTERACTION&&(d==="pan-y"&&g>f||d==="pan-x"&&f>g))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(l,h)},this.onPointerDown=l=>{if(this.pointers.length>2)return;const{element:h}=this;this.pointers.length===0&&(h.addEventListener("pointermove",this.onPointerMove),h.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=l.clientX,this.startPointerPosition.clientY=l.clientY,this.startTime=performance.now());try{h.setPointerCapture(l.pointerId)}catch{}this.pointers.push({clientX:l.clientX,clientY:l.clientY,id:l.pointerId}),this.isUserPointing=!1,l.pointerType==="touch"?(this.changeSource=l.altKey?Sr.AUTOMATIC:Sr.USER_INTERACTION,this.onTouchChange(l)):(this.changeSource=Sr.USER_INTERACTION,this.onMouseDown(l)),this.changeSource===Sr.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=l=>{const h=this.pointers.find(y=>y.id===l.pointerId);if(h==null)return;if(l.pointerType==="mouse"&&l.buttons===0)return void this.onPointerUp(l);const d=this.pointers.length,f=(l.clientX-h.clientX)/d,g=(l.clientY-h.clientY)/d;f===0&&g===0||(h.clientX=l.clientX,h.clientY=l.clientY,l.pointerType==="touch"?(this.changeSource=l.altKey?Sr.AUTOMATIC:Sr.USER_INTERACTION,this.touchMode!==null&&this.touchMode(f,g)):(this.changeSource=Sr.USER_INTERACTION,this.panPerPixel>0?this.movePan(f,g):this.handleSinglePointerMove(f,g)))},this.onPointerUp=l=>{const{element:h}=this,d=this.pointers.findIndex(f=>f.id===l.pointerId);d!==-1&&this.pointers.splice(d,1),this.panPerPixel>0&&!l.altKey&&this.resetRadius(),this.pointers.length===0?(h.removeEventListener("pointermove",this.onPointerMove),h.removeEventListener("pointerup",this.onPointerUp),h.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(l)):this.touchMode!==null&&this.onTouchChange(l),this.scene.element[bE].style.opacity=0,h.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=l=>{this.changeSource=Sr.USER_INTERACTION;const h=l.deltaY*(l.deltaMode==1?18:1)*eM*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,h),l.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=l=>{const{changeSource:h}=this;this.changeSource=Sr.USER_INTERACTION,(l.shiftKey&&this.enablePan?this.panKeyCodeHandler(l):this.orbitZoomKeyCodeHandler(l))?(l.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=h},this._options=Object.assign({},IP),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(this._interactionEnabled===!1){const{element:t}=this;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||t.addEventListener("wheel",this.onWheel),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("touchmove",()=>{},{passive:!1}),t.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(this._interactionEnabled===!0){const{element:t}=this;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("pointercancel",this.onPointerUp),t.removeEventListener("wheel",this.onWheel),t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("contextmenu",this.onContext),t.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(t){this._disableZoom!=t&&(this._disableZoom=t,t===!0?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(t=new tE){return t.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(t){Object.assign(this._options,t),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(t,i){this.camera.far=i===0?2:i,this.camera.near=Math.max(t,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(t){this.camera.aspect=t,this.camera.updateProjectionMatrix()}setOrbit(t=this.goalSpherical.theta,i=this.goalSpherical.phi,o=this.goalSpherical.radius){const{minimumAzimuthalAngle:l,maximumAzimuthalAngle:h,minimumPolarAngle:d,maximumPolarAngle:f,minimumRadius:g,maximumRadius:y}=this._options,{theta:x,phi:b,radius:_}=this.goalSpherical,w=Ll(t,l,h);isFinite(l)||isFinite(h)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-w)+w);const T=Ll(i,d,f),P=Ll(o,g,y);return(w!==x||T!==b||P!==_)&&!!(isFinite(w)&&isFinite(T)&&isFinite(P))&&(this.goalSpherical.theta=w,this.goalSpherical.phi=T,this.goalSpherical.radius=P,this.goalSpherical.makeSafe(),!0)}setRadius(t){this.goalSpherical.radius=t,this.setOrbit()}setFieldOfView(t){const{minimumFieldOfView:i,maximumFieldOfView:o}=this._options;t=Ll(t,i,o),this.goalLogFov=Math.log(t)}setDamperDecayTime(t){this.thetaDamper.setDecayTime(t),this.phiDamper.setDecayTime(t),this.radiusDamper.setDecayTime(t),this.fovDamper.setDecayTime(t)}adjustOrbit(t,i,o){const{theta:l,phi:h,radius:d}=this.goalSpherical,{minimumRadius:f,maximumRadius:g,minimumFieldOfView:y,maximumFieldOfView:x}=this._options,b=this.spherical.theta-l,_=Math.PI-.001,w=l-Ll(t,-_-b,_-b),T=h-i,P=o===0?0:((o>0?g:f)-d)/(Math.log(o>0?x:y)-this.goalLogFov),U=d+o*(isFinite(P)?P:2*(g-f));if(this.setOrbit(w,T,U),o!==0){const D=this.goalLogFov+o;this.setFieldOfView(Math.exp(D))}}jumpToGoal(){this.update(0,1e4)}update(t,i){if(this.isStationary())return!1;const{maximumPolarAngle:o,maximumRadius:l}=this._options,h=this.spherical.theta-this.goalSpherical.theta;return Math.abs(h)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(h)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,i,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,i,o),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,i,l),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,i,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:t}=this.element;if(this._interactionEnabled){const{touchAction:i}=this._options;this._disableZoom&&i!=="none"?t.touchAction="manipulation":t.touchAction=i}else t.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new _o(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(t,i,o){this.adjustOrbit(t*this.orbitSensitivity*this.inputSensitivity,i*this.orbitSensitivity*this.inputSensitivity,o*this.inputSensitivity)}wrapAngle(t){const i=(t+Math.PI)/(2*Math.PI);return 2*(i-Math.floor(i))*Math.PI-Math.PI}pixelLengthToSphericalAngle(t){return 2*Math.PI*t/this.scene.height}twoTouchDistance(t,i){const{clientX:o,clientY:l}=t,{clientX:h,clientY:d}=i,f=h-o,g=d-l;return Math.sqrt(f*f+g*g)}handleSinglePointerMove(t,i){const o=this.pixelLengthToSphericalAngle(t),l=this.pixelLengthToSphericalAngle(i);this.isUserPointing===!1&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(o,l,0)}initializePan(){const{theta:t,phi:i}=this.spherical,o=t-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(o),-Math.cos(i)*Math.sin(o),0,0,Math.sin(i),0,Math.sin(o),-Math.cos(i)*Math.cos(o),0)}movePan(t,i){const{scene:o}=this,l=SP.set(t,i,0).multiplyScalar(this.inputSensitivity),h=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;l.multiplyScalar(h);const d=o.getTarget();d.add(l.applyMatrix3(this.panProjection)),o.boundingSphere.clampPoint(d,d),o.setTarget(d.x,d.y,d.z)}recenter(t){if(performance.now()>this.startTime+300||Math.abs(t.clientX-this.startPointerPosition.clientX)>2||Math.abs(t.clientY-this.startPointerPosition.clientY)>2)return;const{scene:i}=this,o=i.positionAndNormalFromPoint(i.getNDC(t.clientX,t.clientY));if(o==null){const{cameraTarget:l}=i.element;i.element.cameraTarget="",i.element.cameraTarget=l,this.userAdjustOrbit(0,0,1)}else i.target.worldToLocal(o.position),i.setTarget(o.position.x,o.position.y,o.position.z)}resetRadius(){const{scene:t}=this,i=t.positionAndNormalFromPoint(UV.set(0,0));if(i==null)return;t.target.worldToLocal(i.position);const o=t.getTarget(),{theta:l,phi:h}=this.spherical,d=l-t.yaw,f=SP.set(Math.sin(h)*Math.sin(d),Math.cos(h),Math.sin(h)*Math.cos(d)),g=f.dot(i.position.sub(o));o.add(f.multiplyScalar(g)),t.setTarget(o.x,o.y,o.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-g)}onTouchChange(t){if(this.pointers.length===1)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&this.touchMode===null?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&this.touchMode!=null&&(this.initializePan(),t.altKey||(this.scene.element[bE].style.opacity=1))}}onMouseDown(t){this.panPerPixel=0,this.enablePan&&(t.button===2||t.ctrlKey||t.metaKey||t.shiftKey)&&(this.initializePan(),this.scene.element[bE].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(t){let i=!0;switch(t.key){case"PageUp":this.userAdjustOrbit(0,0,eM*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-IE,0);break;case"ArrowDown":this.userAdjustOrbit(0,IE,0);break;case"ArrowLeft":this.userAdjustOrbit(-IE,0,0);break;case"ArrowRight":this.userAdjustOrbit(IE,0,0);break;default:i=!1}return i}panKeyCodeHandler(t){this.initializePan();let i=!0;switch(t.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:i=!1}return i}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA=150,TE="not-presenting",TP="session-started",FV="object-placed",OV="failed",BP="tracking",kV="not-tracking",ag=new ve,LA=new ra,QV=new In,GV=new ve,HV=new vs(45,1,.1,100),RP=new Ra().setFromPoints([new ve(0,0,0),new ve(0,0,-1)]),zV=new jc;class VV extends Xo{constructor(t){super(),this.renderer=t,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.xrMode=null,this.controller1=null,this.controller2=null,this.selectedController=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new ve,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new ve,this.relativeOrientation=new ra,this.scaleLine=new Gm(RP),this.firstRatio=0,this.lastAngle=0,this.goalPosition=new ve,this.goalYaw=0,this.goalScale=1,this.xDamper=new ha,this.yDamper=new ha,this.zDamper=new ha,this.yawDamper=new ha,this.pitchDamper=new ha,this.rollDamper=new ha,this.scaleDamper=new ha,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onControllerSelectStart=i=>{const o=this.presentedScene,l=i.target;if(this.placementBox.controllerIntersection(o,l)!=null)this.selectedController!=null&&(this.selectedController.userData.line.visible=!1,o.canScale&&(this.isTwoFingering=!0,this.firstRatio=this.controllerSeparation()/o.pivot.scale.x,this.scaleLine.visible=!0)),l.attach(o.pivot),this.selectedController=l,o.setShadowIntensity(.01);else{const h=l===this.controller1?this.controller2:this.controller1;this.relativeOrientation.copy(l.quaternion).invert().multiply(o.pivot.getWorldQuaternion(LA)),h.userData.turning=!1,l.userData.turning=!0,l.userData.line.visible=!1}},this.onControllerSelectEnd=i=>{const o=i.target;if(o.userData.turning=!1,o.userData.line.visible=!0,this.isTwoFingering=!1,this.scaleLine.visible=!1,this.selectedController!=null&&this.selectedController!=o)return;const l=this.presentedScene;l.attach(l.pivot),this.selectedController=null,this.goalYaw=Math.atan2(l.pivot.matrix.elements[8],l.pivot.matrix.elements[10]),this.goalPosition.x=l.pivot.position.x,this.goalPosition.z=l.pivot.position.z},this.onUpdateScene=()=>{this.placementBox!=null&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new GD(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=i=>{const o=this.transientHitTestSource;if(o==null)return;const l=this.frame.getHitTestResultsForTransientInput(o),h=this.presentedScene,d=this.placementBox;if(l.length===1){this.inputSource=i.inputSource;const{axes:f}=this.inputSource.gamepad,g=d.getHit(this.presentedScene,f[0],f[1]);d.show=!0,g!=null?(this.isTranslating=!0,this.lastDragPosition.copy(g)):this.placeOnWall===!1&&(this.isRotating=!0,this.lastAngle=1.5*f[0])}else if(l.length===2){d.show=!0,this.isTwoFingering=!0;const{separation:f}=this.fingerPolar(l);this.firstRatio=f/h.pivot.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=t.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){W3();const t=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(t),this.threeRenderer.xr.cameraAutoUpdate=!1,t}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return W3(),await navigator.xr.isSessionSupported("immersive-ar")}catch(t){return console.warn("Request to present in WebXR denied:"),console.warn(t),console.warn("Falling back to next ar-mode"),!1}}async present(t,i=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let o=new Promise((y,x)=>{requestAnimationFrame(()=>y())});t.setHotspotsVisibility(!1),t.queueRender(),await o,this._presentedScene=t,this.overlay=t.element.shadowRoot.querySelector("div.default"),i===!0&&(this.xrLight=new hV(this.threeRenderer),this.xrLight.addEventListener("estimationstart",()=>{if(!this.isPresenting||this.xrLight==null)return;const y=this.presentedScene;y.add(this.xrLight),y.environment=this.xrLight.environment}));const l=await this.resolveARSession();l.addEventListener("end",()=>{this.postSessionCleanup()},{once:!0});const h=t.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");h.classList.add("enabled"),h.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=h;const d=await l.requestReferenceSpace("viewer");this.xrMode=l.interactionMode,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=t.yaw,this.goalYaw=t.yaw,this.goalScale=1,t.setBackground(null),this.oldShadowIntensity=t.shadowIntensity,t.setShadowIntensity(.01),this.oldTarget.copy(t.getTarget()),t.element.addEventListener("load",this.onUpdateScene);const f=20*Math.PI/180,g=this.placeOnWall===!0?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(f),z:-Math.cos(f)});l.requestHitTestSource({space:d,offsetRay:g}).then(y=>{this.initialHitSource=y}),this.xrMode!=="screen-space"&&(this.setupControllers(),this.xDamper.setDecayTime(RA),this.yDamper.setDecayTime(RA),this.zDamper.setDecayTime(RA),this.yawDamper.setDecayTime(RA),this.pitchDamper.setDecayTime(RA),this.rollDamper.setDecayTime(RA)),this.currentSession=l,this.placementBox=new GD(t,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:TP})}setupControllers(){this.controller1=this.threeRenderer.xr.getController(0),this.controller1.addEventListener("selectstart",this.onControllerSelectStart),this.controller1.addEventListener("selectend",this.onControllerSelectEnd),this.controller2=this.threeRenderer.xr.getController(1),this.controller2.addEventListener("selectstart",this.onControllerSelectStart),this.controller2.addEventListener("selectend",this.onControllerSelectEnd);const t=this.presentedScene;if(t.add(this.controller1),t.add(this.controller2),!this.controller1.userData.line){const i=new Gm(RP);i.name="line",i.scale.z=5,this.controller1.userData.turning=!1,this.controller1.userData.line=i,this.controller1.add(i),this.controller2.userData.turning=!1;const o=i.clone();this.controller2.userData.line=o,this.controller2.add(o),this.scaleLine.name="scale line",this.scaleLine.visible=!1,this.controller1.add(this.scaleLine);const{size:l}=t,h=.1/Math.max(l.x,l.y,l.z),d=new Vi(zV);d.name="box",d.scale.copy(l).multiplyScalar(h),d.visible=!1,this.controller1.userData.box=d,t.add(d);const f=d.clone();this.controller2.userData.box=f,t.add(f)}}hover(t){if(this.xrMode==="screen-space"||this.selectedController==t)return!1;const i=this.presentedScene,o=this.placementBox.controllerIntersection(i,t);return t.userData.box.visible=(o==null||t.userData.turning)&&!this.isTwoFingering,t.userData.line.scale.z=o==null?5:o.distance,o!=null}controllerSeparation(){return this.controller1.position.distanceTo(this.controller2.position)}async stopPresenting(){if(!this.isPresenting)return;const t=new Promise(i=>{this.resolveCleanup=i});try{await this.currentSession.end(),await t}catch(i){console.warn("Error while trying to end WebXR AR session"),console.warn(i),this.postSessionCleanup()}}get isPresenting(){return this.presentedScene!=null}get target(){return this.oldTarget}updateTarget(){const t=this.presentedScene;if(t!=null){const i=t.getTarget();this.oldTarget.copy(i),this.placeOnWall?i.z=t.boundingBox.min.z:i.y=t.boundingBox.min.y,t.setTarget(i.x,i.y,i.z)}}postSessionCleanup(){const t=this.currentSession;t!=null&&(t.removeEventListener("selectstart",this.onSelectStart),t.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const i=this.presentedScene;if(this._presentedScene=null,i!=null){const{element:d}=i;this.xrLight!=null&&(i.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),i.add(i.pivot),i.pivot.quaternion.set(0,0,0,1),i.pivot.position.set(0,0,0),i.pivot.scale.set(1,1,1),i.setShadowOffset(0);const f=this.turntableRotation;f!=null&&(i.yaw=f);const g=this.oldShadowIntensity;g!=null&&i.setShadowIntensity(g),i.setEnvironmentAndSkybox(d[Km],d[hE]);const y=this.oldTarget;i.setTarget(y.x,y.y,y.z),i.xrCamera=null,i.element.removeEventListener("load",this.onUpdateScene),i.orientHotspots(0);const{width:x,height:b}=d.getBoundingClientRect();i.setSize(x,b),requestAnimationFrame(()=>{i.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:Sr.NONE}}))})}this.renderer.height=0;const o=this.exitWebXRButtonContainer;o!=null&&(o.classList.remove("enabled"),o.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const l=this.transientHitTestSource;l!=null&&(l.cancel(),this.transientHitTestSource=null);const h=this.initialHitSource;h!=null&&(h.cancel(),this.initialHitSource=null),this.placementBox!=null&&(this.placementBox.dispose(),this.placementBox=null),this.xrMode!=="screen-space"&&(this.controller1!=null&&(this.controller1.userData.turning=!1,this.controller1.userData.box.visible=!1,this.controller1.userData.line.visible=!0,this.controller1.removeEventListener("selectstart",this.onControllerSelectStart),this.controller1.removeEventListener("selectend",this.onControllerSelectEnd),this.controller1.removeFromParent(),this.controller1=null),this.controller2!=null&&(this.controller2.userData.turning=!1,this.controller2.userData.box.visible=!1,this.controller2.userData.line.visible=!0,this.controller2.removeEventListener("selectstart",this.onControllerSelectStart),this.controller2.removeEventListener("selectend",this.onControllerSelectEnd),this.controller2.removeFromParent(),this.controller2=null),this.selectedController=null,this.scaleLine.visible=!1),this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,this.resolveCleanup!=null&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:TE})}updateView(t){const i=this.presentedScene,o=this.threeRenderer.xr;o.updateCamera(HV),i.xrCamera=o.getCamera();const{elements:l}=i.getCamera().matrixWorld;if(i.orientHotspots(Math.atan2(l[1],l[5])),this.initialized||(this.placeInitially(),this.initialized=!0),t.requestViewportScale&&t.recommendedViewportScale){const d=t.recommendedViewportScale;t.requestViewportScale(Math.max(d,.25))}const h=o.getBaseLayer();if(h!=null){const d=h instanceof XRWebGLLayer?h.getViewport(t):o.getBinding().getViewSubImage(h,t).viewport;this.threeRenderer.setViewport(d.x,d.y,d.width,d.height)}}placeInitially(){const t=this.presentedScene,{pivot:i,element:o}=t,{position:l}=i,h=t.getCamera(),{width:d,height:f}=this.overlay.getBoundingClientRect();t.setSize(d,f),h.projectionMatrixInverse.copy(h.projectionMatrix).invert();const{theta:g}=o.getCameraOrbit(),y=h.getWorldDirection(ag);t.yaw=Math.atan2(-y.x,-y.z)-g,this.goalYaw=t.yaw;const x=Math.max(1,2*t.boundingSphere.radius);l.copy(h.position).add(y.multiplyScalar(x)),this.updateTarget();const b=t.getTarget();if(l.add(b).sub(this.oldTarget),this.goalPosition.copy(l),t.setHotspotsVisibility(!0),this.xrMode==="screen-space"){const{session:_}=this.frame;_.addEventListener("selectstart",this.onSelectStart),_.addEventListener("selectend",this.onSelectEnd),_.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(w=>{this.transientHitTestSource=w})}}getTouchLocation(){const{axes:t}=this.inputSource.gamepad;let i=this.placementBox.getExpandedHit(this.presentedScene,t[0],t[1]);return i!=null&&(ag.copy(i).sub(this.presentedScene.getCamera().position),ag.length()>10)?null:i}getHitPoint(t){const i=this.threeRenderer.xr.getReferenceSpace(),o=t.getPose(i);if(o==null)return null;const l=QV.fromArray(o.transform.matrix);return this.placeOnWall===!0&&(this.goalYaw=Math.atan2(l.elements[4],l.elements[6])),l.elements[5]>.75!==this.placeOnWall?GV.setFromMatrixPosition(l):null}moveToFloor(t){const i=this.initialHitSource;if(i==null)return;const o=t.getHitTestResults(i);if(o.length==0)return;const l=o[0],h=this.getHitPoint(l);h!=null&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(h):this.goalPosition.y=h.y),i.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:FV}))}fingerPolar(t){const i=t[0].inputSource.gamepad.axes,o=t[1].inputSource.gamepad.axes,l=o[0]-i[0],h=o[1]-i[1],d=Math.atan2(h,l);let f=this.lastAngle-d;return f>Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI),this.lastAngle=d,{separation:Math.sqrt(l*l+h*h),deltaYaw:f}}setScale(t){const i=t/this.firstRatio;this.goalScale=Math.abs(i-1)<.2?1:i}processInput(t){const i=this.transientHitTestSource;if(i==null||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const o=t.getHitTestResultsForTransientInput(i),l=this.presentedScene,h=l.pivot.scale.x;if(this.isTwoFingering)if(o.length<2)this.isTwoFingering=!1;else{const{separation:d,deltaYaw:f}=this.fingerPolar(o);this.placeOnWall===!1&&(this.goalYaw+=f),l.canScale&&this.setScale(d)}else if(o.length!==2)if(this.isRotating){const d=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=d-this.lastAngle,this.lastAngle=d}else this.isTranslating&&o.forEach(d=>{if(d.inputSource!==this.inputSource)return;let f=null;if(d.results.length>0&&(f=this.getHitPoint(d.results[0])),f==null&&(f=this.getTouchLocation()),f!=null){if(this.goalPosition.sub(this.lastDragPosition),this.placeOnWall===!1){const g=f.y-this.lastDragPosition.y;if(g<0){this.placementBox.offsetHeight=g/h,this.presentedScene.setShadowOffset(g);const y=ag.copy(l.getCamera().position),x=-g/(y.y-f.y);y.multiplyScalar(x),f.multiplyScalar(1-x).add(y)}}this.goalPosition.add(f),this.lastDragPosition.copy(f)}});else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:d}=this.fingerPolar(o);this.firstRatio=d/h}}moveScene(t){const i=this.presentedScene,{pivot:o}=i,l=this.placementBox;if(l.updateOpacity(t),this.controller1&&(this.controller1.userData.turning&&(o.quaternion.copy(this.controller1.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller2&&o.quaternion.premultiply(LA.copy(this.controller2.quaternion).invert())),this.controller1.userData.box.position.copy(this.controller1.position),o.getWorldQuaternion(this.controller1.userData.box.quaternion)),this.controller2&&(this.controller2.userData.turning&&(o.quaternion.copy(this.controller2.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller1&&o.quaternion.premultiply(LA.copy(this.controller1.quaternion).invert())),this.controller2.userData.box.position.copy(this.controller2.position),o.getWorldQuaternion(this.controller2.userData.box.quaternion)),this.controller1&&this.controller2&&this.isTwoFingering){const _=this.controllerSeparation();this.setScale(_),this.scaleLine.scale.z=-_,this.scaleLine.lookAt(this.controller2.position)}const h=i.pivot.scale.x;if(this.goalScale!==h){const _=this.scaleDamper.update(h,this.goalScale,t,1);i.pivot.scale.set(_,_,_)}if(o.parent!==i)return;const{position:d}=o,f=i.boundingSphere.radius,g=this.goalPosition;let y=Sr.NONE;if(!g.equals(d)){y=Sr.USER_INTERACTION;let{x:_,y:w,z:T}=d;if(_=this.xDamper.update(_,g.x,t,f),w=this.yDamper.update(w,g.y,t,f),T=this.zDamper.update(T,g.z,t,f),d.set(_,w,T),this.xrMode==="screen-space"&&!this.isTranslating){const P=g.y-w;this.placementComplete&&this.placeOnWall===!1?(l.offsetHeight=P/i.pivot.scale.x,i.setShadowOffset(P)):P===0&&(this.placementComplete=!0,l.show=!1,i.setShadowIntensity(.8))}this.xrMode!=="screen-space"&&g.equals(d)&&i.setShadowIntensity(.8)}i.updateTarget(t),LA.setFromAxisAngle(ag.set(0,1,0),this.goalYaw);const x=i.pivot.quaternion.angleTo(LA),b=x-this.yawDamper.update(x,0,t,Math.PI);i.pivot.quaternion.rotateTowards(LA,b),i.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:y}}))}onWebXRFrame(t,i){if(this.xrMode!=="screen-space"){const f=this.hover(this.controller1),g=this.hover(this.controller2);this.placementBox.show=(f||g)&&!this.isTwoFingering}this.frame=i,++this.frames;const o=this.threeRenderer.xr.getReferenceSpace(),l=i.getViewerPose(o);l==null&&this.tracking===!0&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:kV}));const h=this.presentedScene;if(l==null||h==null||!h.element.loaded)return void this.threeRenderer.clear();this.tracking===!1&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:BP}));let d=!0;for(const f of l.views){if(this.updateView(f),d){this.moveToFloor(i),this.processInput(i);const g=t-this.lastTick;this.moveScene(g),this.renderer.preRender(h,t,g),this.lastTick=t,h.renderShadow(this.threeRenderer)}this.threeRenderer.render(h,h.getCamera()),d=!1}}}function WV(p){const t=new Map,i=new Map,o=p.clone();return LP(p,o,function(l,h){t.set(h,l),i.set(l,h)}),o.traverse(function(l){if(!l.isSkinnedMesh)return;const h=l,d=t.get(l),f=d.skeleton.bones;h.skeleton=d.skeleton.clone(),h.bindMatrix.copy(d.bindMatrix),h.skeleton.bones=f.map(function(g){return i.get(g)}),h.bind(h.skeleton,h.bindMatrix)}),o}function LP(p,t,i){i(p,t);for(let o=0;o<p.children.length;o++)LP(p.children[o],t.children[o],i)}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DP=Symbol("prepared"),BE=Symbol("prepare"),Pl=Symbol("preparedGLTF"),RE=Symbol("clone");class jV{constructor(t){this[Pl]=t}static prepare(t){if(t.scene==null)throw new Error("Model does not have a scene");if(t[DP])return t;const i=this[BE](t);return i[DP]=!0,i}static[BE](t){const{scene:i}=t,o=[i];return Object.assign(Object.assign({},t),{scene:i,scenes:o})}get parser(){return this[Pl].parser}get animations(){return this[Pl].animations}get scene(){return this[Pl].scene}get scenes(){return this[Pl].scenes}get cameras(){return this[Pl].cameras}get asset(){return this[Pl].asset}get userData(){return this[Pl].userData}clone(){return new this.constructor(this[RE]())}dispose(){this.scenes.forEach(t=>{t.traverse(i=>{const o=i;o.material&&((Array.isArray(o.material)?o.material:[o.material]).forEach(l=>{for(const h in l){const d=l[h];if(d instanceof qi){const f=d.source.data;f.close!=null&&f.close(),d.dispose()}}l.dispose()}),o.geometry.dispose())})})}[RE](){const t=this[Pl],i=WV(this.scene);qV(i,this.scene);const o=[i],l=t.userData?Object.assign({},t.userData):{};return Object.assign(Object.assign({},t),{scene:i,scenes:o,userData:l})}}const qV=(p,t)=>{PP(p,t,(i,o)=>{o.userData.variantMaterials!==void 0&&(i.userData.variantMaterials=new Map(o.userData.variantMaterials)),o.userData.variantData!==void 0&&(i.userData.variantData=o.userData.variantData),o.userData.originalMaterial!==void 0&&(i.userData.originalMaterial=o.userData.originalMaterial)})},PP=(p,t,i)=>{i(p,t);for(let o=0;o<p.children.length;o++)PP(p.children[o],t.children[o],i)},UP=Symbol("threeGLTF"),NP=Symbol("gltf"),FP=Symbol("gltfElementMap"),OP=Symbol("threeObjectMap"),kP=Symbol("parallelTraverseThreeScene"),QP=Symbol("correlateOriginalThreeGLTF"),GP=Symbol("correlateCloneThreeGLTF");class Sg{constructor(t,i,o,l){this[UP]=t,this[NP]=i,this[FP]=l,this[OP]=o}static from(t,i){return i!=null?this[GP](t,i):this[QP](t)}static[QP](t){const i=t.parser.json,o=t.parser.associations,l=new Map,h={name:"Default"},d={type:"materials",index:-1};for(const f of o.keys())f instanceof el&&o.get(f)==null&&(d.index<0&&(i.materials==null&&(i.materials=[]),d.index=i.materials.length,i.materials.push(h)),f.name=h.name,o.set(f,{materials:d.index}));for(const[f,g]of o){g&&(f.userData=f.userData||{},f.userData.associations=g);for(const y in g)if(y!=null&&y!=="primitives"){const x=y,b=(i[x]||[])[g[x]];if(b==null)continue;let _=l.get(b);_==null&&(_=new Set,l.set(b,_)),_.add(f)}}return new Sg(t,i,o,l)}static[GP](t,i){const o=i.threeGLTF,l=i.gltf,h=JSON.parse(JSON.stringify(l)),d=new Map,f=new Map;for(let g=0;g<o.scenes.length;g++)this[kP](o.scenes[g],t.scenes[g],(y,x)=>{const b=i.threeObjectMap.get(y);if(b!=null){for(const _ in b)if(_!=null&&_!=="primitives"){const w=_,T=b[w],P=h[w][T],U=d.get(x)||{};U[w]=T,d.set(x,U);const D=f.get(P)||new Set;D.add(x),f.set(P,D)}}});return new Sg(t,h,d,f)}static[kP](t,i,o){const l=(h,d)=>{if(o(h,d),h.isObject3D){const f=h,g=d;if(f.material)if(Array.isArray(f.material))for(let y=0;y<f.material.length;++y)o(f.material[y],g.material[y]);else o(f.material,g.material);for(let y=0;y<h.children.length;++y)l(h.children[y],d.children[y])}};l(t,i)}get threeGLTF(){return this[UP]}get gltf(){return this[NP]}get gltfElementMap(){return this[FP]}get threeObjectMap(){return this[OP]}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const og=Symbol("correlatedSceneGraph");class XV extends jV{static[BE](t){const i=super[BE](t);i[og]==null&&(i[og]=Sg.from(i));const{scene:o}=i,l=new vo(void 0,1/0);return o.traverse(h=>{h.renderOrder=1e3,h.frustumCulled=!1,h.name||(h.name=h.uuid);const d=h;if(d.material){const{geometry:f}=d;d.castShadow=!0,d.isSkinnedMesh&&(f.boundingSphere=l,f.boundingBox=null);const g=d.material;if(g.isMeshBasicMaterial===!0&&(g.toneMapped=!1),g.shadowSide=0,g.aoMap){const{gltf:y,threeObjectMap:x}=i[og],b=x.get(g);if(y.materials!=null&&b!=null&&b.materials!=null){const _=y.materials[b.materials];_.occlusionTexture&&_.occlusionTexture.texCoord===0&&f.attributes.uv!=null&&f.setAttribute("uv2",f.attributes.uv)}}}}),i}get correlatedSceneGraph(){return this[Pl][og]}[RE](){const t=super[RE](),i=new Map;return t.scene.traverse(o=>{const l=o;if(l.material){const d=l.material;if(d!=null){if(i.has(d.uuid))return void(l.material=i.get(d.uuid));l.material=d.clone(),i.set(d.uuid,l.material)}}const h=o;h.target!==void 0&&h.add(h.target)}),t[og]=Sg.from(t,this.correlatedSceneGraph),t}}const HP=(p,t,i)=>{let o;switch(p){case Rr:o=new Uint8ClampedArray(t*i*4);break;case ss:o=new Uint16Array(t*i*4);break;case Th:o=new Uint32Array(t*i*4);break;case TC:o=new Int8Array(t*i*4);break;case BC:o=new Int16Array(t*i*4);break;case ay:o=new Int32Array(t*i*4);break;case Wr:o=new Float32Array(t*i*4);break;default:throw new Error("Unsupported data type")}return o};let LE;class rS{constructor(t){var i,o,l,h,d,f,g,y,x,b,_,w,T,P,U,D;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(G){throw this._renderer.setRenderTarget(null),G}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const z={format:fr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((i=t.renderTargetOptions)===null||i===void 0?void 0:i.anisotropy)!==void 0?(o=t.renderTargetOptions)===null||o===void 0?void 0:o.anisotropy:1,generateMipmaps:((l=t.renderTargetOptions)===null||l===void 0?void 0:l.generateMipmaps)!==void 0&&((h=t.renderTargetOptions)===null||h===void 0?void 0:h.generateMipmaps),magFilter:((d=t.renderTargetOptions)===null||d===void 0?void 0:d.magFilter)!==void 0?(f=t.renderTargetOptions)===null||f===void 0?void 0:f.magFilter:Fi,minFilter:((g=t.renderTargetOptions)===null||g===void 0?void 0:g.minFilter)!==void 0?(y=t.renderTargetOptions)===null||y===void 0?void 0:y.minFilter:Fi,samples:((x=t.renderTargetOptions)===null||x===void 0?void 0:x.samples)!==void 0?(b=t.renderTargetOptions)===null||b===void 0?void 0:b.samples:void 0,wrapS:((_=t.renderTargetOptions)===null||_===void 0?void 0:_.wrapS)!==void 0?(w=t.renderTargetOptions)===null||w===void 0?void 0:w.wrapS:rs,wrapT:((T=t.renderTargetOptions)===null||T===void 0?void 0:T.wrapT)!==void 0?(P=t.renderTargetOptions)===null||P===void 0?void 0:P.wrapT:rs};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=rS.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Oh,this._camera=new cA,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((G,Q,Y,q)=>{if(LE!==void 0)return LE;const K=new go(1,1,q);Q.setRenderTarget(K);const ne=new Vi(new Fl,new yo({color:16777215}));Q.render(ne,Y),Q.setRenderTarget(null);const le=HP(G,K.width,K.height);return Q.readRenderTargetPixels(K,0,0,K.width,K.height,le),K.dispose(),ne.geometry.dispose(),ne.material.dispose(),LE=le[0]!==0,LE})(this._type,this._renderer,this._camera,z)){let G;this._type===ss&&(G=this._renderer.extensions.has("EXT_color_buffer_float")?Wr:void 0),G!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to 1015`),this._type=G):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Vi(new Fl,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new go(this.width,this.height,z),this._renderTarget.texture.mapping=((U=t.renderTargetOptions)===null||U===void 0?void 0:U.mapping)!==void 0?(D=t.renderTargetOptions)===null||D===void 0?void 0:D.mapping:Fp}static instantiateRenderer(){const t=new Qw;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=HP(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const i=new Fm(this.toArray(),this.width,this.height,fr,this._type,t?.mapping||Fp,t?.wrapS||rs,t?.wrapT||rs,t?.magFilter||Fi,t?.minFilter||Fi,t?.anisotropy||1,Yi);return i.generateMipmaps=t?.generateMipmaps!==void 0&&t?.generateMipmaps,i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Ta&&Object.values(this.material.uniforms).forEach(i=>{i.value instanceof qi&&i.value.dispose()}),Object.values(this.material).forEach(i=>{i instanceof qi&&i.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class YV extends Ta{constructor({gamma:t,offsetHdr:i,offsetSdr:o,gainMapMin:l,gainMapMax:h,maxDisplayBoost:d,hdrCapacityMin:f,hdrCapacityMax:g,sdr:y,gainMap:x}){super({name:"GainMapDecoderMaterial",vertexShader:`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,fragmentShader:`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`,uniforms:{sdr:{value:y},gainMap:{value:x},gamma:{value:new ve(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new ve().fromArray(i)},offsetSdr:{value:new ve().fromArray(o)},gainMapMin:{value:new ve().fromArray(l)},gainMapMax:{value:new ve().fromArray(h)},weightFactor:{value:(Math.log2(d)-f)/(g-f)}},blending:0,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=d,this._hdrCapacityMin=f,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const i=this.uniforms.gamma.value;i.x=1/t[0],i.y=1/t[1],i.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class zP extends Error{}class VP extends Error{}const lg=(p,t,i)=>{var o;let l;const h=(o=p.attributes.getNamedItem(t))===null||o===void 0?void 0:o.nodeValue;if(h)l=h;else{const d=p.getElementsByTagName(t)[0];if(!d){if(i)return i;throw new Error(`Can't find ${t} in gainmap metadata`)}{const f=d.getElementsByTagName("rdf:li");if(f.length!==3)throw new Error(`Gainmap metadata contains an array of items for ${t} but its length is not 3`);l=Array.from(f).map(g=>g.innerHTML)}}return l};class KV{constructor(t){this.options={debug:!(!t||t.debug===void 0)&&t.debug,extractFII:!t||t.extractFII===void 0||t.extractFII,extractNonFII:!t||t.extractNonFII===void 0||t.extractNonFII}}extract(t){return new Promise((i,o)=>{const l=this.options.debug,h=new DataView(t.buffer);if(h.getUint16(0)!==65496)return void o(new Error("Not a valid jpeg"));const d=h.byteLength;let f,g=2,y=0;for(;g<d;){if(++y>250)return void o(new Error(`Found no marker after ${y} loops \u{1F635}`));if(h.getUint8(g)!==255)return void o(new Error(`Not a valid marker at offset 0x${g.toString(16)}, found: 0x${h.getUint8(g).toString(16)}`));if(f=h.getUint8(g+1),l&&console.log(`Marker: ${f.toString(16)}`),f===226){l&&console.log("Found APP2 marker (0xffe2)");const x=g+4;if(h.getUint32(x)===1297106432){const b=x+4;let _;if(h.getUint16(b)===18761)_=!1;else{if(h.getUint16(b)!==19789)return void o(new Error("No valid endianness marker found in TIFF header"));_=!0}if(h.getUint16(b+2,!_)!==42)return void o(new Error("Not valid TIFF data! (no 0x002A marker)"));const w=h.getUint32(b+4,!_);if(w<8)return void o(new Error("Not valid TIFF data! (First offset less than 8)"));const T=b+w,P=h.getUint16(T,!_),U=T+2;let D=0;for(let Q=U;Q<U+12*P;Q+=12)h.getUint16(Q,!_)===45057&&(D=h.getUint32(Q+8,!_));const z=T+2+12*P+4,G=[];for(let Q=z;Q<z+16*D;Q+=16){const Y={MPType:h.getUint32(Q,!_),size:h.getUint32(Q+4,!_),dataOffset:h.getUint32(Q+8,!_),dependantImages:h.getUint32(Q+12,!_),start:-1,end:-1,isFII:!1};Y.dataOffset?(Y.start=b+Y.dataOffset,Y.isFII=!1):(Y.start=0,Y.isFII=!0),Y.end=Y.start+Y.size,G.push(Y)}if(this.options.extractNonFII&&G.length){const Q=new Blob([h]),Y=[];for(const q of G){if(q.isFII&&!this.options.extractFII)continue;const K=Q.slice(q.start,q.end+1,"image/jpeg");Y.push(K)}i(Y)}}}g+=2+h.getUint16(g+2)}})}}const JV=async p=>{const t=(l=>{var h,d;let f;f=typeof TextDecoder<"u"?new TextDecoder().decode(l):l.toString();let g=f.indexOf("<x:xmpmeta");const y=new DOMParser;for(;g!==-1;){const x=f.indexOf("x:xmpmeta>",g);f.slice(g,x+10);const b=f.slice(g,x+10);try{const _=y.parseFromString(b,"text/xml").getElementsByTagName("rdf:Description")[0],w=lg(_,"hdrgm:GainMapMin","0"),T=lg(_,"hdrgm:GainMapMax"),P=lg(_,"hdrgm:Gamma","1"),U=lg(_,"hdrgm:OffsetSDR","0.015625"),D=lg(_,"hdrgm:OffsetHDR","0.015625");let z=(h=_.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||h===void 0?void 0:h.nodeValue;z||(z="0");const G=(d=_.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||d===void 0?void 0:d.nodeValue;if(!G)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(w)?w.map(Q=>parseFloat(Q)):[parseFloat(w),parseFloat(w),parseFloat(w)],gainMapMax:Array.isArray(T)?T.map(Q=>parseFloat(Q)):[parseFloat(T),parseFloat(T),parseFloat(T)],gamma:Array.isArray(P)?P.map(Q=>parseFloat(Q)):[parseFloat(P),parseFloat(P),parseFloat(P)],offsetSdr:Array.isArray(U)?U.map(Q=>parseFloat(Q)):[parseFloat(U),parseFloat(U),parseFloat(U)],offsetHdr:Array.isArray(D)?D.map(Q=>parseFloat(Q)):[parseFloat(D),parseFloat(D),parseFloat(D)],hdrCapacityMin:parseFloat(z),hdrCapacityMax:parseFloat(G)}}catch{}g=f.indexOf("<x:xmpmeta",x)}})(p);if(!t)throw new VP("Gain map XMP metadata not found");const i=new KV({extractFII:!0,extractNonFII:!0}),o=await i.extract(p);if(o.length!==2)throw new zP("Gain map recovery image not found");return{sdr:new Uint8Array(await o[0].arrayBuffer()),gainMap:new Uint8Array(await o[1].arrayBuffer()),metadata:t}},WP=p=>new Promise((t,i)=>{const o=document.createElement("img");o.onload=()=>{t(o)},o.onerror=l=>{i(l)},o.src=URL.createObjectURL(p)});class $V extends tl{constructor(t,i){super(i),t&&(this._renderer=t),this._internalLoadingManager=new s3}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new YV({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new qi,sdr:new qi});return new rS({width:16,height:16,type:ss,colorSpace:Yi,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,i,o,l){const h=l?new Blob([l],{type:"image/jpeg"}):void 0,d=new Blob([o],{type:"image/jpeg"});let f,g,y=!1;if(typeof createImageBitmap>"u"){const _=await Promise.all([h?WP(h):Promise.resolve(void 0),WP(d)]);g=_[0],f=_[1],y=!0}else{const _=await Promise.all([h?createImageBitmap(h,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(d,{imageOrientation:"flipY"})]);g=_[0],f=_[1]}const x=new qi(g||new ImageData(2,2),Fp,rs,rs,Fi,1008,fr,Rr,1,Yi);x.flipY=y,x.needsUpdate=!0;const b=new qi(f,Fp,rs,rs,Fi,1008,fr,Rr,1,sr);b.flipY=y,b.needsUpdate=!0,t.width=f.width,t.height=f.height,t.material.gainMap=x,t.material.sdr=b,t.material.gainMapMin=i.gainMapMin,t.material.gainMapMax=i.gainMapMax,t.material.offsetHdr=i.offsetHdr,t.material.offsetSdr=i.offsetSdr,t.material.gamma=i.gamma,t.material.hdrCapacityMin=i.hdrCapacityMin,t.material.hdrCapacityMax=i.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,i.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class ZV extends $V{load(t,i,o,l){const h=this.prepareQuadRenderer(),d=new Rl(this._internalLoadingManager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(this.withCredentials),this.manager.itemStart(t),d.load(t,async f=>{if(typeof f=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(f);let y,x,b;try{const _=await JV(g);y=_.sdr,x=_.gainMap,b=_.metadata}catch(_){if(!(_ instanceof VP||_ instanceof zP))throw _;console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),b={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},y=g}try{await this.render(h,b,y,x)}catch(_){return this.manager.itemError(t),typeof l=="function"&&l(_),void h.disposeOnDemandRenderer()}typeof i=="function"&&i(h),this.manager.itemEnd(t),h.disposeOnDemandRenderer()},o,f=>{this.manager.itemError(t),typeof l=="function"&&l(f)}),h}}class e7 extends rz{constructor(t){super(t),this.type=ss}parse(t){const i=function(T,P){switch(T){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(P||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(P||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(P||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(P||""))}},o=function(T,P,U){P=P||1024;let D=T.pos,z=-1,G=0,Q="",Y=String.fromCharCode.apply(null,new Uint16Array(T.subarray(D,D+128)));for(;0>(z=Y.indexOf(`
`))&&G<P&&D<T.byteLength;)Q+=Y,G+=Y.length,D+=128,Y+=String.fromCharCode.apply(null,new Uint16Array(T.subarray(D,D+128)));return-1<z&&(U!==!1&&(T.pos+=G+z+1),Q+Y.slice(0,z))},l=function(T,P,U,D){const z=T[P+3],G=Math.pow(2,z-128)/255;U[D+0]=T[P+0]*G,U[D+1]=T[P+1]*G,U[D+2]=T[P+2]*G,U[D+3]=1},h=function(T,P,U,D){const z=T[P+3],G=Math.pow(2,z-128)/255;U[D+0]=By.toHalfFloat(Math.min(T[P+0]*G,65504)),U[D+1]=By.toHalfFloat(Math.min(T[P+1]*G,65504)),U[D+2]=By.toHalfFloat(Math.min(T[P+2]*G,65504)),U[D+3]=By.toHalfFloat(1)},d=new Uint8Array(t);d.pos=0;const f=function(T){const P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,D=/^\s*FORMAT=(\S+)\s*$/,z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,G={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Q,Y;for((T.pos>=T.byteLength||!(Q=o(T)))&&i(1,"no header found"),(Y=Q.match(/^#\?(\S+)/))||i(3,"bad initial token"),G.valid|=1,G.programtype=Y[1],G.string+=Q+`
`;Q=o(T),Q!==!1;)if(G.string+=Q+`
`,Q.charAt(0)!=="#"){if((Y=Q.match(P))&&(G.gamma=parseFloat(Y[1])),(Y=Q.match(U))&&(G.exposure=parseFloat(Y[1])),(Y=Q.match(D))&&(G.valid|=2,G.format=Y[1]),(Y=Q.match(z))&&(G.valid|=4,G.height=parseInt(Y[1],10),G.width=parseInt(Y[2],10)),2&G.valid&&4&G.valid)break}else G.comments+=Q+`
`;return 2&G.valid||i(3,"missing format specifier"),4&G.valid||i(3,"missing image size specifier"),G}(d),g=f.width,y=f.height,x=function(T,P,U){const D=P;if(D<8||D>32767||T[0]!==2||T[1]!==2||128&T[2])return new Uint8Array(T);D!==(T[2]<<8|T[3])&&i(3,"wrong scanline width");const z=new Uint8Array(4*P*U);z.length||i(4,"unable to allocate buffer space");let G=0,Q=0;const Y=4*D,q=new Uint8Array(4),K=new Uint8Array(Y);let ne=U;for(;ne>0&&Q<T.byteLength;){Q+4>T.byteLength&&i(1),q[0]=T[Q++],q[1]=T[Q++],q[2]=T[Q++],q[3]=T[Q++],q[0]==2&&q[1]==2&&(q[2]<<8|q[3])==D||i(3,"bad rgbe scanline format");let le,fe=0;for(;fe<Y&&Q<T.byteLength;){le=T[Q++];const de=le>128;if(de&&(le-=128),(le===0||fe+le>Y)&&i(3,"bad scanline data"),de){const Fe=T[Q++];for(let we=0;we<le;we++)K[fe++]=Fe}else K.set(T.subarray(Q,Q+le),fe),fe+=le,Q+=le}const be=D;for(let de=0;de<be;de++){let Fe=0;z[G]=K[de+Fe],Fe+=D,z[G+1]=K[de+Fe],Fe+=D,z[G+2]=K[de+Fe],Fe+=D,z[G+3]=K[de+Fe],G+=4}ne--}return z}(d.subarray(d.pos),g,y);let b,_,w;switch(this.type){case Wr:w=x.length/4;const T=new Float32Array(4*w);for(let U=0;U<w;U++)l(x,4*U,T,4*U);b=T,_=Wr;break;case ss:w=x.length/4;const P=new Uint16Array(4*w);for(let U=0;U<w;U++)h(x,4*U,P,4*U);b=P,_=ss;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:g,height:y,data:b,header:f.string,gamma:f.gamma,exposure:f.exposure,type:_}}setDataType(t){return this.type=t,this}load(t,i,o,l){return super.load(t,function(h,d){switch(h.type){case Wr:case ss:h.colorSpace=Yi,h.minFilter=Fi,h.magFilter=Fi,h.generateMipmaps=!1,h.flipY=!0}i&&i(h,d)},o,l)}}/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t7={topLight:{intensity:500,position:[.418,16.199,.3]},room:{position:[-.757,13.219,.717],scale:[31.713,28.305,28.591]},boxes:[{position:[-10.906,2.009,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,.857,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:50,position:[-16.116,14.37,8.208],scale:[.1,2.428,2.739]},{intensity:50,position:[-16.109,18.021,-8.207],scale:[.1,2.425,2.751]},{intensity:17,position:[14.904,12.198,-1.832],scale:[.15,4.265,6.331]},{intensity:43,position:[-.462,8.89,14.52],scale:[4.38,5.441,.088]},{intensity:20,position:[3.235,11.486,-12.541],scale:[2.5,2,.1]},{intensity:100,position:[0,20,0],scale:[1,.1,1]}]},n7={topLight:{intensity:400,position:[.5,14,.5]},room:{position:[0,13.2,0],scale:[31.5,28.5,31.5]},boxes:[{position:[-10.906,-1,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,-.16,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:80,position:[-14,10,8],scale:[.1,2.5,2.5]},{intensity:80,position:[-14,14,-4],scale:[.1,2.5,2.5]},{intensity:23,position:[14,12,0],scale:[.1,5,5]},{intensity:16,position:[0,9,14],scale:[5,5,.1]},{intensity:80,position:[7,8,-14],scale:[2.5,2.5,.1]},{intensity:80,position:[-7,16,-14],scale:[2.5,2.5,.1]},{intensity:1,position:[0,20,0],scale:[.1,.1,.1]}]};class jP extends Oh{constructor(t){super(),this.position.y=-3.5;const i=new jc;i.deleteAttribute("uv");const o=new Hm({metalness:0,side:1}),l=new Hm({metalness:0}),h=t=="legacy"?t7:n7,d=new h3(16777215,h.topLight.intensity,28,2);d.position.set(...h.topLight.position),this.add(d);const f=new Vi(i,o);f.position.set(...h.room.position),f.scale.set(...h.room.scale),this.add(f);for(const g of h.boxes){const y=new Vi(i,l);y.position.set(...g.position),y.rotation.set(0,g.rotation,0),y.scale.set(...g.scale),this.add(y)}for(const g of h.lights){const y=new Vi(i,this.createAreaLightMaterial(g.intensity));y.position.set(...g.position),y.scale.set(...g.scale),this.add(y)}}createAreaLightMaterial(t){const i=new yo;return i.color.setScalar(t),i}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DE=20,i7=/\.hdr(\.js)?$/;class qP{constructor(t){this.threeRenderer=t,this.lottieLoaderUrl="",this._ldrLoader=null,this._imageLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}ldrLoader(t){return this._ldrLoader==null&&(this._ldrLoader=new a3),this._ldrLoader.setWithCredentials(t),this._ldrLoader}imageLoader(t){return this._imageLoader==null&&(this._imageLoader=new ZV(this.threeRenderer)),this._imageLoader.setWithCredentials(t),this._imageLoader}hdrLoader(t){return this._hdrLoader==null&&(this._hdrLoader=new e7,this._hdrLoader.setDataType(ss)),this._hdrLoader.setWithCredentials(t),this._hdrLoader}async getLottieLoader(t){if(this._lottieLoader==null){const{LottieLoader:i}=await import(this.lottieLoaderUrl);this._lottieLoader=new i}return this._lottieLoader.setWithCredentials(t),this._lottieLoader}async loadImage(t,i){const o=await new Promise((l,h)=>this.ldrLoader(i).load(t,l,()=>{},h));return o.name=t,o.flipY=!1,o}async loadLottie(t,i,o){const l=await this.getLottieLoader(o);l.setQuality(i);const h=await new Promise((d,f)=>l.load(t,d,()=>{},f));return h.name=t,h}async loadEquirect(t,i=!1,o=()=>{}){try{const l=i7.test(t),h=l?this.hdrLoader(i):this.imageLoader(i),d=await new Promise((f,g)=>h.load(t,y=>{const{renderTarget:x}=y;if(x!=null){const{texture:b}=x;y.dispose(!1),f(b)}else f(y)},y=>{o(y.loaded/y.total*.9)},g));return o(1),d.name=t,d.mapping=iy,l||(d.colorSpace=sr),d}finally{o&&o(1)}}async generateEnvironmentMapAndSkybox(t=null,i=null,o=()=>{},l=!1){const h=i!=="legacy";i!=="legacy"&&i!=="neutral"||(i=null),i=V3(i);let d,f=Promise.resolve(null);t&&(f=this.loadEquirectFromUrl(t,l,o)),d=i?this.loadEquirectFromUrl(i,l,o):t?this.loadEquirectFromUrl(t,l,o):h?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[g,y]=await Promise.all([d,f]);if(g==null)throw new Error("Failed to load environment map.");return{environmentMap:g,skybox:y}}async loadEquirectFromUrl(t,i,o){if(!this.skyboxCache.has(t)){const l=this.loadEquirect(t,i,o);this.skyboxCache.set(t,l)}return this.skyboxCache.get(t)}async GenerateEnvironmentMap(t,i){await((y=0)=>new Promise(x=>setTimeout(x,y)))();const o=this.threeRenderer,l=new Iw(256,{generateMipmaps:!1,type:ss,format:fr,colorSpace:Yi,depthBuffer:!0}),h=new Sw(.1,100,l),d=h.renderTarget.texture;d.name=i;const f=o.outputColorSpace,g=o.toneMapping;return o.toneMapping=0,o.outputColorSpace=Yi,h.update(o,t),this.blurCubemap(l,.04),o.toneMapping=g,o.outputColorSpace=f,d}async loadGeneratedEnvironmentMap(){return this.generatedEnvironmentMap==null&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new jP("legacy"),"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return this.generatedEnvironmentMapAlt==null&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new jP("neutral"),"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(t,i){if(this.blurMaterial==null){this.blurMaterial=this.getBlurShader(DE);const l=new jc,h=new Vi(l,this.blurMaterial);this.blurScene=new Oh,this.blurScene.add(h)}const o=t.clone();this.halfblur(t,o,i,"latitudinal"),this.halfblur(o,t,i,"longitudinal")}halfblur(t,i,o,l){const h=t.width,d=isFinite(o)?Math.PI/(2*h):2*Math.PI/39,f=o/d,g=isFinite(o)?1+Math.floor(3*f):DE;g>DE&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const y=[];let x=0;for(let _=0;_<DE;++_){const w=_/f,T=Math.exp(-w*w/2);y.push(T),_==0?x+=T:_<g&&(x+=2*T)}for(let _=0;_<y.length;_++)y[_]=y[_]/x;const b=this.blurMaterial.uniforms;b.envMap.value=t.texture,b.samples.value=g,b.weights.value=y,b.latitudinal.value=l==="latitudinal",b.dTheta.value=d,new Sw(.1,100,i).update(this.threeRenderer,this.blurScene)}getBlurShader(t){const i=new Float32Array(t),o=new ve(0,1,0);return new Ta({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:o}},vertexShader:`
      
      varying vec3 vOutputDirection;
  
      void main() {
  
        vOutputDirection = vec3( position );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  
      }
    `,fragmentShader:`
        varying vec3 vOutputDirection;
  
        uniform samplerCube envMap;
        uniform int samples;
        uniform float weights[ n ];
        uniform bool latitudinal;
        uniform float dTheta;
        uniform vec3 poleAxis;
  
        vec3 getSample( float theta, vec3 axis ) {
  
          float cosTheta = cos( theta );
          // Rodrigues' axis-angle rotation
          vec3 sampleDirection = vOutputDirection * cosTheta
            + cross( axis, vOutputDirection ) * sin( theta )
            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );
  
          return vec3( textureCube( envMap, sampleDirection ) );
  
        }
  
        void main() {
  
          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );
  
          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {
  
            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );
  
          }
  
          axis = normalize( axis );
  
          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );
  
          for ( int i = 1; i < n; i++ ) {
  
            if ( i >= samples ) {
  
              break;
  
            }
  
            float theta = dTheta * float( i );
            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );
  
          }
        }
      `,blending:0,depthTest:!1,depthWrite:!1,side:1})}async dispose(){for(const[,t]of this.skyboxCache)(await t).dispose();this.generatedEnvironmentMap!=null&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),this.generatedEnvironmentMapAlt!=null&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),this.blurMaterial!=null&&this.blurMaterial.dispose()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA=[1,.79,.62,.5,.4,.31,.25],XP="high-performance";class rl extends Xo{constructor(t){super(),this.loader=new ca(XV),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=i=>{this.dispatchEvent({type:"contextlost",sourceEvent:i})},this.onWebGLContextRestored=()=>{var i;(i=this.textureUtils)===null||i===void 0||i.dispose(),this.textureUtils=new qP(this.threeRenderer);for(const o of this.scenes)o.element[uE]()},this.dpr=window.devicePixelRatio,this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new Qw({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:t.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!t.debug,onShaderError:null},this.threeRenderer.toneMapping=4}catch(i){console.warn(i)}this.arRenderer=new VV(this),this.textureUtils=this.canRender?new qP(this.threeRenderer):null,ca.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}static get singleton(){return this._singleton||(this._singleton=new rl({powerPreference:(self.ModelViewerElement||{}).powerPreference||XP,debug:q3()})),this._singleton}static resetSingleton(){const t=this._singleton.dispose();for(const i of t)i.disconnectedCallback();this._singleton=new rl({powerPreference:(self.ModelViewerElement||{}).powerPreference||XP,debug:q3()});for(const i of t)i.connectedCallback()}get canRender(){return this.threeRenderer!=null}get scaleFactor(){return DA[this.scaleStep]}set minScale(t){let i=1;for(;i<DA.length&&!(DA[i]<t);)++i;this.lastStep=i-1}registerScene(t){this.scenes.add(t),t.forceRescale();const i=new Hn;this.threeRenderer.getSize(i),t.canvas.width=i.x,t.canvas.height=i.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop((o,l)=>this.render(o,l))}unregisterScene(t){this.scenes.delete(t),this.canvas3D.parentElement===t.canvas.parentElement&&t.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&this.scenes.size===0&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(t){return t.element.modelIsVisible&&!this.multipleScenesVisible?this.canvas3D:t.element[CM]}countVisibleScenes(){const{canvas3D:t}=this;let i=0,o=null;for(const h of this.scenes){const{element:d}=h;d.modelIsVisible&&h.externalRenderer==null&&++i,t.parentElement===h.canvas.parentElement&&(o=h)}const l=i>1;if(o!=null){const h=l&&!this.multipleScenesVisible,d=!o.element.modelIsVisible;if(h||d){const{width:f,height:g}=this.sceneSize(o);this.copyPixels(o,f,g),t.parentElement.removeChild(t)}}this.multipleScenesVisible=l}updateRendererSize(){var t;const i=window.devicePixelRatio;if(i!==this.dpr)for(const h of this.scenes){const{element:d}=h;d[QA](d.getBoundingClientRect())}let o=0,l=0;for(const h of this.scenes)o=Math.max(o,h.width),l=Math.max(l,h.height);if(o!==this.width||l!==this.height||i!==this.dpr){this.width=o,this.height=l,this.dpr=i,o=Math.ceil(o*i),l=Math.ceil(l*i),this.canRender&&this.threeRenderer.setSize(o,l,!1);for(const h of this.scenes){const{canvas:d}=h;d.width=o,d.height=l,h.forceRescale(),(t=h.effectRenderer)===null||t===void 0||t.setSize(o,l)}}}updateRendererScale(t){const i=this.scaleStep;this.avgFrameDuration+=Ll(.2*(t-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),i!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(t){if(t.shouldRender())t.scaleStep!=this.scaleStep&&(t.scaleStep=this.scaleStep,this.rescaleCanvas(t));else{if(t.scaleStep==0)return!1;t.scaleStep=0,this.rescaleCanvas(t)}return!0}rescaleCanvas(t){const i=DA[t.scaleStep],o=Math.ceil(this.width/i),l=Math.ceil(this.height/i),{style:h}=t.canvas;h.width=`${o}px`,h.height=`${l}px`,this.canvas3D.style.width=`${o}px`,this.canvas3D.style.height=`${l}px`;const d=this.dpr*i,f=i<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";t.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:d,minimumDpr:this.dpr*DA[this.lastStep],pixelWidth:Math.ceil(t.width*d),pixelHeight:Math.ceil(t.height*d),reason:f}}))}sceneSize(t){const{dpr:i}=this,o=DA[t.scaleStep];return{width:Math.min(Math.ceil(t.width*o*i),this.canvas3D.width),height:Math.min(Math.ceil(t.height*o*i),this.canvas3D.height)}}copyPixels(t,i,o){const l=t.context;l!=null?(l.clearRect(0,0,i,o),l.drawImage(this.canvas3D,0,0,i,o,0,0,i,o),t.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const t=[];for(const i of[!1,!0])for(const o of this.scenes)o.element.modelIsVisible===i&&t.push(o);return t}get isPresenting(){return this.arRenderer.isPresenting}preRender(t,i,o){const{element:l,exposure:h,toneMapping:d}=t;l[Ul](i,o);const f=typeof h=="number"&&!Number.isNaN(h),g=l.environmentImage,y=l.skyboxImage,x=d===7&&(g==="neutral"||g==="legacy"||!g&&!y);this.threeRenderer.toneMappingExposure=(f?h:1)*(x?1.3:1)}render(t,i){if(i!=null)return void this.arRenderer.onWebXRFrame(t,i);const o=t-this.lastTick;if(this.lastTick=t,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(o),this.renderedLastFrame=!1);const{canvas3D:l}=this;for(const h of this.orderedScenes()){const{element:d}=h;if(!d.loaded||!d.modelIsVisible&&h.renderCount>0||(this.preRender(h,t,o),!this.shouldRender(h)))continue;if(h.externalRenderer!=null){const y=h.getCamera();y.updateMatrix();const{matrix:x,projectionMatrix:b}=y,_=x.elements.slice(),w=h.getTarget();_[12]+=w.x,_[13]+=w.y,_[14]+=w.z,h.externalRenderer.render({viewMatrix:_,projectionMatrix:b.elements});continue}if(!d.modelIsVisible&&!this.multipleScenesVisible)for(const y of this.scenes)y.element.modelIsVisible&&y.queueRender();const{width:f,height:g}=this.sceneSize(h);h.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-g,f,g),h.effectRenderer!=null?h.effectRenderer.render(o):(this.threeRenderer.autoClear=!0,this.threeRenderer.toneMapping=h.toneMapping,this.threeRenderer.render(h,h.camera)),this.multipleScenesVisible||!h.element.modelIsVisible&&h.renderCount===0?this.copyPixels(h,f,g):l.parentElement!==h.canvas.parentElement&&(h.canvas.parentElement.appendChild(l),h.canvas.classList.remove("show")),h.hasRendered(),++h.renderCount,this.renderedLastFrame=!0}}dispose(){this.textureUtils!=null&&this.textureUtils.dispose(),this.threeRenderer!=null&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const t=[];for(const i of this.scenes)t.push(i.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),t}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei=Symbol("correlatedObjects"),ki=Symbol("onUpdate");class cg{constructor(t,i){this[ki]=t,this[ei]=i}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP=new yo,r7=new Fl(2,2);let s7=0;const ua=Symbol("threeTexture"),KP=Symbol("threeTextures");class a7 extends cg{get[ua](){var t;return(t=this[ei])===null||t===void 0?void 0:t.values().next().value}get[KP](){return this[ei]}constructor(t,i){super(t,new Set(i?[i]:[])),this[ua].image.src||(this[ua].image.src=i.name?i.name:"adhoc_image"+s7++),this[ua].image.name||(this[ua].image.name=i&&i.image&&i.image.src?i.image.src.split("/").pop():"adhoc_image")}get name(){return this[ua].image.name||""}get uri(){return this[ua].image.src}get bufferView(){return this[ua].image.bufferView}get element(){const t=this[ua];if(t&&(t.isCanvasTexture||t.isVideoTexture))return t.image}get animation(){const t=this[ua];if(t&&t.isCanvasTexture&&t.animation)return t.animation}get type(){return this.uri!=null?"external":"embedded"}set name(t){for(const i of this[KP])i.image.name=t}update(){const t=this[ua];t&&t.isCanvasTexture&&!t.animation&&(this[ua].needsUpdate=!0,this[ki]())}async createThumbnail(t,i){const o=new Oh;YP.map=this[ua];const l=new Vi(r7,YP);o.add(l);const h=new cA(-1,1,1,-1,0,1),{threeRenderer:d}=rl.singleton,f=new go(t,i);d.setRenderTarget(f),d.render(o,h),d.setRenderTarget(null);const g=new Uint8Array(t*i*4);d.readRenderTargetPixels(f,0,0,t,i,g),qh.width=t,qh.height=i;const y=qh.getContext("2d"),x=y.createImageData(t,i);return x.data.set(g),y.putImageData(x,0,0),new Promise(async(b,_)=>{qh.toBlob(w=>{if(!w)return _("Failed to capture thumbnail.");b(URL.createObjectURL(w))},"image/png")})}}var Es,Wh;(function(p){p[p.Nearest=9728]="Nearest",p[p.Linear=9729]="Linear",p[p.NearestMipmapNearest=9984]="NearestMipmapNearest",p[p.LinearMipmapNearest=9985]="LinearMipmapNearest",p[p.NearestMipmapLinear=9986]="NearestMipmapLinear",p[p.LinearMipmapLinear=9987]="LinearMipmapLinear"})(Es||(Es={})),function(p){p[p.ClampToEdge=33071]="ClampToEdge",p[p.MirroredRepeat=33648]="MirroredRepeat",p[p.Repeat=10497]="Repeat"}(Wh||(Wh={}));/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JP=new Map([[Wh.Repeat,Sl],[Wh.ClampToEdge,rs],[Wh.MirroredRepeat,kp]]),tM=new Map([[Sl,Wh.Repeat],[rs,Wh.ClampToEdge],[kp,Wh.MirroredRepeat]]),o7=new Map([[Es.Nearest,fs],[Es.Linear,Fi],[Es.NearestMipmapNearest,sy],[Es.LinearMipmapNearest,Qp],[Es.NearestMipmapLinear,od],[Es.LinearMipmapLinear,mo]]),$P=new Map([[fs,Es.Nearest],[Fi,Es.Linear],[sy,Es.NearestMipmapNearest],[Qp,Es.LinearMipmapNearest],[od,Es.NearestMipmapLinear],[mo,Es.LinearMipmapLinear]]),l7=new Map([[Es.Nearest,fs],[Es.Linear,Fi]]),ZP=new Map([[fs,Es.Nearest],[Fi,Es.Linear]]),c7=p=>$P.has(p),h7=p=>ZP.has(p),u7=p=>tM.has(p),Gc=Symbol("threeTexture"),eU=Symbol("threeTextures"),jh=Symbol("setProperty");class d7 extends cg{get[Gc](){var t;return(t=this[ei])===null||t===void 0?void 0:t.values().next().value}get[eU](){return this[ei]}constructor(t,i){super(t,new Set(i?[i]:[]))}get name(){return this[Gc].name||""}get minFilter(){return $P.get(this[Gc].minFilter)}get magFilter(){return ZP.get(this[Gc].magFilter)}get wrapS(){return tM.get(this[Gc].wrapS)}get wrapT(){return tM.get(this[Gc].wrapT)}get rotation(){return this[Gc].rotation}get scale(){return wM(this[Gc].repeat)}get offset(){return wM(this[Gc].offset)}setMinFilter(t){this[jh]("minFilter",o7.get(t))}setMagFilter(t){this[jh]("magFilter",l7.get(t))}setWrapS(t){this[jh]("wrapS",JP.get(t))}setWrapT(t){this[jh]("wrapT",JP.get(t))}setRotation(t){t==null&&(t=0),this[jh]("rotation",t)}setScale(t){t==null&&(t={u:1,v:1}),this[jh]("repeat",new Hn(t.u,t.v))}setOffset(t){t==null&&(t={u:0,v:0}),this[jh]("offset",new Hn(t.u,t.v))}[jh](t,i){if(((o,l)=>{switch(o){case"minFilter":return c7(l);case"magFilter":return h7(l);case"wrapS":case"wrapT":return u7(l);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${o}" on Sampler`)}})(t,i))for(const o of this[eU])o[t]=i,o.needsUpdate=!0;this[ki]()}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tU=Symbol("image"),nU=Symbol("sampler"),iU=Symbol("threeTexture");class rU extends cg{constructor(t,i){super(t,new Set(i?[i]:[])),this[nU]=new d7(t,i),this[tU]=new a7(t,i)}get[iU](){var t;return(t=this[ei])===null||t===void 0?void 0:t.values().next().value}get name(){return this[iU].name||""}set name(t){for(const i of this[ei])i.name=t}get sampler(){return this[nU]}get source(){return this[tU]}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sU,aU,oU;const Md=Symbol("texture"),Sd=Symbol("transform"),nM=Symbol("materials"),lU=Symbol("usage"),PA=Symbol("onUpdate"),hg=Symbol("activeVideo");var Sn;(function(p){p[p.Base=0]="Base",p[p.MetallicRoughness=1]="MetallicRoughness",p[p.Normal=2]="Normal",p[p.Occlusion=3]="Occlusion",p[p.Emissive=4]="Emissive",p[p.Clearcoat=5]="Clearcoat",p[p.ClearcoatRoughness=6]="ClearcoatRoughness",p[p.ClearcoatNormal=7]="ClearcoatNormal",p[p.SheenColor=8]="SheenColor",p[p.SheenRoughness=9]="SheenRoughness",p[p.Transmission=10]="Transmission",p[p.Thickness=11]="Thickness",p[p.Specular=12]="Specular",p[p.SpecularColor=13]="SpecularColor",p[p.Iridescence=14]="Iridescence",p[p.IridescenceThickness=15]="IridescenceThickness",p[p.Anisotropy=16]="Anisotropy"})(Sn||(Sn={}));class UA{constructor(t,i,o,l){this[sU]=null,this[aU]={rotation:0,scale:new Hn(1,1),offset:new Hn(0,0)},this[oU]=!1,o&&(this[Sd].rotation=o.rotation,this[Sd].scale.copy(o.repeat),this[Sd].offset.copy(o.offset),this[Md]=new rU(t,o)),this[PA]=t,this[nM]=l,this[lU]=i}get texture(){return this[Md]}setTexture(t){var i,o;const l=t!=null?t.source[ua]:null,h=(i=this[Md])===null||i===void 0?void 0:i.source[ua];if(h!=null&&h.isVideoTexture?this[hg]=!1:!((o=this[Md])===null||o===void 0)&&o.source.animation&&this[Md].source.animation.removeEventListener("enterFrame",this[PA]),this[Md]=t,l!=null&&l.isVideoTexture){const f=l.image;if(this[hg]=!0,f.requestVideoFrameCallback!=null){const g=()=>{this[hg]&&(this[PA](),f.requestVideoFrameCallback(g))};f.requestVideoFrameCallback(g)}else{const g=()=>{this[hg]&&(this[PA](),requestAnimationFrame(g))};requestAnimationFrame(g)}}else t?.source.animation!=null&&t.source.animation.addEventListener("enterFrame",this[PA]);let d=sr;if(this[nM])for(const f of this[nM]){switch(this[lU]){case Sn.Base:f.map=l;break;case Sn.MetallicRoughness:d=Yi,f.metalnessMap=l,f.roughnessMap=l;break;case Sn.Normal:d=Yi,f.normalMap=l;break;case Sn.Occlusion:d=Yi,f.aoMap=l;break;case Sn.Emissive:f.emissiveMap=l;break;case Sn.Clearcoat:f.clearcoatMap=l;break;case Sn.ClearcoatRoughness:f.clearcoatRoughnessMap=l;break;case Sn.ClearcoatNormal:f.clearcoatNormalMap=l;break;case Sn.SheenColor:f.sheenColorMap=l;break;case Sn.SheenRoughness:f.sheenRoughnessMap=l;break;case Sn.Transmission:f.transmissionMap=l;break;case Sn.Thickness:f.thicknessMap=l;break;case Sn.Specular:f.specularIntensityMap=l;break;case Sn.SpecularColor:f.specularColorMap=l;break;case Sn.Iridescence:f.iridescenceMap=l;break;case Sn.IridescenceThickness:f.iridescenceThicknessMap=l;break;case Sn.Anisotropy:f.anisotropyMap=l}f.needsUpdate=!0}l&&(l.colorSpace=d,l.rotation=this[Sd].rotation,l.repeat=this[Sd].scale,l.offset=this[Sd].offset),this[PA]()}}sU=Md,aU=Sd,oU=hg;/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ug=Symbol("threeMaterial"),PE=Symbol("threeMaterials"),cU=Symbol("baseColorTexture"),hU=Symbol("metallicRoughnessTexture");class p7 extends cg{constructor(t,i){super(t,i);const{map:o,metalnessMap:l}=i.values().next().value;this[cU]=new UA(t,Sn.Base,o,i),this[hU]=new UA(t,Sn.MetallicRoughness,l,i)}get[PE](){return this[ei]}get[ug](){var t;return(t=this[ei])===null||t===void 0?void 0:t.values().next().value}get baseColorFactor(){const t=[0,0,0,this[ug].opacity];return this[ug].color.toArray(t),t}get metallicFactor(){return this[ug].metalness}get roughnessFactor(){return this[ug].roughness}get baseColorTexture(){return this[cU]}get metallicRoughnessTexture(){return this[hU]}setBaseColorFactor(t){const i=new fn;t instanceof Array?i.fromArray(t):i.set(t);for(const o of this[PE])o.color.set(i),t instanceof Array&&t.length>3?o.opacity=t[3]:(t=[0,0,0,o.opacity],i.toArray(t));this[ki]()}setMetallicFactor(t){for(const i of this[PE])i.metalness=t;this[ki]()}setRoughnessFactor(t){for(const i of this[PE])i.roughness=t;this[ki]()}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var uU,dU;const pU=Symbol("pbrMetallicRoughness"),AU=Symbol("normalTexture"),fU=Symbol("occlusionTexture"),mU=Symbol("emissiveTexture"),or=Symbol("backingThreeMaterial"),gU=Symbol("applyAlphaCutoff"),iM=Symbol("getAlphaMode"),NA=Symbol("lazyLoadGLTFInfo"),rM=Symbol("initialize"),sM=Symbol("getLoadedMaterial"),en=Symbol("ensureMaterialIsLoaded"),vU=Symbol("gltfIndex"),dg=Symbol("setActive"),FA=Symbol("variantIndices"),aM=Symbol("isActive"),yU=Symbol("modelVariants"),oM=Symbol("name"),Ba=Symbol("pbrTextures");class lM extends cg{constructor(t,i,o,l,h,d,f=void 0){super(t,h),this[uU]=new Set,this[dU]=new Map,this[vU]=i,this[aM]=o,this[yU]=l,this[oM]=d,f==null?this[rM]():this[NA]=f}get[(uU=FA,dU=Ba,or)](){return this[ei].values().next().value}[rM](){const t=this[ki],i=this[ei];this[pU]=new p7(t,i);const{normalMap:o,aoMap:l,emissiveMap:h}=i.values().next().value;this[AU]=new UA(t,Sn.Normal,o,i),this[fU]=new UA(t,Sn.Occlusion,l,i),this[mU]=new UA(t,Sn.Emissive,h,i);const d=f=>{this[Ba].set(f,new UA(t,f,null,i))};d(Sn.Clearcoat),d(Sn.ClearcoatRoughness),d(Sn.ClearcoatNormal),d(Sn.SheenColor),d(Sn.SheenRoughness),d(Sn.Transmission),d(Sn.Thickness),d(Sn.Specular),d(Sn.SpecularColor),d(Sn.Iridescence),d(Sn.IridescenceThickness),d(Sn.Anisotropy)}async[sM](){if(this[NA]!=null){const t=await this[NA].doLazyLoad();return this[rM](),this[NA]=void 0,this.ensureLoaded=async()=>{},t}return null}colorFromRgb(t){const i=new fn;return t instanceof Array?i.fromArray(t):i.set(t),i}[en](){if(this[NA]!=null)throw new Error(`Material "${this.name}" has not been loaded, call 'await
    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[sM]()}get isLoaded(){return this[NA]==null}get isActive(){return this[aM]}[dg](t){this[aM]=t}get name(){return this[oM]||""}set name(t){if(this[oM]=t,this[ei]!=null)for(const i of this[ei])i.name=t}get pbrMetallicRoughness(){return this[en](),this[pU]}get normalTexture(){return this[en](),this[AU]}get occlusionTexture(){return this[en](),this[fU]}get emissiveTexture(){return this[en](),this[mU]}get emissiveFactor(){return this[en](),this[or].emissive.toArray()}get index(){return this[vU]}hasVariant(t){const i=this[yU].get(t);return i!=null&&this[FA].has(i.index)}setEmissiveFactor(t){this[en]();const i=this.colorFromRgb(t);for(const o of this[ei])o.emissive.set(i);this[ki]()}[iM](){return this[or].transparent?"BLEND":this[or].alphaTest>0?"MASK":"OPAQUE"}[gU](){this[en]();for(const t of this[ei])this[iM]()==="MASK"?t.alphaTest==null&&(t.alphaTest=.5):t.alphaTest=void 0,t.needsUpdate=!0}setAlphaCutoff(t){this[en]();for(const i of this[ei])i.alphaTest=t,i.needsUpdate=!0;this[gU](),this[ki]()}getAlphaCutoff(){return this[en](),this[or].alphaTest}setDoubleSided(t){this[en]();for(const i of this[ei])i.side=t?2:0,i.needsUpdate=!0;this[ki]()}getDoubleSided(){return this[en](),this[or].side==2}setAlphaMode(t){this[en]();const i=(o,l)=>{o.transparent=l,o.depthWrite=!l};for(const o of this[ei])i(o,t==="BLEND"),o.alphaTest=t==="MASK"?.5:void 0,o.needsUpdate=!0;this[ki]()}getAlphaMode(){return this[en](),this[iM]()}get emissiveStrength(){return this[en](),this[or].emissiveIntensity}setEmissiveStrength(t){this[en]();for(const i of this[ei])i.emissiveIntensity=t;this[ki]()}get clearcoatFactor(){return this[en](),this[or].clearcoat}get clearcoatRoughnessFactor(){return this[en](),this[or].clearcoatRoughness}get clearcoatTexture(){return this[en](),this[Ba].get(Sn.Clearcoat)}get clearcoatRoughnessTexture(){return this[en](),this[Ba].get(Sn.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[en](),this[Ba].get(Sn.ClearcoatNormal)}get clearcoatNormalScale(){return this[en](),this[or].clearcoatNormalScale.x}setClearcoatFactor(t){this[en]();for(const i of this[ei])i.clearcoat=t;this[ki]()}setClearcoatRoughnessFactor(t){this[en]();for(const i of this[ei])i.clearcoatRoughness=t;this[ki]()}setClearcoatNormalScale(t){this[en]();for(const i of this[ei])i.clearcoatNormalScale=new Hn(t,t);this[ki]()}get ior(){return this[en](),this[or].ior}setIor(t){this[en]();for(const i of this[ei])i.ior=t;this[ki]()}get sheenColorFactor(){return this[en](),this[or].sheenColor.toArray()}get sheenColorTexture(){return this[en](),this[Ba].get(Sn.SheenColor)}get sheenRoughnessFactor(){return this[en](),this[or].sheenRoughness}get sheenRoughnessTexture(){return this[en](),this[Ba].get(Sn.SheenRoughness)}setSheenColorFactor(t){this[en]();const i=this.colorFromRgb(t);for(const o of this[ei])o.sheenColor.set(i),o.sheen=1;this[ki]()}setSheenRoughnessFactor(t){this[en]();for(const i of this[ei])i.sheenRoughness=t,i.sheen=1;this[ki]()}get transmissionFactor(){return this[en](),this[or].transmission}get transmissionTexture(){return this[en](),this[Ba].get(Sn.Transmission)}setTransmissionFactor(t){this[en]();for(const i of this[ei])i.transmission=t;this[ki]()}get thicknessFactor(){return this[en](),this[or].thickness}get thicknessTexture(){return this[en](),this[Ba].get(Sn.Thickness)}get attenuationDistance(){return this[en](),this[or].attenuationDistance}get attenuationColor(){return this[en](),this[or].attenuationColor.toArray()}setThicknessFactor(t){this[en]();for(const i of this[ei])i.thickness=t;this[ki]()}setAttenuationDistance(t){this[en]();for(const i of this[ei])i.attenuationDistance=t;this[ki]()}setAttenuationColor(t){this[en]();const i=this.colorFromRgb(t);for(const o of this[ei])o.attenuationColor.set(i);this[ki]()}get specularFactor(){return this[en](),this[or].specularIntensity}get specularTexture(){return this[en](),this[Ba].get(Sn.Specular)}get specularColorFactor(){return this[en](),this[or].specularColor.toArray()}get specularColorTexture(){return this[en](),this[Ba].get(Sn.SheenColor)}setSpecularFactor(t){this[en]();for(const i of this[ei])i.specularIntensity=t;this[ki]()}setSpecularColorFactor(t){this[en]();const i=this.colorFromRgb(t);for(const o of this[ei])o.specularColor.set(i);this[ki]()}get iridescenceFactor(){return this[en](),this[or].iridescence}get iridescenceTexture(){return this[en](),this[Ba].get(Sn.Iridescence)}get iridescenceIor(){return this[en](),this[or].iridescenceIOR}get iridescenceThicknessMinimum(){return this[en](),this[or].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[en](),this[or].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[en](),this[Ba].get(Sn.IridescenceThickness)}setIridescenceFactor(t){this[en]();for(const i of this[ei])i.iridescence=t;this[ki]()}setIridescenceIor(t){this[en]();for(const i of this[ei])i.iridescenceIOR=t;this[ki]()}setIridescenceThicknessMinimum(t){this[en]();for(const i of this[ei])i.iridescenceThicknessRange[0]=t;this[ki]()}setIridescenceThicknessMaximum(t){this[en]();for(const i of this[ei])i.iridescenceThicknessRange[1]=t;this[ki]()}get anisotropyStrength(){return this[en](),this[or].anisotropy}get anisotropyRotation(){return this[en](),this[or].anisotropyRotation}get anisotropyTexture(){return this[en](),this[Ba].get(Sn.Anisotropy)}setAnisotropyStrength(t){this[en]();for(const i of this[ei])i.anisotropy=t;this[ki]()}setAnisotropyRotation(t){this[en]();for(const i of this[ei])i.anisotropyRotation=t;this[ki]()}}class EU{constructor(t){this.name="",this.children=new Array,this.name=t}}class cM extends EU{constructor(t,i,o,l){super(t.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=t;const{gltf:h,threeGLTF:d,threeObjectMap:f}=l;this.parser=d.parser,this.modelVariants=o,this.mesh.userData.variantData=o;const g=f.get(t.material);g.materials!=null?this.initialMaterialIdx=this.activeMaterialIdx=g.materials:console.error(`Primitive (${t.name}) missing initial material reference.`);const y=t.userData.associations||{};if(y.meshes==null)return void console.error("Mesh is missing primitive index association");const x=((h.meshes||[])[y.meshes].primitives||[])[y.primitives];if(x!=null){if(x.material!=null)this.materials.set(x.material,i[x.material]);else{const b=i.findIndex(_=>_.name==="Default");b>=0?this.materials.set(b,i[b]):console.warn("gltfPrimitive has no material!")}if(x.extensions&&x.extensions.KHR_materials_variants){const b=x.extensions.KHR_materials_variants,_=d.parser.json.extensions.KHR_materials_variants.variants;for(const w of b.mappings){const T=i[w.material];this.materials.set(w.material,T);for(const P of w.variants){const{name:U}=_[P];this.variantToMaterialMap.set(P,T),T[FA].add(P),o.has(U)||o.set(U,{name:U,index:P})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(t){const i=this.materials.get(t);if(t!==this.activeMaterialIdx){const o=i[ei],l=await i[sM]();this.mesh.material=l??o.values().next().value,this.parser.assignFinalMaterial(this.mesh),o.add(this.mesh.material),this.activeMaterialIdx=t}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(t){return this.materials.get(t)}async enableVariant(t){if(t==null)return this.setActiveMaterial(this.initialMaterialIdx);if(this.variantToMaterialMap!=null&&this.modelVariants.has(t)){const i=this.modelVariants.get(t);return this.enableVariantHelper(i.index)}return null}async enableVariantHelper(t){if(this.variantToMaterialMap!=null&&t!=null){const i=this.variantToMaterialMap.get(t);if(i!=null)return this.setActiveMaterial(i.index)}return null}async instantiateVariants(){if(this.variantToMaterialMap!=null)for(const t of this.variantToMaterialMap.keys()){const i=this.mesh.userData.variantMaterials.get(t);if(i.material!=null)continue;const o=await this.enableVariantHelper(t);o!=null&&(i.material=o)}}get variantInfo(){return this.variantToMaterialMap}addVariant(t,i){if(!this.ensureVariantIsUnused(i))return!1;this.modelVariants.has(i)||this.modelVariants.set(i,{name:i,index:this.modelVariants.size});const o=this.modelVariants.get(i).index;return t[FA].add(o),this.variantToMaterialMap.set(o,t),this.materials.set(t.index,t),this.updateVariantUserData(o,t),!0}deleteVariant(t){if(this.variantInfo.has(t)){this.variantInfo.delete(t);const i=this.mesh.userData.variantMaterials;i?.delete(t)}}updateVariantUserData(t,i){i[FA].add(t),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map,this.mesh.userData.variantMaterials.set(t,{material:i[ei].values().next().value,gltfMaterialIndex:i.index})}ensureVariantIsUnused(t){const i=this.modelVariants.get(t);return i==null||!this.variantInfo.has(i.index)||(console.warn(`Primitive cannot add variant '${t}' for this material, it already exists.`),!1)}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xU,_U,bU,CU,wU,MU;const Id=Symbol("materials"),UE=Symbol("hierarchy"),SU=Symbol("roots"),Hc=Symbol("primitives"),IU=Symbol("prepareVariantsForExport"),TU=Symbol("switchVariant"),BU=Symbol("materialFromPoint"),hM=Symbol("nodeFromPoint"),RU=Symbol("nodeFromIndex"),Hs=Symbol("variantData"),uM=Symbol("availableVariants"),dM=Symbol("modelOnUpdate"),LU=Symbol("cloneMaterial");class A7{constructor(t,i,o,l){this.gltf=t,this.gltfElementMap=i,this.mapKey=o,this.doLazyLoad=l}}class f7{constructor(t,i=()=>{}){this[xU]=new Array,this[_U]=new Array,this[bU]=new Array,this[CU]=new Array,this[wU]=()=>{},this[MU]=new Map,this[dM]=i;const{gltf:o,threeGLTF:l,gltfElementMap:h}=t;for(const[g,y]of o.materials.entries()){const x=h.get(y);if(x!=null)this[Id].push(new lM(i,g,!0,this[Hs],x,y.name));else{const b=(o.materials||[])[g],_=new Set;h.set(b,_);const w=async()=>{const T=await l.parser.getDependency("material",g);return _.add(T),T};this[Id].push(new lM(i,g,!1,this[Hs],_,y.name,new A7(o,h,b,w)))}}const d=new Map,f=new Array;for(const g of l.scene.children)f.push(g);for(;f.length>0;){const g=f.pop();let y=null;g instanceof Vi?(y=new cM(g,this.materials,this[Hs],t),this[Hc].push(y)):y=new EU(g.name);const x=d.get(g);x!=null?x.children.push(y):this[SU].push(y),this[UE].push(y);for(const b of g.children)f.push(b),d.set(g,y)}}get materials(){return this[Id]}[(xU=Id,_U=UE,bU=SU,CU=Hc,wU=dM,MU=Hs,uM)](){const t=Array.from(this[Hs].values());return t.sort((i,o)=>i.index-o.index),t.map(i=>i.name)}getMaterialByName(t){const i=this[Id].filter(o=>o.name===t);return i.length>0?i[0]:null}[RU](t,i){const o=this[UE].find(l=>{if(l instanceof cM){const{meshes:h,primitives:d}=l.mesh.userData.associations;if(h==t&&d==i)return!0}return!1});return o??null}[hM](t){return this[UE].find(i=>i instanceof cM&&i.mesh===t.object)}[BU](t){return this[hM](t).getActiveMaterial()}async[TU](t){for(const i of this[Hc])await i.enableVariant(t);for(const i of this.materials)i[dg](!1);for(const i of this[Hc])this.materials[i.getActiveMaterial().index][dg](!0)}async[IU](){const t=new Array;for(const i of this[Hc])t.push(i.instantiateVariants());await Promise.all(t)}[LU](t,i){const o=this.materials[t];o.isLoaded||console.error(`Cloning an unloaded material,
           call 'material.ensureLoaded() before cloning the material.`);const l=o[ei],h=new Set;for(const[f,g]of l.entries()){const y=g.clone();y.name=i+(l.size>1?"_inst"+f:""),h.add(y)}const d=new lM(this[dM],this[Id].length,!1,this[Hs],h,i);return this[Id].push(d),d}createMaterialInstanceForVariant(t,i,o,l=!0){let h=null;for(const d of this[Hc]){const f=this[Hs].get(o);f!=null&&d.variantInfo.has(f.index)||d.getMaterial(t)!=null&&(this.hasVariant(o)||this.createVariant(o),h==null&&(h=this[LU](t,i)),d.addVariant(h,o))}if(l&&h!=null){h[dg](!0),this.materials[t][dg](!1);for(const d of this[Hc])d.enableVariant(o)}return h}createVariant(t){this[Hs].has(t)?console.warn(`Variant '${t}'' already exists`):this[Hs].set(t,{name:t,index:this[Hs].size})}hasVariant(t){return this[Hs].has(t)}setMaterialToVariant(t,i){if(this[uM]().find(o=>o===i)!=null)if(t<0||t>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const o of this[Hc]){const l=o.getMaterial(t);l!=null&&o.addVariant(l,i)}else console.warn(`Can't add material to '${i}', the variant does not exist.'`)}updateVariantName(t,i){const o=this[Hs].get(t);o!=null&&(o.name=i,this[Hs].set(i,o),this[Hs].delete(t))}deleteVariant(t){const i=this[Hs].get(t);if(i!=null){for(const o of this.materials)o.hasVariant(t)&&o[FA].delete(i.index);for(const o of this[Hc])o.deleteVariant(i.index);this[Hs].delete(t)}}}/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pM=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const NE=Symbol("currentGLTF"),FE=Symbol("originalGltfJson"),Td=Symbol("model"),AM=Symbol("getOnUpdateMethod"),pg=Symbol("buildTexture");/* @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m7 extends Vi{constructor(){super(void 0,new yo({depthWrite:!1})),this.height=0,this.radius=0,this.resolution=0,this.userData.noHit=!0}get map(){return this.material.map}set map(t){this.material.map=t}isUsable(){return this.height>0&&this.radius>0&&this.geometry!=null&&this.map!=null}updateGeometry(t=this.height,i=this.radius,o=128){t==this.height&&i==this.radius&&o==this.resolution||(this.height=t,this.radius=i,this.resolution=o,t>0&&i>0&&(this.geometry.dispose(),this.geometry=function(l,h,d){const f=new nS(h,2*d,d);f.scale(1,1,-1);const g=f.getAttribute("position"),y=new ve;for(let x=0;x<g.count;++x)if(y.fromBufferAttribute(g,x),y.y<0){const b=3*-l/2,_=y.y<b?-l/y.y:1-y.y*y.y/(3*b*b);y.multiplyScalar(_),y.toArray(g.array,3*x)}return g.needsUpdate=!0,f}(t,i,o)))}}const OE=new ve,fM=new ve,mM=new ve,kE=new zn,DU=new Ja,PU=new ra;class UU extends B8{constructor(t){super(document.createElement("div")),this.normal=new ve(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=t.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(t.position),this.updateNormal(t.normal),this.surface=t.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,this.referenceCount===0}updatePosition(t){if(t==null)return;const i=kc(t)[0].terms;for(let o=0;o<3;++o)this.position.setComponent(o,Dl(i[o]).number);this.updateMatrixWorld()}updateNormal(t){if(t==null)return;const i=kc(t)[0].terms;for(let o=0;o<3;++o)this.normal.setComponent(o,i[o].number)}updateSurface(){const{mesh:t,tri:i,bary:o}=this;if(t==null||i==null||o==null)return;t.getVertexPosition(i.x,OE),t.getVertexPosition(i.y,fM),t.getVertexPosition(i.z,mM),OE.toArray(kE.elements,0),fM.toArray(kE.elements,3),mM.toArray(kE.elements,6),this.position.copy(o).applyMatrix3(kE);const l=this.parent;l.worldToLocal(t.localToWorld(this.position)),DU.set(OE,fM,mM),DU.getNormal(this.normal).transformDirection(t.matrixWorld);const h=l.parent;PU.setFromAxisAngle(OE.set(0,1,0),-h.rotation.y),this.normal.applyQuaternion(PU)}orient(t){this.pivot.style.transform=`rotate(${t}rad)`}updateVisibility(t){this.element.classList.toggle("hide",!t),this.slot.assignedNodes().forEach(i=>{if(i.nodeType!==Node.ELEMENT_NODE)return;const o=i,l=o.dataset.visibilityAttribute;if(l!=null){const h=`data-${l}`;o.toggleAttribute(h,t)}o.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:t}}))}),this.initialized=!0}}const g7={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},v7={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};function NU(p,t,i){return(1-i)*p+i*t}/* @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y7 extends $i{constructor(t,i,o){super(),this.camera=new cA,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new NL,this.horizontalBlurMaterial=new Ta(g7),this.verticalBlurMaterial=new Ta(v7),this.intensity=0,this.softness=1,this.boundingBox=new sa,this.size=new ve,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:l}=this;l.rotation.x=Math.PI/2,l.left=-.5,l.right=.5,l.bottom=-.5,l.top=.5,this.add(l);const h=new Fl,d=new yo({opacity:1,transparent:!0,side:1});this.floor=new Vi(h,d),this.floor.userData.noHit=!0,l.add(this.floor),this.blurPlane=new Vi(h),this.blurPlane.visible=!1,l.add(this.blurPlane),t.target.add(this),this.depthMaterial.onBeforeCompile=function(f){f.fragmentShader=f.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(t,i,o)}setScene(t,i,o){const{boundingBox:l,size:h,rotation:d,position:f}=this;if(this.isAnimated=t.animationNames.length>0,this.boundingBox.copy(t.boundingBox),this.size.copy(t.size),this.maxDimension=Math.max(h.x,h.y,h.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(f),o==="back"){const{min:g,max:y}=l;[g.y,g.z]=[g.z,g.y],[y.y,y.z]=[y.z,y.y],[h.y,h.z]=[h.z,h.y],d.x=Math.PI/2,d.y=Math.PI}else d.x=0,d.y=0;if(this.isAnimated){const g=l.min.y,y=l.max.y;h.y=this.maxDimension,l.expandByVector(h.subScalar(this.maxDimension).multiplyScalar(-.5)),l.min.y=g,l.max.y=y,h.set(this.maxDimension,y-g,this.maxDimension)}o==="bottom"?f.y=l.min.y:f.z=l.min.y,this.setSoftness(i)}setSoftness(t){this.softness=t;const{size:i,camera:o}=this,l=this.isAnimated?2:1,h=l*Math.pow(2,9-3*t);this.setMapSize(h);const d=i.y/2,f=i.y*l;o.near=0,o.far=NU(f,d,t),this.depthMaterial.opacity=1/t,o.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(t){const{size:i}=this;this.isAnimated&&(t*=2);const o=Math.floor(i.x>i.z?t:t*i.x/i.z),l=Math.floor(i.x>i.z?t*i.z/i.x:t),h=10+o,d=10+l;if(this.renderTarget==null||this.renderTarget.width===h&&this.renderTarget.height===d||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),this.renderTarget==null){const f={format:fr};this.renderTarget=new go(h,d,f),this.renderTargetBlur=new go(h,d,f),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(i.x*(1+10/o),i.z*(1+10/l),1),this.needsUpdate=!0}setIntensity(t){this.intensity=t,t>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=t*NU(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(t){this.floor.position.z=-t+this.gap()}gap(){return .001*this.maxDimension}render(t,i){i.overrideMaterial=this.depthMaterial;const o=t.getClearAlpha();t.setClearAlpha(0),this.floor.visible=!1;const l=t.xr.enabled;t.xr.enabled=!1;const h=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.render(i,this.camera),i.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(t),t.xr.enabled=l,t.setRenderTarget(h),t.setClearAlpha(o)}blurShadow(t){const{camera:i,horizontalBlurMaterial:o,verticalBlurMaterial:l,renderTarget:h,renderTargetBlur:d,blurPlane:f}=this;f.visible=!0,f.material=o,o.uniforms.h.value=1/this.renderTarget.width,o.uniforms.tDiffuse.value=this.renderTarget.texture,t.setRenderTarget(d),t.render(f,i),f.material=l,l.uniforms.v.value=1/this.renderTarget.height,l.uniforms.tDiffuse.value=this.renderTargetBlur.texture,t.setRenderTarget(h),t.render(f,i),f.visible=!1}dispose(){this.renderTarget!=null&&this.renderTarget.dispose(),this.renderTargetBlur!=null&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gM=new ve,FU=new ve,OU=new ve,QE=new class{constructor(p,t,i=0,o=1/0){this.ray=new Lm(p,t),this.near=i,this.far=o,this.camera=null,this.layers=new fw,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(p,t){this.ray.set(p,t)}setFromCamera(p,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(p.x,p.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(p.x,p.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(p){return d3.identity().extractRotation(p.matrixWorld),this.ray.origin.setFromMatrixPosition(p.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(d3),this}intersectObject(p,t=!0,i=[]){return Zw(p,this,i,t),i.sort(p3),i}intersectObjects(p,t=!0,i=[]){for(let o=0,l=p.length;o<l;o++)Zw(p[o],this,i,t);return i.sort(p3),i}},E7=new ve,Ag=new Hn;class x7 extends Oh{constructor({canvas:t,element:i,width:o,height:l}){super(),this.annotationRenderer=new R8,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.camera=new vs(45,1,.1,100),this.xrCamera=null,this.url=null,this.pivot=new $i,this.target=new $i,this.animationNames=[],this.boundingBox=new sa,this.boundingSphere=new vo,this.size=new ve,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.toneMapping=4,this.canScale=!0,this.isDirty=!1,this.goalTarget=new ve,this.targetDamperX=new ha,this.targetDamperY=new ha,this.targetDamperZ=new ha,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.groundedSkybox=new m7,this.name="ModelScene",this.element=i,this.canvas=t,this.camera=new vs(45,1,.1,100),this.camera.name="MainCamera",this.add(this.pivot),this.pivot.name="Pivot",this.pivot.add(this.target),this.setSize(o,l),this.target.name="Target",this.mixer=new yz(this.target);const{domElement:h}=this.annotationRenderer,{style:d}=h;d.display="none",d.pointerEvents="none",d.position="absolute",d.top="0",this.element.shadowRoot.querySelector(".default").appendChild(h),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return this.xrCamera!=null?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(t){this.reset(),this._model=t,this.target.add(t),await this.setupScene()}async setSource(t,i=()=>{}){if(!t||t===this.url)return void i(1);if(this.reset(),this.url=t,this.externalRenderer!=null){const f=await this.externalRenderer.load(i);return this.boundingSphere.radius=f.framedRadius,void(this.idealAspect=f.fieldOfViewAspect)}let o;this.cancelPendingSourceChange!=null&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{o=await new Promise(async(f,g)=>{this.cancelPendingSourceChange=()=>g();try{f(await this.element[ji].loader.load(t,this.element,i))}catch(y){g(y)}})}catch(f){if(f==null)return;throw f}this.cancelPendingSourceChange=null,this.reset(),this.url=t,this._currentGLTF=o,o!=null&&(this._model=o.scene,this.target.add(o.scene));const{animations:l}=o,h=new Map,d=[];for(const f of l)h.set(f.name,f),d.push(f.name);this.animations=l,this.animationsByName=h,this.animationNames=d,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.setGroundedSkybox()}reset(){this.url=null,this.renderCount=0,this.queueRender(),this.shadow!=null&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:t}=this;t!=null&&(t.removeFromParent(),this._model=null);const i=this._currentGLTF;i!=null&&(i.dispose(),this._currentGLTF=null),this.currentAnimationAction!=null&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),this.shadow!=null&&(this.shadow.dispose(),this.shadow=null),this.element[NE]=null,this.element[FE]=null,this.element[Td]=null}get currentGLTF(){return this._currentGLTF}setSize(t,i){if(this.width!==t||this.height!==i){if(this.width=Math.max(t,1),this.height=Math.max(i,1),this.annotationRenderer.setSize(t,i),this.aspect=this.width/this.height,this.externalRenderer!=null){const o=window.devicePixelRatio;this.externalRenderer.resize(t*o,i*o)}this.queueRender()}}markBakedShadow(t){t.userData.noHit=!0,this.bakedShadows.add(t)}unmarkBakedShadow(t){t.userData.noHit=!1,t.visible=!0,this.bakedShadows.delete(t),this.boundingBox.expandByObject(t)}findBakedShadows(t){const i=new sa;t.traverse(o=>{const l=o;if(!l.material||!l.material.transparent)return;i.setFromObject(l);const h=i.getSize(E7),d=Math.min(h.x,h.y,h.z);Math.max(h.x,h.y,h.z)<100*d||this.markBakedShadow(l)})}checkBakedShadows(){const{min:t,max:i}=this.boundingBox,o=new sa;this.boundingBox.getSize(this.size);for(const l of this.bakedShadows)o.setFromObject(l),o.min.y<t.y+this.size.y/100&&o.min.x<=t.x&&o.max.x>=i.x&&o.min.z<=t.z&&o.max.z>=i.z||o.min.z<t.z+this.size.z/100&&o.min.x<=t.x&&o.max.x>=i.x&&o.min.y<=t.y&&o.max.y>=i.y||this.unmarkBakedShadow(l)}applyTransform(){const{model:t}=this;if(t==null)return;const i=kc(this.element.orientation)[0].terms,o=Dl(i[0]).number,l=Dl(i[1]).number,h=Dl(i[2]).number;t.quaternion.setFromEuler(new _o(l,h,o,"YXZ"));const d=kc(this.element.scale)[0].terms;t.scale.set(d[0].number,d[1].number,d[2].number)}updateBoundingBox(){const{model:t}=this;if(t==null)return;this.target.remove(t),this.findBakedShadows(t);const i=(o,l)=>o.expandByPoint(l);this.setBakedShadowVisibility(!1),this.boundingBox=AE(t,i,new sa),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach(o=>this.unmarkBakedShadow(o)),this.boundingBox=AE(t,i,new sa)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(t)}async updateFraming(){const{model:t}=this;if(t==null)return;this.target.remove(t),this.setBakedShadowVisibility(!1);const{center:i}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,i.copy(this.getTarget()),this.boundingSphere.radius=Math.sqrt(AE(t,(o,l)=>Math.max(o,i.distanceToSquared(l)),0)),this.idealAspect=AE(t,(o,l)=>{l.sub(i);const h=Math.sqrt(l.x*l.x+l.z*l.z);return Math.max(o,h/(this.idealCameraDistance()-Math.abs(l.y)))},0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(t)}setBakedShadowVisibility(t=this.shadowIntensity<=0){for(const i of this.bakedShadows)i.visible=t}idealCameraDistance(){const t=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(t)}adjustedFoV(t){const i=Math.tan(t/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(i)*180/Math.PI}getNDC(t,i){if(this.xrCamera!=null)Ag.set(t/window.screen.width,i/window.screen.height);else{const o=this.element.getBoundingClientRect();Ag.set((t-o.x)/this.width,(i-o.y)/this.height)}return Ag.multiplyScalar(2).subScalar(1),Ag.y*=-1,Ag}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(t,i){this.element[ji].arRenderer.presentedScene!==this&&(this.environment=t,this.setBackground(i),this.queueRender())}setBackground(t){this.groundedSkybox.map=t,this.groundedSkybox.isUsable()?(this.target.add(this.groundedSkybox),this.background=null):(this.target.remove(this.groundedSkybox),this.background=t)}farRadius(){return this.boundingSphere.radius*(this.groundedSkybox.parent!=null?10:1)}setGroundedSkybox(){const t=kc(this.element.skyboxHeight)[0].terms[0],i=Dl(t).number,o=10*this.boundingSphere.radius;this.groundedSkybox.updateGeometry(i,o),this.groundedSkybox.position.y=i-(this.shadow?2*this.shadow.gap():0),this.setBackground(this.groundedSkybox.map)}setTarget(t,i,o){this.goalTarget.set(-t,-i,-o)}setTargetDamperDecayTime(t){this.targetDamperX.setDecayTime(t),this.targetDamperY.setDecayTime(t),this.targetDamperZ.setDecayTime(t)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}getDynamicTarget(){return this.target.position.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(t){const i=this.goalTarget,o=this.target.position;if(i.equals(o))return!1;{const l=this.boundingSphere.radius/10;let{x:h,y:d,z:f}=o;return h=this.targetDamperX.update(h,i.x,t,l),d=this.targetDamperY.update(d,i.y,t,l),f=this.targetDamperZ.update(f,i.z,t,l),this.groundedSkybox.position.x=-h,this.groundedSkybox.position.z=-f,this.target.position.set(h,d,f),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(t,i){const{x:o,z:l}=this.position;this.yaw=Math.atan2(t-o,i-l)}get model(){return this._model}set yaw(t){this.pivot.rotation.y=t,this.groundedSkybox.rotation.y=-t,this.queueRender()}get yaw(){return this.pivot.rotation.y}set animationTime(t){this.mixer.setTime(t),this.queueShadowRender()}get animationTime(){if(this.currentAnimationAction!=null){const t=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop!==tw||1&~t?this.currentAnimationAction.time:this.duration-this.currentAnimationAction.time}return 0}set animationTimeScale(t){this.mixer.timeScale=t}get animationTimeScale(){return this.mixer.timeScale}get duration(){return this.currentAnimationAction!=null&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return this.currentAnimationAction!=null}playAnimation(t=null,i=0,o=2201,l=1/0){if(this._currentGLTF==null)return;const{animations:h}=this;if(h==null||h.length===0)return;let d=null;if(t!=null&&(d=this.animationsByName.get(t),d==null)){const f=parseInt(t);!isNaN(f)&&f>=0&&f<h.length&&(d=h[f])}d==null&&(d=h[0]);try{const{currentAnimationAction:f}=this,g=this.mixer.clipAction(d,this);this.currentAnimationAction=g,this.element.paused?this.mixer.stopAllAction():(g.paused=!1,f!=null&&g!==f?g.crossFadeFrom(f,i,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),g.setLoop(o,l),g.enabled=!0,g.clampWhenFinished=!0,g.play()}catch(f){console.error(f)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(t){this.mixer.update(t),this.queueShadowRender()}subscribeMixerEvent(t,i){this.mixer.addEventListener(t,i)}updateShadow(){const t=this.shadow;if(t!=null){const i=this.element.arPlacement==="wall"?"back":"bottom";t.setScene(this,this.shadowSoftness,i),t.needsUpdate=!0}}renderShadow(t){const i=this.shadow;i!=null&&i.needsUpdate==1&&(i.render(t,this),i.needsUpdate=!1)}queueShadowRender(){this.shadow!=null&&(this.shadow.needsUpdate=!0)}setShadowIntensity(t){if(this.shadowIntensity=t,this._currentGLTF!=null&&(this.setBakedShadowVisibility(),!(t<=0&&this.shadow==null))){if(this.shadow==null){const i=this.element.arPlacement==="wall"?"back":"bottom";this.shadow=new y7(this,this.shadowSoftness,i)}this.shadow.setIntensity(t)}}setShadowSoftness(t){this.shadowSoftness=t;const i=this.shadow;i?.setSoftness(t)}setShadowOffset(t){const i=this.shadow;i?.setOffset(t)}getHit(t=this){return QE.intersectObject(t,!0).find(i=>i.object.visible&&!i.object.userData.noHit)}hitFromController(t,i=this){return QE.setFromXRController(t),this.getHit(i)}hitFromPoint(t,i=this){return QE.setFromCamera(t,this.getCamera()),this.getHit(i)}positionAndNormalFromPoint(t,i=this){var o;const l=this.hitFromPoint(t,i);return l==null?null:{position:l.point,normal:l.face!=null?l.face.normal.clone().applyNormalMatrix(new zn().getNormalMatrix(l.object.matrixWorld)):QE.ray.direction.clone().multiplyScalar(-1),uv:(o=l.uv)!==null&&o!==void 0?o:null}}surfaceFromPoint(t,i=this){const o=this.element.model;if(o==null)return null;const l=this.hitFromPoint(t,i);if(l==null||l.face==null)return null;const h=o[hM](l),{meshes:d,primitives:f}=h.mesh.userData.associations,g=new ve,y=new ve,x=new ve,{a:b,b:_,c:w}=l.face,T=l.object;T.getVertexPosition(b,g),T.getVertexPosition(_,y),T.getVertexPosition(w,x);const P=new Ja(g,y,x),U=new ve;return P.getBarycoord(T.worldToLocal(l.point),U),`${d} ${f} ${b} ${_} ${w} ${U.x.toFixed(3)} ${U.y.toFixed(3)} ${U.z.toFixed(3)}`}addHotspot(t){this.target.add(t),this.annotationRenderer.domElement.appendChild(t.element),this.updateSurfaceHotspot(t)}removeHotspot(t){this.target.remove(t)}forHotspots(t){const{children:i}=this.target;for(let o=0,l=i.length;o<l;o++){const h=i[o];h instanceof UU&&t(h)}}updateSurfaceHotspot(t){if(t.surface==null||this.element.model==null)return;const i=kc(t.surface)[0].terms;if(i.length!=8)return void console.warn(t.surface+" does not have exactly 8 numbers.");const o=this.element.model[RU](i[0].number,i[1].number);if(o==null)return void console.warn(t.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const l=o.mesh.geometry.attributes.position.count,h=new ve(i[2].number,i[3].number,i[4].number);if(h.x>=l||h.y>=l||h.z>=l)return void console.warn(t.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const d=new ve(i[5].number,i[6].number,i[7].number);t.mesh=o.mesh,t.tri=h,t.bary=d,t.updateSurface()}animateSurfaceHotspots(){this.element.paused||this.forHotspots(t=>{t.updateSurface()})}updateHotspotsVisibility(t){this.forHotspots(i=>{gM.copy(t),FU.setFromMatrixPosition(i.matrixWorld),gM.sub(FU),OU.copy(i.normal).transformDirection(this.target.matrixWorld),gM.dot(OU)<0?i.hide():i.show()})}orientHotspots(t){this.forHotspots(i=>{i.orient(t)})}setHotspotsVisibility(t){this.forHotspots(i=>{i.visible=t})}updateSchema(t){var i;const{schemaElement:o,element:l}=this,{alt:h,poster:d,iosSrc:f}=l;if(t!=null){const g=[{"@type":"MediaObject",contentUrl:t,encodingFormat:((i=t.split(".").pop())===null||i===void 0?void 0:i.toLowerCase())==="gltf"?"model/gltf+json":"model/gltf-binary"}];f&&g.push({"@type":"MediaObject",contentUrl:f,encodingFormat:"model/vnd.usdz+zip"});const y={"@context":"http://schema.org/","@type":"3DModel",image:d??void 0,name:h??void 0,encoding:g};o.textContent=JSON.stringify(y),document.head.appendChild(o)}else o.parentElement!=null&&o.parentElement.removeChild(o)}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _7 extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(t){const i={progress:0,completed:!1};return this.ongoingActivities.add(i),this.ongoingActivityCount===1&&this.announceTotalProgress(i,0,t),o=>{let l;return l=Math.max(Ll(o,0,1),i.progress),l!==i.progress&&this.announceTotalProgress(i,l,t),i.progress}}announceTotalProgress(t,i,o){let l=0,h=0;i==1&&(t.completed=!0);for(const g of this.ongoingActivities){const{progress:y}=g;l+=1-y,g.completed&&h++}const d=t.progress;t.progress=i,this.totalProgress+=(i-d)*(1-this.totalProgress)/l;const f=h===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:f,reason:o}})),h===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var kU,QU,GU,HU,zU,VU,WU,jU,qU,XU,YU,KU,JU,GE=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const qh=document.createElement("canvas"),vM=Symbol("fallbackResizeHandler"),$U=Symbol("defaultAriaLabel"),HE=Symbol("resizeObserver"),OA=Symbol("clearModelTimeout"),yM=Symbol("onContextLost"),kA=Symbol("loaded"),EM=Symbol("status"),xM=Symbol("onFocus"),_M=Symbol("onBlur"),QA=Symbol("updateSize"),zE=Symbol("intersectionObserver"),Bd=Symbol("isElementInViewport"),VE=Symbol("announceModelVisibility"),GA=Symbol("ariaLabel"),bM=Symbol("altDefaulted"),fg=Symbol("statusElement"),WE=Symbol("updateStatus"),mg=Symbol("loadedTime"),HA=Symbol("updateSource"),ZU=Symbol("markLoaded"),jE=Symbol("container"),il=Symbol("input"),CM=Symbol("canvas"),Ut=Symbol("scene"),zs=Symbol("needsRender"),Ul=Symbol("tick"),Nl=Symbol("onModelLoad"),qE=Symbol("onResize"),ji=Symbol("renderer"),Rd=Symbol("progressTracker"),eN=Symbol("getLoaded"),Ld=Symbol("getModelIsVisible"),zA=Symbol("shouldAttemptPreload"),Xh=p=>({x:p.x,y:p.y,z:p.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),wM=p=>({u:p.x,v:p.y,toString(){return`${this.u} ${this.v}`}});class gg extends xd{constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[kU]=!1,this[QU]=!1,this[GU]=0,this[HU]="",this[zU]=null,this[VU]=j3(()=>{const l=this.getBoundingClientRect();this[QA](l)},50),this[WU]=j3(l=>{const h=this.modelIsVisible;h!==l&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:h}}))},0),this[jU]=null,this[qU]=null,this[XU]=new _7,this[YU]=()=>{this[fg].textContent=this[EM]},this[KU]=()=>{this[fg].textContent=""},this[JU]=l=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:l.sourceEvent}}))},this.attachShadow({mode:"open"});const t=this.shadowRoot;let i,o;if((l=>{R3(Oz,l)})(t),this[jE]=t.querySelector(".container"),this[il]=t.querySelector(".userInput"),this[CM]=t.querySelector("canvas"),this[fg]=t.querySelector("#status"),this[$U]=this[il].getAttribute("aria-label"),this.isConnected){const l=this.getBoundingClientRect();i=l.width,o=l.height}else i=300,o=150;this[Ut]=new x7({canvas:this[CM],element:this,width:i,height:o}),Promise.resolve().then(()=>{this[QA](this.getBoundingClientRect())}),f1&&(this[HE]=new ResizeObserver(l=>{if(!this[ji].isPresenting)for(let h of l)h.target===this&&this[QA](h.contentRect)})),m1?this[zE]=new IntersectionObserver(l=>{for(let h of l)if(h.target===this){const d=this.modelIsVisible;this[Bd]=h.isIntersecting,this[VE](d),this[Bd]&&!this.loaded&&this[HA]()}},{root:null,rootMargin:"0px",threshold:1e-5}):this[Bd]=!0}static get is(){return"model-viewer"}static set modelCacheSize(t){ca[Hh].evictionThreshold=t}static get modelCacheSize(){return ca[Hh].evictionThreshold}static set minimumRenderScale(t){t>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),t<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),rl.singleton.minScale=t}static get minimumRenderScale(){return rl.singleton.minScale}get loaded(){return this[eN]()}get[(kU=Bd,QU=kA,GU=mg,HU=EM,zU=OA,VU=vM,WU=VE,jU=HE,qU=zE,XU=Rd,ji)](){return rl.singleton}get modelIsVisible(){return this[Ld]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),f1?this[HE].observe(this):self.addEventListener("resize",this[vM]),m1&&this[zE].observe(this),this.addEventListener("focus",this[xM]),this.addEventListener("blur",this[_M]);const t=this[ji];t.addEventListener("contextlost",this[yM]),t.registerScene(this[Ut]),this[OA]!=null&&(self.clearTimeout(this[OA]),this[OA]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),f1?this[HE].unobserve(this):self.removeEventListener("resize",this[vM]),m1&&this[zE].unobserve(this),this.removeEventListener("focus",this[xM]),this.removeEventListener("blur",this[_M]);const t=this[ji];t.removeEventListener("contextlost",this[yM]),t.unregisterScene(this[Ut]),this[OA]=self.setTimeout(()=>{this[Ut].dispose(),this[OA]=null},10)}updated(t){super.updated(t),t.has("src")&&(this.src==null?(this[kA]=!1,this[mg]=0,this[Ut].reset()):this.src!==this[Ut].url&&(this[kA]=!1,this[mg]=0,this[HA]())),t.has("alt")&&this[il].setAttribute("aria-label",this[GA]),t.has("generateSchema")&&(this.generateSchema?this[Ut].updateSchema(this.src):this[Ut].updateSchema(null))}toDataURL(t,i){return this[ji].displayCanvas(this[Ut]).toDataURL(t,i)}async toBlob(t){const i=t?t.mimeType:void 0,o=t?t.qualityArgument:void 0,l=t?t.idealAspect:void 0,{width:h,height:d,idealAspect:f,aspect:g}=this[Ut],{dpr:y,scaleFactor:x}=this[ji];let b=h*x*y,_=d*x*y,w=0,T=0;if(l===!0)if(f>g){const P=_;_=Math.round(b/f),T=(P-_)/2}else{const P=b;b=Math.round(_*f),w=(P-b)/2}qh.width=b,qh.height=_;try{return new Promise(async(P,U)=>{qh.getContext("2d").drawImage(this[ji].displayCanvas(this[Ut]),w,T,b,_,0,0,b,_),qh.toBlob(D=>{if(!D)return U(new Error("Unable to retrieve canvas blob"));P(D)},i,o)})}finally{this[QA]({width:h,height:d})}}registerEffectComposer(t){t.setRenderer(this[ji].threeRenderer),t.setMainCamera(this[Ut].getCamera()),t.setMainScene(this[Ut]),this[Ut].effectRenderer=t}unregisterEffectComposer(){this[Ut].effectRenderer=null}registerRenderer(t){this[Ut].externalRenderer=t}unregisterRenderer(){this[Ut].externalRenderer=null}get[GA](){return this[bM]}get[bM](){return this.alt==null||this.alt==="null"?this[$U]:this.alt}[eN](){return this[kA]}[Ld](){return this.loaded&&this[Bd]}[zA](){return!!this.src&&this[Bd]}[QA]({width:t,height:i}){t!==0&&i!==0&&(this[jE].style.width=`${t}px`,this[jE].style.height=`${i}px`,this[qE]({width:t,height:i}))}[Ul](t,i){var o;(o=this[Ut].effectRenderer)===null||o===void 0||o.beforeRender(t,i)}[ZU](){this[kA]||(this[kA]=!0,this[mg]=performance.now())}[zs](){this[Ut].queueRender()}[Nl](){}[WE](t){this[EM]=t;const i=this.getRootNode();i!=null&&i.activeElement===this&&this[fg].textContent!=t&&(this[fg].textContent=t)}[(YU=xM,KU=_M,qE)](t){this[Ut].setSize(t.width,t.height)}async[(JU=yM,HA)](){const t=this[Ut];if(this.loaded||!this[zA]()||this.src===t.url)return;this.generateSchema&&t.updateSchema(this.src),this[WE]("Loading"),t.stopAnimation();const i=this[Rd].beginActivity("model-load"),o=this.src;try{const l=t.setSource(o,d=>i(.95*Ll(d,0,1))),h=this[uE]();await Promise.all([l,h]),this[ZU](),this[Nl](),this.updateComplete.then(()=>{this.dispatchEvent(new CustomEvent("before-render"))}),await new Promise(d=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:o}})),d()})})})}catch(l){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:l}}))}finally{i(1)}}}GE([Cn({type:String})],gg.prototype,"alt",void 0),GE([Cn({type:String})],gg.prototype,"src",void 0),GE([Cn({type:Boolean,attribute:"with-credentials"})],gg.prototype,"withCredentials",void 0),GE([Cn({type:Boolean,attribute:"generate-schema"})],gg.prototype,"generateSchema",void 0);/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var MM=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const XE=Symbol("changeAnimation"),zc=Symbol("paused"),b7={repetitions:1/0,pingpong:!1},Dd=Symbol("hotspotMap"),SM=Symbol("mutationCallback"),vg=Symbol("observer"),IM=Symbol("addHotspot"),tN=Symbol("removeHotspot"),TM=new In;/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Ts=Uint8Array,Ka=Uint16Array,BM=Int32Array,RM=new Ts([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),LM=new Ts([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nN=new Ts([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iN=function(p,t){for(var i=new Ka(31),o=0;o<31;++o)i[o]=t+=1<<p[o-1];var l=new BM(i[30]);for(o=1;o<30;++o)for(var h=i[o];h<i[o+1];++h)l[h]=h-i[o]<<5|o;return{b:i,r:l}},rN=iN(RM,2),C7=rN.b,DM=rN.r;C7[28]=258,DM[258]=28;for(var sN=iN(LM,0).r,PM=new Ka(32768),lr=0;lr<32768;++lr){var Pd=(43690&lr)>>1|(21845&lr)<<1;Pd=(61680&(Pd=(52428&Pd)>>2|(13107&Pd)<<2))>>4|(3855&Pd)<<4,PM[lr]=((65280&Pd)>>8|(255&Pd)<<8)>>1}var yg=function(p,t,i){for(var o=p.length,l=0,h=new Ka(t);l<o;++l)p[l]&&++h[p[l]-1];var d,f=new Ka(t);for(l=1;l<t;++l)f[l]=f[l-1]+h[l-1]<<1;if(i){d=new Ka(1<<t);var g=15-t;for(l=0;l<o;++l)if(p[l])for(var y=l<<4|p[l],x=t-p[l],b=f[p[l]-1]++<<x,_=b|(1<<x)-1;b<=_;++b)d[PM[b]>>g]=y}else for(d=new Ka(o),l=0;l<o;++l)p[l]&&(d[l]=PM[f[p[l]-1]++]>>15-p[l]);return d},Ud=new Ts(288);for(lr=0;lr<144;++lr)Ud[lr]=8;for(lr=144;lr<256;++lr)Ud[lr]=9;for(lr=256;lr<280;++lr)Ud[lr]=7;for(lr=280;lr<288;++lr)Ud[lr]=8;var YE=new Ts(32);for(lr=0;lr<32;++lr)YE[lr]=5;var w7=yg(Ud,9,0),M7=yg(YE,5,0),aN=function(p){return(p+7)/8|0},oN=function(p,t,i){return(t==null||t<0)&&(t=0),(i==null||i>p.length)&&(i=p.length),new Ts(p.subarray(t,i))},S7=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],KE=function(p,t,i){var o=new Error(t||S7[p]);if(o.code=p,Error.captureStackTrace&&Error.captureStackTrace(o,KE),!i)throw o;return o},Vc=function(p,t,i){i<<=7&t;var o=t/8|0;p[o]|=i,p[o+1]|=i>>8},Eg=function(p,t,i){i<<=7&t;var o=t/8|0;p[o]|=i,p[o+1]|=i>>8,p[o+2]|=i>>16},UM=function(p,t){for(var i=[],o=0;o<p.length;++o)p[o]&&i.push({s:o,f:p[o]});var l=i.length,h=i.slice();if(!l)return{t:uN,l:0};if(l==1){var d=new Ts(i[0].s+1);return d[i[0].s]=1,{t:d,l:1}}i.sort(function(Y,q){return Y.f-q.f}),i.push({s:-1,f:25001});var f=i[0],g=i[1],y=0,x=1,b=2;for(i[0]={s:-1,f:f.f+g.f,l:f,r:g};x!=l-1;)f=i[i[y].f<i[b].f?y++:b++],g=i[y!=x&&i[y].f<i[b].f?y++:b++],i[x++]={s:-1,f:f.f+g.f,l:f,r:g};var _=h[0].s;for(o=1;o<l;++o)h[o].s>_&&(_=h[o].s);var w=new Ka(_+1),T=NM(i[x-1],w,0);if(T>t){o=0;var P=0,U=T-t,D=1<<U;for(h.sort(function(Y,q){return w[q.s]-w[Y.s]||Y.f-q.f});o<l;++o){var z=h[o].s;if(!(w[z]>t))break;P+=D-(1<<T-w[z]),w[z]=t}for(P>>=U;P>0;){var G=h[o].s;w[G]<t?P-=1<<t-w[G]++-1:++o}for(;o>=0&&P;--o){var Q=h[o].s;w[Q]==t&&(--w[Q],++P)}T=t}return{t:new Ts(w),l:T}},NM=function(p,t,i){return p.s==-1?Math.max(NM(p.l,t,i+1),NM(p.r,t,i+1)):t[p.s]=i},lN=function(p){for(var t=p.length;t&&!p[--t];);for(var i=new Ka(++t),o=0,l=p[0],h=1,d=function(g){i[o++]=g},f=1;f<=t;++f)if(p[f]==l&&f!=t)++h;else{if(!l&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(l),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(l);h=1,l=p[f]}return{c:i.subarray(0,o),n:t}},xg=function(p,t){for(var i=0,o=0;o<t.length;++o)i+=p[o]*t[o];return i},cN=function(p,t,i){var o=i.length,l=aN(t+2);p[l]=255&o,p[l+1]=o>>8,p[l+2]=255^p[l],p[l+3]=255^p[l+1];for(var h=0;h<o;++h)p[l+h+4]=i[h];return 8*(l+4+o)},hN=function(p,t,i,o,l,h,d,f,g,y,x){Vc(t,x++,i),++l[256];for(var b=UM(l,15),_=b.t,w=b.l,T=UM(h,15),P=T.t,U=T.l,D=lN(_),z=D.c,G=D.n,Q=lN(P),Y=Q.c,q=Q.n,K=new Ka(19),ne=0;ne<z.length;++ne)++K[31&z[ne]];for(ne=0;ne<Y.length;++ne)++K[31&Y[ne]];for(var le=UM(K,7),fe=le.t,be=le.l,de=19;de>4&&!fe[nN[de-1]];--de);var Fe,we,Me,_e,tt=y+5<<3,me=xg(l,Ud)+xg(h,YE)+d,wt=xg(l,_)+xg(h,P)+d+14+3*de+xg(K,fe)+2*K[16]+3*K[17]+7*K[18];if(g>=0&&tt<=me&&tt<=wt)return cN(t,x,p.subarray(g,g+y));if(Vc(t,x,1+(wt<me)),x+=2,wt<me){Fe=yg(_,w,0),we=_,Me=yg(P,U,0),_e=P;var ft=yg(fe,be,0);for(Vc(t,x,G-257),Vc(t,x+5,q-1),Vc(t,x+10,de-4),x+=14,ne=0;ne<de;++ne)Vc(t,x+3*ne,fe[nN[ne]]);x+=3*de;for(var ze=[z,Y],$e=0;$e<2;++$e){var pt=ze[$e];for(ne=0;ne<pt.length;++ne){var lt=31&pt[ne];Vc(t,x,ft[lt]),x+=fe[lt],lt>15&&(Vc(t,x,pt[ne]>>5&127),x+=pt[ne]>>12)}}}else Fe=w7,we=Ud,Me=M7,_e=YE;for(ne=0;ne<f;++ne){var he=o[ne];if(he>255){Eg(t,x,Fe[(lt=he>>18&31)+257]),x+=we[lt+257],lt>7&&(Vc(t,x,he>>23&31),x+=RM[lt]);var Z=31&he;Eg(t,x,Me[Z]),x+=_e[Z],Z>3&&(Eg(t,x,he>>5&8191),x+=LM[Z])}else Eg(t,x,Fe[he]),x+=we[he]}return Eg(t,x,Fe[256]),x+we[256]},I7=new BM([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),uN=new Ts(0),T7=function(){for(var p=new Int32Array(256),t=0;t<256;++t){for(var i=t,o=9;--o;)i=(1&i&&-306674912)^i>>>1;p[t]=i}return p}(),B7=function(){var p=-1;return{p:function(t){for(var i=p,o=0;o<t.length;++o)i=T7[255&i^t[o]]^i>>>8;p=i},d:function(){return~p}}},R7=function(p,t,i,o,l){if(!l&&(l={l:1},t.dictionary)){var h=t.dictionary.subarray(-32768),d=new Ts(h.length+p.length);d.set(h),d.set(p,h.length),p=d,l.w=h.length}return function(f,g,y,x,b,_){var w=_.z||f.length,T=new Ts(x+w+5*(1+Math.ceil(w/7e3))+b),P=T.subarray(x,T.length-b),U=_.l,D=7&(_.r||0);if(g){D&&(P[0]=_.r>>3);for(var z=I7[g-1],G=z>>13,Q=8191&z,Y=(1<<y)-1,q=_.p||new Ka(32768),K=_.h||new Ka(Y+1),ne=Math.ceil(y/3),le=2*ne,fe=function(Nt){return(f[Nt]^f[Nt+1]<<ne^f[Nt+2]<<le)&Y},be=new BM(25e3),de=new Ka(288),Fe=new Ka(32),we=0,Me=0,_e=_.i||0,tt=0,me=_.w||0,wt=0;_e+2<w;++_e){var ft=fe(_e),ze=32767&_e,$e=K[ft];if(q[ze]=$e,K[ft]=ze,me<=_e){var pt=w-_e;if((we>7e3||tt>24576)&&(pt>423||!U)){D=hN(f,P,0,be,de,Fe,Me,tt,wt,_e-wt,D),tt=we=Me=0,wt=_e;for(var lt=0;lt<286;++lt)de[lt]=0;for(lt=0;lt<30;++lt)Fe[lt]=0}var he=2,Z=0,Ce=Q,Qe=ze-$e&32767;if(pt>2&&ft==fe(_e-Qe))for(var Pe=Math.min(G,pt)-1,je=Math.min(32767,_e),pe=Math.min(258,pt);Qe<=je&&--Ce&&ze!=$e;){if(f[_e+he]==f[_e+he-Qe]){for(var Ve=0;Ve<pe&&f[_e+Ve]==f[_e+Ve-Qe];++Ve);if(Ve>he){if(he=Ve,Z=Qe,Ve>Pe)break;var Ye=Math.min(Qe,Ve-2),Ct=0;for(lt=0;lt<Ye;++lt){var Ke=_e-Qe+lt&32767,yt=Ke-q[Ke]&32767;yt>Ct&&(Ct=yt,$e=Ke)}}}Qe+=(ze=$e)-($e=q[ze])&32767}if(Z){be[tt++]=268435456|DM[he]<<18|sN[Z];var bt=31&DM[he],ht=31&sN[Z];Me+=RM[bt]+LM[ht],++de[257+bt],++Fe[ht],me=_e+he,++we}else be[tt++]=f[_e],++de[f[_e]]}}for(_e=Math.max(_e,me);_e<w;++_e)be[tt++]=f[_e],++de[f[_e]];D=hN(f,P,U,be,de,Fe,Me,tt,wt,_e-wt,D),U||(_.r=7&D|P[D/8|0]<<3,D-=7,_.h=K,_.p=q,_.i=_e,_.w=me)}else{for(_e=_.w||0;_e<w+U;_e+=65535){var Vt=_e+65535;Vt>=w&&(P[D/8|0]=U,Vt=w),D=cN(P,D+1,f.subarray(_e,Vt))}_.i=w}return oN(T,0,x+aN(D)+b)}(p,t.level==null?6:t.level,t.mem==null?l.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(p.length)))):20:12+t.mem,i,o,l)},dN=function(p,t){var i={};for(var o in p)i[o]=p[o];for(var o in t)i[o]=t[o];return i},Bs=function(p,t,i){for(;i;++t)p[t]=i,i>>>=8};function L7(p,t){return R7(p,t||{},0,0)}var pN=function(p,t,i,o){for(var l in p){var h=p[l],d=t+l,f=o;Array.isArray(h)&&(f=dN(o,h[1]),h=h[0]),h instanceof Ts?i[d]=[h,f]:(i[d+="/"]=[new Ts(0),f],pN(h,d,i,o))}},AN=typeof TextEncoder<"u"&&new TextEncoder,D7=typeof TextDecoder<"u"&&new TextDecoder;try{D7.decode(uN,{stream:!0})}catch{}function JE(p,t){if(t){for(var i=new Ts(p.length),o=0;o<p.length;++o)i[o]=p.charCodeAt(o);return i}if(AN)return AN.encode(p);var l=p.length,h=new Ts(p.length+(p.length>>1)),d=0,f=function(x){h[d++]=x};for(o=0;o<l;++o){if(d+5>h.length){var g=new Ts(d+8+(l-o<<1));g.set(h),h=g}var y=p.charCodeAt(o);y<128||t?f(y):y<2048?(f(192|y>>6),f(128|63&y)):y>55295&&y<57344?(f(240|(y=65536+(1047552&y)|1023&p.charCodeAt(++o))>>18),f(128|y>>12&63),f(128|y>>6&63),f(128|63&y)):(f(224|y>>12),f(128|y>>6&63),f(128|63&y))}return oN(h,0,d)}var FM=function(p){var t=0;if(p)for(var i in p){var o=p[i].length;o>65535&&KE(9),t+=o+4}return t},fN=function(p,t,i,o,l,h,d,f){var g=o.length,y=i.extra,x=f&&f.length,b=FM(y);Bs(p,t,d!=null?33639248:67324752),t+=4,d!=null&&(p[t++]=20,p[t++]=i.os),p[t]=20,t+=2,p[t++]=i.flag<<1|(h<0&&8),p[t++]=l&&8,p[t++]=255&i.compression,p[t++]=i.compression>>8;var _=new Date(i.mtime==null?Date.now():i.mtime),w=_.getFullYear()-1980;if((w<0||w>119)&&KE(10),Bs(p,t,w<<25|_.getMonth()+1<<21|_.getDate()<<16|_.getHours()<<11|_.getMinutes()<<5|_.getSeconds()>>1),t+=4,h!=-1&&(Bs(p,t,i.crc),Bs(p,t+4,h<0?-h-2:h),Bs(p,t+8,i.size)),Bs(p,t+12,g),Bs(p,t+14,b),t+=16,d!=null&&(Bs(p,t,x),Bs(p,t+6,i.attrs),Bs(p,t+10,d),t+=14),p.set(o,t),t+=g,b)for(var T in y){var P=y[T],U=P.length;Bs(p,t,+T),Bs(p,t+2,U),p.set(P,t+4),t+=4+U}return x&&(p.set(f,t),t+=x),t};function P7(p,t){t||(t={});var i={},o=[];pN(p,"",i,t);var l=0,h=0;for(var d in i){var f=i[d],g=f[0],y=f[1],x=y.level==0?0:8,b=(K=JE(d)).length,_=y.comment,w=_&&JE(_),T=w&&w.length,P=FM(y.extra);b>65535&&KE(11);var U=x?L7(g,y):g,D=U.length,z=B7();z.p(g),o.push(dN(y,{size:g.length,crc:z.d(),c:U,f:K,m:w,u:b!=d.length||w&&_.length!=T,o:l,compression:x})),l+=30+b+P+D,h+=76+2*(b+P)+(T||0)+D}for(var G=new Ts(h+22),Q=l,Y=h-l,q=0;q<o.length;++q){var K=o[q];fN(G,K.o,K,K.f,K.u,K.c.length);var ne=30+K.f.length+FM(K.extra);G.set(K.c,K.o+ne),fN(G,l,K,K.f,K.u,K.c.length,K.o,K.m),l+=16+ne+(K.m?K.m.length:0)}return function(le,fe,be,de,Fe){Bs(le,fe,101010256),Bs(le,fe+8,be),Bs(le,fe+10,be),Bs(le,fe+12,de),Bs(le,fe+16,Fe)}(G,l,o.length,Y,Q),G}class U7{parse(t,i,o,l){this.parseAsync(t,l).then(i).catch(o)}async parseAsync(t,i={}){i=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},i);const o={},l="model.usda";o[l]=null;let h=mN();h+=function(y){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{${y.includeAnchoringProperties===!0?`
		token preliminary:anchoring:type = "${y.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${y.ar.planeAnchoring.alignment}"
	`:""}
`}(i);const d={},f={};t.traverseVisible(y=>{if(y.isMesh){const x=y.geometry,b=y.material;if(b.isMeshStandardMaterial){const _="geometries/Geometry_"+x.id+".usda";if(!(_ in o)){const w=function(T){return`
def "Geometry"
{
${function(U){const D="Geometry",z=U.attributes,G=z.position.count;return`
	def Mesh "${D}"
	{
		int[] faceVertexCounts = [${function(Q){const Y=Q.index!==null?Q.index.count:Q.attributes.position.count;return Array(Y/3).fill(3).join(", ")}(U)}]
		int[] faceVertexIndices = [${function(Q){const Y=Q.index,q=[];if(Y!==null)for(let K=0;K<Y.count;K++)q.push(Y.getX(K));else{const K=Q.attributes.position.count;for(let ne=0;ne<K;ne++)q.push(ne)}return q.join(", ")}(U)}]
		normal3f[] normals = [${OM(z.normal,G)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${OM(z.position,G)}]
${function(Q){let Y="";for(let K=0;K<4;K++){const ne=K>0?K:"",le=Q["uv"+ne];le!==void 0&&(Y+=`
		texCoord2f[] primvars:st${ne} = [${F7(le)}] (
			interpolation = "vertex"
		)`)}const q=Q.color;return q!==void 0&&(Y+=`
	color3f[] primvars:displayColor = [${OM(q,q.count)}] (
		interpolation = "vertex"
		)`),Y}(z)}
		uniform token subdivisionScheme = "none"
	}
`}(T)}
}
`}(x);o[_]=function(T){let P=mN();return P+=T,JE(P)}(w)}b.uuid in d||(d[b.uuid]=b),h+=function(w,T,P){const U="Object_"+w.id,D=gN(w.matrixWorld);return w.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",w),`def Xform "${U}" (
	prepend references = @./geometries/Geometry_${T.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${D}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${P.id}>
}

`}(y,x,b)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",y)}else y.isCamera&&(h+=function(x){const b=x.name?x.name:"Camera_"+x.id,_=gN(x.matrixWorld);return x.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",x),x.isOrthographicCamera?`def Camera "${b}"
		{
			matrix4d xformOp:transform = ${_}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${x.near.toPrecision(Vs)}, ${x.far.toPrecision(Vs)})
			float horizontalAperture = ${(10*(Math.abs(x.left)+Math.abs(x.right))).toPrecision(Vs)}
			float verticalAperture = ${(10*(Math.abs(x.top)+Math.abs(x.bottom))).toPrecision(Vs)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${b}"
		{
			matrix4d xformOp:transform = ${_}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${x.near.toPrecision(Vs)}, ${x.far.toPrecision(Vs)})
			float focalLength = ${x.getFocalLength().toPrecision(Vs)}
			float focusDistance = ${x.focus.toPrecision(Vs)}
			float horizontalAperture = ${x.getFilmWidth().toPrecision(Vs)}
			token projection = "perspective"
			float verticalAperture = ${x.getFilmHeight().toPrecision(Vs)}
		}
	
	`}(y))}),h+=`
		}
	}
}

`,h+=function(y,x,b=!1){const _=[];for(const w in y){const T=y[w];_.push(O7(T,x,b))}return`def "Materials"
{
${_.join("")}
}

`}(d,f,i.quickLookCompatible),o[l]=JE(h),h=null;for(const y in f){let x=f[y];x.isCompressedTexture===!0&&(x=mE(x));const b=N7(x.image,x.flipY,i.maxTextureSize),_=await new Promise(w=>b.toBlob(w,"image/png",1));o[`textures/Texture_${y}.png`]=new Uint8Array(await _.arrayBuffer())}let g=0;for(const y in o){const x=o[y];g+=34+y.length;const b=63&g;if(b!==4){const _=new Uint8Array(64-b);o[y]=[x,{extra:{12345:_}}]}g=x.length}return P7(o,{level:0})}}function N7(p,t,i){if(typeof HTMLImageElement<"u"&&p instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&p instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&p instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&p instanceof ImageBitmap){const o=i/Math.max(p.width,p.height),l=document.createElement("canvas");l.width=p.width*Math.min(1,o),l.height=p.height*Math.min(1,o);const h=l.getContext("2d");return t===!0&&(h.translate(0,l.height),h.scale(1,-1)),h.drawImage(p,0,0,l.width,l.height),l}throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const Vs=7;function mN(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function gN(p){const t=p.elements;return`( ${$E(t,0)}, ${$E(t,4)}, ${$E(t,8)}, ${$E(t,12)} )`}function $E(p,t){return`(${p[t+0]}, ${p[t+1]}, ${p[t+2]}, ${p[t+3]})`}function OM(p,t){if(p===void 0)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const i=[];for(let o=0;o<p.count;o++){const l=p.getX(o),h=p.getY(o),d=p.getZ(o);i.push(`(${l.toPrecision(Vs)}, ${h.toPrecision(Vs)}, ${d.toPrecision(Vs)})`)}return i.join(", ")}function F7(p){const t=[];for(let i=0;i<p.count;i++){const o=p.getX(i),l=p.getY(i);t.push(`(${o.toPrecision(Vs)}, ${1-l.toPrecision(Vs)})`)}return t.join(", ")}function O7(p,t,i=!1){const o="			",l=[],h=[];function d(f,g,y){const x=f.source.id+"_"+f.flipY;t[x]=f;const b=f.channel>0?"st"+f.channel:"st",_={1e3:"repeat",1001:"clamp",1002:"mirror"},w=f.repeat.clone(),T=f.offset.clone(),P=f.rotation,U=Math.sin(P),D=Math.cos(P);return T.y=1-T.y-w.y,i?(T.x=T.x/w.x,T.y=T.y/w.y,T.x+=U/w.x,T.y+=D-1):(T.x+=U*w.x,T.y+=(1-D)*w.y),`
		def Shader "PrimvarReader_${g}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${b}"
			float2 outputs:result
		}

		def Shader "Transform2d_${g}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${p.id}/PrimvarReader_${g}.outputs:result>
			float inputs:rotation = ${(P*(180/Math.PI)).toFixed(Vs)}
			float2 inputs:scale = ${yN(w)}
			float2 inputs:translation = ${yN(T)}
			float2 outputs:result
		}

		def Shader "Texture_${f.id}_${g}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${x}.png@
			float2 inputs:st.connect = </Materials/Material_${p.id}/Transform2d_${g}.outputs:result>
			${y!==void 0?"float4 inputs:scale = "+function(z){return`(${z.r}, ${z.g}, ${z.b}, 1.0)`}(y):""}
			token inputs:sourceColorSpace = "${f.colorSpace===Sc?"raw":"sRGB"}"
			token inputs:wrapS = "${_[f.wrapS]}"
			token inputs:wrapT = "${_[f.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${p.transparent||p.alphaTest>0?"float outputs:a":""}
		}`}return p.side===2&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",p),p.map!==null?(l.push(`${o}color3f inputs:diffuseColor.connect = </Materials/Material_${p.id}/Texture_${p.map.id}_diffuse.outputs:rgb>`),p.transparent?l.push(`${o}float inputs:opacity.connect = </Materials/Material_${p.id}/Texture_${p.map.id}_diffuse.outputs:a>`):p.alphaTest>0&&(l.push(`${o}float inputs:opacity.connect = </Materials/Material_${p.id}/Texture_${p.map.id}_diffuse.outputs:a>`),l.push(`${o}float inputs:opacityThreshold = ${p.alphaTest}`)),h.push(d(p.map,"diffuse",p.color))):l.push(`${o}color3f inputs:diffuseColor = ${vN(p.color)}`),p.emissiveMap!==null?(l.push(`${o}color3f inputs:emissiveColor.connect = </Materials/Material_${p.id}/Texture_${p.emissiveMap.id}_emissive.outputs:rgb>`),h.push(d(p.emissiveMap,"emissive",new fn(p.emissive.r*p.emissiveIntensity,p.emissive.g*p.emissiveIntensity,p.emissive.b*p.emissiveIntensity)))):p.emissive.getHex()>0&&l.push(`${o}color3f inputs:emissiveColor = ${vN(p.emissive)}`),p.normalMap!==null&&(l.push(`${o}normal3f inputs:normal.connect = </Materials/Material_${p.id}/Texture_${p.normalMap.id}_normal.outputs:rgb>`),h.push(d(p.normalMap,"normal"))),p.aoMap!==null&&(l.push(`${o}float inputs:occlusion.connect = </Materials/Material_${p.id}/Texture_${p.aoMap.id}_occlusion.outputs:r>`),h.push(d(p.aoMap,"occlusion",new fn(p.aoMapIntensity,p.aoMapIntensity,p.aoMapIntensity)))),p.roughnessMap!==null?(l.push(`${o}float inputs:roughness.connect = </Materials/Material_${p.id}/Texture_${p.roughnessMap.id}_roughness.outputs:g>`),h.push(d(p.roughnessMap,"roughness",new fn(p.roughness,p.roughness,p.roughness)))):l.push(`${o}float inputs:roughness = ${p.roughness}`),p.metalnessMap!==null?(l.push(`${o}float inputs:metallic.connect = </Materials/Material_${p.id}/Texture_${p.metalnessMap.id}_metallic.outputs:b>`),h.push(d(p.metalnessMap,"metallic",new fn(p.metalness,p.metalness,p.metalness)))):l.push(`${o}float inputs:metallic = ${p.metalness}`),p.alphaMap!==null?(l.push(`${o}float inputs:opacity.connect = </Materials/Material_${p.id}/Texture_${p.alphaMap.id}_opacity.outputs:r>`),l.push(`${o}float inputs:opacityThreshold = 0.0001`),h.push(d(p.alphaMap,"opacity"))):l.push(`${o}float inputs:opacity = ${p.opacity}`),p.isMeshPhysicalMaterial&&(p.clearcoatMap!==null?(l.push(`${o}float inputs:clearcoat.connect = </Materials/Material_${p.id}/Texture_${p.clearcoatMap.id}_clearcoat.outputs:r>`),h.push(d(p.clearcoatMap,"clearcoat",new fn(p.clearcoat,p.clearcoat,p.clearcoat)))):l.push(`${o}float inputs:clearcoat = ${p.clearcoat}`),p.clearcoatRoughnessMap!==null?(l.push(`${o}float inputs:clearcoatRoughness.connect = </Materials/Material_${p.id}/Texture_${p.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),h.push(d(p.clearcoatRoughnessMap,"clearcoatRoughness",new fn(p.clearcoatRoughness,p.clearcoatRoughness,p.clearcoatRoughness)))):l.push(`${o}float inputs:clearcoatRoughness = ${p.clearcoatRoughness}`),l.push(`${o}float inputs:ior = ${p.ior}`)),`
	def Material "Material_${p.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${l.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${p.id}/PreviewSurface.outputs:surface>

${h.join(`
`)}

	}
`}function vN(p){return`(${p.r}, ${p.g}, ${p.b})`}function yN(p){return`(${p.x}, ${p.y})`}/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var VA=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};let EN=!1,xN=!1;const _N="#model-viewer-no-ar-fallback",k7=(bN=["quick-look","scene-viewer","webxr","none"],p=>{try{const t=kc(p),i=(t.length?t[0].terms:[]).filter(o=>o&&o.type==="ident").map(o=>o.value).filter(o=>bN.indexOf(o)>-1);return new Set(i)}catch{}return new Set});var bN;const kM="quick-look",CN="scene-viewer",wN="webxr",_g="none",Wc=Symbol("arButtonContainer"),MN=Symbol("enterARWithWebXR"),SN=Symbol("openSceneViewer"),IN=Symbol("openIOSARQuickLook"),Q7=Symbol("canActivateAR"),ZE=Symbol("arMode"),QM=Symbol("arModes"),WA=Symbol("arAnchor"),ex=Symbol("preload"),tx=Symbol("onARButtonContainerClick"),GM=Symbol("onARStatus"),HM=Symbol("onARTracking"),zM=Symbol("onARTap"),bg=Symbol("selectARMode"),VM=Symbol("triggerLoad");/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var WM=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const jM="auto",G7="auto",H7="eager",jA=Symbol("defaultProgressBarElement"),qM=Symbol("posterContainerElement"),qA=Symbol("defaultPosterElement"),Cg=Symbol("shouldDismissPoster"),XM=Symbol("hidePoster"),nx=Symbol("modelIsRevealed"),YM=Symbol("updateProgressBar"),z7=Symbol("ariaLabelCallToAction"),KM=Symbol("onProgress");/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var JM=function(p,t,i,o){for(var l,h=arguments.length,d=h<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,i):o,f=p.length-1;f>=0;f--)(l=p[f])&&(d=(h<3?l(d):h>3?l(t,i,d):l(t,i))||d);return h>3&&d&&Object.defineProperty(t,i,d),d};const V7=Math.PI/32,W7={basis:[yE(Gs(V7,"rad"))],keywords:{auto:[null]}},XA=Symbol("autoRotateStartTime"),$M=Symbol("radiansPerSecond"),TN=Symbol("syncRotationRate"),ZM=Symbol("onCameraChange"),BN=(p=>{var t,i,o;class l extends p{constructor(){super(...arguments),this[t]=new Map,this[i]=d=>{d.forEach(f=>{f instanceof MutationRecord&&f.type!=="childList"||(f.addedNodes.forEach(g=>{this[IM](g)}),f.removedNodes.forEach(g=>{this[tN](g)}),this[zs]())})},this[o]=new MutationObserver(this[SM])}connectedCallback(){super.connectedCallback();for(let f=0;f<this.children.length;++f)this[IM](this.children[f]);const{ShadyDOM:d}=self;d==null?this[vg].observe(this,{childList:!0}):this[vg]=d.observeChildren(this,this[SM])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:d}=self;d==null?this[vg].disconnect():d.unobserveChildren(this[vg])}[(t=Dd,i=SM,o=vg,Nl)](){super[Nl]();const d=this[Ut];d.forHotspots(f=>{d.updateSurfaceHotspot(f)})}[Ul](d,f){super[Ul](d,f);const g=this[Ut],{annotationRenderer:y}=g,x=g.getCamera();g.shouldRender()&&(g.animateSurfaceHotspots(),g.updateHotspotsVisibility(x.position),y.domElement.style.display="",y.render(g,x))}updateHotspot(d){const f=this[Dd].get(d.name);f!=null&&(f.updatePosition(d.position),f.updateNormal(d.normal),f.surface=d.surface,this[Ut].updateSurfaceHotspot(f),this[zs]())}queryHotspot(d){const f=this[Dd].get(d);if(f==null)return null;const g=Xh(f.position),y=Xh(f.normal),x=f.facingCamera,b=this[Ut],_=b.getCamera(),w=new ve;w.setFromMatrixPosition(f.matrixWorld),w.project(_);const T=b.width/2,P=b.height/2;w.x=w.x*T+T,w.y=-w.y*P+P;const U=Xh(new ve(w.x,w.y,w.z));return Number.isFinite(U.x)&&Number.isFinite(U.y)?{position:g,normal:y,canvasPosition:U,facingCamera:x}:null}positionAndNormalFromPoint(d,f){const g=this[Ut],y=g.getNDC(d,f),x=g.positionAndNormalFromPoint(y);if(x==null)return null;TM.copy(g.target.matrixWorld).invert();const b=Xh(x.position.applyMatrix4(TM)),_=Xh(x.normal.transformDirection(TM));let w=null;return x.uv!=null&&(w=wM(x.uv)),{position:b,normal:_,uv:w}}surfaceFromPoint(d,f){const g=this[Ut],y=g.getNDC(d,f);return g.surfaceFromPoint(y)}[IM](d){if(!(d instanceof HTMLElement&&d.slot.indexOf("hotspot")===0))return;let f=this[Dd].get(d.slot);f!=null?f.increment():(f=new UU({name:d.slot,position:d.dataset.position,normal:d.dataset.normal,surface:d.dataset.surface}),this[Dd].set(d.slot,f),this[Ut].addHotspot(f)),this[Ut].queueRender()}[tN](d){if(!(d instanceof HTMLElement))return;const f=this[Dd].get(d.slot);f&&(f.decrement()&&(this[Ut].removeHotspot(f),this[Dd].delete(d.slot)),this[Ut].queueRender())}}return l})((p=>{var t,i,o;class l extends p{constructor(){super(...arguments),this[t]=void 0,this[i]=null,this[o]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Td]}get availableVariants(){return this.model?this.model[uM]():[]}get originalGltfJson(){return this[FE]}[(t=Td,i=NE,o=FE,AM)](){return()=>{this[zs]()}}[pg](d){return d.colorSpace=sr,d.wrapS=Sl,d.wrapT=Sl,new rU(this[AM](),d)}async createTexture(d,f="image/png"){const{textureUtils:g}=this[ji],y=await g.loadImage(d,this.withCredentials);return y.userData.mimeType=f,this[pg](y)}async createLottieTexture(d,f=1){const{textureUtils:g}=this[ji],y=await g.loadLottie(d,f,this.withCredentials);return this[pg](y)}createVideoTexture(d){const f=document.createElement("video");f.crossOrigin=this.withCredentials?"use-credentials":"anonymous",f.src=d,f.muted=!0,f.playsInline=!0,f.loop=!0,f.play();const g=new q6(f);return this[pg](g)}createCanvasTexture(){const d=document.createElement("canvas"),f=new jw(d);return this[pg](f)}async updated(d){if(super.updated(d),d.has("variantName")){const f=this[Rd].beginActivity("variant-update");f(.1);const g=this[Td],{variantName:y}=this;g!=null&&(await g[TU](y),this[zs](),this.dispatchEvent(new CustomEvent("variant-applied"))),f(1)}if(d.has("orientation")||d.has("scale")){if(!this.loaded)return;const f=this[Ut];f.applyTransform(),f.updateBoundingBox(),f.updateShadow(),this[ji].arRenderer.onUpdateScene(),this[zs]()}}[Nl](){super[Nl]();const{currentGLTF:d}=this[Ut];if(d!=null){const{correlatedSceneGraph:f}=d;f!=null&&d!==this[NE]&&(this[Td]=new f7(f,this[AM]()),this[FE]=JSON.parse(JSON.stringify(f.gltf))),"variants"in d.userData&&this.requestUpdate("variantName")}this[NE]=d}async exportScene(d){const f=this[Ut];return new Promise(async(g,y)=>{const x={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(x,d),x.animations=f.animations,x.truncateDrawRange=!0;const b=f.shadow;let _=!1;b!=null&&(_=b.visible,b.visible=!1),await this[Td][IU](),new N1().register(w=>new lV(w)).parse(f.model,w=>g(new Blob([x.binary?w:JSON.stringify(w)],{type:x.binary?"application/octet-stream":"application/json"})),()=>y("glTF export failed"),x),b!=null&&(b.visible=_)})}materialFromPoint(d,f){const g=this[Td];if(g==null)return null;const y=this[Ut],x=y.getNDC(d,f),b=y.hitFromPoint(x);return b==null||b.face==null?null:g[BU](b)}}return pM([Cn({type:String,attribute:"variant-name"})],l.prototype,"variantName",void 0),pM([Cn({type:String,attribute:"orientation"})],l.prototype,"orientation",void 0),pM([Cn({type:String,attribute:"scale"})],l.prototype,"scale",void 0),l})((p=>{var t,i,o;class l extends p{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[t]=performance.now(),this[i]=0,this[o]=d=>{this.autoRotate&&d.detail.source==="user-interaction"&&(this[XA]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[ZM]),this[XA]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[ZM]),this[XA]=performance.now()}updated(d){super.updated(d),d.has("autoRotate")&&(this[XA]=performance.now())}[(t=XA,i=$M,TN)](d){this[$M]=d[0]}[Ul](d,f){if(super[Ul](d,f),!this.autoRotate||!this[Ld]()||this[ji].isPresenting)return;const g=Math.min(f,d-this[XA]-this.autoRotateDelay);g>0&&(this[Ut].yaw=this.turntableRotation+this[$M]*g*.001)}get turntableRotation(){return this[Ut].yaw}resetTurntableRotation(d=0){this[Ut].yaw=d}}return o=ZM,JM([Cn({type:Boolean,attribute:"auto-rotate"})],l.prototype,"autoRotate",void 0),JM([Cn({type:Number,attribute:"auto-rotate-delay"})],l.prototype,"autoRotateDelay",void 0),JM([Vh({intrinsics:W7,updateHandler:TN}),Cn({type:String,attribute:"rotation-per-second"})],l.prototype,"rotationPerSecond",void 0),l})((p=>{var t,i,o;class l extends p{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this.toneMapping="auto",this.skyboxHeight="0",this[t]=null,this[i]=null,this[o]=null}updated(d){super.updated(d),d.has("shadowIntensity")&&(this[Ut].setShadowIntensity(.5*this.shadowIntensity),this[zs]()),d.has("shadowSoftness")&&(this[Ut].setShadowSoftness(this.shadowSoftness),this[zs]()),d.has("exposure")&&(this[Ut].exposure=this.exposure,this[zs]()),d.has("toneMapping")&&(this[Ut].toneMapping=this.toneMapping==="aces"?4:this.toneMapping==="agx"?6:7,this[zs]()),(d.has("environmentImage")||d.has("skyboxImage"))&&this[zA]()&&this[uE](),d.has("skyboxHeight")&&(this[Ut].setGroundedSkybox(),this[zs]())}hasBakedShadow(){return this[Ut].bakedShadows.size>0}async[(t=Km,i=hE,o=dE,uE)](){const{skyboxImage:d,environmentImage:f}=this;this[dE]!=null&&(this[dE](),this[dE]=null);const{textureUtils:g}=this[ji];if(g==null)return;const y=this[Rd].beginActivity("environment-update");try{const{environmentMap:x,skybox:b}=await g.generateEnvironmentMapAndSkybox(V3(d),f,_=>y(Ll(_,0,1)),this.withCredentials);this[Km]!==x&&(this[Km]=x,this.dispatchEvent(new CustomEvent("environment-change"))),this[hE]=b!=null?b.name===x.name?x:b:null,this[Ut].setEnvironmentAndSkybox(this[Km],this[hE])}catch(x){if(x instanceof Error)throw this[Ut].setEnvironmentAndSkybox(null,null),x}finally{y(1)}}}return _d([Cn({type:String,attribute:"environment-image"})],l.prototype,"environmentImage",void 0),_d([Cn({type:String,attribute:"skybox-image"})],l.prototype,"skyboxImage",void 0),_d([Cn({type:Number,attribute:"shadow-intensity"})],l.prototype,"shadowIntensity",void 0),_d([Cn({type:Number,attribute:"shadow-softness"})],l.prototype,"shadowSoftness",void 0),_d([Cn({type:Number})],l.prototype,"exposure",void 0),_d([Cn({type:String,attribute:"tone-mapping"})],l.prototype,"toneMapping",void 0),_d([Cn({type:String,attribute:"skybox-height"})],l.prototype,"skyboxHeight",void 0),l})((p=>{var t,i,o,l,h,d,f,g,y,x,b,_,w,T,P,U,D,z;class G extends p{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=dP,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=_E,this.interactionPromptStyle=pP,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=SV,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this.a11y=null,this[t]=this.shadowRoot.querySelector(".interaction-prompt"),this[i]=this.shadowRoot.querySelector("#prompt"),this[o]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[l]=this.shadowRoot.querySelector(".pan-target"),this[h]=0,this[d]=1/0,this[f]=!1,this[g]=!1,this[y]=Sr.AUTOMATIC,this[x]=new NV(this[Ut].camera,this[il],this[Ut]),this[b]=new tE,this[_]=!1,this[w]=!1,this[T]=!1,this[P]={},this[U]=()=>{const Y=this[Wi].changeSource;this[SE]=Y,Y===Sr.USER_INTERACTION&&(this[ME]=!0,this[wE]())},this[D]=()=>{this[gP](),this[zs]();const Y=this[Wi].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:Y}}))},this[z]=Y=>{this[jE].classList.toggle("pointer-tumbling",Y.type==="pointer-change-start")}}get inputSensitivity(){return this[Wi].inputSensitivity}set inputSensitivity(Y){this[Wi].inputSensitivity=Y}getCameraOrbit(){const{theta:Y,phi:q,radius:K}=this[$1];return{theta:Y,phi:q,radius:K,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return Xh(this[ji].isPresenting?this[ji].arRenderer.target:this[Ut].getDynamicTarget())}getFieldOfView(){return this[Wi].getFieldOfView()}getMinimumFieldOfView(){return this[Wi].options.minimumFieldOfView}getMaximumFieldOfView(){return this[Wi].options.maximumFieldOfView}getIdealAspect(){return this[Ut].idealAspect}jumpCameraToGoal(){this[rg]=!0,this.requestUpdate(rg,!1)}resetInteractionPrompt(){this[ig]=0,this[BA]=1/0,this[ME]=!1,this[wd]=this.interactionPrompt===_E&&this.cameraControls}zoom(Y){const q=new WheelEvent("wheel",{deltaY:-30*Y});this[il].dispatchEvent(q)}connectedCallback(){super.connectedCallback(),this[Wi].addEventListener("user-interaction",this[TA]),this[Wi].addEventListener("pointer-change-start",this[ng]),this[Wi].addEventListener("pointer-change-end",this[ng])}disconnectedCallback(){super.disconnectedCallback(),this[Wi].removeEventListener("user-interaction",this[TA]),this[Wi].removeEventListener("pointer-change-start",this[ng]),this[Wi].removeEventListener("pointer-change-end",this[ng])}updated(Y){super.updated(Y);const q=this[Wi],K=this[Ut];if(Y.has("cameraControls")&&(this.cameraControls?(q.enableInteraction(),this.interactionPrompt===_E&&(this[wd]=!0)):(q.disableInteraction(),this[wE]()),this[il].setAttribute("aria-label",this[GA])),Y.has("disableZoom")&&(q.disableZoom=this.disableZoom),Y.has("disablePan")&&(q.enablePan=!this.disablePan),Y.has("disableTap")&&(q.enableTap=!this.disableTap),(Y.has("interactionPrompt")||Y.has("cameraControls")||Y.has("src"))&&(this.interactionPrompt===_E&&this.cameraControls&&!this[ME]?this[wd]=!0:this[wE]()),Y.has("interactionPromptStyle")&&(this[CE].style.opacity=this.interactionPromptStyle==MV?"1":"0"),Y.has("touchAction")){const ne=this.touchAction;q.applyOptions({touchAction:ne}),q.updateTouchActionStyle()}Y.has("orbitSensitivity")&&(q.orbitSensitivity=this.orbitSensitivity),Y.has("zoomSensitivity")&&(q.zoomSensitivity=this.zoomSensitivity),Y.has("panSensitivity")&&(q.panSensitivity=this.panSensitivity),Y.has("interpolationDecay")&&(q.setDamperDecayTime(this.interpolationDecay),K.setTargetDamperDecayTime(this.interpolationDecay)),Y.has("a11y")&&this[vP](),this[rg]===!0&&Promise.resolve().then(()=>{q.jumpToGoal(),K.jumpToGoal(),this[J1](),this[rg]=!1})}async updateFraming(){const Y=this[Ut],q=Y.adjustedFoV(Y.framedFoVDeg);await Y.updateFraming();const K=Y.adjustedFoV(Y.framedFoVDeg),ne=this[Wi].getFieldOfView()/q;this[Wi].setFieldOfView(K*ne),this[sg]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(Y,q,K){const ne=this[il],le=this[K1];if(le[0].style.opacity==="1")return void console.warn("interact() failed because an existing interaction is running.");const fe=new Array;fe.push({x:IA(q.x),y:IA(q.y)});const be=[{x:fe[0].x(0),y:fe[0].y(0)}];K!=null&&(fe.push({x:IA(K.x),y:IA(K.y)}),be.push({x:fe[1].x(0),y:fe[1].y(0)}));let de=performance.now();const{width:Fe,height:we}=this[Ut],Me=this.getBoundingClientRect(),_e=wt=>{for(const[ft,ze]of be.entries()){const{style:$e}=le[ft];$e.transform=`translateX(${Fe*ze.x}px) translateY(${we*ze.y}px)`,wt==="pointerdown"?$e.opacity="1":wt==="pointerup"&&($e.opacity="0");const pt={pointerId:ft-5678,pointerType:"touch",target:ne,clientX:Fe*ze.x+Me.x,clientY:we*ze.y+Me.y,altKey:!0};ne.dispatchEvent(new PointerEvent(wt,pt))}},tt=()=>{const wt=this[SE];if(wt!==Sr.AUTOMATIC||!ne.isConnected){for(const ze of this[K1])ze.style.opacity="0";return _e("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:wt}})),void document.removeEventListener("visibilitychange",me)}const ft=Math.min(1,(performance.now()-de)/Y);for(const[ze,$e]of be.entries())$e.x=fe[ze].x(ft),$e.y=fe[ze].y(ft);_e("pointermove"),ft<1?requestAnimationFrame(tt):(_e("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:Sr.AUTOMATIC}})),document.removeEventListener("visibilitychange",me))},me=()=>{let wt=0;document.visibilityState==="hidden"?wt=performance.now()-de:de=performance.now()-wt};document.addEventListener("visibilitychange",me),_e("pointerdown"),this[SE]=Sr.AUTOMATIC,requestAnimationFrame(tt)}[(t=Y1,i=CE,o=K1,l=bE,h=ig,d=BA,f=ME,g=wd,y=SE,x=Wi,b=$1,_=rg,w=Z1,T=sg,P=Qc,xP)](Y){const q=this[Wi],K=this[Ut];K.framedFoVDeg=180*Y[0]/Math.PI,q.changeSource=Sr.NONE,q.setFieldOfView(K.adjustedFoV(K.framedFoVDeg)),this[TA]()}[EP](Y){const q=this[Wi];if(this[sg]){const{theta:K,phi:ne}=this.getCameraOrbit();Y[0]=K,Y[1]=ne,this[sg]=!1}q.changeSource=Sr.NONE,q.setOrbit(Y[0],Y[1],Y[2]),this[TA]()}[bP](Y){this[Wi].applyOptions({minimumAzimuthalAngle:Y[0],minimumPolarAngle:Y[1],minimumRadius:Y[2]}),this.jumpCameraToGoal()}[CP](Y){this[Wi].applyOptions({maximumAzimuthalAngle:Y[0],maximumPolarAngle:Y[1],maximumRadius:Y[2]}),this[yP](Y[2]),this.jumpCameraToGoal()}[wP](Y){this[Wi].applyOptions({minimumFieldOfView:180*Y[0]/Math.PI}),this.jumpCameraToGoal()}[MP](Y){const q=this[Ut].adjustedFoV(180*Y[0]/Math.PI);this[Wi].applyOptions({maximumFieldOfView:q}),this.jumpCameraToGoal()}[_P](Y){const[q,K,ne]=Y;this[ji].arRenderer.isPresenting||this[Ut].setTarget(q,K,ne),this[Wi].changeSource=Sr.NONE,this[ji].arRenderer.updateTarget(),this[TA]()}[Ul](Y,q){if(super[Ul](Y,q),this[ji].isPresenting||!this[Ld]())return;const K=this[Wi],ne=this[Ut],le=performance.now();if(this[wd]&&this.loaded&&le>this[mg]+this.interactionPromptThreshold&&(this[wd]=!1,this[BA]=le,this[Y1].classList.add("visible")),isFinite(this[BA])&&this.interactionPromptStyle===pP){const de=(le-this[BA])/5e3%1,Fe=_V(de),we=bV(de);if(this[CE].style.opacity=`${we}`,Fe!==this[ig]){const Me=Fe*ne.width*.05,_e=(Fe-this[ig])*Math.PI/16;this[CE].style.transform=`translateX(${Me}px)`,K.changeSource=Sr.AUTOMATIC,K.adjustOrbit(_e,0,0),this[ig]=Fe}}const fe=K.update(Y,q),be=ne.updateTarget(q);(fe||be)&&this[J1]()}[wE](){this[wd]=!1,this[Y1].classList.remove("visible"),this[BA]=1/0}[yP](Y){const q=Math.max(this[Ut].farRadius(),Y),K=Math.abs(2*q);this[Wi].updateNearFar(0,K)}[gP](){const{theta:Y,phi:q}=this[Wi].getCameraSpherical(this[$1]),K=(4+Math.floor((Y%PV+DV)/mP))%4,ne=Math.floor(q/LV),le=`${wV[ne]}${CV[K]}`,fe=le;fe in this[Qc]?this[WE](this[Qc][fe]):this[WE](`View from stage ${le}`)}get[GA](){let Y=". Use mouse, touch or arrow keys to move.";return"interaction-prompt"in this[Qc]&&(Y=`. ${this[Qc]["interaction-prompt"]}`),super[GA].replace(/\.$/,"")+(this.cameraControls?Y:"")}async[qE](Y){const q=this[Wi],K=this[Ut],ne=K.adjustedFoV(K.framedFoVDeg);super[qE](Y);const le=K.adjustedFoV(K.framedFoVDeg)/ne,fe=q.getFieldOfView()*(isFinite(le)?le:1);q.updateAspect(this[Ut].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[Wi].setFieldOfView(fe),this.jumpCameraToGoal()}[Nl](){super[Nl](),this[Z1]?this[sg]=!0:this[Z1]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}[(U=TA,D=J1,z=ng,vP)](){if(typeof this.a11y=="string")if(this.a11y.startsWith("{"))try{this[Qc]=JSON.parse(this.a11y)}catch(Y){console.warn("Error parsing a11y JSON:",Y)}else this.a11y.length>0?console.warn("Error not supported format, should be a JSON string:",this.a11y):this[Qc]={};else typeof this.a11y=="object"&&this.a11y!=null?this[Qc]=Object.assign({},this.a11y):this[Qc]={};this[il].setAttribute("aria-label",this[GA])}}return qr([Cn({type:Boolean,attribute:"camera-controls"})],G.prototype,"cameraControls",void 0),qr([Vh({intrinsics:fP,observeEffects:!0,updateHandler:EP}),Cn({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],G.prototype,"cameraOrbit",void 0),qr([Vh({intrinsics:RV,observeEffects:!0,updateHandler:_P}),Cn({type:String,attribute:"camera-target",hasChanged:()=>!0})],G.prototype,"cameraTarget",void 0),qr([Vh({intrinsics:AP,observeEffects:!0,updateHandler:xP}),Cn({type:String,attribute:"field-of-view",hasChanged:()=>!0})],G.prototype,"fieldOfView",void 0),qr([Vh({intrinsics:TV,updateHandler:bP}),Cn({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],G.prototype,"minCameraOrbit",void 0),qr([Vh({intrinsics:BV,updateHandler:CP}),Cn({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],G.prototype,"maxCameraOrbit",void 0),qr([Vh({intrinsics:IV,updateHandler:wP}),Cn({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],G.prototype,"minFieldOfView",void 0),qr([Vh({intrinsics:AP,updateHandler:MP}),Cn({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],G.prototype,"maxFieldOfView",void 0),qr([Cn({type:Number,attribute:"interaction-prompt-threshold"})],G.prototype,"interactionPromptThreshold",void 0),qr([Cn({type:String,attribute:"interaction-prompt"})],G.prototype,"interactionPrompt",void 0),qr([Cn({type:String,attribute:"interaction-prompt-style"})],G.prototype,"interactionPromptStyle",void 0),qr([Cn({type:Number,attribute:"orbit-sensitivity"})],G.prototype,"orbitSensitivity",void 0),qr([Cn({type:Number,attribute:"zoom-sensitivity"})],G.prototype,"zoomSensitivity",void 0),qr([Cn({type:Number,attribute:"pan-sensitivity"})],G.prototype,"panSensitivity",void 0),qr([Cn({type:String,attribute:"touch-action"})],G.prototype,"touchAction",void 0),qr([Cn({type:Boolean,attribute:"disable-zoom"})],G.prototype,"disableZoom",void 0),qr([Cn({type:Boolean,attribute:"disable-pan"})],G.prototype,"disablePan",void 0),qr([Cn({type:Boolean,attribute:"disable-tap"})],G.prototype,"disableTap",void 0),qr([Cn({type:Number,attribute:"interpolation-decay"})],G.prototype,"interpolationDecay",void 0),qr([Cn()],G.prototype,"a11y",void 0),G})((p=>{var t,i,o,l,h,d,f,g,y,x;class b extends p{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".ar-button"),this[o]=document.createElement("a"),this[l]=new Set,this[h]=_g,this[d]=!1,this[f]=w=>{w.preventDefault(),this.activateAR()},this[g]=({status:w})=>{w!==TE&&this[ji].arRenderer.presentedScene!==this[Ut]||(this.setAttribute("ar-status",w),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:w}})),w===TE?this.removeAttribute("ar-tracking"):w===TP&&this.setAttribute("ar-tracking",BP))},this[y]=({status:w})=>{this.setAttribute("ar-tracking",w),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:w}}))},this[x]=w=>{w.data=="_apple_ar_quicklook_button_tapped"&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[ZE]!==_g}connectedCallback(){super.connectedCallback(),this[ji].arRenderer.addEventListener("status",this[GM]),this.setAttribute("ar-status",TE),this[ji].arRenderer.addEventListener("tracking",this[HM]),this[WA].addEventListener("message",this[zM])}disconnectedCallback(){super.disconnectedCallback(),this[ji].arRenderer.removeEventListener("status",this[GM]),this[ji].arRenderer.removeEventListener("tracking",this[HM]),this[WA].removeEventListener("message",this[zM])}update(w){super.update(w),w.has("arScale")&&(this[Ut].canScale=this.arScale!=="fixed"),w.has("arPlacement")&&(this[Ut].updateShadow(),this[zs]()),w.has("arModes")&&(this[QM]=k7(this.arModes)),(w.has("ar")||w.has("arModes")||w.has("src")||w.has("iosSrc"))&&this[bg]()}async activateAR(){switch(this[ZE]){case kM:await this[IN]();break;case wN:await this[MN]();break;case CN:this[SN]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(t=Q7,i=Wc,o=WA,l=QM,h=ZE,d=ex,f=tx,g=GM,y=HM,x=zM,bg)](){var w;let T=_g;if(this.ar){if(this.src!=null)for(const P of this[QM]){if(P==="webxr"&&G3&&!EN&&await this[ji].arRenderer.supportsPresentation()){T=wN;break}if(P==="scene-viewer"&&!xN&&(Uz||navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&(!((w=(await navigator.userAgentData.getHighEntropyValues(["formFactor"])).formFactor)===null||w===void 0)&&w.includes("XR")))){T=CN;break}if(P==="quick-look"&&z3){T=kM;break}}T===_g&&this.iosSrc!=null&&z3&&(T=kM)}if(T!==_g)this[Wc].classList.add("enabled"),this[Wc].addEventListener("click",this[tx]);else if(this[Wc].classList.contains("enabled")){this[Wc].removeEventListener("click",this[tx]),this[Wc].classList.remove("enabled");const P=OV;this.setAttribute("ar-status",P),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:P}}))}this[ZE]=T}async[MN](){console.log("Attempting to present in AR with WebXR..."),await this[VM]();try{this[Wc].removeEventListener("click",this[tx]);const{arRenderer:w}=this[ji];w.placeOnWall=this.arPlacement==="wall",await w.present(this[Ut],this.xrEnvironment)}catch(w){console.warn("Error while trying to present in AR with WebXR"),console.error(w),await this[ji].arRenderer.stopPresenting(),EN=!0,console.warn("Falling back to next ar-mode"),await this[bg](),this.activateAR()}finally{this[bg]()}}async[VM](){this.loaded||(this[ex]=!0,this[HA](),await((w,T,P=null)=>new Promise(U=>{w.addEventListener(T,function D(z){P&&!P(z)||(U(z),w.removeEventListener(T,D))})}))(this,"load"),this[ex]=!1)}[zA](){return super[zA]()||this[ex]}[SN](){const w=self.location.toString(),T=new URL(w),P=new URL(this.src,w);P.hash&&(P.hash="");const U=new URLSearchParams(P.search);if(T.hash=_N,U.set("mode","ar_preferred"),U.has("disable_occlusion")||U.set("disable_occlusion","true"),this.arScale==="fixed"&&U.set("resizable","false"),this.arPlacement==="wall"&&U.set("enable_vertical_placement","true"),U.has("sound")){const z=new URL(U.get("sound"),w);U.set("sound",z.toString())}if(U.has("link")){const z=new URL(U.get("link"),w);U.set("link",z.toString())}const D=`intent://arvr.google.com/scene-viewer/1.2?${U.toString()+"&file="+encodeURIComponent(P.toString())}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(T.toString())};end;`;self.addEventListener("hashchange",()=>{self.location.hash===_N&&(xN=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[bg]())},{once:!0}),this[WA].setAttribute("href",D),console.log("Attempting to present in AR with Scene Viewer..."),this[WA].click()}async[IN](){const w=!this.iosSrc;this[Wc].classList.remove("enabled");const T=w?await this.prepareUSDZ():this.iosSrc,P=new URL(T,self.location.toString());if(w){const z=self.location.toString(),G=new URL(z),Q=new URL(this.src,G);Q.hash&&(P.hash=Q.hash)}this.arScale==="fixed"&&(P.hash&&(P.hash+="&"),P.hash+="allowsContentScaling=0");const U=this[WA];U.setAttribute("rel","ar");const D=document.createElement("img");U.appendChild(D),U.setAttribute("href",P.toString()),w&&U.setAttribute("download","model.usdz"),U.style.display="none",U.isConnected||this.shadowRoot.appendChild(U),console.log("Attempting to present in AR with Quick Look..."),U.click(),U.removeChild(D),w&&URL.revokeObjectURL(T),this[Wc].classList.add("enabled")}async prepareUSDZ(){const w=this[Rd].beginActivity("usdz-conversion");await this[VM]();const{model:T,shadow:P,target:U}=this[Ut];if(T==null)return"";let D=!1;P!=null&&(D=P.visible,P.visible=!1),w(.2);const z=new U7;U.remove(T),T.position.copy(U.position),T.updateWorldMatrix(!1,!0);const G=await z.parseAsync(T);T.position.set(0,0,0),U.add(T);const Q=new Blob([G],{type:"model/vnd.usdz+zip"}),Y=URL.createObjectURL(Q);return w(1),P!=null&&(P.visible=D),Y}}return VA([Cn({type:Boolean,attribute:"ar"})],b.prototype,"ar",void 0),VA([Cn({type:String,attribute:"ar-scale"})],b.prototype,"arScale",void 0),VA([Cn({type:String,attribute:"ar-placement"})],b.prototype,"arPlacement",void 0),VA([Cn({type:String,attribute:"ar-modes"})],b.prototype,"arModes",void 0),VA([Cn({type:String,attribute:"ios-src"})],b.prototype,"iosSrc",void 0),VA([Cn({type:Boolean,attribute:"xr-environment"})],b.prototype,"xrEnvironment",void 0),b})((p=>{var t,i,o,l,h,d,f,g;class y extends p{constructor(...b){super(...b),this.poster=null,this.reveal=jM,this.loading=G7,this[t]=!1,this[i]=!1,this[o]=this.shadowRoot.querySelector(".slot.poster"),this[l]=this.shadowRoot.querySelector("#default-poster"),this[h]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[d]=this[qA].getAttribute("aria-label"),this[f]=((U,D)=>{let z=null;const G=(...Q)=>{z==null&&(U(...Q),z=self.setTimeout(()=>z=null,D))};return G.flush=()=>{z!=null&&(self.clearTimeout(z),z=null)},G})(U=>{const D=this[jA].parentNode;requestAnimationFrame(()=>{this[jA].style.transform=`scaleX(${U})`,U===0&&(D.removeChild(this[jA]),D.appendChild(this[jA])),this[jA].classList.toggle("hide",U===1)})},100),this[g]=U=>{const D=U.detail.totalProgress,z=U.detail.reason;D===1&&(this[YM].flush(),this.loaded&&(this[Cg]||this.reveal===jM)&&this[XM]()),this[YM](D),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:D,reason:z}}))};const _=self.ModelViewerElement||{},w=_.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";ca.setDRACODecoderLocation(w);const T=_.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";ca.setKTX2TranscoderLocation(T),_.meshoptDecoderLocation&&ca.setMeshoptDecoderLocation(_.meshoptDecoderLocation);const P=_.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";rl.singleton.textureUtils.lottieLoaderUrl=P}static set dracoDecoderLocation(b){ca.setDRACODecoderLocation(b)}static get dracoDecoderLocation(){return ca.getDRACODecoderLocation()}static set ktx2TranscoderLocation(b){ca.setKTX2TranscoderLocation(b)}static get ktx2TranscoderLocation(){return ca.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(b){ca.setMeshoptDecoderLocation(b)}static get meshoptDecoderLocation(){return ca.getMeshoptDecoderLocation()}static set lottieLoaderLocation(b){rl.singleton.textureUtils.lottieLoaderUrl=b}static get lottieLoaderLocation(){return rl.singleton.textureUtils.lottieLoaderUrl}static mapURLs(b){rl.singleton.loader[Cd].manager.setURLModifier(b)}dismissPoster(){this.loaded?this[XM]():(this[Cg]=!0,this[HA]())}showPoster(){const b=this[qM];if(b.classList.contains("show"))return;b.classList.add("show"),this[il].classList.remove("show");const _=this[qA];_.removeAttribute("tabindex"),_.removeAttribute("aria-hidden");const w=this.modelIsVisible;this[nx]=!1,this[VE](w)}getDimensions(){return Xh(this[Ut].size)}getBoundingBoxCenter(){return Xh(this[Ut].boundingBox.getCenter(new ve))}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[Rd].addEventListener("progress",this[KM])}disconnectedCallback(){super.disconnectedCallback(),this[Rd].removeEventListener("progress",this[KM])}async updated(b){super.updated(b),b.has("poster")&&this.poster!=null&&(this[qA].style.backgroundImage=`url(${this.poster})`),b.has("alt")&&this[qA].setAttribute("aria-label",this[bM]),(b.has("reveal")||b.has("loading"))&&this[HA]()}[(t=nx,i=Cg,o=qM,l=qA,h=jA,d=z7,f=YM,g=KM,zA)](){return!!this.src&&(this[Cg]||this.loading===H7||this.reveal===jM&&this[Bd])}[XM](){this[Cg]=!1;const b=this[qM];if(!b.classList.contains("show"))return;b.classList.remove("show"),this[il].classList.add("show");const _=this.modelIsVisible;this[nx]=!0,this[VE](_);const w=this.getRootNode();w&&w.activeElement===this&&this[il].focus();const T=this[qA];T.setAttribute("aria-hidden","true"),T.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[Ld](){return super[Ld]()&&this[nx]}}return WM([Cn({type:String})],y.prototype,"poster",void 0),WM([Cn({type:String})],y.prototype,"reveal",void 0),WM([Cn({type:String})],y.prototype,"loading",void 0),y})((p=>{var t;class i extends p{constructor(...l){super(l),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[t]=!0,this[Ut].subscribeMixerEvent("loop",h=>{const d=h.action._loopCount;this.dispatchEvent(new CustomEvent("loop",{detail:{count:d}}))}),this[Ut].subscribeMixerEvent("finished",()=>{this[zc]=!0,this.dispatchEvent(new CustomEvent("finished"))})}get availableAnimations(){return this.loaded?this[Ut].animationNames:[]}get duration(){return this[Ut].duration}get paused(){return this[zc]}get currentTime(){return this[Ut].animationTime}set currentTime(l){this[Ut].animationTime=l,this[zs]()}get timeScale(){return this[Ut].animationTimeScale}set timeScale(l){this[Ut].animationTimeScale=l}pause(){this[zc]||(this[zc]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(l){this.availableAnimations.length>0&&(this[zc]=!1,this[XE](l),this.dispatchEvent(new CustomEvent("play")))}[(t=zc,Nl)](){super[Nl](),this[zc]=!0,this.animationName!=null&&this[XE](),this.autoplay&&this.play()}[Ul](l,h){super[Ul](l,h),this[zc]||!this[Ld]()&&!this[ji].isPresenting||(this[Ut].updateAnimation(h/1e3),this[zs]())}updated(l){super.updated(l),l.has("autoplay")&&this.autoplay&&this.play(),l.has("animationName")&&this[XE]()}[XE](l=b7){var h;const d=(h=l.repetitions)!==null&&h!==void 0?h:1/0,f=l.pingpong?tw:d===1?2200:LR;this[Ut].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,f,d),this[zc]&&(this[Ut].updateAnimation(0),this[zs]())}}return MM([Cn({type:Boolean})],i.prototype,"autoplay",void 0),MM([Cn({type:String,attribute:"animation-name"})],i.prototype,"animationName",void 0),MM([Cn({type:Number,attribute:"animation-crossfade-duration"})],i.prototype,"animationCrossfadeDuration",void 0),i})(gg))))))));customElements.define("model-viewer",BN);export{jw as CanvasTexture,Rl as FileLoader,tl as Loader,BN as ModelViewerElement,fs as NearestFilter};
